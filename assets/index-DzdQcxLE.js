import{j as e,f as y,aI as U,aG as N,aS as P,g as se,Q as w,L as oe,U as ue,V as F,h as p,D as L,G as R,aT as O,al as Me,am as Le,aU as Oe,ao as Te,aV as $e,aW as Ue,aX as Ie,k as W,aY as te,aZ as Be,w as Ne,x as X,B as T,a_ as Pe,a6 as We,aN as Ee,a$ as Ge,b0 as ze,b1 as Fe,b2 as Ve,b3 as _e,n as qe,p as Je,o as He}from"./mui-BnTXCE-8.js";import{a as H,l as Ye,u as xe,C as Qe}from"./index-Dp22mWpS.js";import{a as f,u as Y,l as Xe,k as Ze}from"./vendor-Bf6wU4zJ.js";import{d as $,i as C,a as De,b as Z}from"./strings-DL3cDbr1.js";import{i as V,u as M,T as u,t as en}from"./translations-CairTNs2.js";import{s as he,n as nn,u as je}from"./index-CzcRMrQJ.js";import{u as _}from"./index-DUaPncvf.js";import{i as sn,g as pe,u as ge,a as me,C as tn}from"./useActionList-fE7Opyke.js";import{u as be,g as fe}from"./gameBoard-B4NCWdD8.js";import{a as rn,i as ln}from"./urls-bwAPA7IR.js";import{T as on}from"./index-BEyo3J6m.js";function cn(n){const{t:s}=V;let t=`### ${s("roomSettings")}\r
`;return Object.entries(n).forEach(([i,r])=>{if(i!=="room"){if(i==="roomBackgroundURL"&&r!==""){t+=`* ${s(i)}: [${rn(r)}:link:](${r})\r
`;return}if(i==="roomRealtime"){t+=`* ${s("playerList")}: ${s(r?"delayed":"realtime")}\r
`;return}r!==""&&(t+=`* ${s(i)}: ${r}\r
`)}}),t}function an(n){const s={};return Object.entries(n).forEach(([t,i])=>{t.startsWith("room")&&!["roomUpdated","roomBackground"].some(r=>r===t)&&(s[t]=i)}),s}async function dn(n,s,t){let i=n;return s!==void 0&&s.length>0&&(i=await t(s)),i}function un(n,s){const t=an(n);return he({room:n.room,user:s,text:cn(t),type:"room",settings:JSON.stringify(t)})}function xn(n,s,t){const i=Object.entries(t).filter(([l])=>n[l]).reduce((l,[o,a])=>(l[o]=Object.keys(a.actions).slice(1,n[o]+1),l),{});return(s==null?void 0:s.filter(l=>{if(l.group==="misc")return!0;const o=i[l.group];return o&&o.length>=Number(l.intensity)})).length}function hn(n,s,t,i){const{t:r}=V;let l=`### ${V.t("gameSettings")}\r
`;if(i&&(l+=`##### ${i}\r
`),l+=`--- \r
`,Object.entries(t).forEach(([x,h])=>{var S;if(!n[x])return;const{role:d,variation:j,level:g}=n[x],b=d||n.role||"sub";if(g>0){if(l+=`* ${h==null?void 0:h.label}: ${(S=Object.keys(h==null?void 0:h.actions))==null?void 0:S[g]}`,j&&(l+=` (${r(j)})`),!$(n.gameMode)&&!j){const m=h[b]??r(b);l+=` (${m})`}l+=`\r
`}}),l.endsWith(`--- \r
`))return"";const{finishRange:o,difficulty:a}=n;l+=`--- \r
`,l+=`* ${r("difficulty")}: ${r(a??"normal")} \r
`,o&&(l+=`* ${r("finishSlider")} ${o[0]}%  | ${o[1]-o[0]}% | ${100-o[1]}%`);const c=xn(n,s,t);return c&&(l+=`* ${r("customTiles")}: ${c} \r
`),l}function jn(n){const s={};return Object.entries(n).forEach(([t,i])=>{!["displayName","background","boardUpdated","chatSound","mySound","otherSound","othersDialog","playerDialog","readRoll","hideBoardActions","advancedSettings"].includes(t)&&!t.startsWith("room")&&(s[t]=i)}),s}async function pn({title:n,formData:s,user:t,actionsList:i,tiles:r,customTiles:l=[],reason:o=""}){const a=JSON.stringify(jn(s)),c=await nn({title:n,gameBoard:JSON.stringify(r),settings:a}),x=hn(s,l,i,o);if(!(!(c!=null&&c.id)||x===""))return he({room:(s==null?void 0:s.room)||"PUBLIC",user:t,text:x,type:"settings",gameBoardId:c.id,boardSize:r.length,gameMode:s.gameMode})}function gn(n){for(let s=n.length-1;s>0;s-=1){const t=Math.floor(Math.random()*(s+1));[n[s],n[t]]=[n[t],n[s]]}return n}function ce(n){n.length>1&&n.push(n.shift())}function ae(n,s){return(n==null?void 0:n.length)!==(s==null?void 0:s.length)?!1:n.every((t,i)=>t===s[i])}const{t:E}=V;function mn(n,s){return n.filter(t=>s==="vers"?t.includes("{sub}")&&t.includes("{dom}")||t.includes("{player}"):!t.match(/{(dom|sub)}/)||t.includes(`{${s}}`))}function bn(n,s,t){var l;const i=((l=n[s])==null?void 0:l.role)??n.role??"sub";return Object.keys(t).reduce((o,a,c)=>{var x;return c>0&&c<=((x=n[s])==null?void 0:x.level)&&(o[a]=gn(mn(t[a],i))),o},{})}function fn(n,s){return Object.entries(n).filter(([t])=>{var i;return((i=s[t])==null?void 0:i.level)>0}).map(([t,i])=>{var r;return{label:i.label,actions:bn(s,t,i==null?void 0:i.actions),key:t,standalone:!1,role:((r=s[t])==null?void 0:r.role)??s.role??"sub"}})}function yn(n,s){return s.length&&(s.some(({group:t})=>t==="misc")&&n.push({label:E("misc"),actions:{All:[]},key:"misc",standalone:!1}),s.forEach(({group:t,intensity:i,action:r})=>{const l=n.find(o=>o.key===t);if(l&&Object.keys(l.actions).length>=i){const o=Object.values(l.actions)[i-1],a=Math.floor(Math.random()*(o.length+1));o.splice(a,0,r)}})),n}function Sn(n){return Object.entries(n).reduce((s,[t,i])=>(i!=null&&i.variation&&(s[t]=i),s),{})}function vn(n,s){const t=[],i=[...s];return Object.entries(n).forEach(([r,{level:l,variation:o}])=>{if(l<=0)return;const a=s.findIndex(x=>x.key===r);if(o==="standalone"){i[a].standalone=!0;return}const c=o==="appendSome"?.4:.9;t.push({...s[a],frequency:c}),i.splice(a,1)}),{appendList:t,listWithoutAppend:i}}function Cn(n,s,t,i){if([void 0,"normal"].includes(i)){const r=n/s;return Math.floor(t/r)}return s>=3&&Math.random()>=.6?s-2:s-1}function de(n,s,t,i){ce(n);const{actions:r,label:l,standalone:o,frequency:a,role:c}=n[0],x=Math.random();if(a&&a<=x)return{description:""};const h=Object.keys(r),d=Object.values(r);let j=Cn(s,h.length,t,i==null?void 0:i.difficulty);return d[j]||(j-=1),ce(d[j]),{title:l,description:d[j][0],standalone:o,role:c}}function kn(n,s,t){const i=Sn(s),{listWithoutAppend:r,appendList:l}=vn(i,n),o=[];for(let a=1;a<=t;a+=1){const{title:c,description:x,standalone:h,role:d}=de(r,t,a,s);let j="";if(!h&&l.length){const{description:g}=de(l,t,a,s);j=`${g.trim().replace(/([^.,!?])$/,"$1.")} ${x}`}else j=x;o.push({title:c,description:j.trim(),role:d})}return o}function wn(n,s){const t={title:E("start"),description:E("start")},{finishRange:i}=s,r=`${E("noCum")} ${i[0]}%\r
${E("ruined")} ${i[1]-i[0]}%\r
${E("cum")} ${100-i[1]}%`,l={title:E("finish"),description:r};return[t,...n,l]}function Kn(n,s,t=[],i=40){const r=fn(s,n);r.length||(localStorage.clear(),window.location.reload());const l=yn(r,t),o=kn(l,n,i-2);return wn(o,n)}function An(){const n=_(pe),s=_(fe),[t,i]=H("gameSettings"),{i18n:r}=M();async function l(o={}){var v;const a=o!=null&&o.roomUpdate||o!=null&&o.boardUpdated?o:{...t,...o};let{gameMode:c,boardUpdated:x}=a;const{roomTileCount:h=40,finishRange:d,room:j}=a,g=C(j);if(!d)return{};g&&!$(c)&&(c="online",x=!0);const b=await sn(r.resolvedLanguage,c),m=Kn(a,b,n,g?40:h);return(o!=null&&o.boardUpdated||x||((v=s==null?void 0:s.tiles)==null?void 0:v.length)!==m.length)&&(await i(a),await be({title:(s==null?void 0:s.title)||"",tiles:m})),{settingsBoardUpdated:x,gameMode:c,newBoard:m}}return(o={})=>l(o)}function D({children:n,value:s,index:t,style:i,...r}){return e.jsx("div",{role:"tabpanel",hidden:s!==t,id:`simple-tabpanel-${t}`,"aria-labelledby":`simple-tab-${t}`,...r,children:s===t&&e.jsx(y,{sx:{p:3,...i},children:n})})}function ye({formData:n,setFormData:s,backgrounds:t,isRoom:i=!1}){const{t:r}=M(),l=i?"roomBackground":"background",o=i?"roomBackgroundURL":"backgroundURL",[a,c]=f.useState((n==null?void 0:n[l])||Object.keys(t)[0]),x=()=>Object.entries(t).map(([j,g])=>e.jsx(w,{value:j,children:g},j)),h=j=>{s({...n,[l]:j.target.value}),c(j.target.value)};f.useEffect(()=>{a!==(n==null?void 0:n[l])&&c(n==null?void 0:n[l])},[n==null?void 0:n[l]]);const d=j=>{const g={...n,[l]:"custom",[o]:j.target.value};i&&(g.roomUpdated=!0),s(g)};return e.jsxs(e.Fragment,{children:[e.jsxs(U,{fullWidth:!0,margin:"normal",children:[e.jsx(N,{id:"background-label",children:r("background")}),e.jsx(P,{labelId:"background-label",id:"background",label:r("background"),value:a||"",onChange:h,children:x()})]}),a==="custom"&&e.jsx(se,{sx:{mt:2},label:r("url"),value:n==null?void 0:n[o],fullWidth:!0,onChange:d,helperText:e.jsxs(e.Fragment,{children:[r("supportedSites"),e.jsx("br",{}),r("requiresEmbeddedUrl")]})})]})}function Rn({boardUpdated:n}){const{i18n:s}=M(),[t,i]=f.useState(s.resolvedLanguage);function r(o){i(o),s.changeLanguage(o),n()}const l=Object.entries(Ye).map(([o,a])=>e.jsx(w,{value:o,children:a.label},o));return e.jsx(y,{sx:{minWidth:120,mt:1,mb:2},children:e.jsxs(U,{fullWidth:!0,children:[e.jsxs(N,{id:"language-label",sx:{display:"flex",alignItems:"center"},children:[e.jsx(oe,{sx:{mr:1}}),e.jsx(u,{i18nKey:"language"})]}),e.jsx(P,{labelId:"language-label",id:"language-select",value:t,label:e.jsxs(e.Fragment,{children:[e.jsx(oe,{}),e.jsx(u,{i18nKey:"language"})]}),onChange:o=>r(o.target.value),children:l})]})})}function q({trueCondition:n,onChange:s,yesLabel:t,noLabel:i,sx:r={}}){return e.jsx(y,{sx:{display:"flex",justifyContent:"center",my:1,...r},children:e.jsx(ue,{control:e.jsx(F,{checked:n||!1,onChange:s}),label:e.jsx(u,{i18nKey:n?t:i})})})}function B({field:n,formData:s,handleSwitch:t}){return e.jsx(q,{trueCondition:s[n],onChange:i=>t(i,n),yesLabel:`${n}Enable`,noLabel:`${n}Disable`,sx:{justifyContent:"left"}})}function Mn({formData:n,setFormData:s,boardUpdated:t}){const[i,r]=H("gameSettings"),{t:l}=M(),o={color:l("color"),gray:l("gray"),"metronome.gif":l("hypnoDick"),"pink-spiral.gif":l("pinkSpiral"),custom:l("customURL")};function a(c,x){s({...n,[x]:c.target.checked}),r({...i,[x]:c.target.checked})}return e.jsxs(e.Fragment,{children:[e.jsx(Rn,{boardUpdated:t}),e.jsx(p,{variant:"h5",children:e.jsx(u,{i18nKey:"dialog"})}),e.jsx(B,{field:"playerDialog",formData:n,handleSwitch:a}),e.jsx(B,{field:"othersDialog",formData:n,handleSwitch:a}),e.jsx(L,{}),e.jsx(p,{variant:"h5",sx:{mt:2},children:e.jsx(u,{i18nKey:"sounds"})}),e.jsx(B,{field:"mySound",formData:n,handleSwitch:a}),e.jsx(B,{field:"otherSound",formData:n,handleSwitch:a}),e.jsx(B,{field:"chatSound",formData:n,handleSwitch:a}),e.jsx(B,{field:"readRoll",formData:n,handleSwitch:a}),e.jsx(L,{}),e.jsx(p,{variant:"h5",sx:{mt:2,textTransform:"capitalize"},children:e.jsx(u,{i18nKey:"miscellaneous"})}),e.jsx(B,{field:"hideBoardActions",formData:n,handleSwitch:a}),e.jsx(B,{field:"advancedSettings",formData:n,handleSwitch:a}),e.jsx(ye,{formData:n,setFormData:s,backgrounds:o}),e.jsx(L,{})]})}function ee({children:n}){return e.jsx(R,{size:{xs:12,md:5},children:n})}const J=f.forwardRef(({value:n,onChange:s,label:t,options:i,defaultValue:r=null,sx:l,helpIcon:o=!1,fullWidth:a=!0,...c},x)=>{const h=i.map(d=>typeof d=="string"?e.jsx(w,{value:d,children:e.jsx(u,{i18nKey:d})},d):e.jsx(w,{value:d.value,children:d.label},d.value));return e.jsxs(U,{fullWidth:a,margin:"normal",sx:l,...c,ref:x,children:[e.jsxs(N,{id:`${t}Label`,children:[e.jsx(u,{i18nKey:t}),!!o&&e.jsx(O,{sx:{ml:1,fontSize:16}})]}),e.jsx(P,{labelId:`${t}Label`,id:t,label:e.jsxs(e.Fragment,{children:[e.jsx(u,{i18nKey:t}),!!o&&e.jsx(O,{sx:{ml:1,fontSize:16}})]}),value:n||r,onChange:s,children:h})]})});function ne({children:n,title:s,subtitle:t,defaultExpanded:i=!1,...r}){return e.jsxs(Me,{defaultExpanded:i,...r,sx:{backgroundColor:"inherit",backgroundImage:"none",boxShadow:"none"},children:[e.jsxs(Le,{expandIcon:e.jsx(Oe,{}),sx:{px:0},children:[e.jsxs(p,{variant:"h6",sx:{width:"33%"},children:[s,":"]}),e.jsx(p,{sx:{pt:.5},children:t})]}),e.jsx(Te,{sx:{px:0},children:e.jsx(R,{container:!0,columnSpacing:2,justifyContent:"space-evenly",className:"columned-grid",children:n})})]})}function Ln({formData:n,setFormData:s}){const t=(r,l)=>{s({...n,finishRange:l,boardUpdated:!0})},i=(n==null?void 0:n.finishRange)||[30,70];return e.jsxs(y,{children:[e.jsx(L,{}),e.jsx(p,{id:"finish-slider",sx:{my:1},children:e.jsx(u,{i18nKey:"finishSlider"})}),e.jsx($e,{"aria-labelledby":"finish-slider",value:i,onChange:t,valueLabelDisplay:"off"}),e.jsxs(y,{display:"flex",flexDirection:"column",justifyContent:"space-between",textAlign:"center",children:[e.jsxs(p,{whiteSpace:"nowrap",children:[e.jsx(u,{i18nKey:"noCum"})," ",i[0],"%"]}),e.jsxs(p,{whiteSpace:"nowrap",children:[e.jsx(u,{i18nKey:"ruined"})," ",i[1]-i[0],"%"]}),e.jsxs(p,{whiteSpace:"nowrap",children:[e.jsx(u,{i18nKey:"cum"})," ",100-i[1],"%"]})]}),e.jsx(L,{sx:{my:1}})]})}function On(){const[n,s]=f.useState(!1);return f.useEffect(()=>{const t=window.matchMedia("(pointer: fine)");s(t.matches);const i=r=>{s(r.matches)};return t.addEventListener("change",i),()=>{t.removeEventListener("change",i)}},[]),n}function ie({actionsFolder:n,settings:s,option:t,onChange:i,initValue:r=0}){var g,b,S;const l=`${t}label`,o=(g=n[t])==null?void 0:g.label,a=On(),[c,x]=f.useState(((b=s[t])==null?void 0:b.level)||0),h=m=>{x(m)},d=m=>c>0&&m===0?!1:s.difficulty==="accelerated"?c<=2?c===m:c===m||c-1===m:c>=m;function j(m){var v;return Object.keys((v=n[m])==null?void 0:v.actions).map((A,k)=>e.jsxs(w,{value:k,onMouseOver:()=>h(k),children:[!!a&&e.jsx("span",{className:"menu-item-icon",children:d(k)?e.jsx(Ue,{}):e.jsx(Ie,{})}),A]},`${m}-${A}`))}return e.jsxs(U,{margin:"normal",fullWidth:!0,children:[e.jsx(N,{id:l,children:o}),e.jsx(P,{labelId:l,id:t,label:o,value:((S=s[t])==null?void 0:S.level)||r,onChange:i,onOpen:()=>{var m;return x(((m=s[t])==null?void 0:m.level)||r)},onClose:()=>{var m;return x(((m=s[t])==null?void 0:m.level)||r)},children:j(t)})]})}function Tn({option:n,settings:s,setSettings:t,actionsFolder:i,type:r,showVariation:l=!1,showRole:o=!1}){var g,b,S,m;const{t:a}=M(),c=`${n}label`,x=(g=i[n])==null?void 0:g.label;function h(v,A,k){t(G=>{var z;return{...G,[A]:{...G[A],type:r,[k]:(z=v==null?void 0:v.target)==null?void 0:z.value},boardUpdated:!0}})}let d=12;(l||o)&&(d=6);let j=["dom","vers","sub"];return(b=i[n])!=null&&b.dom&&(j=[{label:i[n].dom,value:"dom"},{label:a("vers"),value:"vers"},{label:i[n].sub,value:"sub"}]),e.jsxs(R,{container:!0,justifyContent:"center",children:[e.jsx(R,{size:d,children:e.jsx(ie,{actionsFolder:i,settings:s,option:n,onChange:v=>h(v,n,"level")})}),!!o&&e.jsx(R,{size:6,children:e.jsx(J,{sx:{ml:1},value:(S=s[n])==null?void 0:S.role,onChange:v=>h(v,n,"role"),label:`${a("role")}: ${x}`,options:j,defaultValue:s.role||"sub"})}),!!l&&e.jsx(R,{size:6,children:e.jsx(W,{placement:"top",title:e.jsxs(u,{i18nKey:"variationTooltip",children:[e.jsx(p,{variant:"subtitle2",children:"Standalone = Its own tile. "}),e.jsx(p,{variant:"subtitle2",children:"Append Some = 50% chance."}),e.jsx(p,{variant:"subtitle2",children:"Append Most = 90% chance."})]}),arrow:!0,children:e.jsxs(U,{fullWidth:!0,margin:"normal",sx:{ml:1},children:[e.jsxs(N,{id:`${c}Variation`,children:[`${x} ${a("variation")}`,e.jsx(O,{sx:{ml:1,fontSize:16}})]}),e.jsxs(P,{labelId:`${c}Variation`,id:`${n}Variation`,label:e.jsxs(e.Fragment,{children:[x," ",a("variation"),e.jsx(O,{sx:{ml:1,fontSize:16}})]}),value:((m=s[n])==null?void 0:m.variation)||"standalone",onChange:v=>h(v,n,"variation"),children:[e.jsx(w,{value:"standalone",children:e.jsx(u,{i18nKey:"standalone"})}),e.jsx(w,{value:"appendSome",children:e.jsx(u,{i18nKey:"appendSome"})}),e.jsx(w,{value:"appendMost",children:e.jsx(u,{i18nKey:"appendMost"})})]})]})})})]},n)}function $n({formData:n,setFormData:s}){return e.jsxs(te,{direction:"row",spacing:1,alignItems:"center",justifyContent:"center",sx:{mt:1},children:[e.jsx(p,{children:e.jsx(u,{i18nKey:"solo"})}),e.jsx(W,{title:e.jsx(p,{variant:"subtitle2",children:e.jsx(u,{i18nKey:"soloTooltip"})}),arrow:!0,children:e.jsx(O,{sx:{fontSize:15}})}),e.jsx(F,{id:"gameMode",checked:!$(n.gameMode),onChange:t=>s({...n,gameMode:t.target.checked?"local":"online",boardUpdated:!0}),inputProps:{"aria-label":"Game Type"}}),e.jsx(p,{children:e.jsx(u,{i18nKey:"local"})}),e.jsx(W,{title:e.jsx(p,{variant:"subtitle2",children:e.jsx(u,{i18nKey:"localTooltip"})}),arrow:!0,children:e.jsx(O,{sx:{fontSize:15}})})]})}function Un({formData:n}){const[s,t]=f.useState(!1);return f.useEffect(()=>{const i=Object.values(n).filter(l=>(l==null?void 0:l.type)==="consumption"&&(l==null?void 0:l.level)>0).length,r=Object.values(n).filter(l=>(l==null?void 0:l.level)>0).length;t(i>1&&i>=r-i)},[n]),s?e.jsx(Be,{severity:"warning",children:e.jsx(u,{i18nKey:"consumptionWarning"})}):null}function In({formData:n,setFormData:s,actionsList:t}){const{t:i}=M(),r=xe("md"),l=!C(n==null?void 0:n.room)&&!$(n.gameMode);function o(c,x={}){return Object.keys(t).filter(h=>{var d;return((d=t[h])==null?void 0:d.type)===c}).map(h=>e.jsx(ee,{sm:r&&!l?6:12,children:e.jsx(Tn,{option:h,settings:n,setSettings:s,actionsFolder:t,type:c,...x})},h))}const a=c=>{const x=JSON.parse(JSON.stringify(n));return Object.keys(x).forEach(h=>{x.role=c,h.includes("role")&&(x[h]=c)}),x};return e.jsxs(e.Fragment,{children:[e.jsx($n,{formData:n,setFormData:s}),C(n==null?void 0:n.room)&&!$(n.gameMode)&&e.jsx(R,{container:!0,alignContent:"center",justifyContent:"space-evenly",children:e.jsx(R,{sx:{py:3},children:e.jsx(p,{variant:"h5",children:e.jsx(u,{i18nKey:"privateRequired"})})})}),e.jsxs(R,{container:!0,columnSpacing:2,justifyContent:"space-evenly",children:[e.jsx(ee,{children:e.jsx(W,{placement:"top",title:e.jsx(u,{i18nKey:"difficultyTooltip",children:e.jsxs(p,{variant:"body2",children:["Normal = Slow ramp up. ",e.jsx("br",{}),e.jsx("br",{}),"Accelerated = Straight to max level + the level prior to it."]})}),arrow:!0,children:e.jsx(J,{value:n.difficulty,onChange:c=>s({...n,difficulty:c.target.value,boardUpdated:!0}),label:"difficulty",options:["normal","accelerated"],defaultValue:"normal",helpIcon:!0})})}),l&&e.jsx(ee,{children:e.jsx(J,{value:n.role,onChange:c=>s({...a(c.target.value),boardUpdated:!0}),label:"mainRole",options:["dom","vers","sub"],defaultValue:"sub"})})]}),l?e.jsxs(e.Fragment,{children:[e.jsx(ne,{title:i("consumption"),subtitle:i("consumptionSubtitle"),children:o("consumption",{showVariation:!0})}),e.jsx(ne,{title:i("foreplay"),subtitle:i("foreplaySubtitle"),children:o("foreplay",{showRole:l})}),e.jsx(ne,{title:i("sex"),subtitle:i("sexSubtitle"),children:o("sex",{showRole:l})})]}):e.jsxs(e.Fragment,{children:[e.jsx(R,{container:!0,columnSpacing:2,justifyContent:"space-evenly",children:o("consumption",{showVariation:!0})}),e.jsx(L,{}),e.jsx(R,{container:!0,columnSpacing:2,justifyContent:"center",children:o("solo")})]}),e.jsx(Ln,{setFormData:s,formData:n}),e.jsx(Un,{formData:n})]})}function Bn({formData:n,setFormData:s}){const{t}=M(),i={"1d4":2.5,"1d6":3.5,"2d4":5},r=n!=null&&n.roomTileCount?Math.floor(n.roomTileCount/i[n.roomDice]):16,l=Array.from({length:7},(o,a)=>(a+2)*10).map(o=>e.jsx(w,{value:o,children:o},o));return e.jsxs(e.Fragment,{children:[e.jsx(p,{children:e.jsx(u,{i18nKey:"gameSpeed"})}),e.jsxs(y,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[e.jsxs(U,{sx:{m:1},fullWidth:!0,children:[e.jsx(N,{id:"diceRole-label",children:e.jsx(u,{i18nKey:"roomDice"})}),e.jsxs(P,{labelId:"diceRole-label",id:"diceRole-select",value:(n==null?void 0:n.roomDice)||"1d4",label:t("roomDice"),onChange:o=>s({...n,roomDice:o.target.value,roomUpdated:!0}),children:[e.jsx(w,{value:"1d4",children:"1d4"}),e.jsx(w,{value:"1d6",children:"1d6"}),e.jsx(w,{value:"2d4",children:"2d4"})]})]}),e.jsxs(U,{sx:{m:1},fullWidth:!0,children:[e.jsx(N,{id:"tile-count-label",children:e.jsx(u,{i18nKey:"roomTileCount"})}),e.jsx(P,{labelId:"tile-count-label",id:"tile-count-select",value:(n==null?void 0:n.roomTileCount)||40,label:t("roomTileCount"),onChange:o=>s({...n,roomTileCount:o.target.value,roomUpdated:!0}),children:l})]}),e.jsx(U,{fullWidth:!0,children:e.jsxs(p,{children:[e.jsx(u,{i18nKey:"averageRolls"}),r]})})]})]})}function Nn({formData:n,setFormData:s}){const t=f.useCallback(()=>{s({...n,roomRealtime:!n.roomRealtime,roomUpdated:!0})},[n,s]);return e.jsxs(e.Fragment,{children:[e.jsx(p,{children:e.jsx(u,{i18nKey:"playerListOptions"})}),e.jsxs(te,{direction:"row",spacing:1,alignItems:"center",justifyContent:"center",sx:{width:"100%"},children:[e.jsx(p,{children:e.jsx(u,{i18nKey:"realtime"})}),e.jsx(W,{title:e.jsx(p,{variant:"subtitle2",children:e.jsx(u,{i18nKey:"realtimeTooltip"})}),arrow:!0,children:e.jsx(O,{sx:{fontSize:15}})}),e.jsx(F,{id:"showPrivate",checked:!!n.roomRealtime,onChange:t,inputProps:{"aria-label":en("playerList")}}),e.jsx(p,{children:e.jsx(u,{i18nKey:"delayed"})}),e.jsx(W,{title:e.jsx(p,{variant:"subtitle2",children:e.jsx(u,{i18nKey:"delayedTooltip"})}),arrow:!0,children:e.jsx(O,{sx:{fontSize:15}})})]})]})}let Pn=n=>crypto.getRandomValues(new Uint8Array(n)),Wn=(n,s,t)=>{let i=(2<<Math.log2(n.length-1))-1,r=-~(1.6*i*s/n.length);return(l=s)=>{let o="";for(;;){let a=t(r),c=r|0;for(;c--;)if(o+=n[a[c]&i]||"",o.length>=l)return o}}},En=(n,s=21)=>Wn(n,s|0,Pn);function Se({formData:n,setFormData:s}){var o;const{id:t}=Y(),{t:i}=M(),r=f.useCallback(a=>{let c;a.target.checked&&C(t)?c=En("123456789ABCDEFGHJKLMNPQRSTUVWXYZ",5)():a.target.checked&&!C(t)?c=t:c="PUBLIC",s({...n,room:c,gameMode:C(c)?"online":n.gameMode})},[t,n,s]),l=f.useCallback(a=>{s({...n,room:a.target.value,boardUpdated:!0})},[n,s]);return e.jsxs(e.Fragment,{children:[e.jsxs(te,{direction:"row",spacing:1,alignItems:"center",justifyContent:"center",sx:{width:"100%"},children:[e.jsx(p,{children:e.jsx(u,{i18nKey:"public"})}),e.jsx(F,{id:"showPrivate",checked:!C(n.room),onChange:r,inputProps:{"aria-label":i("room")}}),e.jsx(p,{children:e.jsx(u,{i18nKey:"private"})}),e.jsx(W,{title:e.jsx(p,{variant:"subtitle2",children:e.jsx(u,{i18nKey:"privateOptions"})}),arrow:!0,children:e.jsx(O,{sx:{fontSize:15}})})]}),!C(n.room)&&e.jsx(se,{fullWidth:!0,id:"privateRoom",label:"Private Room",defaultValue:(o=n.room)==null?void 0:o.toUpperCase(),margin:"normal",onBlur:l,onKeyDown:l})]})}function Gn({formData:n,setFormData:s}){const{t}=M(),i={app:t("appBackground"),custom:t("customURL")};return e.jsxs(y,{sx:{margin:"0.5rem"},children:[e.jsx(Se,{formData:n,setFormData:s}),!C(n.room)&&e.jsxs(e.Fragment,{children:[e.jsx(L,{sx:{my:1}}),e.jsx(Bn,{formData:n,setFormData:s}),e.jsx(L,{sx:{my:1}}),e.jsx(Nn,{formData:n,setFormData:s}),e.jsx(L,{sx:{my:1}}),e.jsx(ye,{formData:n,setFormData:s,backgrounds:i,isRoom:!0})]})]})}function zn(n){return Object.values(n).some(({level:s})=>s>0)}function Fn(n,s){return Object.entries(n).reduce((t,[i,r])=>{var l;return i in s&&((l=r==null?void 0:r.variation)!=null&&l.startsWith("append")?t.withAppend[i]=r:t.withoutAppend[i]=r),t},{withAppend:{},withoutAppend:{}})}function Vn(n){return Object.keys(n).length&&Object.values(n).some(({level:s})=>s>0)}function _n(n,s){const{withAppend:t,withoutAppend:i}=Fn(n,s);return zn(i)?C(n.room)&&!$(n.gameMode)?"privateRequired":null:Vn(t)?"appendWithAction":"pickSomething"}function re(){const{id:n}=Y(),s=Xe();return i=>{n.toUpperCase()!==(i==null?void 0:i.toUpperCase())&&s(`/${i||"PUBLIC"}`)}}function qn(n){(!n.roomBackgroundURL||!ln(n.roomBackgroundURL))&&(n.roomBackground="app")}function ve(){const{user:n,updateUser:s}=je(),{id:t}=Y(),{t:i}=M(),r=_(()=>pe()),l=An(),[o,a]=H("gameSettings"),c=_(fe),x=re(),{messages:h}=De(),d=g=>{const b=t.toUpperCase()!==g.room.toUpperCase(),S=g.room&&!C(g.room),m=S&&g.roomTileCount!==o.roomTileCount;return{roomChanged:b,isPrivateRoom:S,privateBoardSizeChanged:m}};async function j(g,b){const{displayName:S}=g,m=await dn(n,S,s);qn(g);const{settingsBoardUpdated:v,gameMode:A,newBoard:k}=await l(g),{roomChanged:G,isPrivateRoom:z,privateBoardSizeChanged:K}=d(g);z&&(g.roomUpdated||!h.find(I=>I.type==="room"))&&await un(g,m),(c==null?void 0:c.tiles)!==k&&await be({title:i("settingsGenerated"),tiles:k,isActive:1,gameMode:A}),(v||G||K)&&await pn({formData:g,user:m,customTiles:r,actionsList:b,title:"Settings Generated Board",tiles:k}),a({...g,boardUpdated:!1,roomUpdated:!1,gameMode:A}),x(g.room)}return(g,b)=>j(g,b)}function Jn({closeDialog:n}){const{user:s}=je(),{t}=M(),[i,r]=H("gameSettings"),[l,o]=f.useState(0),[a,c]=f.useState(null),[x,h]=f.useState(!1),[d,j]=ge(),g=re(),b=ve(),{isLoading:S,actionsList:m}=me(d==null?void 0:d.gameMode),v=(K,I)=>{o(I),g(d.room)},A=()=>r({...i,boardUpdated:!0});async function k(K){K.preventDefault();const{displayName:I,...Re}=d,le=_n(Re,m);return le?c(t(le)):(b(d,m),typeof n=="function"&&n(),null)}const G=f.useCallback(K=>{j(I=>({...I,displayName:K.target.value}))},[d]),z=f.useCallback(K=>{K.key==="Enter"&&(j(I=>({...I,displayName:K.target.value})),k(K))},[d,k]);return!d.room||S?e.jsxs(y,{children:[e.jsxs(p,{variant:"h2",children:[e.jsx(u,{i18nKey:"Loading"}),"..."]}),e.jsx(p,{variant:"body1",children:e.jsx(u,{i18nKey:"clearStorage"})})]}):e.jsxs(y,{component:"form",method:"post",onSubmit:k,className:"settings-box",children:[e.jsx(se,{fullWidth:!0,id:"displayName",label:t("displayName"),defaultValue:(s==null?void 0:s.displayName)||d.displayName||"",required:!0,autoFocus:!0,onBlur:G,onKeyDown:K=>z(K),margin:"normal"}),e.jsx(y,{sx:{borderBottom:1,borderColor:"divider"},children:e.jsxs(Ne,{value:l,onChange:v,"aria-label":"Game Settings",centered:!0,children:[e.jsx(X,{label:t("gameboard"),...Z(0)}),e.jsx(X,{label:t("room"),...Z(1)}),e.jsx(X,{label:t("application"),...Z(2)})]})}),e.jsx(D,{value:l,index:0,style:{p:0},children:e.jsx(In,{formData:d,setFormData:j,actionsList:m})}),e.jsx(D,{value:l,index:1,style:{p:0,pt:1},children:e.jsx(Gn,{formData:d,setFormData:j})}),e.jsx(D,{value:l,index:2,style:{p:0,pt:1},children:e.jsx(Mn,{formData:d,setFormData:j,boardUpdated:A})}),e.jsxs("div",{className:"flex-buttons",children:[e.jsx(T,{variant:"outlined",type:"button",onClick:()=>h(!0),children:e.jsx(u,{i18nKey:"customTiles",children:"Custom Tiles"})}),e.jsx(T,{variant:"contained",type:"submit",children:e.jsx(u,{i18nKey:"update"})})]}),!!x&&e.jsx(tn,{open:x,setOpen:h,boardUpdated:A,actionsList:m}),e.jsx(on,{open:!!a,setOpen:c,close:()=>c(null),children:a})]})}function Q({children:n,justifyContent:s="space-evenly"}){return e.jsx(y,{sx:{mt:3,display:"flex",flexDirection:"row",justifyContent:s,alignItems:"center"},children:n})}function Hn({formData:n,setFormData:s,nextStep:t}){const i=re();function r(){i(n.room),t(C(n.room)?2:1)}return e.jsxs(y,{sx:{m:1},children:[e.jsx(p,{variant:"h6",children:e.jsx(u,{i18nKey:"publicOrPrivate"})}),e.jsx(y,{sx:{margin:"0.5rem"},children:e.jsx(Se,{formData:n,setFormData:s})}),e.jsx(Q,{children:e.jsx(T,{variant:"contained",onClick:r,children:e.jsx(u,{i18nKey:C(n.room)?"nextSkip":"next"})})})]})}function Yn({formData:n,setFormData:s,nextStep:t,prevStep:i}){return e.jsxs(y,{children:[e.jsx(p,{variant:"h6",children:e.jsx(u,{i18nKey:"playingWithPeople"})}),e.jsx(q,{trueCondition:!$(n==null?void 0:n.gameMode),onChange:r=>s({...n,gameMode:r.target.checked?"local":"online",roomRealtime:!r.target.checked}),yesLabel:"yesInteracting",noLabel:"noInteracting"}),!$(n.gameMode)&&e.jsxs(e.Fragment,{children:[e.jsx(p,{variant:"h6",sx:{mt:2},children:e.jsx(u,{i18nKey:"yourRole"})}),e.jsx(y,{sx:{display:"flex",justifyContent:"center"},children:e.jsx(J,{value:n.role,onChange:r=>s({...n,role:r.target.value}),label:"mainRole",options:["dom","vers","sub"],defaultValue:"sub",fullWidth:!1})}),e.jsx(p,{variant:"h6",sx:{mt:1},children:e.jsx(u,{i18nKey:"areYouNaked"})}),e.jsx(p,{variant:"body2",sx:{mt:1},children:e.jsx(u,{i18nKey:"nakedDisclaimer"})}),e.jsx(q,{onChange:r=>s({...n,isNaked:r.target.checked}),trueCondition:n.isNaked,yesLabel:"yesNaked",noLabel:"noNaked"})]}),e.jsxs(Q,{children:[e.jsx(T,{onClick:i,children:e.jsx(u,{i18nKey:"previous"})}),e.jsx(T,{variant:"contained",onClick:t,children:e.jsx(u,{i18nKey:"next"})})]})]})}function Ce(){return e.jsxs(p,{variant:"h6",sx:{mt:2},children:[e.jsx(u,{i18nKey:"setIntensityLevel"}),e.jsx(W,{title:e.jsx(u,{i18nKey:"intensityTooltip"}),arrow:!0,sx:{ml:1},children:e.jsx(O,{fontSize:"15"})})]})}const Qn=(n,s)=>{const{gameMode:t,isNaked:i}=n,r=$(t);return r&&["foreplay","sex"].includes(s.type)||!r&&i&&["solo","foreplay"].includes(s.type)||!r&&!i&&["solo","sex"].includes(s.type)},Xn=n=>Object.entries(n).reduce((s,[t,i])=>(Qn(n,i)||(s[t]=i),s),{}),ke=(n,s,t)=>Object.entries(n).map(([i,r])=>{const l=s.find(o=>o.value===i);return r.type!==t||!l?null:i}).filter(i=>i),Zn=(n,s,t)=>{const i={...n};return Object.keys(i).forEach(r=>{i[r].type===s&&!t.includes(r)&&delete i[r]}),i},we=(n,s,t)=>{t(i=>{const r=Zn(i,s,n);return n.forEach(l=>{if(r[l])return;let o={type:s,level:1};s==="consumption"&&(o={...o,variation:r.isAppend?"appendMost":"standalone"}),r[l]=o}),r})},Ke=(n,s,t,i,r,l=null)=>{var a;const o=(a=n==null?void 0:n.target)==null?void 0:a.value;if(o===0)return r(c=>c.filter(x=>x!==s)),i(c=>{const x={...c};return delete x[s],x});i(c=>({...c,[s]:{...c[s],type:t,level:o,...!!l&&{variation:l}}}))};function Ae({onChange:n,values:s,options:t,label:i}){function r(l){var o;return(o=t==null?void 0:t.find(a=>a.value===l))==null?void 0:o.label}return e.jsxs(U,{fullWidth:!0,children:[e.jsx(N,{id:`${i}-label`,children:i}),e.jsx(P,{labelId:`${i}-label`,id:`${i}`,multiple:!0,value:s,onChange:n,fullWidth:!0,input:e.jsx(Ge,{label:e.jsx(u,{i18nKey:"actionsLabel"})}),renderValue:l=>e.jsx(y,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:l==null?void 0:l.map(o=>e.jsx(Ee,{label:r(o)},o))}),children:t==null?void 0:t.map(({label:l,value:o})=>e.jsxs(w,{value:o,children:[e.jsx(Pe,{checked:s.includes(o)}),e.jsx(We,{primary:l})]},o))})]})}const Dn=2;function es({formData:n,setFormData:s,options:t,actionsList:i}){const r="consumption",l=t(r),o=ke(n,l,r),[a,c]=f.useState(o),x=d=>{const{value:j}=d.target;j.length<=Dn&&(c(j),we(j,r,s))},h=(d,j)=>{const g=j.reduce((b,S)=>(b[S]={...b[S],type:r,variation:d.target.checked?"appendMost":"standalone"},b),{...n,isAppend:d.target.checked});s(g)};return e.jsxs(e.Fragment,{children:[e.jsx(p,{variant:"h6",sx:{my:2},children:e.jsx(u,{i18nKey:"pickConsumptions"})}),e.jsx(Ae,{onChange:x,values:a,options:l,label:e.jsx(u,{i18nKey:"consumables"})}),!!a.length&&e.jsxs(e.Fragment,{children:[e.jsx(Ce,{}),a.map(d=>e.jsx(ie,{actionsFolder:i,settings:n,option:d,initValue:1,onChange:j=>Ke(j,d,r,s,c,n.isAppend?"appendMost":"standalone")},d)),e.jsx(p,{variant:"h6",sx:{mt:2},children:e.jsx(u,{i18nKey:"standaloneOrCombine"})}),e.jsx(q,{trueCondition:n.isAppend,onChange:d=>h(d,a),yesLabel:"combineWithActions",noLabel:"standaloneConsumables"})]})]})}const ns=4,ss=n=>$(n==null?void 0:n.gameMode)?"solo":n.isNaked?"sex":"foreplay";function ts({formData:n,setFormData:s,options:t,actionsList:i}){const r=ss(n),l=t(r),o=ke(n,l,r),[a,c]=f.useState(o),x=h=>{const{value:d}=h.target;d.length<=ns&&(c(d),we(d,r,s))};return e.jsxs(e.Fragment,{children:[e.jsx(p,{variant:"h6",sx:{my:2},children:e.jsx(u,{i18nKey:"pickActions"})}),e.jsx(Ae,{onChange:x,values:a,options:l,label:e.jsx(u,{i18nKey:"actionsLabel"})}),!!a.length&&e.jsxs(e.Fragment,{children:[e.jsx(Ce,{}),a.map(h=>e.jsx(ie,{actionsFolder:i,settings:n,option:h,initValue:1,onChange:d=>Ke(d,h,r,s,c)},h))]})]})}function is({formData:n,setFormData:s,nextStep:t,prevStep:i,actionsList:r}){function l(c){return Object.keys(r).filter(x=>{var h;return((h=r[x])==null?void 0:h.type)===c})}f.useEffect(()=>{const c=Xn(n);s(c)},[]);const o=c=>l(c).map(x=>{var h;return{value:x,label:(h=r[x])==null?void 0:h.label}}),a=!Object.keys(n).some(c=>n[c].level>0&&n[c].variation!=="appendMost");return e.jsxs(y,{children:[e.jsx(p,{variant:"body",sx:{my:2},children:e.jsx(u,{i18nKey:"actionsDisclaimer"})}),e.jsx(ts,{formData:n,setFormData:s,options:o,actionsList:r}),e.jsx(es,{formData:n,setFormData:s,options:o,actionsList:r}),e.jsxs(Q,{children:[e.jsx(T,{onClick:()=>i(C(n.room)?2:1),children:e.jsx(u,{i18nKey:"previous"})}),e.jsx(T,{variant:"contained",disabled:a,onClick:t,children:e.jsx(u,{i18nKey:"next"})})]})]})}function rs({formData:n,setFormData:s,prevStep:t,actionsList:i,close:r}){const l=[100,100],o=[0,0],a=ae(n.finishRange,o),c=ve();function x(d){s({...n,finishRange:d.target.checked?o:l})}f.useEffect(()=>{let d={...n,boardUpdated:!0};(!a||!ae(n.finishRange,l))&&(d.finishRange=l),s(d)},[]);async function h(){await c(n,i),typeof r=="function"&&r()}return e.jsxs(y,{children:[e.jsx(p,{variant:"h6",sx:{my:2},children:e.jsx(u,{i18nKey:"WillYouOrgasm"})}),e.jsx(p,{variant:"body2",children:e.jsx(u,{i18nKey:"orgasmDisclaimer"})}),e.jsx(y,{sx:{display:"flex",justifyContent:"center",my:1},children:e.jsx(ue,{control:e.jsx(F,{checked:a||!1,onChange:x}),label:e.jsx(u,{i18nKey:a?"yesOrgasm":"noOrgasm"})})}),e.jsxs(Q,{children:[e.jsx(T,{onClick:t,children:e.jsx(u,{i18nKey:"previous"})}),e.jsx(T,{variant:"contained",onClick:h,children:e.jsx(u,{i18nKey:"buildGame"})})]})]})}function ls({close:n}){const{id:s}=Y(),[t,i]=f.useState(1),r={room:s};C(s)&&(r.gameMode="online",r.roomRealtime=!0);const[l,o]=ge({gameMode:"online",roomRealtime:!0,actions:[],consumption:[],role:"sub"},r),a=f.useRef(!0),{isLoading:c,actionsList:x}=me(l.gameMode);if(f.useEffect(()=>{if(a.current){if(a.current=!1,l.advancedSettings)return j();if(typeof n=="function"){if(C(s))return i(3);i(2)}}},[l]),c)return e.jsx(ze,{});const h=b=>{if(!Number.isInteger(b))return i(t+1);i(t+b)},d=b=>{if(!Number.isInteger(b))return i(t-1);i(t-b)},j=()=>i("advanced"),g=()=>{switch(t){case 1:return e.jsx(Hn,{formData:l,setFormData:o,nextStep:h});case 2:return e.jsx(Yn,{formData:l,setFormData:o,nextStep:h,prevStep:d});case 3:return e.jsx(is,{formData:l,setFormData:o,nextStep:h,prevStep:d,actionsList:x});case 4:return e.jsx(rs,{formData:l,setFormData:o,prevStep:d,actionsList:x,close:n});default:return null}};return t==="advanced"?e.jsx(Jn,{closeDialog:n}):e.jsxs(y,{children:[e.jsx(y,{sx:{width:"100%",mt:2,mb:4},children:e.jsx(Fe,{activeStep:t-1,alternativeLabel:!0,children:[1,2,3,4].map(b=>e.jsx(Ve,{children:e.jsx(_e,{})},b))})}),g(),e.jsx(L,{sx:{mt:3}}),e.jsx(T,{onClick:j,children:e.jsx(u,{i18nKey:"advancedSetup"})})]})}function os({open:n,close:s=null}){const t=xe(),[i]=Ze();return i.get("importBoard")?null:e.jsxs(qe,{fullScreen:t,open:n,maxWidth:"md",children:[e.jsxs(Je,{children:[e.jsx(u,{i18nKey:"gameSettings"}),typeof s=="function"&&e.jsx(Qe,{close:s})]}),e.jsx(He,{children:e.jsx(ls,{close:s})})]})}const fs=Object.freeze(Object.defineProperty({__proto__:null,default:os},Symbol.toStringTag,{value:"Module"}));export{Jn as G,D as T,pn as a,os as b,fs as i,un as s,An as u};
