import{j as e,f,ax as $,ay as N,az as P,g as te,R as w,i as ce,U as xe,V as z,h as g,D as O,G as K,aA as T,ar as Re,as as Le,aB as Oe,au as Te,aC as Ue,aD as $e,aE as Be,l as E,aF as ie,a1 as Ie,x as Ne,y as X,B as U,aG as Pe,aH as Ee,aa as We,aI as Ge,aJ as ze,a2 as Fe,aK as Ve,aL as qe,aM as _e,o as He,q as Je,p as Ye}from"./mui-7PmIKoQ0.js";import{a as H,u as Qe,C as Xe}from"./index-C880uJyK.js";import{r as b,u as J,l as Ze,k as De}from"./vendor-poSPCy8P.js";import{d as M,i as C,a as en,b as Z}from"./strings-J-FU9DP5.js";import{i as V,u as R,T as h,t as F}from"./translations-C_O5cPfK.js";import{s as he,w as nn,i as sn,g as je,j as pe,c as ge,l as tn,u as me}from"./index-BPTilIU-.js";import{u as se}from"./index-Duivgnbj.js";import{a as ln,i as rn}from"./urls-BP4ggioV.js";import{T as on}from"./index-Bv96QVkX.js";import{u as be,a as ye,C as cn}from"./useActionList-D1Ujy-u0.js";function an(n){const{t:s}=V;let t=`### ${s("roomSettings")}\r
`;return Object.entries(n).forEach(([i,r])=>{if(i!=="room"){if(i==="roomBackgroundURL"&&r!==""){t+=`* ${s(i)}: [${ln(r)}:link:](${r})\r
`;return}if(i==="roomRealtime"){t+=`* ${s("playerList")}: ${s(r?"delayed":"realtime")}\r
`;return}r!==""&&(t+=`* ${s(i)}: ${r}\r
`)}}),t}function dn(n){const s={};return Object.entries(n).forEach(([t,i])=>{t.startsWith("room")&&!["roomUpdated","roomBackground"].some(r=>r===t)&&(s[t]=i)}),s}async function un(n,s,t){let i=n;return s!==void 0&&s.length>0&&(i=await t(s)),i}function xn(n,s){const t=dn(n);return he({room:n.room,user:s,text:an(t),type:"room",settings:JSON.stringify(t)})}function hn(n,s,t){const i=Object.entries(t).filter(([l])=>n[l]).reduce((l,[o,c])=>(l[o]=Object.keys(c.actions).slice(1,n[o]+1),l),{});return((s==null?void 0:s.filter(l=>{if(l.group==="misc")return!0;const o=i[l.group];return o&&o.length>=Number(l.intensity)}))||[]).length}function jn(n,s,t,i){const{t:r}=V;let l=`### ${V.t("gameSettings")}\r
`;if(i&&(l+=`##### ${i}\r
`),l+=`--- \r
`,Object.entries(t).forEach(([d,x])=>{if(!n[d])return;const{role:u,variation:j,level:p}=n[d],y=u||n.role||"sub";if(p>0){const S=Object.keys((x==null?void 0:x.actions)||{});if(l+=`* ${x==null?void 0:x.label}: ${S[p]||""}`,j&&(l+=` (${r(j)})`),!M(n.gameMode)&&!j){const m=x[y]??r(y);l+=` (${m})`}l+=`\r
`}}),l.endsWith(`--- \r
`))return"";const{finishRange:o,difficulty:c}=n;l+=`--- \r
`,l+=`* ${r("difficulty")}: ${r(c??"normal")} \r
`,o&&(l+=`* ${r("finishSlider")} ${o[0]}%  | ${o[1]-o[0]}% | ${100-o[1]}%`);const a=hn(n,s,t);return a&&(l+=`* ${r("customTilesLabel")}: ${a} \r
`),l}function pn(n){const s={};return Object.entries(n).forEach(([t,i])=>{!["displayName","background","boardUpdated","chatSound","mySound","otherSound","othersDialog","playerDialog","readRoll","hideBoardActions","advancedSettings"].includes(t)&&!t.startsWith("room")&&(s[t]=i)}),s}async function gn({title:n,formData:s,user:t,actionsList:i,tiles:r,customTiles:l=[],reason:o=""}){const c=JSON.stringify(pn(s)),a=await nn({title:n,gameBoard:JSON.stringify(r),settings:c}),d=jn(s,l,i,o);if(!(!(a!=null&&a.id)||d===""))return he({room:(s==null?void 0:s.room)||"PUBLIC",user:t,text:d,type:"settings",gameBoardId:a.id,boardSize:r.length,gameMode:s.gameMode})}function mn(n){for(let s=n.length-1;s>0;s-=1){const t=Math.floor(Math.random()*(s+1));[n[s],n[t]]=[n[t],n[s]]}return n}function ae(n){n.length>1&&n.push(n.shift())}function de(n,s){return(n==null?void 0:n.length)!==(s==null?void 0:s.length)?!1:n.every((t,i)=>t===s[i])}const{t:W}=V;function bn(n,s){return n.filter(t=>s==="vers"?t.includes("{sub}")&&t.includes("{dom}")||t.includes("{player}"):!t.match(/{(dom|sub)}/)||t.includes(`{${s}}`))}function yn(n,s,t){var l;const i=((l=n[s])==null?void 0:l.role)??n.role??"sub";return Object.keys(t).reduce((o,c,a)=>{var d;return a>0&&a<=((d=n[s])==null?void 0:d.level)&&(o[c]=mn(bn(t[c],i))),o},{})}function fn(n,s){return Object.entries(n).filter(([t])=>{var i;return((i=s[t])==null?void 0:i.level)>0}).map(([t,i])=>{var r;return{label:i.label,actions:yn(s,t,i==null?void 0:i.actions),key:t,standalone:!1,role:((r=s[t])==null?void 0:r.role)??s.role??"sub"}})}function Sn(n,s){return s.length&&(s.some(({group:t})=>t==="misc")&&n.push({label:W("misc"),actions:{All:[]},key:"misc",standalone:!1}),s.forEach(({group:t,intensity:i,action:r})=>{const l=n.find(o=>o.key===t);if(l&&Object.keys(l.actions).length>=i){const o=Object.values(l.actions)[i-1];if(o){const c=Math.floor(Math.random()*(o.length+1));o.splice(c,0,r)}}})),n}function vn(n){return Object.entries(n).reduce((s,[t,i])=>(i!=null&&i.variation&&(s[t]=i),s),{})}function Cn(n,s){const t=[],i=[...s];return Object.entries(n).forEach(([r,{level:l,variation:o}])=>{if(l<=0)return;const c=s.findIndex(d=>d.key===r);if(c===-1)return;if(o==="standalone"){i[c].standalone=!0;return}const a=o==="appendSome"?.4:.9;t.push({...s[c],frequency:a}),i.splice(c,1)}),{appendList:t,listWithoutAppend:i}}function kn(n,s,t,i){if([void 0,"normal"].includes(i)){const r=n/s;return Math.floor(t/r)}return s>=3&&Math.random()>=.6?s-2:s-1}function ue(n,s,t,i){ae(n);const{actions:r,label:l,standalone:o,frequency:c,role:a}=n[0],d=Math.random();if(c&&c<=d)return{title:"",description:""};const x=Object.keys(r),u=Object.values(r);let j=kn(s,x.length,t,i==null?void 0:i.difficulty);return u[j]||(j=Math.max(0,j-1)),u[j]&&u[j].length>0?(ae(u[j]),{title:l,description:u[j][0],standalone:o,role:a}):{title:"",description:""}}function wn(n,s,t){const i=vn(s),{listWithoutAppend:r,appendList:l}=Cn(i,n),o=[];for(let c=1;c<=t;c+=1){const{title:a,description:d,standalone:x,role:u}=ue(r,t,c,s);let j="";if(!x&&l.length&&d){const{description:p}=ue(l,t,c,s);p?j=`${p.trim().replace(/([^.,!?])$/,"$1.")} ${d}`:j=d}else j=d||"";o.push({title:a,description:j.trim(),role:u})}return o}function An(n,s){const t={title:W("start"),description:W("start")},{finishRange:i=[33,66]}=s,r=`${W("noCum")} ${i[0]}%\r
${W("ruined")} ${i[1]-i[0]}%\r
${W("cum")} ${100-i[1]}%`,l={title:W("finish"),description:r};return[t,...n,l]}function Kn(n,s,t=[],i=40){const r=Object.entries(s).reduce((a,[d,x])=>(a[d]={...x,actions:Object.keys(x.actions||{}).reduce((u,j)=>(u[j]=[],u),{})},a),{}),l=fn(r,n);!l.length&&!t.length&&(localStorage.clear(),window.location.reload());const o=Sn(l,t),c=wn(o,n,i-2);return An(c,n)}function Mn(){const n=se(ge),[s,t]=H("gameSettings"),{i18n:i}=R(),r=b.useCallback(async l=>{var v;const o=l!=null&&l.roomUpdate||l!=null&&l.boardUpdated?l:{...s,...l};let{gameMode:c,boardUpdated:a}=o;const{roomTileCount:d=40,finishRange:x,room:u}=o,j=C(u||"");if(!l||!x)return{gameMode:c};j&&!M(c||"")&&(c="online",a=!0);const p=await sn(i.resolvedLanguage,c||"online"),y=j?40:d||40,S=await je(c||"online"),m=Kn(o,p,S,y);return(l!=null&&l.boardUpdated||a||((v=n==null?void 0:n.tiles)==null?void 0:v.length)!==m.length)&&(await t(o),await pe({title:(n==null?void 0:n.title)||"",tiles:m})),{settingsBoardUpdated:a,gameMode:c,newBoard:m}},[n,i.resolvedLanguage,s,t]);return b.useCallback(l=>r(l),[r])}function D({children:n,value:s,index:t,style:i,...r}){return e.jsx("div",{role:"tabpanel",hidden:s!==t,id:`simple-tabpanel-${t}`,"aria-labelledby":`simple-tab-${t}`,...r,children:s===t&&e.jsx(f,{sx:{p:3,...i},children:n})})}function fe({formData:n,setFormData:s,backgrounds:t,isRoom:i=!1}){const{t:r}=R(),l=i?"roomBackground":"background",o=i?"roomBackgroundURL":"backgroundURL",[c,a]=b.useState((n==null?void 0:n[l])||Object.keys(t)[0]),d=()=>Object.entries(t).map(([j,p])=>e.jsx(w,{value:j,children:p},j)),x=j=>{s({...n,[l]:j.target.value}),a(j.target.value)};b.useEffect(()=>{c!==(n==null?void 0:n[l])&&a((n==null?void 0:n[l])||"")},[n,c,l]);const u=j=>{const p={...n,[l]:"custom",[o]:j.target.value};i&&(p.roomUpdated=!0),s(p)};return e.jsxs(e.Fragment,{children:[e.jsxs($,{fullWidth:!0,margin:"normal",children:[e.jsx(N,{id:"background-label",children:r("background")}),e.jsx(P,{labelId:"background-label",id:"background",label:r("background"),value:c||"",onChange:x,children:d()})]}),c==="custom"&&e.jsx(te,{sx:{mt:2},label:r("url"),value:(n==null?void 0:n[o])||"",fullWidth:!0,onChange:u,helperText:e.jsxs(e.Fragment,{children:[r("supportedSites"),e.jsx("br",{}),r("requiresEmbeddedUrl")]})})]})}function Rn({boardUpdated:n}){const{i18n:s}=R(),[t,i]=b.useState(s.resolvedLanguage||"en");function r(o){i(o),s.changeLanguage(o),n()}const l=Object.entries(tn).map(([o,c])=>e.jsx(w,{value:o,children:c.label},o));return e.jsx(f,{sx:{minWidth:120,mt:1,mb:2},children:e.jsxs($,{fullWidth:!0,children:[e.jsxs(N,{id:"language-label",sx:{display:"flex",alignItems:"center"},children:[e.jsx(ce,{sx:{mr:1}}),e.jsx(h,{i18nKey:"language"})]}),e.jsx(P,{labelId:"language-label",id:"language-select",value:t,label:e.jsxs(e.Fragment,{children:[e.jsx(ce,{}),e.jsx(h,{i18nKey:"language"})]}),onChange:o=>r(o.target.value),children:l})]})})}function q({trueCondition:n,onChange:s,yesLabel:t,noLabel:i=null,sx:r={}}){const l=i??t;return e.jsx(f,{sx:{display:"flex",justifyContent:"center",my:1,...r},children:e.jsx(xe,{control:e.jsx(z,{checked:n||!1,onChange:s}),label:F(n?t:l)})})}function I({field:n,formData:s,handleSwitch:t}){return e.jsx(q,{trueCondition:s[n],onChange:i=>t(i,n),yesLabel:`${n}Enable`,sx:{justifyContent:"left"}})}function Ln({formData:n,setFormData:s,boardUpdated:t}){const[i,r]=H("gameSettings"),{t:l}=R(),o={color:l("color"),gray:l("gray"),"metronome.gif":l("hypnoDick"),"pink-spiral.gif":l("pinkSpiral"),custom:l("customURL")};function c(a,d){s({...n,[d]:a.target.checked}),r({...i,[d]:a.target.checked})}return e.jsxs(e.Fragment,{children:[e.jsx(Rn,{boardUpdated:t}),e.jsx(g,{variant:"h5",children:e.jsx(h,{i18nKey:"dialog"})}),e.jsx(I,{field:"playerDialog",formData:n,handleSwitch:c}),e.jsx(I,{field:"othersDialog",formData:n,handleSwitch:c}),e.jsx(O,{}),e.jsx(g,{variant:"h5",sx:{mt:2},children:e.jsx(h,{i18nKey:"sounds"})}),e.jsx(I,{field:"mySound",formData:n,handleSwitch:c}),e.jsx(I,{field:"otherSound",formData:n,handleSwitch:c}),e.jsx(I,{field:"chatSound",formData:n,handleSwitch:c}),e.jsx(I,{field:"readRoll",formData:n,handleSwitch:c}),e.jsx(O,{}),e.jsx(g,{variant:"h5",sx:{mt:2,textTransform:"capitalize"},children:e.jsx(h,{i18nKey:"misc"})}),e.jsx(I,{field:"hideBoardActions",formData:n,handleSwitch:c}),e.jsx(I,{field:"advancedSettings",formData:n,handleSwitch:c}),e.jsx(fe,{formData:n,setFormData:s,backgrounds:o}),e.jsx(O,{})]})}function ee({children:n}){return e.jsx(K,{size:{xs:12,md:5},children:n})}const _=b.forwardRef(({value:n,onChange:s,label:t,options:i,defaultValue:r=null,sx:l,helpIcon:o=!1,fullWidth:c=!0,...a},d)=>{const x=i.map(u=>typeof u=="string"?e.jsx(w,{value:u,children:F(u)},u):e.jsx(w,{value:u.value,children:u.label},u.value));return e.jsxs($,{fullWidth:c,margin:"normal",sx:l,...a,ref:d,children:[e.jsxs(N,{id:`${t}Label`,children:[e.jsx(h,{i18nKey:t}),!!o&&e.jsx(T,{sx:{ml:1,fontSize:16}})]}),e.jsx(P,{labelId:`${t}Label`,id:t,label:e.jsxs(e.Fragment,{children:[e.jsx(h,{i18nKey:t}),!!o&&e.jsx(T,{sx:{ml:1,fontSize:16}})]}),value:n||r||"",onChange:s,children:x})]})});function ne({children:n,title:s,subtitle:t,defaultExpanded:i=!1,...r}){return e.jsxs(Re,{defaultExpanded:i,...r,sx:{backgroundColor:"inherit",backgroundImage:"none",boxShadow:"none"},children:[e.jsxs(Le,{expandIcon:e.jsx(Oe,{}),sx:{px:0},children:[e.jsxs(g,{variant:"h6",sx:{width:"33%"},children:[s,":"]}),e.jsx(g,{sx:{pt:.5},children:t})]}),e.jsx(Te,{sx:{px:0},children:e.jsx(K,{container:!0,columnSpacing:2,justifyContent:"space-evenly",className:"columned-grid",children:n})})]})}function On({formData:n,setFormData:s}){const t=(r,l)=>{s({...n,finishRange:l,boardUpdated:!0})},i=(n==null?void 0:n.finishRange)||[30,70];return e.jsxs(f,{children:[e.jsx(O,{}),e.jsx(g,{id:"finish-slider",sx:{my:1},children:e.jsx(h,{i18nKey:"finishSlider"})}),e.jsx(Ue,{"aria-labelledby":"finish-slider",value:i,onChange:t,valueLabelDisplay:"off"}),e.jsxs(f,{display:"flex",flexDirection:"column",justifyContent:"space-between",textAlign:"center",children:[e.jsxs(g,{whiteSpace:"nowrap",children:[e.jsx(h,{i18nKey:"noCum"})," ",i[0],"%"]}),e.jsxs(g,{whiteSpace:"nowrap",children:[e.jsx(h,{i18nKey:"ruined"})," ",i[1]-i[0],"%"]}),e.jsxs(g,{whiteSpace:"nowrap",children:[e.jsx(h,{i18nKey:"cum"})," ",100-i[1],"%"]})]}),e.jsx(O,{sx:{my:1}})]})}function Tn(){const[n,s]=b.useState(!1);return b.useEffect(()=>{const t=window.matchMedia("(pointer: fine)");s(t.matches);const i=r=>{s(r.matches)};return t.addEventListener("change",i),()=>{t.removeEventListener("change",i)}},[]),n}function le({actionsFolder:n,settings:s,option:t,onChange:i,initValue:r=0}){var p,y,S;const l=`${t}label`,o=(p=n[t])==null?void 0:p.label,c=Tn(),[a,d]=b.useState(((y=s[t])==null?void 0:y.level)||0),x=m=>{d(m)},u=m=>a>0&&m===0?!1:s.difficulty==="accelerated"?a<=2?a===m:a===m||a-1===m:a>=m;function j(m){var v;return Object.keys(((v=n[m])==null?void 0:v.actions)||{}).map((A,k)=>e.jsxs(w,{value:k,onMouseOver:()=>x(k),children:[!!c&&e.jsx("span",{className:"menu-item-icon",children:u(k)?e.jsx($e,{}):e.jsx(Be,{})}),A]},`${m}-${A}`))}return e.jsxs($,{margin:"normal",fullWidth:!0,children:[e.jsx(N,{id:l,children:o}),e.jsx(P,{labelId:l,id:t,label:o,value:((S=s[t])==null?void 0:S.level)||r,onChange:i,onOpen:()=>{var m;return d(((m=s[t])==null?void 0:m.level)||r)},onClose:()=>{var m;return d(((m=s[t])==null?void 0:m.level)||r)},children:j(t)})]})}function Un({option:n,settings:s,setSettings:t,actionsFolder:i,type:r,showVariation:l=!1,showRole:o=!1}){var p,y,S,m;const{t:c}=R(),a=`${n}label`,d=(p=i[n])==null?void 0:p.label;function x(v,A,k){var G;t({...s,[A]:{...s[A],type:r,[k]:(G=v==null?void 0:v.target)==null?void 0:G.value},boardUpdated:!0})}let u=12;(l||o)&&(u=6);let j=["dom","vers","sub"];return(y=i[n])!=null&&y.dom&&(j=[{label:i[n].dom,value:"dom"},{label:c("vers"),value:"vers"},{label:i[n].sub,value:"sub"}]),e.jsxs(K,{container:!0,justifyContent:"center",children:[e.jsx(K,{size:u,children:e.jsx(le,{actionsFolder:i,settings:s,option:n,onChange:v=>x(v,n,"level")})}),!!o&&e.jsx(K,{size:6,children:e.jsx(_,{sx:{ml:1},value:(S=s[n])==null?void 0:S.role,onChange:v=>x(v,n,"role"),label:`${c("role")}: ${d}`,options:j,defaultValue:s.role||"sub"})}),!!l&&e.jsx(K,{size:6,children:e.jsx(E,{placement:"top",title:e.jsxs(h,{i18nKey:"variationTooltip",children:[e.jsx(g,{variant:"subtitle2",children:"Standalone = Its own tile. "}),e.jsx(g,{variant:"subtitle2",children:"Append Some = 50% chance."}),e.jsx(g,{variant:"subtitle2",children:"Append Most = 90% chance."})]}),arrow:!0,children:e.jsxs($,{fullWidth:!0,margin:"normal",sx:{ml:1},children:[e.jsxs(N,{id:`${a}Variation`,children:[`${d} ${c("variation")}`,e.jsx(T,{sx:{ml:1,fontSize:16}})]}),e.jsxs(P,{labelId:`${a}Variation`,id:`${n}Variation`,label:e.jsxs(e.Fragment,{children:[d," ",c("variation"),e.jsx(T,{sx:{ml:1,fontSize:16}})]}),value:((m=s[n])==null?void 0:m.variation)||"standalone",onChange:v=>x(v,n,"variation"),children:[e.jsx(w,{value:"standalone",children:e.jsx(h,{i18nKey:"standalone"})}),e.jsx(w,{value:"appendSome",children:e.jsx(h,{i18nKey:"appendSome"})}),e.jsx(w,{value:"appendMost",children:e.jsx(h,{i18nKey:"appendMost"})})]})]})})})]},n)}function $n({formData:n,setFormData:s}){return e.jsxs(ie,{direction:"row",spacing:1,alignItems:"center",justifyContent:"center",sx:{mt:1},children:[e.jsx(g,{children:e.jsx(h,{i18nKey:"solo"})}),e.jsx(E,{title:e.jsx(g,{variant:"subtitle2",children:e.jsx(h,{i18nKey:"soloTooltip"})}),arrow:!0,children:e.jsx(T,{sx:{fontSize:15}})}),e.jsx(z,{id:"gameMode",checked:!M(n.gameMode),onChange:t=>s({...n,gameMode:t.target.checked?"local":"online",boardUpdated:!0}),inputProps:{"aria-label":"Game Type"}}),e.jsx(g,{children:e.jsx(h,{i18nKey:"local"})}),e.jsx(E,{title:e.jsx(g,{variant:"subtitle2",children:e.jsx(h,{i18nKey:"localTooltip"})}),arrow:!0,children:e.jsx(T,{sx:{fontSize:15}})})]})}function Bn({formData:n}){const[s,t]=b.useState(!1);return b.useEffect(()=>{const i=Object.values(n).filter(l=>typeof l=="object"&&(l==null?void 0:l.type)==="consumption"&&(l==null?void 0:l.level)>0).length,r=Object.values(n).filter(l=>typeof l=="object"&&(l==null?void 0:l.level)>0).length;t(i>1&&i>=r-i)},[n]),s?e.jsx(Ie,{severity:"warning",children:e.jsx(h,{i18nKey:"consumptionWarning"})}):null}function In({formData:n,setFormData:s,actionsList:t}){const{t:i}=R(),r=!C(n==null?void 0:n.room)&&!M(n.gameMode);function l(c,a={}){return Object.keys(t).filter(d=>{var x;return((x=t[d])==null?void 0:x.type)===c}).map(d=>e.jsx(ee,{children:e.jsx(Un,{option:d,settings:n,setSettings:s,actionsFolder:t,type:c,...a})},d))}const o=c=>{const a=JSON.parse(JSON.stringify(n));return Object.keys(a).forEach(d=>{a.role=c,d.includes("role")&&(a[d]=c)}),a};return e.jsxs(e.Fragment,{children:[e.jsx($n,{formData:n,setFormData:s}),C(n==null?void 0:n.room)&&!M(n.gameMode)&&e.jsx(K,{container:!0,alignContent:"center",justifyContent:"space-evenly",children:e.jsx(K,{sx:{py:3},children:e.jsx(g,{variant:"h5",children:e.jsx(h,{i18nKey:"privateRequired"})})})}),e.jsxs(K,{container:!0,columnSpacing:2,justifyContent:"space-evenly",children:[e.jsx(ee,{children:e.jsx(E,{placement:"top",title:e.jsx(h,{i18nKey:"difficultyTooltip",children:e.jsxs(g,{variant:"body2",children:["Normal = Slow ramp up. ",e.jsx("br",{}),e.jsx("br",{}),"Accelerated = Straight to max level + the level prior to it."]})}),arrow:!0,children:e.jsx(_,{value:n.difficulty,onChange:c=>s({...n,difficulty:c.target.value,boardUpdated:!0}),label:"difficulty",options:["normal","accelerated"],defaultValue:"normal",helpIcon:!0})})}),r&&e.jsx(ee,{children:e.jsx(_,{value:n.role,onChange:c=>s({...o(c.target.value),boardUpdated:!0}),label:"mainRole",options:["dom","vers","sub"],defaultValue:"sub"})})]}),r?e.jsxs(e.Fragment,{children:[e.jsx(ne,{title:i("consumption"),subtitle:i("consumptionSubtitle"),children:l("consumption",{showVariation:!0})}),e.jsx(ne,{title:i("foreplay"),subtitle:i("foreplaySubtitle"),children:l("foreplay",{showRole:r})}),e.jsx(ne,{title:i("sex"),subtitle:i("sexSubtitle"),children:l("sex",{showRole:r})})]}):e.jsxs(e.Fragment,{children:[e.jsx(K,{container:!0,columnSpacing:2,justifyContent:"space-evenly",children:l("consumption",{showVariation:!0})}),e.jsx(O,{}),e.jsx(K,{container:!0,columnSpacing:2,justifyContent:"center",children:l("solo")})]}),e.jsx(On,{setFormData:s,formData:n}),e.jsx(Bn,{formData:n})]})}function Nn({formData:n,setFormData:s}){const{t}=R(),i={"1d4":2.5,"1d6":3.5,"2d4":5},r=n!=null&&n.roomTileCount?Math.floor(n.roomTileCount/i[n.roomDice||"1d6"]):16,l=Array.from({length:7},(o,c)=>(c+2)*10).map(o=>e.jsx(w,{value:o,children:o},o));return e.jsxs(e.Fragment,{children:[e.jsx(g,{children:e.jsx(h,{i18nKey:"gameSpeed"})}),e.jsxs(f,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[e.jsxs($,{sx:{m:1},fullWidth:!0,children:[e.jsx(N,{id:"diceRole-label",children:e.jsx(h,{i18nKey:"roomDice"})}),e.jsxs(P,{labelId:"diceRole-label",id:"diceRole-select",value:(n==null?void 0:n.roomDice)||"1d4",label:t("roomDice"),onChange:o=>s({...n,roomDice:o.target.value,roomUpdated:!0}),children:[e.jsx(w,{value:"1d4",children:"1d4"}),e.jsx(w,{value:"1d6",children:"1d6"}),e.jsx(w,{value:"2d4",children:"2d4"})]})]}),e.jsxs($,{sx:{m:1},fullWidth:!0,children:[e.jsx(N,{id:"tile-count-label",children:e.jsx(h,{i18nKey:"roomTileCount"})}),e.jsx(P,{labelId:"tile-count-label",id:"tile-count-select",value:String((n==null?void 0:n.roomTileCount)||40),label:t("roomTileCount"),onChange:o=>s({...n,roomTileCount:Number(o.target.value),roomUpdated:!0}),children:l})]}),e.jsx($,{fullWidth:!0,children:e.jsxs(g,{children:[e.jsx(h,{i18nKey:"averageRolls"}),r]})})]})]})}function Pn({formData:n,setFormData:s}){const t=b.useCallback(()=>{s({...n,roomRealtime:!n.roomRealtime,roomUpdated:!0})},[n,s]);return e.jsxs(e.Fragment,{children:[e.jsx(g,{children:e.jsx(h,{i18nKey:"playerListOptions"})}),e.jsxs(ie,{direction:"row",spacing:1,alignItems:"center",justifyContent:"center",sx:{width:"100%"},children:[e.jsx(g,{children:e.jsx(h,{i18nKey:"realtime"})}),e.jsx(E,{title:e.jsx(g,{variant:"subtitle2",children:e.jsx(h,{i18nKey:"realtimeTooltip"})}),arrow:!0,children:e.jsx(T,{sx:{fontSize:15}})}),e.jsx(z,{id:"showPrivate",checked:!!n.roomRealtime,onChange:t,inputProps:{"aria-label":F("playerList")}}),e.jsx(g,{children:e.jsx(h,{i18nKey:"delayed"})}),e.jsx(E,{title:e.jsx(g,{variant:"subtitle2",children:e.jsx(h,{i18nKey:"delayedTooltip"})}),arrow:!0,children:e.jsx(T,{sx:{fontSize:15}})})]})]})}let En=n=>crypto.getRandomValues(new Uint8Array(n)),Wn=(n,s,t)=>{let i=(2<<Math.log2(n.length-1))-1,r=-~(1.6*i*s/n.length);return(l=s)=>{let o="";for(;;){let c=t(r),a=r|0;for(;a--;)if(o+=n[c[a]&i]||"",o.length>=l)return o}}},Gn=(n,s=21)=>Wn(n,s|0,En);function Se({formData:n,setFormData:s}){var a;const{id:t}=J(),{t:i}=R(),r=d=>{let x;d.target.checked&&C(t)?x=Gn("123456789ABCDEFGHJKLMNPQRSTUVWXYZ",5)():t&&d.target.checked&&!C(t)?x=t:x="PUBLIC",s({...n,room:x,gameMode:C(x)?"online":n.gameMode})},l=b.useCallback(d=>{s({...n,room:d.currentTarget.value,boardUpdated:!0})},[n,s]),o=b.useCallback(d=>{d.key==="Enter"&&s({...n,room:d.currentTarget.value,boardUpdated:!0})},[n,s]),c=!C(n.room);return e.jsxs(e.Fragment,{children:[e.jsxs(ie,{direction:"row",spacing:1,alignItems:"center",justifyContent:"center",sx:{width:"100%"},children:[e.jsx(g,{children:e.jsx(h,{i18nKey:"public"})}),e.jsx(z,{id:"showPrivate",checked:c,onChange:r,slotProps:{input:{"aria-label":i("room")}}}),e.jsx(g,{children:e.jsx(h,{i18nKey:"private"})}),e.jsx(E,{title:e.jsx(g,{variant:"subtitle2",children:e.jsx(h,{i18nKey:"privateOptions"})}),arrow:!0,children:e.jsx(T,{sx:{fontSize:15}})})]}),c&&e.jsx(te,{fullWidth:!0,id:"privateRoom",label:"Private Room",defaultValue:(a=n.room)==null?void 0:a.toUpperCase(),margin:"normal",onBlur:l,onKeyDown:o})]})}function zn({formData:n,setFormData:s}){const{t}=R(),i={app:t("appBackground"),custom:t("customURL")};return e.jsxs(f,{sx:{margin:"0.5rem"},children:[e.jsx(Se,{formData:n,setFormData:s}),!C(n.room)&&e.jsxs(e.Fragment,{children:[e.jsx(O,{sx:{my:1}}),e.jsx(Nn,{formData:n,setFormData:s}),e.jsx(O,{sx:{my:1}}),e.jsx(Pn,{formData:n,setFormData:s}),e.jsx(O,{sx:{my:1}}),e.jsx(fe,{formData:n,setFormData:s,backgrounds:i,isRoom:!0})]})]})}function Fn(n){return Object.values(n).some(({level:s})=>s>0)}function Vn(n,s){return Object.entries(n).reduce((t,[i,r])=>{var l;return i in s&&((l=r==null?void 0:r.variation)!=null&&l.startsWith("append")?t.withAppend[i]=r:t.withoutAppend[i]=r),t},{withAppend:{},withoutAppend:{}})}function qn(n){return Object.keys(n).length>0&&Object.values(n).some(({level:s})=>s>0)}function _n(n,s){const{withAppend:t,withoutAppend:i}=Vn(n,s);return Fn(i)?C(n.room)&&!M(n.gameMode)?"privateRequired":null:qn(t)?"appendWithAction":"pickSomething"}function re(){const{id:n}=J(),s=Ze();return i=>{(n==null?void 0:n.toUpperCase())!==(i==null?void 0:i.toUpperCase())&&s(`/${i||"PUBLIC"}`)}}function Hn(n){(!n.roomBackgroundURL||!rn(n.roomBackgroundURL))&&(n.roomBackground="app")}function ve(){const{user:n,updateUser:s}=me(),{id:t}=J(),{t:i}=R(),r=Mn(),[l,o]=H("gameSettings"),c=se(()=>je(l==null?void 0:l.gameMode)),a=se(ge),d=re(),{messages:x}=en(),u=b.useCallback(p=>{const y=(t==null?void 0:t.toUpperCase())!==p.room.toUpperCase(),S=!!(p.room&&!C(p.room)),m=S&&p.roomTileCount!==(l==null?void 0:l.roomTileCount);return{roomChanged:y,isPrivateRoom:S,privateBoardSizeChanged:m}},[t,l==null?void 0:l.roomTileCount]),j=b.useCallback(async(p,y)=>{const{displayName:S}=p,m=await un(n,S,s);Hn(p);const{settingsBoardUpdated:v,gameMode:A,newBoard:k=[]}=await r(p),{roomChanged:G,isPrivateRoom:Q,privateBoardSizeChanged:L}=u(p);m&&(Q&&(p.roomUpdated||!x.find(B=>B.type==="room"))&&await xn(p,m),(a==null?void 0:a.tiles)!==k&&await pe({title:i("settingsGenerated"),tiles:k,isActive:1,gameMode:A}),(v||G||L)&&await gn({formData:p,user:m,customTiles:c,actionsList:y,title:"Settings Generated Board",tiles:k}),o({...p,boardUpdated:!1,roomUpdated:!1,gameMode:A}),d(p.room))},[n,s,r,u,x,a,i,c,o,d]);return b.useCallback((p,y)=>j(p,y),[j])}function Jn({closeDialog:n}){const{user:s}=me(),{t}=R(),[i,r]=H("gameSettings"),[l,o]=b.useState(0),[c,a]=b.useState(null),[d,x]=b.useState(!1),[u,j]=be(),p=re(),y=ve(),{isLoading:S,actionsList:m}=ye(u==null?void 0:u.gameMode),v=(L,B)=>{o(B),p(u.room)},A=()=>r({...i,boardUpdated:!0});async function k(L){L.preventDefault();const{displayName:B,...Me}=u,oe=_n(Me,m);return oe?(a(t(oe)),null):(y(u,m),typeof n=="function"&&n(),null)}const G=b.useCallback(L=>{j(B=>({...B,displayName:L.target.value}))},[j]),Q=b.useCallback(L=>{L.key==="Enter"&&(j(B=>({...B,displayName:L.target.value})),k(L))},[k,j]);return!u.room||S?e.jsxs(f,{children:[e.jsxs(g,{variant:"h2",children:[e.jsx(h,{i18nKey:"loading"}),"..."]}),e.jsx(g,{variant:"body1",children:e.jsx(h,{i18nKey:"clearStorage"})})]}):e.jsxs(f,{component:"form",method:"post",onSubmit:k,className:"settings-box",children:[e.jsx(te,{fullWidth:!0,id:"displayName",label:t("displayName"),defaultValue:(s==null?void 0:s.displayName)||u.displayName||"",required:!0,autoFocus:!0,onBlur:G,onKeyDown:Q,margin:"normal"}),e.jsx(f,{sx:{borderBottom:1,borderColor:"divider"},children:e.jsxs(Ne,{value:l,onChange:v,"aria-label":"Game Settings",centered:!0,children:[e.jsx(X,{label:t("gameboard"),...Z(0)}),e.jsx(X,{label:t("room"),...Z(1)}),e.jsx(X,{label:t("application"),...Z(2)})]})}),e.jsx(D,{value:l,index:0,style:{p:0},children:e.jsx(In,{formData:u,setFormData:j,actionsList:m})}),e.jsx(D,{value:l,index:1,style:{p:0,pt:1},children:e.jsx(zn,{formData:u,setFormData:j})}),e.jsx(D,{value:l,index:2,style:{p:0,pt:1},children:e.jsx(Ln,{formData:u,setFormData:j,boardUpdated:A})}),e.jsxs("div",{className:"flex-buttons",children:[e.jsx(U,{variant:"outlined",type:"button",onClick:()=>x(!0),children:e.jsx(h,{i18nKey:"customTilesLabel",children:"Game Tiles"})}),e.jsx(U,{variant:"contained",type:"submit",children:e.jsx(h,{i18nKey:"update"})})]}),!!d&&e.jsx(cn,{open:d,setOpen:x,boardUpdated:A,actionsList:m}),e.jsx(on,{open:!!c,close:()=>a(null),children:c})]})}function Y({children:n,justifyContent:s="space-evenly"}){return e.jsx(f,{sx:{mt:3,display:"flex",flexDirection:"row",justifyContent:s,alignItems:"center"},children:n})}function Yn({formData:n,setFormData:s,nextStep:t}){const i=re();function r(){i(n.room),t(C(n.room)?2:1)}return e.jsxs(f,{sx:{m:1},children:[e.jsx(g,{variant:"h6",children:e.jsx(h,{i18nKey:"publicOrPrivate"})}),e.jsx(f,{sx:{margin:"0.5rem"},children:e.jsx(Se,{formData:n,setFormData:s})}),e.jsx(Y,{children:e.jsx(U,{variant:"contained",onClick:r,children:e.jsx(h,{i18nKey:C(n.room)?"nextSkip":"next"})})})]})}function Qn({formData:n,setFormData:s,nextStep:t,prevStep:i}){const[r,l]=b.useState(!M(n==null?void 0:n.gameMode));return b.useEffect(()=>{l(!M(n==null?void 0:n.gameMode))},[n==null?void 0:n.gameMode]),e.jsxs(f,{sx:{minHeight:"200px",display:"flex",flexDirection:"column"},children:[e.jsx(g,{variant:"h6",children:e.jsx(h,{i18nKey:"playingWithPeople"})}),e.jsx(q,{trueCondition:!M(n==null?void 0:n.gameMode),onChange:o=>s({...n,gameMode:o.target.checked?"local":"online",roomRealtime:!o.target.checked}),yesLabel:"yesInteracting"}),e.jsx(Pe,{in:r,timeout:500,sx:{mt:r?2:0},children:e.jsxs(f,{children:[e.jsx(g,{variant:"h6",children:e.jsx(h,{i18nKey:"yourRole"})}),e.jsx(f,{sx:{display:"flex",justifyContent:"center"},children:e.jsx(_,{value:n.role,onChange:o=>s({...n,role:o.target.value}),label:"mainRole",options:["dom","vers","sub"],defaultValue:"sub",fullWidth:!1})}),e.jsx(g,{variant:"h6",sx:{mt:1},children:e.jsx(h,{i18nKey:"areYouNaked"})}),e.jsx(g,{variant:"body2",sx:{mt:1},children:e.jsx(h,{i18nKey:"nakedDisclaimer"})}),e.jsx(q,{onChange:o=>s({...n,isNaked:o.target.checked}),trueCondition:n.isNaked,yesLabel:"yesNaked"})]})}),e.jsx(f,{sx:{flexGrow:1}}),e.jsxs(Y,{children:[e.jsx(U,{onClick:i,children:e.jsx(h,{i18nKey:"previous"})}),e.jsx(U,{variant:"contained",onClick:t,children:e.jsx(h,{i18nKey:"next"})})]})]})}function Ce(){return e.jsxs(g,{variant:"h6",sx:{mt:2},children:[e.jsx(h,{i18nKey:"setIntensityLevel"}),e.jsx(E,{title:e.jsx(g,{variant:"body1",children:e.jsx(h,{i18nKey:"intensityTooltip"})}),arrow:!0,sx:{ml:1},children:e.jsx(T,{sx:{ml:.5,fontSize:15}})})]})}const Xn=(n,s)=>{const{gameMode:t,isNaked:i}=n,r=M(t);return r&&["foreplay","sex"].includes(s.type)||!r&&i&&["solo","foreplay"].includes(s.type)||!r&&!i&&["solo","sex"].includes(s.type)},Zn=n=>Object.entries(n).reduce((s,[t,i])=>(Xn(n,i)||(s[t]=i),s),{}),ke=(n,s,t)=>Object.entries(n).map(([i,r])=>{const l=s.find(o=>o.value===i);return r.type!==t||!l?null:i}).filter(i=>!!i),Dn=(n,s,t)=>{const i={...n};return Object.keys(i).forEach(r=>{i[r].type===s&&!t.includes(r)&&delete i[r]}),i},we=(n,s,t)=>{t(i=>{const r=Dn(i,s,n);return n.forEach(l=>{if(r[l])return;let o={type:s,level:1};s==="consumption"&&(o={...o,variation:r.isAppend?"appendMost":"standalone"}),r[l]=o}),r})},Ae=(n,s,t,i,r,l=null)=>{var c;const o=(c=n==null?void 0:n.target)==null?void 0:c.value;if(o===0)return r(a=>a.filter(d=>d!==s)),i(a=>{const d={...a};return delete d[s],d});i(a=>({...a,[s]:{...a[s]||{},type:t,level:o,...!!l&&{variation:l}}}))};function Ke({onChange:n,values:s,options:t,label:i}){function r(l){var o;return(o=t==null?void 0:t.find(c=>c.value===l))==null?void 0:o.label}return e.jsxs($,{fullWidth:!0,children:[e.jsx(N,{id:`${i}-label`,children:i}),e.jsx(P,{labelId:`${i}-label`,id:`${i}`,multiple:!0,value:s,onChange:n,fullWidth:!0,input:e.jsx(ze,{label:e.jsx(h,{i18nKey:"actionsLabel"})}),renderValue:l=>e.jsx(f,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:l==null?void 0:l.map(o=>e.jsx(Ge,{label:r(o)},o))}),children:t==null?void 0:t.map(({label:l,value:o})=>e.jsxs(w,{value:o,children:[e.jsx(Ee,{checked:s.includes(o)}),e.jsx(We,{primary:l})]},o))})]})}const es=2;function ns({formData:n,setFormData:s,options:t,actionsList:i}){const r="consumption",l=t(r),o=ke(n,l,r),[c,a]=b.useState(o),d=u=>{const{value:j}=u.target,p=typeof j=="string"?j.split(","):j;p.length<=es&&(a(p),we(p,r,s))},x=(u,j)=>{const p=j.reduce((y,S)=>(y[S]={...y[S]||{},type:r,variation:u.target.checked?"appendMost":"standalone"},y),{...n,isAppend:u.target.checked});s(p)};return e.jsxs(e.Fragment,{children:[e.jsx(g,{variant:"h6",sx:{my:2},children:e.jsx(h,{i18nKey:"pickConsumptions"})}),e.jsx(Ke,{onChange:d,values:c,options:l,label:F("consumables")}),!!c.length&&e.jsxs(e.Fragment,{children:[e.jsx(Ce,{}),c.map(u=>e.jsx(le,{actionsFolder:i,settings:n,option:u,initValue:1,onChange:j=>Ae(j,u,r,s,a,n.isAppend?"appendMost":"standalone")},u)),e.jsx(g,{variant:"h6",sx:{mt:2},children:e.jsx(h,{i18nKey:"standaloneOrCombine"})}),e.jsx(q,{trueCondition:n.isAppend,onChange:u=>x(u,c),yesLabel:"combineWithActions"})]})]})}const ss=4,ts=n=>M(n==null?void 0:n.gameMode)?"solo":n.isNaked?"sex":"foreplay";function is({formData:n,setFormData:s,options:t,actionsList:i}){const r=ts(n),l=t(r),o=ke(n,l,r),[c,a]=b.useState(o||[]),d=x=>{const{value:u}=x.target,j=typeof u=="string"?u.split(","):u;j.length<=ss&&(a(j),we(j,r,s))};return e.jsxs(e.Fragment,{children:[e.jsx(g,{variant:"h6",sx:{my:2},children:e.jsx(h,{i18nKey:"pickActions"})}),e.jsx(Ke,{onChange:d,values:c,options:l,label:F("actionsLabel")}),!!c.length&&e.jsxs(e.Fragment,{children:[e.jsx(Ce,{}),c.map(x=>e.jsx(le,{actionsFolder:i,settings:n,option:x,initValue:1,onChange:u=>Ae(u,x,r,s,a)},x))]})]})}function ls({formData:n,setFormData:s,nextStep:t,prevStep:i,actionsList:r}){function l(a){return Object.keys(r).filter(d=>{var x;return((x=r[d])==null?void 0:x.type)===a})}b.useEffect(()=>{const a=Zn(n);s(a)},[]);const o=a=>l(a).map(d=>{var x;return{value:d,label:(x=r[d])==null?void 0:x.label}}),c=!Object.keys(n).some(a=>n[a].level>0&&n[a].variation!=="appendMost");return e.jsxs(f,{children:[e.jsx(g,{variant:"body1",sx:{my:2},children:e.jsx(h,{i18nKey:"actionsDisclaimer"})}),e.jsx(is,{formData:n,setFormData:s,options:o,actionsList:r}),e.jsx(ns,{formData:n,setFormData:s,options:o,actionsList:r}),e.jsxs(Y,{children:[e.jsx(U,{onClick:()=>i(C(n.room)?2:1),children:e.jsx(h,{i18nKey:"previous"})}),e.jsx(U,{variant:"contained",disabled:c,onClick:t,children:e.jsx(h,{i18nKey:"next"})})]})]})}function rs({formData:n,setFormData:s,prevStep:t,actionsList:i,close:r}){const l=[100,100],o=[0,0],[c,a]=b.useState(de((n==null?void 0:n.finishRange)||[],o)),[d,x]=b.useState(!1),u=ve();function j(y){s({...n,finishRange:y.target.checked?o:l}),a(y.target.checked)}b.useEffect(()=>{let y={...n,boardUpdated:!0};(!c||!de(n.finishRange||[],l))&&(y.finishRange=l),s(y)},[]);async function p(){x(!0);try{await u(n,i)}catch(y){console.error("Error submitting settings:",y)}finally{x(!1)}typeof r=="function"&&r()}return e.jsxs(f,{children:[e.jsx(g,{variant:"h6",sx:{my:2},children:e.jsx(h,{i18nKey:"WillYouOrgasm"})}),e.jsx(g,{variant:"body2",children:e.jsx(h,{i18nKey:"orgasmDisclaimer"})}),e.jsx(f,{sx:{display:"flex",justifyContent:"center",my:1},children:e.jsx(xe,{control:e.jsx(z,{checked:c,onChange:j}),label:e.jsx(h,{i18nKey:"yesOrgasm"})})}),e.jsxs(Y,{children:[e.jsx(U,{onClick:t,disabled:d,children:e.jsx(h,{i18nKey:"previous"})}),e.jsx(U,{variant:"contained",onClick:p,disabled:d,startIcon:d?e.jsx(Fe,{size:20,color:"inherit"}):null,children:e.jsx(h,{i18nKey:"buildGame"})})]})]})}function os({close:n}){const{id:s}=J(),[t,i]=b.useState(1),r={room:s};C(s)&&(r.gameMode="online",r.roomRealtime=!0);const[l,o]=be({gameMode:"online",roomRealtime:!0,actions:[],consumption:[],role:"sub",boardUpdated:!1,room:s||"PUBLIC"},r),c=b.useRef(!0),{actionsList:a}=ye(l.gameMode);b.useEffect(()=>{if(c.current){if(c.current=!1,l.advancedSettings){u();return}if(typeof n=="function"){if(C(s)){i(3);return}i(2)}}},[l]);const d=p=>{if(!Number.isInteger(p))return i(t+1);i(t+(p||1))},x=p=>{if(!Number.isInteger(p))return i(t-1);i(t-(p||1))},u=()=>i(0),j=()=>{switch(t){case 1:return e.jsx(Yn,{formData:l,setFormData:o,nextStep:d});case 2:return e.jsx(Qn,{formData:l,setFormData:o,nextStep:d,prevStep:x});case 3:return e.jsx(ls,{formData:l,setFormData:o,nextStep:d,prevStep:x,actionsList:a});case 4:return e.jsx(rs,{formData:l,setFormData:o,prevStep:x,actionsList:a,close:n});default:return null}};return t===0?e.jsx(Jn,{closeDialog:n}):e.jsxs(f,{children:[e.jsx(f,{sx:{width:"100%",mt:2,mb:4},children:e.jsx(Ve,{activeStep:t-1,alternativeLabel:!0,children:[1,2,3,4].map(p=>e.jsx(qe,{children:e.jsx(_e,{})},p))})}),j(),e.jsx(O,{sx:{mt:3}}),e.jsx(U,{onClick:u,children:e.jsx(h,{i18nKey:"advancedSetup"})})]})}function cs({open:n,close:s}){const t=Qe(),[i]=De();return i.get("importBoard")?null:e.jsxs(He,{fullScreen:t,open:n,maxWidth:"md",children:[e.jsxs(Je,{children:[e.jsx(h,{i18nKey:"gameSettings"}),typeof s=="function"&&e.jsx(Xe,{close:s})]}),e.jsx(Ye,{children:e.jsx(os,{close:typeof s=="function"?s:void 0})})]})}const ys=Object.freeze(Object.defineProperty({__proto__:null,default:cs},Symbol.toStringTag,{value:"Module"}));export{Jn as G,D as T,gn as a,cs as b,ys as i,xn as s,Mn as u};
