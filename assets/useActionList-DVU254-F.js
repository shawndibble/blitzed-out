import{j as e,h as I,f as k,g as R,B as _,as as $,at as W,au as U,Q as N,aJ as se,d as ye,aK as je,V as be,i as Q,aL as ve,l as Ce,aM as Te,aC as ne,F as we,aE as Ae,aN as Me,n as Se,p as Ee,a0 as Ie,o as Ge,D as Fe}from"./mui-Bjnq2ocN.js";import{a as l}from"./vendor-Bf6wU4zJ.js";import{C as Oe,u as ke}from"./index-NwOQyngl.js";import{t as ie,v as oe,w as Le,x as Ke,y as Y,z as De,A as Ne,B as Pe,i as X,l as Be}from"./index-GXGqHI8R.js";import{A as J,b as V,c as z,u as qe,a as Re}from"./index-DZVzFsPU.js";import{T as $e}from"./index-e79GV5zf.js";import{f as We,a as Ue}from"./strings-CDDZH-Xs.js";import{i as P,u as B,T as S}from"./translations-CairTNs2.js";function D(n){return[...Object.entries(n).flatMap(([r,{label:a,actions:u}])=>u?Object.keys(u).filter(p=>p!=="None").map((p,i)=>({group:We(r),groupLabel:a,value:r,intensity:Number(i+1),translatedIntensity:p,label:`${a} - ${p}`})):[]),{group:P.t("misc"),groupLabel:P.t("misc"),value:"misc",intensity:1,translatedIntensity:P.t("all"),label:`${P.t("misc")} - ${P.t("all")}`}]}function Je(n){var r;if(((r=n.match(/\[|\]/g))==null?void 0:r.length)!==2)throw new Error("ctSeparatorError")}function Ve(n,c){const r=(n==null?void 0:n.sort())||[],a=(c==null?void 0:c.sort())||[];return JSON.stringify(r)===JSON.stringify(a)}function ze(n,c){var b,E,v,A;const r=n.split(`
`).filter(Boolean),a=r[0],u=r[1],m=r.find(t=>t.startsWith("Tags:")),p=((v=(E=(b=m==null?void 0:m.replace("Tags:",""))==null?void 0:b.trim())==null?void 0:E.split(", "))==null?void 0:v.filter(Boolean))||[],i=r.find(t=>t.startsWith("GameMode:")),T=((A=i==null?void 0:i.replace("GameMode:",""))==null?void 0:A.trim())||"online",y=a.replace(/\[|\]/g,""),[w,j]=y.split(" - "),G=D(c[T]||{}).find(t=>t.translatedIntensity===j&&t.group===w);if(!G)throw new Error("ctGroupError");if(!u)throw new Error("ctActionError");return{group:G.value,intensity:G.intensity,action:u,tags:p,gameMode:T,isCustom:1}}function He(n,c,r){const a=(n==null?void 0:n.split("---"))||[];a.forEach(Je);const u=a.map(i=>ze(i,r)).filter(Boolean),m=[],p=[];return u.forEach(i=>{const T=c.find(y=>y.group===i.group&&y.intensity===i.intensity&&y.action===i.action&&y.gameMode===i.gameMode);T?T&&!Ve(T.tags,i.tags)&&p.push({...T,tags:i.tags}):m.push(i)}),{newUniqueRecords:m,changedTagRecords:p}}function _e({expanded:n,handleChange:c,customTiles:r,mappedGroups:a,setSubmitMessage:u,bulkImport:m}){const p=l.useRef(),{t:i}=B(),[T,y]=l.useState(""),w=()=>{const G=r.filter(b=>b.isCustom).map(({group:b,intensity:E,action:v,tags:A,gameMode:t="online"})=>{const o=D(a[t]||{}).find(M=>(M==null?void 0:M.intensity)===Number(E)&&(M==null?void 0:M.value)===b);let C="";return C+=`[${(o==null?void 0:o.group)||b} - ${(o==null?void 0:o.translatedIntensity)||E}]
`,C+=v,C+=A!=null&&A.length?`
Tags: `+(A==null?void 0:A.join(", ")):"",C+=`
GameMode: ${t}`,C});y(G.join(`
---
`))};async function j(d){const{importData:G}=d.current;let b=[],E=[];try{const{newUniqueRecords:v,changedTagRecords:A}=He(G.value,r,a);b=v,E=A}catch(v){return u({type:"error",message:i(v.message)})}return!b.length&&!E.length?u({type:"error",message:i("ctNoNewError")}):(b.length&&(b.forEach(async v=>{ie(`${v.group} - ${v.intensity}`,v.action)}),m(b)),E.length&&await E.forEach(async v=>{await oe(v.id,v)}),w())}return l.useEffect(()=>{n==="ctImport"&&w()},[n,r]),e.jsxs(J,{expanded:n==="ctImport",onChange:c("ctImport"),children:[e.jsx(V,{"aria-controls":"ctImport-content",id:"ctImport-header",children:e.jsx(I,{children:e.jsx(S,{i18nKey:"importExport"})})}),e.jsxs(z,{children:[e.jsx(I,{variant:"body1",sx:{mb:2},children:e.jsx(S,{i18nKey:"ctImportDescription"})}),e.jsxs(k,{component:"form",method:"post",ref:p,children:[e.jsx(R,{id:"importData",name:"importData",multiline:!0,required:!0,fullWidth:!0,sx:{pb:2},value:T,onChange:d=>y(d.target.value),InputProps:{endAdornment:e.jsx(Oe,{text:T}),sx:{alignItems:"flex-start"}}}),e.jsx(_,{fullWidth:!0,variant:"contained",type:"button",onClick:()=>j(p),children:e.jsx(S,{i18nKey:"import"})})]})]})]})}function ae(){const[n,c]=l.useState(()=>{try{const a=localStorage.getItem("gameSettings");return a?JSON.parse(a):{locale:"en",gameMode:"online"}}catch(a){return console.error("Error parsing game settings from localStorage:",a),{locale:"en",gameMode:"online"}}});return l.useEffect(()=>{const a=u=>{if(u.key==="gameSettings")try{const m=JSON.parse(u.newValue);c(m)}catch(m){console.error("Error parsing updated game settings:",m)}};return window.addEventListener("storage",a),()=>window.removeEventListener("storage",a)},[]),{settings:n,updateSettings:a=>{const u={...n,...a};localStorage.setItem("gameSettings",JSON.stringify(u)),c(u)}}}function Qe({setSubmitMessage:n,boardUpdated:c,customTiles:r,mappedGroups:a,expanded:u,handleChange:m,tagList:p,updateTileId:i,setUpdateTileId:T}){const{t:y}=B(),{settings:w}=ae(),[j,d]=l.useState({gameMode:w.gameMode||"online",tileOption:null,action:"",tags:[]});l.useEffect(()=>{const g=(Array.isArray(r)?r:[]).find(({id:o})=>o===i);if(g){const o=g.gameMode||w.gameMode,M=D(a[o]||{}).find(({value:h,intensity:F})=>h===g.group&&F===g.intensity);d({gameMode:o,tileOption:M||null,action:g.action||"",tags:g.tags||[]})}else d(o=>({...o,gameMode:w.gameMode}))},[i,w.gameMode,a]);function G(t,g){return(Array.isArray(r)?r:[]).find(({group:C,intensity:M,action:h})=>`${C} - ${M}`===t&&h===g)}function b(){T(null),d({gameMode:w.gameMode,tileOption:null,action:"",tags:[]})}async function E(){const t=document.querySelector('input[name="tags"]'),g=[...j.tags];t&&t.value.trim()&&(g.push(t.value.trim()),t.value="");const{gameMode:o,tileOption:C,action:M}=j;if(!o||!C||!M)return n({message:y("allFieldsRequired","All fields are required"),type:"error"});if(i==null&&G(C,M))return n({message:y("actionExists"),type:"error"});const F=D(a[o]||{}).find(({label:H})=>H===C.label);if(!F)return n({message:y("invalidOption","Invalid option selected"),type:"error"});const L={group:F.value,intensity:F.intensity,action:M,tags:g,gameMode:o};return i===null?(ie(F.label,M),Le(L)):oe(i,L),c(),n({message:y("customAdded"),type:"success"})}const v=t=>{switch(t.key){case",":case"Enter":{t.preventDefault(),t.stopPropagation(),t.target.value.length>0&&(d({...j,tags:[...j.tags,t.target.value]}),t.target.value="");break}}},A=t=>{t.target.value.length>0&&(d({...j,tags:[...j.tags,t.target.value]}),t.target.value=""),setTimeout(()=>{const g=document.querySelector(".MuiAutocomplete-popper");g&&(g.style.display="none")},150)};return e.jsxs(J,{expanded:u==="ctAdd",onChange:m("ctAdd"),children:[e.jsx(V,{"aria-controls":"ctAdd-content",id:"ctAdd-header",children:e.jsx(I,{children:e.jsx(S,{i18nKey:i?"ctUpdate":"ctAdd"})})}),e.jsx(z,{children:e.jsxs(k,{component:"form",method:"post",className:"settings-box",children:[e.jsxs($,{fullWidth:!0,sx:{mb:2},children:[e.jsx(W,{id:"game-mode-label",children:e.jsx(S,{i18nKey:"customTiles.gameMode"})}),e.jsxs(U,{labelId:"game-mode-label",id:"gameMode",name:"gameMode",value:j.gameMode,label:y("customTiles.gameMode"),onChange:t=>{d({...j,gameMode:t.target.value,tileOption:null})},children:[e.jsx(N,{value:"online",children:e.jsx(S,{i18nKey:"online"})}),e.jsx(N,{value:"local",children:e.jsx(S,{i18nKey:"local"})})]})]}),e.jsx(se,{id:"tileOption",name:"tileOption",options:D(a[j.gameMode]||{}),getOptionLabel:t=>t.label,groupBy:t=>t.group,value:j.tileOption,onChange:(t,g)=>d({...j,tileOption:g}),renderInput:t=>e.jsx(R,{...t,label:y("group"),required:!0}),isOptionEqualToValue:(t,g)=>t.label===g.label,sx:{mb:2}}),e.jsx(R,{id:"action",name:"action",required:!0,fullWidth:!0,label:y("action"),sx:{pb:2},value:j.action,onChange:t=>{d({...j,action:t.target.value})}}),e.jsx(se,{id:"tags",name:"tags",disableCloseOnSelect:!0,multiple:!0,freeSolo:!0,options:p,value:j.tags,onChange:(t,g)=>{d({...j,tags:g})},renderInput:t=>(t.inputProps.onKeyDown=v,t.inputProps.onBlur=A,e.jsx(R,{...t,label:y("tags")})),sx:{pb:2},clearOnBlur:!0,blurOnSelect:!0,openOnFocus:!0,disablePortal:!1,componentsProps:{popper:{modifiers:[{name:"preventOverflow",options:{altAxis:!0,altBoundary:!0,padding:8}}]}}}),e.jsxs(k,{display:"flex",justifyContent:"space-evenly",children:[e.jsx(_,{variant:"contained",type:"button",onClick:()=>b(),children:e.jsx(S,{i18nKey:"clear"})}),e.jsx(_,{variant:"contained",type:"button",onClick:E,children:e.jsx(S,{i18nKey:i?"ctUpdate":"ctAdd"})})]})]})})]})}function Ye({expanded:n,handleChange:c}){return e.jsxs(e.Fragment,{children:[e.jsxs(J,{expanded:n==="help1",onChange:c("help1"),children:[e.jsx(V,{"aria-controls":"help1-content",id:"help1-header",children:e.jsx(I,{children:e.jsx(S,{i18nKey:"ctExplained"})})}),e.jsx(z,{children:e.jsxs(S,{i18nKey:"ctExplainedDescription",children:[e.jsx(I,{sx:{mb:2},children:"Custom tiles let you add your own variations to the game board. Utilize this dialog to add and remove tiles as you see fit."}),e.jsx(I,{sx:{mb:2},children:"Custom tiles are added based on the kink and intensity you pick from the drop down. As such, you need to have that kink and intensity (or a higher intensity) selected for your custom tiles to show on the board."}),e.jsx(I,{children:"Miscellaneous tiles are the only exception to the above. Regardless of what other options you pick, Miscellaneous tiles will show as their own group. If you use this option, ensure that you add multiple tiles to minimize repeats."})]})})]}),e.jsxs(J,{expanded:n==="help2",onChange:c("help2"),children:[e.jsx(V,{"aria-controls":"help2-content",id:"help2-header",children:e.jsx(I,{children:e.jsx(S,{i18nKey:"ctIdeas"})})}),e.jsx(z,{children:e.jsxs(S,{i18nKey:"ctIdeasDescription",children:[e.jsx(I,{variant:"h6",children:"Add new Activities"}),e.jsx(I,{variant:"subtitle2",sx:{mb:2},children:"Come up with new activities that are not part of the existing list"}),e.jsx(I,{variant:"h6",children:"Add harder tiles to easier intensities"}),e.jsx(I,{variant:"subtitle2",sx:{mb:1},children:"When you pick higher intensity levels, the game will use the earlier intensity level and gradual move to whatyou picked. If you want harder tiles early on, add several to lower intensities."}),e.jsx(I,{variant:"subtitle2",sx:{mb:2},children:"Example: You play Poppers - Advanced. Add advanced tiles to Poppers - Beginner"}),e.jsx(I,{variant:"h6",children:"Combine activities into a single tile"}),e.jsx(I,{variant:"subtitle2",sx:{mb:1},children:"Combine multiple activites together in a single tile that normally would not go together."}),e.jsx(I,{variant:"subtitle2",sx:{mb:2},children:"Example: Spit roast. Use a toy in your throat and ass at the same time."}),e.jsx(I,{variant:"h6",children:"Miscellaneous custom tiles"}),e.jsx(I,{variant:"subtitle2",sx:{mb:1},children:"Miscellaneous tiles allow you to add your own tiles without including other groups. Be aware, you will want to add several options to this group to minimize repeats."})]})})]})]})}function Xe({tagList:n,boardUpdated:c,mappedGroups:r,updateTile:a,refreshTrigger:u}){var Z;const{t:m,i18n:p}=B(),{settings:i}=ae(),[T,y]=l.useState(null),[w,j]=l.useState(i.gameMode||"online"),[d,G]=l.useState(""),[b,E]=l.useState(""),[v,A]=l.useState(1),[t]=l.useState(20),[g,o]=l.useState(!0),[C,M]=l.useState({items:[],total:0,totalPages:1}),[h,F]=l.useState({}),[L,H]=l.useState([]);l.useEffect(()=>{async function s(){var x;try{o(!0);const f=await Ke(p.resolvedLanguage,w);F(f);const O=Object.keys(f);if(H(O),!d&&O.length>0){G(O[0]);const K=Object.keys(((x=f[O[0]])==null?void 0:x.intensities)||{});K.length>0&&E(Number(K[0]))}}catch(f){console.error("Error loading groups:",f)}finally{o(!1)}}s()},[w,p.resolvedLanguage]),l.useEffect(()=>{let s=!0;async function x(){try{o(!0);const f={group:d,intensity:b,tag:T,gameMode:w,locale:i.locale,page:v,limit:t,paginated:!0},O=await Y(f);s&&(M(O),setTimeout(()=>{s&&o(!1)},300))}catch(f){console.error("Error loading tiles:",f),s&&o(!1)}}return d?x():o(!1),()=>{s=!1}},[d,b,T,w,v,t,u,i.locale]);function re(s){o(!0),y(T===s?null:s)}function le(s){o(!0);const x=s.target.value;if(G(x),A(1),E(""),x&&h[x]){const f=Object.keys(h[x].intensities||{});f.length>0&&E(Number(f[0]))}}function ce(s){o(!0),E(s.target.value),A(1)}function ue(s,x){o(!0),A(x)}async function de(s){await De(s),c();const x={group:d,intensity:b,tag:T,gameMode:w,locale:i.locale,page:v,limit:t,paginated:!0},f=await Y(x);M(f)}async function ge(s){await Ne(s),c(),M(x=>({...x,items:x.items.map(f=>f.id===s?{...f,isEnabled:!f.isEnabled}:f)}))}function me(s){a(s);const x=document.querySelector(".MuiDialogContent-root");x&&(x.scrollTop=0)}const pe=(Z=C.items)==null?void 0:Z.map(({id:s,group:x,intensity:f,action:O,tags:K,isEnabled:he=!0,isCustom:xe=!0})=>{var ee,te;return e.jsxs(ye,{sx:{my:2},children:[e.jsx(je,{title:O,titleTypographyProps:{variant:"body1"},subheader:(te=(ee=D(r[w]||{}))==null?void 0:ee.find(({value:q,intensity:fe})=>q===x&&fe===Number(f)))==null?void 0:te.label,subheaderTypographyProps:{variant:"body2"},action:e.jsxs(e.Fragment,{children:[e.jsx(be,{checked:!!he,onChange:()=>ge(s),inputProps:{"aria-label":m("customTiles.toggleTile")}}),!!xe&&e.jsxs(e.Fragment,{children:[e.jsx(Q,{"aria-label":m("customTiles.update"),onClick:()=>me(s),children:e.jsx(ve,{})}),e.jsx(Q,{"aria-label":m("customTiles.delete"),onClick:()=>de(s),children:e.jsx(Ce,{})})]})]}),sx:{pb:0}}),e.jsx(Te,{children:K==null?void 0:K.map(q=>e.jsx(ne,{label:q,sx:{m:.5}},q))})]},s)});return e.jsxs(k,{children:[e.jsxs(k,{sx:{display:"flex",flexDirection:"column",gap:2,mb:2,transition:"all 0.3s ease-in-out"},children:[e.jsxs(k,{sx:{display:"flex",flexWrap:"wrap",gap:2},children:[e.jsxs($,{sx:{width:125,flexShrink:0},children:[e.jsx(W,{id:"game-mode-filter-label",children:e.jsx(S,{i18nKey:"customTiles.gameMode"})}),e.jsxs(U,{labelId:"game-mode-filter-label",id:"game-mode-filter",value:w,label:m("customTiles.gameMode","Game Mode"),onChange:s=>{j(s.target.value),G(""),E(""),A(1)},children:[e.jsx(N,{value:"online",children:e.jsx(S,{i18nKey:"online"})}),e.jsx(N,{value:"local",children:e.jsx(S,{i18nKey:"local"})})]})]}),e.jsxs($,{sx:{minWidth:150,flex:1},children:[e.jsx(W,{id:"group-filter-label",children:e.jsx(S,{i18nKey:"customTiles.filterByGroup",children:"Filter by Group"})}),e.jsx(U,{labelId:"group-filter-label",id:"group-filter",value:d,label:"Filter by Group",onChange:le,children:L.map(s=>{var x,f;return e.jsxs(N,{value:s,children:[((f=(x=D(r[w]||{}))==null?void 0:x.find(O=>O.value===s))==null?void 0:f.groupLabel)||s,h[s]&&` (${h[s].count})`]},s)})})]}),e.jsxs($,{sx:{minWidth:200,flex:1},disabled:!d,children:[e.jsx(W,{id:"intensity-filter-label",children:e.jsx(S,{i18nKey:"customTiles.intensityLevel",children:"Intensity Level"})}),e.jsx(U,{labelId:"intensity-filter-label",id:"intensity-filter",value:b,label:"Intensity Level",onChange:ce,children:d&&h[d]&&Object.entries(h[d].intensities||{}).sort(([s],[x])=>Number(s)-Number(x)).map(([s,x])=>{var f,O;return e.jsxs(N,{value:Number(s),children:[((O=(f=D(r[w]||{}))==null?void 0:f.find(K=>K.value===d&&K.intensity===Number(s)))==null?void 0:O.translatedIntensity)||`Level ${s}`,` (${x})`]},s)})})]})]}),e.jsx(k,{children:n==null?void 0:n.map(s=>e.jsx(ne,{label:s,sx:{m:.5},color:T===s?"primary":"default",onClick:()=>re(s)},s))})]}),e.jsxs(k,{sx:{position:"relative",minHeight:"200px"},children:[e.jsx(we,{in:g,timeout:300,children:e.jsx(k,{sx:{position:"absolute",top:0,left:0,right:0,bottom:0,display:"flex",justifyContent:"center",alignItems:"center",backgroundColor:"rgba(255, 255, 255, 0)",zIndex:1,borderRadius:1},children:e.jsx(Ae,{})})}),e.jsx(k,{sx:{opacity:g?.3:1,transition:"opacity 0.3s ease-in-out",pointerEvents:g?"none":"auto"},children:C.items.length===0?e.jsx(I,{variant:"body1",sx:{textAlign:"center",my:4},children:e.jsx(S,{i18nKey:"customTiles.noTilesFound",children:"No tiles found with the selected filters."})}):e.jsxs(e.Fragment,{children:[pe,C.totalPages>1&&e.jsx(k,{sx:{display:"flex",justifyContent:"center",mt:3,mb:2},children:e.jsx(Me,{count:C.totalPages,page:v,onChange:ue,color:"primary"})}),e.jsx(I,{variant:"body2",sx:{textAlign:"center",mt:2,color:"text.secondary"},children:e.jsxs(S,{i18nKey:"customTiles.showingTiles",values:{shown:C.items.length,total:C.total},children:["Showing ",{shown:C.items.length}," of ",{total:C.total}," tiles"]})})]})})]})]})}function rt({boardUpdated:n,setOpen:c,open:r=!1}){const{t:a,i18n:u}=B(),m=qe(),[p,i]=l.useState({message:"",type:"info"}),[T,y]=l.useState("ctAdd"),[w,j]=l.useState(null),[d,G]=l.useState(0),[b,E]=l.useState({online:{},local:{}}),[v,A]=l.useState(!0),t=l.useCallback(()=>{G(h=>h+1)},[]),g=h=>(F,L)=>{y(L?h:!1)};l.useEffect(()=>{async function h(){A(!0);try{const[F,L]=await Promise.all([X(u.resolvedLanguage,"online"),X(u.resolvedLanguage,"local")]);E({online:F,local:L})}catch(F){console.error("Error loading game mode actions:",F)}finally{A(!1)}}h()},[u.resolvedLanguage]);const o=ke(()=>Y({paginated:!1})),C=l.useMemo(()=>o?Array.isArray(o)?o.map(({tags:h})=>h).flat().filter((h,F,L)=>h&&L.indexOf(h)===F).sort():[]:[],[o]),M=l.useCallback(async h=>{await Pe(h),n(),t()},[n,t]);return!o||v?null:e.jsxs(e.Fragment,{children:[e.jsxs(Se,{fullScreen:m,open:r,onClose:()=>c(!1),children:[e.jsxs(Ee,{children:[e.jsx(S,{i18nKey:"manageTiles"}),e.jsx(Q,{"aria-label":a("close"),onClick:()=>c(!1),sx:{position:"absolute",right:8,top:8,color:h=>h.palette.grey[500]},children:e.jsx(Ie,{})})]}),e.jsxs(Ge,{children:[e.jsx(Ye,{expanded:T,handleChange:g}),e.jsx(Qe,{setSubmitMessage:i,boardUpdated:()=>{n(),t()},customTiles:o,mappedGroups:b,expanded:T,handleChange:g,tagList:C,updateTileId:w,setUpdateTileId:j}),e.jsx(_e,{expanded:T,handleChange:g,customTiles:o,mappedGroups:b,setSubmitMessage:i,bulkImport:M}),Array.isArray(o)&&o.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(Fe,{sx:{my:2}}),e.jsx(Xe,{tagList:C,boardUpdated:()=>{n(),t()},mappedGroups:b,updateTile:h=>{j(h),y("ctAdd")},refreshTrigger:d})]})]})]}),e.jsx($e,{open:!!p.message,close:()=>i({message:"",type:"info"}),type:p.type,children:p.message})]})}function lt(n={},c={}){const r=Re("gameSettings")[0],[a,u]=l.useState({...n,...r,...c}),{messages:m}=Ue();return l.useEffect(()=>{const p=Be(m,"room");p!=null&&p.settings&&u(i=>({...i,...JSON.parse(p.settings)}))},[m]),[a,u]}function ct(n){const{i18n:c}=B(),[r,a]=l.useState({}),[u,m]=l.useState(!0),p=async()=>{if(!n)return;m(!0);const i=await X(c.resolvedLanguage,n);a(i),m(!1)};return l.useEffect(()=>{p()},[c.resolvedLanguage,n]),{actionsList:r,isLoading:u}}export{rt as C,ct as a,lt as u};
