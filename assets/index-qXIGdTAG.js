import{j as e,f,aw as U,ax as N,ay as P,g as se,R as w,i as oe,V as ue,W as z,h as p,D as O,G as R,az as L,aq as Me,ar as Oe,aA as Le,at as Te,aB as $e,aC as Ue,aD as Ie,l as W,aE as te,a2 as Be,x as Ne,y as Q,B as T,aF as Pe,ab as We,aG as Ee,aH as Ge,a3 as Fe,aI as ze,aJ as Ve,aK as qe,o as _e,q as Je,p as He}from"./mui-CFdxPsB0.js";import{a as J,u as xe,C as Ye}from"./index-Dq8fGqeu.js";import{a as y,u as H,l as Qe,k as Xe}from"./vendor-Bf6wU4zJ.js";import{d as $,i as C,a as Ze,b as X}from"./strings-ByHvje4o.js";import{i as V,u as M,T as u,t as De}from"./translations-CairTNs2.js";import{s as he,v as en,i as nn,g as je,h as pe,b as ge,u as me}from"./index-B2L5jhHY.js";import{u as ne}from"./index-B3Rr8bhJ.js";import{a as sn,i as tn}from"./urls-bwAPA7IR.js";import{T as rn}from"./index-DV7ZzWGL.js";import{u as be,a as ye,C as ln}from"./useActionList-EXpePDAZ.js";import on from"./languages-KK0t13AM.js";function cn(n){const{t:s}=V;let t=`### ${s("roomSettings")}\r
`;return Object.entries(n).forEach(([i,l])=>{if(i!=="room"){if(i==="roomBackgroundURL"&&l!==""){t+=`* ${s(i)}: [${sn(l)}:link:](${l})\r
`;return}if(i==="roomRealtime"){t+=`* ${s("playerList")}: ${s(l?"delayed":"realtime")}\r
`;return}l!==""&&(t+=`* ${s(i)}: ${l}\r
`)}}),t}function an(n){const s={};return Object.entries(n).forEach(([t,i])=>{t.startsWith("room")&&!["roomUpdated","roomBackground"].some(l=>l===t)&&(s[t]=i)}),s}async function dn(n,s,t){let i=n;return s!==void 0&&s.length>0&&(i=await t(s)),i}function un(n,s){const t=an(n);return he({room:n.room,user:s,text:cn(t),type:"room",settings:JSON.stringify(t)})}function xn(n,s,t){const i=Object.entries(t).filter(([r])=>n[r]).reduce((r,[o,a])=>(r[o]=Object.keys(a.actions).slice(1,n[o]+1),r),{});return(s==null?void 0:s.filter(r=>{if(r.group==="misc")return!0;const o=i[r.group];return o&&o.length>=Number(r.intensity)})).length}function hn(n,s,t,i){const{t:l}=V;let r=`### ${V.t("gameSettings")}\r
`;if(i&&(r+=`##### ${i}\r
`),r+=`--- \r
`,Object.entries(t).forEach(([x,h])=>{var S;if(!n[x])return;const{role:d,variation:j,level:g}=n[x],b=d||n.role||"sub";if(g>0){if(r+=`* ${h==null?void 0:h.label}: ${(S=Object.keys(h==null?void 0:h.actions))==null?void 0:S[g]}`,j&&(r+=` (${l(j)})`),!$(n.gameMode)&&!j){const m=h[b]??l(b);r+=` (${m})`}r+=`\r
`}}),r.endsWith(`--- \r
`))return"";const{finishRange:o,difficulty:a}=n;r+=`--- \r
`,r+=`* ${l("difficulty")}: ${l(a??"normal")} \r
`,o&&(r+=`* ${l("finishSlider")} ${o[0]}%  | ${o[1]-o[0]}% | ${100-o[1]}%`);const c=xn(n,s,t);return c&&(r+=`* ${l("customTilesLabel")}: ${c} \r
`),r}function jn(n){const s={};return Object.entries(n).forEach(([t,i])=>{!["displayName","background","boardUpdated","chatSound","mySound","otherSound","othersDialog","playerDialog","readRoll","hideBoardActions","advancedSettings"].includes(t)&&!t.startsWith("room")&&(s[t]=i)}),s}async function pn({title:n,formData:s,user:t,actionsList:i,tiles:l,customTiles:r=[],reason:o=""}){const a=JSON.stringify(jn(s)),c=await en({title:n,gameBoard:JSON.stringify(l),settings:a}),x=hn(s,r,i,o);if(!(!(c!=null&&c.id)||x===""))return he({room:(s==null?void 0:s.room)||"PUBLIC",user:t,text:x,type:"settings",gameBoardId:c.id,boardSize:l.length,gameMode:s.gameMode})}function gn(n){for(let s=n.length-1;s>0;s-=1){const t=Math.floor(Math.random()*(s+1));[n[s],n[t]]=[n[t],n[s]]}return n}function ce(n){n.length>1&&n.push(n.shift())}function ae(n,s){return(n==null?void 0:n.length)!==(s==null?void 0:s.length)?!1:n.every((t,i)=>t===s[i])}const{t:E}=V;function mn(n,s){return n.filter(t=>s==="vers"?t.includes("{sub}")&&t.includes("{dom}")||t.includes("{player}"):!t.match(/{(dom|sub)}/)||t.includes(`{${s}}`))}function bn(n,s,t){var r;const i=((r=n[s])==null?void 0:r.role)??n.role??"sub";return Object.keys(t).reduce((o,a,c)=>{var x;return c>0&&c<=((x=n[s])==null?void 0:x.level)&&(o[a]=gn(mn(t[a],i))),o},{})}function yn(n,s){return Object.entries(n).filter(([t])=>{var i;return((i=s[t])==null?void 0:i.level)>0}).map(([t,i])=>{var l;return{label:i.label,actions:bn(s,t,i==null?void 0:i.actions),key:t,standalone:!1,role:((l=s[t])==null?void 0:l.role)??s.role??"sub"}})}function fn(n,s){return s.length&&(s.some(({group:t})=>t==="misc")&&n.push({label:E("misc"),actions:{All:[]},key:"misc",standalone:!1}),s.forEach(({group:t,intensity:i,action:l})=>{const r=n.find(o=>o.key===t);if(r&&Object.keys(r.actions).length>=i){const o=Object.values(r.actions)[i-1],a=Math.floor(Math.random()*(o.length+1));o.splice(a,0,l)}})),n}function Sn(n){return Object.entries(n).reduce((s,[t,i])=>(i!=null&&i.variation&&(s[t]=i),s),{})}function vn(n,s){const t=[],i=[...s];return Object.entries(n).forEach(([l,{level:r,variation:o}])=>{if(r<=0)return;const a=s.findIndex(x=>x.key===l);if(o==="standalone"){i[a].standalone=!0;return}const c=o==="appendSome"?.4:.9;t.push({...s[a],frequency:c}),i.splice(a,1)}),{appendList:t,listWithoutAppend:i}}function Cn(n,s,t,i){if([void 0,"normal"].includes(i)){const l=n/s;return Math.floor(t/l)}return s>=3&&Math.random()>=.6?s-2:s-1}function de(n,s,t,i){ce(n);const{actions:l,label:r,standalone:o,frequency:a,role:c}=n[0],x=Math.random();if(a&&a<=x)return{description:""};const h=Object.keys(l),d=Object.values(l);let j=Cn(s,h.length,t,i==null?void 0:i.difficulty);return d[j]||(j-=1),ce(d[j]),{title:r,description:d[j][0],standalone:o,role:c}}function kn(n,s,t){const i=Sn(s),{listWithoutAppend:l,appendList:r}=vn(i,n),o=[];for(let a=1;a<=t;a+=1){const{title:c,description:x,standalone:h,role:d}=de(l,t,a,s);let j="";if(!h&&r.length){const{description:g}=de(r,t,a,s);j=`${g.trim().replace(/([^.,!?])$/,"$1.")} ${x}`}else j=x;o.push({title:c,description:j.trim(),role:d})}return o}function wn(n,s){const t={title:E("start"),description:E("start")},{finishRange:i}=s,l=`${E("noCum")} ${i[0]}%\r
${E("ruined")} ${i[1]-i[0]}%\r
${E("cum")} ${100-i[1]}%`,r={title:E("finish"),description:l};return[t,...n,r]}function Kn(n,s,t=[],i=40){const l=Object.entries(s).reduce((c,[x,h])=>(c[x]={...h,actions:Object.keys(h.actions||{}).reduce((d,j)=>(d[j]=[],d),{})},c),{}),r=yn(l,n);!r.length&&!t.length&&(localStorage.clear(),window.location.reload());const o=fn(r,t),a=kn(o,n,i-2);return wn(a,n)}function An(){const n=ne(ge),[s,t]=J("gameSettings"),{i18n:i}=M();async function l(r={}){var v;const o=r!=null&&r.roomUpdate||r!=null&&r.boardUpdated?r:{...s,...r};let{gameMode:a,boardUpdated:c}=o;const{roomTileCount:x=40,finishRange:h,room:d}=o,j=C(d);if(!h)return{};j&&!$(a)&&(a="online",c=!0);const g=await nn(i.resolvedLanguage,a),b=j?40:x,S=await je(a),m=Kn(o,g,S,b);return(r!=null&&r.boardUpdated||c||((v=n==null?void 0:n.tiles)==null?void 0:v.length)!==m.length)&&(await t(o),await pe({title:(n==null?void 0:n.title)||"",tiles:m})),{settingsBoardUpdated:c,gameMode:a,newBoard:m}}return(r={})=>l(r)}function Z({children:n,value:s,index:t,style:i,...l}){return e.jsx("div",{role:"tabpanel",hidden:s!==t,id:`simple-tabpanel-${t}`,"aria-labelledby":`simple-tab-${t}`,...l,children:s===t&&e.jsx(f,{sx:{p:3,...i},children:n})})}function fe({formData:n,setFormData:s,backgrounds:t,isRoom:i=!1}){const{t:l}=M(),r=i?"roomBackground":"background",o=i?"roomBackgroundURL":"backgroundURL",[a,c]=y.useState((n==null?void 0:n[r])||Object.keys(t)[0]),x=()=>Object.entries(t).map(([j,g])=>e.jsx(w,{value:j,children:g},j)),h=j=>{s({...n,[r]:j.target.value}),c(j.target.value)};y.useEffect(()=>{a!==(n==null?void 0:n[r])&&c(n==null?void 0:n[r])},[n==null?void 0:n[r]]);const d=j=>{const g={...n,[r]:"custom",[o]:j.target.value};i&&(g.roomUpdated=!0),s(g)};return e.jsxs(e.Fragment,{children:[e.jsxs(U,{fullWidth:!0,margin:"normal",children:[e.jsx(N,{id:"background-label",children:l("background")}),e.jsx(P,{labelId:"background-label",id:"background",label:l("background"),value:a||"",onChange:h,children:x()})]}),a==="custom"&&e.jsx(se,{sx:{mt:2},label:l("url"),value:n==null?void 0:n[o],fullWidth:!0,onChange:d,helperText:e.jsxs(e.Fragment,{children:[l("supportedSites"),e.jsx("br",{}),l("requiresEmbeddedUrl")]})})]})}function Rn({boardUpdated:n}){const{i18n:s}=M(),[t,i]=y.useState(s.resolvedLanguage);function l(o){i(o),s.changeLanguage(o),n()}const r=Object.entries(on).map(([o,a])=>e.jsx(w,{value:o,children:a.label},o));return e.jsx(f,{sx:{minWidth:120,mt:1,mb:2},children:e.jsxs(U,{fullWidth:!0,children:[e.jsxs(N,{id:"language-label",sx:{display:"flex",alignItems:"center"},children:[e.jsx(oe,{sx:{mr:1}}),e.jsx(u,{i18nKey:"language"})]}),e.jsx(P,{labelId:"language-label",id:"language-select",value:t,label:e.jsxs(e.Fragment,{children:[e.jsx(oe,{}),e.jsx(u,{i18nKey:"language"})]}),onChange:o=>l(o.target.value),children:r})]})})}function q({trueCondition:n,onChange:s,yesLabel:t,noLabel:i,sx:l={}}){return e.jsx(f,{sx:{display:"flex",justifyContent:"center",my:1,...l},children:e.jsx(ue,{control:e.jsx(z,{checked:n||!1,onChange:s}),label:e.jsx(u,{i18nKey:n?t:i})})})}function B({field:n,formData:s,handleSwitch:t}){return e.jsx(q,{trueCondition:s[n],onChange:i=>t(i,n),yesLabel:`${n}Enable`,noLabel:`${n}Disable`,sx:{justifyContent:"left"}})}function Mn({formData:n,setFormData:s,boardUpdated:t}){const[i,l]=J("gameSettings"),{t:r}=M(),o={color:r("color"),gray:r("gray"),"metronome.gif":r("hypnoDick"),"pink-spiral.gif":r("pinkSpiral"),custom:r("customURL")};function a(c,x){s({...n,[x]:c.target.checked}),l({...i,[x]:c.target.checked})}return e.jsxs(e.Fragment,{children:[e.jsx(Rn,{boardUpdated:t}),e.jsx(p,{variant:"h5",children:e.jsx(u,{i18nKey:"dialog"})}),e.jsx(B,{field:"playerDialog",formData:n,handleSwitch:a}),e.jsx(B,{field:"othersDialog",formData:n,handleSwitch:a}),e.jsx(O,{}),e.jsx(p,{variant:"h5",sx:{mt:2},children:e.jsx(u,{i18nKey:"sounds"})}),e.jsx(B,{field:"mySound",formData:n,handleSwitch:a}),e.jsx(B,{field:"otherSound",formData:n,handleSwitch:a}),e.jsx(B,{field:"chatSound",formData:n,handleSwitch:a}),e.jsx(B,{field:"readRoll",formData:n,handleSwitch:a}),e.jsx(O,{}),e.jsx(p,{variant:"h5",sx:{mt:2,textTransform:"capitalize"},children:e.jsx(u,{i18nKey:"miscellaneous"})}),e.jsx(B,{field:"hideBoardActions",formData:n,handleSwitch:a}),e.jsx(B,{field:"advancedSettings",formData:n,handleSwitch:a}),e.jsx(fe,{formData:n,setFormData:s,backgrounds:o}),e.jsx(O,{})]})}function D({children:n}){return e.jsx(R,{size:{xs:12,md:5},children:n})}const _=y.forwardRef(({value:n,onChange:s,label:t,options:i,defaultValue:l=null,sx:r,helpIcon:o=!1,fullWidth:a=!0,...c},x)=>{const h=i.map(d=>typeof d=="string"?e.jsx(w,{value:d,children:e.jsx(u,{i18nKey:d})},d):e.jsx(w,{value:d.value,children:d.label},d.value));return e.jsxs(U,{fullWidth:a,margin:"normal",sx:r,...c,ref:x,children:[e.jsxs(N,{id:`${t}Label`,children:[e.jsx(u,{i18nKey:t}),!!o&&e.jsx(L,{sx:{ml:1,fontSize:16}})]}),e.jsx(P,{labelId:`${t}Label`,id:t,label:e.jsxs(e.Fragment,{children:[e.jsx(u,{i18nKey:t}),!!o&&e.jsx(L,{sx:{ml:1,fontSize:16}})]}),value:n||l,onChange:s,children:h})]})});function ee({children:n,title:s,subtitle:t,defaultExpanded:i=!1,...l}){return e.jsxs(Me,{defaultExpanded:i,...l,sx:{backgroundColor:"inherit",backgroundImage:"none",boxShadow:"none"},children:[e.jsxs(Oe,{expandIcon:e.jsx(Le,{}),sx:{px:0},children:[e.jsxs(p,{variant:"h6",sx:{width:"33%"},children:[s,":"]}),e.jsx(p,{sx:{pt:.5},children:t})]}),e.jsx(Te,{sx:{px:0},children:e.jsx(R,{container:!0,columnSpacing:2,justifyContent:"space-evenly",className:"columned-grid",children:n})})]})}function On({formData:n,setFormData:s}){const t=(l,r)=>{s({...n,finishRange:r,boardUpdated:!0})},i=(n==null?void 0:n.finishRange)||[30,70];return e.jsxs(f,{children:[e.jsx(O,{}),e.jsx(p,{id:"finish-slider",sx:{my:1},children:e.jsx(u,{i18nKey:"finishSlider"})}),e.jsx($e,{"aria-labelledby":"finish-slider",value:i,onChange:t,valueLabelDisplay:"off"}),e.jsxs(f,{display:"flex",flexDirection:"column",justifyContent:"space-between",textAlign:"center",children:[e.jsxs(p,{whiteSpace:"nowrap",children:[e.jsx(u,{i18nKey:"noCum"})," ",i[0],"%"]}),e.jsxs(p,{whiteSpace:"nowrap",children:[e.jsx(u,{i18nKey:"ruined"})," ",i[1]-i[0],"%"]}),e.jsxs(p,{whiteSpace:"nowrap",children:[e.jsx(u,{i18nKey:"cum"})," ",100-i[1],"%"]})]}),e.jsx(O,{sx:{my:1}})]})}function Ln(){const[n,s]=y.useState(!1);return y.useEffect(()=>{const t=window.matchMedia("(pointer: fine)");s(t.matches);const i=l=>{s(l.matches)};return t.addEventListener("change",i),()=>{t.removeEventListener("change",i)}},[]),n}function ie({actionsFolder:n,settings:s,option:t,onChange:i,initValue:l=0}){var g,b,S;const r=`${t}label`,o=(g=n[t])==null?void 0:g.label,a=Ln(),[c,x]=y.useState(((b=s[t])==null?void 0:b.level)||0),h=m=>{x(m)},d=m=>c>0&&m===0?!1:s.difficulty==="accelerated"?c<=2?c===m:c===m||c-1===m:c>=m;function j(m){var v;return Object.keys((v=n[m])==null?void 0:v.actions).map((A,k)=>e.jsxs(w,{value:k,onMouseOver:()=>h(k),children:[!!a&&e.jsx("span",{className:"menu-item-icon",children:d(k)?e.jsx(Ue,{}):e.jsx(Ie,{})}),A]},`${m}-${A}`))}return e.jsxs(U,{margin:"normal",fullWidth:!0,children:[e.jsx(N,{id:r,children:o}),e.jsx(P,{labelId:r,id:t,label:o,value:((S=s[t])==null?void 0:S.level)||l,onChange:i,onOpen:()=>{var m;return x(((m=s[t])==null?void 0:m.level)||l)},onClose:()=>{var m;return x(((m=s[t])==null?void 0:m.level)||l)},children:j(t)})]})}function Tn({option:n,settings:s,setSettings:t,actionsFolder:i,type:l,showVariation:r=!1,showRole:o=!1}){var g,b,S,m;const{t:a}=M(),c=`${n}label`,x=(g=i[n])==null?void 0:g.label;function h(v,A,k){t(G=>{var F;return{...G,[A]:{...G[A],type:l,[k]:(F=v==null?void 0:v.target)==null?void 0:F.value},boardUpdated:!0}})}let d=12;(r||o)&&(d=6);let j=["dom","vers","sub"];return(b=i[n])!=null&&b.dom&&(j=[{label:i[n].dom,value:"dom"},{label:a("vers"),value:"vers"},{label:i[n].sub,value:"sub"}]),e.jsxs(R,{container:!0,justifyContent:"center",children:[e.jsx(R,{size:d,children:e.jsx(ie,{actionsFolder:i,settings:s,option:n,onChange:v=>h(v,n,"level")})}),!!o&&e.jsx(R,{size:6,children:e.jsx(_,{sx:{ml:1},value:(S=s[n])==null?void 0:S.role,onChange:v=>h(v,n,"role"),label:`${a("role")}: ${x}`,options:j,defaultValue:s.role||"sub"})}),!!r&&e.jsx(R,{size:6,children:e.jsx(W,{placement:"top",title:e.jsxs(u,{i18nKey:"variationTooltip",children:[e.jsx(p,{variant:"subtitle2",children:"Standalone = Its own tile. "}),e.jsx(p,{variant:"subtitle2",children:"Append Some = 50% chance."}),e.jsx(p,{variant:"subtitle2",children:"Append Most = 90% chance."})]}),arrow:!0,children:e.jsxs(U,{fullWidth:!0,margin:"normal",sx:{ml:1},children:[e.jsxs(N,{id:`${c}Variation`,children:[`${x} ${a("variation")}`,e.jsx(L,{sx:{ml:1,fontSize:16}})]}),e.jsxs(P,{labelId:`${c}Variation`,id:`${n}Variation`,label:e.jsxs(e.Fragment,{children:[x," ",a("variation"),e.jsx(L,{sx:{ml:1,fontSize:16}})]}),value:((m=s[n])==null?void 0:m.variation)||"standalone",onChange:v=>h(v,n,"variation"),children:[e.jsx(w,{value:"standalone",children:e.jsx(u,{i18nKey:"standalone"})}),e.jsx(w,{value:"appendSome",children:e.jsx(u,{i18nKey:"appendSome"})}),e.jsx(w,{value:"appendMost",children:e.jsx(u,{i18nKey:"appendMost"})})]})]})})})]},n)}function $n({formData:n,setFormData:s}){return e.jsxs(te,{direction:"row",spacing:1,alignItems:"center",justifyContent:"center",sx:{mt:1},children:[e.jsx(p,{children:e.jsx(u,{i18nKey:"solo"})}),e.jsx(W,{title:e.jsx(p,{variant:"subtitle2",children:e.jsx(u,{i18nKey:"soloTooltip"})}),arrow:!0,children:e.jsx(L,{sx:{fontSize:15}})}),e.jsx(z,{id:"gameMode",checked:!$(n.gameMode),onChange:t=>s({...n,gameMode:t.target.checked?"local":"online",boardUpdated:!0}),inputProps:{"aria-label":"Game Type"}}),e.jsx(p,{children:e.jsx(u,{i18nKey:"local"})}),e.jsx(W,{title:e.jsx(p,{variant:"subtitle2",children:e.jsx(u,{i18nKey:"localTooltip"})}),arrow:!0,children:e.jsx(L,{sx:{fontSize:15}})})]})}function Un({formData:n}){const[s,t]=y.useState(!1);return y.useEffect(()=>{const i=Object.values(n).filter(r=>(r==null?void 0:r.type)==="consumption"&&(r==null?void 0:r.level)>0).length,l=Object.values(n).filter(r=>(r==null?void 0:r.level)>0).length;t(i>1&&i>=l-i)},[n]),s?e.jsx(Be,{severity:"warning",children:e.jsx(u,{i18nKey:"consumptionWarning"})}):null}function In({formData:n,setFormData:s,actionsList:t}){const{t:i}=M(),l=xe("md"),r=!C(n==null?void 0:n.room)&&!$(n.gameMode);function o(c,x={}){return Object.keys(t).filter(h=>{var d;return((d=t[h])==null?void 0:d.type)===c}).map(h=>e.jsx(D,{sm:l&&!r?6:12,children:e.jsx(Tn,{option:h,settings:n,setSettings:s,actionsFolder:t,type:c,...x})},h))}const a=c=>{const x=JSON.parse(JSON.stringify(n));return Object.keys(x).forEach(h=>{x.role=c,h.includes("role")&&(x[h]=c)}),x};return e.jsxs(e.Fragment,{children:[e.jsx($n,{formData:n,setFormData:s}),C(n==null?void 0:n.room)&&!$(n.gameMode)&&e.jsx(R,{container:!0,alignContent:"center",justifyContent:"space-evenly",children:e.jsx(R,{sx:{py:3},children:e.jsx(p,{variant:"h5",children:e.jsx(u,{i18nKey:"privateRequired"})})})}),e.jsxs(R,{container:!0,columnSpacing:2,justifyContent:"space-evenly",children:[e.jsx(D,{children:e.jsx(W,{placement:"top",title:e.jsx(u,{i18nKey:"difficultyTooltip",children:e.jsxs(p,{variant:"body2",children:["Normal = Slow ramp up. ",e.jsx("br",{}),e.jsx("br",{}),"Accelerated = Straight to max level + the level prior to it."]})}),arrow:!0,children:e.jsx(_,{value:n.difficulty,onChange:c=>s({...n,difficulty:c.target.value,boardUpdated:!0}),label:"difficulty",options:["normal","accelerated"],defaultValue:"normal",helpIcon:!0})})}),r&&e.jsx(D,{children:e.jsx(_,{value:n.role,onChange:c=>s({...a(c.target.value),boardUpdated:!0}),label:"mainRole",options:["dom","vers","sub"],defaultValue:"sub"})})]}),r?e.jsxs(e.Fragment,{children:[e.jsx(ee,{title:i("consumption"),subtitle:i("consumptionSubtitle"),children:o("consumption",{showVariation:!0})}),e.jsx(ee,{title:i("foreplay"),subtitle:i("foreplaySubtitle"),children:o("foreplay",{showRole:r})}),e.jsx(ee,{title:i("sex"),subtitle:i("sexSubtitle"),children:o("sex",{showRole:r})})]}):e.jsxs(e.Fragment,{children:[e.jsx(R,{container:!0,columnSpacing:2,justifyContent:"space-evenly",children:o("consumption",{showVariation:!0})}),e.jsx(O,{}),e.jsx(R,{container:!0,columnSpacing:2,justifyContent:"center",children:o("solo")})]}),e.jsx(On,{setFormData:s,formData:n}),e.jsx(Un,{formData:n})]})}function Bn({formData:n,setFormData:s}){const{t}=M(),i={"1d4":2.5,"1d6":3.5,"2d4":5},l=n!=null&&n.roomTileCount?Math.floor(n.roomTileCount/i[n.roomDice]):16,r=Array.from({length:7},(o,a)=>(a+2)*10).map(o=>e.jsx(w,{value:o,children:o},o));return e.jsxs(e.Fragment,{children:[e.jsx(p,{children:e.jsx(u,{i18nKey:"gameSpeed"})}),e.jsxs(f,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[e.jsxs(U,{sx:{m:1},fullWidth:!0,children:[e.jsx(N,{id:"diceRole-label",children:e.jsx(u,{i18nKey:"roomDice"})}),e.jsxs(P,{labelId:"diceRole-label",id:"diceRole-select",value:(n==null?void 0:n.roomDice)||"1d4",label:t("roomDice"),onChange:o=>s({...n,roomDice:o.target.value,roomUpdated:!0}),children:[e.jsx(w,{value:"1d4",children:"1d4"}),e.jsx(w,{value:"1d6",children:"1d6"}),e.jsx(w,{value:"2d4",children:"2d4"})]})]}),e.jsxs(U,{sx:{m:1},fullWidth:!0,children:[e.jsx(N,{id:"tile-count-label",children:e.jsx(u,{i18nKey:"roomTileCount"})}),e.jsx(P,{labelId:"tile-count-label",id:"tile-count-select",value:(n==null?void 0:n.roomTileCount)||40,label:t("roomTileCount"),onChange:o=>s({...n,roomTileCount:o.target.value,roomUpdated:!0}),children:r})]}),e.jsx(U,{fullWidth:!0,children:e.jsxs(p,{children:[e.jsx(u,{i18nKey:"averageRolls"}),l]})})]})]})}function Nn({formData:n,setFormData:s}){const t=y.useCallback(()=>{s({...n,roomRealtime:!n.roomRealtime,roomUpdated:!0})},[n,s]);return e.jsxs(e.Fragment,{children:[e.jsx(p,{children:e.jsx(u,{i18nKey:"playerListOptions"})}),e.jsxs(te,{direction:"row",spacing:1,alignItems:"center",justifyContent:"center",sx:{width:"100%"},children:[e.jsx(p,{children:e.jsx(u,{i18nKey:"realtime"})}),e.jsx(W,{title:e.jsx(p,{variant:"subtitle2",children:e.jsx(u,{i18nKey:"realtimeTooltip"})}),arrow:!0,children:e.jsx(L,{sx:{fontSize:15}})}),e.jsx(z,{id:"showPrivate",checked:!!n.roomRealtime,onChange:t,inputProps:{"aria-label":De("playerList")}}),e.jsx(p,{children:e.jsx(u,{i18nKey:"delayed"})}),e.jsx(W,{title:e.jsx(p,{variant:"subtitle2",children:e.jsx(u,{i18nKey:"delayedTooltip"})}),arrow:!0,children:e.jsx(L,{sx:{fontSize:15}})})]})]})}let Pn=n=>crypto.getRandomValues(new Uint8Array(n)),Wn=(n,s,t)=>{let i=(2<<Math.log2(n.length-1))-1,l=-~(1.6*i*s/n.length);return(r=s)=>{let o="";for(;;){let a=t(l),c=l|0;for(;c--;)if(o+=n[a[c]&i]||"",o.length>=r)return o}}},En=(n,s=21)=>Wn(n,s|0,Pn);function Se({formData:n,setFormData:s}){var o;const{id:t}=H(),{t:i}=M(),l=y.useCallback(a=>{let c;a.target.checked&&C(t)?c=En("123456789ABCDEFGHJKLMNPQRSTUVWXYZ",5)():a.target.checked&&!C(t)?c=t:c="PUBLIC",s({...n,room:c,gameMode:C(c)?"online":n.gameMode})},[t,n,s]),r=y.useCallback(a=>{s({...n,room:a.target.value,boardUpdated:!0})},[n,s]);return e.jsxs(e.Fragment,{children:[e.jsxs(te,{direction:"row",spacing:1,alignItems:"center",justifyContent:"center",sx:{width:"100%"},children:[e.jsx(p,{children:e.jsx(u,{i18nKey:"public"})}),e.jsx(z,{id:"showPrivate",checked:!C(n.room),onChange:l,inputProps:{"aria-label":i("room")}}),e.jsx(p,{children:e.jsx(u,{i18nKey:"private"})}),e.jsx(W,{title:e.jsx(p,{variant:"subtitle2",children:e.jsx(u,{i18nKey:"privateOptions"})}),arrow:!0,children:e.jsx(L,{sx:{fontSize:15}})})]}),!C(n.room)&&e.jsx(se,{fullWidth:!0,id:"privateRoom",label:"Private Room",defaultValue:(o=n.room)==null?void 0:o.toUpperCase(),margin:"normal",onBlur:r,onKeyDown:r})]})}function Gn({formData:n,setFormData:s}){const{t}=M(),i={app:t("appBackground"),custom:t("customURL")};return e.jsxs(f,{sx:{margin:"0.5rem"},children:[e.jsx(Se,{formData:n,setFormData:s}),!C(n.room)&&e.jsxs(e.Fragment,{children:[e.jsx(O,{sx:{my:1}}),e.jsx(Bn,{formData:n,setFormData:s}),e.jsx(O,{sx:{my:1}}),e.jsx(Nn,{formData:n,setFormData:s}),e.jsx(O,{sx:{my:1}}),e.jsx(fe,{formData:n,setFormData:s,backgrounds:i,isRoom:!0})]})]})}function Fn(n){return Object.values(n).some(({level:s})=>s>0)}function zn(n,s){return Object.entries(n).reduce((t,[i,l])=>{var r;return i in s&&((r=l==null?void 0:l.variation)!=null&&r.startsWith("append")?t.withAppend[i]=l:t.withoutAppend[i]=l),t},{withAppend:{},withoutAppend:{}})}function Vn(n){return Object.keys(n).length&&Object.values(n).some(({level:s})=>s>0)}function qn(n,s){const{withAppend:t,withoutAppend:i}=zn(n,s);return Fn(i)?C(n.room)&&!$(n.gameMode)?"privateRequired":null:Vn(t)?"appendWithAction":"pickSomething"}function re(){const{id:n}=H(),s=Qe();return i=>{n.toUpperCase()!==(i==null?void 0:i.toUpperCase())&&s(`/${i||"PUBLIC"}`)}}function _n(n){(!n.roomBackgroundURL||!tn(n.roomBackgroundURL))&&(n.roomBackground="app")}function ve(){const{user:n,updateUser:s}=me(),{id:t}=H(),{t:i}=M(),l=An(),[r,o]=J("gameSettings"),a=ne(()=>je(r.gameMode)),c=ne(ge),x=re(),{messages:h}=Ze(),d=g=>{const b=t.toUpperCase()!==g.room.toUpperCase(),S=g.room&&!C(g.room),m=S&&g.roomTileCount!==r.roomTileCount;return{roomChanged:b,isPrivateRoom:S,privateBoardSizeChanged:m}};async function j(g,b){const{displayName:S}=g,m=await dn(n,S,s);_n(g);const{settingsBoardUpdated:v,gameMode:A,newBoard:k}=await l(g),{roomChanged:G,isPrivateRoom:F,privateBoardSizeChanged:K}=d(g);F&&(g.roomUpdated||!h.find(I=>I.type==="room"))&&await un(g,m),(c==null?void 0:c.tiles)!==k&&await pe({title:i("settingsGenerated"),tiles:k,isActive:1,gameMode:A}),(v||G||K)&&await pn({formData:g,user:m,customTiles:a,actionsList:b,title:"Settings Generated Board",tiles:k}),o({...g,boardUpdated:!1,roomUpdated:!1,gameMode:A}),x(g.room)}return(g,b)=>j(g,b)}function Jn({closeDialog:n}){const{user:s}=me(),{t}=M(),[i,l]=J("gameSettings"),[r,o]=y.useState(0),[a,c]=y.useState(null),[x,h]=y.useState(!1),[d,j]=be(),g=re(),b=ve(),{isLoading:S,actionsList:m}=ye(d==null?void 0:d.gameMode),v=(K,I)=>{o(I),g(d.room)},A=()=>l({...i,boardUpdated:!0});async function k(K){K.preventDefault();const{displayName:I,...Re}=d,le=qn(Re,m);return le?c(t(le)):(b(d,m),typeof n=="function"&&n(),null)}const G=y.useCallback(K=>{j(I=>({...I,displayName:K.target.value}))},[d]),F=y.useCallback(K=>{K.key==="Enter"&&(j(I=>({...I,displayName:K.target.value})),k(K))},[d,k]);return!d.room||S?e.jsxs(f,{children:[e.jsxs(p,{variant:"h2",children:[e.jsx(u,{i18nKey:"Loading"}),"..."]}),e.jsx(p,{variant:"body1",children:e.jsx(u,{i18nKey:"clearStorage"})})]}):e.jsxs(f,{component:"form",method:"post",onSubmit:k,className:"settings-box",children:[e.jsx(se,{fullWidth:!0,id:"displayName",label:t("displayName"),defaultValue:(s==null?void 0:s.displayName)||d.displayName||"",required:!0,autoFocus:!0,onBlur:G,onKeyDown:K=>F(K),margin:"normal"}),e.jsx(f,{sx:{borderBottom:1,borderColor:"divider"},children:e.jsxs(Ne,{value:r,onChange:v,"aria-label":"Game Settings",centered:!0,children:[e.jsx(Q,{label:t("gameboard"),...X(0)}),e.jsx(Q,{label:t("room"),...X(1)}),e.jsx(Q,{label:t("application"),...X(2)})]})}),e.jsx(Z,{value:r,index:0,style:{p:0},children:e.jsx(In,{formData:d,setFormData:j,actionsList:m})}),e.jsx(Z,{value:r,index:1,style:{p:0,pt:1},children:e.jsx(Gn,{formData:d,setFormData:j})}),e.jsx(Z,{value:r,index:2,style:{p:0,pt:1},children:e.jsx(Mn,{formData:d,setFormData:j,boardUpdated:A})}),e.jsxs("div",{className:"flex-buttons",children:[e.jsx(T,{variant:"outlined",type:"button",onClick:()=>h(!0),children:e.jsx(u,{i18nKey:"customTilesLabel",children:"Game Tiles"})}),e.jsx(T,{variant:"contained",type:"submit",children:e.jsx(u,{i18nKey:"update"})})]}),!!x&&e.jsx(ln,{open:x,setOpen:h,boardUpdated:A,actionsList:m}),e.jsx(rn,{open:!!a,setOpen:c,close:()=>c(null),children:a})]})}function Y({children:n,justifyContent:s="space-evenly"}){return e.jsx(f,{sx:{mt:3,display:"flex",flexDirection:"row",justifyContent:s,alignItems:"center"},children:n})}function Hn({formData:n,setFormData:s,nextStep:t}){const i=re();function l(){i(n.room),t(C(n.room)?2:1)}return e.jsxs(f,{sx:{m:1},children:[e.jsx(p,{variant:"h6",children:e.jsx(u,{i18nKey:"publicOrPrivate"})}),e.jsx(f,{sx:{margin:"0.5rem"},children:e.jsx(Se,{formData:n,setFormData:s})}),e.jsx(Y,{children:e.jsx(T,{variant:"contained",onClick:l,children:e.jsx(u,{i18nKey:C(n.room)?"nextSkip":"next"})})})]})}function Yn({formData:n,setFormData:s,nextStep:t,prevStep:i}){return e.jsxs(f,{children:[e.jsx(p,{variant:"h6",children:e.jsx(u,{i18nKey:"playingWithPeople"})}),e.jsx(q,{trueCondition:!$(n==null?void 0:n.gameMode),onChange:l=>s({...n,gameMode:l.target.checked?"local":"online",roomRealtime:!l.target.checked}),yesLabel:"yesInteracting",noLabel:"noInteracting"}),!$(n.gameMode)&&e.jsxs(e.Fragment,{children:[e.jsx(p,{variant:"h6",sx:{mt:2},children:e.jsx(u,{i18nKey:"yourRole"})}),e.jsx(f,{sx:{display:"flex",justifyContent:"center"},children:e.jsx(_,{value:n.role,onChange:l=>s({...n,role:l.target.value}),label:"mainRole",options:["dom","vers","sub"],defaultValue:"sub",fullWidth:!1})}),e.jsx(p,{variant:"h6",sx:{mt:1},children:e.jsx(u,{i18nKey:"areYouNaked"})}),e.jsx(p,{variant:"body2",sx:{mt:1},children:e.jsx(u,{i18nKey:"nakedDisclaimer"})}),e.jsx(q,{onChange:l=>s({...n,isNaked:l.target.checked}),trueCondition:n.isNaked,yesLabel:"yesNaked",noLabel:"noNaked"})]}),e.jsxs(Y,{children:[e.jsx(T,{onClick:i,children:e.jsx(u,{i18nKey:"previous"})}),e.jsx(T,{variant:"contained",onClick:t,children:e.jsx(u,{i18nKey:"next"})})]})]})}function Ce(){return e.jsxs(p,{variant:"h6",sx:{mt:2},children:[e.jsx(u,{i18nKey:"setIntensityLevel"}),e.jsx(W,{title:e.jsx(u,{i18nKey:"intensityTooltip"}),arrow:!0,sx:{ml:1},children:e.jsx(L,{fontSize:"15"})})]})}const Qn=(n,s)=>{const{gameMode:t,isNaked:i}=n,l=$(t);return l&&["foreplay","sex"].includes(s.type)||!l&&i&&["solo","foreplay"].includes(s.type)||!l&&!i&&["solo","sex"].includes(s.type)},Xn=n=>Object.entries(n).reduce((s,[t,i])=>(Qn(n,i)||(s[t]=i),s),{}),ke=(n,s,t)=>Object.entries(n).map(([i,l])=>{const r=s.find(o=>o.value===i);return l.type!==t||!r?null:i}).filter(i=>i),Zn=(n,s,t)=>{const i={...n};return Object.keys(i).forEach(l=>{i[l].type===s&&!t.includes(l)&&delete i[l]}),i},we=(n,s,t)=>{t(i=>{const l=Zn(i,s,n);return n.forEach(r=>{if(l[r])return;let o={type:s,level:1};s==="consumption"&&(o={...o,variation:l.isAppend?"appendMost":"standalone"}),l[r]=o}),l})},Ke=(n,s,t,i,l,r=null)=>{var a;const o=(a=n==null?void 0:n.target)==null?void 0:a.value;if(o===0)return l(c=>c.filter(x=>x!==s)),i(c=>{const x={...c};return delete x[s],x});i(c=>({...c,[s]:{...c[s],type:t,level:o,...!!r&&{variation:r}}}))};function Ae({onChange:n,values:s,options:t,label:i}){function l(r){var o;return(o=t==null?void 0:t.find(a=>a.value===r))==null?void 0:o.label}return e.jsxs(U,{fullWidth:!0,children:[e.jsx(N,{id:`${i}-label`,children:i}),e.jsx(P,{labelId:`${i}-label`,id:`${i}`,multiple:!0,value:s,onChange:n,fullWidth:!0,input:e.jsx(Ge,{label:e.jsx(u,{i18nKey:"actionsLabel"})}),renderValue:r=>e.jsx(f,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:r==null?void 0:r.map(o=>e.jsx(Ee,{label:l(o)},o))}),children:t==null?void 0:t.map(({label:r,value:o})=>e.jsxs(w,{value:o,children:[e.jsx(Pe,{checked:s.includes(o)}),e.jsx(We,{primary:r})]},o))})]})}const Dn=2;function es({formData:n,setFormData:s,options:t,actionsList:i}){const l="consumption",r=t(l),o=ke(n,r,l),[a,c]=y.useState(o),x=d=>{const{value:j}=d.target;j.length<=Dn&&(c(j),we(j,l,s))},h=(d,j)=>{const g=j.reduce((b,S)=>(b[S]={...b[S],type:l,variation:d.target.checked?"appendMost":"standalone"},b),{...n,isAppend:d.target.checked});s(g)};return e.jsxs(e.Fragment,{children:[e.jsx(p,{variant:"h6",sx:{my:2},children:e.jsx(u,{i18nKey:"pickConsumptions"})}),e.jsx(Ae,{onChange:x,values:a,options:r,label:e.jsx(u,{i18nKey:"consumables"})}),!!a.length&&e.jsxs(e.Fragment,{children:[e.jsx(Ce,{}),a.map(d=>e.jsx(ie,{actionsFolder:i,settings:n,option:d,initValue:1,onChange:j=>Ke(j,d,l,s,c,n.isAppend?"appendMost":"standalone")},d)),e.jsx(p,{variant:"h6",sx:{mt:2},children:e.jsx(u,{i18nKey:"standaloneOrCombine"})}),e.jsx(q,{trueCondition:n.isAppend,onChange:d=>h(d,a),yesLabel:"combineWithActions",noLabel:"standaloneConsumables"})]})]})}const ns=4,ss=n=>$(n==null?void 0:n.gameMode)?"solo":n.isNaked?"sex":"foreplay";function ts({formData:n,setFormData:s,options:t,actionsList:i}){const l=ss(n),r=t(l),o=ke(n,r,l),[a,c]=y.useState(o),x=h=>{const{value:d}=h.target;d.length<=ns&&(c(d),we(d,l,s))};return e.jsxs(e.Fragment,{children:[e.jsx(p,{variant:"h6",sx:{my:2},children:e.jsx(u,{i18nKey:"pickActions"})}),e.jsx(Ae,{onChange:x,values:a,options:r,label:e.jsx(u,{i18nKey:"actionsLabel"})}),!!a.length&&e.jsxs(e.Fragment,{children:[e.jsx(Ce,{}),a.map(h=>e.jsx(ie,{actionsFolder:i,settings:n,option:h,initValue:1,onChange:d=>Ke(d,h,l,s,c)},h))]})]})}function is({formData:n,setFormData:s,nextStep:t,prevStep:i,actionsList:l}){function r(c){return Object.keys(l).filter(x=>{var h;return((h=l[x])==null?void 0:h.type)===c})}y.useEffect(()=>{const c=Xn(n);s(c)},[]);const o=c=>r(c).map(x=>{var h;return{value:x,label:(h=l[x])==null?void 0:h.label}}),a=!Object.keys(n).some(c=>n[c].level>0&&n[c].variation!=="appendMost");return e.jsxs(f,{children:[e.jsx(p,{variant:"body",sx:{my:2},children:e.jsx(u,{i18nKey:"actionsDisclaimer"})}),e.jsx(ts,{formData:n,setFormData:s,options:o,actionsList:l}),e.jsx(es,{formData:n,setFormData:s,options:o,actionsList:l}),e.jsxs(Y,{children:[e.jsx(T,{onClick:()=>i(C(n.room)?2:1),children:e.jsx(u,{i18nKey:"previous"})}),e.jsx(T,{variant:"contained",disabled:a,onClick:t,children:e.jsx(u,{i18nKey:"next"})})]})]})}function rs({formData:n,setFormData:s,prevStep:t,actionsList:i,close:l}){const r=[100,100],o=[0,0],a=ae(n.finishRange,o),c=ve();function x(d){s({...n,finishRange:d.target.checked?o:r})}y.useEffect(()=>{let d={...n,boardUpdated:!0};(!a||!ae(n.finishRange,r))&&(d.finishRange=r),s(d)},[]);async function h(){await c(n,i),typeof l=="function"&&l()}return e.jsxs(f,{children:[e.jsx(p,{variant:"h6",sx:{my:2},children:e.jsx(u,{i18nKey:"WillYouOrgasm"})}),e.jsx(p,{variant:"body2",children:e.jsx(u,{i18nKey:"orgasmDisclaimer"})}),e.jsx(f,{sx:{display:"flex",justifyContent:"center",my:1},children:e.jsx(ue,{control:e.jsx(z,{checked:a||!1,onChange:x}),label:e.jsx(u,{i18nKey:a?"yesOrgasm":"noOrgasm"})})}),e.jsxs(Y,{children:[e.jsx(T,{onClick:t,children:e.jsx(u,{i18nKey:"previous"})}),e.jsx(T,{variant:"contained",onClick:h,children:e.jsx(u,{i18nKey:"buildGame"})})]})]})}function ls({close:n}){const{id:s}=H(),[t,i]=y.useState(1),l={room:s};C(s)&&(l.gameMode="online",l.roomRealtime=!0);const[r,o]=be({gameMode:"online",roomRealtime:!0,actions:[],consumption:[],role:"sub"},l),a=y.useRef(!0),{isLoading:c,actionsList:x}=ye(r.gameMode);if(y.useEffect(()=>{if(a.current){if(a.current=!1,r.advancedSettings)return j();if(typeof n=="function"){if(C(s))return i(3);i(2)}}},[r]),c)return e.jsx(Fe,{});const h=b=>{if(!Number.isInteger(b))return i(t+1);i(t+b)},d=b=>{if(!Number.isInteger(b))return i(t-1);i(t-b)},j=()=>i("advanced"),g=()=>{switch(t){case 1:return e.jsx(Hn,{formData:r,setFormData:o,nextStep:h});case 2:return e.jsx(Yn,{formData:r,setFormData:o,nextStep:h,prevStep:d});case 3:return e.jsx(is,{formData:r,setFormData:o,nextStep:h,prevStep:d,actionsList:x});case 4:return e.jsx(rs,{formData:r,setFormData:o,prevStep:d,actionsList:x,close:n});default:return null}};return t==="advanced"?e.jsx(Jn,{closeDialog:n}):e.jsxs(f,{children:[e.jsx(f,{sx:{width:"100%",mt:2,mb:4},children:e.jsx(ze,{activeStep:t-1,alternativeLabel:!0,children:[1,2,3,4].map(b=>e.jsx(Ve,{children:e.jsx(qe,{})},b))})}),g(),e.jsx(O,{sx:{mt:3}}),e.jsx(T,{onClick:j,children:e.jsx(u,{i18nKey:"advancedSetup"})})]})}function os({open:n,close:s=null}){const t=xe(),[i]=Xe();return i.get("importBoard")?null:e.jsxs(_e,{fullScreen:t,open:n,maxWidth:"md",children:[e.jsxs(Je,{children:[e.jsx(u,{i18nKey:"gameSettings"}),typeof s=="function"&&e.jsx(Ye,{close:s})]}),e.jsx(He,{children:e.jsx(ls,{close:s})})]})}const ys=Object.freeze(Object.defineProperty({__proto__:null,default:os},Symbol.toStringTag,{value:"Module"}));export{Jn as G,Z as T,pn as a,os as b,ys as i,un as s,An as u};
