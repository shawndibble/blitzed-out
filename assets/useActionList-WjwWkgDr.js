import{j as e,h as I,f as L,g as W,B as Y,as as U,at as z,au as J,Q as B,aJ as ie,d as be,aK as ve,V as Ce,i as X,aL as Te,l as we,aM as Se,aC as oe,F as Ae,aE as Me,aN as Ee,n as Ie,p as Ge,a0 as Fe,o as Oe,G as Q,D as ke}from"./mui-Bjnq2ocN.js";import{a as r}from"./vendor-Bf6wU4zJ.js";import{C as Le,u as Ke}from"./index-BGwPBW1e.js";import{t as re,v as le,w as De,x as Ne,y as Z,z as Pe,A as Be,B as qe,i as ee,l as Re}from"./index-CA7GOAFo.js";import{A as V,b as H,c as _,u as ae,a as $e}from"./index-C9M40BR9.js";import{T as We}from"./index-e79GV5zf.js";import{f as Ue,a as ze}from"./strings-Bwea5GAd.js";import{i as q,u as R,T as M}from"./translations-CairTNs2.js";function P(n){return[...Object.entries(n).flatMap(([a,{label:o,actions:g}])=>g?Object.keys(g).filter(x=>x!=="None").map((x,i)=>({group:Ue(a),groupLabel:o,value:a,intensity:Number(i+1),translatedIntensity:x,label:`${o} - ${x}`})):[]),{group:q.t("misc"),groupLabel:q.t("misc"),value:"misc",intensity:1,translatedIntensity:q.t("all"),label:`${q.t("misc")} - ${q.t("all")}`}]}function Je(n){var a;if(((a=n.match(/\[|\]/g))==null?void 0:a.length)!==2)throw new Error("ctSeparatorError")}function Ve(n,u){const a=(n==null?void 0:n.sort())||[],o=(u==null?void 0:u.sort())||[];return JSON.stringify(a)===JSON.stringify(o)}function He(n,u){var T,w,j,E;const a=n.split(`
`).filter(Boolean),o=a[0],g=a[1],p=a.find(t=>t.startsWith("Tags:")),x=((j=(w=(T=p==null?void 0:p.replace("Tags:",""))==null?void 0:T.trim())==null?void 0:w.split(", "))==null?void 0:j.filter(Boolean))||[],i=a.find(t=>t.startsWith("GameMode:")),C=((E=i==null?void 0:i.replace("GameMode:",""))==null?void 0:E.trim())||"online",y=o.replace(/\[|\]/g,""),[b,v]=y.split(" - "),G=P(u[C]||{}).find(t=>t.translatedIntensity===v&&t.group===b);if(!G)throw new Error("ctGroupError");if(!g)throw new Error("ctActionError");return{group:G.value,intensity:G.intensity,action:g,tags:x,gameMode:C,isCustom:1}}function _e(n,u,a){const o=(n==null?void 0:n.split("---"))||[];o.forEach(Je);const g=o.map(i=>He(i,a)).filter(Boolean),p=[],x=[];return g.forEach(i=>{const C=u.find(y=>y.group===i.group&&y.intensity===i.intensity&&y.action===i.action&&y.gameMode===i.gameMode);C?C&&!Ve(C.tags,i.tags)&&x.push({...C,tags:i.tags}):p.push(i)}),{newUniqueRecords:p,changedTagRecords:x}}function Qe({expanded:n,handleChange:u,customTiles:a,mappedGroups:o,setSubmitMessage:g,bulkImport:p}){const x=r.useRef(),{t:i}=R(),[C,y]=r.useState(""),b=()=>{const G=a.filter(T=>T.isCustom).map(({group:T,intensity:w,action:j,tags:E,gameMode:t="online"})=>{const l=P(o[t]||{}).find(S=>(S==null?void 0:S.intensity)===Number(w)&&(S==null?void 0:S.value)===T);let c="";return c+=`[${(l==null?void 0:l.group)||T} - ${(l==null?void 0:l.translatedIntensity)||w}]
`,c+=j,c+=E!=null&&E.length?`
Tags: `+(E==null?void 0:E.join(", ")):"",c+=`
GameMode: ${t}`,c});y(G.join(`
---
`))};async function v(d){const{importData:G}=d.current;let T=[],w=[];try{const{newUniqueRecords:j,changedTagRecords:E}=_e(G.value,a,o);T=j,w=E}catch(j){return g({type:"error",message:i(j.message)})}return!T.length&&!w.length?g({type:"error",message:i("ctNoNewError")}):(T.length&&(T.forEach(async j=>{re(`${j.group} - ${j.intensity}`,j.action)}),p(T)),w.length&&await w.forEach(async j=>{await le(j.id,j)}),b())}return r.useEffect(()=>{n==="ctImport"&&b()},[n,a]),e.jsxs(V,{expanded:n==="ctImport",onChange:u("ctImport"),children:[e.jsx(H,{"aria-controls":"ctImport-content",id:"ctImport-header",children:e.jsx(I,{children:e.jsx(M,{i18nKey:"importExport"})})}),e.jsxs(_,{children:[e.jsx(I,{variant:"body1",sx:{mb:2},children:e.jsx(M,{i18nKey:"ctImportDescription"})}),e.jsxs(L,{component:"form",method:"post",ref:x,children:[e.jsx(W,{id:"importData",name:"importData",multiline:!0,required:!0,fullWidth:!0,sx:{pb:2},value:C,onChange:d=>y(d.target.value),InputProps:{endAdornment:e.jsx(Le,{text:C}),sx:{alignItems:"flex-start"}}}),e.jsx(Y,{fullWidth:!0,variant:"contained",type:"button",onClick:()=>v(x),children:e.jsx(M,{i18nKey:"import"})})]})]})]})}function ce(){const[n,u]=r.useState(()=>{try{const o=localStorage.getItem("gameSettings");return o?JSON.parse(o):{locale:"en",gameMode:"online"}}catch(o){return console.error("Error parsing game settings from localStorage:",o),{locale:"en",gameMode:"online"}}});return r.useEffect(()=>{const o=g=>{if(g.key==="gameSettings")try{const p=JSON.parse(g.newValue);u(p)}catch(p){console.error("Error parsing updated game settings:",p)}};return window.addEventListener("storage",o),()=>window.removeEventListener("storage",o)},[]),{settings:n,updateSettings:o=>{const g={...n,...o};localStorage.setItem("gameSettings",JSON.stringify(g)),u(g)}}}function Ye({setSubmitMessage:n,boardUpdated:u,customTiles:a,mappedGroups:o,expanded:g,handleChange:p,tagList:x,updateTileId:i,setUpdateTileId:C}){const{t:y}=R(),{settings:b}=ce(),[v,d]=r.useState({gameMode:b.gameMode||"online",tileOption:null,action:"",tags:[]});r.useEffect(()=>{const m=(Array.isArray(a)?a:[]).find(({id:l})=>l===i);if(m){const l=m.gameMode||b.gameMode,S=P(o[l]||{}).find(({value:O,intensity:K})=>O===m.group&&K===m.intensity);d({gameMode:l,tileOption:S||null,action:m.action||"",tags:m.tags||[]})}else d(l=>({...l,gameMode:b.gameMode}))},[i,b.gameMode,o]);function G(t,m){return(Array.isArray(a)?a:[]).find(({group:c,intensity:S,action:O})=>`${c} - ${S}`===t&&O===m)}function T(){C(null),d({gameMode:b.gameMode,tileOption:null,action:"",tags:[]})}async function w(){const t=document.querySelector('input[name="tags"]'),m=[...v.tags];t&&t.value.trim()&&(m.push(t.value.trim()),t.value="");const{gameMode:l,tileOption:c,action:S}=v;if(!l||!c||!S)return n({message:y("allFieldsRequired","All fields are required"),type:"error"});if(i==null&&G(c,S))return n({message:y("actionExists"),type:"error"});const K=P(o[l]||{}).find(({label:F})=>F===c.label);if(!K)return n({message:y("invalidOption","Invalid option selected"),type:"error"});const A={group:K.value,intensity:K.intensity,action:S,tags:m,gameMode:l};return i===null?(re(K.label,S),De(A)):le(i,A),u(),n({message:y("customAdded"),type:"success"})}const j=t=>{switch(t.key){case",":case"Enter":{t.preventDefault(),t.stopPropagation(),t.target.value.length>0&&(d({...v,tags:[...v.tags,t.target.value]}),t.target.value="");break}}},E=t=>{t.target.value.length>0&&(d({...v,tags:[...v.tags,t.target.value]}),t.target.value=""),setTimeout(()=>{const m=document.querySelector(".MuiAutocomplete-popper");m&&(m.style.display="none")},150)};return e.jsxs(V,{expanded:g==="ctAdd",onChange:p("ctAdd"),children:[e.jsx(H,{"aria-controls":"ctAdd-content",id:"ctAdd-header",children:e.jsx(I,{children:e.jsx(M,{i18nKey:i?"ctUpdate":"ctAdd"})})}),e.jsx(_,{children:e.jsxs(L,{component:"form",method:"post",className:"settings-box",children:[e.jsxs(U,{fullWidth:!0,sx:{mb:2},children:[e.jsx(z,{id:"game-mode-label",children:e.jsx(M,{i18nKey:"customTiles.gameMode"})}),e.jsxs(J,{labelId:"game-mode-label",id:"gameMode",name:"gameMode",value:v.gameMode,label:y("customTiles.gameMode"),onChange:t=>{d({...v,gameMode:t.target.value,tileOption:null})},children:[e.jsx(B,{value:"online",children:e.jsx(M,{i18nKey:"online"})}),e.jsx(B,{value:"local",children:e.jsx(M,{i18nKey:"local"})})]})]}),e.jsx(ie,{id:"tileOption",name:"tileOption",options:P(o[v.gameMode]||{}),getOptionLabel:t=>t.label,groupBy:t=>t.group,value:v.tileOption,onChange:(t,m)=>d({...v,tileOption:m}),renderInput:t=>e.jsx(W,{...t,label:y("group"),required:!0}),isOptionEqualToValue:(t,m)=>t.label===m.label,sx:{mb:2}}),e.jsx(W,{id:"action",name:"action",required:!0,fullWidth:!0,label:y("action"),sx:{pb:2},value:v.action,onChange:t=>{d({...v,action:t.target.value})}}),e.jsx(ie,{id:"tags",name:"tags",disableCloseOnSelect:!0,multiple:!0,freeSolo:!0,options:x,value:v.tags,onChange:(t,m)=>{d({...v,tags:m})},renderInput:t=>(t.inputProps.onKeyDown=j,t.inputProps.onBlur=E,e.jsx(W,{...t,label:y("tags")})),sx:{pb:2},clearOnBlur:!0,blurOnSelect:!0,openOnFocus:!0,disablePortal:!1,componentsProps:{popper:{modifiers:[{name:"preventOverflow",options:{altAxis:!0,altBoundary:!0,padding:8}}]}}}),e.jsxs(L,{display:"flex",justifyContent:"space-evenly",children:[e.jsx(Y,{variant:"contained",type:"button",onClick:()=>T(),children:e.jsx(M,{i18nKey:"clear"})}),e.jsx(Y,{variant:"contained",type:"button",onClick:w,children:e.jsx(M,{i18nKey:i?"ctUpdate":"ctAdd"})})]})]})})]})}function Xe({expanded:n,handleChange:u}){return e.jsxs(e.Fragment,{children:[e.jsxs(V,{expanded:n==="help1",onChange:u("help1"),children:[e.jsx(H,{"aria-controls":"help1-content",id:"help1-header",children:e.jsx(I,{children:e.jsx(M,{i18nKey:"ctExplained"})})}),e.jsx(_,{children:e.jsxs(M,{i18nKey:"ctExplainedDescription",children:[e.jsx(I,{sx:{mb:2},children:"Custom tiles let you add your own variations to the game board. Utilize this dialog to add and remove tiles as you see fit."}),e.jsx(I,{sx:{mb:2},children:"Custom tiles are added based on the kink and intensity you pick from the drop down. As such, you need to have that kink and intensity (or a higher intensity) selected for your custom tiles to show on the board."}),e.jsx(I,{children:"Miscellaneous tiles are the only exception to the above. Regardless of what other options you pick, Miscellaneous tiles will show as their own group. If you use this option, ensure that you add multiple tiles to minimize repeats."})]})})]}),e.jsxs(V,{expanded:n==="help2",onChange:u("help2"),children:[e.jsx(H,{"aria-controls":"help2-content",id:"help2-header",children:e.jsx(I,{children:e.jsx(M,{i18nKey:"ctIdeas"})})}),e.jsx(_,{children:e.jsxs(M,{i18nKey:"ctIdeasDescription",children:[e.jsx(I,{variant:"h6",children:"Add new Activities"}),e.jsx(I,{variant:"subtitle2",sx:{mb:2},children:"Come up with new activities that are not part of the existing list"}),e.jsx(I,{variant:"h6",children:"Add harder tiles to easier intensities"}),e.jsx(I,{variant:"subtitle2",sx:{mb:1},children:"When you pick higher intensity levels, the game will use the earlier intensity level and gradual move to whatyou picked. If you want harder tiles early on, add several to lower intensities."}),e.jsx(I,{variant:"subtitle2",sx:{mb:2},children:"Example: You play Poppers - Advanced. Add advanced tiles to Poppers - Beginner"}),e.jsx(I,{variant:"h6",children:"Combine activities into a single tile"}),e.jsx(I,{variant:"subtitle2",sx:{mb:1},children:"Combine multiple activites together in a single tile that normally would not go together."}),e.jsx(I,{variant:"subtitle2",sx:{mb:2},children:"Example: Spit roast. Use a toy in your throat and ass at the same time."}),e.jsx(I,{variant:"h6",children:"Miscellaneous custom tiles"}),e.jsx(I,{variant:"subtitle2",sx:{mb:1},children:"Miscellaneous tiles allow you to add your own tiles without including other groups. Be aware, you will want to add several options to this group to minimize repeats."})]})})]})]})}function Ze({tagList:n,boardUpdated:u,mappedGroups:a,updateTile:o,refreshTrigger:g}){var te;const{t:p,i18n:x}=R(),{settings:i}=ce(),[C,y]=r.useState(null),[b,v]=r.useState(i.gameMode||"online"),[d,G]=r.useState(""),[T,w]=r.useState(""),[j,E]=r.useState(1),[t]=r.useState(20),[m,l]=r.useState(!0),[c,S]=r.useState({items:[],total:0,totalPages:1}),[O,K]=r.useState({}),[A,F]=r.useState([]);r.useEffect(()=>{async function s(){var h;try{l(!0);const f=await Ne(x.resolvedLanguage,b);K(f);const k=Object.keys(f);if(F(k),!d&&k.length>0){G(k[0]);const N=Object.keys(((h=f[k[0]])==null?void 0:h.intensities)||{});N.length>0&&w(Number(N[0]))}}catch(f){console.error("Error loading groups:",f)}finally{l(!1)}}s()},[b,x.resolvedLanguage]),r.useEffect(()=>{let s=!0;async function h(){try{l(!0);const f={group:d,intensity:T,tag:C,gameMode:b,locale:i.locale,page:j,limit:t,paginated:!0},k=await Z(f);s&&(S(k),setTimeout(()=>{s&&l(!1)},300))}catch(f){console.error("Error loading tiles:",f),s&&l(!1)}}return d?h():l(!1),()=>{s=!1}},[d,T,C,b,j,t,g,i.locale]);function D(s){l(!0),y(C===s?null:s)}function ue(s){l(!0);const h=s.target.value;if(G(h),E(1),w(""),h&&O[h]){const f=Object.keys(O[h].intensities||{});f.length>0&&w(Number(f[0]))}}function de(s){l(!0),w(s.target.value),E(1)}function me(s,h){l(!0),E(h)}async function ge(s){await Pe(s),u();const h={group:d,intensity:T,tag:C,gameMode:b,locale:i.locale,page:j,limit:t,paginated:!0},f=await Z(h);S(f)}async function pe(s){await Be(s),u(),S(h=>({...h,items:h.items.map(f=>f.id===s?{...f,isEnabled:!f.isEnabled}:f)}))}function he(s){o(s);const h=document.querySelector(".MuiDialogContent-root");h&&(h.scrollTop=0)}const xe=(te=c.items)==null?void 0:te.map(({id:s,group:h,intensity:f,action:k,tags:N,isEnabled:fe=!0,isCustom:ye=!0})=>{var se,ne;return e.jsxs(be,{sx:{my:2},children:[e.jsx(ve,{title:k,titleTypographyProps:{variant:"body1"},subheader:(ne=(se=P(a[b]||{}))==null?void 0:se.find(({value:$,intensity:je})=>$===h&&je===Number(f)))==null?void 0:ne.label,subheaderTypographyProps:{variant:"body2"},action:e.jsxs(e.Fragment,{children:[e.jsx(Ce,{checked:!!fe,onChange:()=>pe(s),inputProps:{"aria-label":p("customTiles.toggleTile")}}),!!ye&&e.jsxs(e.Fragment,{children:[e.jsx(X,{"aria-label":p("customTiles.update"),onClick:()=>he(s),children:e.jsx(Te,{})}),e.jsx(X,{"aria-label":p("customTiles.delete"),onClick:()=>ge(s),children:e.jsx(we,{})})]})]}),sx:{pb:0}}),e.jsx(Se,{children:N==null?void 0:N.map($=>e.jsx(oe,{label:$,sx:{m:.5}},$))})]},s)});return e.jsxs(L,{children:[e.jsxs(L,{sx:{display:"flex",flexDirection:"column",gap:2,mb:2,transition:"all 0.3s ease-in-out"},children:[e.jsxs(L,{sx:{display:"flex",flexWrap:"wrap",gap:2},children:[e.jsxs(U,{sx:{width:125,flexShrink:0},children:[e.jsx(z,{id:"game-mode-filter-label",children:e.jsx(M,{i18nKey:"customTiles.gameMode"})}),e.jsxs(J,{labelId:"game-mode-filter-label",id:"game-mode-filter",value:b,label:p("customTiles.gameMode","Game Mode"),onChange:s=>{v(s.target.value),G(""),w(""),E(1)},children:[e.jsx(B,{value:"online",children:e.jsx(M,{i18nKey:"online"})}),e.jsx(B,{value:"local",children:e.jsx(M,{i18nKey:"local"})})]})]}),e.jsxs(U,{sx:{minWidth:150,flex:1},children:[e.jsx(z,{id:"group-filter-label",children:e.jsx(M,{i18nKey:"customTiles.filterByGroup",children:"Filter by Group"})}),e.jsx(J,{labelId:"group-filter-label",id:"group-filter",value:d,label:"Filter by Group",onChange:ue,children:A.map(s=>{var h,f;return e.jsxs(B,{value:s,children:[((f=(h=P(a[b]||{}))==null?void 0:h.find(k=>k.value===s))==null?void 0:f.groupLabel)||s,O[s]&&` (${O[s].count})`]},s)})})]}),e.jsxs(U,{sx:{minWidth:200,flex:1},disabled:!d,children:[e.jsx(z,{id:"intensity-filter-label",children:e.jsx(M,{i18nKey:"customTiles.intensityLevel",children:"Intensity Level"})}),e.jsx(J,{labelId:"intensity-filter-label",id:"intensity-filter",value:T,label:"Intensity Level",onChange:de,children:d&&O[d]&&Object.entries(O[d].intensities||{}).sort(([s],[h])=>Number(s)-Number(h)).map(([s,h])=>{var f,k;return e.jsxs(B,{value:Number(s),children:[((k=(f=P(a[b]||{}))==null?void 0:f.find(N=>N.value===d&&N.intensity===Number(s)))==null?void 0:k.translatedIntensity)||`Level ${s}`,` (${h})`]},s)})})]})]}),e.jsx(L,{children:n==null?void 0:n.map(s=>e.jsx(oe,{label:s,sx:{m:.5},color:C===s?"primary":"default",onClick:()=>D(s)},s))})]}),e.jsxs(L,{sx:{position:"relative",minHeight:"200px"},children:[e.jsx(Ae,{in:m,timeout:300,children:e.jsx(L,{sx:{position:"absolute",top:0,left:0,right:0,bottom:0,display:"flex",justifyContent:"center",alignItems:"center",backgroundColor:"rgba(255, 255, 255, 0)",zIndex:1,borderRadius:1},children:e.jsx(Me,{})})}),e.jsx(L,{sx:{opacity:m?.3:1,transition:"opacity 0.3s ease-in-out",pointerEvents:m?"none":"auto"},children:c.items.length===0?e.jsx(I,{variant:"body1",sx:{textAlign:"center",my:4},children:e.jsx(M,{i18nKey:"customTiles.noTilesFound",children:"No tiles found with the selected filters."})}):e.jsxs(e.Fragment,{children:[xe,c.totalPages>1&&e.jsx(L,{sx:{display:"flex",justifyContent:"center",mt:3,mb:2},children:e.jsx(Ee,{count:c.totalPages,page:j,onChange:me,color:"primary"})}),e.jsx(I,{variant:"body2",sx:{textAlign:"center",mt:2,color:"text.secondary"},children:e.jsxs(M,{i18nKey:"customTiles.showingTiles",values:{shown:c.items.length,total:c.total},children:["Showing ",{shown:c.items.length}," of ",{total:c.total}," tiles"]})})]})})]})]})}function lt({boardUpdated:n,setOpen:u,open:a=!1}){const{t:o,i18n:g}=R(),p=ae(),x=ae("md"),[i,C]=r.useState({message:"",type:"info"}),[y,b]=r.useState("ctAdd"),[v,d]=r.useState(null),[G,T]=r.useState(0),[w,j]=r.useState({online:{},local:{}}),[E,t]=r.useState(!0),m=r.useCallback(()=>{T(A=>A+1)},[]),l=A=>(F,D)=>{b(D?A:!1)};r.useEffect(()=>{async function A(){t(!0);try{const[F,D]=await Promise.all([ee(g.resolvedLanguage,"online"),ee(g.resolvedLanguage,"local")]);j({online:F,local:D})}catch(F){console.error("Error loading game mode actions:",F)}finally{t(!1)}}A()},[g.resolvedLanguage]);const c=Ke(()=>Z({paginated:!1})),S=r.useMemo(()=>c?Array.isArray(c)?c.map(({tags:A})=>A).flat().filter((A,F,D)=>A&&D.indexOf(A)===F).sort():[]:[],[c]),O=r.useCallback(async A=>{await qe(A),n(),m()},[n,m]);if(!c||E)return null;const K=()=>{const A=e.jsxs(e.Fragment,{children:[e.jsx(Xe,{expanded:y,handleChange:l}),e.jsx(Ye,{setSubmitMessage:C,boardUpdated:()=>{n(),m()},customTiles:c,mappedGroups:w,expanded:y,handleChange:l,tagList:S,updateTileId:v,setUpdateTileId:d}),e.jsx(Qe,{expanded:y,handleChange:l,customTiles:c,mappedGroups:w,setSubmitMessage:C,bulkImport:O})]}),F=Array.isArray(c)&&c.length>0&&e.jsx(L,{sx:{pt:1},children:e.jsx(Ze,{tagList:S,boardUpdated:()=>{n(),m()},mappedGroups:w,updateTile:D=>{d(D),b("ctAdd")},refreshTrigger:G})});return x?e.jsxs(e.Fragment,{children:[A,F&&e.jsxs(e.Fragment,{children:[e.jsx(ke,{sx:{my:2}}),F]})]}):e.jsxs(Q,{container:!0,spacing:2,children:[e.jsx(Q,{item:!0,size:{xs:12,md:6},children:A}),e.jsx(Q,{item:!0,size:{xs:12,md:6},children:F})]})};return e.jsxs(e.Fragment,{children:[e.jsxs(Ie,{fullScreen:p,open:a,onClose:()=>u(!1),maxWidth:x?"sm":"lg",fullWidth:!0,children:[e.jsxs(Ge,{children:[e.jsx(M,{i18nKey:"manageTiles"}),e.jsx(X,{"aria-label":o("close"),onClick:()=>u(!1),sx:{position:"absolute",right:8,top:8,color:A=>A.palette.grey[500]},children:e.jsx(Fe,{})})]}),e.jsx(Oe,{children:K()})]}),e.jsx(We,{open:!!i.message,close:()=>C({message:"",type:"info"}),type:i.type,children:i.message})]})}function ct(n={},u={}){const a=$e("gameSettings")[0],[o,g]=r.useState({...n,...a,...u}),{messages:p}=ze();return r.useEffect(()=>{const x=Re(p,"room");x!=null&&x.settings&&g(i=>({...i,...JSON.parse(x.settings)}))},[p]),[o,g]}function ut(n){const{i18n:u}=R(),[a,o]=r.useState({}),[g,p]=r.useState(!0),x=async()=>{if(!n)return;p(!0);const i=await ee(u.resolvedLanguage,n);o(i),p(!1)};return r.useEffect(()=>{x()},[u.resolvedLanguage,n]),{actionsList:a,isLoading:g}}export{lt as C,ut as a,ct as u};
