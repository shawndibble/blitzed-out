import{j as e,g as F,l as z,k as V,bi as W,v as H,o as G,q as J,p as M,f as E,B as N,bj as Q,h as S,V as U,m as X,X as Y}from"./mui-VGUUbzNb.js";import{a as _,C as R,b as Z,c as b,d as ee}from"./index-CcHQ0oEU.js";import{C as K,u as se}from"./index-BLZhfqs4.js";import{r as p}from"./vendor-yP7igga9.js";import{J as P,u as te,h as ie,K as ne,N as oe,v as ae,s as le,O as re}from"./index-ibjflcvy.js";import{u as ce,T as O,t as g}from"./translations-Bhk7i5vx.js";import{T as de}from"./index-lCKdBxpn.js";import"./strings-BjbSR3e6.js";import"./firebase-C4LKcFbe.js";function ue({open:f,close:v,setAlert:a,board:n}){const{t}=ce(),[d,x]=p.useState(""),[l,k]=p.useState(n.title);function B(i){try{return l.length?i.map((o,u)=>{const[r,...j]=o.split(`
`).filter(A=>A);if(r===void 0)throw a({message:t("importNoEmpty")});if(!/^\[.+\]$/.test(r))throw a({message:t("importInvalidTitle",{entry:u+1})});if(!j.length)throw a({message:t("importMissingDescription",{entry:u+1})});return{title:r==null?void 0:r.replace(/\[|\]/g,""),description:j.join(`
`)}}):a({message:t("importTitleRequired")})}catch{return null}}const m=async()=>{const i=d.split(/~+/).filter(u=>u),o=B(i);if(!o)return null;if(JSON.stringify(n.tiles)===JSON.stringify(o))return a({message:t("importNoChange")});P({...n,title:l,tiles:o}),a({message:t("saved"),type:"success"}),v()},D=()=>{var o;const i=(o=n==null?void 0:n.tiles)==null?void 0:o.map(({title:u,description:r})=>`[${u}]
${r}`);x(i==null?void 0:i.join(`
~~
`))},w=i=>{k(i.target.value)},I=async i=>{if(!i.target.value.length)return a({message:t("importTitleRequired")});P({...n,title:i.target.value})};return p.useEffect(()=>{f&&D()},[f]),e.jsxs(e.Fragment,{children:[e.jsx(F,{fullWidth:!0,label:t("title"),value:l,onChange:w,onBlur:I}),e.jsx(F,{sx:{mt:2},multiline:!0,fullWidth:!0,value:d,onChange:i=>x(i.target.value),InputProps:{endAdornment:e.jsxs("div",{style:{display:"flex",flexDirection:"column",position:"sticky",top:0},children:[e.jsx(z,{title:t("save"),children:e.jsx(V,{size:"small",onClick:m,children:e.jsx(W,{color:"success"})})}),e.jsx(K,{text:d}),e.jsx(K,{text:`${window.location.href}?importBoard=${n.id}`,copiedText:t("copiedLink"),icon:e.jsx(H,{}),tooltip:t("copyShareLink")})]}),sx:{alignItems:"flex-start"}}})]})}function Be({open:f,close:v,isMobile:a}){var L;const n=se(re),[t,d]=p.useState(null),[x,l]=p.useState(!1),[k,B]=p.useState(!1),m=_("gameSettings")[0],{user:D}=te();if(!n)return null;const w=s=>s[s.length-1].description.match(/\d+%/g);async function I({title:s,tiles:c}){const h=c.map(({title:q})=>`* ${q} 
`);h.pop(),h.shift();let y=`### ${g("activated")}: ${s}
`;y+=`---
`,y+=[...new Set(h)].join(" "),y+=`---
`;const T=w(c);T.length===3&&(y+=`* ${g("finishSlider")} ${T[0]}  | ${T[1]} | ${T[2]}`);const C=await ae({gameBoard:JSON.stringify(c),settings:JSON.stringify(m)});C!=null&&C.id&&await le({room:m.room||"PUBLIC",user:D,text:y,type:"settings",gameBoardId:C.id,boardSize:c.length,gameMode:m.gameMode})}const i=async()=>{const s=await ie({isActive:0});B(s)},o=s=>{ne(s.id),I(s),d({message:g("boardEnabled"),type:"success"})},u=s=>{l(s)},r=()=>{oe(x),l(0)},j=s=>(c,h)=>{B(h?s:!1)},$=s=>!s.tiles||s.tiles.length!==(m.roomTileCount||40),A=s=>$(s)?g("boardWrongSize",{size:m.roomTileCount||40}):s.isActive?g("boardActive"):g("enableBoard");return e.jsxs(e.Fragment,{children:[e.jsxs(G,{fullScreen:a,open:f,onClose:v,PaperProps:{sx:{maxHeight:"100%",height:"100%"}},children:[e.jsxs(J,{children:[e.jsx(O,{i18nKey:"manageGameBoards"}),e.jsx(R,{close:v})]}),e.jsxs(M,{style:{overflowY:"scroll"},children:[e.jsxs(E,{sx:{mb:1},children:[e.jsx(N,{variant:"outlined",onClick:i,endIcon:e.jsx(Q,{}),sx:{float:"right"},children:e.jsx(O,{i18nKey:"add"})}),e.jsx(S,{children:e.jsx(O,{i18nKey:"gameBoardDescription"})})]}),n.map(s=>{var c;return e.jsxs(Z,{expanded:k===s.id,onChange:j(s.id),children:[e.jsxs(b,{children:[e.jsxs(E,{children:[e.jsx(S,{variant:"body1",children:s.title}),e.jsxs(S,{variant:"body2",children:[(c=s.tiles)==null?void 0:c.length," tiles"]})]}),e.jsxs(E,{style:{marginLeft:"auto"},justifyContent:"flex-end",children:[e.jsx(z,{title:A(s),children:e.jsx("div",{style:{display:"inline-block"},children:e.jsx(U,{checked:!!s.isActive,disabled:!!s.isActive||$(s),onChange:()=>o(s),size:"small"})})}),e.jsx(z,{title:g("delete"),children:e.jsx("div",{style:{display:"inline-block"},children:e.jsx(V,{onClick:()=>u(s.id),size:"small",children:e.jsx(X,{color:"error"})})})})]})]}),e.jsx(ee,{children:e.jsx(ue,{open:f,close:j(null),setAlert:d,board:s})})]},s.id)})]})]}),e.jsx(de,{open:!!(t!=null&&t.message),type:(t==null?void 0:t.type)||"error",setOpen:d,close:()=>d(null),children:t==null?void 0:t.message}),e.jsxs(G,{open:!!x,onClose:()=>l(0),children:[e.jsxs(J,{children:["Delete Board",e.jsx(R,{close:()=>l(0)})]}),e.jsx(M,{children:e.jsxs(S,{variant:"body1",children:['Are you sure you want to delete "',(L=n.find(s=>s.id===x))==null?void 0:L.title,'"?']})}),e.jsxs(Y,{children:[e.jsx(N,{onClick:()=>l(0),children:"Cancel"}),e.jsx(N,{onClick:r,children:"Delete"})]})]})]})}export{Be as default};
