import{j as e,f as $,aA as K,aB as N,aC as P,g as ee,Q as w,i as re,R as ge,U as V,h as m,D as A,G as k,az as B,as as me,at as be,aK as fe,av as ye,aL as Se,aM as ve,aN as Ce,l as E,aO as ne,a1 as we,x as ke,y as J,B as le}from"./mui-L4zu-Z7u.js";import{T as Te}from"./index-CXFe5uNT.js";import{d as W,i as R,a as Ue,b as H}from"./strings-DJPdFYFN.js";import{s as ae,x as Re,i as $e,g as ue,j as de,c as he,l as Oe,u as xe}from"./index-5po6uqb1.js";import{a as F}from"./index-DYKG7Fyu.js";import{r as b,u as te,k as Ae}from"./vendor-BqRCY_y4.js";import{u as Be,a as Le,C as Me}from"./useActionList-nIdrtxcU.js";import{i as z,u as T,T as j,t as se}from"./translations-BGyRMCWP.js";import{u as Z}from"./index-D2OEgVdA.js";import{a as Ke,i as Ie}from"./urls-BP4ggioV.js";function Ne(n){const{t}=z;let s=`### ${t("roomSettings")}\r
`;return Object.entries(n).forEach(([i,l])=>{if(i!=="room"){if(i==="roomBackgroundURL"&&l!==""){s+=`* ${t(i)}: [${Ke(l)}:link:](${l})\r
`;return}if(i==="roomRealtime"){s+=`* ${t("playerList")}: ${t(l?"delayed":"realtime")}\r
`;return}l!==""&&(s+=`* ${t(i)}: ${l}\r
`)}}),s}function Pe(n){const t={};return Object.entries(n).forEach(([s,i])=>{s.startsWith("room")&&!["roomUpdated","roomBackground"].some(l=>l===s)&&(t[s]=i)}),t}async function Ee(n,t,s){let i=n;return t!==void 0&&t.length>0&&(i=await s(t)),i}function We(n,t){const s=Pe(n);return ae({room:n.room,user:t,text:Ne(s),type:"room",settings:JSON.stringify(s)})}function Ge(n,t,s){const i=Object.entries(s).filter(([r])=>n[r]).reduce((r,[o,c])=>(r[o]=Object.keys(c.actions).slice(1,n[o]+1),r),{});return((t==null?void 0:t.filter(r=>{if(r.group==="misc")return!0;const o=i[r.group];return o&&o.length>=Number(r.intensity)}))||[]).length}function ze(n,t,s,i){const{t:l}=z;let r=`### ${z.t("gameSettings")}\r
`;if(i&&(r+=`##### ${i}\r
`),r+=`--- \r
`,Object.entries(s).forEach(([u,h])=>{if(!n[u])return;const{role:x,variation:d,level:p}=n[u],y=x||n.role||"sub";if(p>0){const S=Object.keys((h==null?void 0:h.actions)||{});if(r+=`* ${h==null?void 0:h.label}: ${S[p]||""}`,d&&(r+=` (${l(d)})`),!W(n.gameMode)&&!d){const g=h[y]??l(y);r+=` (${g})`}r+=`\r
`}}),r.endsWith(`--- \r
`))return"";const{finishRange:o,difficulty:c}=n;r+=`--- \r
`,r+=`* ${l("difficulty")}: ${l(c??"normal")} \r
`,o&&(r+=`* ${l("finishSlider")} ${o[0]}%  | ${o[1]-o[0]}% | ${100-o[1]}%`);const a=Ge(n,t,s);return a&&(r+=`* ${l("customTilesLabel")}: ${a} \r
`),r}function Ve(n){const t={};return Object.entries(n).forEach(([s,i])=>{!["displayName","background","boardUpdated","chatSound","mySound","otherSound","othersDialog","playerDialog","readRoll","hideBoardActions","advancedSettings"].includes(s)&&!s.startsWith("room")&&(t[s]=i)}),t}async function Fe({title:n,formData:t,user:s,actionsList:i,tiles:l,customTiles:r=[],reason:o=""}){const c=JSON.stringify(Ve(t)),a=await Re({title:n,gameBoard:JSON.stringify(l),settings:c}),u=ze(t,r,i,o);if(!(!(a!=null&&a.id)||u===""))return ae({room:(t==null?void 0:t.room)||"PUBLIC",user:s,text:u,type:"settings",gameBoardId:a.id,boardSize:l.length,gameMode:t.gameMode})}function qe(n){for(let t=n.length-1;t>0;t-=1){const s=Math.floor(Math.random()*(t+1));[n[t],n[s]]=[n[s],n[t]]}return n}function oe(n){n.length>1&&n.push(n.shift())}function Pn(n,t){return(n==null?void 0:n.length)!==(t==null?void 0:t.length)?!1:n.every((s,i)=>s===t[i])}const{t:I}=z;function _e(n,t){return n.filter(s=>t==="vers"?s.includes("{sub}")&&s.includes("{dom}")||s.includes("{player}"):!s.match(/{(dom|sub)}/)||s.includes(`{${t}}`))}function Je(n,t,s){var r;const i=((r=n[t])==null?void 0:r.role)??n.role??"sub";return Object.keys(s).reduce((o,c,a)=>{var u;return a>0&&a<=((u=n[t])==null?void 0:u.level)&&(o[c]=qe(_e(s[c],i))),o},{})}function He(n,t){return Object.entries(n).filter(([s])=>{var i;return((i=t[s])==null?void 0:i.level)>0}).map(([s,i])=>{var l;return{label:i.label,actions:Je(t,s,i==null?void 0:i.actions),key:s,standalone:!1,role:((l=t[s])==null?void 0:l.role)??t.role??"sub"}})}function Qe(n,t){return t.length&&(t.some(({group:s})=>s==="misc")&&n.push({label:I("misc"),actions:{All:[]},key:"misc",standalone:!1}),t.forEach(({group:s,intensity:i,action:l})=>{const r=n.find(o=>o.key===s);if(r&&Object.keys(r.actions).length>=i){const o=Object.values(r.actions)[i-1];if(o){const c=Math.floor(Math.random()*(o.length+1));o.splice(c,0,l)}}})),n}function Ye(n){return Object.entries(n).reduce((t,[s,i])=>(i!=null&&i.variation&&(t[s]=i),t),{})}function Xe(n,t){const s=[],i=[...t];return Object.entries(n).forEach(([l,{level:r,variation:o}])=>{if(r<=0)return;const c=t.findIndex(u=>u.key===l);if(c===-1)return;if(o==="standalone"){i[c].standalone=!0;return}const a=o==="appendSome"?.4:.9;s.push({...t[c],frequency:a}),i.splice(c,1)}),{appendList:s,listWithoutAppend:i}}function Ze(n,t,s,i){if([void 0,"normal"].includes(i)){const l=n/t;return Math.floor(s/l)}return t>=3&&Math.random()>=.6?t-2:t-1}function ce(n,t,s,i){oe(n);const{actions:l,label:r,standalone:o,frequency:c,role:a}=n[0],u=Math.random();if(c&&c<=u)return{title:"",description:""};const h=Object.keys(l),x=Object.values(l);let d=Ze(t,h.length,s,i==null?void 0:i.difficulty);return x[d]||(d=Math.max(0,d-1)),x[d]&&x[d].length>0?(oe(x[d]),{title:r,description:x[d][0],standalone:o,role:a}):{title:"",description:""}}function De(n,t,s){const i=Ye(t),{listWithoutAppend:l,appendList:r}=Xe(i,n),o=[];for(let c=1;c<=s;c+=1){const{title:a,description:u,standalone:h,role:x}=ce(l,s,c,t);let d="";if(!h&&r.length&&u){const{description:p}=ce(r,s,c,t);p?d=`${p.trim().replace(/([^.,!?])$/,"$1.")} ${u}`:d=u}else d=u||"";o.push({title:a,description:d.trim(),role:x})}return o}function en(n,t){const s={title:I("start"),description:I("start")},{finishRange:i=[33,66]}=t,l=`${I("noCum")} ${i[0]}%\r
${I("ruined")} ${i[1]-i[0]}%\r
${I("cum")} ${100-i[1]}%`,r={title:I("finish"),description:l};return[s,...n,r]}function nn(n,t,s=[],i=40){const l=Object.entries(t).reduce((a,[u,h])=>(a[u]={...h,actions:Object.keys(h.actions||{}).reduce((x,d)=>(x[d]=[],x),{})},a),{}),r=He(l,n);!r.length&&!s.length&&(localStorage.clear(),window.location.reload());const o=Qe(r,s),c=De(o,n,i-2);return en(c,n)}function tn(){const n=Z(he),[t,s]=F("gameSettings"),{i18n:i}=T(),l=b.useCallback(async r=>{var f;const o=r!=null&&r.roomUpdate||r!=null&&r.boardUpdated?r:{...t,...r};let{gameMode:c,boardUpdated:a}=o;const{roomTileCount:u=40,finishRange:h,room:x}=o,d=R(x||"");if(!r||!h)return{gameMode:c};d&&!W(c||"")&&(c="online",a=!0);const p=await $e(i.resolvedLanguage,c||"online"),y=d?40:u||40,S=await ue(c||"online"),g=nn(o,p,S,y);return(r!=null&&r.boardUpdated||a||((f=n==null?void 0:n.tiles)==null?void 0:f.length)!==g.length)&&(await s(o),await de({title:(n==null?void 0:n.title)||"",tiles:g})),{settingsBoardUpdated:a,gameMode:c,newBoard:g}},[n,i.resolvedLanguage,t,s]);return b.useCallback(r=>l(r),[l])}function Q({children:n,value:t,index:s,style:i,...l}){return e.jsx("div",{role:"tabpanel",hidden:t!==s,id:`simple-tabpanel-${s}`,"aria-labelledby":`simple-tab-${s}`,...l,children:t===s&&e.jsx($,{sx:{p:3,...i},children:n})})}function pe({formData:n,setFormData:t,backgrounds:s,isRoom:i=!1}){const{t:l}=T(),r=i?"roomBackground":"background",o=i?"roomBackgroundURL":"backgroundURL",[c,a]=b.useState((n==null?void 0:n[r])||Object.keys(s)[0]),u=()=>Object.entries(s).map(([d,p])=>e.jsx(w,{value:d,children:p},d)),h=d=>{t({...n,[r]:d.target.value}),a(d.target.value)};b.useEffect(()=>{c!==(n==null?void 0:n[r])&&a((n==null?void 0:n[r])||"")},[n,c,r]);const x=d=>{const p={...n,[r]:"custom",[o]:d.target.value};i&&(p.roomUpdated=!0),t(p)};return e.jsxs(e.Fragment,{children:[e.jsxs(K,{fullWidth:!0,margin:"normal",children:[e.jsx(N,{id:"background-label",children:l("background")}),e.jsx(P,{labelId:"background-label",id:"background",label:l("background"),value:c||"",onChange:h,children:u()})]}),c==="custom"&&e.jsx(ee,{sx:{mt:2},label:l("url"),value:(n==null?void 0:n[o])||"",fullWidth:!0,onChange:x,helperText:e.jsxs(e.Fragment,{children:[l("supportedSites"),e.jsx("br",{}),l("requiresEmbeddedUrl")]})})]})}function sn({boardUpdated:n}){const{i18n:t}=T(),[s,i]=b.useState(t.resolvedLanguage||"en");function l(o){i(o),t.changeLanguage(o),n()}const r=Object.entries(Oe).map(([o,c])=>e.jsx(w,{value:o,children:c.label},o));return e.jsx($,{sx:{minWidth:120,mt:1,mb:2},children:e.jsxs(K,{fullWidth:!0,children:[e.jsxs(N,{id:"language-label",sx:{display:"flex",alignItems:"center"},children:[e.jsx(re,{sx:{mr:1}}),e.jsx(j,{i18nKey:"language"})]}),e.jsx(P,{labelId:"language-label",id:"language-select",value:s,label:e.jsxs(e.Fragment,{children:[e.jsx(re,{}),e.jsx(j,{i18nKey:"language"})]}),onChange:o=>l(o.target.value),children:r})]})})}function rn({trueCondition:n,onChange:t,yesLabel:s,noLabel:i=null,sx:l={}}){const r=i??s;return e.jsx($,{sx:{display:"flex",justifyContent:"center",my:1,...l},children:e.jsx(ge,{control:e.jsx(V,{checked:n||!1,onChange:t}),label:se(n?s:r)})})}function M({field:n,formData:t,handleSwitch:s}){return e.jsx(rn,{trueCondition:t[n],onChange:i=>s(i,n),yesLabel:`${n}Enable`,sx:{justifyContent:"left"}})}function ln({formData:n,setFormData:t,boardUpdated:s}){const[i,l]=F("gameSettings"),{t:r}=T(),o={color:r("color"),gray:r("gray"),"metronome.gif":r("hypnoDick"),"pink-spiral.gif":r("pinkSpiral"),custom:r("customURL")};function c(a,u){t({...n,[u]:a.target.checked}),l({...i,[u]:a.target.checked})}return e.jsxs(e.Fragment,{children:[e.jsx(sn,{boardUpdated:s}),e.jsx(m,{variant:"h5",children:e.jsx(j,{i18nKey:"dialog"})}),e.jsx(M,{field:"playerDialog",formData:n,handleSwitch:c}),e.jsx(M,{field:"othersDialog",formData:n,handleSwitch:c}),e.jsx(A,{}),e.jsx(m,{variant:"h5",sx:{mt:2},children:e.jsx(j,{i18nKey:"sounds"})}),e.jsx(M,{field:"mySound",formData:n,handleSwitch:c}),e.jsx(M,{field:"otherSound",formData:n,handleSwitch:c}),e.jsx(M,{field:"chatSound",formData:n,handleSwitch:c}),e.jsx(M,{field:"readRoll",formData:n,handleSwitch:c}),e.jsx(A,{}),e.jsx(m,{variant:"h5",sx:{mt:2,textTransform:"capitalize"},children:e.jsx(j,{i18nKey:"misc"})}),e.jsx(M,{field:"hideBoardActions",formData:n,handleSwitch:c}),e.jsx(M,{field:"advancedSettings",formData:n,handleSwitch:c}),e.jsx(pe,{formData:n,setFormData:t,backgrounds:o}),e.jsx(A,{})]})}function Y({children:n}){return e.jsx(k,{size:{xs:12,md:5},children:n})}const D=b.forwardRef(({value:n,onChange:t,label:s,options:i,defaultValue:l=null,sx:r,helpIcon:o=!1,fullWidth:c=!0,...a},u)=>{const h=i.map(x=>typeof x=="string"?e.jsx(w,{value:x,children:se(x)},x):e.jsx(w,{value:x.value,children:x.label},x.value));return e.jsxs(K,{fullWidth:c,margin:"normal",sx:r,...a,ref:u,children:[e.jsxs(N,{id:`${s}Label`,children:[e.jsx(j,{i18nKey:s}),!!o&&e.jsx(B,{sx:{ml:1,fontSize:16}})]}),e.jsx(P,{labelId:`${s}Label`,id:s,label:e.jsxs(e.Fragment,{children:[e.jsx(j,{i18nKey:s}),!!o&&e.jsx(B,{sx:{ml:1,fontSize:16}})]}),value:n||l||"",onChange:t,children:h})]})});function X({children:n,title:t,subtitle:s,defaultExpanded:i=!1,...l}){return e.jsxs(me,{defaultExpanded:i,...l,sx:{backgroundColor:"inherit",backgroundImage:"none",boxShadow:"none"},children:[e.jsxs(be,{expandIcon:e.jsx(fe,{}),sx:{px:0},children:[e.jsxs(m,{variant:"h6",sx:{width:"33%"},children:[t,":"]}),e.jsx(m,{sx:{pt:.5},children:s})]}),e.jsx(ye,{sx:{px:0},children:e.jsx(k,{container:!0,columnSpacing:2,justifyContent:"space-evenly",className:"columned-grid",children:n})})]})}function on({formData:n,setFormData:t}){const s=(l,r)=>{t({...n,finishRange:r,boardUpdated:!0})},i=(n==null?void 0:n.finishRange)||[30,70];return e.jsxs($,{children:[e.jsx(A,{}),e.jsx(m,{id:"finish-slider",sx:{my:1},children:e.jsx(j,{i18nKey:"finishSlider"})}),e.jsx(Se,{"aria-labelledby":"finish-slider",value:i,onChange:s,valueLabelDisplay:"off"}),e.jsxs($,{display:"flex",flexDirection:"column",justifyContent:"space-between",textAlign:"center",children:[e.jsxs(m,{whiteSpace:"nowrap",children:[e.jsx(j,{i18nKey:"noCum"})," ",i[0],"%"]}),e.jsxs(m,{whiteSpace:"nowrap",children:[e.jsx(j,{i18nKey:"ruined"})," ",i[1]-i[0],"%"]}),e.jsxs(m,{whiteSpace:"nowrap",children:[e.jsx(j,{i18nKey:"cum"})," ",100-i[1],"%"]})]}),e.jsx(A,{sx:{my:1}})]})}function cn(){const[n,t]=b.useState(!1);return b.useEffect(()=>{const s=window.matchMedia("(pointer: fine)");t(s.matches);const i=l=>{t(l.matches)};return s.addEventListener("change",i),()=>{s.removeEventListener("change",i)}},[]),n}function an({actionsFolder:n,settings:t,option:s,onChange:i,initValue:l=0}){var p,y,S;const r=`${s}label`,o=(p=n[s])==null?void 0:p.label,c=cn(),[a,u]=b.useState(((y=t[s])==null?void 0:y.level)||0),h=g=>{u(g)},x=g=>a>0&&g===0?!1:t.difficulty==="accelerated"?a<=2?a===g:a===g||a-1===g:a>=g;function d(g){var f;return Object.keys(((f=n[g])==null?void 0:f.actions)||{}).map((U,v)=>e.jsxs(w,{value:v,onMouseOver:()=>h(v),children:[!!c&&e.jsx("span",{className:"menu-item-icon",children:x(v)?e.jsx(ve,{}):e.jsx(Ce,{})}),U]},`${g}-${U}`))}return e.jsxs(K,{margin:"normal",fullWidth:!0,children:[e.jsx(N,{id:r,children:o}),e.jsx(P,{labelId:r,id:s,label:o,value:((S=t[s])==null?void 0:S.level)||l,onChange:i,onOpen:()=>{var g;return u(((g=t[s])==null?void 0:g.level)||l)},onClose:()=>{var g;return u(((g=t[s])==null?void 0:g.level)||l)},children:d(s)})]})}function un({option:n,settings:t,setSettings:s,actionsFolder:i,type:l,showVariation:r=!1,showRole:o=!1}){var p,y,S,g;const{t:c}=T(),a=`${n}label`,u=(p=i[n])==null?void 0:p.label;function h(f,U,v){var L;s({...t,[U]:{...t[U],type:l,[v]:(L=f==null?void 0:f.target)==null?void 0:L.value},boardUpdated:!0})}let x=12;(r||o)&&(x=6);let d=["dom","vers","sub"];return(y=i[n])!=null&&y.dom&&(d=[{label:i[n].dom,value:"dom"},{label:c("vers"),value:"vers"},{label:i[n].sub,value:"sub"}]),e.jsxs(k,{container:!0,justifyContent:"center",children:[e.jsx(k,{size:x,children:e.jsx(an,{actionsFolder:i,settings:t,option:n,onChange:f=>h(f,n,"level")})}),!!o&&e.jsx(k,{size:6,children:e.jsx(D,{sx:{ml:1},value:(S=t[n])==null?void 0:S.role,onChange:f=>h(f,n,"role"),label:`${c("role")}: ${u}`,options:d,defaultValue:t.role||"sub"})}),!!r&&e.jsx(k,{size:6,children:e.jsx(E,{placement:"top",title:e.jsxs(j,{i18nKey:"variationTooltip",children:[e.jsx(m,{variant:"subtitle2",children:"Standalone = Its own tile. "}),e.jsx(m,{variant:"subtitle2",children:"Append Some = 50% chance."}),e.jsx(m,{variant:"subtitle2",children:"Append Most = 90% chance."})]}),arrow:!0,children:e.jsxs(K,{fullWidth:!0,margin:"normal",sx:{ml:1},children:[e.jsxs(N,{id:`${a}Variation`,children:[`${u} ${c("variation")}`,e.jsx(B,{sx:{ml:1,fontSize:16}})]}),e.jsxs(P,{labelId:`${a}Variation`,id:`${n}Variation`,label:e.jsxs(e.Fragment,{children:[u," ",c("variation"),e.jsx(B,{sx:{ml:1,fontSize:16}})]}),value:((g=t[n])==null?void 0:g.variation)||"standalone",onChange:f=>h(f,n,"variation"),children:[e.jsx(w,{value:"standalone",children:e.jsx(j,{i18nKey:"standalone"})}),e.jsx(w,{value:"appendSome",children:e.jsx(j,{i18nKey:"appendSome"})}),e.jsx(w,{value:"appendMost",children:e.jsx(j,{i18nKey:"appendMost"})})]})]})})})]},n)}function dn({formData:n,setFormData:t}){return e.jsxs(ne,{direction:"row",spacing:1,alignItems:"center",justifyContent:"center",sx:{mt:1},children:[e.jsx(m,{children:e.jsx(j,{i18nKey:"solo"})}),e.jsx(E,{title:e.jsx(m,{variant:"subtitle2",children:e.jsx(j,{i18nKey:"soloTooltip"})}),arrow:!0,children:e.jsx(B,{sx:{fontSize:15}})}),e.jsx(V,{id:"gameMode",checked:!W(n.gameMode),onChange:s=>t({...n,gameMode:s.target.checked?"local":"online",boardUpdated:!0}),inputProps:{"aria-label":"Game Type"}}),e.jsx(m,{children:e.jsx(j,{i18nKey:"local"})}),e.jsx(E,{title:e.jsx(m,{variant:"subtitle2",children:e.jsx(j,{i18nKey:"localTooltip"})}),arrow:!0,children:e.jsx(B,{sx:{fontSize:15}})})]})}function hn({formData:n}){const[t,s]=b.useState(!1);return b.useEffect(()=>{const i=Object.values(n).filter(r=>typeof r=="object"&&(r==null?void 0:r.type)==="consumption"&&(r==null?void 0:r.level)>0).length,l=Object.values(n).filter(r=>typeof r=="object"&&(r==null?void 0:r.level)>0).length;s(i>1&&i>=l-i)},[n]),t?e.jsx(we,{severity:"warning",children:e.jsx(j,{i18nKey:"consumptionWarning"})}):null}function xn({formData:n,setFormData:t,actionsList:s}){const{t:i}=T(),l=!R(n==null?void 0:n.room)&&!W(n.gameMode);function r(c,a={}){return Object.keys(s).filter(u=>{var h;return((h=s[u])==null?void 0:h.type)===c}).map(u=>e.jsx(Y,{children:e.jsx(un,{option:u,settings:n,setSettings:t,actionsFolder:s,type:c,...a})},u))}const o=c=>{const a=JSON.parse(JSON.stringify(n));return Object.keys(a).forEach(u=>{a.role=c,u.includes("role")&&(a[u]=c)}),a};return e.jsxs(e.Fragment,{children:[e.jsx(dn,{formData:n,setFormData:t}),R(n==null?void 0:n.room)&&!W(n.gameMode)&&e.jsx(k,{container:!0,alignContent:"center",justifyContent:"space-evenly",children:e.jsx(k,{sx:{py:3},children:e.jsx(m,{variant:"h5",children:e.jsx(j,{i18nKey:"privateRequired"})})})}),e.jsxs(k,{container:!0,columnSpacing:2,justifyContent:"space-evenly",children:[e.jsx(Y,{children:e.jsx(E,{placement:"top",title:e.jsx(j,{i18nKey:"difficultyTooltip",children:e.jsxs(m,{variant:"body2",children:["Normal = Slow ramp up. ",e.jsx("br",{}),e.jsx("br",{}),"Accelerated = Straight to max level + the level prior to it."]})}),arrow:!0,children:e.jsx(D,{value:n.difficulty,onChange:c=>t({...n,difficulty:c.target.value,boardUpdated:!0}),label:"difficulty",options:["normal","accelerated"],defaultValue:"normal",helpIcon:!0})})}),l&&e.jsx(Y,{children:e.jsx(D,{value:n.role,onChange:c=>t({...o(c.target.value),boardUpdated:!0}),label:"mainRole",options:["dom","vers","sub"],defaultValue:"sub"})})]}),l?e.jsxs(e.Fragment,{children:[e.jsx(X,{title:i("consumption"),subtitle:i("consumptionSubtitle"),children:r("consumption",{showVariation:!0})}),e.jsx(X,{title:i("foreplay"),subtitle:i("foreplaySubtitle"),children:r("foreplay",{showRole:l})}),e.jsx(X,{title:i("sex"),subtitle:i("sexSubtitle"),children:r("sex",{showRole:l})})]}):e.jsxs(e.Fragment,{children:[e.jsx(k,{container:!0,columnSpacing:2,justifyContent:"space-evenly",children:r("consumption",{showVariation:!0})}),e.jsx(A,{}),e.jsx(k,{container:!0,columnSpacing:2,justifyContent:"center",children:r("solo")})]}),e.jsx(on,{setFormData:t,formData:n}),e.jsx(hn,{formData:n})]})}function pn({formData:n,setFormData:t}){const{t:s}=T(),i={"1d4":2.5,"1d6":3.5,"2d4":5},l=n!=null&&n.roomTileCount?Math.floor(n.roomTileCount/i[n.roomDice||"1d6"]):16,r=Array.from({length:7},(o,c)=>(c+2)*10).map(o=>e.jsx(w,{value:o,children:o},o));return e.jsxs(e.Fragment,{children:[e.jsx(m,{children:e.jsx(j,{i18nKey:"gameSpeed"})}),e.jsxs($,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[e.jsxs(K,{sx:{m:1},fullWidth:!0,children:[e.jsx(N,{id:"diceRole-label",children:e.jsx(j,{i18nKey:"roomDice"})}),e.jsxs(P,{labelId:"diceRole-label",id:"diceRole-select",value:(n==null?void 0:n.roomDice)||"1d4",label:s("roomDice"),onChange:o=>t({...n,roomDice:o.target.value,roomUpdated:!0}),children:[e.jsx(w,{value:"1d4",children:"1d4"}),e.jsx(w,{value:"1d6",children:"1d6"}),e.jsx(w,{value:"2d4",children:"2d4"})]})]}),e.jsxs(K,{sx:{m:1},fullWidth:!0,children:[e.jsx(N,{id:"tile-count-label",children:e.jsx(j,{i18nKey:"roomTileCount"})}),e.jsx(P,{labelId:"tile-count-label",id:"tile-count-select",value:String((n==null?void 0:n.roomTileCount)||40),label:s("roomTileCount"),onChange:o=>t({...n,roomTileCount:Number(o.target.value),roomUpdated:!0}),children:r})]}),e.jsx(K,{fullWidth:!0,children:e.jsxs(m,{children:[e.jsx(j,{i18nKey:"averageRolls"}),l]})})]})]})}function jn({formData:n,setFormData:t}){const s=b.useCallback(()=>{t({...n,roomRealtime:!n.roomRealtime,roomUpdated:!0})},[n,t]);return e.jsxs(e.Fragment,{children:[e.jsx(m,{children:e.jsx(j,{i18nKey:"playerListOptions"})}),e.jsxs(ne,{direction:"row",spacing:1,alignItems:"center",justifyContent:"center",sx:{width:"100%"},children:[e.jsx(m,{children:e.jsx(j,{i18nKey:"realtime"})}),e.jsx(E,{title:e.jsx(m,{variant:"subtitle2",children:e.jsx(j,{i18nKey:"realtimeTooltip"})}),arrow:!0,children:e.jsx(B,{sx:{fontSize:15}})}),e.jsx(V,{id:"showPrivate",checked:!!n.roomRealtime,onChange:s,inputProps:{"aria-label":se("playerList")}}),e.jsx(m,{children:e.jsx(j,{i18nKey:"delayed"})}),e.jsx(E,{title:e.jsx(m,{variant:"subtitle2",children:e.jsx(j,{i18nKey:"delayedTooltip"})}),arrow:!0,children:e.jsx(B,{sx:{fontSize:15}})})]})]})}let gn=n=>crypto.getRandomValues(new Uint8Array(n)),mn=(n,t,s)=>{let i=(2<<Math.log2(n.length-1))-1,l=-~(1.6*i*t/n.length);return(r=t)=>{let o="";for(;;){let c=s(l),a=l|0;for(;a--;)if(o+=n[c[a]&i]||"",o.length>=r)return o}}},bn=(n,t=21)=>mn(n,t|0,gn);function fn({formData:n,setFormData:t}){var u;const{id:s}=te(),{t:i}=T(),l=h=>{let x;h.target.checked&&R(s)?x=bn("123456789ABCDEFGHJKLMNPQRSTUVWXYZ",5)():s&&h.target.checked&&!R(s)?x=s:x="PUBLIC",t({...n,room:x.toUpperCase(),gameMode:R(x)?"online":n.gameMode})},r=b.useCallback(h=>{t({...n,room:h.currentTarget.value,boardUpdated:!0})},[n,t]),o=b.useCallback(h=>{h.key==="Enter"&&t({...n,room:h.currentTarget.value,boardUpdated:!0})},[n,t]),c=b.useCallback(h=>{const x=h.target.value.toUpperCase();h.target.value=x},[]),a=!R(n.room);return e.jsxs(e.Fragment,{children:[e.jsxs(ne,{direction:"row",spacing:1,alignItems:"center",justifyContent:"center",sx:{width:"100%"},children:[e.jsx(m,{children:e.jsx(j,{i18nKey:"public"})}),e.jsx(V,{id:"showPrivate",checked:a,onChange:l,slotProps:{input:{"aria-label":i("room")}}}),e.jsx(m,{children:e.jsx(j,{i18nKey:"private"})}),e.jsx(E,{title:e.jsx(m,{variant:"subtitle2",children:e.jsx(j,{i18nKey:"privateOptions"})}),arrow:!0,children:e.jsx(B,{sx:{fontSize:15}})})]}),a&&e.jsx(ee,{fullWidth:!0,id:"privateRoom",label:"Private Room",defaultValue:(u=n.room)==null?void 0:u.toUpperCase(),margin:"normal",onBlur:r,onKeyDown:o,onChange:c,inputProps:{style:{textTransform:"uppercase"}}})]})}function yn({formData:n,setFormData:t}){const{t:s}=T(),i={app:s("appBackground"),custom:s("customURL")};return e.jsxs($,{sx:{margin:"0.5rem"},children:[e.jsx(fn,{formData:n,setFormData:t}),!R(n.room)&&e.jsxs(e.Fragment,{children:[e.jsx(A,{sx:{my:1}}),e.jsx(pn,{formData:n,setFormData:t}),e.jsx(A,{sx:{my:1}}),e.jsx(jn,{formData:n,setFormData:t}),e.jsx(A,{sx:{my:1}}),e.jsx(pe,{formData:n,setFormData:t,backgrounds:i,isRoom:!0})]})]})}function Sn(n){return Object.values(n).some(({level:t})=>t>0)}function vn(n,t){return Object.entries(n).reduce((s,[i,l])=>{var r;return i in t&&((r=l==null?void 0:l.variation)!=null&&r.startsWith("append")?s.withAppend[i]=l:s.withoutAppend[i]=l),s},{withAppend:{},withoutAppend:{}})}function Cn(n){return Object.keys(n).length>0&&Object.values(n).some(({level:t})=>t>0)}function wn(n,t){const{withAppend:s,withoutAppend:i}=vn(n,t);return Sn(i)?R(n.room)&&!W(n.gameMode)?"privateRequired":null:Cn(s)?"appendWithAction":"pickSomething"}function je(){const{id:n}=te(),t=Ae();return i=>{(n==null?void 0:n.toUpperCase())!==(i==null?void 0:i.toUpperCase())&&t(`/${i||"PUBLIC"}`)}}function kn(n){(!n.roomBackgroundURL||!Ie(n.roomBackgroundURL))&&(n.roomBackground="app")}function Tn(){const{user:n,updateUser:t}=xe(),{id:s}=te(),{t:i}=T(),l=tn(),[r,o]=F("gameSettings"),c=Z(()=>ue(r==null?void 0:r.gameMode)),a=Z(he),u=je(),{messages:h}=Ue(),x=b.useCallback(p=>{const y=(s==null?void 0:s.toUpperCase())!==p.room.toUpperCase(),S=!!(p.room&&!R(p.room)),g=S&&p.roomTileCount!==(r==null?void 0:r.roomTileCount);return{roomChanged:y,isPrivateRoom:S,privateBoardSizeChanged:g}},[s,r==null?void 0:r.roomTileCount]),d=b.useCallback(async(p,y)=>{const{displayName:S}=p,g=await Ee(n,S,t);kn(p);const{settingsBoardUpdated:f,gameMode:U,newBoard:v=[]}=await l(p),{roomChanged:L,isPrivateRoom:q,privateBoardSizeChanged:_}=x(p);if(!g)return;q&&(p.roomUpdated||!h.find(C=>C.type==="room"))&&await We(p,g),(a==null?void 0:a.tiles)!==v&&await de({title:i("settingsGenerated"),tiles:v,isActive:1,gameMode:U}),(f||L||_)&&!h.some(C=>{var G;return C.type==="settings"&&C.uid===g.uid&&Date.now()-(((G=C.timestamp)==null?void 0:G.toMillis())||0)<5e3})&&await Fe({formData:p,user:g,customTiles:c,actionsList:y,title:"Settings Generated Board",tiles:v}),o({...p,boardUpdated:!1,roomUpdated:!1,gameMode:U}),u(p.room)},[n,t,l,x,h,a,i,c,o,u]);return b.useCallback((p,y)=>d(p,y),[d])}function Un({closeDialog:n,initialTab:t=0}){const{user:s}=xe(),{t:i}=T(),[l,r]=F("gameSettings"),[o,c]=b.useState(t),[a,u]=b.useState(null),[h,x]=b.useState(!1),[d,p]=Be(),y=je(),S=Tn(),{isLoading:g,actionsList:f}=Le(d==null?void 0:d.gameMode),U=(O,C)=>{c(C),y(d.room)},v=()=>r({...l,boardUpdated:!0});async function L(O){O.preventDefault();const{displayName:C,...G}=d,ie=wn(G,f);return ie?(u(i(ie)),null):(S(d,f),typeof n=="function"&&n(),null)}const q=b.useCallback(O=>{p(C=>({...C,displayName:O.target.value}))},[p]),_=b.useCallback(O=>{O.key==="Enter"&&(p(C=>({...C,displayName:O.target.value})),L(O))},[L,p]);return!d.room||g?e.jsxs($,{children:[e.jsxs(m,{variant:"h2",children:[e.jsx(j,{i18nKey:"loading"}),"..."]}),e.jsx(m,{variant:"body1",children:e.jsx(j,{i18nKey:"clearStorage"})})]}):e.jsxs($,{component:"form",method:"post",onSubmit:L,className:"settings-box",children:[e.jsx(ee,{fullWidth:!0,id:"displayName",label:i("displayName"),defaultValue:(s==null?void 0:s.displayName)||d.displayName||"",required:!0,autoFocus:!0,onBlur:q,onKeyDown:_,margin:"normal"}),e.jsx($,{sx:{borderBottom:1,borderColor:"divider"},children:e.jsxs(ke,{value:o,onChange:U,"aria-label":"Game Settings",centered:!0,children:[e.jsx(J,{label:i("gameboard"),...H(0)}),e.jsx(J,{label:i("room"),...H(1)}),e.jsx(J,{label:i("application"),...H(2)})]})}),e.jsx(Q,{value:o,index:0,style:{p:0},children:e.jsx(xn,{formData:d,setFormData:p,actionsList:f})}),e.jsx(Q,{value:o,index:1,style:{p:0,pt:1},children:e.jsx(yn,{formData:d,setFormData:p})}),e.jsx(Q,{value:o,index:2,style:{p:0,pt:1},children:e.jsx(ln,{formData:d,setFormData:p,boardUpdated:v})}),e.jsxs("div",{className:"flex-buttons",children:[e.jsx(le,{variant:"outlined",type:"button",onClick:()=>x(!0),children:e.jsx(j,{i18nKey:"customTilesLabel",children:"Game Tiles"})}),e.jsx(le,{variant:"contained",type:"submit",children:e.jsx(j,{i18nKey:"update"})})]}),!!h&&e.jsx(Me,{open:h,setOpen:x,boardUpdated:v,actionsList:f}),e.jsx(Te,{open:!!a,close:()=>u(null),children:a})]})}const En=Object.freeze(Object.defineProperty({__proto__:null,default:Un},Symbol.toStringTag,{value:"Module"}));export{Un as G,an as I,fn as R,D as S,Q as T,rn as Y,Fe as a,je as b,Pn as c,Tn as d,En as i,We as s,tn as u};
