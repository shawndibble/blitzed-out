const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/pwa-action-sheet.entry-DcmIrNEd.js","assets/mui-CrZCkLSf.js","assets/vendor-Bf6wU4zJ.js","assets/firebase-C4LKcFbe.js","assets/translations-CairTNs2.js","assets/pwa-camera-modal.entry-DdeftIgx.js","assets/pwa-toast.entry-D-z__2Mt.js","assets/pwa-camera-modal-instance.entry-ChM3Dxpa.js","assets/pwa-camera.entry-Yu5L4J5-.js","assets/index-CsdNNf4B.js","assets/index-BzH6-xHo.js","assets/strings-By9od552.js","assets/index-Cnr7Xi3M.css","assets/languages-KK0t13AM.js","assets/index-4dTQjzQQ.js","assets/index-0XjfPz8-.css","assets/index-DFZdwnk6.css","assets/index-CKe2RiDj.js","assets/index-BKCx88qf.js","assets/index-61ebIJOl.js","assets/urls-bwAPA7IR.js","assets/index-Dv4riOOH.css","assets/index-BwRH_o8S.js","assets/index-D_1rBFPL.js","assets/index-Cr_u2buS.js","assets/useActionList-COnHfaWR.js","assets/index-CignLajt.css","assets/index-rSLzeRrU.css"])))=>i.map(i=>d[i]);
import{_ as Eh,u as xh,a as sl,j as Re,c as Ch,r as Th,T as Sh,C as Ih}from"./mui-CrZCkLSf.js";import{e as kh,g as Qt,a as ke,f as Ah,h as ol,b as Js,u as al,B as Ph,i as Oh,j as js,N as Rh}from"./vendor-Bf6wU4zJ.js";import{L as Dh,a as Q,_ as Mh,C as Nh,r as Va,s as Je,j as wo,c as kt,b as Fn,m as Ti,d as Lh,S as $h,e as Fh,f as Ar,g as jn,h as jh,i as Bh,D as Yt,q as qh,k as Uh,l as Vh,n as Zs,o as ul,p as Kh,t as vn,u as Wh,v as Ui,w as Yh,x as Hh,y as zh,z as Gh,A as Qh,B as Xh,E as Jh,F as Zh,G as ef,H as ll,I as at,J as Vi,K as wn,M as tf,N as nf,O as rf,P as Pr,Q as sf,R as of,T as af,U as uf,V as bo,W as cl,X as Eo,Y as xo,Z as lf,$ as cf,a0 as hf,a1 as ff,a2 as df,a3 as pf,a4 as hl,a5 as fl,a6 as mf,a7 as dl}from"./firebase-C4LKcFbe.js";import{i as pl,a as _f,t as gf}from"./translations-CairTNs2.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const u of a.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&r(u)}).observe(document,{childList:!0,subtree:!0});function t(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(i){if(i.ep)return;i.ep=!0;const a=t(i);fetch(i.href,a)}})();const yf="modulepreload",vf=function(n){return"/"+n},Ka={},q=function(e,t,r){let i=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const u=document.querySelector("meta[property=csp-nonce]"),h=(u==null?void 0:u.nonce)||(u==null?void 0:u.getAttribute("nonce"));i=Promise.allSettled(t.map(f=>{if(f=vf(f),f in Ka)return;Ka[f]=!0;const p=f.endsWith(".css"),y=p?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${f}"]${y}`))return;const v=document.createElement("link");if(v.rel=p?"stylesheet":yf,p||(v.as="script"),v.crossOrigin="",v.href=f,h&&v.setAttribute("nonce",h),document.head.appendChild(v),p)return new Promise((I,M)=>{v.addEventListener("load",I),v.addEventListener("error",()=>M(new Error(`Unable to preload CSS for ${f}`)))})}))}function a(u){const h=new Event("vite:preloadError",{cancelable:!0});if(h.payload=u,window.dispatchEvent(h),!h.defaultPrevented)throw u}return i.then(u=>{for(const h of u||[])h.status==="rejected"&&a(h.reason);return e().catch(a)})};var wf=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(r[a]=i[a])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),ml=function(n,e,t,r){function i(a){return a instanceof t?a:new t(function(u){u(a)})}return new(t||(t=Promise))(function(a,u){function h(y){try{p(r.next(y))}catch(v){u(v)}}function f(y){try{p(r.throw(y))}catch(v){u(v)}}function p(y){y.done?a(y.value):i(y.value).then(h,f)}p((r=r.apply(n,e||[])).next())})},_l=function(n,e){var t={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]},r,i,a,u;return u={next:h(0),throw:h(1),return:h(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function h(p){return function(y){return f([p,y])}}function f(p){if(r)throw new TypeError("Generator is already executing.");for(;u&&(u=0,p[0]&&(t=0)),t;)try{if(r=1,i&&(a=p[0]&2?i.return:p[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,p[1])).done)return a;switch(i=0,a&&(p=[p[0]&2,a.value]),p[0]){case 0:case 1:a=p;break;case 4:return t.label++,{value:p[1],done:!1};case 5:t.label++,i=p[1],p=[0];continue;case 7:p=t.ops.pop(),t.trys.pop();continue;default:if(a=t.trys,!(a=a.length>0&&a[a.length-1])&&(p[0]===6||p[0]===2)){t=0;continue}if(p[0]===3&&(!a||p[1]>a[0]&&p[1]<a[3])){t.label=p[1];break}if(p[0]===6&&t.label<a[1]){t.label=a[1],a=p;break}if(a&&t.label<a[2]){t.label=a[2],t.ops.push(p);break}a[2]&&t.ops.pop(),t.trys.pop();continue}p=e.call(n,t)}catch(y){p=[6,y],i=0}finally{r=a=0}if(p[0]&5)throw p[1];return{value:p[0]?p[1]:void 0,done:!0}}},Wa=function(n,e,t){if(t||arguments.length===2)for(var r=0,i=e.length,a;r<i;r++)(a||!(r in e))&&(a||(a=Array.prototype.slice.call(e,0,r)),a[r]=e[r]);return n.concat(a||Array.prototype.slice.call(e))},bf="ionicpwaelements",pi,gl,mt=!1,eo=!1,Mt=function(n,e){return function(){}},Ef=function(n,e){return function(){}},xf="{visibility:hidden}.hydrated{visibility:inherit}",Ya={},Cf="http://www.w3.org/2000/svg",Tf="http://www.w3.org/1999/xhtml",Sf=function(n){return n!=null},Co=function(n){return n=typeof n,n==="object"||n==="function"};function yl(n){var e,t,r;return(r=(t=(e=n.head)===null||e===void 0?void 0:e.querySelector('meta[name="csp-nonce"]'))===null||t===void 0?void 0:t.getAttribute("content"))!==null&&r!==void 0?r:void 0}var If=function(n,e){for(var t=[],r=2;r<arguments.length;r++)t[r-2]=arguments[r];var i=null,a=!1,u=!1,h=[],f=function(v){for(var I=0;I<v.length;I++)i=v[I],Array.isArray(i)?f(i):i!=null&&typeof i!="boolean"&&((a=typeof n!="function"&&!Co(i))&&(i=String(i)),a&&u?h[h.length-1].$text$+=i:h.push(a?to(null,i):i),u=a)};if(f(t),e){var p=e.className||e.class;p&&(e.class=typeof p!="object"?p:Object.keys(p).filter(function(v){return p[v]}).join(" "))}var y=to(n,null);return y.$attrs$=e,h.length>0&&(y.$children$=h),y},to=function(n,e){var t={$flags$:0,$tag$:n,$text$:e,$elm$:null,$children$:null};return t.$attrs$=null,t},kf={},Af=function(n){return n&&n.$tag$===kf},Pf=function(n,e){return n!=null&&!Co(n)?e&4?n==="false"?!1:n===""||!!n:e&2?parseFloat(n):e&1?String(n):n:n},Of=function(n){return Xt(n).$hostElement$},by=function(n,e,t){var r=Of(n);return{emit:function(i){return vl(r,e,{bubbles:!0,composed:!0,cancelable:!0,detail:i})}}},vl=function(n,e,t){var r=Xe.ce(e,t);return n.dispatchEvent(r),r},Ha=new WeakMap,Rf=function(n,e,t){var r=Si.get(n);td&&t?(r=r||new CSSStyleSheet,typeof r=="string"?r=e:r.replaceSync(e)):r=e,Si.set(n,r)},Df=function(n,e,t,r){var i,a=wl(e),u=Si.get(a);if(n=n.nodeType===11?n:bt,u)if(typeof u=="string"){n=n.head||n;var h=Ha.get(n),f=void 0;if(h||Ha.set(n,h=new Set),!h.has(a)){{f=bt.createElement("style"),f.innerHTML=u;var p=(i=Xe.$nonce$)!==null&&i!==void 0?i:yl(bt);p!=null&&f.setAttribute("nonce",p),n.insertBefore(f,n.querySelector("link"))}h&&h.add(a)}}else n.adoptedStyleSheets.includes(u)||(n.adoptedStyleSheets=Wa(Wa([],n.adoptedStyleSheets,!0),[u],!1));return a},Mf=function(n){var e=n.$cmpMeta$,t=n.$hostElement$,r=e.$flags$,i=Mt("attachStyles",e.$tagName$),a=Df(t.shadowRoot?t.shadowRoot:t.getRootNode(),e);r&10&&(t["s-sc"]=a,t.classList.add(a+"-h")),i()},wl=function(n,e){return"sc-"+n.$tagName$},za=function(n,e,t,r,i,a){if(t!==r){var u=Qa(n,e),h=e.toLowerCase();if(e==="class"){var f=n.classList,p=Ga(t),y=Ga(r);f.remove.apply(f,p.filter(function(B){return B&&!y.includes(B)})),f.add.apply(f,y.filter(function(B){return B&&!p.includes(B)}))}else if(e==="style"){for(var v in t)(!r||r[v]==null)&&(v.includes("-")?n.style.removeProperty(v):n.style[v]="");for(var v in r)(!t||r[v]!==t[v])&&(v.includes("-")?n.style.setProperty(v,r[v]):n.style[v]=r[v])}else if(e==="ref")r&&r(n);else if(!u&&e[0]==="o"&&e[1]==="n")e[2]==="-"?e=e.slice(3):Qa(Wi,h)?e=h.slice(2):e=h[2]+e.slice(3),t&&Xe.rel(n,e,t,!1),r&&Xe.ael(n,e,r,!1);else{var I=Co(r);if((u||I&&r!==null)&&!i)try{if(n.tagName.includes("-"))n[e]=r;else{var M=r??"";e==="list"?u=!1:(t==null||n[e]!=M)&&(n[e]=M)}}catch{}r==null||r===!1?(r!==!1||n.getAttribute(e)==="")&&n.removeAttribute(e):(!u||a&4||i)&&!I&&(r=r===!0?"":r,n.setAttribute(e,r))}}},Nf=/\s/,Ga=function(n){return n?n.split(Nf):[]},bl=function(n,e,t,r){var i=e.$elm$.nodeType===11&&e.$elm$.host?e.$elm$.host:e.$elm$,a=n&&n.$attrs$||Ya,u=e.$attrs$||Ya;for(r in a)r in u||za(i,r,a[r],void 0,t,e.$flags$);for(r in u)za(i,r,a[r],u[r],t,e.$flags$)},To=function(n,e,t,r){var i=e.$children$[t],a=0,u,h;if(i.$text$!==null)u=i.$elm$=bt.createTextNode(i.$text$);else{if(mt||(mt=i.$tag$==="svg"),u=i.$elm$=bt.createElementNS(mt?Cf:Tf,i.$tag$),mt&&i.$tag$==="foreignObject"&&(mt=!1),bl(null,i,mt),Sf(pi)&&u["s-si"]!==pi&&u.classList.add(u["s-si"]=pi),i.$children$)for(a=0;a<i.$children$.length;++a)h=To(n,i,a),h&&u.appendChild(h);i.$tag$==="svg"?mt=!1:u.tagName==="foreignObject"&&(mt=!0)}return u},El=function(n,e,t,r,i,a){var u=n,h;for(u.shadowRoot&&u.tagName===gl&&(u=u.shadowRoot);i<=a;++i)r[i]&&(h=To(null,t,i),h&&(r[i].$elm$=h,u.insertBefore(h,e)))},xl=function(n,e,t){for(var r=e;r<=t;++r){var i=n[r];if(i){var a=i.$elm$;Cl(i),a&&a.remove()}}},Lf=function(n,e,t,r){for(var i=0,a=0,u=e.length-1,h=e[0],f=e[u],p=r.length-1,y=r[0],v=r[p],I;i<=u&&a<=p;)h==null?h=e[++i]:f==null?f=e[--u]:y==null?y=r[++a]:v==null?v=r[--p]:li(h,y)?(mr(h,y),h=e[++i],y=r[++a]):li(f,v)?(mr(f,v),f=e[--u],v=r[--p]):li(h,v)?(mr(h,v),n.insertBefore(h.$elm$,f.$elm$.nextSibling),h=e[++i],v=r[--p]):li(f,y)?(mr(f,y),n.insertBefore(f.$elm$,h.$elm$),f=e[--u],y=r[++a]):(I=To(e&&e[a],t,a),y=r[++a],I&&h.$elm$.parentNode.insertBefore(I,h.$elm$));i>u?El(n,r[p+1]==null?null:r[p+1].$elm$,t,r,a,p):a>p&&xl(e,i,u)},li=function(n,e){return n.$tag$===e.$tag$},mr=function(n,e){var t=e.$elm$=n.$elm$,r=n.$children$,i=e.$children$,a=e.$tag$,u=e.$text$;u===null?(mt=a==="svg"?!0:a==="foreignObject"?!1:mt,bl(n,e,mt),r!==null&&i!==null?Lf(t,r,e,i):i!==null?(n.$text$!==null&&(t.textContent=""),El(t,null,e,i,0,i.length-1)):r!==null&&xl(r,0,r.length-1),mt&&a==="svg"&&(mt=!1)):n.$text$!==u&&(t.data=u)},Cl=function(n){n.$attrs$&&n.$attrs$.ref&&n.$attrs$.ref(null),n.$children$&&n.$children$.map(Cl)},$f=function(n,e){var t=n.$hostElement$,r=n.$vnode$||to(null,null),i=Af(e)?e:If(null,null,e);gl=t.tagName,i.$tag$=null,i.$flags$|=4,n.$vnode$=i,i.$elm$=r.$elm$=t.shadowRoot||t,pi=t["s-sc"],mr(r,i)},Tl=function(n,e){e&&!n.$onRenderResolve$&&e["s-p"]&&e["s-p"].push(new Promise(function(t){return n.$onRenderResolve$=t}))},Ki=function(n,e){if(n.$flags$|=16,n.$flags$&4){n.$flags$|=512;return}Tl(n,n.$ancestorComponent$);var t=function(){return Ff(n,e)};return rd(t)},Ff=function(n,e){var t=Mt("scheduleUpdate",n.$cmpMeta$.$tagName$),r=n.$lazyInstance$,i;return e&&(n.$flags$|=256,n.$queuedListeners$&&(n.$queuedListeners$.map(function(a){var u=a[0],h=a[1];return So(r,u,h)}),n.$queuedListeners$=void 0)),t(),jf(i,function(){return qf(n,r,e)})},jf=function(n,e){return Bf(n)?n.then(e):e()},Bf=function(n){return n instanceof Promise||n&&n.then&&typeof n.then=="function"},qf=function(n,e,t){return ml(void 0,void 0,void 0,function(){var r,i,a,u,h,f,p;return _l(this,function(y){return i=n.$hostElement$,a=Mt("update",n.$cmpMeta$.$tagName$),u=i["s-rc"],t&&Mf(n),h=Mt("render",n.$cmpMeta$.$tagName$),Uf(n,e),u&&(u.map(function(v){return v()}),i["s-rc"]=void 0),h(),a(),f=(r=i["s-p"])!==null&&r!==void 0?r:[],p=function(){return Vf(n)},f.length===0?p():(Promise.all(f).then(p),n.$flags$|=4,f.length=0),[2]})})},Uf=function(n,e,t){try{e=e.render(),n.$flags$&=-17,n.$flags$|=2,$f(n,e)}catch(r){vt(r,n.$hostElement$)}return null},Vf=function(n){n.$cmpMeta$.$tagName$;var e=n.$hostElement$,t=Mt(),r=n.$lazyInstance$,i=n.$ancestorComponent$;n.$flags$&64?t():(n.$flags$|=64,Il(e),So(r,"componentDidLoad"),t(),n.$onReadyResolve$(e),i||Sl()),n.$onInstanceResolve$(e),n.$onRenderResolve$&&(n.$onRenderResolve$(),n.$onRenderResolve$=void 0),n.$flags$&512&&ko(function(){return Ki(n,!1)}),n.$flags$&=-517},Ey=function(n){{var e=Xt(n),t=e.$hostElement$.isConnected;return t&&(e.$flags$&18)===2&&Ki(e,!1),t}},Sl=function(n){Il(bt.documentElement),ko(function(){return vl(Wi,"appload",{detail:{namespace:bf}})})},So=function(n,e,t){if(n&&n[e])try{return n[e](t)}catch(r){vt(r)}},Il=function(n){return n.classList.add("hydrated")},Kf=function(n,e){return Xt(n).$instanceValues$.get(e)},Wf=function(n,e,t,r){var i=Xt(n),a=i.$instanceValues$.get(e),u=i.$flags$,h=i.$lazyInstance$;t=Pf(t,r.$members$[e][0]);var f=Number.isNaN(a)&&Number.isNaN(t),p=t!==a&&!f;(!(u&8)||a===void 0)&&p&&(i.$instanceValues$.set(e,t),h&&(u&18)===2&&Ki(i,!1))},kl=function(n,e,t){if(e.$members$){var r=Object.entries(e.$members$),i=n.prototype;if(r.map(function(u){var h=u[0],f=u[1][0];f&31||t&2&&f&32?Object.defineProperty(i,h,{get:function(){return Kf(this,h)},set:function(p){Wf(this,h,p,e)},configurable:!0,enumerable:!0}):t&1&&f&64&&Object.defineProperty(i,h,{value:function(){for(var p=[],y=0;y<arguments.length;y++)p[y]=arguments[y];var v=Xt(this);return v.$onInstancePromise$.then(function(){var I;return(I=v.$lazyInstance$)[h].apply(I,p)})}})}),t&1){var a=new Map;i.attributeChangedCallback=function(u,h,f){var p=this;Xe.jmp(function(){var y=a.get(u);if(p.hasOwnProperty(y))f=p[y],delete p[y];else if(i.hasOwnProperty(y)&&typeof p[y]=="number"&&p[y]==f)return;p[y]=f===null&&typeof p[y]=="boolean"?!1:f})},n.observedAttributes=r.filter(function(u){u[0];var h=u[1];return h[0]&15}).map(function(u){var h=u[0],f=u[1],p=f[1]||h;return a.set(p,h),p})}}return n},Yf=function(n,e,t,r,i){return ml(void 0,void 0,void 0,function(){var a,u,h,f,p,y,v;return _l(this,function(I){switch(I.label){case 0:return(e.$flags$&32)!==0?[3,3]:(e.$flags$|=32,i=ed(t),i.then?(a=Ef(),[4,i]):[3,2]);case 1:i=I.sent(),a(),I.label=2;case 2:i.isProxied||(kl(i,t,2),i.isProxied=!0),u=Mt("createInstance",t.$tagName$),e.$flags$|=8;try{new i(e)}catch(M){vt(M)}e.$flags$&=-9,u(),i.style&&(h=i.style,f=wl(t),Si.has(f)||(p=Mt("registerStyles",t.$tagName$),Rf(f,h,!!(t.$flags$&1)),p())),I.label=3;case 3:return y=e.$ancestorComponent$,v=function(){return Ki(e,!0)},y&&y["s-rc"]?y["s-rc"].push(v):v(),[2]}})})},Hf=function(n){if((Xe.$flags$&1)===0){var e=Xt(n),t=e.$cmpMeta$,r=Mt("connectedCallback",t.$tagName$);if(e.$flags$&1)Al(n,e,t.$listeners$);else{e.$flags$|=1;for(var i=n;i=i.parentNode||i.host;)if(i["s-p"]){Tl(e,e.$ancestorComponent$=i);break}t.$members$&&Object.entries(t.$members$).map(function(a){var u=a[0],h=a[1][0];if(h&31&&n.hasOwnProperty(u)){var f=n[u];delete n[u],n[u]=f}}),Yf(n,e,t)}r()}},zf=function(n){if((Xe.$flags$&1)===0){var e=Xt(n),t=e.$lazyInstance$;e.$rmListeners$&&(e.$rmListeners$.map(function(r){return r()}),e.$rmListeners$=void 0),So(t,"disconnectedCallback")}},Gf=function(n,e){e===void 0&&(e={});var t,r=Mt(),i=[],a=e.exclude||[],u=Wi.customElements,h=bt.head,f=h.querySelector("meta[charset]"),p=bt.createElement("style"),y=[],v,I=!0;Object.assign(Xe,e),Xe.$resourcesUrl$=new URL(e.resourcesUrl||"./",bt.baseURI).href,n.map(function(B){B[1].map(function(ue){var Z={$flags$:ue[0],$tagName$:ue[1],$members$:ue[2],$listeners$:ue[3]};Z.$members$=ue[2],Z.$listeners$=ue[3];var de=Z.$tagName$,_e=function(ce){wf(Ae,ce);function Ae(le){var P=ce.call(this,le)||this;return le=P,Zf(le,Z),Z.$flags$&1&&le.attachShadow({mode:"open"}),P}return Ae.prototype.connectedCallback=function(){var le=this;v&&(clearTimeout(v),v=null),I?y.push(this):Xe.jmp(function(){return Hf(le)})},Ae.prototype.disconnectedCallback=function(){var le=this;Xe.jmp(function(){return zf(le)})},Ae.prototype.componentOnReady=function(){return Xt(this).$onReadyPromise$},Ae}(HTMLElement);Z.$lazyBundleId$=B[0],!a.includes(de)&&!u.get(de)&&(i.push(de),u.define(de,kl(_e,Z,1)))})});{p.innerHTML=i+xf,p.setAttribute("data-styles","");var M=(t=Xe.$nonce$)!==null&&t!==void 0?t:yl(bt);M!=null&&p.setAttribute("nonce",M),h.insertBefore(p,f?f.nextSibling:h.firstChild)}I=!1,y.length?y.map(function(B){return B.connectedCallback()}):Xe.jmp(function(){return v=setTimeout(Sl,30)}),r()},Al=function(n,e,t,r){t&&t.map(function(i){var a=i[0],u=i[1],h=i[2],f=Xf(n,a),p=Qf(e,h),y=Jf(a);Xe.ael(f,u,p,y),(e.$rmListeners$=e.$rmListeners$||[]).push(function(){return Xe.rel(f,u,p,y)})})},Qf=function(n,e){return function(t){try{n.$flags$&256?n.$lazyInstance$[e](t):(n.$queuedListeners$=n.$queuedListeners$||[]).push([e,t])}catch(r){vt(r)}}},Xf=function(n,e){return e&16?bt.body:n},Jf=function(n){return(n&2)!==0},Io=new WeakMap,Xt=function(n){return Io.get(n)},xy=function(n,e){return Io.set(e.$lazyInstance$=n,e)},Zf=function(n,e){var t={$flags$:0,$hostElement$:n,$cmpMeta$:e,$instanceValues$:new Map};return t.$onInstancePromise$=new Promise(function(r){return t.$onInstanceResolve$=r}),t.$onReadyPromise$=new Promise(function(r){return t.$onReadyResolve$=r}),n["s-p"]=[],n["s-rc"]=[],Al(n,t,e.$listeners$),Io.set(n,t)},Qa=function(n,e){return e in n},vt=function(n,e){return(0,console.error)(n,e)},Bs=new Map,ed=function(n,e,t){var r=n.$tagName$.replace(/-/g,"_"),i=n.$lazyBundleId$,a=Bs.get(i);if(a)return a[r];{var u=function(h){return Bs.set(i,h),h[r]};switch(i){case"pwa-action-sheet":return q(()=>import("./pwa-action-sheet.entry-DcmIrNEd.js"),__vite__mapDeps([0,1,2,3,4])).then(u,vt);case"pwa-camera-modal":return q(()=>import("./pwa-camera-modal.entry-DdeftIgx.js"),__vite__mapDeps([5,1,2,3,4])).then(u,vt);case"pwa-toast":return q(()=>import("./pwa-toast.entry-D-z__2Mt.js"),__vite__mapDeps([6,1,2,3,4])).then(u,vt);case"pwa-camera-modal-instance":return q(()=>import("./pwa-camera-modal-instance.entry-ChM3Dxpa.js"),__vite__mapDeps([7,1,2,3,4])).then(u,vt);case"pwa-camera":return q(()=>import("./pwa-camera.entry-Yu5L4J5-.js"),__vite__mapDeps([8,1,2,3,4])).then(u,vt)}}return q(()=>import("./".concat(i,".entry.js").concat("")),[]).then(function(h){return Bs.set(i,h),h[r]},vt)},Si=new Map,Wi=typeof window<"u"?window:{},bt=Wi.document||{head:{}},Xe={$flags$:0,$resourcesUrl$:"",jmp:function(n){return n()},raf:function(n){return requestAnimationFrame(n)},ael:function(n,e,t,r){return n.addEventListener(e,t,r)},rel:function(n,e,t,r){return n.removeEventListener(e,t,r)},ce:function(n,e){return new CustomEvent(n,e)}},Pl=function(n){return Promise.resolve(n)},td=function(){try{return new CSSStyleSheet,typeof new CSSStyleSheet().replaceSync=="function"}catch{}return!1}(),Xa=[],Ol=[],nd=function(n,e){return function(t){n.push(t),eo||(eo=!0,Xe.$flags$&4?ko(no):Xe.raf(no))}},Ja=function(n){for(var e=0;e<n.length;e++)try{n[e](performance.now())}catch(t){vt(t)}n.length=0},no=function(){Ja(Xa),Ja(Ol),(eo=Xa.length>0)&&Xe.raf(no)},ko=function(n){return Pl().then(n)},rd=nd(Ol),id=function(){return Pl()},sd=function(n,e){return typeof window>"u"?Promise.resolve():id().then(function(){return Gf([["pwa-camera-modal",[[1,"pwa-camera-modal",{facingMode:[1,"facing-mode"],hidePicker:[4,"hide-picker"],present:[64],dismiss:[64]}]]],["pwa-action-sheet",[[1,"pwa-action-sheet",{header:[1],cancelable:[4],options:[16],open:[32]}]]],["pwa-toast",[[1,"pwa-toast",{message:[1],duration:[2],closing:[32]}]]],["pwa-camera",[[1,"pwa-camera",{facingMode:[1,"facing-mode"],handlePhoto:[16],hidePicker:[4,"hide-picker"],handleNoDeviceError:[16],noDevicesText:[1,"no-devices-text"],noDevicesButtonText:[1,"no-devices-button-text"],photo:[32],photoSrc:[32],showShutterOverlay:[32],flashIndex:[32],hasCamera:[32],rotation:[32],deviceError:[32]}]]],["pwa-camera-modal-instance",[[1,"pwa-camera-modal-instance",{facingMode:[1,"facing-mode"],hidePicker:[4,"hide-picker"],noDevicesText:[1,"no-devices-text"],noDevicesButtonText:[1,"no-devices-button-text"]},[[16,"keyup","handleBackdropKeyUp"]]]]]],e)})};(function(){if(typeof window<"u"&&window.Reflect!==void 0&&window.customElements!==void 0){var n=HTMLElement;window.HTMLElement=function(){return Reflect.construct(n,[],this.constructor)},HTMLElement.prototype=n.prototype,HTMLElement.prototype.constructor=HTMLElement,Object.setPrototypeOf(HTMLElement,n)}})();var ci={},Za;function od(){if(Za)return ci;Za=1;var n=kh();return ci.createRoot=n.createRoot,ci.hydrateRoot=n.hydrateRoot,ci}var ad=od();const ud=Qt(ad),ld=["localeText"],eu=ke.createContext(null),cd=function(e){const{localeText:t}=e,r=Eh(e,ld),{utils:i,localeText:a}=ke.useContext(eu)??{utils:void 0,localeText:void 0},u=xh({props:r,name:"MuiLocalizationProvider"}),{children:h,dateAdapter:f,dateFormats:p,dateLibInstance:y,adapterLocale:v,localeText:I}=u,M=ke.useMemo(()=>sl({},I,a,t),[I,a,t]),B=ke.useMemo(()=>{if(!f)return i||null;const de=new f({locale:v,formats:p,instance:y});if(!de.isMUIAdapter)throw new Error(["MUI X: The date adapter should be imported from `@mui/x-date-pickers` or `@mui/x-date-pickers-pro`, not from `@date-io`","For example, `import { AdapterDayjs } from '@mui/x-date-pickers/AdapterDayjs'` instead of `import AdapterDayjs from '@date-io/dayjs'`","More information on the installation documentation: https://mui.com/x/react-date-pickers/getting-started/#installation"].join(`
`));return de},[f,v,p,y,i]),ue=ke.useMemo(()=>B?{minDate:B.date("1900-01-01T00:00:00.000"),maxDate:B.date("2099-12-31T00:00:00.000")}:null,[B]),Z=ke.useMemo(()=>({utils:B,defaultDates:ue,localeText:M}),[ue,B,M]);return Re.jsx(eu.Provider,{value:Z,children:h})};var tu={};const nu="@firebase/database",ru="1.0.13";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Rl="";function hd(n){Rl=n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fd{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){t==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),Je(t))}get(e){const t=this.domStorage_.getItem(this.prefixedName_(e));return t==null?null:wo(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dd{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){t==null?delete this.cache_[e]:this.cache_[e]=t}get(e){return kt(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Dl=function(n){try{if(typeof window<"u"&&typeof window[n]<"u"){const e=window[n];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new fd(e)}}catch{}return new dd},hn=Dl("localStorage"),pd=Dl("sessionStorage");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Nn=new Dh("@firebase/database"),md=function(){let n=1;return function(){return n++}}(),Ml=function(n){const e=Lh(n),t=new $h;t.update(e);const r=t.digest();return Fh.encodeByteArray(r)},Or=function(...n){let e="";for(let t=0;t<n.length;t++){const r=n[t];Array.isArray(r)||r&&typeof r=="object"&&typeof r.length=="number"?e+=Or.apply(null,r):typeof r=="object"?e+=Je(r):e+=r,e+=" "}return e};let _r=null,iu=!0;const _d=function(n,e){Q(!0,"Can't turn on custom loggers persistently."),Nn.logLevel=Bh.VERBOSE,_r=Nn.log.bind(Nn)},et=function(...n){if(iu===!0&&(iu=!1,_r===null&&pd.get("logging_enabled")===!0&&_d()),_r){const e=Or.apply(null,n);_r(e)}},Rr=function(n){return function(...e){et(n,...e)}},ro=function(...n){const e="FIREBASE INTERNAL ERROR: "+Or(...n);Nn.error(e)},Nt=function(...n){const e=`FIREBASE FATAL ERROR: ${Or(...n)}`;throw Nn.error(e),new Error(e)},ht=function(...n){const e="FIREBASE WARNING: "+Or(...n);Nn.warn(e)},gd=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&ht("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},Yi=function(n){return typeof n=="number"&&(n!==n||n===Number.POSITIVE_INFINITY||n===Number.NEGATIVE_INFINITY)},yd=function(n){if(document.readyState==="complete")n();else{let e=!1;const t=function(){if(!document.body){setTimeout(t,Math.floor(10));return}e||(e=!0,n())};document.addEventListener?(document.addEventListener("DOMContentLoaded",t,!1),window.addEventListener("load",t,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&t()}),window.attachEvent("onload",t))}},Bn="[MIN_NAME]",pn="[MAX_NAME]",bn=function(n,e){if(n===e)return 0;if(n===Bn||e===pn)return-1;if(e===Bn||n===pn)return 1;{const t=su(n),r=su(e);return t!==null?r!==null?t-r===0?n.length-e.length:t-r:-1:r!==null?1:n<e?-1:1}},vd=function(n,e){return n===e?0:n<e?-1:1},cr=function(n,e){if(e&&n in e)return e[n];throw new Error("Missing required key ("+n+") in object: "+Je(e))},Ao=function(n){if(typeof n!="object"||n===null)return Je(n);const e=[];for(const r in n)e.push(r);e.sort();let t="{";for(let r=0;r<e.length;r++)r!==0&&(t+=","),t+=Je(e[r]),t+=":",t+=Ao(n[e[r]]);return t+="}",t},Nl=function(n,e){const t=n.length;if(t<=e)return[n];const r=[];for(let i=0;i<t;i+=e)i+e>t?r.push(n.substring(i,t)):r.push(n.substring(i,i+e));return r};function it(n,e){for(const t in n)n.hasOwnProperty(t)&&e(t,n[t])}const Ll=function(n){Q(!Yi(n),"Invalid JSON number");const e=11,t=52,r=(1<<e-1)-1;let i,a,u,h,f;n===0?(a=0,u=0,i=1/n===-1/0?1:0):(i=n<0,n=Math.abs(n),n>=Math.pow(2,1-r)?(h=Math.min(Math.floor(Math.log(n)/Math.LN2),r),a=h+r,u=Math.round(n*Math.pow(2,t-h)-Math.pow(2,t))):(a=0,u=Math.round(n/Math.pow(2,1-r-t))));const p=[];for(f=t;f;f-=1)p.push(u%2?1:0),u=Math.floor(u/2);for(f=e;f;f-=1)p.push(a%2?1:0),a=Math.floor(a/2);p.push(i?1:0),p.reverse();const y=p.join("");let v="";for(f=0;f<64;f+=8){let I=parseInt(y.substr(f,8),2).toString(16);I.length===1&&(I="0"+I),v=v+I}return v.toLowerCase()},wd=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},bd=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function Ed(n,e){let t="Unknown Error";n==="too_big"?t="The data requested exceeds the maximum size that can be accessed with a single request.":n==="permission_denied"?t="Client doesn't have permission to access the desired data.":n==="unavailable"&&(t="The service is unavailable");const r=new Error(n+" at "+e._path.toString()+": "+t);return r.code=n.toUpperCase(),r}const xd=new RegExp("^-?(0*)\\d{1,10}$"),Cd=-2147483648,Td=2147483647,su=function(n){if(xd.test(n)){const e=Number(n);if(e>=Cd&&e<=Td)return e}return null},Kn=function(n){try{n()}catch(e){setTimeout(()=>{const t=e.stack||"";throw ht("Exception was thrown by user callback.",t),e},Math.floor(0))}},Sd=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},gr=function(n,e){const t=setTimeout(n,e);return typeof t=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(t):typeof t=="object"&&t.unref&&t.unref(),t};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Id{constructor(e,t){this.appCheckProvider=t,this.appName=e.name,jh(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.appCheck=t==null?void 0:t.getImmediate({optional:!0}),this.appCheck||t==null||t.get().then(r=>this.appCheck=r)}getToken(e){if(this.serverAppAppCheckToken){if(e)throw new Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(e):new Promise((t,r)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,r):t(null)},0)})}addTokenChangeListener(e){var t;(t=this.appCheckProvider)===null||t===void 0||t.get().then(r=>r.addTokenListener(e))}notifyForInvalidToken(){ht(`Provided AppCheck credentials for the app named "${this.appName}" are invalid. This usually indicates your app was not initialized correctly.`)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kd{constructor(e,t,r){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=r,this.auth_=null,this.auth_=r.getImmediate({optional:!0}),this.auth_||r.onInit(i=>this.auth_=i)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(t=>t&&t.code==="auth/token-not-initialized"?(et("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)):new Promise((t,r)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,r):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',ht(e)}}class mi{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}mi.OWNER="owner";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Po="5",$l="v",Fl="s",jl="r",Bl="f",ql=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,Ul="ls",Vl="p",io="ac",Kl="websocket",Wl="long_polling";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yl{constructor(e,t,r,i,a=!1,u="",h=!1,f=!1,p=null){this.secure=t,this.namespace=r,this.webSocketOnly=i,this.nodeAdmin=a,this.persistenceKey=u,this.includeNamespaceInQueryParams=h,this.isUsingEmulator=f,this.emulatorOptions=p,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=hn.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&hn.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){const e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}}function Ad(n){return n.host!==n.internalHost||n.isCustomHost()||n.includeNamespaceInQueryParams}function Hl(n,e,t){Q(typeof e=="string","typeof type must == string"),Q(typeof t=="object","typeof params must == object");let r;if(e===Kl)r=(n.secure?"wss://":"ws://")+n.internalHost+"/.ws?";else if(e===Wl)r=(n.secure?"https://":"http://")+n.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);Ad(n)&&(t.ns=n.namespace);const i=[];return it(t,(a,u)=>{i.push(a+"="+u)}),r+i.join("&")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pd{constructor(){this.counters_={}}incrementCounter(e,t=1){kt(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return Wh(this.counters_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qs={},Us={};function Oo(n){const e=n.toString();return qs[e]||(qs[e]=new Pd),qs[e]}function Od(n,e){const t=n.toString();return Us[t]||(Us[t]=e()),Us[t]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rd{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){const r=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let i=0;i<r.length;++i)r[i]&&Kn(()=>{this.onMessage_(r[i])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ou="start",Dd="close",Md="pLPCommand",Nd="pRTLPCB",zl="id",Gl="pw",Ql="ser",Ld="cb",$d="seg",Fd="ts",jd="d",Bd="dframe",Xl=1870,Jl=30,qd=Xl-Jl,Ud=25e3,Vd=3e4;class Mn{constructor(e,t,r,i,a,u,h){this.connId=e,this.repoInfo=t,this.applicationId=r,this.appCheckToken=i,this.authToken=a,this.transportSessionId=u,this.lastSessionId=h,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=Rr(e),this.stats_=Oo(t),this.urlFn=f=>(this.appCheckToken&&(f[io]=this.appCheckToken),Hl(t,Wl,f))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new Rd(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(Vd)),yd(()=>{if(this.isClosed_)return;this.scriptTagHolder=new Ro((...a)=>{const[u,h,f,p,y]=a;if(this.incrementIncomingBytes_(a),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,u===ou)this.id=h,this.password=f;else if(u===Dd)h?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(h,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+u)},(...a)=>{const[u,h]=a;this.incrementIncomingBytes_(a),this.myPacketOrderer.handleResponse(u,h)},()=>{this.onClosed_()},this.urlFn);const r={};r[ou]="t",r[Ql]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(r[Ld]=this.scriptTagHolder.uniqueCallbackIdentifier),r[$l]=Po,this.transportSessionId&&(r[Fl]=this.transportSessionId),this.lastSessionId&&(r[Ul]=this.lastSessionId),this.applicationId&&(r[Vl]=this.applicationId),this.appCheckToken&&(r[io]=this.appCheckToken),typeof location<"u"&&location.hostname&&ql.test(location.hostname)&&(r[jl]=Bl);const i=this.urlFn(r);this.log_("Connecting via long-poll to "+i),this.scriptTagHolder.addTag(i,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){Mn.forceAllow_=!0}static forceDisallow(){Mn.forceDisallow_=!0}static isAvailable(){return Mn.forceAllow_?!0:!Mn.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!wd()&&!bd()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const t=Je(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const r=Yh(t),i=Nl(r,qd);for(let a=0;a<i.length;a++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,i.length,i[a]),this.curSegmentNum++}addDisconnectPingFrame(e,t){this.myDisconnFrame=document.createElement("iframe");const r={};r[Bd]="t",r[zl]=e,r[Gl]=t,this.myDisconnFrame.src=this.urlFn(r),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const t=Je(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class Ro{constructor(e,t,r,i){this.onDisconnect=r,this.urlFn=i,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=md(),window[Md+this.uniqueCallbackIdentifier]=e,window[Nd+this.uniqueCallbackIdentifier]=t,this.myIFrame=Ro.createIFrame_();let a="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(a='<script>document.domain="'+document.domain+'";<\/script>');const u="<html><body>"+a+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(u),this.myIFrame.doc.close()}catch(h){et("frame writing exception"),h.stack&&et(h.stack),et(h)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||et("No IE domain setting required")}catch{const r=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+r+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e[zl]=this.myID,e[Gl]=this.myPW,e[Ql]=this.currentSerial;let t=this.urlFn(e),r="",i=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+Jl+r.length<=Xl;){const u=this.pendingSegs.shift();r=r+"&"+$d+i+"="+u.seg+"&"+Fd+i+"="+u.ts+"&"+jd+i+"="+u.d,i++}return t=t+r,this.addLongPollTag_(t,this.currentSerial),!0}else return!1}enqueueSegment(e,t,r){this.pendingSegs.push({seg:e,ts:t,d:r}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);const r=()=>{this.outstandingRequests.delete(t),this.newRequest_()},i=setTimeout(r,Math.floor(Ud)),a=()=>{clearTimeout(i),r()};this.addTag(e,a)}addTag(e,t){setTimeout(()=>{try{if(!this.sendNewPolls)return;const r=this.myIFrame.doc.createElement("script");r.type="text/javascript",r.async=!0,r.src=e,r.onload=r.onreadystatechange=function(){const i=r.readyState;(!i||i==="loaded"||i==="complete")&&(r.onload=r.onreadystatechange=null,r.parentNode&&r.parentNode.removeChild(r),t())},r.onerror=()=>{et("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(r)}catch{}},Math.floor(1))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Kd=16384,Wd=45e3;let Ii=null;typeof MozWebSocket<"u"?Ii=MozWebSocket:typeof WebSocket<"u"&&(Ii=WebSocket);class wt{constructor(e,t,r,i,a,u,h){this.connId=e,this.applicationId=r,this.appCheckToken=i,this.authToken=a,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=Rr(this.connId),this.stats_=Oo(t),this.connURL=wt.connectionURL_(t,u,h,i,r),this.nodeAdmin=t.nodeAdmin}static connectionURL_(e,t,r,i,a){const u={};return u[$l]=Po,typeof location<"u"&&location.hostname&&ql.test(location.hostname)&&(u[jl]=Bl),t&&(u[Fl]=t),r&&(u[Ul]=r),i&&(u[io]=i),a&&(u[Vl]=a),Hl(e,Kl,u)}open(e,t){this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,hn.set("previous_websocket_failure",!0);try{let r;Hh(),this.mySock=new Ii(this.connURL,[],r)}catch(r){this.log_("Error instantiating WebSocket.");const i=r.message||r.data;i&&this.log_(i),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=r=>{this.handleIncomingFrame(r)},this.mySock.onerror=r=>{this.log_("WebSocket error.  Closing connection.");const i=r.message||r.data;i&&this.log_(i),this.onClosed_()}}start(){}static forceDisallow(){wt.forceDisallow_=!0}static isAvailable(){let e=!1;if(typeof navigator<"u"&&navigator.userAgent){const t=/Android ([0-9]{0,}\.[0-9]{0,})/,r=navigator.userAgent.match(t);r&&r.length>1&&parseFloat(r[1])<4.4&&(e=!0)}return!e&&Ii!==null&&!wt.forceDisallow_}static previouslyFailed(){return hn.isInMemoryStorage||hn.get("previous_websocket_failure")===!0}markConnectionHealthy(){hn.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const t=this.frames.join("");this.frames=null;const r=wo(t);this.onMessage(r)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(Q(this.frames===null,"We already have a frame buffer"),e.length<=6){const t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(this.mySock===null)return;const t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(t);else{const r=this.extractFrameCount_(t);r!==null&&this.appendFrame_(r)}}send(e){this.resetKeepAlive();const t=Je(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const r=Nl(t,Kd);r.length>1&&this.sendString_(String(r.length));for(let i=0;i<r.length;i++)this.sendString_(r[i])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(Wd))}sendString_(e){try{this.mySock.send(e)}catch(t){this.log_("Exception thrown from WebSocket.send():",t.message||t.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}wt.responsesRequiredToBeHealthy=2;wt.healthyTimeout=3e4;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class br{static get ALL_TRANSPORTS(){return[Mn,wt]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(e){this.initTransports_(e)}initTransports_(e){const t=wt&&wt.isAvailable();let r=t&&!wt.previouslyFailed();if(e.webSocketOnly&&(t||ht("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),r=!0),r)this.transports_=[wt];else{const i=this.transports_=[];for(const a of br.ALL_TRANSPORTS)a&&a.isAvailable()&&i.push(a);br.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}br.globalTransportInitialized_=!1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Yd=6e4,Hd=5e3,zd=10*1024,Gd=100*1024,Vs="t",au="d",Qd="s",uu="r",Xd="e",lu="o",cu="a",hu="n",fu="p",Jd="h";class Zd{constructor(e,t,r,i,a,u,h,f,p,y){this.id=e,this.repoInfo_=t,this.applicationId_=r,this.appCheckToken_=i,this.authToken_=a,this.onMessage_=u,this.onReady_=h,this.onDisconnect_=f,this.onKill_=p,this.lastSessionId=y,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=Rr("c:"+this.id+":"),this.transportManager_=new br(t),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.conn_),r=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,r)},Math.floor(0));const i=e.healthyTimeout||0;i>0&&(this.healthyTimeout_=gr(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>Gd?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>zd?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(i)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){const t={t:"d",d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(Vs in e){const t=e[Vs];t===cu?this.upgradeIfSecondaryHealthy_():t===uu?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):t===lu&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const t=cr("t",e),r=cr("d",e);if(t==="c")this.onSecondaryControl_(r);else if(t==="d")this.pendingDataMessages.push(r);else throw new Error("Unknown protocol layer: "+t)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:fu,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:cu,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:hu,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const t=cr("t",e),r=cr("d",e);t==="c"?this.onControl_(r):t==="d"&&this.onDataMessage_(r)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const t=cr(Vs,e);if(au in e){const r=e[au];if(t===Jd){const i=Object.assign({},r);this.repoInfo_.isUsingEmulator&&(i.h=this.repoInfo_.host),this.onHandshake_(i)}else if(t===hu){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let i=0;i<this.pendingDataMessages.length;++i)this.onDataMessage_(this.pendingDataMessages[i]);this.pendingDataMessages=[],this.tryCleanupConnection()}else t===Qd?this.onConnectionShutdown_(r):t===uu?this.onReset_(r):t===Xd?ro("Server Error: "+r):t===lu?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):ro("Unknown control packet command: "+t)}}onHandshake_(e){const t=e.ts,r=e.v,i=e.h;this.sessionId=e.s,this.repoInfo_.host=i,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),Po!==r&&ht("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.secondaryConn_),r=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,r),gr(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(Yd))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):gr(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(Hd))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:fu,d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(hn.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zl{put(e,t,r,i){}merge(e,t,r,i){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,r){}onDisconnectMerge(e,t,r){}onDisconnectCancel(e,t){}reportStats(e){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ec{constructor(e){this.allowedEvents_=e,this.listeners_={},Q(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){const r=[...this.listeners_[e]];for(let i=0;i<r.length;i++)r[i].callback.apply(r[i].context,t)}}on(e,t,r){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:r});const i=this.getInitialEvent(e);i&&t.apply(r,i)}off(e,t,r){this.validateEventType_(e);const i=this.listeners_[e]||[];for(let a=0;a<i.length;a++)if(i[a].callback===t&&(!r||r===i[a].context)){i.splice(a,1);return}}validateEventType_(e){Q(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ki extends ec{static getInstance(){return new ki}constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!ul()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}getInitialEvent(e){return Q(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const du=32,pu=768;class De{constructor(e,t){if(t===void 0){this.pieces_=e.split("/");let r=0;for(let i=0;i<this.pieces_.length;i++)this.pieces_[i].length>0&&(this.pieces_[r]=this.pieces_[i],r++);this.pieces_.length=r,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)this.pieces_[t]!==""&&(e+="/"+this.pieces_[t]);return e||"/"}}function Oe(){return new De("")}function ve(n){return n.pieceNum_>=n.pieces_.length?null:n.pieces_[n.pieceNum_]}function zt(n){return n.pieces_.length-n.pieceNum_}function Me(n){let e=n.pieceNum_;return e<n.pieces_.length&&e++,new De(n.pieces_,e)}function Do(n){return n.pieceNum_<n.pieces_.length?n.pieces_[n.pieces_.length-1]:null}function ep(n){let e="";for(let t=n.pieceNum_;t<n.pieces_.length;t++)n.pieces_[t]!==""&&(e+="/"+encodeURIComponent(String(n.pieces_[t])));return e||"/"}function Er(n,e=0){return n.pieces_.slice(n.pieceNum_+e)}function tc(n){if(n.pieceNum_>=n.pieces_.length)return null;const e=[];for(let t=n.pieceNum_;t<n.pieces_.length-1;t++)e.push(n.pieces_[t]);return new De(e,0)}function Ve(n,e){const t=[];for(let r=n.pieceNum_;r<n.pieces_.length;r++)t.push(n.pieces_[r]);if(e instanceof De)for(let r=e.pieceNum_;r<e.pieces_.length;r++)t.push(e.pieces_[r]);else{const r=e.split("/");for(let i=0;i<r.length;i++)r[i].length>0&&t.push(r[i])}return new De(t,0)}function xe(n){return n.pieceNum_>=n.pieces_.length}function lt(n,e){const t=ve(n),r=ve(e);if(t===null)return e;if(t===r)return lt(Me(n),Me(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+n+")")}function tp(n,e){const t=Er(n,0),r=Er(e,0);for(let i=0;i<t.length&&i<r.length;i++){const a=bn(t[i],r[i]);if(a!==0)return a}return t.length===r.length?0:t.length<r.length?-1:1}function Mo(n,e){if(zt(n)!==zt(e))return!1;for(let t=n.pieceNum_,r=e.pieceNum_;t<=n.pieces_.length;t++,r++)if(n.pieces_[t]!==e.pieces_[r])return!1;return!0}function yt(n,e){let t=n.pieceNum_,r=e.pieceNum_;if(zt(n)>zt(e))return!1;for(;t<n.pieces_.length;){if(n.pieces_[t]!==e.pieces_[r])return!1;++t,++r}return!0}class np{constructor(e,t){this.errorPrefix_=t,this.parts_=Er(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let r=0;r<this.parts_.length;r++)this.byteLength_+=Ui(this.parts_[r]);nc(this)}}function rp(n,e){n.parts_.length>0&&(n.byteLength_+=1),n.parts_.push(e),n.byteLength_+=Ui(e),nc(n)}function ip(n){const e=n.parts_.pop();n.byteLength_-=Ui(e),n.parts_.length>0&&(n.byteLength_-=1)}function nc(n){if(n.byteLength_>pu)throw new Error(n.errorPrefix_+"has a key path longer than "+pu+" bytes ("+n.byteLength_+").");if(n.parts_.length>du)throw new Error(n.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+du+") or object contains a cycle "+cn(n))}function cn(n){return n.parts_.length===0?"":"in property '"+n.parts_.join(".")+"'"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class No extends ec{static getInstance(){return new No}constructor(){super(["visible"]);let e,t;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(t="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(t="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(t="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{const r=!document[e];r!==this.visible_&&(this.visible_=r,this.trigger("visible",r))},!1)}getInitialEvent(e){return Q(e==="visible","Unknown event type: "+e),[this.visible_]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hr=1e3,sp=60*5*1e3,mu=30*1e3,op=1.3,ap=3e4,up="server_kill",_u=3;class Dt extends Zl{constructor(e,t,r,i,a,u,h,f){if(super(),this.repoInfo_=e,this.applicationId_=t,this.onDataUpdate_=r,this.onConnectStatus_=i,this.onServerInfoUpdate_=a,this.authTokenProvider_=u,this.appCheckTokenProvider_=h,this.authOverride_=f,this.id=Dt.nextPersistentConnectionId_++,this.log_=Rr("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=hr,this.maxReconnectDelay_=sp,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,f)throw new Error("Auth override specified in options, but not supported on non Node.js platforms");No.getInstance().on("visible",this.onVisible_,this),e.host.indexOf("fblocal")===-1&&ki.getInstance().on("online",this.onOnline_,this)}sendRequest(e,t,r){const i=++this.requestNumber_,a={r:i,a:e,b:t};this.log_(Je(a)),Q(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(a),r&&(this.requestCBHash_[i]=r)}get(e){this.initConnection_();const t=new Yt,i={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:u=>{const h=u.d;u.s==="ok"?t.resolve(h):t.reject(h)}};this.outstandingGets_.push(i),this.outstandingGetCount_++;const a=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(a),t.promise}listen(e,t,r,i){this.initConnection_();const a=e._queryIdentifier,u=e._path.toString();this.log_("Listen called for "+u+" "+a),this.listens.has(u)||this.listens.set(u,new Map),Q(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),Q(!this.listens.get(u).has(a),"listen() called twice for same path/queryId.");const h={onComplete:i,hashFn:t,query:e,tag:r};this.listens.get(u).set(a,h),this.connected_&&this.sendListen_(h)}sendGet_(e){const t=this.outstandingGets_[e];this.sendRequest("g",t.request,r=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),t.onComplete&&t.onComplete(r)})}sendListen_(e){const t=e.query,r=t._path.toString(),i=t._queryIdentifier;this.log_("Listen on "+r+" for "+i);const a={p:r},u="q";e.tag&&(a.q=t._queryObject,a.t=e.tag),a.h=e.hashFn(),this.sendRequest(u,a,h=>{const f=h.d,p=h.s;Dt.warnOnListenWarnings_(f,t),(this.listens.get(r)&&this.listens.get(r).get(i))===e&&(this.log_("listen response",h),p!=="ok"&&this.removeListen_(r,i),e.onComplete&&e.onComplete(p,f))})}static warnOnListenWarnings_(e,t){if(e&&typeof e=="object"&&kt(e,"w")){const r=Fn(e,"w");if(Array.isArray(r)&&~r.indexOf("no_index")){const i='".indexOn": "'+t._queryParams.getIndex().toString()+'"',a=t._path.toString();ht(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${i} at ${a} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&e.length===40||Uh(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=mu)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,t=Vh(e)?"auth":"gauth",r={cred:e};this.authOverride_===null?r.noauth=!0:typeof this.authOverride_=="object"&&(r.authvar=this.authOverride_),this.sendRequest(t,r,i=>{const a=i.s,u=i.d||"error";this.authToken_===e&&(a==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(a,u))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{const t=e.s,r=e.d||"error";t==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,r)})}unlisten(e,t){const r=e._path.toString(),i=e._queryIdentifier;this.log_("Unlisten called for "+r+" "+i),Q(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(r,i)&&this.connected_&&this.sendUnlisten_(r,i,e._queryObject,t)}sendUnlisten_(e,t,r,i){this.log_("Unlisten on "+e+" for "+t);const a={p:e},u="n";i&&(a.q=r,a.t=i),this.sendRequest(u,a)}onDisconnectPut(e,t,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,r):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:r})}onDisconnectMerge(e,t,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,r):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:r})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,r,i){const a={p:t,d:r};this.log_("onDisconnect "+e,a),this.sendRequest(e,a,u=>{i&&setTimeout(()=>{i(u.s,u.d)},Math.floor(0))})}put(e,t,r,i){this.putInternal("p",e,t,r,i)}merge(e,t,r,i){this.putInternal("m",e,t,r,i)}putInternal(e,t,r,i,a){this.initConnection_();const u={p:t,d:r};a!==void 0&&(u.h=a),this.outstandingPuts_.push({action:e,request:u,onComplete:i}),this.outstandingPutCount_++;const h=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(h):this.log_("Buffering put: "+t)}sendPut_(e){const t=this.outstandingPuts_[e].action,r=this.outstandingPuts_[e].request,i=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(t,r,a=>{this.log_(t+" response",a),delete this.outstandingPuts_[e],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),i&&i(a.s,a.d)})}reportStats(e){if(this.connected_){const t={c:e};this.log_("reportStats",t),this.sendRequest("s",t,r=>{if(r.s!=="ok"){const a=r.d;this.log_("reportStats","Error sending stats: "+a)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+Je(e));const t=e.r,r=this.requestCBHash_[t];r&&(delete this.requestCBHash_[t],r(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,t){this.log_("handleServerMessage",e,t),e==="d"?this.onDataUpdate_(t.p,t.d,!1,t.t):e==="m"?this.onDataUpdate_(t.p,t.d,!0,t.t):e==="c"?this.onListenRevoked_(t.p,t.q):e==="ac"?this.onAuthRevoked_(t.s,t.d):e==="apc"?this.onAppCheckRevoked_(t.s,t.d):e==="sd"?this.onSecurityDebugPacket_(t):ro("Unrecognized action received from server: "+Je(e)+`
Are you using the latest client?`)}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){Q(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=hr,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=hr,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>ap&&(this.reconnectDelay_=hr),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());const e=Math.max(0,new Date().getTime()-this.lastConnectionAttemptTime_);let t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*op)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;const e=this.onDataMessage_.bind(this),t=this.onReady_.bind(this),r=this.onRealtimeDisconnect_.bind(this),i=this.id+":"+Dt.nextConnectionId_++,a=this.lastSessionId;let u=!1,h=null;const f=function(){h?h.close():(u=!0,r())},p=function(v){Q(h,"sendRequest call when we're not connected not allowed."),h.sendRequest(v)};this.realtime_={close:f,sendRequest:p};const y=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[v,I]=await Promise.all([this.authTokenProvider_.getToken(y),this.appCheckTokenProvider_.getToken(y)]);u?et("getToken() completed but was canceled"):(et("getToken() completed. Creating connection."),this.authToken_=v&&v.accessToken,this.appCheckToken_=I&&I.token,h=new Zd(i,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,t,r,M=>{ht(M+" ("+this.repoInfo_.toString()+")"),this.interrupt(up)},a))}catch(v){this.log_("Failed to get token: "+v),u||(this.repoInfo_.nodeAdmin&&ht(v),f())}}}interrupt(e){et("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){et("Resuming connection for reason: "+e),delete this.interruptReasons_[e],Zs(this.interruptReasons_)&&(this.reconnectDelay_=hr,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const t=e-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:t})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){let r;t?r=t.map(a=>Ao(a)).join("$"):r="default";const i=this.removeListen_(e,r);i&&i.onComplete&&i.onComplete("permission_denied")}removeListen_(e,t){const r=new De(e).toString();let i;if(this.listens.has(r)){const a=this.listens.get(r);i=a.get(t),a.delete(t),a.size===0&&this.listens.delete(r)}else i=void 0;return i}onAuthRevoked_(e,t){et("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(e==="invalid_token"||e==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=_u&&(this.reconnectDelay_=mu,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){et("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(e==="invalid_token"||e==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=_u&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const t of e.values())this.sendListen_(t);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};let t="js";e["sdk."+t+"."+Rl.replace(/\./g,"-")]=1,ul()?e["framework.cordova"]=1:Kh()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=ki.getInstance().currentlyOnline();return Zs(this.interruptReasons_)&&e}}Dt.nextPersistentConnectionId_=0;Dt.nextConnectionId_=0;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ce{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new Ce(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hi{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){const r=new Ce(Bn,e),i=new Ce(Bn,t);return this.compare(r,i)!==0}minPost(){return Ce.MIN}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let hi;class rc extends Hi{static get __EMPTY_NODE(){return hi}static set __EMPTY_NODE(e){hi=e}compare(e,t){return bn(e.name,t.name)}isDefinedOn(e){throw Ar("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return Ce.MIN}maxPost(){return new Ce(pn,hi)}makePost(e,t){return Q(typeof e=="string","KeyIndex indexValue must always be a string."),new Ce(e,hi)}toString(){return".key"}}const Ln=new rc;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fi{constructor(e,t,r,i,a=null){this.isReverse_=i,this.resultGenerator_=a,this.nodeStack_=[];let u=1;for(;!e.isEmpty();)if(e=e,u=t?r(e.key,t):1,i&&(u*=-1),u<0)this.isReverse_?e=e.left:e=e.right;else if(u===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),t;if(this.resultGenerator_?t=this.resultGenerator_(e.key,e.value):t={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class Qe{constructor(e,t,r,i,a){this.key=e,this.value=t,this.color=r??Qe.RED,this.left=i??ct.EMPTY_NODE,this.right=a??ct.EMPTY_NODE}copy(e,t,r,i,a){return new Qe(e??this.key,t??this.value,r??this.color,i??this.left,a??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let i=this;const a=r(e,i.key);return a<0?i=i.copy(null,null,null,i.left.insert(e,t,r),null):a===0?i=i.copy(null,t,null,null,null):i=i.copy(null,null,null,null,i.right.insert(e,t,r)),i.fixUp_()}removeMin_(){if(this.left.isEmpty())return ct.EMPTY_NODE;let e=this;return!e.left.isRed_()&&!e.left.left.isRed_()&&(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,t){let r,i;if(r=this,t(e,r.key)<0)!r.left.isEmpty()&&!r.left.isRed_()&&!r.left.left.isRed_()&&(r=r.moveRedLeft_()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed_()&&(r=r.rotateRight_()),!r.right.isEmpty()&&!r.right.isRed_()&&!r.right.left.isRed_()&&(r=r.moveRedRight_()),t(e,r.key)===0){if(r.right.isEmpty())return ct.EMPTY_NODE;i=r.right.min_(),r=r.copy(i.key,i.value,null,null,r.right.removeMin_())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,Qe.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,Qe.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}Qe.RED=!0;Qe.BLACK=!1;class lp{copy(e,t,r,i,a){return this}insert(e,t,r){return new Qe(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}}class ct{constructor(e,t=ct.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new ct(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,Qe.BLACK,null,null))}remove(e){return new ct(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,Qe.BLACK,null,null))}get(e){let t,r=this.root_;for(;!r.isEmpty();){if(t=this.comparator_(e,r.key),t===0)return r.value;t<0?r=r.left:t>0&&(r=r.right)}return null}getPredecessorKey(e){let t,r=this.root_,i=null;for(;!r.isEmpty();)if(t=this.comparator_(e,r.key),t===0){if(r.left.isEmpty())return i?i.key:null;for(r=r.left;!r.right.isEmpty();)r=r.right;return r.key}else t<0?r=r.left:t>0&&(i=r,r=r.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new fi(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new fi(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new fi(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new fi(this.root_,null,this.comparator_,!0,e)}}ct.EMPTY_NODE=new lp;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cp(n,e){return bn(n.name,e.name)}function Lo(n,e){return bn(n,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let so;function hp(n){so=n}const ic=function(n){return typeof n=="number"?"number:"+Ll(n):"string:"+n},sc=function(n){if(n.isLeafNode()){const e=n.val();Q(typeof e=="string"||typeof e=="number"||typeof e=="object"&&kt(e,".sv"),"Priority must be a string or number.")}else Q(n===so||n.isEmpty(),"priority of unexpected type.");Q(n===so||n.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let gu;class Ge{static set __childrenNodeConstructor(e){gu=e}static get __childrenNodeConstructor(){return gu}constructor(e,t=Ge.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=t,this.lazyHash_=null,Q(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),sc(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new Ge(this.value_,e)}getImmediateChild(e){return e===".priority"?this.priorityNode_:Ge.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return xe(e)?this:ve(e)===".priority"?this.priorityNode_:Ge.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(e,t){return e===".priority"?this.updatePriority(t):t.isEmpty()&&e!==".priority"?this:Ge.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)}updateChild(e,t){const r=ve(e);return r===null?t:t.isEmpty()&&r!==".priority"?this:(Q(r!==".priority"||zt(e)===1,".priority must be the last token in a path"),this.updateImmediateChild(r,Ge.__childrenNodeConstructor.EMPTY_NODE.updateChild(Me(e),t)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+ic(this.priorityNode_.val())+":");const t=typeof this.value_;e+=t+":",t==="number"?e+=Ll(this.value_):e+=this.value_,this.lazyHash_=Ml(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===Ge.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof Ge.__childrenNodeConstructor?-1:(Q(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const t=typeof e.value_,r=typeof this.value_,i=Ge.VALUE_TYPE_ORDER.indexOf(t),a=Ge.VALUE_TYPE_ORDER.indexOf(r);return Q(i>=0,"Unknown leaf type: "+t),Q(a>=0,"Unknown leaf type: "+r),i===a?r==="object"?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:a-i}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const t=e;return this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_)}else return!1}}Ge.VALUE_TYPE_ORDER=["object","boolean","number","string"];/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let oc,ac;function fp(n){oc=n}function dp(n){ac=n}class pp extends Hi{compare(e,t){const r=e.node.getPriority(),i=t.node.getPriority(),a=r.compareTo(i);return a===0?bn(e.name,t.name):a}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return Ce.MIN}maxPost(){return new Ce(pn,new Ge("[PRIORITY-POST]",ac))}makePost(e,t){const r=oc(e);return new Ce(t,new Ge("[PRIORITY-POST]",r))}toString(){return".priority"}}const Be=new pp;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mp=Math.log(2);class _p{constructor(e){const t=a=>parseInt(Math.log(a)/mp,10),r=a=>parseInt(Array(a+1).join("1"),2);this.count=t(e+1),this.current_=this.count-1;const i=r(this.count);this.bits_=e+1&i}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const Ai=function(n,e,t,r){n.sort(e);const i=function(f,p){const y=p-f;let v,I;if(y===0)return null;if(y===1)return v=n[f],I=t?t(v):v,new Qe(I,v.node,Qe.BLACK,null,null);{const M=parseInt(y/2,10)+f,B=i(f,M),ue=i(M+1,p);return v=n[M],I=t?t(v):v,new Qe(I,v.node,Qe.BLACK,B,ue)}},a=function(f){let p=null,y=null,v=n.length;const I=function(B,ue){const Z=v-B,de=v;v-=B;const _e=i(Z+1,de),ce=n[Z],Ae=t?t(ce):ce;M(new Qe(Ae,ce.node,ue,null,_e))},M=function(B){p?(p.left=B,p=B):(y=B,p=B)};for(let B=0;B<f.count;++B){const ue=f.nextBitIsOne(),Z=Math.pow(2,f.count-(B+1));ue?I(Z,Qe.BLACK):(I(Z,Qe.BLACK),I(Z,Qe.RED))}return y},u=new _p(n.length),h=a(u);return new ct(r||e,h)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Ks;const On={};class Rt{static get Default(){return Q(On&&Be,"ChildrenNode.ts has not been loaded"),Ks=Ks||new Rt({".priority":On},{".priority":Be}),Ks}constructor(e,t){this.indexes_=e,this.indexSet_=t}get(e){const t=Fn(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof ct?t:null}hasIndex(e){return kt(this.indexSet_,e.toString())}addIndex(e,t){Q(e!==Ln,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const r=[];let i=!1;const a=t.getIterator(Ce.Wrap);let u=a.getNext();for(;u;)i=i||e.isDefinedOn(u.node),r.push(u),u=a.getNext();let h;i?h=Ai(r,e.getCompare()):h=On;const f=e.toString(),p=Object.assign({},this.indexSet_);p[f]=e;const y=Object.assign({},this.indexes_);return y[f]=h,new Rt(y,p)}addToIndexes(e,t){const r=Ti(this.indexes_,(i,a)=>{const u=Fn(this.indexSet_,a);if(Q(u,"Missing index implementation for "+a),i===On)if(u.isDefinedOn(e.node)){const h=[],f=t.getIterator(Ce.Wrap);let p=f.getNext();for(;p;)p.name!==e.name&&h.push(p),p=f.getNext();return h.push(e),Ai(h,u.getCompare())}else return On;else{const h=t.get(e.name);let f=i;return h&&(f=f.remove(new Ce(e.name,h))),f.insert(e,e.node)}});return new Rt(r,this.indexSet_)}removeFromIndexes(e,t){const r=Ti(this.indexes_,i=>{if(i===On)return i;{const a=t.get(e.name);return a?i.remove(new Ce(e.name,a)):i}});return new Rt(r,this.indexSet_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let fr;class me{static get EMPTY_NODE(){return fr||(fr=new me(new ct(Lo),null,Rt.Default))}constructor(e,t,r){this.children_=e,this.priorityNode_=t,this.indexMap_=r,this.lazyHash_=null,this.priorityNode_&&sc(this.priorityNode_),this.children_.isEmpty()&&Q(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||fr}updatePriority(e){return this.children_.isEmpty()?this:new me(this.children_,e,this.indexMap_)}getImmediateChild(e){if(e===".priority")return this.getPriority();{const t=this.children_.get(e);return t===null?fr:t}}getChild(e){const t=ve(e);return t===null?this:this.getImmediateChild(t).getChild(Me(e))}hasChild(e){return this.children_.get(e)!==null}updateImmediateChild(e,t){if(Q(t,"We should always be passing snapshot nodes"),e===".priority")return this.updatePriority(t);{const r=new Ce(e,t);let i,a;t.isEmpty()?(i=this.children_.remove(e),a=this.indexMap_.removeFromIndexes(r,this.children_)):(i=this.children_.insert(e,t),a=this.indexMap_.addToIndexes(r,this.children_));const u=i.isEmpty()?fr:this.priorityNode_;return new me(i,u,a)}}updateChild(e,t){const r=ve(e);if(r===null)return t;{Q(ve(e)!==".priority"||zt(e)===1,".priority must be the last token in a path");const i=this.getImmediateChild(r).updateChild(Me(e),t);return this.updateImmediateChild(r,i)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const t={};let r=0,i=0,a=!0;if(this.forEachChild(Be,(u,h)=>{t[u]=h.val(e),r++,a&&me.INTEGER_REGEXP_.test(u)?i=Math.max(i,Number(u)):a=!1}),!e&&a&&i<2*r){const u=[];for(const h in t)u[h]=t[h];return u}else return e&&!this.getPriority().isEmpty()&&(t[".priority"]=this.getPriority().val()),t}hash(){if(this.lazyHash_===null){let e="";this.getPriority().isEmpty()||(e+="priority:"+ic(this.getPriority().val())+":"),this.forEachChild(Be,(t,r)=>{const i=r.hash();i!==""&&(e+=":"+t+":"+i)}),this.lazyHash_=e===""?"":Ml(e)}return this.lazyHash_}getPredecessorChildName(e,t,r){const i=this.resolveIndex_(r);if(i){const a=i.getPredecessorKey(new Ce(e,t));return a?a.name:null}else return this.children_.getPredecessorKey(e)}getFirstChildName(e){const t=this.resolveIndex_(e);if(t){const r=t.minKey();return r&&r.name}else return this.children_.minKey()}getFirstChild(e){const t=this.getFirstChildName(e);return t?new Ce(t,this.children_.get(t)):null}getLastChildName(e){const t=this.resolveIndex_(e);if(t){const r=t.maxKey();return r&&r.name}else return this.children_.maxKey()}getLastChild(e){const t=this.getLastChildName(e);return t?new Ce(t,this.children_.get(t)):null}forEachChild(e,t){const r=this.resolveIndex_(e);return r?r.inorderTraversal(i=>t(i.name,i.node)):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,t){const r=this.resolveIndex_(t);if(r)return r.getIteratorFrom(e,i=>i);{const i=this.children_.getIteratorFrom(e.name,Ce.Wrap);let a=i.peek();for(;a!=null&&t.compare(a,e)<0;)i.getNext(),a=i.peek();return i}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,t){const r=this.resolveIndex_(t);if(r)return r.getReverseIteratorFrom(e,i=>i);{const i=this.children_.getReverseIteratorFrom(e.name,Ce.Wrap);let a=i.peek();for(;a!=null&&t.compare(a,e)>0;)i.getNext(),a=i.peek();return i}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===Dr?-1:0}withIndex(e){if(e===Ln||this.indexMap_.hasIndex(e))return this;{const t=this.indexMap_.addIndex(e,this.children_);return new me(this.children_,this.priorityNode_,t)}}isIndexed(e){return e===Ln||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const t=e;if(this.getPriority().equals(t.getPriority()))if(this.children_.count()===t.children_.count()){const r=this.getIterator(Be),i=t.getIterator(Be);let a=r.getNext(),u=i.getNext();for(;a&&u;){if(a.name!==u.name||!a.node.equals(u.node))return!1;a=r.getNext(),u=i.getNext()}return a===null&&u===null}else return!1;else return!1}}resolveIndex_(e){return e===Ln?null:this.indexMap_.get(e.toString())}}me.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class gp extends me{constructor(){super(new ct(Lo),me.EMPTY_NODE,Rt.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return me.EMPTY_NODE}isEmpty(){return!1}}const Dr=new gp;Object.defineProperties(Ce,{MIN:{value:new Ce(Bn,me.EMPTY_NODE)},MAX:{value:new Ce(pn,Dr)}});rc.__EMPTY_NODE=me.EMPTY_NODE;Ge.__childrenNodeConstructor=me;hp(Dr);dp(Dr);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yp=!0;function We(n,e=null){if(n===null)return me.EMPTY_NODE;if(typeof n=="object"&&".priority"in n&&(e=n[".priority"]),Q(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof n=="object"&&".value"in n&&n[".value"]!==null&&(n=n[".value"]),typeof n!="object"||".sv"in n){const t=n;return new Ge(t,We(e))}if(!(n instanceof Array)&&yp){const t=[];let r=!1;if(it(n,(u,h)=>{if(u.substring(0,1)!=="."){const f=We(h);f.isEmpty()||(r=r||!f.getPriority().isEmpty(),t.push(new Ce(u,f)))}}),t.length===0)return me.EMPTY_NODE;const a=Ai(t,cp,u=>u.name,Lo);if(r){const u=Ai(t,Be.getCompare());return new me(a,We(e),new Rt({".priority":u},{".priority":Be}))}else return new me(a,We(e),Rt.Default)}else{let t=me.EMPTY_NODE;return it(n,(r,i)=>{if(kt(n,r)&&r.substring(0,1)!=="."){const a=We(i);(a.isLeafNode()||!a.isEmpty())&&(t=t.updateImmediateChild(r,a))}}),t.updatePriority(We(e))}}fp(We);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vp extends Hi{constructor(e){super(),this.indexPath_=e,Q(!xe(e)&&ve(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){const r=this.extractChild(e.node),i=this.extractChild(t.node),a=r.compareTo(i);return a===0?bn(e.name,t.name):a}makePost(e,t){const r=We(e),i=me.EMPTY_NODE.updateChild(this.indexPath_,r);return new Ce(t,i)}maxPost(){const e=me.EMPTY_NODE.updateChild(this.indexPath_,Dr);return new Ce(pn,e)}toString(){return Er(this.indexPath_,0).join("/")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wp extends Hi{compare(e,t){const r=e.node.compareTo(t.node);return r===0?bn(e.name,t.name):r}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return Ce.MIN}maxPost(){return Ce.MAX}makePost(e,t){const r=We(e);return new Ce(t,r)}toString(){return".value"}}const bp=new wp;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uc(n){return{type:"value",snapshotNode:n}}function qn(n,e){return{type:"child_added",snapshotNode:e,childName:n}}function xr(n,e){return{type:"child_removed",snapshotNode:e,childName:n}}function Cr(n,e,t){return{type:"child_changed",snapshotNode:e,childName:n,oldSnap:t}}function Ep(n,e){return{type:"child_moved",snapshotNode:e,childName:n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $o{constructor(e){this.index_=e}updateChild(e,t,r,i,a,u){Q(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const h=e.getImmediateChild(t);return h.getChild(i).equals(r.getChild(i))&&h.isEmpty()===r.isEmpty()||(u!=null&&(r.isEmpty()?e.hasChild(t)?u.trackChildChange(xr(t,h)):Q(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):h.isEmpty()?u.trackChildChange(qn(t,r)):u.trackChildChange(Cr(t,r,h))),e.isLeafNode()&&r.isEmpty())?e:e.updateImmediateChild(t,r).withIndex(this.index_)}updateFullNode(e,t,r){return r!=null&&(e.isLeafNode()||e.forEachChild(Be,(i,a)=>{t.hasChild(i)||r.trackChildChange(xr(i,a))}),t.isLeafNode()||t.forEachChild(Be,(i,a)=>{if(e.hasChild(i)){const u=e.getImmediateChild(i);u.equals(a)||r.trackChildChange(Cr(i,a,u))}else r.trackChildChange(qn(i,a))})),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?me.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tr{constructor(e){this.indexedFilter_=new $o(e.getIndex()),this.index_=e.getIndex(),this.startPost_=Tr.getStartPost_(e),this.endPost_=Tr.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){const t=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,r=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return t&&r}updateChild(e,t,r,i,a,u){return this.matches(new Ce(t,r))||(r=me.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,r,i,a,u)}updateFullNode(e,t,r){t.isLeafNode()&&(t=me.EMPTY_NODE);let i=t.withIndex(this.index_);i=i.updatePriority(me.EMPTY_NODE);const a=this;return t.forEachChild(Be,(u,h)=>{a.matches(new Ce(u,h))||(i=i.updateImmediateChild(u,me.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,i,r)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){const t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}else return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){const t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}else return e.getIndex().maxPost()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xp{constructor(e){this.withinDirectionalStart=t=>this.reverse_?this.withinEndPost(t):this.withinStartPost(t),this.withinDirectionalEnd=t=>this.reverse_?this.withinStartPost(t):this.withinEndPost(t),this.withinStartPost=t=>{const r=this.index_.compare(this.rangedFilter_.getStartPost(),t);return this.startIsInclusive_?r<=0:r<0},this.withinEndPost=t=>{const r=this.index_.compare(t,this.rangedFilter_.getEndPost());return this.endIsInclusive_?r<=0:r<0},this.rangedFilter_=new Tr(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,r,i,a,u){return this.rangedFilter_.matches(new Ce(t,r))||(r=me.EMPTY_NODE),e.getImmediateChild(t).equals(r)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,r,i,a,u):this.fullLimitUpdateChild_(e,t,r,a,u)}updateFullNode(e,t,r){let i;if(t.isLeafNode()||t.isEmpty())i=me.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<t.numChildren()&&t.isIndexed(this.index_)){i=me.EMPTY_NODE.withIndex(this.index_);let a;this.reverse_?a=t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):a=t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let u=0;for(;a.hasNext()&&u<this.limit_;){const h=a.getNext();if(this.withinDirectionalStart(h))if(this.withinDirectionalEnd(h))i=i.updateImmediateChild(h.name,h.node),u++;else break;else continue}}else{i=t.withIndex(this.index_),i=i.updatePriority(me.EMPTY_NODE);let a;this.reverse_?a=i.getReverseIterator(this.index_):a=i.getIterator(this.index_);let u=0;for(;a.hasNext();){const h=a.getNext();u<this.limit_&&this.withinDirectionalStart(h)&&this.withinDirectionalEnd(h)?u++:i=i.updateImmediateChild(h.name,me.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,i,r)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,r,i,a){let u;if(this.reverse_){const v=this.index_.getCompare();u=(I,M)=>v(M,I)}else u=this.index_.getCompare();const h=e;Q(h.numChildren()===this.limit_,"");const f=new Ce(t,r),p=this.reverse_?h.getFirstChild(this.index_):h.getLastChild(this.index_),y=this.rangedFilter_.matches(f);if(h.hasChild(t)){const v=h.getImmediateChild(t);let I=i.getChildAfterChild(this.index_,p,this.reverse_);for(;I!=null&&(I.name===t||h.hasChild(I.name));)I=i.getChildAfterChild(this.index_,I,this.reverse_);const M=I==null?1:u(I,f);if(y&&!r.isEmpty()&&M>=0)return a!=null&&a.trackChildChange(Cr(t,r,v)),h.updateImmediateChild(t,r);{a!=null&&a.trackChildChange(xr(t,v));const ue=h.updateImmediateChild(t,me.EMPTY_NODE);return I!=null&&this.rangedFilter_.matches(I)?(a!=null&&a.trackChildChange(qn(I.name,I.node)),ue.updateImmediateChild(I.name,I.node)):ue}}else return r.isEmpty()?e:y&&u(p,f)>=0?(a!=null&&(a.trackChildChange(xr(p.name,p.node)),a.trackChildChange(qn(t,r))),h.updateImmediateChild(t,r).updateImmediateChild(p.name,me.EMPTY_NODE)):e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fo{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=Be}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return Q(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return Q(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:Bn}hasEnd(){return this.endSet_}getIndexEndValue(){return Q(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return Q(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:pn}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return Q(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===Be}copy(){const e=new Fo;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function Cp(n){return n.loadsAllData()?new $o(n.getIndex()):n.hasLimit()?new xp(n):new Tr(n)}function yu(n){const e={};if(n.isDefault())return e;let t;if(n.index_===Be?t="$priority":n.index_===bp?t="$value":n.index_===Ln?t="$key":(Q(n.index_ instanceof vp,"Unrecognized index type!"),t=n.index_.toString()),e.orderBy=Je(t),n.startSet_){const r=n.startAfterSet_?"startAfter":"startAt";e[r]=Je(n.indexStartValue_),n.startNameSet_&&(e[r]+=","+Je(n.indexStartName_))}if(n.endSet_){const r=n.endBeforeSet_?"endBefore":"endAt";e[r]=Je(n.indexEndValue_),n.endNameSet_&&(e[r]+=","+Je(n.indexEndName_))}return n.limitSet_&&(n.isViewFromLeft()?e.limitToFirst=n.limit_:e.limitToLast=n.limit_),e}function vu(n){const e={};if(n.startSet_&&(e.sp=n.indexStartValue_,n.startNameSet_&&(e.sn=n.indexStartName_),e.sin=!n.startAfterSet_),n.endSet_&&(e.ep=n.indexEndValue_,n.endNameSet_&&(e.en=n.indexEndName_),e.ein=!n.endBeforeSet_),n.limitSet_){e.l=n.limit_;let t=n.viewFrom_;t===""&&(n.isViewFromLeft()?t="l":t="r"),e.vf=t}return n.index_!==Be&&(e.i=n.index_.toString()),e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pi extends Zl{reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return t!==void 0?"tag$"+t:(Q(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}constructor(e,t,r,i){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=r,this.appCheckTokenProvider_=i,this.log_=Rr("p:rest:"),this.listens_={}}listen(e,t,r,i){const a=e._path.toString();this.log_("Listen called for "+a+" "+e._queryIdentifier);const u=Pi.getListenId_(e,r),h={};this.listens_[u]=h;const f=yu(e._queryParams);this.restRequest_(a+".json",f,(p,y)=>{let v=y;if(p===404&&(v=null,p=null),p===null&&this.onDataUpdate_(a,v,!1,r),Fn(this.listens_,u)===h){let I;p?p===401?I="permission_denied":I="rest_error:"+p:I="ok",i(I,null)}})}unlisten(e,t){const r=Pi.getListenId_(e,t);delete this.listens_[r]}get(e){const t=yu(e._queryParams),r=e._path.toString(),i=new Yt;return this.restRequest_(r+".json",t,(a,u)=>{let h=u;a===404&&(h=null,a=null),a===null?(this.onDataUpdate_(r,h,!1,null),i.resolve(h)):i.reject(new Error(h))}),i.promise}refreshAuthToken(e){}restRequest_(e,t={},r){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([i,a])=>{i&&i.accessToken&&(t.auth=i.accessToken),a&&a.token&&(t.ac=a.token);const u=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+qh(t);this.log_("Sending REST request for "+u);const h=new XMLHttpRequest;h.onreadystatechange=()=>{if(r&&h.readyState===4){this.log_("REST Response for "+u+" received. status:",h.status,"response:",h.responseText);let f=null;if(h.status>=200&&h.status<300){try{f=wo(h.responseText)}catch{ht("Failed to parse JSON response for "+u+": "+h.responseText)}r(null,f)}else h.status!==401&&h.status!==404&&ht("Got unsuccessful REST response for "+u+" Status: "+h.status),r(h.status);r=null}},h.open("GET",u,!0),h.send()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tp{constructor(){this.rootNode_=me.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Oi(){return{value:null,children:new Map}}function Wn(n,e,t){if(xe(e))n.value=t,n.children.clear();else if(n.value!==null)n.value=n.value.updateChild(e,t);else{const r=ve(e);n.children.has(r)||n.children.set(r,Oi());const i=n.children.get(r);e=Me(e),Wn(i,e,t)}}function oo(n,e){if(xe(e))return n.value=null,n.children.clear(),!0;if(n.value!==null){if(n.value.isLeafNode())return!1;{const t=n.value;return n.value=null,t.forEachChild(Be,(r,i)=>{Wn(n,new De(r),i)}),oo(n,e)}}else if(n.children.size>0){const t=ve(e);return e=Me(e),n.children.has(t)&&oo(n.children.get(t),e)&&n.children.delete(t),n.children.size===0}else return!0}function ao(n,e,t){n.value!==null?t(e,n.value):Sp(n,(r,i)=>{const a=new De(e.toString()+"/"+r);ao(i,a,t)})}function Sp(n,e){n.children.forEach((t,r)=>{e(r,t)})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ip{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),t=Object.assign({},e);return this.last_&&it(this.last_,(r,i)=>{t[r]=t[r]-i}),this.last_=e,t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wu=10*1e3,kp=30*1e3,Ap=5*60*1e3;class Pp{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new Ip(e);const r=wu+(kp-wu)*Math.random();gr(this.reportStats_.bind(this),Math.floor(r))}reportStats_(){const e=this.statsListener_.get(),t={};let r=!1;it(e,(i,a)=>{a>0&&kt(this.statsToReport_,i)&&(t[i]=a,r=!0)}),r&&this.server_.reportStats(t),gr(this.reportStats_.bind(this),Math.floor(Math.random()*2*Ap))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Et;(function(n){n[n.OVERWRITE=0]="OVERWRITE",n[n.MERGE=1]="MERGE",n[n.ACK_USER_WRITE=2]="ACK_USER_WRITE",n[n.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"})(Et||(Et={}));function lc(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function jo(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function Bo(n){return{fromUser:!1,fromServer:!0,queryId:n,tagged:!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ri{constructor(e,t,r){this.path=e,this.affectedTree=t,this.revert=r,this.type=Et.ACK_USER_WRITE,this.source=lc()}operationForChild(e){if(xe(this.path)){if(this.affectedTree.value!=null)return Q(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const t=this.affectedTree.subtree(new De(e));return new Ri(Oe(),t,this.revert)}}else return Q(ve(this.path)===e,"operationForChild called for unrelated child."),new Ri(Me(this.path),this.affectedTree,this.revert)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sr{constructor(e,t){this.source=e,this.path=t,this.type=Et.LISTEN_COMPLETE}operationForChild(e){return xe(this.path)?new Sr(this.source,Oe()):new Sr(this.source,Me(this.path))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mn{constructor(e,t,r){this.source=e,this.path=t,this.snap=r,this.type=Et.OVERWRITE}operationForChild(e){return xe(this.path)?new mn(this.source,Oe(),this.snap.getImmediateChild(e)):new mn(this.source,Me(this.path),this.snap)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ir{constructor(e,t,r){this.source=e,this.path=t,this.children=r,this.type=Et.MERGE}operationForChild(e){if(xe(this.path)){const t=this.children.subtree(new De(e));return t.isEmpty()?null:t.value?new mn(this.source,Oe(),t.value):new Ir(this.source,Oe(),t)}else return Q(ve(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new Ir(this.source,Me(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _n{constructor(e,t,r){this.node_=e,this.fullyInitialized_=t,this.filtered_=r}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(xe(e))return this.isFullyInitialized()&&!this.filtered_;const t=ve(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Op{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function Rp(n,e,t,r){const i=[],a=[];return e.forEach(u=>{u.type==="child_changed"&&n.index_.indexedValueChanged(u.oldSnap,u.snapshotNode)&&a.push(Ep(u.childName,u.snapshotNode))}),dr(n,i,"child_removed",e,r,t),dr(n,i,"child_added",e,r,t),dr(n,i,"child_moved",a,r,t),dr(n,i,"child_changed",e,r,t),dr(n,i,"value",e,r,t),i}function dr(n,e,t,r,i,a){const u=r.filter(h=>h.type===t);u.sort((h,f)=>Mp(n,h,f)),u.forEach(h=>{const f=Dp(n,h,a);i.forEach(p=>{p.respondsTo(h.type)&&e.push(p.createEvent(f,n.query_))})})}function Dp(n,e,t){return e.type==="value"||e.type==="child_removed"||(e.prevName=t.getPredecessorChildName(e.childName,e.snapshotNode,n.index_)),e}function Mp(n,e,t){if(e.childName==null||t.childName==null)throw Ar("Should only compare child_ events.");const r=new Ce(e.childName,e.snapshotNode),i=new Ce(t.childName,t.snapshotNode);return n.index_.compare(r,i)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zi(n,e){return{eventCache:n,serverCache:e}}function yr(n,e,t,r){return zi(new _n(e,t,r),n.serverCache)}function cc(n,e,t,r){return zi(n.eventCache,new _n(e,t,r))}function uo(n){return n.eventCache.isFullyInitialized()?n.eventCache.getNode():null}function gn(n){return n.serverCache.isFullyInitialized()?n.serverCache.getNode():null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Ws;const Np=()=>(Ws||(Ws=new ct(vd)),Ws);class $e{static fromObject(e){let t=new $e(null);return it(e,(r,i)=>{t=t.set(new De(r),i)}),t}constructor(e,t=Np()){this.value=e,this.children=t}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(this.value!=null&&t(this.value))return{path:Oe(),value:this.value};if(xe(e))return null;{const r=ve(e),i=this.children.get(r);if(i!==null){const a=i.findRootMostMatchingPathAndValue(Me(e),t);return a!=null?{path:Ve(new De(r),a.path),value:a.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(xe(e))return this;{const t=ve(e),r=this.children.get(t);return r!==null?r.subtree(Me(e)):new $e(null)}}set(e,t){if(xe(e))return new $e(t,this.children);{const r=ve(e),a=(this.children.get(r)||new $e(null)).set(Me(e),t),u=this.children.insert(r,a);return new $e(this.value,u)}}remove(e){if(xe(e))return this.children.isEmpty()?new $e(null):new $e(null,this.children);{const t=ve(e),r=this.children.get(t);if(r){const i=r.remove(Me(e));let a;return i.isEmpty()?a=this.children.remove(t):a=this.children.insert(t,i),this.value===null&&a.isEmpty()?new $e(null):new $e(this.value,a)}else return this}}get(e){if(xe(e))return this.value;{const t=ve(e),r=this.children.get(t);return r?r.get(Me(e)):null}}setTree(e,t){if(xe(e))return t;{const r=ve(e),a=(this.children.get(r)||new $e(null)).setTree(Me(e),t);let u;return a.isEmpty()?u=this.children.remove(r):u=this.children.insert(r,a),new $e(this.value,u)}}fold(e){return this.fold_(Oe(),e)}fold_(e,t){const r={};return this.children.inorderTraversal((i,a)=>{r[i]=a.fold_(Ve(e,i),t)}),t(e,this.value,r)}findOnPath(e,t){return this.findOnPath_(e,Oe(),t)}findOnPath_(e,t,r){const i=this.value?r(t,this.value):!1;if(i)return i;if(xe(e))return null;{const a=ve(e),u=this.children.get(a);return u?u.findOnPath_(Me(e),Ve(t,a),r):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,Oe(),t)}foreachOnPath_(e,t,r){if(xe(e))return this;{this.value&&r(t,this.value);const i=ve(e),a=this.children.get(i);return a?a.foreachOnPath_(Me(e),Ve(t,i),r):new $e(null)}}foreach(e){this.foreach_(Oe(),e)}foreach_(e,t){this.children.inorderTraversal((r,i)=>{i.foreach_(Ve(e,r),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,r)=>{r.value&&e(t,r.value)})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xt{constructor(e){this.writeTree_=e}static empty(){return new xt(new $e(null))}}function vr(n,e,t){if(xe(e))return new xt(new $e(t));{const r=n.writeTree_.findRootMostValueAndPath(e);if(r!=null){const i=r.path;let a=r.value;const u=lt(i,e);return a=a.updateChild(u,t),new xt(n.writeTree_.set(i,a))}else{const i=new $e(t),a=n.writeTree_.setTree(e,i);return new xt(a)}}}function bu(n,e,t){let r=n;return it(t,(i,a)=>{r=vr(r,Ve(e,i),a)}),r}function Eu(n,e){if(xe(e))return xt.empty();{const t=n.writeTree_.setTree(e,new $e(null));return new xt(t)}}function lo(n,e){return En(n,e)!=null}function En(n,e){const t=n.writeTree_.findRootMostValueAndPath(e);return t!=null?n.writeTree_.get(t.path).getChild(lt(t.path,e)):null}function xu(n){const e=[],t=n.writeTree_.value;return t!=null?t.isLeafNode()||t.forEachChild(Be,(r,i)=>{e.push(new Ce(r,i))}):n.writeTree_.children.inorderTraversal((r,i)=>{i.value!=null&&e.push(new Ce(r,i.value))}),e}function Ht(n,e){if(xe(e))return n;{const t=En(n,e);return t!=null?new xt(new $e(t)):new xt(n.writeTree_.subtree(e))}}function co(n){return n.writeTree_.isEmpty()}function Un(n,e){return hc(Oe(),n.writeTree_,e)}function hc(n,e,t){if(e.value!=null)return t.updateChild(n,e.value);{let r=null;return e.children.inorderTraversal((i,a)=>{i===".priority"?(Q(a.value!==null,"Priority writes must always be leaf nodes"),r=a.value):t=hc(Ve(n,i),a,t)}),!t.getChild(n).isEmpty()&&r!==null&&(t=t.updateChild(Ve(n,".priority"),r)),t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qo(n,e){return mc(e,n)}function Lp(n,e,t,r,i){Q(r>n.lastWriteId,"Stacking an older write on top of newer ones"),i===void 0&&(i=!0),n.allWrites.push({path:e,snap:t,writeId:r,visible:i}),i&&(n.visibleWrites=vr(n.visibleWrites,e,t)),n.lastWriteId=r}function $p(n,e){for(let t=0;t<n.allWrites.length;t++){const r=n.allWrites[t];if(r.writeId===e)return r}return null}function Fp(n,e){const t=n.allWrites.findIndex(h=>h.writeId===e);Q(t>=0,"removeWrite called with nonexistent writeId.");const r=n.allWrites[t];n.allWrites.splice(t,1);let i=r.visible,a=!1,u=n.allWrites.length-1;for(;i&&u>=0;){const h=n.allWrites[u];h.visible&&(u>=t&&jp(h,r.path)?i=!1:yt(r.path,h.path)&&(a=!0)),u--}if(i){if(a)return Bp(n),!0;if(r.snap)n.visibleWrites=Eu(n.visibleWrites,r.path);else{const h=r.children;it(h,f=>{n.visibleWrites=Eu(n.visibleWrites,Ve(r.path,f))})}return!0}else return!1}function jp(n,e){if(n.snap)return yt(n.path,e);for(const t in n.children)if(n.children.hasOwnProperty(t)&&yt(Ve(n.path,t),e))return!0;return!1}function Bp(n){n.visibleWrites=fc(n.allWrites,qp,Oe()),n.allWrites.length>0?n.lastWriteId=n.allWrites[n.allWrites.length-1].writeId:n.lastWriteId=-1}function qp(n){return n.visible}function fc(n,e,t){let r=xt.empty();for(let i=0;i<n.length;++i){const a=n[i];if(e(a)){const u=a.path;let h;if(a.snap)yt(t,u)?(h=lt(t,u),r=vr(r,h,a.snap)):yt(u,t)&&(h=lt(u,t),r=vr(r,Oe(),a.snap.getChild(h)));else if(a.children){if(yt(t,u))h=lt(t,u),r=bu(r,h,a.children);else if(yt(u,t))if(h=lt(u,t),xe(h))r=bu(r,Oe(),a.children);else{const f=Fn(a.children,ve(h));if(f){const p=f.getChild(Me(h));r=vr(r,Oe(),p)}}}else throw Ar("WriteRecord should have .snap or .children")}}return r}function dc(n,e,t,r,i){if(!r&&!i){const a=En(n.visibleWrites,e);if(a!=null)return a;{const u=Ht(n.visibleWrites,e);if(co(u))return t;if(t==null&&!lo(u,Oe()))return null;{const h=t||me.EMPTY_NODE;return Un(u,h)}}}else{const a=Ht(n.visibleWrites,e);if(!i&&co(a))return t;if(!i&&t==null&&!lo(a,Oe()))return null;{const u=function(p){return(p.visible||i)&&(!r||!~r.indexOf(p.writeId))&&(yt(p.path,e)||yt(e,p.path))},h=fc(n.allWrites,u,e),f=t||me.EMPTY_NODE;return Un(h,f)}}}function Up(n,e,t){let r=me.EMPTY_NODE;const i=En(n.visibleWrites,e);if(i)return i.isLeafNode()||i.forEachChild(Be,(a,u)=>{r=r.updateImmediateChild(a,u)}),r;if(t){const a=Ht(n.visibleWrites,e);return t.forEachChild(Be,(u,h)=>{const f=Un(Ht(a,new De(u)),h);r=r.updateImmediateChild(u,f)}),xu(a).forEach(u=>{r=r.updateImmediateChild(u.name,u.node)}),r}else{const a=Ht(n.visibleWrites,e);return xu(a).forEach(u=>{r=r.updateImmediateChild(u.name,u.node)}),r}}function Vp(n,e,t,r,i){Q(r||i,"Either existingEventSnap or existingServerSnap must exist");const a=Ve(e,t);if(lo(n.visibleWrites,a))return null;{const u=Ht(n.visibleWrites,a);return co(u)?i.getChild(t):Un(u,i.getChild(t))}}function Kp(n,e,t,r){const i=Ve(e,t),a=En(n.visibleWrites,i);if(a!=null)return a;if(r.isCompleteForChild(t)){const u=Ht(n.visibleWrites,i);return Un(u,r.getNode().getImmediateChild(t))}else return null}function Wp(n,e){return En(n.visibleWrites,e)}function Yp(n,e,t,r,i,a,u){let h;const f=Ht(n.visibleWrites,e),p=En(f,Oe());if(p!=null)h=p;else if(t!=null)h=Un(f,t);else return[];if(h=h.withIndex(u),!h.isEmpty()&&!h.isLeafNode()){const y=[],v=u.getCompare(),I=a?h.getReverseIteratorFrom(r,u):h.getIteratorFrom(r,u);let M=I.getNext();for(;M&&y.length<i;)v(M,r)!==0&&y.push(M),M=I.getNext();return y}else return[]}function Hp(){return{visibleWrites:xt.empty(),allWrites:[],lastWriteId:-1}}function Di(n,e,t,r){return dc(n.writeTree,n.treePath,e,t,r)}function Uo(n,e){return Up(n.writeTree,n.treePath,e)}function Cu(n,e,t,r){return Vp(n.writeTree,n.treePath,e,t,r)}function Mi(n,e){return Wp(n.writeTree,Ve(n.treePath,e))}function zp(n,e,t,r,i,a){return Yp(n.writeTree,n.treePath,e,t,r,i,a)}function Vo(n,e,t){return Kp(n.writeTree,n.treePath,e,t)}function pc(n,e){return mc(Ve(n.treePath,e),n.writeTree)}function mc(n,e){return{treePath:n,writeTree:e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gp{constructor(){this.changeMap=new Map}trackChildChange(e){const t=e.type,r=e.childName;Q(t==="child_added"||t==="child_changed"||t==="child_removed","Only child changes supported for tracking"),Q(r!==".priority","Only non-priority child changes can be tracked.");const i=this.changeMap.get(r);if(i){const a=i.type;if(t==="child_added"&&a==="child_removed")this.changeMap.set(r,Cr(r,e.snapshotNode,i.snapshotNode));else if(t==="child_removed"&&a==="child_added")this.changeMap.delete(r);else if(t==="child_removed"&&a==="child_changed")this.changeMap.set(r,xr(r,i.oldSnap));else if(t==="child_changed"&&a==="child_added")this.changeMap.set(r,qn(r,e.snapshotNode));else if(t==="child_changed"&&a==="child_changed")this.changeMap.set(r,Cr(r,e.snapshotNode,i.oldSnap));else throw Ar("Illegal combination of changes: "+e+" occurred after "+i)}else this.changeMap.set(r,e)}getChanges(){return Array.from(this.changeMap.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qp{getCompleteChild(e){return null}getChildAfterChild(e,t,r){return null}}const _c=new Qp;class Ko{constructor(e,t,r=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=r}getCompleteChild(e){const t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{const r=this.optCompleteServerCache_!=null?new _n(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return Vo(this.writes_,e,r)}}getChildAfterChild(e,t,r){const i=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:gn(this.viewCache_),a=zp(this.writes_,i,t,1,r,e);return a.length===0?null:a[0]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xp(n){return{filter:n}}function Jp(n,e){Q(e.eventCache.getNode().isIndexed(n.filter.getIndex()),"Event snap not indexed"),Q(e.serverCache.getNode().isIndexed(n.filter.getIndex()),"Server snap not indexed")}function Zp(n,e,t,r,i){const a=new Gp;let u,h;if(t.type===Et.OVERWRITE){const p=t;p.source.fromUser?u=ho(n,e,p.path,p.snap,r,i,a):(Q(p.source.fromServer,"Unknown source."),h=p.source.tagged||e.serverCache.isFiltered()&&!xe(p.path),u=Ni(n,e,p.path,p.snap,r,i,h,a))}else if(t.type===Et.MERGE){const p=t;p.source.fromUser?u=tm(n,e,p.path,p.children,r,i,a):(Q(p.source.fromServer,"Unknown source."),h=p.source.tagged||e.serverCache.isFiltered(),u=fo(n,e,p.path,p.children,r,i,h,a))}else if(t.type===Et.ACK_USER_WRITE){const p=t;p.revert?u=im(n,e,p.path,r,i,a):u=nm(n,e,p.path,p.affectedTree,r,i,a)}else if(t.type===Et.LISTEN_COMPLETE)u=rm(n,e,t.path,r,a);else throw Ar("Unknown operation type: "+t.type);const f=a.getChanges();return em(e,u,f),{viewCache:u,changes:f}}function em(n,e,t){const r=e.eventCache;if(r.isFullyInitialized()){const i=r.getNode().isLeafNode()||r.getNode().isEmpty(),a=uo(n);(t.length>0||!n.eventCache.isFullyInitialized()||i&&!r.getNode().equals(a)||!r.getNode().getPriority().equals(a.getPriority()))&&t.push(uc(uo(e)))}}function gc(n,e,t,r,i,a){const u=e.eventCache;if(Mi(r,t)!=null)return e;{let h,f;if(xe(t))if(Q(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){const p=gn(e),y=p instanceof me?p:me.EMPTY_NODE,v=Uo(r,y);h=n.filter.updateFullNode(e.eventCache.getNode(),v,a)}else{const p=Di(r,gn(e));h=n.filter.updateFullNode(e.eventCache.getNode(),p,a)}else{const p=ve(t);if(p===".priority"){Q(zt(t)===1,"Can't have a priority with additional path components");const y=u.getNode();f=e.serverCache.getNode();const v=Cu(r,t,y,f);v!=null?h=n.filter.updatePriority(y,v):h=u.getNode()}else{const y=Me(t);let v;if(u.isCompleteForChild(p)){f=e.serverCache.getNode();const I=Cu(r,t,u.getNode(),f);I!=null?v=u.getNode().getImmediateChild(p).updateChild(y,I):v=u.getNode().getImmediateChild(p)}else v=Vo(r,p,e.serverCache);v!=null?h=n.filter.updateChild(u.getNode(),p,v,y,i,a):h=u.getNode()}}return yr(e,h,u.isFullyInitialized()||xe(t),n.filter.filtersNodes())}}function Ni(n,e,t,r,i,a,u,h){const f=e.serverCache;let p;const y=u?n.filter:n.filter.getIndexedFilter();if(xe(t))p=y.updateFullNode(f.getNode(),r,null);else if(y.filtersNodes()&&!f.isFiltered()){const M=f.getNode().updateChild(t,r);p=y.updateFullNode(f.getNode(),M,null)}else{const M=ve(t);if(!f.isCompleteForPath(t)&&zt(t)>1)return e;const B=Me(t),Z=f.getNode().getImmediateChild(M).updateChild(B,r);M===".priority"?p=y.updatePriority(f.getNode(),Z):p=y.updateChild(f.getNode(),M,Z,B,_c,null)}const v=cc(e,p,f.isFullyInitialized()||xe(t),y.filtersNodes()),I=new Ko(i,v,a);return gc(n,v,t,i,I,h)}function ho(n,e,t,r,i,a,u){const h=e.eventCache;let f,p;const y=new Ko(i,e,a);if(xe(t))p=n.filter.updateFullNode(e.eventCache.getNode(),r,u),f=yr(e,p,!0,n.filter.filtersNodes());else{const v=ve(t);if(v===".priority")p=n.filter.updatePriority(e.eventCache.getNode(),r),f=yr(e,p,h.isFullyInitialized(),h.isFiltered());else{const I=Me(t),M=h.getNode().getImmediateChild(v);let B;if(xe(I))B=r;else{const ue=y.getCompleteChild(v);ue!=null?Do(I)===".priority"&&ue.getChild(tc(I)).isEmpty()?B=ue:B=ue.updateChild(I,r):B=me.EMPTY_NODE}if(M.equals(B))f=e;else{const ue=n.filter.updateChild(h.getNode(),v,B,I,y,u);f=yr(e,ue,h.isFullyInitialized(),n.filter.filtersNodes())}}}return f}function Tu(n,e){return n.eventCache.isCompleteForChild(e)}function tm(n,e,t,r,i,a,u){let h=e;return r.foreach((f,p)=>{const y=Ve(t,f);Tu(e,ve(y))&&(h=ho(n,h,y,p,i,a,u))}),r.foreach((f,p)=>{const y=Ve(t,f);Tu(e,ve(y))||(h=ho(n,h,y,p,i,a,u))}),h}function Su(n,e,t){return t.foreach((r,i)=>{e=e.updateChild(r,i)}),e}function fo(n,e,t,r,i,a,u,h){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let f=e,p;xe(t)?p=r:p=new $e(null).setTree(t,r);const y=e.serverCache.getNode();return p.children.inorderTraversal((v,I)=>{if(y.hasChild(v)){const M=e.serverCache.getNode().getImmediateChild(v),B=Su(n,M,I);f=Ni(n,f,new De(v),B,i,a,u,h)}}),p.children.inorderTraversal((v,I)=>{const M=!e.serverCache.isCompleteForChild(v)&&I.value===null;if(!y.hasChild(v)&&!M){const B=e.serverCache.getNode().getImmediateChild(v),ue=Su(n,B,I);f=Ni(n,f,new De(v),ue,i,a,u,h)}}),f}function nm(n,e,t,r,i,a,u){if(Mi(i,t)!=null)return e;const h=e.serverCache.isFiltered(),f=e.serverCache;if(r.value!=null){if(xe(t)&&f.isFullyInitialized()||f.isCompleteForPath(t))return Ni(n,e,t,f.getNode().getChild(t),i,a,h,u);if(xe(t)){let p=new $e(null);return f.getNode().forEachChild(Ln,(y,v)=>{p=p.set(new De(y),v)}),fo(n,e,t,p,i,a,h,u)}else return e}else{let p=new $e(null);return r.foreach((y,v)=>{const I=Ve(t,y);f.isCompleteForPath(I)&&(p=p.set(y,f.getNode().getChild(I)))}),fo(n,e,t,p,i,a,h,u)}}function rm(n,e,t,r,i){const a=e.serverCache,u=cc(e,a.getNode(),a.isFullyInitialized()||xe(t),a.isFiltered());return gc(n,u,t,r,_c,i)}function im(n,e,t,r,i,a){let u;if(Mi(r,t)!=null)return e;{const h=new Ko(r,e,i),f=e.eventCache.getNode();let p;if(xe(t)||ve(t)===".priority"){let y;if(e.serverCache.isFullyInitialized())y=Di(r,gn(e));else{const v=e.serverCache.getNode();Q(v instanceof me,"serverChildren would be complete if leaf node"),y=Uo(r,v)}y=y,p=n.filter.updateFullNode(f,y,a)}else{const y=ve(t);let v=Vo(r,y,e.serverCache);v==null&&e.serverCache.isCompleteForChild(y)&&(v=f.getImmediateChild(y)),v!=null?p=n.filter.updateChild(f,y,v,Me(t),h,a):e.eventCache.getNode().hasChild(y)?p=n.filter.updateChild(f,y,me.EMPTY_NODE,Me(t),h,a):p=f,p.isEmpty()&&e.serverCache.isFullyInitialized()&&(u=Di(r,gn(e)),u.isLeafNode()&&(p=n.filter.updateFullNode(p,u,a)))}return u=e.serverCache.isFullyInitialized()||Mi(r,Oe())!=null,yr(e,p,u,n.filter.filtersNodes())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sm{constructor(e,t){this.query_=e,this.eventRegistrations_=[];const r=this.query_._queryParams,i=new $o(r.getIndex()),a=Cp(r);this.processor_=Xp(a);const u=t.serverCache,h=t.eventCache,f=i.updateFullNode(me.EMPTY_NODE,u.getNode(),null),p=a.updateFullNode(me.EMPTY_NODE,h.getNode(),null),y=new _n(f,u.isFullyInitialized(),i.filtersNodes()),v=new _n(p,h.isFullyInitialized(),a.filtersNodes());this.viewCache_=zi(v,y),this.eventGenerator_=new Op(this.query_)}get query(){return this.query_}}function om(n){return n.viewCache_.serverCache.getNode()}function am(n,e){const t=gn(n.viewCache_);return t&&(n.query._queryParams.loadsAllData()||!xe(e)&&!t.getImmediateChild(ve(e)).isEmpty())?t.getChild(e):null}function Iu(n){return n.eventRegistrations_.length===0}function um(n,e){n.eventRegistrations_.push(e)}function ku(n,e,t){const r=[];if(t){Q(e==null,"A cancel should cancel all event registrations.");const i=n.query._path;n.eventRegistrations_.forEach(a=>{const u=a.createCancelEvent(t,i);u&&r.push(u)})}if(e){let i=[];for(let a=0;a<n.eventRegistrations_.length;++a){const u=n.eventRegistrations_[a];if(!u.matches(e))i.push(u);else if(e.hasAnyCallback()){i=i.concat(n.eventRegistrations_.slice(a+1));break}}n.eventRegistrations_=i}else n.eventRegistrations_=[];return r}function Au(n,e,t,r){e.type===Et.MERGE&&e.source.queryId!==null&&(Q(gn(n.viewCache_),"We should always have a full cache before handling merges"),Q(uo(n.viewCache_),"Missing event cache, even though we have a server cache"));const i=n.viewCache_,a=Zp(n.processor_,i,e,t,r);return Jp(n.processor_,a.viewCache),Q(a.viewCache.serverCache.isFullyInitialized()||!i.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),n.viewCache_=a.viewCache,yc(n,a.changes,a.viewCache.eventCache.getNode(),null)}function lm(n,e){const t=n.viewCache_.eventCache,r=[];return t.getNode().isLeafNode()||t.getNode().forEachChild(Be,(a,u)=>{r.push(qn(a,u))}),t.isFullyInitialized()&&r.push(uc(t.getNode())),yc(n,r,t.getNode(),e)}function yc(n,e,t,r){const i=r?[r]:n.eventRegistrations_;return Rp(n.eventGenerator_,e,t,i)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Li;class cm{constructor(){this.views=new Map}}function hm(n){Q(!Li,"__referenceConstructor has already been defined"),Li=n}function fm(){return Q(Li,"Reference.ts has not been loaded"),Li}function dm(n){return n.views.size===0}function Wo(n,e,t,r){const i=e.source.queryId;if(i!==null){const a=n.views.get(i);return Q(a!=null,"SyncTree gave us an op for an invalid query."),Au(a,e,t,r)}else{let a=[];for(const u of n.views.values())a=a.concat(Au(u,e,t,r));return a}}function pm(n,e,t,r,i){const a=e._queryIdentifier,u=n.views.get(a);if(!u){let h=Di(t,i?r:null),f=!1;h?f=!0:r instanceof me?(h=Uo(t,r),f=!1):(h=me.EMPTY_NODE,f=!1);const p=zi(new _n(h,f,!1),new _n(r,i,!1));return new sm(e,p)}return u}function mm(n,e,t,r,i,a){const u=pm(n,e,r,i,a);return n.views.has(e._queryIdentifier)||n.views.set(e._queryIdentifier,u),um(u,t),lm(u,t)}function _m(n,e,t,r){const i=e._queryIdentifier,a=[];let u=[];const h=Gt(n);if(i==="default")for(const[f,p]of n.views.entries())u=u.concat(ku(p,t,r)),Iu(p)&&(n.views.delete(f),p.query._queryParams.loadsAllData()||a.push(p.query));else{const f=n.views.get(i);f&&(u=u.concat(ku(f,t,r)),Iu(f)&&(n.views.delete(i),f.query._queryParams.loadsAllData()||a.push(f.query)))}return h&&!Gt(n)&&a.push(new(fm())(e._repo,e._path)),{removed:a,events:u}}function vc(n){const e=[];for(const t of n.views.values())t.query._queryParams.loadsAllData()||e.push(t);return e}function $n(n,e){let t=null;for(const r of n.views.values())t=t||am(r,e);return t}function wc(n,e){if(e._queryParams.loadsAllData())return Gi(n);{const r=e._queryIdentifier;return n.views.get(r)}}function bc(n,e){return wc(n,e)!=null}function Gt(n){return Gi(n)!=null}function Gi(n){for(const e of n.views.values())if(e.query._queryParams.loadsAllData())return e;return null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let $i;function gm(n){Q(!$i,"__referenceConstructor has already been defined"),$i=n}function ym(){return Q($i,"Reference.ts has not been loaded"),$i}let vm=1;class Pu{constructor(e){this.listenProvider_=e,this.syncPointTree_=new $e(null),this.pendingWriteTree_=Hp(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function Ec(n,e,t,r,i){return Lp(n.pendingWriteTree_,e,t,r,i),i?Mr(n,new mn(lc(),e,t)):[]}function fn(n,e,t=!1){const r=$p(n.pendingWriteTree_,e);if(Fp(n.pendingWriteTree_,e)){let a=new $e(null);return r.snap!=null?a=a.set(Oe(),!0):it(r.children,u=>{a=a.set(new De(u),!0)}),Mr(n,new Ri(r.path,a,t))}else return[]}function Qi(n,e,t){return Mr(n,new mn(jo(),e,t))}function wm(n,e,t){const r=$e.fromObject(t);return Mr(n,new Ir(jo(),e,r))}function bm(n,e){return Mr(n,new Sr(jo(),e))}function Em(n,e,t){const r=Ho(n,t);if(r){const i=zo(r),a=i.path,u=i.queryId,h=lt(a,e),f=new Sr(Bo(u),h);return Go(n,a,f)}else return[]}function po(n,e,t,r,i=!1){const a=e._path,u=n.syncPointTree_.get(a);let h=[];if(u&&(e._queryIdentifier==="default"||bc(u,e))){const f=_m(u,e,t,r);dm(u)&&(n.syncPointTree_=n.syncPointTree_.remove(a));const p=f.removed;if(h=f.events,!i){const y=p.findIndex(I=>I._queryParams.loadsAllData())!==-1,v=n.syncPointTree_.findOnPath(a,(I,M)=>Gt(M));if(y&&!v){const I=n.syncPointTree_.subtree(a);if(!I.isEmpty()){const M=Tm(I);for(let B=0;B<M.length;++B){const ue=M[B],Z=ue.query,de=Tc(n,ue);n.listenProvider_.startListening(wr(Z),Fi(n,Z),de.hashFn,de.onComplete)}}}!v&&p.length>0&&!r&&(y?n.listenProvider_.stopListening(wr(e),null):p.forEach(I=>{const M=n.queryToTagMap.get(Xi(I));n.listenProvider_.stopListening(wr(I),M)}))}Sm(n,p)}return h}function xm(n,e,t,r){const i=Ho(n,r);if(i!=null){const a=zo(i),u=a.path,h=a.queryId,f=lt(u,e),p=new mn(Bo(h),f,t);return Go(n,u,p)}else return[]}function Cm(n,e,t,r){const i=Ho(n,r);if(i){const a=zo(i),u=a.path,h=a.queryId,f=lt(u,e),p=$e.fromObject(t),y=new Ir(Bo(h),f,p);return Go(n,u,y)}else return[]}function Ou(n,e,t,r=!1){const i=e._path;let a=null,u=!1;n.syncPointTree_.foreachOnPath(i,(I,M)=>{const B=lt(I,i);a=a||$n(M,B),u=u||Gt(M)});let h=n.syncPointTree_.get(i);h?(u=u||Gt(h),a=a||$n(h,Oe())):(h=new cm,n.syncPointTree_=n.syncPointTree_.set(i,h));let f;a!=null?f=!0:(f=!1,a=me.EMPTY_NODE,n.syncPointTree_.subtree(i).foreachChild((M,B)=>{const ue=$n(B,Oe());ue&&(a=a.updateImmediateChild(M,ue))}));const p=bc(h,e);if(!p&&!e._queryParams.loadsAllData()){const I=Xi(e);Q(!n.queryToTagMap.has(I),"View does not exist, but we have a tag");const M=Im();n.queryToTagMap.set(I,M),n.tagToQueryMap.set(M,I)}const y=qo(n.pendingWriteTree_,i);let v=mm(h,e,t,y,a,f);if(!p&&!u&&!r){const I=wc(h,e);v=v.concat(km(n,e,I))}return v}function Yo(n,e,t){const i=n.pendingWriteTree_,a=n.syncPointTree_.findOnPath(e,(u,h)=>{const f=lt(u,e),p=$n(h,f);if(p)return p});return dc(i,e,a,t,!0)}function Mr(n,e){return xc(e,n.syncPointTree_,null,qo(n.pendingWriteTree_,Oe()))}function xc(n,e,t,r){if(xe(n.path))return Cc(n,e,t,r);{const i=e.get(Oe());t==null&&i!=null&&(t=$n(i,Oe()));let a=[];const u=ve(n.path),h=n.operationForChild(u),f=e.children.get(u);if(f&&h){const p=t?t.getImmediateChild(u):null,y=pc(r,u);a=a.concat(xc(h,f,p,y))}return i&&(a=a.concat(Wo(i,n,r,t))),a}}function Cc(n,e,t,r){const i=e.get(Oe());t==null&&i!=null&&(t=$n(i,Oe()));let a=[];return e.children.inorderTraversal((u,h)=>{const f=t?t.getImmediateChild(u):null,p=pc(r,u),y=n.operationForChild(u);y&&(a=a.concat(Cc(y,h,f,p)))}),i&&(a=a.concat(Wo(i,n,r,t))),a}function Tc(n,e){const t=e.query,r=Fi(n,t);return{hashFn:()=>(om(e)||me.EMPTY_NODE).hash(),onComplete:i=>{if(i==="ok")return r?Em(n,t._path,r):bm(n,t._path);{const a=Ed(i,t);return po(n,t,null,a)}}}}function Fi(n,e){const t=Xi(e);return n.queryToTagMap.get(t)}function Xi(n){return n._path.toString()+"$"+n._queryIdentifier}function Ho(n,e){return n.tagToQueryMap.get(e)}function zo(n){const e=n.indexOf("$");return Q(e!==-1&&e<n.length-1,"Bad queryKey."),{queryId:n.substr(e+1),path:new De(n.substr(0,e))}}function Go(n,e,t){const r=n.syncPointTree_.get(e);Q(r,"Missing sync point for query tag that we're tracking");const i=qo(n.pendingWriteTree_,e);return Wo(r,t,i,null)}function Tm(n){return n.fold((e,t,r)=>{if(t&&Gt(t))return[Gi(t)];{let i=[];return t&&(i=vc(t)),it(r,(a,u)=>{i=i.concat(u)}),i}})}function wr(n){return n._queryParams.loadsAllData()&&!n._queryParams.isDefault()?new(ym())(n._repo,n._path):n}function Sm(n,e){for(let t=0;t<e.length;++t){const r=e[t];if(!r._queryParams.loadsAllData()){const i=Xi(r),a=n.queryToTagMap.get(i);n.queryToTagMap.delete(i),n.tagToQueryMap.delete(a)}}}function Im(){return vm++}function km(n,e,t){const r=e._path,i=Fi(n,e),a=Tc(n,t),u=n.listenProvider_.startListening(wr(e),i,a.hashFn,a.onComplete),h=n.syncPointTree_.subtree(r);if(i)Q(!Gt(h.value),"If we're adding a query, it shouldn't be shadowed");else{const f=h.fold((p,y,v)=>{if(!xe(p)&&y&&Gt(y))return[Gi(y).query];{let I=[];return y&&(I=I.concat(vc(y).map(M=>M.query))),it(v,(M,B)=>{I=I.concat(B)}),I}});for(let p=0;p<f.length;++p){const y=f[p];n.listenProvider_.stopListening(wr(y),Fi(n,y))}}return u}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qo{constructor(e){this.node_=e}getImmediateChild(e){const t=this.node_.getImmediateChild(e);return new Qo(t)}node(){return this.node_}}class Xo{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){const t=Ve(this.path_,e);return new Xo(this.syncTree_,t)}node(){return Yo(this.syncTree_,this.path_)}}const Am=function(n){return n=n||{},n.timestamp=n.timestamp||new Date().getTime(),n},Ru=function(n,e,t){if(!n||typeof n!="object")return n;if(Q(".sv"in n,"Unexpected leaf node or priority contents"),typeof n[".sv"]=="string")return Pm(n[".sv"],e,t);if(typeof n[".sv"]=="object")return Om(n[".sv"],e);Q(!1,"Unexpected server value: "+JSON.stringify(n,null,2))},Pm=function(n,e,t){switch(n){case"timestamp":return t.timestamp;default:Q(!1,"Unexpected server value: "+n)}},Om=function(n,e,t){n.hasOwnProperty("increment")||Q(!1,"Unexpected server value: "+JSON.stringify(n,null,2));const r=n.increment;typeof r!="number"&&Q(!1,"Unexpected increment value: "+r);const i=e.node();if(Q(i!==null&&typeof i<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!i.isLeafNode())return r;const u=i.getValue();return typeof u!="number"?r:u+r},Rm=function(n,e,t,r){return Jo(e,new Xo(t,n),r)},Sc=function(n,e,t){return Jo(n,new Qo(e),t)};function Jo(n,e,t){const r=n.getPriority().val(),i=Ru(r,e.getImmediateChild(".priority"),t);let a;if(n.isLeafNode()){const u=n,h=Ru(u.getValue(),e,t);return h!==u.getValue()||i!==u.getPriority().val()?new Ge(h,We(i)):n}else{const u=n;return a=u,i!==u.getPriority().val()&&(a=a.updatePriority(new Ge(i))),u.forEachChild(Be,(h,f)=>{const p=Jo(f,e.getImmediateChild(h),t);p!==f&&(a=a.updateImmediateChild(h,p))}),a}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zo{constructor(e="",t=null,r={children:{},childCount:0}){this.name=e,this.parent=t,this.node=r}}function ea(n,e){let t=e instanceof De?e:new De(e),r=n,i=ve(t);for(;i!==null;){const a=Fn(r.node.children,i)||{children:{},childCount:0};r=new Zo(i,r,a),t=Me(t),i=ve(t)}return r}function Yn(n){return n.node.value}function Ic(n,e){n.node.value=e,mo(n)}function kc(n){return n.node.childCount>0}function Dm(n){return Yn(n)===void 0&&!kc(n)}function Ji(n,e){it(n.node.children,(t,r)=>{e(new Zo(t,n,r))})}function Ac(n,e,t,r){t&&e(n),Ji(n,i=>{Ac(i,e,!0)})}function Mm(n,e,t){let r=n.parent;for(;r!==null;){if(e(r))return!0;r=r.parent}return!1}function Nr(n){return new De(n.parent===null?n.name:Nr(n.parent)+"/"+n.name)}function mo(n){n.parent!==null&&Nm(n.parent,n.name,n)}function Nm(n,e,t){const r=Dm(t),i=kt(n.node.children,e);r&&i?(delete n.node.children[e],n.node.childCount--,mo(n)):!r&&!i&&(n.node.children[e]=t.node,n.node.childCount++,mo(n))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Lm=/[\[\].#$\/\u0000-\u001F\u007F]/,$m=/[\[\].#$\u0000-\u001F\u007F]/,Ys=10*1024*1024,ta=function(n){return typeof n=="string"&&n.length!==0&&!Lm.test(n)},Pc=function(n){return typeof n=="string"&&n.length!==0&&!$m.test(n)},Fm=function(n){return n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),Pc(n)},Oc=function(n){return n===null||typeof n=="string"||typeof n=="number"&&!Yi(n)||n&&typeof n=="object"&&kt(n,".sv")},ji=function(n,e,t,r){r&&e===void 0||Zi(jn(n,"value"),e,t)},Zi=function(n,e,t){const r=t instanceof De?new np(t,n):t;if(e===void 0)throw new Error(n+"contains undefined "+cn(r));if(typeof e=="function")throw new Error(n+"contains a function "+cn(r)+" with contents = "+e.toString());if(Yi(e))throw new Error(n+"contains "+e.toString()+" "+cn(r));if(typeof e=="string"&&e.length>Ys/3&&Ui(e)>Ys)throw new Error(n+"contains a string greater than "+Ys+" utf8 bytes "+cn(r)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let i=!1,a=!1;if(it(e,(u,h)=>{if(u===".value")i=!0;else if(u!==".priority"&&u!==".sv"&&(a=!0,!ta(u)))throw new Error(n+" contains an invalid key ("+u+") "+cn(r)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);rp(r,u),Zi(n,h,r),ip(r)}),i&&a)throw new Error(n+' contains ".value" child '+cn(r)+" in addition to actual children.")}},jm=function(n,e){let t,r;for(t=0;t<e.length;t++){r=e[t];const a=Er(r);for(let u=0;u<a.length;u++)if(!(a[u]===".priority"&&u===a.length-1)){if(!ta(a[u]))throw new Error(n+"contains an invalid key ("+a[u]+") in path "+r.toString()+`. Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`)}}e.sort(tp);let i=null;for(t=0;t<e.length;t++){if(r=e[t],i!==null&&yt(i,r))throw new Error(n+"contains a path "+i.toString()+" that is ancestor of another path "+r.toString());i=r}},Bm=function(n,e,t,r){const i=jn(n,"values");if(!(e&&typeof e=="object")||Array.isArray(e))throw new Error(i+" must be an object containing the children to replace.");const a=[];it(e,(u,h)=>{const f=new De(u);if(Zi(i,h,Ve(t,f)),Do(f)===".priority"&&!Oc(h))throw new Error(i+"contains an invalid value for '"+f.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");a.push(f)}),jm(i,a)},qm=function(n,e,t){if(Yi(e))throw new Error(jn(n,"priority")+"is "+e.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!Oc(e))throw new Error(jn(n,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")},Rc=function(n,e,t,r){if(!Pc(t))throw new Error(jn(n,e)+'was an invalid path = "'+t+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},Um=function(n,e,t,r){t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),Rc(n,e,t)},dn=function(n,e){if(ve(e)===".info")throw new Error(n+" failed = Can't modify data under /.info/")},Vm=function(n,e){const t=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!ta(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||t.length!==0&&!Fm(t))throw new Error(jn(n,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Km{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function na(n,e){let t=null;for(let r=0;r<e.length;r++){const i=e[r],a=i.getPath();t!==null&&!Mo(a,t.path)&&(n.eventLists_.push(t),t=null),t===null&&(t={events:[],path:a}),t.events.push(i)}t&&n.eventLists_.push(t)}function Dc(n,e,t){na(n,t),Mc(n,r=>Mo(r,e))}function Lt(n,e,t){na(n,t),Mc(n,r=>yt(r,e)||yt(e,r))}function Mc(n,e){n.recursionDepth_++;let t=!0;for(let r=0;r<n.eventLists_.length;r++){const i=n.eventLists_[r];if(i){const a=i.path;e(a)?(Wm(n.eventLists_[r]),n.eventLists_[r]=null):t=!1}}t&&(n.eventLists_=[]),n.recursionDepth_--}function Wm(n){for(let e=0;e<n.events.length;e++){const t=n.events[e];if(t!==null){n.events[e]=null;const r=t.getEventRunner();_r&&et("event: "+t.toString()),Kn(r)}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ym="repo_interrupt",Hm=25;class zm{constructor(e,t,r,i){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=r,this.appCheckProvider_=i,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new Km,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=Oi(),this.transactionQueueTree_=new Zo,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function Gm(n,e,t){if(n.stats_=Oo(n.repoInfo_),n.forceRestClient_||Sd())n.server_=new Pi(n.repoInfo_,(r,i,a,u)=>{Du(n,r,i,a,u)},n.authTokenProvider_,n.appCheckProvider_),setTimeout(()=>Mu(n,!0),0);else{if(typeof t<"u"&&t!==null){if(typeof t!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{Je(t)}catch(r){throw new Error("Invalid authOverride provided: "+r)}}n.persistentConnection_=new Dt(n.repoInfo_,e,(r,i,a,u)=>{Du(n,r,i,a,u)},r=>{Mu(n,r)},r=>{Qm(n,r)},n.authTokenProvider_,n.appCheckProvider_,t),n.server_=n.persistentConnection_}n.authTokenProvider_.addTokenChangeListener(r=>{n.server_.refreshAuthToken(r)}),n.appCheckProvider_.addTokenChangeListener(r=>{n.server_.refreshAppCheckToken(r.token)}),n.statsReporter_=Od(n.repoInfo_,()=>new Pp(n.stats_,n.server_)),n.infoData_=new Tp,n.infoSyncTree_=new Pu({startListening:(r,i,a,u)=>{let h=[];const f=n.infoData_.getNode(r._path);return f.isEmpty()||(h=Qi(n.infoSyncTree_,r._path,f),setTimeout(()=>{u("ok")},0)),h},stopListening:()=>{}}),ia(n,"connected",!1),n.serverSyncTree_=new Pu({startListening:(r,i,a,u)=>(n.server_.listen(r,a,i,(h,f)=>{const p=u(h,f);Lt(n.eventQueue_,r._path,p)}),[]),stopListening:(r,i)=>{n.server_.unlisten(r,i)}})}function Nc(n){const t=n.infoData_.getNode(new De(".info/serverTimeOffset")).val()||0;return new Date().getTime()+t}function ra(n){return Am({timestamp:Nc(n)})}function Du(n,e,t,r,i){n.dataUpdateCount++;const a=new De(e);t=n.interceptServerDataCallback_?n.interceptServerDataCallback_(e,t):t;let u=[];if(i)if(r){const f=Ti(t,p=>We(p));u=Cm(n.serverSyncTree_,a,f,i)}else{const f=We(t);u=xm(n.serverSyncTree_,a,f,i)}else if(r){const f=Ti(t,p=>We(p));u=wm(n.serverSyncTree_,a,f)}else{const f=We(t);u=Qi(n.serverSyncTree_,a,f)}let h=a;u.length>0&&(h=es(n,a)),Lt(n.eventQueue_,h,u)}function Mu(n,e){ia(n,"connected",e),e===!1&&Jm(n)}function Qm(n,e){it(e,(t,r)=>{ia(n,t,r)})}function ia(n,e,t){const r=new De("/.info/"+e),i=We(t);n.infoData_.updateSnapshot(r,i);const a=Qi(n.infoSyncTree_,r,i);Lt(n.eventQueue_,r,a)}function Lc(n){return n.nextWriteId_++}function Xm(n,e,t,r,i){sa(n,"set",{path:e.toString(),value:t,priority:r});const a=ra(n),u=We(t,r),h=Yo(n.serverSyncTree_,e),f=Sc(u,h,a),p=Lc(n),y=Ec(n.serverSyncTree_,e,f,p,!0);na(n.eventQueue_,y),n.server_.put(e.toString(),u.val(!0),(I,M)=>{const B=I==="ok";B||ht("set at "+e+" failed: "+I);const ue=fn(n.serverSyncTree_,p,!B);Lt(n.eventQueue_,e,ue),Vn(n,i,I,M)});const v=qc(n,e);es(n,v),Lt(n.eventQueue_,v,[])}function Jm(n){sa(n,"onDisconnectEvents");const e=ra(n),t=Oi();ao(n.onDisconnect_,Oe(),(i,a)=>{const u=Rm(i,a,n.serverSyncTree_,e);Wn(t,i,u)});let r=[];ao(t,Oe(),(i,a)=>{r=r.concat(Qi(n.serverSyncTree_,i,a));const u=qc(n,i);es(n,u)}),n.onDisconnect_=Oi(),Lt(n.eventQueue_,Oe(),r)}function Zm(n,e,t){n.server_.onDisconnectCancel(e.toString(),(r,i)=>{r==="ok"&&oo(n.onDisconnect_,e),Vn(n,t,r,i)})}function Nu(n,e,t,r){const i=We(t);n.server_.onDisconnectPut(e.toString(),i.val(!0),(a,u)=>{a==="ok"&&Wn(n.onDisconnect_,e,i),Vn(n,r,a,u)})}function e_(n,e,t,r,i){const a=We(t,r);n.server_.onDisconnectPut(e.toString(),a.val(!0),(u,h)=>{u==="ok"&&Wn(n.onDisconnect_,e,a),Vn(n,i,u,h)})}function t_(n,e,t,r){if(Zs(t)){et("onDisconnect().update() called with empty data.  Don't do anything."),Vn(n,r,"ok",void 0);return}n.server_.onDisconnectMerge(e.toString(),t,(i,a)=>{i==="ok"&&it(t,(u,h)=>{const f=We(h);Wn(n.onDisconnect_,Ve(e,u),f)}),Vn(n,r,i,a)})}function n_(n,e,t){let r;ve(e._path)===".info"?r=Ou(n.infoSyncTree_,e,t):r=Ou(n.serverSyncTree_,e,t),Dc(n.eventQueue_,e._path,r)}function r_(n,e,t){let r;ve(e._path)===".info"?r=po(n.infoSyncTree_,e,t):r=po(n.serverSyncTree_,e,t),Dc(n.eventQueue_,e._path,r)}function i_(n){n.persistentConnection_&&n.persistentConnection_.interrupt(Ym)}function sa(n,...e){let t="";n.persistentConnection_&&(t=n.persistentConnection_.id+":"),et(t,...e)}function Vn(n,e,t,r){e&&Kn(()=>{if(t==="ok")e(null);else{const i=(t||"error").toUpperCase();let a=i;r&&(a+=": "+r);const u=new Error(a);u.code=i,e(u)}})}function $c(n,e,t){return Yo(n.serverSyncTree_,e,t)||me.EMPTY_NODE}function oa(n,e=n.transactionQueueTree_){if(e||ts(n,e),Yn(e)){const t=jc(n,e);Q(t.length>0,"Sending zero length transaction queue"),t.every(i=>i.status===0)&&s_(n,Nr(e),t)}else kc(e)&&Ji(e,t=>{oa(n,t)})}function s_(n,e,t){const r=t.map(p=>p.currentWriteId),i=$c(n,e,r);let a=i;const u=i.hash();for(let p=0;p<t.length;p++){const y=t[p];Q(y.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),y.status=1,y.retryCount++;const v=lt(e,y.path);a=a.updateChild(v,y.currentOutputSnapshotRaw)}const h=a.val(!0),f=e;n.server_.put(f.toString(),h,p=>{sa(n,"transaction put response",{path:f.toString(),status:p});let y=[];if(p==="ok"){const v=[];for(let I=0;I<t.length;I++)t[I].status=2,y=y.concat(fn(n.serverSyncTree_,t[I].currentWriteId)),t[I].onComplete&&v.push(()=>t[I].onComplete(null,!0,t[I].currentOutputSnapshotResolved)),t[I].unwatcher();ts(n,ea(n.transactionQueueTree_,e)),oa(n,n.transactionQueueTree_),Lt(n.eventQueue_,e,y);for(let I=0;I<v.length;I++)Kn(v[I])}else{if(p==="datastale")for(let v=0;v<t.length;v++)t[v].status===3?t[v].status=4:t[v].status=0;else{ht("transaction at "+f.toString()+" failed: "+p);for(let v=0;v<t.length;v++)t[v].status=4,t[v].abortReason=p}es(n,e)}},u)}function es(n,e){const t=Fc(n,e),r=Nr(t),i=jc(n,t);return o_(n,i,r),r}function o_(n,e,t){if(e.length===0)return;const r=[];let i=[];const u=e.filter(h=>h.status===0).map(h=>h.currentWriteId);for(let h=0;h<e.length;h++){const f=e[h],p=lt(t,f.path);let y=!1,v;if(Q(p!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),f.status===4)y=!0,v=f.abortReason,i=i.concat(fn(n.serverSyncTree_,f.currentWriteId,!0));else if(f.status===0)if(f.retryCount>=Hm)y=!0,v="maxretry",i=i.concat(fn(n.serverSyncTree_,f.currentWriteId,!0));else{const I=$c(n,f.path,u);f.currentInputSnapshot=I;const M=e[h].update(I.val());if(M!==void 0){Zi("transaction failed: Data returned ",M,f.path);let B=We(M);typeof M=="object"&&M!=null&&kt(M,".priority")||(B=B.updatePriority(I.getPriority()));const Z=f.currentWriteId,de=ra(n),_e=Sc(B,I,de);f.currentOutputSnapshotRaw=B,f.currentOutputSnapshotResolved=_e,f.currentWriteId=Lc(n),u.splice(u.indexOf(Z),1),i=i.concat(Ec(n.serverSyncTree_,f.path,_e,f.currentWriteId,f.applyLocally)),i=i.concat(fn(n.serverSyncTree_,Z,!0))}else y=!0,v="nodata",i=i.concat(fn(n.serverSyncTree_,f.currentWriteId,!0))}Lt(n.eventQueue_,t,i),i=[],y&&(e[h].status=2,function(I){setTimeout(I,Math.floor(0))}(e[h].unwatcher),e[h].onComplete&&(v==="nodata"?r.push(()=>e[h].onComplete(null,!1,e[h].currentInputSnapshot)):r.push(()=>e[h].onComplete(new Error(v),!1,null))))}ts(n,n.transactionQueueTree_);for(let h=0;h<r.length;h++)Kn(r[h]);oa(n,n.transactionQueueTree_)}function Fc(n,e){let t,r=n.transactionQueueTree_;for(t=ve(e);t!==null&&Yn(r)===void 0;)r=ea(r,t),e=Me(e),t=ve(e);return r}function jc(n,e){const t=[];return Bc(n,e,t),t.sort((r,i)=>r.order-i.order),t}function Bc(n,e,t){const r=Yn(e);if(r)for(let i=0;i<r.length;i++)t.push(r[i]);Ji(e,i=>{Bc(n,i,t)})}function ts(n,e){const t=Yn(e);if(t){let r=0;for(let i=0;i<t.length;i++)t[i].status!==2&&(t[r]=t[i],r++);t.length=r,Ic(e,t.length>0?t:void 0)}Ji(e,r=>{ts(n,r)})}function qc(n,e){const t=Nr(Fc(n,e)),r=ea(n.transactionQueueTree_,e);return Mm(r,i=>{Hs(n,i)}),Hs(n,r),Ac(r,i=>{Hs(n,i)}),t}function Hs(n,e){const t=Yn(e);if(t){const r=[];let i=[],a=-1;for(let u=0;u<t.length;u++)t[u].status===3||(t[u].status===1?(Q(a===u-1,"All SENT items should be at beginning of queue."),a=u,t[u].status=3,t[u].abortReason="set"):(Q(t[u].status===0,"Unexpected transaction status in abort"),t[u].unwatcher(),i=i.concat(fn(n.serverSyncTree_,t[u].currentWriteId,!0)),t[u].onComplete&&r.push(t[u].onComplete.bind(null,new Error("set"),!1,null))));a===-1?Ic(e,void 0):t.length=a+1,Lt(n.eventQueue_,Nr(e),i);for(let u=0;u<r.length;u++)Kn(r[u])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function a_(n){let e="";const t=n.split("/");for(let r=0;r<t.length;r++)if(t[r].length>0){let i=t[r];try{i=decodeURIComponent(i.replace(/\+/g," "))}catch{}e+="/"+i}return e}function u_(n){const e={};n.charAt(0)==="?"&&(n=n.substring(1));for(const t of n.split("&")){if(t.length===0)continue;const r=t.split("=");r.length===2?e[decodeURIComponent(r[0])]=decodeURIComponent(r[1]):ht(`Invalid query segment '${t}' in query '${n}'`)}return e}const Lu=function(n,e){const t=l_(n),r=t.namespace;t.domain==="firebase.com"&&Nt(t.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!r||r==="undefined")&&t.domain!=="localhost"&&Nt("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),t.secure||gd();const i=t.scheme==="ws"||t.scheme==="wss";return{repoInfo:new Yl(t.host,t.secure,r,i,e,"",r!==t.subdomain),path:new De(t.pathString)}},l_=function(n){let e="",t="",r="",i="",a="",u=!0,h="https",f=443;if(typeof n=="string"){let p=n.indexOf("//");p>=0&&(h=n.substring(0,p-1),n=n.substring(p+2));let y=n.indexOf("/");y===-1&&(y=n.length);let v=n.indexOf("?");v===-1&&(v=n.length),e=n.substring(0,Math.min(y,v)),y<v&&(i=a_(n.substring(y,v)));const I=u_(n.substring(Math.min(n.length,v)));p=e.indexOf(":"),p>=0?(u=h==="https"||h==="wss",f=parseInt(e.substring(p+1),10)):p=e.length;const M=e.slice(0,p);if(M.toLowerCase()==="localhost")t="localhost";else if(M.split(".").length<=2)t=M;else{const B=e.indexOf(".");r=e.substring(0,B).toLowerCase(),t=e.substring(B+1),a=r}"ns"in I&&(a=I.ns)}return{host:e,port:f,domain:t,subdomain:r,secure:u,scheme:h,pathString:i,namespace:a}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $u="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",c_=function(){let n=0;const e=[];return function(t){const r=t===n;n=t;let i;const a=new Array(8);for(i=7;i>=0;i--)a[i]=$u.charAt(t%64),t=Math.floor(t/64);Q(t===0,"Cannot push at time == 0");let u=a.join("");if(r){for(i=11;i>=0&&e[i]===63;i--)e[i]=0;e[i]++}else for(i=0;i<12;i++)e[i]=Math.floor(Math.random()*64);for(i=0;i<12;i++)u+=$u.charAt(e[i]);return Q(u.length===20,"nextPushId: Length should be 20."),u}}();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class h_{constructor(e,t,r,i){this.eventType=e,this.eventRegistration=t,this.snapshot=r,this.prevName=i}getPath(){const e=this.snapshot.ref;return this.eventType==="value"?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+Je(this.snapshot.exportVal())}}class f_{constructor(e,t,r){this.eventRegistration=e,this.error=t,this.path=r}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class d_{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return Q(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class p_{constructor(e,t){this._repo=e,this._path=t}cancel(){const e=new Yt;return Zm(this._repo,this._path,e.wrapCallback(()=>{})),e.promise}remove(){dn("OnDisconnect.remove",this._path);const e=new Yt;return Nu(this._repo,this._path,null,e.wrapCallback(()=>{})),e.promise}set(e){dn("OnDisconnect.set",this._path),ji("OnDisconnect.set",e,this._path,!1);const t=new Yt;return Nu(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}setWithPriority(e,t){dn("OnDisconnect.setWithPriority",this._path),ji("OnDisconnect.setWithPriority",e,this._path,!1),qm("OnDisconnect.setWithPriority",t);const r=new Yt;return e_(this._repo,this._path,e,t,r.wrapCallback(()=>{})),r.promise}update(e){dn("OnDisconnect.update",this._path),Bm("OnDisconnect.update",e,this._path);const t=new Yt;return t_(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aa{constructor(e,t,r,i){this._repo=e,this._path=t,this._queryParams=r,this._orderByCalled=i}get key(){return xe(this._path)?null:Do(this._path)}get ref(){return new Jt(this._repo,this._path)}get _queryIdentifier(){const e=vu(this._queryParams),t=Ao(e);return t==="{}"?"default":t}get _queryObject(){return vu(this._queryParams)}isEqual(e){if(e=vn(e),!(e instanceof aa))return!1;const t=this._repo===e._repo,r=Mo(this._path,e._path),i=this._queryIdentifier===e._queryIdentifier;return t&&r&&i}toJSON(){return this.toString()}toString(){return this._repo.toString()+ep(this._path)}}class Jt extends aa{constructor(e,t){super(e,t,new Fo,!1)}get parent(){const e=tc(this._path);return e===null?null:new Jt(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}}class Bi{constructor(e,t,r){this._node=e,this.ref=t,this._index=r}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){const t=new De(e),r=kr(this.ref,e);return new Bi(this._node.getChild(t),r,Be)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(r,i)=>e(new Bi(i,kr(this.ref,r),Be)))}hasChild(e){const t=new De(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function _i(n,e){return n=vn(n),n._checkNotDeleted("ref"),e!==void 0?kr(n._root,e):n._root}function kr(n,e){return n=vn(n),ve(n._path)===null?Um("child","path",e):Rc("child","path",e),new Jt(n._repo,Ve(n._path,e))}function Fu(n){return n=vn(n),new p_(n._repo,n._path)}function ju(n,e){n=vn(n),dn("push",n._path),ji("push",e,n._path,!0);const t=Nc(n._repo),r=c_(t),i=kr(n,r),a=kr(n,r);let u;return u=Promise.resolve(a),i.then=u.then.bind(u),i.catch=u.then.bind(u,void 0),i}function zs(n){return dn("remove",n._path),Uc(n,null)}function Uc(n,e){n=vn(n),dn("set",n._path),ji("set",e,n._path,!1);const t=new Yt;return Xm(n._repo,n._path,e,null,t.wrapCallback(()=>{})),t.promise}class ua{constructor(e){this.callbackContext=e}respondsTo(e){return e==="value"}createEvent(e,t){const r=t._queryParams.getIndex();return new h_("value",this,new Bi(e.snapshotNode,new Jt(t._repo,t._path),r))}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new f_(this,e,t):null}matches(e){return e instanceof ua?!e.callbackContext||!this.callbackContext?!0:e.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}}function m_(n,e,t,r,i){const a=new d_(t,void 0),u=new ua(a);return n_(n._repo,n,u),()=>r_(n._repo,n,u)}function Vc(n,e,t,r){return m_(n,"value",e)}hm(Jt);gm(Jt);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const __="FIREBASE_DATABASE_EMULATOR_HOST",_o={};let g_=!1;function y_(n,e,t,r){n.repoInfo_=new Yl(e,!1,n.repoInfo_.namespace,n.repoInfo_.webSocketOnly,n.repoInfo_.nodeAdmin,n.repoInfo_.persistenceKey,n.repoInfo_.includeNamespaceInQueryParams,!0,t),r&&(n.authTokenProvider_=r)}function v_(n,e,t,r,i){let a=r||n.options.databaseURL;a===void 0&&(n.options.projectId||Nt("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),et("Using default host for project ",n.options.projectId),a=`${n.options.projectId}-default-rtdb.firebaseio.com`);let u=Lu(a,i),h=u.repoInfo,f;typeof process<"u"&&tu&&(f=tu[__]),f?(a=`http://${f}?ns=${h.namespace}`,u=Lu(a,i),h=u.repoInfo):u.repoInfo.secure;const p=new kd(n.name,n.options,e);Vm("Invalid Firebase Database URL",u),xe(u.path)||Nt("Database URL must point to the root of a Firebase Database (not including a child path).");const y=b_(h,n,p,new Id(n,t));return new E_(y,n)}function w_(n,e){const t=_o[e];(!t||t[n.key]!==n)&&Nt(`Database ${e}(${n.repoInfo_}) has already been deleted.`),i_(n),delete t[n.key]}function b_(n,e,t,r){let i=_o[e.name];i||(i={},_o[e.name]=i);let a=i[n.toURLString()];return a&&Nt("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),a=new zm(n,g_,t,r),i[n.toURLString()]=a,a}class E_{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(Gm(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new Jt(this._repo,Oe())),this._rootInternal}_delete(){return this._rootInternal!==null&&(w_(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&Nt("Cannot call "+e+" on a deleted database.")}}function Kc(n=zh(),e){const t=Gh(n,"database").getImmediate({identifier:e});if(!t._instanceStarted){const r=Qh("database");r&&x_(t,...r)}return t}function x_(n,e,t,r={}){n=vn(n),n._checkNotDeleted("useEmulator");const i=`${e}:${t}`,a=n._repoInternal;if(n._instanceStarted){if(i===n._repoInternal.repoInfo_.host&&Xh(r,a.repoInfo_.emulatorOptions))return;Nt("connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.")}let u;if(a.repoInfo_.nodeAdmin)r.mockUserToken&&Nt('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),u=new mi(mi.OWNER);else if(r.mockUserToken){const h=typeof r.mockUserToken=="string"?r.mockUserToken:Jh(r.mockUserToken,n.app.options.projectId);u=new mi(h)}y_(a,i,r,u)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function C_(n){hd(Zh),Mh(new Nh("database",(e,{instanceIdentifier:t})=>{const r=e.getProvider("app").getImmediate(),i=e.getProvider("auth-internal"),a=e.getProvider("app-check-internal");return v_(r,i,a,t)},"PUBLIC").setMultipleInstances(!0)),Va(nu,ru,n),Va(nu,ru,"esm2017")}Dt.prototype.simpleListen=function(n,e){this.sendRequest("q",{p:n},e)};Dt.prototype.echo=function(n,e){this.sendRequest("echo",{d:n},e)};C_();var Gs={exports:{}};const T_={},S_=Object.freeze(Object.defineProperty({__proto__:null,default:T_},Symbol.toStringTag,{value:"Module"})),Bu=Ah(S_);/**
 * [js-sha256]{@link https://github.com/emn178/js-sha256}
 *
 * @version 0.11.0
 * @author Chen, Yi-Cyuan [emn178@gmail.com]
 * @copyright Chen, Yi-Cyuan 2014-2024
 * @license MIT
 */var qu;function I_(){return qu||(qu=1,function(n){(function(){var e="input is invalid type",t=typeof window=="object",r=t?window:{};r.JS_SHA256_NO_WINDOW&&(t=!1);var i=!t&&typeof self=="object",a=!r.JS_SHA256_NO_NODE_JS&&typeof process=="object"&&process.versions&&process.versions.node;a?r=ol:i&&(r=self);var u=!r.JS_SHA256_NO_COMMON_JS&&!0&&n.exports,h=!r.JS_SHA256_NO_ARRAY_BUFFER&&typeof ArrayBuffer<"u",f="0123456789abcdef".split(""),p=[-2147483648,8388608,32768,128],y=[24,16,8,0],v=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],I=["hex","array","digest","arrayBuffer"],M=[];(r.JS_SHA256_NO_NODE_JS||!Array.isArray)&&(Array.isArray=function(P){return Object.prototype.toString.call(P)==="[object Array]"}),h&&(r.JS_SHA256_NO_ARRAY_BUFFER_IS_VIEW||!ArrayBuffer.isView)&&(ArrayBuffer.isView=function(P){return typeof P=="object"&&P.buffer&&P.buffer.constructor===ArrayBuffer});var B=function(P,$){return function(ne){return new ce($,!0).update(ne)[P]()}},ue=function(P){var $=B("hex",P);a&&($=Z($,P)),$.create=function(){return new ce(P)},$.update=function(ee){return $.create().update(ee)};for(var ne=0;ne<I.length;++ne){var H=I[ne];$[H]=B(H,P)}return $},Z=function(P,$){var ne=Bu,H=Bu.Buffer,ee=$?"sha224":"sha256",L;H.from&&!r.JS_SHA256_NO_BUFFER_FROM?L=H.from:L=function(F){return new H(F)};var fe=function(F){if(typeof F=="string")return ne.createHash(ee).update(F,"utf8").digest("hex");if(F==null)throw new Error(e);return F.constructor===ArrayBuffer&&(F=new Uint8Array(F)),Array.isArray(F)||ArrayBuffer.isView(F)||F.constructor===H?ne.createHash(ee).update(L(F)).digest("hex"):P(F)};return fe},de=function(P,$){return function(ne,H){return new Ae(ne,$,!0).update(H)[P]()}},_e=function(P){var $=de("hex",P);$.create=function(ee){return new Ae(ee,P)},$.update=function(ee,L){return $.create(ee).update(L)};for(var ne=0;ne<I.length;++ne){var H=I[ne];$[H]=de(H,P)}return $};function ce(P,$){$?(M[0]=M[16]=M[1]=M[2]=M[3]=M[4]=M[5]=M[6]=M[7]=M[8]=M[9]=M[10]=M[11]=M[12]=M[13]=M[14]=M[15]=0,this.blocks=M):this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],P?(this.h0=3238371032,this.h1=914150663,this.h2=812702999,this.h3=4144912697,this.h4=4290775857,this.h5=1750603025,this.h6=1694076839,this.h7=3204075428):(this.h0=1779033703,this.h1=3144134277,this.h2=1013904242,this.h3=2773480762,this.h4=1359893119,this.h5=2600822924,this.h6=528734635,this.h7=1541459225),this.block=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0,this.is224=P}ce.prototype.update=function(P){if(!this.finalized){var $,ne=typeof P;if(ne!=="string"){if(ne==="object"){if(P===null)throw new Error(e);if(h&&P.constructor===ArrayBuffer)P=new Uint8Array(P);else if(!Array.isArray(P)&&(!h||!ArrayBuffer.isView(P)))throw new Error(e)}else throw new Error(e);$=!0}for(var H,ee=0,L,fe=P.length,F=this.blocks;ee<fe;){if(this.hashed&&(this.hashed=!1,F[0]=this.block,this.block=F[16]=F[1]=F[2]=F[3]=F[4]=F[5]=F[6]=F[7]=F[8]=F[9]=F[10]=F[11]=F[12]=F[13]=F[14]=F[15]=0),$)for(L=this.start;ee<fe&&L<64;++ee)F[L>>>2]|=P[ee]<<y[L++&3];else for(L=this.start;ee<fe&&L<64;++ee)H=P.charCodeAt(ee),H<128?F[L>>>2]|=H<<y[L++&3]:H<2048?(F[L>>>2]|=(192|H>>>6)<<y[L++&3],F[L>>>2]|=(128|H&63)<<y[L++&3]):H<55296||H>=57344?(F[L>>>2]|=(224|H>>>12)<<y[L++&3],F[L>>>2]|=(128|H>>>6&63)<<y[L++&3],F[L>>>2]|=(128|H&63)<<y[L++&3]):(H=65536+((H&1023)<<10|P.charCodeAt(++ee)&1023),F[L>>>2]|=(240|H>>>18)<<y[L++&3],F[L>>>2]|=(128|H>>>12&63)<<y[L++&3],F[L>>>2]|=(128|H>>>6&63)<<y[L++&3],F[L>>>2]|=(128|H&63)<<y[L++&3]);this.lastByteIndex=L,this.bytes+=L-this.start,L>=64?(this.block=F[16],this.start=L-64,this.hash(),this.hashed=!0):this.start=L}return this.bytes>4294967295&&(this.hBytes+=this.bytes/4294967296<<0,this.bytes=this.bytes%4294967296),this}},ce.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var P=this.blocks,$=this.lastByteIndex;P[16]=this.block,P[$>>>2]|=p[$&3],this.block=P[16],$>=56&&(this.hashed||this.hash(),P[0]=this.block,P[16]=P[1]=P[2]=P[3]=P[4]=P[5]=P[6]=P[7]=P[8]=P[9]=P[10]=P[11]=P[12]=P[13]=P[14]=P[15]=0),P[14]=this.hBytes<<3|this.bytes>>>29,P[15]=this.bytes<<3,this.hash()}},ce.prototype.hash=function(){var P=this.h0,$=this.h1,ne=this.h2,H=this.h3,ee=this.h4,L=this.h5,fe=this.h6,F=this.h7,V=this.blocks,j,U,re,Y,z,oe,pe,Ie,Se,Ne,Fe;for(j=16;j<64;++j)z=V[j-15],U=(z>>>7|z<<25)^(z>>>18|z<<14)^z>>>3,z=V[j-2],re=(z>>>17|z<<15)^(z>>>19|z<<13)^z>>>10,V[j]=V[j-16]+U+V[j-7]+re<<0;for(Fe=$&ne,j=0;j<64;j+=4)this.first?(this.is224?(Ie=300032,z=V[0]-1413257819,F=z-150054599<<0,H=z+24177077<<0):(Ie=704751109,z=V[0]-210244248,F=z-1521486534<<0,H=z+143694565<<0),this.first=!1):(U=(P>>>2|P<<30)^(P>>>13|P<<19)^(P>>>22|P<<10),re=(ee>>>6|ee<<26)^(ee>>>11|ee<<21)^(ee>>>25|ee<<7),Ie=P&$,Y=Ie^P&ne^Fe,pe=ee&L^~ee&fe,z=F+re+pe+v[j]+V[j],oe=U+Y,F=H+z<<0,H=z+oe<<0),U=(H>>>2|H<<30)^(H>>>13|H<<19)^(H>>>22|H<<10),re=(F>>>6|F<<26)^(F>>>11|F<<21)^(F>>>25|F<<7),Se=H&P,Y=Se^H&$^Ie,pe=F&ee^~F&L,z=fe+re+pe+v[j+1]+V[j+1],oe=U+Y,fe=ne+z<<0,ne=z+oe<<0,U=(ne>>>2|ne<<30)^(ne>>>13|ne<<19)^(ne>>>22|ne<<10),re=(fe>>>6|fe<<26)^(fe>>>11|fe<<21)^(fe>>>25|fe<<7),Ne=ne&H,Y=Ne^ne&P^Se,pe=fe&F^~fe&ee,z=L+re+pe+v[j+2]+V[j+2],oe=U+Y,L=$+z<<0,$=z+oe<<0,U=($>>>2|$<<30)^($>>>13|$<<19)^($>>>22|$<<10),re=(L>>>6|L<<26)^(L>>>11|L<<21)^(L>>>25|L<<7),Fe=$&ne,Y=Fe^$&H^Ne,pe=L&fe^~L&F,z=ee+re+pe+v[j+3]+V[j+3],oe=U+Y,ee=P+z<<0,P=z+oe<<0,this.chromeBugWorkAround=!0;this.h0=this.h0+P<<0,this.h1=this.h1+$<<0,this.h2=this.h2+ne<<0,this.h3=this.h3+H<<0,this.h4=this.h4+ee<<0,this.h5=this.h5+L<<0,this.h6=this.h6+fe<<0,this.h7=this.h7+F<<0},ce.prototype.hex=function(){this.finalize();var P=this.h0,$=this.h1,ne=this.h2,H=this.h3,ee=this.h4,L=this.h5,fe=this.h6,F=this.h7,V=f[P>>>28&15]+f[P>>>24&15]+f[P>>>20&15]+f[P>>>16&15]+f[P>>>12&15]+f[P>>>8&15]+f[P>>>4&15]+f[P&15]+f[$>>>28&15]+f[$>>>24&15]+f[$>>>20&15]+f[$>>>16&15]+f[$>>>12&15]+f[$>>>8&15]+f[$>>>4&15]+f[$&15]+f[ne>>>28&15]+f[ne>>>24&15]+f[ne>>>20&15]+f[ne>>>16&15]+f[ne>>>12&15]+f[ne>>>8&15]+f[ne>>>4&15]+f[ne&15]+f[H>>>28&15]+f[H>>>24&15]+f[H>>>20&15]+f[H>>>16&15]+f[H>>>12&15]+f[H>>>8&15]+f[H>>>4&15]+f[H&15]+f[ee>>>28&15]+f[ee>>>24&15]+f[ee>>>20&15]+f[ee>>>16&15]+f[ee>>>12&15]+f[ee>>>8&15]+f[ee>>>4&15]+f[ee&15]+f[L>>>28&15]+f[L>>>24&15]+f[L>>>20&15]+f[L>>>16&15]+f[L>>>12&15]+f[L>>>8&15]+f[L>>>4&15]+f[L&15]+f[fe>>>28&15]+f[fe>>>24&15]+f[fe>>>20&15]+f[fe>>>16&15]+f[fe>>>12&15]+f[fe>>>8&15]+f[fe>>>4&15]+f[fe&15];return this.is224||(V+=f[F>>>28&15]+f[F>>>24&15]+f[F>>>20&15]+f[F>>>16&15]+f[F>>>12&15]+f[F>>>8&15]+f[F>>>4&15]+f[F&15]),V},ce.prototype.toString=ce.prototype.hex,ce.prototype.digest=function(){this.finalize();var P=this.h0,$=this.h1,ne=this.h2,H=this.h3,ee=this.h4,L=this.h5,fe=this.h6,F=this.h7,V=[P>>>24&255,P>>>16&255,P>>>8&255,P&255,$>>>24&255,$>>>16&255,$>>>8&255,$&255,ne>>>24&255,ne>>>16&255,ne>>>8&255,ne&255,H>>>24&255,H>>>16&255,H>>>8&255,H&255,ee>>>24&255,ee>>>16&255,ee>>>8&255,ee&255,L>>>24&255,L>>>16&255,L>>>8&255,L&255,fe>>>24&255,fe>>>16&255,fe>>>8&255,fe&255];return this.is224||V.push(F>>>24&255,F>>>16&255,F>>>8&255,F&255),V},ce.prototype.array=ce.prototype.digest,ce.prototype.arrayBuffer=function(){this.finalize();var P=new ArrayBuffer(this.is224?28:32),$=new DataView(P);return $.setUint32(0,this.h0),$.setUint32(4,this.h1),$.setUint32(8,this.h2),$.setUint32(12,this.h3),$.setUint32(16,this.h4),$.setUint32(20,this.h5),$.setUint32(24,this.h6),this.is224||$.setUint32(28,this.h7),P};function Ae(P,$,ne){var H,ee=typeof P;if(ee==="string"){var L=[],fe=P.length,F=0,V;for(H=0;H<fe;++H)V=P.charCodeAt(H),V<128?L[F++]=V:V<2048?(L[F++]=192|V>>>6,L[F++]=128|V&63):V<55296||V>=57344?(L[F++]=224|V>>>12,L[F++]=128|V>>>6&63,L[F++]=128|V&63):(V=65536+((V&1023)<<10|P.charCodeAt(++H)&1023),L[F++]=240|V>>>18,L[F++]=128|V>>>12&63,L[F++]=128|V>>>6&63,L[F++]=128|V&63);P=L}else if(ee==="object"){if(P===null)throw new Error(e);if(h&&P.constructor===ArrayBuffer)P=new Uint8Array(P);else if(!Array.isArray(P)&&(!h||!ArrayBuffer.isView(P)))throw new Error(e)}else throw new Error(e);P.length>64&&(P=new ce($,!0).update(P).array());var j=[],U=[];for(H=0;H<64;++H){var re=P[H]||0;j[H]=92^re,U[H]=54^re}ce.call(this,$,ne),this.update(U),this.oKeyPad=j,this.inner=!0,this.sharedMemory=ne}Ae.prototype=new ce,Ae.prototype.finalize=function(){if(ce.prototype.finalize.call(this),this.inner){this.inner=!1;var P=this.array();ce.call(this,this.is224,this.sharedMemory),this.update(this.oKeyPad),this.update(P),ce.prototype.finalize.call(this)}};var le=ue();le.sha256=le,le.sha224=ue(!0),le.sha256.hmac=_e(),le.sha224.hmac=_e(!0),u?n.exports=le:(r.sha256=le.sha256,r.sha224=le.sha224)})()}(Gs)),Gs.exports}var k_=I_();const A_={apiKey:"AIzaSyCKS7tWQRYRWHsawNfN42uAmISdUbJHJJw",authDomain:"blitzout-49b39.firebaseapp.com",projectId:"blitzout-49b39",storageBucket:"blitzout-49b39.appspot.com",messagingSenderId:"852428606926",appId:"1:852428606926:web:17444e6f8dbc2f95f0ef9f",measurementId:"G-93YN1YMTQ7"},P_=ef(A_),Ft=ll(P_);async function O_(n=""){try{const e=at();return await pf(e),await bo(e.currentUser,{displayName:n}),e.currentUser}catch(e){return console.error(e),null}}async function R_(n,e,t=""){try{const r=at(),i=await uf(r,n,e);return await bo(i.user,{displayName:t}),i.user}catch(r){throw console.error("Registration error:",r),r}}async function D_(n,e){try{const t=at();return(await sf(t,n,e)).user}catch(t){throw console.error("Email login error:",t),t}}async function M_(){try{const n=at(),e=new of;return(await af(n,e)).user}catch(n){throw console.error("Google login error:",n),n}}async function N_(n){try{const e=at();return await df(e,n),!0}catch(e){throw console.error("Password reset error:",e),e}}async function L_(n,e){try{const r=at().currentUser;if(r!=null&&r.isAnonymous){const i=hf.credential(n,e);return(await ff(r,i)).user}else throw new Error("User is not anonymous or not logged in")}catch(t){throw console.error("Account conversion error:",t),t}}async function $_(){try{const n=at();return await cf(n),!0}catch(n){throw console.error(n),n}}function Cy({newRoom:n,oldRoom:e,newDisplayName:t,oldDisplayName:r,removeOnDisconnect:i=!0}){var ue;const a=Kc(),h=(ue=at().currentUser)==null?void 0:ue.uid,f=n==null?void 0:n.toUpperCase(),p=e==null?void 0:e.toUpperCase(),y=_i(a,`rooms/${f}/uids/${h}`),v=_i(a,`rooms/${p}/uids/${h}`),I=_i(a,".info/connected");let M,B;Vc(I,Z=>{Z.val()===!0&&(M=ju(y),B=ju(v),(p!==f||r!==t)&&zs(v),i&&(Fu(B).remove(),Fu(M).remove()),Uc(M,{displayName:t,lastActive:Date.now()}))}),document.addEventListener("beforeunload",()=>{B&&zs(B),M&&zs(M)})}function F_(n,e,t={}){const r=Kc(),i=_i(r,`rooms/${n==null?void 0:n.toUpperCase()}/uids`);Vc(i,a=>{const u=a.val();if(!u)return;const h=Object.keys(u).sort().join(","),f=t?Object.keys(t).sort().join(","):"";h!==f&&e(u)})}async function j_(n=""){try{const e=at();return await bo(e.currentUser,{displayName:n}),e.currentUser}catch(e){return console.error(e),null}}async function Ty(n,e){try{await Vi(wn(Ft,"custom-actions"),{grouping:n,customAction:e,ttl:new Date(Date.now()+4*24*60*60*1e3)})}catch(t){console.error(t)}}async function B_(n){const e=Eo(wn(Ft,"game-boards"),xo("checksum","==",n)),t=await lf(e);return t.size?t.docs[0]:null}async function Sy({title:n,gameBoard:e,settings:t}){if(n)try{const r=k_.sha256(e),i=await B_(r);return i?(nf(i.ref,{ttl:new Date(Date.now()+30*24*60*60*1e3)}),i):await q_({title:n,gameBoard:e,settings:t,checksum:r})}catch(r){console.error(r)}}async function q_({title:n,gameBoard:e,settings:t,checksum:r}){try{return await Vi(wn(Ft,"game-boards"),{title:n,gameBoard:e,settings:t,checksum:r,ttl:new Date(Date.now()+30*24*60*60*1e3)})}catch(i){console.error(i)}}async function Iy(n){try{const e=Pr(Ft,"game-boards",n),t=await cl(e);if(t.exists())return t.data()}catch(e){console.error(e)}}let Uu={};async function ky({room:n,user:e,text:t="",type:r="chat",...i}){const a=["chat","actions","settings","room","media"];if(!a.includes(r)){let f="Invalid message type. Was expecting ";return f+=a.join(", "),f+=` but got ${r}`,console.error(f)}const u={room:n,user:e.uid,text:t,type:r,...i};if(JSON.stringify(u)===JSON.stringify(Uu))return;Uu=u;const h=Date.now();try{return await Vi(wn(Ft,"chat-rooms",n==null?void 0:n.toUpperCase(),"messages"),{uid:e.uid,displayName:e.displayName,text:t.trim(),timestamp:tf(),ttl:new Date(h+24*60*60*1e3),type:r,...i})}catch(f){return console.error(f)}}async function Ay(n,e){return rf(Pr(Ft,`/chat-rooms/${n.toUpperCase()}/messages/${e}`))}function U_(n,e){if(!n)return;const t=new Date;return t.setHours(t.getHours()-2),hl(Eo(wn(Ft,"chat-rooms",n==null?void 0:n.toUpperCase(),"messages"),xo("timestamp",">",t),fl("timestamp","asc")),r=>{const i=r.docs.map(a=>({id:a.id,...a.data()}));e(i)})}function V_(n){return hl(Eo(wn(Ft,"schedule"),xo("dateTime",">",new Date),fl("dateTime","asc")),e=>{const t=e.docs.map(r=>({id:r.id,...r.data()}));n(t)})}async function K_(n,e,t="PUBLIC"){try{return await Vi(wn(Ft,"schedule"),{dateTime:mf.fromDate(n),url:e,room:t})}catch(r){return console.error(r)}}const W_=(n,e,t)=>{const r=n[e];return r?typeof r=="function"?r():Promise.resolve(r):new Promise((i,a)=>{(typeof queueMicrotask=="function"?queueMicrotask:setTimeout)(a.bind(null,new Error("Unknown variable dynamic import: "+e+(e.split("/").length!==t?". Note that variables only represent file names one level deep.":""))))})};var Y_=function(e){return{type:"backend",init:function(r,i,a){},read:function(r,i,a){if(typeof e=="function"){if(e.length<3){try{var u=e(r,i);u&&typeof u.then=="function"?u.then(function(h){return a(null,h&&h.default||h)}).catch(a):a(null,u)}catch(h){a(h)}return}e(r,i,a);return}a(null,e&&e[r]&&e[r][i])}}};const{slice:H_,forEach:z_}=[];function G_(n){return z_.call(H_.call(arguments,1),e=>{if(e)for(const t in e)n[t]===void 0&&(n[t]=e[t])}),n}const Vu=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/,Q_=function(n,e){const r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{path:"/"},i=encodeURIComponent(e);let a=`${n}=${i}`;if(r.maxAge>0){const u=r.maxAge-0;if(Number.isNaN(u))throw new Error("maxAge should be a Number");a+=`; Max-Age=${Math.floor(u)}`}if(r.domain){if(!Vu.test(r.domain))throw new TypeError("option domain is invalid");a+=`; Domain=${r.domain}`}if(r.path){if(!Vu.test(r.path))throw new TypeError("option path is invalid");a+=`; Path=${r.path}`}if(r.expires){if(typeof r.expires.toUTCString!="function")throw new TypeError("option expires is invalid");a+=`; Expires=${r.expires.toUTCString()}`}if(r.httpOnly&&(a+="; HttpOnly"),r.secure&&(a+="; Secure"),r.sameSite)switch(typeof r.sameSite=="string"?r.sameSite.toLowerCase():r.sameSite){case!0:a+="; SameSite=Strict";break;case"lax":a+="; SameSite=Lax";break;case"strict":a+="; SameSite=Strict";break;case"none":a+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}return a},Ku={create(n,e,t,r){let i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{path:"/",sameSite:"strict"};t&&(i.expires=new Date,i.expires.setTime(i.expires.getTime()+t*60*1e3)),r&&(i.domain=r),document.cookie=Q_(n,encodeURIComponent(e),i)},read(n){const e=`${n}=`,t=document.cookie.split(";");for(let r=0;r<t.length;r++){let i=t[r];for(;i.charAt(0)===" ";)i=i.substring(1,i.length);if(i.indexOf(e)===0)return i.substring(e.length,i.length)}return null},remove(n){this.create(n,"",-1)}};var X_={name:"cookie",lookup(n){let{lookupCookie:e}=n;if(e&&typeof document<"u")return Ku.read(e)||void 0},cacheUserLanguage(n,e){let{lookupCookie:t,cookieMinutes:r,cookieDomain:i,cookieOptions:a}=e;t&&typeof document<"u"&&Ku.create(t,n,r,i,a)}},J_={name:"querystring",lookup(n){var r;let{lookupQuerystring:e}=n,t;if(typeof window<"u"){let{search:i}=window.location;!window.location.search&&((r=window.location.hash)==null?void 0:r.indexOf("?"))>-1&&(i=window.location.hash.substring(window.location.hash.indexOf("?")));const u=i.substring(1).split("&");for(let h=0;h<u.length;h++){const f=u[h].indexOf("=");f>0&&u[h].substring(0,f)===e&&(t=u[h].substring(f+1))}}return t}};let Rn=null;const Wu=()=>{if(Rn!==null)return Rn;try{if(Rn=typeof window<"u"&&window.localStorage!==null,!Rn)return!1;const n="i18next.translate.boo";window.localStorage.setItem(n,"foo"),window.localStorage.removeItem(n)}catch{Rn=!1}return Rn};var Z_={name:"localStorage",lookup(n){let{lookupLocalStorage:e}=n;if(e&&Wu())return window.localStorage.getItem(e)||void 0},cacheUserLanguage(n,e){let{lookupLocalStorage:t}=e;t&&Wu()&&window.localStorage.setItem(t,n)}};let Dn=null;const Yu=()=>{if(Dn!==null)return Dn;try{if(Dn=typeof window<"u"&&window.sessionStorage!==null,!Dn)return!1;const n="i18next.translate.boo";window.sessionStorage.setItem(n,"foo"),window.sessionStorage.removeItem(n)}catch{Dn=!1}return Dn};var eg={name:"sessionStorage",lookup(n){let{lookupSessionStorage:e}=n;if(e&&Yu())return window.sessionStorage.getItem(e)||void 0},cacheUserLanguage(n,e){let{lookupSessionStorage:t}=e;t&&Yu()&&window.sessionStorage.setItem(t,n)}},tg={name:"navigator",lookup(n){const e=[];if(typeof navigator<"u"){const{languages:t,userLanguage:r,language:i}=navigator;if(t)for(let a=0;a<t.length;a++)e.push(t[a]);r&&e.push(r),i&&e.push(i)}return e.length>0?e:void 0}},ng={name:"htmlTag",lookup(n){let{htmlTag:e}=n,t;const r=e||(typeof document<"u"?document.documentElement:null);return r&&typeof r.getAttribute=="function"&&(t=r.getAttribute("lang")),t}},rg={name:"path",lookup(n){var i;let{lookupFromPathIndex:e}=n;if(typeof window>"u")return;const t=window.location.pathname.match(/\/([a-zA-Z-]*)/g);return Array.isArray(t)?(i=t[typeof e=="number"?e:0])==null?void 0:i.replace("/",""):void 0}},ig={name:"subdomain",lookup(n){var i,a;let{lookupFromSubdomainIndex:e}=n;const t=typeof e=="number"?e+1:1,r=typeof window<"u"&&((a=(i=window.location)==null?void 0:i.hostname)==null?void 0:a.match(/^(\w{2,5})\.(([a-z0-9-]{1,63}\.[a-z]{2,6})|localhost)/i));if(r)return r[t]}};let Wc=!1;try{document.cookie,Wc=!0}catch{}const Yc=["querystring","cookie","localStorage","sessionStorage","navigator","htmlTag"];Wc||Yc.splice(1,1);const sg=()=>({order:Yc,lookupQuerystring:"lng",lookupCookie:"i18next",lookupLocalStorage:"i18nextLng",lookupSessionStorage:"i18nextLng",caches:["localStorage"],excludeCacheFor:["cimode"],convertDetectedLanguage:n=>n});class Hc{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.type="languageDetector",this.detectors={},this.init(e,t)}init(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{languageUtils:{}},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this.services=e,this.options=G_(t,this.options||{},sg()),typeof this.options.convertDetectedLanguage=="string"&&this.options.convertDetectedLanguage.indexOf("15897")>-1&&(this.options.convertDetectedLanguage=i=>i.replace("-","_")),this.options.lookupFromUrlIndex&&(this.options.lookupFromPathIndex=this.options.lookupFromUrlIndex),this.i18nOptions=r,this.addDetector(X_),this.addDetector(J_),this.addDetector(Z_),this.addDetector(eg),this.addDetector(tg),this.addDetector(ng),this.addDetector(rg),this.addDetector(ig)}addDetector(e){return this.detectors[e.name]=e,this}detect(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.options.order,t=[];return e.forEach(r=>{if(this.detectors[r]){let i=this.detectors[r].lookup(this.options);i&&typeof i=="string"&&(i=[i]),i&&(t=t.concat(i))}}),t=t.map(r=>this.options.convertDetectedLanguage(r)),this.services&&this.services.languageUtils&&this.services.languageUtils.getBestMatchFromCodes?t:t.length>0?t[0]:null}cacheUserLanguage(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.options.caches;t&&(this.options.excludeCacheFor&&this.options.excludeCacheFor.indexOf(e)>-1||t.forEach(r=>{this.detectors[r]&&this.detectors[r].cacheUserLanguage(e,this.options)}))}}Hc.type="languageDetector";const Hu=pl.use(_f).use(Hc).use(Y_((n,e)=>W_(Object.assign({"./locales/en/translation.json":()=>q(()=>import("./translation-DeSZgpz-.js"),[]),"./locales/es/translation.json":()=>q(()=>import("./translation-SvjJLGYg.js"),[]),"./locales/fr/translation.json":()=>q(()=>import("./translation-DeoTeW7j.js"),[])}),`./locales/${n}/${e}.json`,4))).init({fallbackLng:"en",supportedLngs:["en","es","fr"],ns:["translation","errors"],defaultNS:"translation",interpolation:{escapeValue:!1},react:{useSuspense:!0},detection:{order:["querystring","cookie","localStorage","navigator","htmlTag"],caches:["localStorage","cookie"]}});function og(n={tables:["customTiles","gameBoard"]}){const{tables:e}=n,t=new Set(e),r={timeouts:{},queue:new Set,scheduleSync(i){this.timeouts[i]&&clearTimeout(this.timeouts[i]),this.queue.add(i),this.timeouts[i]=setTimeout(()=>{this.processSyncQueue()},2e3)},processSyncQueue(){var i;this.queue.size!==0&&((i=window.authContext)!=null&&i.user&&!window.authContext.user.isAnonymous&&window.authContext.syncData(),this.queue.clear(),Object.keys(this.timeouts).forEach(a=>{clearTimeout(this.timeouts[a]),delete this.timeouts[a]}))}};return{stack:"dbcore",name:"syncMiddleware",create(i){return{...i,table(a){const u=i.table(a);return t.has(a)?{...u,mutate:async h=>{const f=await u.mutate(h);return["put","add","delete","deleteRange","update"].includes(h.type)&&r.scheduleSync(a),f}}:u}}}}}var gi={exports:{}},ag=gi.exports,zu;function ug(){return zu||(zu=1,function(n,e){(function(t,r){n.exports=r()})(ag,function(){var t=function(s,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,c){l.__proto__=c}||function(l,c){for(var d in c)Object.prototype.hasOwnProperty.call(c,d)&&(l[d]=c[d])})(s,o)},r=function(){return(r=Object.assign||function(s){for(var o,l=1,c=arguments.length;l<c;l++)for(var d in o=arguments[l])Object.prototype.hasOwnProperty.call(o,d)&&(s[d]=o[d]);return s}).apply(this,arguments)};function i(s,o,l){for(var c,d=0,m=o.length;d<m;d++)!c&&d in o||((c=c||Array.prototype.slice.call(o,0,d))[d]=o[d]);return s.concat(c||Array.prototype.slice.call(o))}var a=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:ol,u=Object.keys,h=Array.isArray;function f(s,o){return typeof o!="object"||u(o).forEach(function(l){s[l]=o[l]}),s}typeof Promise>"u"||a.Promise||(a.Promise=Promise);var p=Object.getPrototypeOf,y={}.hasOwnProperty;function v(s,o){return y.call(s,o)}function I(s,o){typeof o=="function"&&(o=o(p(s))),(typeof Reflect>"u"?u:Reflect.ownKeys)(o).forEach(function(l){B(s,l,o[l])})}var M=Object.defineProperty;function B(s,o,l,c){M(s,o,f(l&&v(l,"get")&&typeof l.get=="function"?{get:l.get,set:l.set,configurable:!0}:{value:l,configurable:!0,writable:!0},c))}function ue(s){return{from:function(o){return s.prototype=Object.create(o.prototype),B(s.prototype,"constructor",s),{extend:I.bind(null,s.prototype)}}}}var Z=Object.getOwnPropertyDescriptor,de=[].slice;function _e(s,o,l){return de.call(s,o,l)}function ce(s,o){return o(s)}function Ae(s){if(!s)throw new Error("Assertion Failed")}function le(s){a.setImmediate?setImmediate(s):setTimeout(s,0)}function P(s,o){if(typeof o=="string"&&v(s,o))return s[o];if(!o)return s;if(typeof o!="string"){for(var l=[],c=0,d=o.length;c<d;++c){var m=P(s,o[c]);l.push(m)}return l}var _=o.indexOf(".");if(_!==-1){var g=s[o.substr(0,_)];return g==null?void 0:P(g,o.substr(_+1))}}function $(s,o,l){if(s&&o!==void 0&&!("isFrozen"in Object&&Object.isFrozen(s)))if(typeof o!="string"&&"length"in o){Ae(typeof l!="string"&&"length"in l);for(var c=0,d=o.length;c<d;++c)$(s,o[c],l[c])}else{var m,_,g=o.indexOf(".");g!==-1?(m=o.substr(0,g),(_=o.substr(g+1))===""?l===void 0?h(s)&&!isNaN(parseInt(m))?s.splice(m,1):delete s[m]:s[m]=l:$(g=!(g=s[m])||!v(s,m)?s[m]={}:g,_,l)):l===void 0?h(s)&&!isNaN(parseInt(o))?s.splice(o,1):delete s[o]:s[o]=l}}function ne(s){var o,l={};for(o in s)v(s,o)&&(l[o]=s[o]);return l}var H=[].concat;function ee(s){return H.apply([],s)}var Zt="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(ee([8,16,32,64].map(function(s){return["Int","Uint","Float"].map(function(o){return o+s+"Array"})}))).filter(function(s){return a[s]}),L=new Set(Zt.map(function(s){return a[s]})),fe=null;function F(s){return fe=new WeakMap,s=function o(l){if(!l||typeof l!="object")return l;var c=fe.get(l);if(c)return c;if(h(l)){c=[],fe.set(l,c);for(var d=0,m=l.length;d<m;++d)c.push(o(l[d]))}else if(L.has(l.constructor))c=l;else{var _,g=p(l);for(_ in c=g===Object.prototype?{}:Object.create(g),fe.set(l,c),l)v(l,_)&&(c[_]=o(l[_]))}return c}(s),fe=null,s}var V={}.toString;function j(s){return V.call(s).slice(8,-1)}var U=typeof Symbol<"u"?Symbol.iterator:"@@iterator",re=typeof U=="symbol"?function(s){var o;return s!=null&&(o=s[U])&&o.apply(s)}:function(){return null};function Y(s,o){return o=s.indexOf(o),0<=o&&s.splice(o,1),0<=o}var z={};function oe(s){var o,l,c,d;if(arguments.length===1){if(h(s))return s.slice();if(this===z&&typeof s=="string")return[s];if(d=re(s)){for(l=[];!(c=d.next()).done;)l.push(c.value);return l}if(s==null)return[s];if(typeof(o=s.length)!="number")return[s];for(l=new Array(o);o--;)l[o]=s[o];return l}for(o=arguments.length,l=new Array(o);o--;)l[o]=arguments[o];return l}var pe=typeof Symbol<"u"?function(s){return s[Symbol.toStringTag]==="AsyncFunction"}:function(){return!1},Jn=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],gt=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(Jn),Ie={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function Se(s,o){this.name=s,this.message=o}function Ne(s,o){return s+". Errors: "+Object.keys(o).map(function(l){return o[l].toString()}).filter(function(l,c,d){return d.indexOf(l)===c}).join(`
`)}function Fe(s,o,l,c){this.failures=o,this.failedKeys=c,this.successCount=l,this.message=Ne(s,o)}function st(s,o){this.name="BulkError",this.failures=Object.keys(o).map(function(l){return o[l]}),this.failuresByPos=o,this.message=Ne(s,this.failures)}ue(Se).from(Error).extend({toString:function(){return this.name+": "+this.message}}),ue(Fe).from(Se),ue(st).from(Se);var ft=gt.reduce(function(s,o){return s[o]=o+"Error",s},{}),At=Se,ae=gt.reduce(function(s,o){var l=o+"Error";function c(d,m){this.name=l,d?typeof d=="string"?(this.message="".concat(d).concat(m?`
 `+m:""),this.inner=m||null):typeof d=="object"&&(this.message="".concat(d.name," ").concat(d.message),this.inner=d):(this.message=Ie[o]||l,this.inner=null)}return ue(c).from(At),s[o]=c,s},{});ae.Syntax=SyntaxError,ae.Type=TypeError,ae.Range=RangeError;var Ke=Jn.reduce(function(s,o){return s[o+"Error"]=ae[o],s},{}),Ze=gt.reduce(function(s,o){return["Syntax","Type","Range"].indexOf(o)===-1&&(s[o+"Error"]=ae[o]),s},{});function we(){}function ut(s){return s}function xn(s,o){return s==null||s===ut?o:function(l){return o(s(l))}}function _t(s,o){return function(){s.apply(this,arguments),o.apply(this,arguments)}}function Hn(s,o){return s===we?o:function(){var l=s.apply(this,arguments);l!==void 0&&(arguments[0]=l);var c=this.onsuccess,d=this.onerror;this.onsuccess=null,this.onerror=null;var m=o.apply(this,arguments);return c&&(this.onsuccess=this.onsuccess?_t(c,this.onsuccess):c),d&&(this.onerror=this.onerror?_t(d,this.onerror):d),m!==void 0?m:l}}function zn(s,o){return s===we?o:function(){s.apply(this,arguments);var l=this.onsuccess,c=this.onerror;this.onsuccess=this.onerror=null,o.apply(this,arguments),l&&(this.onsuccess=this.onsuccess?_t(l,this.onsuccess):l),c&&(this.onerror=this.onerror?_t(c,this.onerror):c)}}function Gn(s,o){return s===we?o:function(l){var c=s.apply(this,arguments);f(l,c);var d=this.onsuccess,m=this.onerror;return this.onsuccess=null,this.onerror=null,l=o.apply(this,arguments),d&&(this.onsuccess=this.onsuccess?_t(d,this.onsuccess):d),m&&(this.onerror=this.onerror?_t(m,this.onerror):m),c===void 0?l===void 0?void 0:l:f(c,l)}}function Qn(s,o){return s===we?o:function(){return o.apply(this,arguments)!==!1&&s.apply(this,arguments)}}function Lr(s,o){return s===we?o:function(){var l=s.apply(this,arguments);if(l&&typeof l.then=="function"){for(var c=this,d=arguments.length,m=new Array(d);d--;)m[d]=arguments[d];return l.then(function(){return o.apply(c,m)})}return o.apply(this,arguments)}}Ze.ModifyError=Fe,Ze.DexieError=Se,Ze.BulkError=st;var Tt=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function ca(s){Tt=s}var Xn={},ha=100,Zt=typeof Promise>"u"?[]:function(){var s=Promise.resolve();if(typeof crypto>"u"||!crypto.subtle)return[s,p(s),s];var o=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[o,p(o),s]}(),Jn=Zt[0],gt=Zt[1],Zt=Zt[2],gt=gt&&gt.then,en=Jn&&Jn.constructor,is=!!Zt,Zn=function(s,o){er.push([s,o]),$r&&(queueMicrotask(Jc),$r=!1)},ss=!0,$r=!0,tn=[],Fr=[],os=ut,jt={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:we,pgp:!1,env:{},finalize:we},he=jt,er=[],nn=0,jr=[];function ie(s){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this._lib=!1;var o=this._PSD=he;if(typeof s!="function"){if(s!==Xn)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(this._state===!1&&us(this,this._value))}this._state=null,this._value=null,++o.ref,function l(c,d){try{d(function(m){if(c._state===null){if(m===c)throw new TypeError("A promise cannot be resolved with itself.");var _=c._lib&&Cn();m&&typeof m.then=="function"?l(c,function(g,b){m instanceof ie?m._then(g,b):m.then(g,b)}):(c._state=!0,c._value=m,da(c)),_&&Tn()}},us.bind(null,c))}catch(m){us(c,m)}}(this,s)}var as={get:function(){var s=he,o=Vr;function l(c,d){var m=this,_=!s.global&&(s!==he||o!==Vr),g=_&&!qt(),b=new ie(function(x,S){ls(m,new fa(ma(c,s,_,g),ma(d,s,_,g),x,S,s))});return this._consoleTask&&(b._consoleTask=this._consoleTask),b}return l.prototype=Xn,l},set:function(s){B(this,"then",s&&s.prototype===Xn?as:{get:function(){return s},set:as.set})}};function fa(s,o,l,c,d){this.onFulfilled=typeof s=="function"?s:null,this.onRejected=typeof o=="function"?o:null,this.resolve=l,this.reject=c,this.psd=d}function us(s,o){var l,c;Fr.push(o),s._state===null&&(l=s._lib&&Cn(),o=os(o),s._state=!1,s._value=o,c=s,tn.some(function(d){return d._value===c._value})||tn.push(c),da(s),l&&Tn())}function da(s){var o=s._listeners;s._listeners=[];for(var l=0,c=o.length;l<c;++l)ls(s,o[l]);var d=s._PSD;--d.ref||d.finalize(),nn===0&&(++nn,Zn(function(){--nn==0&&cs()},[]))}function ls(s,o){if(s._state!==null){var l=s._state?o.onFulfilled:o.onRejected;if(l===null)return(s._state?o.resolve:o.reject)(s._value);++o.psd.ref,++nn,Zn(Xc,[l,s,o])}else s._listeners.push(o)}function Xc(s,o,l){try{var c,d=o._value;!o._state&&Fr.length&&(Fr=[]),c=Tt&&o._consoleTask?o._consoleTask.run(function(){return s(d)}):s(d),o._state||Fr.indexOf(d)!==-1||function(m){for(var _=tn.length;_;)if(tn[--_]._value===m._value)return tn.splice(_,1)}(o),l.resolve(c)}catch(m){l.reject(m)}finally{--nn==0&&cs(),--l.psd.ref||l.psd.finalize()}}function Jc(){rn(jt,function(){Cn()&&Tn()})}function Cn(){var s=ss;return $r=ss=!1,s}function Tn(){var s,o,l;do for(;0<er.length;)for(s=er,er=[],l=s.length,o=0;o<l;++o){var c=s[o];c[0].apply(null,c[1])}while(0<er.length);$r=ss=!0}function cs(){var s=tn;tn=[],s.forEach(function(c){c._PSD.onunhandled.call(null,c._value,c)});for(var o=jr.slice(0),l=o.length;l;)o[--l]()}function Br(s){return new ie(Xn,!1,s)}function je(s,o){var l=he;return function(){var c=Cn(),d=he;try{return Ut(l,!0),s.apply(this,arguments)}catch(m){o&&o(m)}finally{Ut(d,!1),c&&Tn()}}}I(ie.prototype,{then:as,_then:function(s,o){ls(this,new fa(null,null,s,o,he))},catch:function(s){if(arguments.length===1)return this.then(null,s);var o=s,l=arguments[1];return typeof o=="function"?this.then(null,function(c){return(c instanceof o?l:Br)(c)}):this.then(null,function(c){return(c&&c.name===o?l:Br)(c)})},finally:function(s){return this.then(function(o){return ie.resolve(s()).then(function(){return o})},function(o){return ie.resolve(s()).then(function(){return Br(o)})})},timeout:function(s,o){var l=this;return s<1/0?new ie(function(c,d){var m=setTimeout(function(){return d(new ae.Timeout(o))},s);l.then(c,d).finally(clearTimeout.bind(null,m))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&B(ie.prototype,Symbol.toStringTag,"Dexie.Promise"),jt.env=pa(),I(ie,{all:function(){var s=oe.apply(null,arguments).map(Kr);return new ie(function(o,l){s.length===0&&o([]);var c=s.length;s.forEach(function(d,m){return ie.resolve(d).then(function(_){s[m]=_,--c||o(s)},l)})})},resolve:function(s){return s instanceof ie?s:s&&typeof s.then=="function"?new ie(function(o,l){s.then(o,l)}):new ie(Xn,!0,s)},reject:Br,race:function(){var s=oe.apply(null,arguments).map(Kr);return new ie(function(o,l){s.map(function(c){return ie.resolve(c).then(o,l)})})},PSD:{get:function(){return he},set:function(s){return he=s}},totalEchoes:{get:function(){return Vr}},newPSD:Bt,usePSD:rn,scheduler:{get:function(){return Zn},set:function(s){Zn=s}},rejectionMapper:{get:function(){return os},set:function(s){os=s}},follow:function(s,o){return new ie(function(l,c){return Bt(function(d,m){var _=he;_.unhandleds=[],_.onunhandled=m,_.finalize=_t(function(){var g,b=this;g=function(){b.unhandleds.length===0?d():m(b.unhandleds[0])},jr.push(function x(){g(),jr.splice(jr.indexOf(x),1)}),++nn,Zn(function(){--nn==0&&cs()},[])},_.finalize),s()},o,l,c)})}}),en&&(en.allSettled&&B(ie,"allSettled",function(){var s=oe.apply(null,arguments).map(Kr);return new ie(function(o){s.length===0&&o([]);var l=s.length,c=new Array(l);s.forEach(function(d,m){return ie.resolve(d).then(function(_){return c[m]={status:"fulfilled",value:_}},function(_){return c[m]={status:"rejected",reason:_}}).then(function(){return--l||o(c)})})})}),en.any&&typeof AggregateError<"u"&&B(ie,"any",function(){var s=oe.apply(null,arguments).map(Kr);return new ie(function(o,l){s.length===0&&l(new AggregateError([]));var c=s.length,d=new Array(c);s.forEach(function(m,_){return ie.resolve(m).then(function(g){return o(g)},function(g){d[_]=g,--c||l(new AggregateError(d))})})})}),en.withResolvers&&(ie.withResolvers=en.withResolvers));var Ye={awaits:0,echoes:0,id:0},Zc=0,qr=[],Ur=0,Vr=0,eh=0;function Bt(s,o,l,c){var d=he,m=Object.create(d);return m.parent=d,m.ref=0,m.global=!1,m.id=++eh,jt.env,m.env=is?{Promise:ie,PromiseProp:{value:ie,configurable:!0,writable:!0},all:ie.all,race:ie.race,allSettled:ie.allSettled,any:ie.any,resolve:ie.resolve,reject:ie.reject}:{},o&&f(m,o),++d.ref,m.finalize=function(){--this.parent.ref||this.parent.finalize()},c=rn(m,s,l,c),m.ref===0&&m.finalize(),c}function Sn(){return Ye.id||(Ye.id=++Zc),++Ye.awaits,Ye.echoes+=ha,Ye.id}function qt(){return!!Ye.awaits&&(--Ye.awaits==0&&(Ye.id=0),Ye.echoes=Ye.awaits*ha,!0)}function Kr(s){return Ye.echoes&&s&&s.constructor===en?(Sn(),s.then(function(o){return qt(),o},function(o){return qt(),qe(o)})):s}function th(){var s=qr[qr.length-1];qr.pop(),Ut(s,!1)}function Ut(s,o){var l,c=he;(o?!Ye.echoes||Ur++&&s===he:!Ur||--Ur&&s===he)||queueMicrotask(o?(function(d){++Vr,Ye.echoes&&--Ye.echoes!=0||(Ye.echoes=Ye.awaits=Ye.id=0),qr.push(he),Ut(d,!0)}).bind(null,s):th),s!==he&&(he=s,c===jt&&(jt.env=pa()),is&&(l=jt.env.Promise,o=s.env,(c.global||s.global)&&(Object.defineProperty(a,"Promise",o.PromiseProp),l.all=o.all,l.race=o.race,l.resolve=o.resolve,l.reject=o.reject,o.allSettled&&(l.allSettled=o.allSettled),o.any&&(l.any=o.any))))}function pa(){var s=a.Promise;return is?{Promise:s,PromiseProp:Object.getOwnPropertyDescriptor(a,"Promise"),all:s.all,race:s.race,allSettled:s.allSettled,any:s.any,resolve:s.resolve,reject:s.reject}:{}}function rn(s,o,l,c,d){var m=he;try{return Ut(s,!0),o(l,c,d)}finally{Ut(m,!1)}}function ma(s,o,l,c){return typeof s!="function"?s:function(){var d=he;l&&Sn(),Ut(o,!0);try{return s.apply(this,arguments)}finally{Ut(d,!1),c&&queueMicrotask(qt)}}}function hs(s){Promise===en&&Ye.echoes===0?Ur===0?s():enqueueNativeMicroTask(s):setTimeout(s,0)}(""+gt).indexOf("[native code]")===-1&&(Sn=qt=we);var qe=ie.reject,sn="",Pt="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",_a="String expected.",In=[],Wr="__dbnames",fs="readonly",ds="readwrite";function on(s,o){return s?o?function(){return s.apply(this,arguments)&&o.apply(this,arguments)}:s:o}var ga={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function Yr(s){return typeof s!="string"||/\./.test(s)?function(o){return o}:function(o){return o[s]===void 0&&s in o&&delete(o=F(o))[s],o}}function ya(){throw ae.Type()}function Te(s,o){try{var l=va(s),c=va(o);if(l!==c)return l==="Array"?1:c==="Array"?-1:l==="binary"?1:c==="binary"?-1:l==="string"?1:c==="string"?-1:l==="Date"?1:c!=="Date"?NaN:-1;switch(l){case"number":case"Date":case"string":return o<s?1:s<o?-1:0;case"binary":return function(d,m){for(var _=d.length,g=m.length,b=_<g?_:g,x=0;x<b;++x)if(d[x]!==m[x])return d[x]<m[x]?-1:1;return _===g?0:_<g?-1:1}(wa(s),wa(o));case"Array":return function(d,m){for(var _=d.length,g=m.length,b=_<g?_:g,x=0;x<b;++x){var S=Te(d[x],m[x]);if(S!==0)return S}return _===g?0:_<g?-1:1}(s,o)}}catch{}return NaN}function va(s){var o=typeof s;return o!="object"?o:ArrayBuffer.isView(s)?"binary":(s=j(s),s==="ArrayBuffer"?"binary":s)}function wa(s){return s instanceof Uint8Array?s:ArrayBuffer.isView(s)?new Uint8Array(s.buffer,s.byteOffset,s.byteLength):new Uint8Array(s)}var ba=(Le.prototype._trans=function(s,o,l){var c=this._tx||he.trans,d=this.name,m=Tt&&typeof console<"u"&&console.createTask&&console.createTask("Dexie: ".concat(s==="readonly"?"read":"write"," ").concat(this.name));function _(x,S,w){if(!w.schema[d])throw new ae.NotFound("Table "+d+" not part of transaction");return o(w.idbtrans,w)}var g=Cn();try{var b=c&&c.db._novip===this.db._novip?c===he.trans?c._promise(s,_,l):Bt(function(){return c._promise(s,_,l)},{trans:c,transless:he.transless||he}):function x(S,w,A,E){if(S.idbdb&&(S._state.openComplete||he.letThrough||S._vip)){var T=S._createTransaction(w,A,S._dbSchema);try{T.create(),S._state.PR1398_maxLoop=3}catch(k){return k.name===ft.InvalidState&&S.isOpen()&&0<--S._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),S.close({disableAutoOpen:!1}),S.open().then(function(){return x(S,w,A,E)})):qe(k)}return T._promise(w,function(k,C){return Bt(function(){return he.trans=T,E(k,C,T)})}).then(function(k){if(w==="readwrite")try{T.idbtrans.commit()}catch{}return w==="readonly"?k:T._completion.then(function(){return k})})}if(S._state.openComplete)return qe(new ae.DatabaseClosed(S._state.dbOpenError));if(!S._state.isBeingOpened){if(!S._state.autoOpen)return qe(new ae.DatabaseClosed);S.open().catch(we)}return S._state.dbReadyPromise.then(function(){return x(S,w,A,E)})}(this.db,s,[this.name],_);return m&&(b._consoleTask=m,b=b.catch(function(x){return console.trace(x),qe(x)})),b}finally{g&&Tn()}},Le.prototype.get=function(s,o){var l=this;return s&&s.constructor===Object?this.where(s).first(o):s==null?qe(new ae.Type("Invalid argument to Table.get()")):this._trans("readonly",function(c){return l.core.get({trans:c,key:s}).then(function(d){return l.hook.reading.fire(d)})}).then(o)},Le.prototype.where=function(s){if(typeof s=="string")return new this.db.WhereClause(this,s);if(h(s))return new this.db.WhereClause(this,"[".concat(s.join("+"),"]"));var o=u(s);if(o.length===1)return this.where(o[0]).equals(s[o[0]]);var l=this.schema.indexes.concat(this.schema.primKey).filter(function(g){if(g.compound&&o.every(function(x){return 0<=g.keyPath.indexOf(x)})){for(var b=0;b<o.length;++b)if(o.indexOf(g.keyPath[b])===-1)return!1;return!0}return!1}).sort(function(g,b){return g.keyPath.length-b.keyPath.length})[0];if(l&&this.db._maxKey!==sn){var m=l.keyPath.slice(0,o.length);return this.where(m).equals(m.map(function(b){return s[b]}))}!l&&Tt&&console.warn("The query ".concat(JSON.stringify(s)," on ").concat(this.name," would benefit from a ")+"compound index [".concat(o.join("+"),"]"));var c=this.schema.idxByName;function d(g,b){return Te(g,b)===0}var _=o.reduce(function(w,b){var x=w[0],S=w[1],w=c[b],A=s[b];return[x||w,x||!w?on(S,w&&w.multi?function(E){return E=P(E,b),h(E)&&E.some(function(T){return d(A,T)})}:function(E){return d(A,P(E,b))}):S]},[null,null]),m=_[0],_=_[1];return m?this.where(m.name).equals(s[m.keyPath]).filter(_):l?this.filter(_):this.where(o).equals("")},Le.prototype.filter=function(s){return this.toCollection().and(s)},Le.prototype.count=function(s){return this.toCollection().count(s)},Le.prototype.offset=function(s){return this.toCollection().offset(s)},Le.prototype.limit=function(s){return this.toCollection().limit(s)},Le.prototype.each=function(s){return this.toCollection().each(s)},Le.prototype.toArray=function(s){return this.toCollection().toArray(s)},Le.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},Le.prototype.orderBy=function(s){return new this.db.Collection(new this.db.WhereClause(this,h(s)?"[".concat(s.join("+"),"]"):s))},Le.prototype.reverse=function(){return this.toCollection().reverse()},Le.prototype.mapToClass=function(s){var o,l=this.db,c=this.name;function d(){return o!==null&&o.apply(this,arguments)||this}(this.schema.mappedClass=s).prototype instanceof ya&&(function(b,x){if(typeof x!="function"&&x!==null)throw new TypeError("Class extends value "+String(x)+" is not a constructor or null");function S(){this.constructor=b}t(b,x),b.prototype=x===null?Object.create(x):(S.prototype=x.prototype,new S)}(d,o=s),Object.defineProperty(d.prototype,"db",{get:function(){return l},enumerable:!1,configurable:!0}),d.prototype.table=function(){return c},s=d);for(var m=new Set,_=s.prototype;_;_=p(_))Object.getOwnPropertyNames(_).forEach(function(b){return m.add(b)});function g(b){if(!b)return b;var x,S=Object.create(s.prototype);for(x in b)if(!m.has(x))try{S[x]=b[x]}catch{}return S}return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=g,this.hook("reading",g),s},Le.prototype.defineClass=function(){return this.mapToClass(function(s){f(this,s)})},Le.prototype.add=function(s,o){var l=this,c=this.schema.primKey,d=c.auto,m=c.keyPath,_=s;return m&&d&&(_=Yr(m)(s)),this._trans("readwrite",function(g){return l.core.mutate({trans:g,type:"add",keys:o!=null?[o]:null,values:[_]})}).then(function(g){return g.numFailures?ie.reject(g.failures[0]):g.lastResult}).then(function(g){if(m)try{$(s,m,g)}catch{}return g})},Le.prototype.update=function(s,o){return typeof s!="object"||h(s)?this.where(":id").equals(s).modify(o):(s=P(s,this.schema.primKey.keyPath),s===void 0?qe(new ae.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(s).modify(o))},Le.prototype.put=function(s,o){var l=this,c=this.schema.primKey,d=c.auto,m=c.keyPath,_=s;return m&&d&&(_=Yr(m)(s)),this._trans("readwrite",function(g){return l.core.mutate({trans:g,type:"put",values:[_],keys:o!=null?[o]:null})}).then(function(g){return g.numFailures?ie.reject(g.failures[0]):g.lastResult}).then(function(g){if(m)try{$(s,m,g)}catch{}return g})},Le.prototype.delete=function(s){var o=this;return this._trans("readwrite",function(l){return o.core.mutate({trans:l,type:"delete",keys:[s]})}).then(function(l){return l.numFailures?ie.reject(l.failures[0]):void 0})},Le.prototype.clear=function(){var s=this;return this._trans("readwrite",function(o){return s.core.mutate({trans:o,type:"deleteRange",range:ga})}).then(function(o){return o.numFailures?ie.reject(o.failures[0]):void 0})},Le.prototype.bulkGet=function(s){var o=this;return this._trans("readonly",function(l){return o.core.getMany({keys:s,trans:l}).then(function(c){return c.map(function(d){return o.hook.reading.fire(d)})})})},Le.prototype.bulkAdd=function(s,o,l){var c=this,d=Array.isArray(o)?o:void 0,m=(l=l||(d?void 0:o))?l.allKeys:void 0;return this._trans("readwrite",function(_){var x=c.schema.primKey,g=x.auto,x=x.keyPath;if(x&&d)throw new ae.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(d&&d.length!==s.length)throw new ae.InvalidArgument("Arguments objects and keys must have the same length");var b=s.length,x=x&&g?s.map(Yr(x)):s;return c.core.mutate({trans:_,type:"add",keys:d,values:x,wantResults:m}).then(function(T){var w=T.numFailures,A=T.results,E=T.lastResult,T=T.failures;if(w===0)return m?A:E;throw new st("".concat(c.name,".bulkAdd(): ").concat(w," of ").concat(b," operations failed"),T)})})},Le.prototype.bulkPut=function(s,o,l){var c=this,d=Array.isArray(o)?o:void 0,m=(l=l||(d?void 0:o))?l.allKeys:void 0;return this._trans("readwrite",function(_){var x=c.schema.primKey,g=x.auto,x=x.keyPath;if(x&&d)throw new ae.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(d&&d.length!==s.length)throw new ae.InvalidArgument("Arguments objects and keys must have the same length");var b=s.length,x=x&&g?s.map(Yr(x)):s;return c.core.mutate({trans:_,type:"put",keys:d,values:x,wantResults:m}).then(function(T){var w=T.numFailures,A=T.results,E=T.lastResult,T=T.failures;if(w===0)return m?A:E;throw new st("".concat(c.name,".bulkPut(): ").concat(w," of ").concat(b," operations failed"),T)})})},Le.prototype.bulkUpdate=function(s){var o=this,l=this.core,c=s.map(function(_){return _.key}),d=s.map(function(_){return _.changes}),m=[];return this._trans("readwrite",function(_){return l.getMany({trans:_,keys:c,cache:"clone"}).then(function(g){var b=[],x=[];s.forEach(function(w,A){var E=w.key,T=w.changes,k=g[A];if(k){for(var C=0,O=Object.keys(T);C<O.length;C++){var R=O[C],D=T[R];if(R===o.schema.primKey.keyPath){if(Te(D,E)!==0)throw new ae.Constraint("Cannot update primary key in bulkUpdate()")}else $(k,R,D)}m.push(A),b.push(E),x.push(k)}});var S=b.length;return l.mutate({trans:_,type:"put",keys:b,values:x,updates:{keys:c,changeSpecs:d}}).then(function(w){var A=w.numFailures,E=w.failures;if(A===0)return S;for(var T=0,k=Object.keys(E);T<k.length;T++){var C,O=k[T],R=m[Number(O)];R!=null&&(C=E[O],delete E[O],E[R]=C)}throw new st("".concat(o.name,".bulkUpdate(): ").concat(A," of ").concat(S," operations failed"),E)})})})},Le.prototype.bulkDelete=function(s){var o=this,l=s.length;return this._trans("readwrite",function(c){return o.core.mutate({trans:c,type:"delete",keys:s})}).then(function(_){var d=_.numFailures,m=_.lastResult,_=_.failures;if(d===0)return m;throw new st("".concat(o.name,".bulkDelete(): ").concat(d," of ").concat(l," operations failed"),_)})},Le);function Le(){}function tr(s){function o(_,g){if(g){for(var b=arguments.length,x=new Array(b-1);--b;)x[b-1]=arguments[b];return l[_].subscribe.apply(null,x),s}if(typeof _=="string")return l[_]}var l={};o.addEventType=m;for(var c=1,d=arguments.length;c<d;++c)m(arguments[c]);return o;function m(_,g,b){if(typeof _!="object"){var x;g=g||Qn;var S={subscribers:[],fire:b=b||we,subscribe:function(w){S.subscribers.indexOf(w)===-1&&(S.subscribers.push(w),S.fire=g(S.fire,w))},unsubscribe:function(w){S.subscribers=S.subscribers.filter(function(A){return A!==w}),S.fire=S.subscribers.reduce(g,b)}};return l[_]=o[_]=S}u(x=_).forEach(function(w){var A=x[w];if(h(A))m(w,x[w][0],x[w][1]);else{if(A!=="asap")throw new ae.InvalidArgument("Invalid event config");var E=m(w,ut,function(){for(var T=arguments.length,k=new Array(T);T--;)k[T]=arguments[T];E.subscribers.forEach(function(C){le(function(){C.apply(null,k)})})})}})}}function nr(s,o){return ue(o).from({prototype:s}),o}function kn(s,o){return!(s.filter||s.algorithm||s.or)&&(o?s.justLimit:!s.replayFilter)}function ps(s,o){s.filter=on(s.filter,o)}function ms(s,o,l){var c=s.replayFilter;s.replayFilter=c?function(){return on(c(),o())}:o,s.justLimit=l&&!c}function Hr(s,o){if(s.isPrimKey)return o.primaryKey;var l=o.getIndexByKeyPath(s.index);if(!l)throw new ae.Schema("KeyPath "+s.index+" on object store "+o.name+" is not indexed");return l}function Ea(s,o,l){var c=Hr(s,o.schema);return o.openCursor({trans:l,values:!s.keysOnly,reverse:s.dir==="prev",unique:!!s.unique,query:{index:c,range:s.range}})}function zr(s,o,l,c){var d=s.replayFilter?on(s.filter,s.replayFilter()):s.filter;if(s.or){var m={},_=function(g,b,x){var S,w;d&&!d(b,x,function(A){return b.stop(A)},function(A){return b.fail(A)})||((w=""+(S=b.primaryKey))=="[object ArrayBuffer]"&&(w=""+new Uint8Array(S)),v(m,w)||(m[w]=!0,o(g,b,x)))};return Promise.all([s.or._iterate(_,l),xa(Ea(s,c,l),s.algorithm,_,!s.keysOnly&&s.valueMapper)])}return xa(Ea(s,c,l),on(s.algorithm,d),o,!s.keysOnly&&s.valueMapper)}function xa(s,o,l,c){var d=je(c?function(m,_,g){return l(c(m),_,g)}:l);return s.then(function(m){if(m)return m.start(function(){var _=function(){return m.continue()};o&&!o(m,function(g){return _=g},function(g){m.stop(g),_=we},function(g){m.fail(g),_=we})||d(m.value,m,function(g){return _=g}),_()})})}var rr=(Ca.prototype.execute=function(s){var o=this["@@propmod"];if(o.add!==void 0){var l=o.add;if(h(l))return i(i([],h(s)?s:[],!0),l).sort();if(typeof l=="number")return(Number(s)||0)+l;if(typeof l=="bigint")try{return BigInt(s)+l}catch{return BigInt(0)+l}throw new TypeError("Invalid term ".concat(l))}if(o.remove!==void 0){var c=o.remove;if(h(c))return h(s)?s.filter(function(d){return!c.includes(d)}).sort():[];if(typeof c=="number")return Number(s)-c;if(typeof c=="bigint")try{return BigInt(s)-c}catch{return BigInt(0)-c}throw new TypeError("Invalid subtrahend ".concat(c))}return l=(l=o.replacePrefix)===null||l===void 0?void 0:l[0],l&&typeof s=="string"&&s.startsWith(l)?o.replacePrefix[1]+s.substring(l.length):s},Ca);function Ca(s){this["@@propmod"]=s}var nh=(Pe.prototype._read=function(s,o){var l=this._ctx;return l.error?l.table._trans(null,qe.bind(null,l.error)):l.table._trans("readonly",s).then(o)},Pe.prototype._write=function(s){var o=this._ctx;return o.error?o.table._trans(null,qe.bind(null,o.error)):o.table._trans("readwrite",s,"locked")},Pe.prototype._addAlgorithm=function(s){var o=this._ctx;o.algorithm=on(o.algorithm,s)},Pe.prototype._iterate=function(s,o){return zr(this._ctx,s,o,this._ctx.table.core)},Pe.prototype.clone=function(s){var o=Object.create(this.constructor.prototype),l=Object.create(this._ctx);return s&&f(l,s),o._ctx=l,o},Pe.prototype.raw=function(){return this._ctx.valueMapper=null,this},Pe.prototype.each=function(s){var o=this._ctx;return this._read(function(l){return zr(o,s,l,o.table.core)})},Pe.prototype.count=function(s){var o=this;return this._read(function(l){var c=o._ctx,d=c.table.core;if(kn(c,!0))return d.count({trans:l,query:{index:Hr(c,d.schema),range:c.range}}).then(function(_){return Math.min(_,c.limit)});var m=0;return zr(c,function(){return++m,!1},l,d).then(function(){return m})}).then(s)},Pe.prototype.sortBy=function(s,o){var l=s.split(".").reverse(),c=l[0],d=l.length-1;function m(b,x){return x?m(b[l[x]],x-1):b[c]}var _=this._ctx.dir==="next"?1:-1;function g(b,x){return Te(m(b,d),m(x,d))*_}return this.toArray(function(b){return b.sort(g)}).then(o)},Pe.prototype.toArray=function(s){var o=this;return this._read(function(l){var c=o._ctx;if(c.dir==="next"&&kn(c,!0)&&0<c.limit){var d=c.valueMapper,m=Hr(c,c.table.core.schema);return c.table.core.query({trans:l,limit:c.limit,values:!0,query:{index:m,range:c.range}}).then(function(g){return g=g.result,d?g.map(d):g})}var _=[];return zr(c,function(g){return _.push(g)},l,c.table.core).then(function(){return _})},s)},Pe.prototype.offset=function(s){var o=this._ctx;return s<=0||(o.offset+=s,kn(o)?ms(o,function(){var l=s;return function(c,d){return l===0||(l===1?--l:d(function(){c.advance(l),l=0}),!1)}}):ms(o,function(){var l=s;return function(){return--l<0}})),this},Pe.prototype.limit=function(s){return this._ctx.limit=Math.min(this._ctx.limit,s),ms(this._ctx,function(){var o=s;return function(l,c,d){return--o<=0&&c(d),0<=o}},!0),this},Pe.prototype.until=function(s,o){return ps(this._ctx,function(l,c,d){return!s(l.value)||(c(d),o)}),this},Pe.prototype.first=function(s){return this.limit(1).toArray(function(o){return o[0]}).then(s)},Pe.prototype.last=function(s){return this.reverse().first(s)},Pe.prototype.filter=function(s){var o;return ps(this._ctx,function(l){return s(l.value)}),(o=this._ctx).isMatch=on(o.isMatch,s),this},Pe.prototype.and=function(s){return this.filter(s)},Pe.prototype.or=function(s){return new this.db.WhereClause(this._ctx.table,s,this)},Pe.prototype.reverse=function(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},Pe.prototype.desc=function(){return this.reverse()},Pe.prototype.eachKey=function(s){var o=this._ctx;return o.keysOnly=!o.isMatch,this.each(function(l,c){s(c.key,c)})},Pe.prototype.eachUniqueKey=function(s){return this._ctx.unique="unique",this.eachKey(s)},Pe.prototype.eachPrimaryKey=function(s){var o=this._ctx;return o.keysOnly=!o.isMatch,this.each(function(l,c){s(c.primaryKey,c)})},Pe.prototype.keys=function(s){var o=this._ctx;o.keysOnly=!o.isMatch;var l=[];return this.each(function(c,d){l.push(d.key)}).then(function(){return l}).then(s)},Pe.prototype.primaryKeys=function(s){var o=this._ctx;if(o.dir==="next"&&kn(o,!0)&&0<o.limit)return this._read(function(c){var d=Hr(o,o.table.core.schema);return o.table.core.query({trans:c,values:!1,limit:o.limit,query:{index:d,range:o.range}})}).then(function(c){return c.result}).then(s);o.keysOnly=!o.isMatch;var l=[];return this.each(function(c,d){l.push(d.primaryKey)}).then(function(){return l}).then(s)},Pe.prototype.uniqueKeys=function(s){return this._ctx.unique="unique",this.keys(s)},Pe.prototype.firstKey=function(s){return this.limit(1).keys(function(o){return o[0]}).then(s)},Pe.prototype.lastKey=function(s){return this.reverse().firstKey(s)},Pe.prototype.distinct=function(){var s=this._ctx,s=s.index&&s.table.schema.idxByName[s.index];if(!s||!s.multi)return this;var o={};return ps(this._ctx,function(d){var c=d.primaryKey.toString(),d=v(o,c);return o[c]=!0,!d}),this},Pe.prototype.modify=function(s){var o=this,l=this._ctx;return this._write(function(c){var d,m,_;_=typeof s=="function"?s:(d=u(s),m=d.length,function(C){for(var O=!1,R=0;R<m;++R){var D=d[R],N=s[D],K=P(C,D);N instanceof rr?($(C,D,N.execute(K)),O=!0):K!==N&&($(C,D,N),O=!0)}return O});var g=l.table.core,w=g.schema.primaryKey,b=w.outbound,x=w.extractKey,S=200,w=o.db._options.modifyChunkSize;w&&(S=typeof w=="object"?w[g.name]||w["*"]||200:w);function A(C,D){var R=D.failures,D=D.numFailures;T+=C-D;for(var N=0,K=u(R);N<K.length;N++){var J=K[N];E.push(R[J])}}var E=[],T=0,k=[];return o.clone().primaryKeys().then(function(C){function O(D){var N=Math.min(S,C.length-D);return g.getMany({trans:c,keys:C.slice(D,D+N),cache:"immutable"}).then(function(K){for(var J=[],W=[],G=b?[]:null,te=[],X=0;X<N;++X){var se=K[X],ye={value:F(se),primKey:C[D+X]};_.call(ye,ye.value,ye)!==!1&&(ye.value==null?te.push(C[D+X]):b||Te(x(se),x(ye.value))===0?(W.push(ye.value),b&&G.push(C[D+X])):(te.push(C[D+X]),J.push(ye.value)))}return Promise.resolve(0<J.length&&g.mutate({trans:c,type:"add",values:J}).then(function(be){for(var Ee in be.failures)te.splice(parseInt(Ee),1);A(J.length,be)})).then(function(){return(0<W.length||R&&typeof s=="object")&&g.mutate({trans:c,type:"put",keys:G,values:W,criteria:R,changeSpec:typeof s!="function"&&s,isAdditionalChunk:0<D}).then(function(be){return A(W.length,be)})}).then(function(){return(0<te.length||R&&s===_s)&&g.mutate({trans:c,type:"delete",keys:te,criteria:R,isAdditionalChunk:0<D}).then(function(be){return A(te.length,be)})}).then(function(){return C.length>D+N&&O(D+S)})})}var R=kn(l)&&l.limit===1/0&&(typeof s!="function"||s===_s)&&{index:l.index,range:l.range};return O(0).then(function(){if(0<E.length)throw new Fe("Error modifying one or more objects",E,T,k);return C.length})})})},Pe.prototype.delete=function(){var s=this._ctx,o=s.range;return kn(s)&&(s.isPrimKey||o.type===3)?this._write(function(l){var c=s.table.core.schema.primaryKey,d=o;return s.table.core.count({trans:l,query:{index:c,range:d}}).then(function(m){return s.table.core.mutate({trans:l,type:"deleteRange",range:d}).then(function(_){var g=_.failures;if(_.lastResult,_.results,_=_.numFailures,_)throw new Fe("Could not delete some values",Object.keys(g).map(function(b){return g[b]}),m-_);return m-_})})}):this.modify(_s)},Pe);function Pe(){}var _s=function(s,o){return o.value=null};function rh(s,o){return s<o?-1:s===o?0:1}function ih(s,o){return o<s?-1:s===o?0:1}function dt(s,o,l){return s=s instanceof Sa?new s.Collection(s):s,s._ctx.error=new(l||TypeError)(o),s}function An(s){return new s.Collection(s,function(){return Ta("")}).limit(0)}function Gr(s,o,l,c){var d,m,_,g,b,x,S,w=l.length;if(!l.every(function(T){return typeof T=="string"}))return dt(s,_a);function A(T){d=T==="next"?function(C){return C.toUpperCase()}:function(C){return C.toLowerCase()},m=T==="next"?function(C){return C.toLowerCase()}:function(C){return C.toUpperCase()},_=T==="next"?rh:ih;var k=l.map(function(C){return{lower:m(C),upper:d(C)}}).sort(function(C,O){return _(C.lower,O.lower)});g=k.map(function(C){return C.upper}),b=k.map(function(C){return C.lower}),S=(x=T)==="next"?"":c}A("next"),s=new s.Collection(s,function(){return Vt(g[0],b[w-1]+c)}),s._ondirectionchange=function(T){A(T)};var E=0;return s._addAlgorithm(function(T,k,C){var O=T.key;if(typeof O!="string")return!1;var R=m(O);if(o(R,b,E))return!0;for(var D=null,N=E;N<w;++N){var K=function(J,W,G,te,X,se){for(var ye=Math.min(J.length,te.length),be=-1,Ee=0;Ee<ye;++Ee){var pt=W[Ee];if(pt!==te[Ee])return X(J[Ee],G[Ee])<0?J.substr(0,Ee)+G[Ee]+G.substr(Ee+1):X(J[Ee],te[Ee])<0?J.substr(0,Ee)+te[Ee]+G.substr(Ee+1):0<=be?J.substr(0,be)+W[be]+G.substr(be+1):null;X(J[Ee],pt)<0&&(be=Ee)}return ye<te.length&&se==="next"?J+G.substr(J.length):ye<J.length&&se==="prev"?J.substr(0,G.length):be<0?null:J.substr(0,be)+te[be]+G.substr(be+1)}(O,R,g[N],b[N],_,x);K===null&&D===null?E=N+1:(D===null||0<_(D,K))&&(D=K)}return k(D!==null?function(){T.continue(D+S)}:C),!1}),s}function Vt(s,o,l,c){return{type:2,lower:s,upper:o,lowerOpen:l,upperOpen:c}}function Ta(s){return{type:1,lower:s,upper:s}}var Sa=(Object.defineProperty(He.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),He.prototype.between=function(s,o,l,c){l=l!==!1,c=c===!0;try{return 0<this._cmp(s,o)||this._cmp(s,o)===0&&(l||c)&&(!l||!c)?An(this):new this.Collection(this,function(){return Vt(s,o,!l,!c)})}catch{return dt(this,Pt)}},He.prototype.equals=function(s){return s==null?dt(this,Pt):new this.Collection(this,function(){return Ta(s)})},He.prototype.above=function(s){return s==null?dt(this,Pt):new this.Collection(this,function(){return Vt(s,void 0,!0)})},He.prototype.aboveOrEqual=function(s){return s==null?dt(this,Pt):new this.Collection(this,function(){return Vt(s,void 0,!1)})},He.prototype.below=function(s){return s==null?dt(this,Pt):new this.Collection(this,function(){return Vt(void 0,s,!1,!0)})},He.prototype.belowOrEqual=function(s){return s==null?dt(this,Pt):new this.Collection(this,function(){return Vt(void 0,s)})},He.prototype.startsWith=function(s){return typeof s!="string"?dt(this,_a):this.between(s,s+sn,!0,!0)},He.prototype.startsWithIgnoreCase=function(s){return s===""?this.startsWith(s):Gr(this,function(o,l){return o.indexOf(l[0])===0},[s],sn)},He.prototype.equalsIgnoreCase=function(s){return Gr(this,function(o,l){return o===l[0]},[s],"")},He.prototype.anyOfIgnoreCase=function(){var s=oe.apply(z,arguments);return s.length===0?An(this):Gr(this,function(o,l){return l.indexOf(o)!==-1},s,"")},He.prototype.startsWithAnyOfIgnoreCase=function(){var s=oe.apply(z,arguments);return s.length===0?An(this):Gr(this,function(o,l){return l.some(function(c){return o.indexOf(c)===0})},s,sn)},He.prototype.anyOf=function(){var s=this,o=oe.apply(z,arguments),l=this._cmp;try{o.sort(l)}catch{return dt(this,Pt)}if(o.length===0)return An(this);var c=new this.Collection(this,function(){return Vt(o[0],o[o.length-1])});c._ondirectionchange=function(m){l=m==="next"?s._ascending:s._descending,o.sort(l)};var d=0;return c._addAlgorithm(function(m,_,g){for(var b=m.key;0<l(b,o[d]);)if(++d===o.length)return _(g),!1;return l(b,o[d])===0||(_(function(){m.continue(o[d])}),!1)}),c},He.prototype.notEqual=function(s){return this.inAnyRange([[-1/0,s],[s,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},He.prototype.noneOf=function(){var s=oe.apply(z,arguments);if(s.length===0)return new this.Collection(this);try{s.sort(this._ascending)}catch{return dt(this,Pt)}var o=s.reduce(function(l,c){return l?l.concat([[l[l.length-1][1],c]]):[[-1/0,c]]},null);return o.push([s[s.length-1],this.db._maxKey]),this.inAnyRange(o,{includeLowers:!1,includeUppers:!1})},He.prototype.inAnyRange=function(O,o){var l=this,c=this._cmp,d=this._ascending,m=this._descending,_=this._min,g=this._max;if(O.length===0)return An(this);if(!O.every(function(R){return R[0]!==void 0&&R[1]!==void 0&&d(R[0],R[1])<=0}))return dt(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",ae.InvalidArgument);var b=!o||o.includeLowers!==!1,x=o&&o.includeUppers===!0,S,w=d;function A(R,D){return w(R[0],D[0])}try{(S=O.reduce(function(R,D){for(var N=0,K=R.length;N<K;++N){var J=R[N];if(c(D[0],J[1])<0&&0<c(D[1],J[0])){J[0]=_(J[0],D[0]),J[1]=g(J[1],D[1]);break}}return N===K&&R.push(D),R},[])).sort(A)}catch{return dt(this,Pt)}var E=0,T=x?function(R){return 0<d(R,S[E][1])}:function(R){return 0<=d(R,S[E][1])},k=b?function(R){return 0<m(R,S[E][0])}:function(R){return 0<=m(R,S[E][0])},C=T,O=new this.Collection(this,function(){return Vt(S[0][0],S[S.length-1][1],!b,!x)});return O._ondirectionchange=function(R){w=R==="next"?(C=T,d):(C=k,m),S.sort(A)},O._addAlgorithm(function(R,D,N){for(var K,J=R.key;C(J);)if(++E===S.length)return D(N),!1;return!T(K=J)&&!k(K)||(l._cmp(J,S[E][1])===0||l._cmp(J,S[E][0])===0||D(function(){w===d?R.continue(S[E][0]):R.continue(S[E][1])}),!1)}),O},He.prototype.startsWithAnyOf=function(){var s=oe.apply(z,arguments);return s.every(function(o){return typeof o=="string"})?s.length===0?An(this):this.inAnyRange(s.map(function(o){return[o,o+sn]})):dt(this,"startsWithAnyOf() only works with strings")},He);function He(){}function St(s){return je(function(o){return ir(o),s(o.target.error),!1})}function ir(s){s.stopPropagation&&s.stopPropagation(),s.preventDefault&&s.preventDefault()}var sr="storagemutated",gs="x-storagemutated-1",Kt=tr(null,sr),sh=(It.prototype._lock=function(){return Ae(!he.global),++this._reculock,this._reculock!==1||he.global||(he.lockOwnerFor=this),this},It.prototype._unlock=function(){if(Ae(!he.global),--this._reculock==0)for(he.global||(he.lockOwnerFor=null);0<this._blockedFuncs.length&&!this._locked();){var s=this._blockedFuncs.shift();try{rn(s[1],s[0])}catch{}}return this},It.prototype._locked=function(){return this._reculock&&he.lockOwnerFor!==this},It.prototype.create=function(s){var o=this;if(!this.mode)return this;var l=this.db.idbdb,c=this.db._state.dbOpenError;if(Ae(!this.idbtrans),!s&&!l)switch(c&&c.name){case"DatabaseClosedError":throw new ae.DatabaseClosed(c);case"MissingAPIError":throw new ae.MissingAPI(c.message,c);default:throw new ae.OpenFailed(c)}if(!this.active)throw new ae.TransactionInactive;return Ae(this._completion._state===null),(s=this.idbtrans=s||(this.db.core||l).transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})).onerror=je(function(d){ir(d),o._reject(s.error)}),s.onabort=je(function(d){ir(d),o.active&&o._reject(new ae.Abort(s.error)),o.active=!1,o.on("abort").fire(d)}),s.oncomplete=je(function(){o.active=!1,o._resolve(),"mutatedParts"in s&&Kt.storagemutated.fire(s.mutatedParts)}),this},It.prototype._promise=function(s,o,l){var c=this;if(s==="readwrite"&&this.mode!=="readwrite")return qe(new ae.ReadOnly("Transaction is readonly"));if(!this.active)return qe(new ae.TransactionInactive);if(this._locked())return new ie(function(m,_){c._blockedFuncs.push([function(){c._promise(s,o,l).then(m,_)},he])});if(l)return Bt(function(){var m=new ie(function(_,g){c._lock();var b=o(_,g,c);b&&b.then&&b.then(_,g)});return m.finally(function(){return c._unlock()}),m._lib=!0,m});var d=new ie(function(m,_){var g=o(m,_,c);g&&g.then&&g.then(m,_)});return d._lib=!0,d},It.prototype._root=function(){return this.parent?this.parent._root():this},It.prototype.waitFor=function(s){var o,l=this._root(),c=ie.resolve(s);l._waitingFor?l._waitingFor=l._waitingFor.then(function(){return c}):(l._waitingFor=c,l._waitingQueue=[],o=l.idbtrans.objectStore(l.storeNames[0]),function m(){for(++l._spinCount;l._waitingQueue.length;)l._waitingQueue.shift()();l._waitingFor&&(o.get(-1/0).onsuccess=m)}());var d=l._waitingFor;return new ie(function(m,_){c.then(function(g){return l._waitingQueue.push(je(m.bind(null,g)))},function(g){return l._waitingQueue.push(je(_.bind(null,g)))}).finally(function(){l._waitingFor===d&&(l._waitingFor=null)})})},It.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new ae.Abort))},It.prototype.table=function(s){var o=this._memoizedTables||(this._memoizedTables={});if(v(o,s))return o[s];var l=this.schema[s];if(!l)throw new ae.NotFound("Table "+s+" not part of transaction");return l=new this.db.Table(s,l,this),l.core=this.db.core.table(s),o[s]=l},It);function It(){}function ys(s,o,l,c,d,m,_){return{name:s,keyPath:o,unique:l,multi:c,auto:d,compound:m,src:(l&&!_?"&":"")+(c?"*":"")+(d?"++":"")+Ia(o)}}function Ia(s){return typeof s=="string"?s:s?"["+[].join.call(s,"+")+"]":""}function vs(s,o,l){return{name:s,primKey:o,indexes:l,mappedClass:null,idxByName:(c=function(d){return[d.name,d]},l.reduce(function(d,m,_){return _=c(m,_),_&&(d[_[0]]=_[1]),d},{}))};var c}var or=function(s){try{return s.only([[]]),or=function(){return[[]]},[[]]}catch{return or=function(){return sn},sn}};function ws(s){return s==null?function(){}:typeof s=="string"?(o=s).split(".").length===1?function(l){return l[o]}:function(l){return P(l,o)}:function(l){return P(l,s)};var o}function ka(s){return[].slice.call(s)}var oh=0;function ar(s){return s==null?":id":typeof s=="string"?s:"[".concat(s.join("+"),"]")}function ah(s,o,b){function c(C){if(C.type===3)return null;if(C.type===4)throw new Error("Cannot convert never type to IDBKeyRange");var E=C.lower,T=C.upper,k=C.lowerOpen,C=C.upperOpen;return E===void 0?T===void 0?null:o.upperBound(T,!!C):T===void 0?o.lowerBound(E,!!k):o.bound(E,T,!!k,!!C)}function d(A){var E,T=A.name;return{name:T,schema:A,mutate:function(k){var C=k.trans,O=k.type,R=k.keys,D=k.values,N=k.range;return new Promise(function(K,J){K=je(K);var W=C.objectStore(T),G=W.keyPath==null,te=O==="put"||O==="add";if(!te&&O!=="delete"&&O!=="deleteRange")throw new Error("Invalid operation type: "+O);var X,se=(R||D||{length:1}).length;if(R&&D&&R.length!==D.length)throw new Error("Given keys array must have same length as given values array.");if(se===0)return K({numFailures:0,failures:{},results:[],lastResult:void 0});function ye(ot){++pt,ir(ot)}var be=[],Ee=[],pt=0;if(O==="deleteRange"){if(N.type===4)return K({numFailures:pt,failures:Ee,results:[],lastResult:void 0});N.type===3?be.push(X=W.clear()):be.push(X=W.delete(c(N)))}else{var G=te?G?[D,R]:[D,null]:[R,null],ge=G[0],nt=G[1];if(te)for(var rt=0;rt<se;++rt)be.push(X=nt&&nt[rt]!==void 0?W[O](ge[rt],nt[rt]):W[O](ge[rt])),X.onerror=ye;else for(rt=0;rt<se;++rt)be.push(X=W[O](ge[rt])),X.onerror=ye}function ui(ot){ot=ot.target.result,be.forEach(function(ln,Fs){return ln.error!=null&&(Ee[Fs]=ln.error)}),K({numFailures:pt,failures:Ee,results:O==="delete"?R:be.map(function(ln){return ln.result}),lastResult:ot})}X.onerror=function(ot){ye(ot),ui(ot)},X.onsuccess=ui})},getMany:function(k){var C=k.trans,O=k.keys;return new Promise(function(R,D){R=je(R);for(var N,K=C.objectStore(T),J=O.length,W=new Array(J),G=0,te=0,X=function(be){be=be.target,W[be._pos]=be.result,++te===G&&R(W)},se=St(D),ye=0;ye<J;++ye)O[ye]!=null&&((N=K.get(O[ye]))._pos=ye,N.onsuccess=X,N.onerror=se,++G);G===0&&R(W)})},get:function(k){var C=k.trans,O=k.key;return new Promise(function(R,D){R=je(R);var N=C.objectStore(T).get(O);N.onsuccess=function(K){return R(K.target.result)},N.onerror=St(D)})},query:(E=x,function(k){return new Promise(function(C,O){C=je(C);var R,D,N,G=k.trans,K=k.values,J=k.limit,X=k.query,W=J===1/0?void 0:J,te=X.index,X=X.range,G=G.objectStore(T),te=te.isPrimaryKey?G:G.index(te.name),X=c(X);if(J===0)return C({result:[]});E?((W=K?te.getAll(X,W):te.getAllKeys(X,W)).onsuccess=function(se){return C({result:se.target.result})},W.onerror=St(O)):(R=0,D=!K&&"openKeyCursor"in te?te.openKeyCursor(X):te.openCursor(X),N=[],D.onsuccess=function(se){var ye=D.result;return ye?(N.push(K?ye.value:ye.primaryKey),++R===J?C({result:N}):void ye.continue()):C({result:N})},D.onerror=St(O))})}),openCursor:function(k){var C=k.trans,O=k.values,R=k.query,D=k.reverse,N=k.unique;return new Promise(function(K,J){K=je(K);var te=R.index,W=R.range,G=C.objectStore(T),G=te.isPrimaryKey?G:G.index(te.name),te=D?N?"prevunique":"prev":N?"nextunique":"next",X=!O&&"openKeyCursor"in G?G.openKeyCursor(c(W),te):G.openCursor(c(W),te);X.onerror=St(J),X.onsuccess=je(function(se){var ye,be,Ee,pt,ge=X.result;ge?(ge.___id=++oh,ge.done=!1,ye=ge.continue.bind(ge),be=(be=ge.continuePrimaryKey)&&be.bind(ge),Ee=ge.advance.bind(ge),pt=function(){throw new Error("Cursor not stopped")},ge.trans=C,ge.stop=ge.continue=ge.continuePrimaryKey=ge.advance=function(){throw new Error("Cursor not started")},ge.fail=je(J),ge.next=function(){var nt=this,rt=1;return this.start(function(){return rt--?nt.continue():nt.stop()}).then(function(){return nt})},ge.start=function(nt){function rt(){if(X.result)try{nt()}catch(ot){ge.fail(ot)}else ge.done=!0,ge.start=function(){throw new Error("Cursor behind last entry")},ge.stop()}var ui=new Promise(function(ot,ln){ot=je(ot),X.onerror=St(ln),ge.fail=ln,ge.stop=function(Fs){ge.stop=ge.continue=ge.continuePrimaryKey=ge.advance=pt,ot(Fs)}});return X.onsuccess=je(function(ot){X.onsuccess=rt,rt()}),ge.continue=ye,ge.continuePrimaryKey=be,ge.advance=Ee,rt(),ui},K(ge)):K(null)},J)})},count:function(k){var C=k.query,O=k.trans,R=C.index,D=C.range;return new Promise(function(N,K){var J=O.objectStore(T),W=R.isPrimaryKey?J:J.index(R.name),J=c(D),W=J?W.count(J):W.count();W.onsuccess=je(function(G){return N(G.target.result)}),W.onerror=St(K)})}}}var m,_,g,S=(_=b,g=ka((m=s).objectStoreNames),{schema:{name:m.name,tables:g.map(function(A){return _.objectStore(A)}).map(function(A){var E=A.keyPath,C=A.autoIncrement,T=h(E),k={},C={name:A.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:E==null,compound:T,keyPath:E,autoIncrement:C,unique:!0,extractKey:ws(E)},indexes:ka(A.indexNames).map(function(O){return A.index(O)}).map(function(N){var R=N.name,D=N.unique,K=N.multiEntry,N=N.keyPath,K={name:R,compound:h(N),keyPath:N,unique:D,multiEntry:K,extractKey:ws(N)};return k[ar(N)]=K}),getIndexByKeyPath:function(O){return k[ar(O)]}};return k[":id"]=C.primaryKey,E!=null&&(k[ar(E)]=C.primaryKey),C})},hasGetAll:0<g.length&&"getAll"in _.objectStore(g[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}),b=S.schema,x=S.hasGetAll,S=b.tables.map(d),w={};return S.forEach(function(A){return w[A.name]=A}),{stack:"dbcore",transaction:s.transaction.bind(s),table:function(A){if(!w[A])throw new Error("Table '".concat(A,"' not found"));return w[A]},MIN_KEY:-1/0,MAX_KEY:or(o),schema:b}}function uh(s,o,l,c){var d=l.IDBKeyRange;return l.indexedDB,{dbcore:(c=ah(o,d,c),s.dbcore.reduce(function(m,_){return _=_.create,r(r({},m),_(m))},c))}}function Qr(s,c){var l=c.db,c=uh(s._middlewares,l,s._deps,c);s.core=c.dbcore,s.tables.forEach(function(d){var m=d.name;s.core.schema.tables.some(function(_){return _.name===m})&&(d.core=s.core.table(m),s[m]instanceof s.Table&&(s[m].core=d.core))})}function Xr(s,o,l,c){l.forEach(function(d){var m=c[d];o.forEach(function(_){var g=function b(x,S){return Z(x,S)||(x=p(x))&&b(x,S)}(_,d);(!g||"value"in g&&g.value===void 0)&&(_===s.Transaction.prototype||_ instanceof s.Transaction?B(_,d,{get:function(){return this.table(d)},set:function(b){M(this,d,{value:b,writable:!0,configurable:!0,enumerable:!0})}}):_[d]=new s.Table(d,m))})})}function bs(s,o){o.forEach(function(l){for(var c in l)l[c]instanceof s.Table&&delete l[c]})}function lh(s,o){return s._cfg.version-o._cfg.version}function ch(s,o,l,c){var d=s._dbSchema;l.objectStoreNames.contains("$meta")&&!d.$meta&&(d.$meta=vs("$meta",Pa("")[0],[]),s._storeNames.push("$meta"));var m=s._createTransaction("readwrite",s._storeNames,d);m.create(l),m._completion.catch(c);var _=m._reject.bind(m),g=he.transless||he;Bt(function(){return he.trans=m,he.transless=g,o!==0?(Qr(s,l),x=o,((b=m).storeNames.includes("$meta")?b.table("$meta").get("version").then(function(S){return S??x}):ie.resolve(x)).then(function(S){return A=S,E=m,T=l,k=[],S=(w=s)._versions,C=w._dbSchema=Zr(0,w.idbdb,T),(S=S.filter(function(O){return O._cfg.version>=A})).length!==0?(S.forEach(function(O){k.push(function(){var R=C,D=O._cfg.dbschema;ei(w,R,T),ei(w,D,T),C=w._dbSchema=D;var N=Es(R,D);N.add.forEach(function(te){xs(T,te[0],te[1].primKey,te[1].indexes)}),N.change.forEach(function(te){if(te.recreate)throw new ae.Upgrade("Not yet support for changing primary key");var X=T.objectStore(te.name);te.add.forEach(function(se){return Jr(X,se)}),te.change.forEach(function(se){X.deleteIndex(se.name),Jr(X,se)}),te.del.forEach(function(se){return X.deleteIndex(se)})});var K=O._cfg.contentUpgrade;if(K&&O._cfg.version>A){Qr(w,T),E._memoizedTables={};var J=ne(D);N.del.forEach(function(te){J[te]=R[te]}),bs(w,[w.Transaction.prototype]),Xr(w,[w.Transaction.prototype],u(J),J),E.schema=J;var W,G=pe(K);return G&&Sn(),N=ie.follow(function(){var te;(W=K(E))&&G&&(te=qt.bind(null,null),W.then(te,te))}),W&&typeof W.then=="function"?ie.resolve(W):N.then(function(){return W})}}),k.push(function(R){var D,N,K=O._cfg.dbschema;D=K,N=R,[].slice.call(N.db.objectStoreNames).forEach(function(J){return D[J]==null&&N.db.deleteObjectStore(J)}),bs(w,[w.Transaction.prototype]),Xr(w,[w.Transaction.prototype],w._storeNames,w._dbSchema),E.schema=w._dbSchema}),k.push(function(R){w.idbdb.objectStoreNames.contains("$meta")&&(Math.ceil(w.idbdb.version/10)===O._cfg.version?(w.idbdb.deleteObjectStore("$meta"),delete w._dbSchema.$meta,w._storeNames=w._storeNames.filter(function(D){return D!=="$meta"})):R.objectStore("$meta").put(O._cfg.version,"version"))})}),function O(){return k.length?ie.resolve(k.shift()(E.idbtrans)).then(O):ie.resolve()}().then(function(){Aa(C,T)})):ie.resolve();var w,A,E,T,k,C}).catch(_)):(u(d).forEach(function(S){xs(l,S,d[S].primKey,d[S].indexes)}),Qr(s,l),void ie.follow(function(){return s.on.populate.fire(m)}).catch(_));var b,x})}function hh(s,o){Aa(s._dbSchema,o),o.db.version%10!=0||o.objectStoreNames.contains("$meta")||o.db.createObjectStore("$meta").add(Math.ceil(o.db.version/10-1),"version");var l=Zr(0,s.idbdb,o);ei(s,s._dbSchema,o);for(var c=0,d=Es(l,s._dbSchema).change;c<d.length;c++){var m=function(_){if(_.change.length||_.recreate)return console.warn("Unable to patch indexes of table ".concat(_.name," because it has changes on the type of index or primary key.")),{value:void 0};var g=o.objectStore(_.name);_.add.forEach(function(b){Tt&&console.debug("Dexie upgrade patch: Creating missing index ".concat(_.name,".").concat(b.src)),Jr(g,b)})}(d[c]);if(typeof m=="object")return m.value}}function Es(s,o){var l,c={del:[],add:[],change:[]};for(l in s)o[l]||c.del.push(l);for(l in o){var d=s[l],m=o[l];if(d){var _={name:l,def:m,recreate:!1,del:[],add:[],change:[]};if(""+(d.primKey.keyPath||"")!=""+(m.primKey.keyPath||"")||d.primKey.auto!==m.primKey.auto)_.recreate=!0,c.change.push(_);else{var g=d.idxByName,b=m.idxByName,x=void 0;for(x in g)b[x]||_.del.push(x);for(x in b){var S=g[x],w=b[x];S?S.src!==w.src&&_.change.push(w):_.add.push(w)}(0<_.del.length||0<_.add.length||0<_.change.length)&&c.change.push(_)}}else c.add.push([l,m])}return c}function xs(s,o,l,c){var d=s.db.createObjectStore(o,l.keyPath?{keyPath:l.keyPath,autoIncrement:l.auto}:{autoIncrement:l.auto});return c.forEach(function(m){return Jr(d,m)}),d}function Aa(s,o){u(s).forEach(function(l){o.db.objectStoreNames.contains(l)||(Tt&&console.debug("Dexie: Creating missing table",l),xs(o,l,s[l].primKey,s[l].indexes))})}function Jr(s,o){s.createIndex(o.name,o.keyPath,{unique:o.unique,multiEntry:o.multi})}function Zr(s,o,l){var c={};return _e(o.objectStoreNames,0).forEach(function(d){for(var m=l.objectStore(d),_=ys(Ia(x=m.keyPath),x||"",!0,!1,!!m.autoIncrement,x&&typeof x!="string",!0),g=[],b=0;b<m.indexNames.length;++b){var S=m.index(m.indexNames[b]),x=S.keyPath,S=ys(S.name,x,!!S.unique,!!S.multiEntry,!1,x&&typeof x!="string",!1);g.push(S)}c[d]=vs(d,_,g)}),c}function ei(s,o,l){for(var c=l.db.objectStoreNames,d=0;d<c.length;++d){var m=c[d],_=l.objectStore(m);s._hasGetAll="getAll"in _;for(var g=0;g<_.indexNames.length;++g){var b=_.indexNames[g],x=_.index(b).keyPath,S=typeof x=="string"?x:"["+_e(x).join("+")+"]";!o[m]||(x=o[m].idxByName[S])&&(x.name=b,delete o[m].idxByName[S],o[m].idxByName[b]=x)}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&a.WorkerGlobalScope&&a instanceof a.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(s._hasGetAll=!1)}function Pa(s){return s.split(",").map(function(o,l){var c=(o=o.trim()).replace(/([&*]|\+\+)/g,""),d=/^\[/.test(c)?c.match(/^\[(.*)\]$/)[1].split("+"):c;return ys(c,d||null,/\&/.test(o),/\*/.test(o),/\+\+/.test(o),h(d),l===0)})}var fh=(ti.prototype._parseStoresSpec=function(s,o){u(s).forEach(function(l){if(s[l]!==null){var c=Pa(s[l]),d=c.shift();if(d.unique=!0,d.multi)throw new ae.Schema("Primary key cannot be multi-valued");c.forEach(function(m){if(m.auto)throw new ae.Schema("Only primary key can be marked as autoIncrement (++)");if(!m.keyPath)throw new ae.Schema("Index must have a name and cannot be an empty string")}),o[l]=vs(l,d,c)}})},ti.prototype.stores=function(l){var o=this.db;this._cfg.storesSource=this._cfg.storesSource?f(this._cfg.storesSource,l):l;var l=o._versions,c={},d={};return l.forEach(function(m){f(c,m._cfg.storesSource),d=m._cfg.dbschema={},m._parseStoresSpec(c,d)}),o._dbSchema=d,bs(o,[o._allTables,o,o.Transaction.prototype]),Xr(o,[o._allTables,o,o.Transaction.prototype,this._cfg.tables],u(d),d),o._storeNames=u(d),this},ti.prototype.upgrade=function(s){return this._cfg.contentUpgrade=Lr(this._cfg.contentUpgrade||we,s),this},ti);function ti(){}function Cs(s,o){var l=s._dbNamesDB;return l||(l=s._dbNamesDB=new Ot(Wr,{addons:[],indexedDB:s,IDBKeyRange:o})).version(1).stores({dbnames:"name"}),l.table("dbnames")}function Ts(s){return s&&typeof s.databases=="function"}function Ss(s){return Bt(function(){return he.letThrough=!0,s()})}function Is(s){return!("from"in s)}var tt=function(s,o){if(!this){var l=new tt;return s&&"d"in s&&f(l,s),l}f(this,arguments.length?{d:1,from:s,to:1<arguments.length?o:s}:{d:0})};function ur(s,o,l){var c=Te(o,l);if(!isNaN(c)){if(0<c)throw RangeError();if(Is(s))return f(s,{from:o,to:l,d:1});var d=s.l,c=s.r;if(Te(l,s.from)<0)return d?ur(d,o,l):s.l={from:o,to:l,d:1,l:null,r:null},Ra(s);if(0<Te(o,s.to))return c?ur(c,o,l):s.r={from:o,to:l,d:1,l:null,r:null},Ra(s);Te(o,s.from)<0&&(s.from=o,s.l=null,s.d=c?c.d+1:1),0<Te(l,s.to)&&(s.to=l,s.r=null,s.d=s.l?s.l.d+1:1),l=!s.r,d&&!s.l&&lr(s,d),c&&l&&lr(s,c)}}function lr(s,o){Is(o)||function l(c,b){var m=b.from,_=b.to,g=b.l,b=b.r;ur(c,m,_),g&&l(c,g),b&&l(c,b)}(s,o)}function Oa(s,o){var l=ni(o),c=l.next();if(c.done)return!1;for(var d=c.value,m=ni(s),_=m.next(d.from),g=_.value;!c.done&&!_.done;){if(Te(g.from,d.to)<=0&&0<=Te(g.to,d.from))return!0;Te(d.from,g.from)<0?d=(c=l.next(g.from)).value:g=(_=m.next(d.from)).value}return!1}function ni(s){var o=Is(s)?null:{s:0,n:s};return{next:function(l){for(var c=0<arguments.length;o;)switch(o.s){case 0:if(o.s=1,c)for(;o.n.l&&Te(l,o.n.from)<0;)o={up:o,n:o.n.l,s:1};else for(;o.n.l;)o={up:o,n:o.n.l,s:1};case 1:if(o.s=2,!c||Te(l,o.n.to)<=0)return{value:o.n,done:!1};case 2:if(o.n.r){o.s=3,o={up:o,n:o.n.r,s:0};continue}case 3:o=o.up}return{done:!0}}}}function Ra(s){var o,l,c=(((o=s.r)===null||o===void 0?void 0:o.d)||0)-(((l=s.l)===null||l===void 0?void 0:l.d)||0),d=1<c?"r":c<-1?"l":"";d&&(o=d=="r"?"l":"r",l=r({},s),c=s[d],s.from=c.from,s.to=c.to,s[d]=c[d],l[d]=c[o],(s[o]=l).d=Da(l)),s.d=Da(s)}function Da(l){var o=l.r,l=l.l;return(o?l?Math.max(o.d,l.d):o.d:l?l.d:0)+1}function ri(s,o){return u(o).forEach(function(l){s[l]?lr(s[l],o[l]):s[l]=function c(d){var m,_,g={};for(m in d)v(d,m)&&(_=d[m],g[m]=!_||typeof _!="object"||L.has(_.constructor)?_:c(_));return g}(o[l])}),s}function ks(s,o){return s.all||o.all||Object.keys(s).some(function(l){return o[l]&&Oa(o[l],s[l])})}I(tt.prototype,((gt={add:function(s){return lr(this,s),this},addKey:function(s){return ur(this,s,s),this},addKeys:function(s){var o=this;return s.forEach(function(l){return ur(o,l,l)}),this},hasKey:function(s){var o=ni(this).next(s).value;return o&&Te(o.from,s)<=0&&0<=Te(o.to,s)}})[U]=function(){return ni(this)},gt));var an={},As={},Ps=!1;function ii(s){ri(As,s),Ps||(Ps=!0,setTimeout(function(){Ps=!1,Os(As,!(As={}))},0))}function Os(s,o){o===void 0&&(o=!1);var l=new Set;if(s.all)for(var c=0,d=Object.values(an);c<d.length;c++)Ma(_=d[c],s,l,o);else for(var m in s){var _,g=/^idb\:\/\/(.*)\/(.*)\//.exec(m);g&&(m=g[1],g=g[2],(_=an["idb://".concat(m,"/").concat(g)])&&Ma(_,s,l,o))}l.forEach(function(b){return b()})}function Ma(s,o,l,c){for(var d=[],m=0,_=Object.entries(s.queries.query);m<_.length;m++){for(var g=_[m],b=g[0],x=[],S=0,w=g[1];S<w.length;S++){var A=w[S];ks(o,A.obsSet)?A.subscribers.forEach(function(C){return l.add(C)}):c&&x.push(A)}c&&d.push([b,x])}if(c)for(var E=0,T=d;E<T.length;E++){var k=T[E],b=k[0],x=k[1];s.queries.query[b]=x}}function dh(s){var o=s._state,l=s._deps.indexedDB;if(o.isBeingOpened||s.idbdb)return o.dbReadyPromise.then(function(){return o.dbOpenError?qe(o.dbOpenError):s});o.isBeingOpened=!0,o.dbOpenError=null,o.openComplete=!1;var c=o.openCanceller,d=Math.round(10*s.verno),m=!1;function _(){if(o.openCanceller!==c)throw new ae.DatabaseClosed("db.open() was cancelled")}function g(){return new ie(function(A,E){if(_(),!l)throw new ae.MissingAPI;var T=s.name,k=o.autoSchema||!d?l.open(T):l.open(T,d);if(!k)throw new ae.MissingAPI;k.onerror=St(E),k.onblocked=je(s._fireOnBlocked),k.onupgradeneeded=je(function(C){var O;S=k.transaction,o.autoSchema&&!s._options.allowEmptyDB?(k.onerror=ir,S.abort(),k.result.close(),(O=l.deleteDatabase(T)).onsuccess=O.onerror=je(function(){E(new ae.NoSuchDatabase("Database ".concat(T," doesnt exist")))})):(S.onerror=St(E),C=C.oldVersion>Math.pow(2,62)?0:C.oldVersion,w=C<1,s.idbdb=k.result,m&&hh(s,S),ch(s,C/10,S,E))},E),k.onsuccess=je(function(){S=null;var C,O,R,D,N,K=s.idbdb=k.result,J=_e(K.objectStoreNames);if(0<J.length)try{var W=K.transaction((D=J).length===1?D[0]:D,"readonly");if(o.autoSchema)O=K,R=W,(C=s).verno=O.version/10,R=C._dbSchema=Zr(0,O,R),C._storeNames=_e(O.objectStoreNames,0),Xr(C,[C._allTables],u(R),R);else if(ei(s,s._dbSchema,W),((N=Es(Zr(0,(N=s).idbdb,W),N._dbSchema)).add.length||N.change.some(function(G){return G.add.length||G.change.length}))&&!m)return console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Dexie will add missing parts and increment native version number to workaround this."),K.close(),d=K.version+1,m=!0,A(g());Qr(s,W)}catch{}In.push(s),K.onversionchange=je(function(G){o.vcFired=!0,s.on("versionchange").fire(G)}),K.onclose=je(function(G){s.on("close").fire(G)}),w&&(N=s._deps,W=T,K=N.indexedDB,N=N.IDBKeyRange,Ts(K)||W===Wr||Cs(K,N).put({name:W}).catch(we)),A()},E)}).catch(function(A){switch(A==null?void 0:A.name){case"UnknownError":if(0<o.PR1398_maxLoop)return o.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),g();break;case"VersionError":if(0<d)return d=0,g()}return ie.reject(A)})}var b,x=o.dbReadyResolve,S=null,w=!1;return ie.race([c,(typeof navigator>"u"?ie.resolve():!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(A){function E(){return indexedDB.databases().finally(A)}b=setInterval(E,100),E()}).finally(function(){return clearInterval(b)}):Promise.resolve()).then(g)]).then(function(){return _(),o.onReadyBeingFired=[],ie.resolve(Ss(function(){return s.on.ready.fire(s.vip)})).then(function A(){if(0<o.onReadyBeingFired.length){var E=o.onReadyBeingFired.reduce(Lr,we);return o.onReadyBeingFired=[],ie.resolve(Ss(function(){return E(s.vip)})).then(A)}})}).finally(function(){o.openCanceller===c&&(o.onReadyBeingFired=null,o.isBeingOpened=!1)}).catch(function(A){o.dbOpenError=A;try{S&&S.abort()}catch{}return c===o.openCanceller&&s._close(),qe(A)}).finally(function(){o.openComplete=!0,x()}).then(function(){var A;return w&&(A={},s.tables.forEach(function(E){E.schema.indexes.forEach(function(T){T.name&&(A["idb://".concat(s.name,"/").concat(E.name,"/").concat(T.name)]=new tt(-1/0,[[[]]]))}),A["idb://".concat(s.name,"/").concat(E.name,"/")]=A["idb://".concat(s.name,"/").concat(E.name,"/:dels")]=new tt(-1/0,[[[]]])}),Kt(sr).fire(A),Os(A,!0)),s})}function Rs(s){function o(m){return s.next(m)}var l=d(o),c=d(function(m){return s.throw(m)});function d(m){return function(b){var g=m(b),b=g.value;return g.done?b:b&&typeof b.then=="function"?b.then(l,c):h(b)?Promise.all(b).then(l,c):l(b)}}return d(o)()}function si(s,o,l){for(var c=h(s)?s.slice():[s],d=0;d<l;++d)c.push(o);return c}var ph={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(s){return r(r({},s),{table:function(o){var l=s.table(o),c=l.schema,d={},m=[];function _(w,A,E){var T=ar(w),k=d[T]=d[T]||[],C=w==null?0:typeof w=="string"?1:w.length,O=0<A,O=r(r({},E),{name:O?"".concat(T,"(virtual-from:").concat(E.name,")"):E.name,lowLevelIndex:E,isVirtual:O,keyTail:A,keyLength:C,extractKey:ws(w),unique:!O&&E.unique});return k.push(O),O.isPrimaryKey||m.push(O),1<C&&_(C===2?w[0]:w.slice(0,C-1),A+1,E),k.sort(function(R,D){return R.keyTail-D.keyTail}),O}o=_(c.primaryKey.keyPath,0,c.primaryKey),d[":id"]=[o];for(var g=0,b=c.indexes;g<b.length;g++){var x=b[g];_(x.keyPath,0,x)}function S(w){var A,E=w.query.index;return E.isVirtual?r(r({},w),{query:{index:E.lowLevelIndex,range:(A=w.query.range,E=E.keyTail,{type:A.type===1?2:A.type,lower:si(A.lower,A.lowerOpen?s.MAX_KEY:s.MIN_KEY,E),lowerOpen:!0,upper:si(A.upper,A.upperOpen?s.MIN_KEY:s.MAX_KEY,E),upperOpen:!0})}}):w}return r(r({},l),{schema:r(r({},c),{primaryKey:o,indexes:m,getIndexByKeyPath:function(w){return(w=d[ar(w)])&&w[0]}}),count:function(w){return l.count(S(w))},query:function(w){return l.query(S(w))},openCursor:function(w){var A=w.query.index,E=A.keyTail,T=A.isVirtual,k=A.keyLength;return T?l.openCursor(S(w)).then(function(O){return O&&C(O)}):l.openCursor(w);function C(O){return Object.create(O,{continue:{value:function(R){R!=null?O.continue(si(R,w.reverse?s.MAX_KEY:s.MIN_KEY,E)):w.unique?O.continue(O.key.slice(0,k).concat(w.reverse?s.MIN_KEY:s.MAX_KEY,E)):O.continue()}},continuePrimaryKey:{value:function(R,D){O.continuePrimaryKey(si(R,s.MAX_KEY,E),D)}},primaryKey:{get:function(){return O.primaryKey}},key:{get:function(){var R=O.key;return k===1?R[0]:R.slice(0,k)}},value:{get:function(){return O.value}}})}}})}})}};function Ds(s,o,l,c){return l=l||{},c=c||"",u(s).forEach(function(d){var m,_,g;v(o,d)?(m=s[d],_=o[d],typeof m=="object"&&typeof _=="object"&&m&&_?(g=j(m))!==j(_)?l[c+d]=o[d]:g==="Object"?Ds(m,_,l,c+d+"."):m!==_&&(l[c+d]=o[d]):m!==_&&(l[c+d]=o[d])):l[c+d]=void 0}),u(o).forEach(function(d){v(s,d)||(l[c+d]=o[d])}),l}function Ms(s,o){return o.type==="delete"?o.keys:o.keys||o.values.map(s.extractKey)}var mh={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(s){return r(r({},s),{table:function(o){var l=s.table(o),c=l.schema.primaryKey;return r(r({},l),{mutate:function(d){var m=he.trans,_=m.table(o).hook,g=_.deleting,b=_.creating,x=_.updating;switch(d.type){case"add":if(b.fire===we)break;return m._promise("readwrite",function(){return S(d)},!0);case"put":if(b.fire===we&&x.fire===we)break;return m._promise("readwrite",function(){return S(d)},!0);case"delete":if(g.fire===we)break;return m._promise("readwrite",function(){return S(d)},!0);case"deleteRange":if(g.fire===we)break;return m._promise("readwrite",function(){return function w(A,E,T){return l.query({trans:A,values:!1,query:{index:c,range:E},limit:T}).then(function(k){var C=k.result;return S({type:"delete",keys:C,trans:A}).then(function(O){return 0<O.numFailures?Promise.reject(O.failures[0]):C.length<T?{failures:[],numFailures:0,lastResult:void 0}:w(A,r(r({},E),{lower:C[C.length-1],lowerOpen:!0}),T)})})}(d.trans,d.range,1e4)},!0)}return l.mutate(d);function S(w){var A,E,T,k=he.trans,C=w.keys||Ms(c,w);if(!C)throw new Error("Keys missing");return(w=w.type==="add"||w.type==="put"?r(r({},w),{keys:C}):r({},w)).type!=="delete"&&(w.values=i([],w.values)),w.keys&&(w.keys=i([],w.keys)),A=l,T=C,((E=w).type==="add"?Promise.resolve([]):A.getMany({trans:E.trans,keys:T,cache:"immutable"})).then(function(O){var R=C.map(function(D,N){var K,J,W,G=O[N],te={onerror:null,onsuccess:null};return w.type==="delete"?g.fire.call(te,D,G,k):w.type==="add"||G===void 0?(K=b.fire.call(te,D,w.values[N],k),D==null&&K!=null&&(w.keys[N]=D=K,c.outbound||$(w.values[N],c.keyPath,D))):(K=Ds(G,w.values[N]),(J=x.fire.call(te,K,D,G,k))&&(W=w.values[N],Object.keys(J).forEach(function(X){v(W,X)?W[X]=J[X]:$(W,X,J[X])}))),te});return l.mutate(w).then(function(D){for(var N=D.failures,K=D.results,J=D.numFailures,D=D.lastResult,W=0;W<C.length;++W){var G=(K||C)[W],te=R[W];G==null?te.onerror&&te.onerror(N[W]):te.onsuccess&&te.onsuccess(w.type==="put"&&O[W]?w.values[W]:G)}return{failures:N,results:K,numFailures:J,lastResult:D}}).catch(function(D){return R.forEach(function(N){return N.onerror&&N.onerror(D)}),Promise.reject(D)})})}}})}})}};function Na(s,o,l){try{if(!o||o.keys.length<s.length)return null;for(var c=[],d=0,m=0;d<o.keys.length&&m<s.length;++d)Te(o.keys[d],s[m])===0&&(c.push(l?F(o.values[d]):o.values[d]),++m);return c.length===s.length?c:null}catch{return null}}var _h={stack:"dbcore",level:-1,create:function(s){return{table:function(o){var l=s.table(o);return r(r({},l),{getMany:function(c){if(!c.cache)return l.getMany(c);var d=Na(c.keys,c.trans._cache,c.cache==="clone");return d?ie.resolve(d):l.getMany(c).then(function(m){return c.trans._cache={keys:c.keys,values:c.cache==="clone"?F(m):m},m})},mutate:function(c){return c.type!=="add"&&(c.trans._cache=null),l.mutate(c)}})}}}};function La(s,o){return s.trans.mode==="readonly"&&!!s.subscr&&!s.trans.explicit&&s.trans.db._options.cache!=="disabled"&&!o.schema.primaryKey.outbound}function $a(s,o){switch(s){case"query":return o.values&&!o.unique;case"get":case"getMany":case"count":case"openCursor":return!1}}var gh={stack:"dbcore",level:0,name:"Observability",create:function(s){var o=s.schema.name,l=new tt(s.MIN_KEY,s.MAX_KEY);return r(r({},s),{transaction:function(c,d,m){if(he.subscr&&d!=="readonly")throw new ae.ReadOnly("Readwrite transaction in liveQuery context. Querier source: ".concat(he.querier));return s.transaction(c,d,m)},table:function(c){var d=s.table(c),m=d.schema,_=m.primaryKey,w=m.indexes,g=_.extractKey,b=_.outbound,x=_.autoIncrement&&w.filter(function(E){return E.compound&&E.keyPath.includes(_.keyPath)}),S=r(r({},d),{mutate:function(E){function T(X){return X="idb://".concat(o,"/").concat(c,"/").concat(X),D[X]||(D[X]=new tt)}var k,C,O,R=E.trans,D=E.mutatedParts||(E.mutatedParts={}),N=T(""),K=T(":dels"),J=E.type,te=E.type==="deleteRange"?[E.range]:E.type==="delete"?[E.keys]:E.values.length<50?[Ms(_,E).filter(function(X){return X}),E.values]:[],W=te[0],G=te[1],te=E.trans._cache;return h(W)?(N.addKeys(W),(te=J==="delete"||W.length===G.length?Na(W,te):null)||K.addKeys(W),(te||G)&&(k=T,C=te,O=G,m.indexes.forEach(function(X){var se=k(X.name||"");function ye(Ee){return Ee!=null?X.extractKey(Ee):null}function be(Ee){return X.multiEntry&&h(Ee)?Ee.forEach(function(pt){return se.addKey(pt)}):se.addKey(Ee)}(C||O).forEach(function(Ee,nt){var ge=C&&ye(C[nt]),nt=O&&ye(O[nt]);Te(ge,nt)!==0&&(ge!=null&&be(ge),nt!=null&&be(nt))})}))):W?(G={from:(G=W.lower)!==null&&G!==void 0?G:s.MIN_KEY,to:(G=W.upper)!==null&&G!==void 0?G:s.MAX_KEY},K.add(G),N.add(G)):(N.add(l),K.add(l),m.indexes.forEach(function(X){return T(X.name).add(l)})),d.mutate(E).then(function(X){return!W||E.type!=="add"&&E.type!=="put"||(N.addKeys(X.results),x&&x.forEach(function(se){for(var ye=E.values.map(function(ge){return se.extractKey(ge)}),be=se.keyPath.findIndex(function(ge){return ge===_.keyPath}),Ee=0,pt=X.results.length;Ee<pt;++Ee)ye[Ee][be]=X.results[Ee];T(se.name).addKeys(ye)})),R.mutatedParts=ri(R.mutatedParts||{},D),X})}}),w=function(T){var k=T.query,T=k.index,k=k.range;return[T,new tt((T=k.lower)!==null&&T!==void 0?T:s.MIN_KEY,(k=k.upper)!==null&&k!==void 0?k:s.MAX_KEY)]},A={get:function(E){return[_,new tt(E.key)]},getMany:function(E){return[_,new tt().addKeys(E.keys)]},count:w,query:w,openCursor:w};return u(A).forEach(function(E){S[E]=function(T){var k=he.subscr,C=!!k,O=La(he,d)&&$a(E,T)?T.obsSet={}:k;if(C){var R=function(G){return G="idb://".concat(o,"/").concat(c,"/").concat(G),O[G]||(O[G]=new tt)},D=R(""),N=R(":dels"),k=A[E](T),C=k[0],k=k[1];if((E==="query"&&C.isPrimaryKey&&!T.values?N:R(C.name||"")).add(k),!C.isPrimaryKey){if(E!=="count"){var K=E==="query"&&b&&T.values&&d.query(r(r({},T),{values:!1}));return d[E].apply(this,arguments).then(function(G){if(E==="query"){if(b&&T.values)return K.then(function(ye){return ye=ye.result,D.addKeys(ye),G});var te=T.values?G.result.map(g):G.result;(T.values?D:N).addKeys(te)}else if(E==="openCursor"){var X=G,se=T.values;return X&&Object.create(X,{key:{get:function(){return N.addKey(X.primaryKey),X.key}},primaryKey:{get:function(){var ye=X.primaryKey;return N.addKey(ye),ye}},value:{get:function(){return se&&D.addKey(X.primaryKey),X.value}}})}return G})}N.add(l)}}return d[E].apply(this,arguments)}}),S}})}};function Fa(s,o,l){if(l.numFailures===0)return o;if(o.type==="deleteRange")return null;var c=o.keys?o.keys.length:"values"in o&&o.values?o.values.length:1;return l.numFailures===c?null:(o=r({},o),h(o.keys)&&(o.keys=o.keys.filter(function(d,m){return!(m in l.failures)})),"values"in o&&h(o.values)&&(o.values=o.values.filter(function(d,m){return!(m in l.failures)})),o)}function Ns(s,o){return l=s,((c=o).lower===void 0||(c.lowerOpen?0<Te(l,c.lower):0<=Te(l,c.lower)))&&(s=s,(o=o).upper===void 0||(o.upperOpen?Te(s,o.upper)<0:Te(s,o.upper)<=0));var l,c}function ja(s,o,A,c,d,m){if(!A||A.length===0)return s;var _=o.query.index,g=_.multiEntry,b=o.query.range,x=c.schema.primaryKey.extractKey,S=_.extractKey,w=(_.lowLevelIndex||_).extractKey,A=A.reduce(function(E,T){var k=E,C=[];if(T.type==="add"||T.type==="put")for(var O=new tt,R=T.values.length-1;0<=R;--R){var D,N=T.values[R],K=x(N);O.hasKey(K)||(D=S(N),(g&&h(D)?D.some(function(X){return Ns(X,b)}):Ns(D,b))&&(O.addKey(K),C.push(N)))}switch(T.type){case"add":var J=new tt().addKeys(o.values?E.map(function(se){return x(se)}):E),k=E.concat(o.values?C.filter(function(se){return se=x(se),!J.hasKey(se)&&(J.addKey(se),!0)}):C.map(function(se){return x(se)}).filter(function(se){return!J.hasKey(se)&&(J.addKey(se),!0)}));break;case"put":var W=new tt().addKeys(T.values.map(function(se){return x(se)}));k=E.filter(function(se){return!W.hasKey(o.values?x(se):se)}).concat(o.values?C:C.map(function(se){return x(se)}));break;case"delete":var G=new tt().addKeys(T.keys);k=E.filter(function(se){return!G.hasKey(o.values?x(se):se)});break;case"deleteRange":var te=T.range;k=E.filter(function(se){return!Ns(x(se),te)})}return k},s);return A===s?s:(A.sort(function(E,T){return Te(w(E),w(T))||Te(x(E),x(T))}),o.limit&&o.limit<1/0&&(A.length>o.limit?A.length=o.limit:s.length===o.limit&&A.length<o.limit&&(d.dirty=!0)),m?Object.freeze(A):A)}function Ba(s,o){return Te(s.lower,o.lower)===0&&Te(s.upper,o.upper)===0&&!!s.lowerOpen==!!o.lowerOpen&&!!s.upperOpen==!!o.upperOpen}function yh(s,o){return function(l,c,d,m){if(l===void 0)return c!==void 0?-1:0;if(c===void 0)return 1;if((c=Te(l,c))===0){if(d&&m)return 0;if(d)return 1;if(m)return-1}return c}(s.lower,o.lower,s.lowerOpen,o.lowerOpen)<=0&&0<=function(l,c,d,m){if(l===void 0)return c!==void 0?1:0;if(c===void 0)return-1;if((c=Te(l,c))===0){if(d&&m)return 0;if(d)return-1;if(m)return 1}return c}(s.upper,o.upper,s.upperOpen,o.upperOpen)}function vh(s,o,l,c){s.subscribers.add(l),c.addEventListener("abort",function(){var d,m;s.subscribers.delete(l),s.subscribers.size===0&&(d=s,m=o,setTimeout(function(){d.subscribers.size===0&&Y(m,d)},3e3))})}var wh={stack:"dbcore",level:0,name:"Cache",create:function(s){var o=s.schema.name;return r(r({},s),{transaction:function(l,c,d){var m,_,g=s.transaction(l,c,d);return c==="readwrite"&&(_=(m=new AbortController).signal,d=function(b){return function(){if(m.abort(),c==="readwrite"){for(var x=new Set,S=0,w=l;S<w.length;S++){var A=w[S],E=an["idb://".concat(o,"/").concat(A)];if(E){var T=s.table(A),k=E.optimisticOps.filter(function(se){return se.trans===g});if(g._explicit&&b&&g.mutatedParts)for(var C=0,O=Object.values(E.queries.query);C<O.length;C++)for(var R=0,D=(J=O[C]).slice();R<D.length;R++)ks((W=D[R]).obsSet,g.mutatedParts)&&(Y(J,W),W.subscribers.forEach(function(se){return x.add(se)}));else if(0<k.length){E.optimisticOps=E.optimisticOps.filter(function(se){return se.trans!==g});for(var N=0,K=Object.values(E.queries.query);N<K.length;N++)for(var J,W,G,te=0,X=(J=K[N]).slice();te<X.length;te++)(W=X[te]).res!=null&&g.mutatedParts&&(b&&!W.dirty?(G=Object.isFrozen(W.res),G=ja(W.res,W.req,k,T,W,G),W.dirty?(Y(J,W),W.subscribers.forEach(function(se){return x.add(se)})):G!==W.res&&(W.res=G,W.promise=ie.resolve({result:G}))):(W.dirty&&Y(J,W),W.subscribers.forEach(function(se){return x.add(se)})))}}}x.forEach(function(se){return se()})}}},g.addEventListener("abort",d(!1),{signal:_}),g.addEventListener("error",d(!1),{signal:_}),g.addEventListener("complete",d(!0),{signal:_})),g},table:function(l){var c=s.table(l),d=c.schema.primaryKey;return r(r({},c),{mutate:function(m){var _=he.trans;if(d.outbound||_.db._options.cache==="disabled"||_.explicit||_.idbtrans.mode!=="readwrite")return c.mutate(m);var g=an["idb://".concat(o,"/").concat(l)];return g?(_=c.mutate(m),m.type!=="add"&&m.type!=="put"||!(50<=m.values.length||Ms(d,m).some(function(b){return b==null}))?(g.optimisticOps.push(m),m.mutatedParts&&ii(m.mutatedParts),_.then(function(b){0<b.numFailures&&(Y(g.optimisticOps,m),(b=Fa(0,m,b))&&g.optimisticOps.push(b),m.mutatedParts&&ii(m.mutatedParts))}),_.catch(function(){Y(g.optimisticOps,m),m.mutatedParts&&ii(m.mutatedParts)})):_.then(function(b){var x=Fa(0,r(r({},m),{values:m.values.map(function(S,w){var A;return b.failures[w]?S:(S=(A=d.keyPath)!==null&&A!==void 0&&A.includes(".")?F(S):r({},S),$(S,d.keyPath,b.results[w]),S)})}),b);g.optimisticOps.push(x),queueMicrotask(function(){return m.mutatedParts&&ii(m.mutatedParts)})}),_):c.mutate(m)},query:function(m){if(!La(he,c)||!$a("query",m))return c.query(m);var _=((x=he.trans)===null||x===void 0?void 0:x.db._options.cache)==="immutable",w=he,g=w.requery,b=w.signal,x=function(T,k,C,O){var R=an["idb://".concat(T,"/").concat(k)];if(!R)return[];if(!(k=R.queries[C]))return[null,!1,R,null];var D=k[(O.query?O.query.index.name:null)||""];if(!D)return[null,!1,R,null];switch(C){case"query":var N=D.find(function(K){return K.req.limit===O.limit&&K.req.values===O.values&&Ba(K.req.query.range,O.query.range)});return N?[N,!0,R,D]:[D.find(function(K){return("limit"in K.req?K.req.limit:1/0)>=O.limit&&(!O.values||K.req.values)&&yh(K.req.query.range,O.query.range)}),!1,R,D];case"count":return N=D.find(function(K){return Ba(K.req.query.range,O.query.range)}),[N,!!N,R,D]}}(o,l,"query",m),S=x[0],w=x[1],A=x[2],E=x[3];return S&&w?S.obsSet=m.obsSet:(w=c.query(m).then(function(T){var k=T.result;if(S&&(S.res=k),_){for(var C=0,O=k.length;C<O;++C)Object.freeze(k[C]);Object.freeze(k)}else T.result=F(k);return T}).catch(function(T){return E&&S&&Y(E,S),Promise.reject(T)}),S={obsSet:m.obsSet,promise:w,subscribers:new Set,type:"query",req:m,dirty:!1},E?E.push(S):(E=[S],(A=A||(an["idb://".concat(o,"/").concat(l)]={queries:{query:{},count:{}},objs:new Map,optimisticOps:[],unsignaledParts:{}})).queries.query[m.query.index.name||""]=E)),vh(S,E,g,b),S.promise.then(function(T){return{result:ja(T.result,m,A==null?void 0:A.optimisticOps,c,S,_)}})}})}})}};function oi(s,o){return new Proxy(s,{get:function(l,c,d){return c==="db"?o:Reflect.get(l,c,d)}})}var Ot=(Ue.prototype.version=function(s){if(isNaN(s)||s<.1)throw new ae.Type("Given version is not a positive number");if(s=Math.round(10*s)/10,this.idbdb||this._state.isBeingOpened)throw new ae.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,s);var o=this._versions,l=o.filter(function(c){return c._cfg.version===s})[0];return l||(l=new this.Version(s),o.push(l),o.sort(lh),l.stores({}),this._state.autoSchema=!1,l)},Ue.prototype._whenReady=function(s){var o=this;return this.idbdb&&(this._state.openComplete||he.letThrough||this._vip)?s():new ie(function(l,c){if(o._state.openComplete)return c(new ae.DatabaseClosed(o._state.dbOpenError));if(!o._state.isBeingOpened){if(!o._state.autoOpen)return void c(new ae.DatabaseClosed);o.open().catch(we)}o._state.dbReadyPromise.then(l,c)}).then(s)},Ue.prototype.use=function(s){var o=s.stack,l=s.create,c=s.level,d=s.name;return d&&this.unuse({stack:o,name:d}),s=this._middlewares[o]||(this._middlewares[o]=[]),s.push({stack:o,create:l,level:c??10,name:d}),s.sort(function(m,_){return m.level-_.level}),this},Ue.prototype.unuse=function(s){var o=s.stack,l=s.name,c=s.create;return o&&this._middlewares[o]&&(this._middlewares[o]=this._middlewares[o].filter(function(d){return c?d.create!==c:!!l&&d.name!==l})),this},Ue.prototype.open=function(){var s=this;return rn(jt,function(){return dh(s)})},Ue.prototype._close=function(){var s=this._state,o=In.indexOf(this);if(0<=o&&In.splice(o,1),this.idbdb){try{this.idbdb.close()}catch{}this.idbdb=null}s.isBeingOpened||(s.dbReadyPromise=new ie(function(l){s.dbReadyResolve=l}),s.openCanceller=new ie(function(l,c){s.cancelOpen=c}))},Ue.prototype.close=function(l){var o=(l===void 0?{disableAutoOpen:!0}:l).disableAutoOpen,l=this._state;o?(l.isBeingOpened&&l.cancelOpen(new ae.DatabaseClosed),this._close(),l.autoOpen=!1,l.dbOpenError=new ae.DatabaseClosed):(this._close(),l.autoOpen=this._options.autoOpen||l.isBeingOpened,l.openComplete=!1,l.dbOpenError=null)},Ue.prototype.delete=function(s){var o=this;s===void 0&&(s={disableAutoOpen:!0});var l=0<arguments.length&&typeof arguments[0]!="object",c=this._state;return new ie(function(d,m){function _(){o.close(s);var g=o._deps.indexedDB.deleteDatabase(o.name);g.onsuccess=je(function(){var b,x,S;b=o._deps,x=o.name,S=b.indexedDB,b=b.IDBKeyRange,Ts(S)||x===Wr||Cs(S,b).delete(x).catch(we),d()}),g.onerror=St(m),g.onblocked=o._fireOnBlocked}if(l)throw new ae.InvalidArgument("Invalid closeOptions argument to db.delete()");c.isBeingOpened?c.dbReadyPromise.then(_):_()})},Ue.prototype.backendDB=function(){return this.idbdb},Ue.prototype.isOpen=function(){return this.idbdb!==null},Ue.prototype.hasBeenClosed=function(){var s=this._state.dbOpenError;return s&&s.name==="DatabaseClosed"},Ue.prototype.hasFailed=function(){return this._state.dbOpenError!==null},Ue.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(Ue.prototype,"tables",{get:function(){var s=this;return u(this._allTables).map(function(o){return s._allTables[o]})},enumerable:!1,configurable:!0}),Ue.prototype.transaction=function(){var s=(function(o,l,c){var d=arguments.length;if(d<2)throw new ae.InvalidArgument("Too few arguments");for(var m=new Array(d-1);--d;)m[d-1]=arguments[d];return c=m.pop(),[o,ee(m),c]}).apply(this,arguments);return this._transaction.apply(this,s)},Ue.prototype._transaction=function(s,o,l){var c=this,d=he.trans;d&&d.db===this&&s.indexOf("!")===-1||(d=null);var m,_,g=s.indexOf("?")!==-1;s=s.replace("!","").replace("?","");try{if(_=o.map(function(x){if(x=x instanceof c.Table?x.name:x,typeof x!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return x}),s=="r"||s===fs)m=fs;else{if(s!="rw"&&s!=ds)throw new ae.InvalidArgument("Invalid transaction mode: "+s);m=ds}if(d){if(d.mode===fs&&m===ds){if(!g)throw new ae.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");d=null}d&&_.forEach(function(x){if(d&&d.storeNames.indexOf(x)===-1){if(!g)throw new ae.SubTransaction("Table "+x+" not included in parent transaction.");d=null}}),g&&d&&!d.active&&(d=null)}}catch(x){return d?d._promise(null,function(S,w){w(x)}):qe(x)}var b=(function x(S,w,A,E,T){return ie.resolve().then(function(){var k=he.transless||he,C=S._createTransaction(w,A,S._dbSchema,E);if(C.explicit=!0,k={trans:C,transless:k},E)C.idbtrans=E.idbtrans;else try{C.create(),C.idbtrans._explicit=!0,S._state.PR1398_maxLoop=3}catch(D){return D.name===ft.InvalidState&&S.isOpen()&&0<--S._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),S.close({disableAutoOpen:!1}),S.open().then(function(){return x(S,w,A,null,T)})):qe(D)}var O,R=pe(T);return R&&Sn(),k=ie.follow(function(){var D;(O=T.call(C,C))&&(R?(D=qt.bind(null,null),O.then(D,D)):typeof O.next=="function"&&typeof O.throw=="function"&&(O=Rs(O)))},k),(O&&typeof O.then=="function"?ie.resolve(O).then(function(D){return C.active?D:qe(new ae.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):k.then(function(){return O})).then(function(D){return E&&C._resolve(),C._completion.then(function(){return D})}).catch(function(D){return C._reject(D),qe(D)})})}).bind(null,this,m,_,d,l);return d?d._promise(m,b,"lock"):he.trans?rn(he.transless,function(){return c._whenReady(b)}):this._whenReady(b)},Ue.prototype.table=function(s){if(!v(this._allTables,s))throw new ae.InvalidTable("Table ".concat(s," does not exist"));return this._allTables[s]},Ue);function Ue(s,o){var l=this;this._middlewares={},this.verno=0;var c=Ue.dependencies;this._options=o=r({addons:Ue.addons,autoOpen:!0,indexedDB:c.indexedDB,IDBKeyRange:c.IDBKeyRange,cache:"cloned"},o),this._deps={indexedDB:o.indexedDB,IDBKeyRange:o.IDBKeyRange},c=o.addons,this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;var d,m,_,g,b,x={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:we,dbReadyPromise:null,cancelOpen:we,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3,autoOpen:o.autoOpen};x.dbReadyPromise=new ie(function(w){x.dbReadyResolve=w}),x.openCanceller=new ie(function(w,A){x.cancelOpen=A}),this._state=x,this.name=s,this.on=tr(this,"populate","blocked","versionchange","close",{ready:[Lr,we]}),this.on.ready.subscribe=ce(this.on.ready.subscribe,function(w){return function(A,E){Ue.vip(function(){var T,k=l._state;k.openComplete?(k.dbOpenError||ie.resolve().then(A),E&&w(A)):k.onReadyBeingFired?(k.onReadyBeingFired.push(A),E&&w(A)):(w(A),T=l,E||w(function C(){T.on.ready.unsubscribe(A),T.on.ready.unsubscribe(C)}))})}}),this.Collection=(d=this,nr(nh.prototype,function(O,C){this.db=d;var E=ga,T=null;if(C)try{E=C()}catch(R){T=R}var k=O._ctx,C=k.table,O=C.hook.reading.fire;this._ctx={table:C,index:k.index,isPrimKey:!k.index||C.schema.primKey.keyPath&&k.index===C.schema.primKey.name,range:E,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:T,or:k.or,valueMapper:O!==ut?O:null}})),this.Table=(m=this,nr(ba.prototype,function(w,A,E){this.db=m,this._tx=E,this.name=w,this.schema=A,this.hook=m._allTables[w]?m._allTables[w].hook:tr(null,{creating:[Hn,we],reading:[xn,ut],updating:[Gn,we],deleting:[zn,we]})})),this.Transaction=(_=this,nr(sh.prototype,function(w,A,E,T,k){var C=this;this.db=_,this.mode=w,this.storeNames=A,this.schema=E,this.chromeTransactionDurability=T,this.idbtrans=null,this.on=tr(this,"complete","error","abort"),this.parent=k||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new ie(function(O,R){C._resolve=O,C._reject=R}),this._completion.then(function(){C.active=!1,C.on.complete.fire()},function(O){var R=C.active;return C.active=!1,C.on.error.fire(O),C.parent?C.parent._reject(O):R&&C.idbtrans&&C.idbtrans.abort(),qe(O)})})),this.Version=(g=this,nr(fh.prototype,function(w){this.db=g,this._cfg={version:w,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})),this.WhereClause=(b=this,nr(Sa.prototype,function(w,A,E){if(this.db=b,this._ctx={table:w,index:A===":id"?null:A,or:E},this._cmp=this._ascending=Te,this._descending=function(T,k){return Te(k,T)},this._max=function(T,k){return 0<Te(T,k)?T:k},this._min=function(T,k){return Te(T,k)<0?T:k},this._IDBKeyRange=b._deps.IDBKeyRange,!this._IDBKeyRange)throw new ae.MissingAPI})),this.on("versionchange",function(w){0<w.newVersion?console.warn("Another connection wants to upgrade database '".concat(l.name,"'. Closing db now to resume the upgrade.")):console.warn("Another connection wants to delete database '".concat(l.name,"'. Closing db now to resume the delete request.")),l.close({disableAutoOpen:!1})}),this.on("blocked",function(w){!w.newVersion||w.newVersion<w.oldVersion?console.warn("Dexie.delete('".concat(l.name,"') was blocked")):console.warn("Upgrade '".concat(l.name,"' blocked by other connection holding version ").concat(w.oldVersion/10))}),this._maxKey=or(o.IDBKeyRange),this._createTransaction=function(w,A,E,T){return new l.Transaction(w,A,E,l._options.chromeTransactionDurability,T)},this._fireOnBlocked=function(w){l.on("blocked").fire(w),In.filter(function(A){return A.name===l.name&&A!==l&&!A._state.vcFired}).map(function(A){return A.on("versionchange").fire(w)})},this.use(_h),this.use(wh),this.use(gh),this.use(ph),this.use(mh);var S=new Proxy(this,{get:function(w,A,E){if(A==="_vip")return!0;if(A==="table")return function(k){return oi(l.table(k),S)};var T=Reflect.get(w,A,E);return T instanceof ba?oi(T,S):A==="tables"?T.map(function(k){return oi(k,S)}):A==="_createTransaction"?function(){return oi(T.apply(this,arguments),S)}:T}});this.vip=S,c.forEach(function(w){return w(l)})}var ai,gt=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable",bh=(Ls.prototype.subscribe=function(s,o,l){return this._subscribe(s&&typeof s!="function"?s:{next:s,error:o,complete:l})},Ls.prototype[gt]=function(){return this},Ls);function Ls(s){this._subscribe=s}try{ai={indexedDB:a.indexedDB||a.mozIndexedDB||a.webkitIndexedDB||a.msIndexedDB,IDBKeyRange:a.IDBKeyRange||a.webkitIDBKeyRange}}catch{ai={indexedDB:null,IDBKeyRange:null}}function qa(s){var o,l=!1,c=new bh(function(d){var m=pe(s),_,g=!1,b={},x={},S={get closed(){return g},unsubscribe:function(){g||(g=!0,_&&_.abort(),w&&Kt.storagemutated.unsubscribe(E))}};d.start&&d.start(S);var w=!1,A=function(){return hs(T)},E=function(k){ri(b,k),ks(x,b)&&A()},T=function(){var k,C,O;!g&&ai.indexedDB&&(b={},k={},_&&_.abort(),_=new AbortController,O=function(R){var D=Cn();try{m&&Sn();var N=Bt(s,R);return N=m?N.finally(qt):N}finally{D&&Tn()}}(C={subscr:k,signal:_.signal,requery:A,querier:s,trans:null}),Promise.resolve(O).then(function(R){l=!0,o=R,g||C.signal.aborted||(b={},function(D){for(var N in D)if(v(D,N))return;return 1}(x=k)||w||(Kt(sr,E),w=!0),hs(function(){return!g&&d.next&&d.next(R)}))},function(R){l=!1,["DatabaseClosedError","AbortError"].includes(R==null?void 0:R.name)||g||hs(function(){g||d.error&&d.error(R)})}))};return setTimeout(A,0),S});return c.hasValue=function(){return l},c.getValue=function(){return o},c}var un=Ot;function $s(s){var o=Wt;try{Wt=!0,Kt.storagemutated.fire(s),Os(s,!0)}finally{Wt=o}}I(un,r(r({},Ze),{delete:function(s){return new un(s,{addons:[]}).delete()},exists:function(s){return new un(s,{addons:[]}).open().then(function(o){return o.close(),!0}).catch("NoSuchDatabaseError",function(){return!1})},getDatabaseNames:function(s){try{return o=un.dependencies,l=o.indexedDB,o=o.IDBKeyRange,(Ts(l)?Promise.resolve(l.databases()).then(function(c){return c.map(function(d){return d.name}).filter(function(d){return d!==Wr})}):Cs(l,o).toCollection().primaryKeys()).then(s)}catch{return qe(new ae.MissingAPI)}var o,l},defineClass:function(){return function(s){f(this,s)}},ignoreTransaction:function(s){return he.trans?rn(he.transless,s):s()},vip:Ss,async:function(s){return function(){try{var o=Rs(s.apply(this,arguments));return o&&typeof o.then=="function"?o:ie.resolve(o)}catch(l){return qe(l)}}},spawn:function(s,o,l){try{var c=Rs(s.apply(l,o||[]));return c&&typeof c.then=="function"?c:ie.resolve(c)}catch(d){return qe(d)}},currentTransaction:{get:function(){return he.trans||null}},waitFor:function(s,o){return o=ie.resolve(typeof s=="function"?un.ignoreTransaction(s):s).timeout(o||6e4),he.trans?he.trans.waitFor(o):o},Promise:ie,debug:{get:function(){return Tt},set:function(s){ca(s)}},derive:ue,extend:f,props:I,override:ce,Events:tr,on:Kt,liveQuery:qa,extendObservabilitySet:ri,getByKeyPath:P,setByKeyPath:$,delByKeyPath:function(s,o){typeof o=="string"?$(s,o,void 0):"length"in o&&[].map.call(o,function(l){$(s,l,void 0)})},shallowClone:ne,deepClone:F,getObjectDiff:Ds,cmp:Te,asap:le,minKey:-1/0,addons:[],connections:In,errnames:ft,dependencies:ai,cache:an,semVer:"4.0.11",version:"4.0.11".split(".").map(function(s){return parseInt(s)}).reduce(function(s,o,l){return s+o/Math.pow(10,2*l)})})),un.maxKey=or(un.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(Kt(sr,function(s){Wt||(s=new CustomEvent(gs,{detail:s}),Wt=!0,dispatchEvent(s),Wt=!1)}),addEventListener(gs,function(s){s=s.detail,Wt||$s(s)}));var Pn,Wt=!1,Ua=function(){};return typeof BroadcastChannel<"u"&&((Ua=function(){(Pn=new BroadcastChannel(gs)).onmessage=function(s){return s.data&&$s(s.data)}})(),typeof Pn.unref=="function"&&Pn.unref(),Kt(sr,function(s){Wt||Pn.postMessage(s)})),typeof addEventListener<"u"&&(addEventListener("pagehide",function(s){if(!Ot.disableBfCache&&s.persisted){Tt&&console.debug("Dexie: handling persisted pagehide"),Pn!=null&&Pn.close();for(var o=0,l=In;o<l.length;o++)l[o].close({disableAutoOpen:!1})}}),addEventListener("pageshow",function(s){!Ot.disableBfCache&&s.persisted&&(Tt&&console.debug("Dexie: handling persisted pageshow"),Ua(),$s({all:new tt(-1/0,[[]])}))})),ie.rejectionMapper=function(s,o){return!s||s instanceof Se||s instanceof TypeError||s instanceof SyntaxError||!s.name||!Ke[s.name]?s:(o=new Ke[s.name](o||s.message,s),"stack"in s&&B(o,"stack",{get:function(){return this.inner.stack}}),o)},ca(Tt),r(Ot,Object.freeze({__proto__:null,Dexie:Ot,liveQuery:qa,Entity:ya,cmp:Te,PropModification:rr,replacePrefix:function(s,o){return new rr({replacePrefix:[s,o]})},add:function(s){return new rr({add:s})},remove:function(s){return new rr({remove:s})},default:Ot,RangeSet:tt,mergeRanges:lr,rangesOverlap:Oa}),{default:Ot}),Ot})}(gi)),gi.exports}var lg=ug();const go=Qt(lg),Gu=Symbol.for("Dexie"),qi=globalThis[Gu]||(globalThis[Gu]=go);if(go.semVer!==qi.semVer)throw new Error(`Two different versions of Dexie loaded in the same app: ${go.semVer} and ${qi.semVer}`);const{liveQuery:Py,mergeRanges:Oy,rangesOverlap:Ry,RangeSet:Dy,cmp:My,Entity:Ny,PropModification:Ly,replacePrefix:$y,add:Fy,remove:jy}=qi,yn=new qi("blitzedOut");yn.version(2).stores({customTiles:"++id, group, intensity, action, isEnabled, tags, gameMode, isCustom, locale",gameBoard:"++id, title, tiles, tags, gameMode, isActive"});yn.use(og({tables:["customTiles","gameBoard"]}));const{customTiles:Ct}=yn;Ct.hook("creating",function(n,e){e.locale===void 0&&(e.locale="en"),e.gameMode===void 0&&(e.gameMode="online"),e.isCustom===void 0&&(e.isCustom=1)});const cg=async n=>{const e=n.map(t=>({...t,isEnabled:1}));return await Ct.bulkAdd(e)},ns=async(n={})=>{const{page:e=1,limit:t=50,paginated:r=!1}=n,i=["locale","gameMode","group","intensity","tag","isCustom","action"];try{let a=Ct,u=!1;if(Object.entries(n).filter(([v])=>i.includes(v)).forEach(([v,I])=>{I==null||I===""||(v==="tag"?u?a=a.and(M=>M.tags.includes(I)):(a=a.filter(M=>M.tags.includes(I)),u=!0):u?a=a.and(M=>M[v]===I):(a=a.where(v).equals(I),u=!0))}),!r)return await a.toArray();const f=await a.count(),p=(e-1)*t;return{items:await a.offset(p).limit(t).toArray(),total:f,page:e,limit:t,totalPages:Math.ceil(f/t)}}catch{return r?{items:[],total:0,page:e,limit:t,totalPages:0}:[]}},By=async(n="en",e="online",t=null)=>{let r=Ct.where("locale").equals(n).and(a=>a.gameMode===e);return t&&(r=r.and(a=>a.tags.some(u=>t.includes(u)))),(await r.toArray()).reduce((a,u)=>{const h=u.group;a[h]||(a[h]={count:0,intensities:{}}),a[h].count++;const f=Number(u.intensity);return a[h].intensities[f]||(a[h].intensities[f]=0),a[h].intensities[f]++,a},{})},qy=(n=null)=>{const e=Hu.resolvedLanguage||Hu.language||"en";let t=Ct.where("locale").equals(e).and(r=>r.isEnabled===1);return n&&(t=t.and(r=>r.gameMode===n)),t.toArray()},hg=async n=>await Ct.add({...n,isEnabled:1}),Uy=async(n,e)=>await Ct.update(n,e),Vy=async n=>{const e=await Ct.get(n);return await Ct.update(n,{isEnabled:e.isEnabled?0:1})},fg=async()=>await Ct.where("isCustom").equals(1).delete(),Ky=async n=>await Ct.delete(n),{gameBoard:$t}=yn,dg=()=>$t.orderBy("title").toArray(),Wy=()=>$t.where("isActive").equals(1).first()||{},pg=async n=>await $t.add(n),mg=async(n,e)=>await $t.update(n.id,{...n,...e}),_g=async n=>{var r,i;const e={title:n.title===void 0?"":n.title,tiles:n.tiles,isActive:n.isActive===void 0?1:n.isActive,tags:n.tags||[],gameMode:n.gameMode||"online"};if(!((r=e==null?void 0:e.title)!=null&&r.length)&&((i=e==null?void 0:e.tiles)!=null&&i.length))return;const t=await $t.where("title").equals(e.title).first();return yn.transaction("rw",yn.gameBoard,async()=>(e.isActive&&await gg(),t?(await mg(t,n),t.id):await pg(e)))},Yy=async n=>{const t=(await $t.toArray()).map(r=>({...r,isActive:r.id===n?1:0}));await $t.bulkPut(t)},Hy=async n=>await $t.delete(n),gg=async()=>{await $t.where("isActive").equals(1).modify({isActive:0})},la=ll();async function yg(){const e=at().currentUser;if(!e)return console.error("No user logged in"),!1;try{const t=await ns({isCustom:1});return t.length&&await dl(Pr(la,"user-data",e.uid),{customTiles:t,lastUpdated:new Date},{merge:!0}),!0}catch(t){return console.error("Error syncing custom tiles:",t),!1}}async function vg(){const e=at().currentUser;if(!e)return console.error("No user logged in"),!1;try{const t=await dg();return t.length&&await dl(Pr(la,"user-data",e.uid),{gameBoards:t,lastUpdated:new Date},{merge:!0}),!0}catch(t){return console.error("Error syncing game boards:",t),!1}}async function Qs(){return await yg(),await vg(),!0}async function yo(){var t;const e=at().currentUser;if(!e)return console.error("No user logged in"),!1;try{const r=Pr(la,"user-data",e.uid),i=await cl(r);if(!i.exists())return!1;const a=i.data();if(a.customTiles&&a.customTiles.length>0){fg();for(const u of a.customTiles)(await ns({gameMode:u.gameMode,group:u.group,intensity:u.intensity,action:u.action})).length||await hg(u);console.log(`${a.customTiles.length} custom tiles imported`)}if(a.gameBoards&&a.gameBoards.length>0){for(const u of a.gameBoards)await _g({title:u.title,tiles:u.tiles,tags:u.tags||[],gameMode:u.gameMode||"online",isActive:u.isActive||0});console.log(`${(t=a.gameBoards)==null?void 0:t.length} game boards imported`)}return!0}catch(r){return console.error("Error syncing data:",r),!1}}let yi=null;function wg(n=5){zc();const e=n*60*1e3;return yi=setInterval(async()=>{const t=at();t.currentUser&&!t.currentUser.isAnonymous?(console.log("Performing periodic sync from Firebase..."),await yo()):console.log("Skipping periodic sync - no user logged in")},e),yo(),!0}function zc(){return yi?(clearInterval(yi),yi=null,!0):!1}at().onAuthStateChanged(n=>{n?wg():zc()});const Gc=Js.createContext();function bg(n){const[e,t]=ke.useState(null),[r,i]=ke.useState(!0),[a,u]=ke.useState(null),[h,f]=ke.useState({syncing:!1,lastSync:null}),p=ke.useRef(null),y=async le=>{if(p.current&&(clearTimeout(p.current),p.current=null),!e||e.isAnonymous)return!1;try{return f({syncing:!0,lastSync:h.lastSync}),await le(),f({syncing:!1,lastSync:new Date}),!0}catch(P){return console.error("Sync error:",P),u(P.message),f({syncing:!1,lastSync:h.lastSync}),!1}};async function v(le=""){try{const P=await O_(le);return t(P),P}catch(P){throw u(P.message),P}}async function I(le,P){try{i(!0);const $=await D_(le,P);return t($),$}catch($){throw u($.message),$}finally{i(!1)}}async function M(){try{i(!0);const le=await M_();return t(le),le}catch(le){throw u(le.message),le}finally{i(!1)}}async function B(le,P,$){try{i(!0);const ne=await R_(le,P,$);return t(ne),ne}catch(ne){throw u(ne.message),ne}finally{i(!1)}}async function ue(le){try{return await N_(le),!0}catch(P){throw u(P.message),P}}async function Z(le,P){try{i(!0);const $=await L_(le,P);return t($),await y(Qs),$}catch($){throw u($.message),$}finally{i(!1)}}async function de(le=""){try{const P=await j_(le);return t(P),P}catch(P){throw u(P.message),P}}async function _e(){try{if(e&&!e.isAnonymous){const le=y(Qs),P=new Promise($=>setTimeout($,5e3,!1));await Promise.race([le,P])}await $_(),t(null)}catch(le){throw u(le.message),le}}async function ce(){return y(Qs)}ke.useEffect(()=>{const P=at().onAuthStateChanged($=>{t($||null),i(!1),$&&!$.isAnonymous&&(p.current&&clearTimeout(p.current),p.current=setTimeout(()=>{f({syncing:!0,lastSync:null}),yo().then(()=>{f({syncing:!1,lastSync:new Date})}).catch(ne=>{console.error("Error syncing from Firebase:",ne),f({syncing:!1,lastSync:null})}).finally(()=>{p.current=null})},500))});return window.authContext={user:null},()=>{P(),p.current&&clearTimeout(p.current),window.authContext=void 0}},[]),ke.useEffect(()=>{window.authContext&&(window.authContext.user=e)},[e]);const Ae=ke.useMemo(()=>({user:e,loading:r,error:a,syncStatus:h,login:v,loginEmail:I,loginGoogle:M,register:B,updateUser:de,forgotPassword:ue,convertToRegistered:Z,logout:_e,syncData:ce,isAnonymous:(e==null?void 0:e.isAnonymous)||!1}),[e,r,a,h]);return Re.jsx(Gc.Provider,{value:Ae,...n})}function Eg(){const n=ke.useContext(Gc);if(n===void 0)throw new Error("useAuth must be used within an AuthProvider");return n}var vi={exports:{}},xg=vi.exports,Qu;function Cg(){return Qu||(Qu=1,function(n,e){(function(t,r){n.exports=r()})(xg,function(){var t=1e3,r=6e4,i=36e5,a="millisecond",u="second",h="minute",f="hour",p="day",y="week",v="month",I="quarter",M="year",B="date",ue="Invalid Date",Z=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,de=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,_e={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(V){var j=["th","st","nd","rd"],U=V%100;return"["+V+(j[(U-20)%10]||j[U]||j[0])+"]"}},ce=function(V,j,U){var re=String(V);return!re||re.length>=j?V:""+Array(j+1-re.length).join(U)+V},Ae={s:ce,z:function(V){var j=-V.utcOffset(),U=Math.abs(j),re=Math.floor(U/60),Y=U%60;return(j<=0?"+":"-")+ce(re,2,"0")+":"+ce(Y,2,"0")},m:function V(j,U){if(j.date()<U.date())return-V(U,j);var re=12*(U.year()-j.year())+(U.month()-j.month()),Y=j.clone().add(re,v),z=U-Y<0,oe=j.clone().add(re+(z?-1:1),v);return+(-(re+(U-Y)/(z?Y-oe:oe-Y))||0)},a:function(V){return V<0?Math.ceil(V)||0:Math.floor(V)},p:function(V){return{M:v,y:M,w:y,d:p,D:B,h:f,m:h,s:u,ms:a,Q:I}[V]||String(V||"").toLowerCase().replace(/s$/,"")},u:function(V){return V===void 0}},le="en",P={};P[le]=_e;var $="$isDayjsObject",ne=function(V){return V instanceof fe||!(!V||!V[$])},H=function V(j,U,re){var Y;if(!j)return le;if(typeof j=="string"){var z=j.toLowerCase();P[z]&&(Y=z),U&&(P[z]=U,Y=z);var oe=j.split("-");if(!Y&&oe.length>1)return V(oe[0])}else{var pe=j.name;P[pe]=j,Y=pe}return!re&&Y&&(le=Y),Y||!re&&le},ee=function(V,j){if(ne(V))return V.clone();var U=typeof j=="object"?j:{};return U.date=V,U.args=arguments,new fe(U)},L=Ae;L.l=H,L.i=ne,L.w=function(V,j){return ee(V,{locale:j.$L,utc:j.$u,x:j.$x,$offset:j.$offset})};var fe=function(){function V(U){this.$L=H(U.locale,null,!0),this.parse(U),this.$x=this.$x||U.x||{},this[$]=!0}var j=V.prototype;return j.parse=function(U){this.$d=function(re){var Y=re.date,z=re.utc;if(Y===null)return new Date(NaN);if(L.u(Y))return new Date;if(Y instanceof Date)return new Date(Y);if(typeof Y=="string"&&!/Z$/i.test(Y)){var oe=Y.match(Z);if(oe){var pe=oe[2]-1||0,Ie=(oe[7]||"0").substring(0,3);return z?new Date(Date.UTC(oe[1],pe,oe[3]||1,oe[4]||0,oe[5]||0,oe[6]||0,Ie)):new Date(oe[1],pe,oe[3]||1,oe[4]||0,oe[5]||0,oe[6]||0,Ie)}}return new Date(Y)}(U),this.init()},j.init=function(){var U=this.$d;this.$y=U.getFullYear(),this.$M=U.getMonth(),this.$D=U.getDate(),this.$W=U.getDay(),this.$H=U.getHours(),this.$m=U.getMinutes(),this.$s=U.getSeconds(),this.$ms=U.getMilliseconds()},j.$utils=function(){return L},j.isValid=function(){return this.$d.toString()!==ue},j.isSame=function(U,re){var Y=ee(U);return this.startOf(re)<=Y&&Y<=this.endOf(re)},j.isAfter=function(U,re){return ee(U)<this.startOf(re)},j.isBefore=function(U,re){return this.endOf(re)<ee(U)},j.$g=function(U,re,Y){return L.u(U)?this[re]:this.set(Y,U)},j.unix=function(){return Math.floor(this.valueOf()/1e3)},j.valueOf=function(){return this.$d.getTime()},j.startOf=function(U,re){var Y=this,z=!!L.u(re)||re,oe=L.p(U),pe=function(ae,Ke){var Ze=L.w(Y.$u?Date.UTC(Y.$y,Ke,ae):new Date(Y.$y,Ke,ae),Y);return z?Ze:Ze.endOf(p)},Ie=function(ae,Ke){return L.w(Y.toDate()[ae].apply(Y.toDate("s"),(z?[0,0,0,0]:[23,59,59,999]).slice(Ke)),Y)},Se=this.$W,Ne=this.$M,Fe=this.$D,st="set"+(this.$u?"UTC":"");switch(oe){case M:return z?pe(1,0):pe(31,11);case v:return z?pe(1,Ne):pe(0,Ne+1);case y:var ft=this.$locale().weekStart||0,At=(Se<ft?Se+7:Se)-ft;return pe(z?Fe-At:Fe+(6-At),Ne);case p:case B:return Ie(st+"Hours",0);case f:return Ie(st+"Minutes",1);case h:return Ie(st+"Seconds",2);case u:return Ie(st+"Milliseconds",3);default:return this.clone()}},j.endOf=function(U){return this.startOf(U,!1)},j.$set=function(U,re){var Y,z=L.p(U),oe="set"+(this.$u?"UTC":""),pe=(Y={},Y[p]=oe+"Date",Y[B]=oe+"Date",Y[v]=oe+"Month",Y[M]=oe+"FullYear",Y[f]=oe+"Hours",Y[h]=oe+"Minutes",Y[u]=oe+"Seconds",Y[a]=oe+"Milliseconds",Y)[z],Ie=z===p?this.$D+(re-this.$W):re;if(z===v||z===M){var Se=this.clone().set(B,1);Se.$d[pe](Ie),Se.init(),this.$d=Se.set(B,Math.min(this.$D,Se.daysInMonth())).$d}else pe&&this.$d[pe](Ie);return this.init(),this},j.set=function(U,re){return this.clone().$set(U,re)},j.get=function(U){return this[L.p(U)]()},j.add=function(U,re){var Y,z=this;U=Number(U);var oe=L.p(re),pe=function(Ne){var Fe=ee(z);return L.w(Fe.date(Fe.date()+Math.round(Ne*U)),z)};if(oe===v)return this.set(v,this.$M+U);if(oe===M)return this.set(M,this.$y+U);if(oe===p)return pe(1);if(oe===y)return pe(7);var Ie=(Y={},Y[h]=r,Y[f]=i,Y[u]=t,Y)[oe]||1,Se=this.$d.getTime()+U*Ie;return L.w(Se,this)},j.subtract=function(U,re){return this.add(-1*U,re)},j.format=function(U){var re=this,Y=this.$locale();if(!this.isValid())return Y.invalidDate||ue;var z=U||"YYYY-MM-DDTHH:mm:ssZ",oe=L.z(this),pe=this.$H,Ie=this.$m,Se=this.$M,Ne=Y.weekdays,Fe=Y.months,st=Y.meridiem,ft=function(Ke,Ze,we,ut){return Ke&&(Ke[Ze]||Ke(re,z))||we[Ze].slice(0,ut)},At=function(Ke){return L.s(pe%12||12,Ke,"0")},ae=st||function(Ke,Ze,we){var ut=Ke<12?"AM":"PM";return we?ut.toLowerCase():ut};return z.replace(de,function(Ke,Ze){return Ze||function(we){switch(we){case"YY":return String(re.$y).slice(-2);case"YYYY":return L.s(re.$y,4,"0");case"M":return Se+1;case"MM":return L.s(Se+1,2,"0");case"MMM":return ft(Y.monthsShort,Se,Fe,3);case"MMMM":return ft(Fe,Se);case"D":return re.$D;case"DD":return L.s(re.$D,2,"0");case"d":return String(re.$W);case"dd":return ft(Y.weekdaysMin,re.$W,Ne,2);case"ddd":return ft(Y.weekdaysShort,re.$W,Ne,3);case"dddd":return Ne[re.$W];case"H":return String(pe);case"HH":return L.s(pe,2,"0");case"h":return At(1);case"hh":return At(2);case"a":return ae(pe,Ie,!0);case"A":return ae(pe,Ie,!1);case"m":return String(Ie);case"mm":return L.s(Ie,2,"0");case"s":return String(re.$s);case"ss":return L.s(re.$s,2,"0");case"SSS":return L.s(re.$ms,3,"0");case"Z":return oe}return null}(Ke)||oe.replace(":","")})},j.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},j.diff=function(U,re,Y){var z,oe=this,pe=L.p(re),Ie=ee(U),Se=(Ie.utcOffset()-this.utcOffset())*r,Ne=this-Ie,Fe=function(){return L.m(oe,Ie)};switch(pe){case M:z=Fe()/12;break;case v:z=Fe();break;case I:z=Fe()/3;break;case y:z=(Ne-Se)/6048e5;break;case p:z=(Ne-Se)/864e5;break;case f:z=Ne/i;break;case h:z=Ne/r;break;case u:z=Ne/t;break;default:z=Ne}return Y?z:L.a(z)},j.daysInMonth=function(){return this.endOf(v).$D},j.$locale=function(){return P[this.$L]},j.locale=function(U,re){if(!U)return this.$L;var Y=this.clone(),z=H(U,re,!0);return z&&(Y.$L=z),Y},j.clone=function(){return L.w(this.$d,this)},j.toDate=function(){return new Date(this.valueOf())},j.toJSON=function(){return this.isValid()?this.toISOString():null},j.toISOString=function(){return this.$d.toISOString()},j.toString=function(){return this.$d.toUTCString()},V}(),F=fe.prototype;return ee.prototype=F,[["$ms",a],["$s",u],["$m",h],["$H",f],["$W",p],["$M",v],["$y",M],["$D",B]].forEach(function(V){F[V[1]]=function(j){return this.$g(j,V[0],V[1])}}),ee.extend=function(V,j){return V.$i||(V(j,fe,ee),V.$i=!0),ee},ee.locale=H,ee.isDayjs=ne,ee.unix=function(V){return ee(1e3*V)},ee.en=P[le],ee.Ls=P,ee.p={},ee})}(vi)),vi.exports}var Tg=Cg();const ze=Qt(Tg);var wi={exports:{}},Sg=wi.exports,Xu;function Ig(){return Xu||(Xu=1,function(n,e){(function(t,r){n.exports=r()})(Sg,function(){var t="week",r="year";return function(i,a,u){var h=a.prototype;h.week=function(f){if(f===void 0&&(f=null),f!==null)return this.add(7*(f-this.week()),"day");var p=this.$locale().yearStart||1;if(this.month()===11&&this.date()>25){var y=u(this).startOf(r).add(1,r).date(p),v=u(this).endOf(t);if(y.isBefore(v))return 1}var I=u(this).startOf(r).date(p).startOf(t).subtract(1,"millisecond"),M=this.diff(I,t,!0);return M<0?u(this).startOf("week").week():Math.ceil(M)},h.weeks=function(f){return f===void 0&&(f=null),this.week(f)}}})}(wi)),wi.exports}var kg=Ig();const Ag=Qt(kg);var bi={exports:{}},Pg=bi.exports,Ju;function Og(){return Ju||(Ju=1,function(n,e){(function(t,r){n.exports=r()})(Pg,function(){var t={LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"},r=/(\[[^[]*\])|([-_:/.,()\s]+)|(A|a|Q|YYYY|YY?|ww?|MM?M?M?|Do|DD?|hh?|HH?|mm?|ss?|S{1,3}|z|ZZ?)/g,i=/\d/,a=/\d\d/,u=/\d\d?/,h=/\d*[^-_:/,()\s\d]+/,f={},p=function(Z){return(Z=+Z)+(Z>68?1900:2e3)},y=function(Z){return function(de){this[Z]=+de}},v=[/[+-]\d\d:?(\d\d)?|Z/,function(Z){(this.zone||(this.zone={})).offset=function(de){if(!de||de==="Z")return 0;var _e=de.match(/([+-]|\d\d)/g),ce=60*_e[1]+(+_e[2]||0);return ce===0?0:_e[0]==="+"?-ce:ce}(Z)}],I=function(Z){var de=f[Z];return de&&(de.indexOf?de:de.s.concat(de.f))},M=function(Z,de){var _e,ce=f.meridiem;if(ce){for(var Ae=1;Ae<=24;Ae+=1)if(Z.indexOf(ce(Ae,0,de))>-1){_e=Ae>12;break}}else _e=Z===(de?"pm":"PM");return _e},B={A:[h,function(Z){this.afternoon=M(Z,!1)}],a:[h,function(Z){this.afternoon=M(Z,!0)}],Q:[i,function(Z){this.month=3*(Z-1)+1}],S:[i,function(Z){this.milliseconds=100*+Z}],SS:[a,function(Z){this.milliseconds=10*+Z}],SSS:[/\d{3}/,function(Z){this.milliseconds=+Z}],s:[u,y("seconds")],ss:[u,y("seconds")],m:[u,y("minutes")],mm:[u,y("minutes")],H:[u,y("hours")],h:[u,y("hours")],HH:[u,y("hours")],hh:[u,y("hours")],D:[u,y("day")],DD:[a,y("day")],Do:[h,function(Z){var de=f.ordinal,_e=Z.match(/\d+/);if(this.day=_e[0],de)for(var ce=1;ce<=31;ce+=1)de(ce).replace(/\[|\]/g,"")===Z&&(this.day=ce)}],w:[u,y("week")],ww:[a,y("week")],M:[u,y("month")],MM:[a,y("month")],MMM:[h,function(Z){var de=I("months"),_e=(I("monthsShort")||de.map(function(ce){return ce.slice(0,3)})).indexOf(Z)+1;if(_e<1)throw new Error;this.month=_e%12||_e}],MMMM:[h,function(Z){var de=I("months").indexOf(Z)+1;if(de<1)throw new Error;this.month=de%12||de}],Y:[/[+-]?\d+/,y("year")],YY:[a,function(Z){this.year=p(Z)}],YYYY:[/\d{4}/,y("year")],Z:v,ZZ:v};function ue(Z){var de,_e;de=Z,_e=f&&f.formats;for(var ce=(Z=de.replace(/(\[[^\]]+])|(LTS?|l{1,4}|L{1,4})/g,function(ee,L,fe){var F=fe&&fe.toUpperCase();return L||_e[fe]||t[fe]||_e[F].replace(/(\[[^\]]+])|(MMMM|MM|DD|dddd)/g,function(V,j,U){return j||U.slice(1)})})).match(r),Ae=ce.length,le=0;le<Ae;le+=1){var P=ce[le],$=B[P],ne=$&&$[0],H=$&&$[1];ce[le]=H?{regex:ne,parser:H}:P.replace(/^\[|\]$/g,"")}return function(ee){for(var L={},fe=0,F=0;fe<Ae;fe+=1){var V=ce[fe];if(typeof V=="string")F+=V.length;else{var j=V.regex,U=V.parser,re=ee.slice(F),Y=j.exec(re)[0];U.call(L,Y),ee=ee.replace(Y,"")}}return function(z){var oe=z.afternoon;if(oe!==void 0){var pe=z.hours;oe?pe<12&&(z.hours+=12):pe===12&&(z.hours=0),delete z.afternoon}}(L),L}}return function(Z,de,_e){_e.p.customParseFormat=!0,Z&&Z.parseTwoDigitYear&&(p=Z.parseTwoDigitYear);var ce=de.prototype,Ae=ce.parse;ce.parse=function(le){var P=le.date,$=le.utc,ne=le.args;this.$u=$;var H=ne[1];if(typeof H=="string"){var ee=ne[2]===!0,L=ne[3]===!0,fe=ee||L,F=ne[2];L&&(F=ne[2]),f=this.$locale(),!ee&&F&&(f=_e.Ls[F]),this.$d=function(re,Y,z,oe){try{if(["x","X"].indexOf(Y)>-1)return new Date((Y==="X"?1e3:1)*re);var pe=ue(Y)(re),Ie=pe.year,Se=pe.month,Ne=pe.day,Fe=pe.hours,st=pe.minutes,ft=pe.seconds,At=pe.milliseconds,ae=pe.zone,Ke=pe.week,Ze=new Date,we=Ne||(Ie||Se?1:Ze.getDate()),ut=Ie||Ze.getFullYear(),xn=0;Ie&&!Se||(xn=Se>0?Se-1:Ze.getMonth());var _t,Hn=Fe||0,zn=st||0,Gn=ft||0,Qn=At||0;return ae?new Date(Date.UTC(ut,xn,we,Hn,zn,Gn,Qn+60*ae.offset*1e3)):z?new Date(Date.UTC(ut,xn,we,Hn,zn,Gn,Qn)):(_t=new Date(ut,xn,we,Hn,zn,Gn,Qn),Ke&&(_t=oe(_t).week(Ke).toDate()),_t)}catch{return new Date("")}}(P,H,$,_e),this.init(),F&&F!==!0&&(this.$L=this.locale(F).$L),fe&&P!=this.format(H)&&(this.$d=new Date("")),f={}}else if(H instanceof Array)for(var V=H.length,j=1;j<=V;j+=1){ne[1]=H[j-1];var U=_e.apply(this,ne);if(U.isValid()){this.$d=U.$d,this.$L=U.$L,this.init();break}j===V&&(this.$d=new Date(""))}else Ae.call(this,le)}}})}(bi)),bi.exports}var Rg=Og();const Dg=Qt(Rg);var Ei={exports:{}},Mg=Ei.exports,Zu;function Ng(){return Zu||(Zu=1,function(n,e){(function(t,r){n.exports=r()})(Mg,function(){var t={LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"};return function(r,i,a){var u=i.prototype,h=u.format;a.en.formats=t,u.format=function(f){f===void 0&&(f="YYYY-MM-DDTHH:mm:ssZ");var p=this.$locale().formats,y=function(v,I){return v.replace(/(\[[^\]]+])|(LTS?|l{1,4}|L{1,4})/g,function(M,B,ue){var Z=ue&&ue.toUpperCase();return B||I[ue]||t[ue]||I[Z].replace(/(\[[^\]]+])|(MMMM|MM|DD|dddd)/g,function(de,_e,ce){return _e||ce.slice(1)})})}(f,p===void 0?{}:p);return h.call(this,y)}}})}(Ei)),Ei.exports}var Lg=Ng();const $g=Qt(Lg);var xi={exports:{}},Fg=xi.exports,el;function jg(){return el||(el=1,function(n,e){(function(t,r){n.exports=r()})(Fg,function(){return function(t,r,i){r.prototype.isBetween=function(a,u,h,f){var p=i(a),y=i(u),v=(f=f||"()")[0]==="(",I=f[1]===")";return(v?this.isAfter(p,h):!this.isBefore(p,h))&&(I?this.isBefore(y,h):!this.isAfter(y,h))||(v?this.isBefore(p,h):!this.isAfter(p,h))&&(I?this.isAfter(y,h):!this.isBefore(y,h))}}})}(xi)),xi.exports}var Bg=jg();const qg=Qt(Bg);var Ci={exports:{}},Ug=Ci.exports,tl;function Vg(){return tl||(tl=1,function(n,e){(function(t,r){n.exports=r()})(Ug,function(){return function(t,r){var i=r.prototype,a=i.format;i.format=function(u){var h=this,f=this.$locale();if(!this.isValid())return a.bind(this)(u);var p=this.$utils(),y=(u||"YYYY-MM-DDTHH:mm:ssZ").replace(/\[([^\]]+)]|Q|wo|ww|w|WW|W|zzz|z|gggg|GGGG|Do|X|x|k{1,2}|S/g,function(v){switch(v){case"Q":return Math.ceil((h.$M+1)/3);case"Do":return f.ordinal(h.$D);case"gggg":return h.weekYear();case"GGGG":return h.isoWeekYear();case"wo":return f.ordinal(h.week(),"W");case"w":case"ww":return p.s(h.week(),v==="w"?1:2,"0");case"W":case"WW":return p.s(h.isoWeek(),v==="W"?1:2,"0");case"k":case"kk":return p.s(String(h.$H===0?24:h.$H),v==="k"?1:2,"0");case"X":return Math.floor(h.$d.getTime()/1e3);case"x":return h.$d.getTime();case"z":return"["+h.offsetName()+"]";case"zzz":return"["+h.offsetName("long")+"]";default:return v}});return a.bind(this)(y)}}})}(Ci)),Ci.exports}var Kg=Vg();const Wg=Qt(Kg);ze.extend($g);ze.extend(Ag);ze.extend(qg);ze.extend(Wg);const Yg={YY:"year",YYYY:{sectionType:"year",contentType:"digit",maxLength:4},M:{sectionType:"month",contentType:"digit",maxLength:2},MM:"month",MMM:{sectionType:"month",contentType:"letter"},MMMM:{sectionType:"month",contentType:"letter"},D:{sectionType:"day",contentType:"digit",maxLength:2},DD:"day",Do:{sectionType:"day",contentType:"digit-with-letter"},d:{sectionType:"weekDay",contentType:"digit",maxLength:2},dd:{sectionType:"weekDay",contentType:"letter"},ddd:{sectionType:"weekDay",contentType:"letter"},dddd:{sectionType:"weekDay",contentType:"letter"},A:"meridiem",a:"meridiem",H:{sectionType:"hours",contentType:"digit",maxLength:2},HH:"hours",h:{sectionType:"hours",contentType:"digit",maxLength:2},hh:"hours",m:{sectionType:"minutes",contentType:"digit",maxLength:2},mm:"minutes",s:{sectionType:"seconds",contentType:"digit",maxLength:2},ss:"seconds"},Hg={year:"YYYY",month:"MMMM",monthShort:"MMM",dayOfMonth:"D",dayOfMonthFull:"Do",weekday:"dddd",weekdayShort:"dd",hours24h:"HH",hours12h:"hh",meridiem:"A",minutes:"mm",seconds:"ss",fullDate:"ll",keyboardDate:"L",shortDate:"MMM D",normalDate:"D MMMM",normalDateWithWeekday:"ddd, MMM D",fullTime:"LT",fullTime12h:"hh:mm A",fullTime24h:"HH:mm",keyboardDateTime:"L LT",keyboardDateTime12h:"L hh:mm A",keyboardDateTime24h:"L HH:mm"},Xs=["Missing UTC plugin","To be able to use UTC or timezones, you have to enable the `utc` plugin","Find more information on https://mui.com/x/react-date-pickers/timezone/#day-js-and-utc"].join(`
`),nl=["Missing timezone plugin","To be able to use timezones, you have to enable both the `utc` and the `timezone` plugin","Find more information on https://mui.com/x/react-date-pickers/timezone/#day-js-and-timezone"].join(`
`),zg=(n,e)=>e?(...t)=>n(...t).locale(e):n;class Gg{constructor({locale:e,formats:t}={}){this.isMUIAdapter=!0,this.isTimezoneCompatible=!0,this.lib="dayjs",this.dayjs=void 0,this.locale=void 0,this.formats=void 0,this.escapedCharacters={start:"[",end:"]"},this.formatTokenMap=Yg,this.setLocaleToValue=r=>{const i=this.getCurrentLocaleCode();return i===r.locale()?r:r.locale(i)},this.hasUTCPlugin=()=>typeof ze.utc<"u",this.hasTimezonePlugin=()=>typeof ze.tz<"u",this.isSame=(r,i,a)=>{const u=this.setTimezone(i,this.getTimezone(r));return r.format(a)===u.format(a)},this.cleanTimezone=r=>{switch(r){case"default":return;case"system":return ze.tz.guess();default:return r}},this.createSystemDate=r=>{if(this.hasUTCPlugin()&&this.hasTimezonePlugin()){const i=ze.tz.guess();return i!=="UTC"?ze.tz(r,i):ze(r)}return ze(r)},this.createUTCDate=r=>{if(!this.hasUTCPlugin())throw new Error(Xs);return ze.utc(r)},this.createTZDate=(r,i)=>{if(!this.hasUTCPlugin())throw new Error(Xs);if(!this.hasTimezonePlugin())throw new Error(nl);const a=r!==void 0&&!r.endsWith("Z");return ze(r).tz(this.cleanTimezone(i),a)},this.getLocaleFormats=()=>{const r=ze.Ls,i=this.locale||"en";let a=r[i];return a===void 0&&(a=r.en),a.formats},this.adjustOffset=r=>{if(!this.hasTimezonePlugin())return r;const i=this.getTimezone(r);if(i!=="UTC"){const a=r.tz(this.cleanTimezone(i),!0);if(a.$offset===(r.$offset??0))return r;r.$offset=a.$offset}return r},this.date=(r,i="default")=>{if(r===null)return null;let a;return i==="UTC"?a=this.createUTCDate(r):i==="system"||i==="default"&&!this.hasTimezonePlugin()?a=this.createSystemDate(r):a=this.createTZDate(r,i),this.locale===void 0?a:a.locale(this.locale)},this.getInvalidDate=()=>ze(new Date("Invalid date")),this.getTimezone=r=>{var i;if(this.hasTimezonePlugin()){const a=(i=r.$x)==null?void 0:i.$timezone;if(a)return a}return this.hasUTCPlugin()&&r.isUTC()?"UTC":"system"},this.setTimezone=(r,i)=>{if(this.getTimezone(r)===i)return r;if(i==="UTC"){if(!this.hasUTCPlugin())throw new Error(Xs);return r.utc()}if(i==="system")return r.local();if(!this.hasTimezonePlugin()){if(i==="default")return r;throw new Error(nl)}return ze.tz(r,this.cleanTimezone(i))},this.toJsDate=r=>r.toDate(),this.parse=(r,i)=>r===""?null:this.dayjs(r,i,this.locale,!0),this.getCurrentLocaleCode=()=>this.locale||"en",this.is12HourCycleInCurrentLocale=()=>/A|a/.test(this.getLocaleFormats().LT||""),this.expandFormat=r=>{const i=this.getLocaleFormats(),a=u=>u.replace(/(\[[^\]]+])|(MMMM|MM|DD|dddd)/g,(h,f,p)=>f||p.slice(1));return r.replace(/(\[[^\]]+])|(LTS?|l{1,4}|L{1,4})/g,(u,h,f)=>{const p=f&&f.toUpperCase();return h||i[f]||a(i[p])})},this.isValid=r=>r==null?!1:r.isValid(),this.format=(r,i)=>this.formatByString(r,this.formats[i]),this.formatByString=(r,i)=>this.dayjs(r).format(i),this.formatNumber=r=>r,this.isEqual=(r,i)=>r===null&&i===null?!0:r===null||i===null?!1:r.toDate().getTime()===i.toDate().getTime(),this.isSameYear=(r,i)=>this.isSame(r,i,"YYYY"),this.isSameMonth=(r,i)=>this.isSame(r,i,"YYYY-MM"),this.isSameDay=(r,i)=>this.isSame(r,i,"YYYY-MM-DD"),this.isSameHour=(r,i)=>r.isSame(i,"hour"),this.isAfter=(r,i)=>r>i,this.isAfterYear=(r,i)=>this.hasUTCPlugin()?!this.isSameYear(r,i)&&r.utc()>i.utc():r.isAfter(i,"year"),this.isAfterDay=(r,i)=>this.hasUTCPlugin()?!this.isSameDay(r,i)&&r.utc()>i.utc():r.isAfter(i,"day"),this.isBefore=(r,i)=>r<i,this.isBeforeYear=(r,i)=>this.hasUTCPlugin()?!this.isSameYear(r,i)&&r.utc()<i.utc():r.isBefore(i,"year"),this.isBeforeDay=(r,i)=>this.hasUTCPlugin()?!this.isSameDay(r,i)&&r.utc()<i.utc():r.isBefore(i,"day"),this.isWithinRange=(r,[i,a])=>r>=i&&r<=a,this.startOfYear=r=>this.adjustOffset(r.startOf("year")),this.startOfMonth=r=>this.adjustOffset(r.startOf("month")),this.startOfWeek=r=>this.adjustOffset(this.setLocaleToValue(r).startOf("week")),this.startOfDay=r=>this.adjustOffset(r.startOf("day")),this.endOfYear=r=>this.adjustOffset(r.endOf("year")),this.endOfMonth=r=>this.adjustOffset(r.endOf("month")),this.endOfWeek=r=>this.adjustOffset(this.setLocaleToValue(r).endOf("week")),this.endOfDay=r=>this.adjustOffset(r.endOf("day")),this.addYears=(r,i)=>this.adjustOffset(i<0?r.subtract(Math.abs(i),"year"):r.add(i,"year")),this.addMonths=(r,i)=>this.adjustOffset(i<0?r.subtract(Math.abs(i),"month"):r.add(i,"month")),this.addWeeks=(r,i)=>this.adjustOffset(i<0?r.subtract(Math.abs(i),"week"):r.add(i,"week")),this.addDays=(r,i)=>this.adjustOffset(i<0?r.subtract(Math.abs(i),"day"):r.add(i,"day")),this.addHours=(r,i)=>this.adjustOffset(i<0?r.subtract(Math.abs(i),"hour"):r.add(i,"hour")),this.addMinutes=(r,i)=>this.adjustOffset(i<0?r.subtract(Math.abs(i),"minute"):r.add(i,"minute")),this.addSeconds=(r,i)=>this.adjustOffset(i<0?r.subtract(Math.abs(i),"second"):r.add(i,"second")),this.getYear=r=>r.year(),this.getMonth=r=>r.month(),this.getDate=r=>r.date(),this.getHours=r=>r.hour(),this.getMinutes=r=>r.minute(),this.getSeconds=r=>r.second(),this.getMilliseconds=r=>r.millisecond(),this.setYear=(r,i)=>this.adjustOffset(r.set("year",i)),this.setMonth=(r,i)=>this.adjustOffset(r.set("month",i)),this.setDate=(r,i)=>this.adjustOffset(r.set("date",i)),this.setHours=(r,i)=>this.adjustOffset(r.set("hour",i)),this.setMinutes=(r,i)=>this.adjustOffset(r.set("minute",i)),this.setSeconds=(r,i)=>this.adjustOffset(r.set("second",i)),this.setMilliseconds=(r,i)=>this.adjustOffset(r.set("millisecond",i)),this.getDaysInMonth=r=>r.daysInMonth(),this.getWeekArray=r=>{const i=this.startOfWeek(this.startOfMonth(r)),a=this.endOfWeek(this.endOfMonth(r));let u=0,h=i;const f=[];for(;h<a;){const p=Math.floor(u/7);f[p]=f[p]||[],f[p].push(h),h=this.addDays(h,1),u+=1}return f},this.getWeekNumber=r=>r.week(),this.getYearRange=([r,i])=>{const a=this.startOfYear(r),u=this.endOfYear(i),h=[];let f=a;for(;this.isBefore(f,u);)h.push(f),f=this.addYears(f,1);return h},this.dayjs=zg(ze,e),this.locale=e,this.formats=sl({},Hg,t),ze.extend(Dg)}getDayOfWeek(e){return e.day()+1}}function Qg(n){return n.sort((e,t)=>e.timestamp.toDate()-t.timestamp.toDate())}function rs(n){return JSON.parse(JSON.stringify(n)).reverse()}function zy(n,e){return rs(n).find(t=>t.type===e)}function Gy(n,e,t="ASC"){let r=rs(n);return t==="DESC"&&(r=r.reverse()),r.filter(i=>i.type===e)}function Qy(n,e){return rs(n).find(e)}function Xy(n){return rs(n)[0]}const Xg=ke.createContext();function Jg(n){const[e,t]=ke.useState([]),[r,i]=ke.useState(!0),{id:a}=al();ke.useEffect(()=>(i(!0),U_(a,f=>{const p=Qg(f);t(p),i(!1)})),[a]);const u={messages:e,isLoading:r};return Re.jsx(Xg.Provider,{value:u,...n})}const Zg=ke.createContext();function ey(n){const{id:e}=al(),[t,r]=ke.useState({});ke.useEffect(()=>{F_(e,a=>r(a),t)},[e]);const i=ke.useMemo(()=>({onlineUsers:t}),[t]);return Re.jsx(Zg.Provider,{value:i,...n})}const ty=ke.createContext();function ny(n){const[e,t]=ke.useState({});ke.useEffect(()=>{V_(i=>t(i))},[]);const r=ke.useMemo(()=>({schedule:e,addToSchedule:K_}),[e]);return Re.jsx(ty.Provider,{value:r,...n})}let vo=Ch({palette:{mode:"dark"}});vo=Th(vo);const ry=vo;async function iy(n="en",e="online"){const t={},r=Object.assign({"../locales/en/local/alcohol.json":()=>q(()=>import("./alcohol-BZAf2NTg.js"),[]),"../locales/en/local/ballBusting.json":()=>q(()=>import("./ballBusting-CBS8OiZP.js"),[]),"../locales/en/local/bating.json":()=>q(()=>import("./bating-D52K66Lu.js"),[]),"../locales/en/local/bondage.json":()=>q(()=>import("./bondage-LgAIGueK.js"),[]),"../locales/en/local/breathPlay.json":()=>q(()=>import("./breathPlay-CRzY7428.js"),[]),"../locales/en/local/buttPlay.json":()=>q(()=>import("./buttPlay-CWeeoMp5.js"),[]),"../locales/en/local/electric.json":()=>q(()=>import("./electric-Bk_TXWk-.js"),[]),"../locales/en/local/footPlay.json":()=>q(()=>import("./footPlay-DD_Xn9fn.js"),[]),"../locales/en/local/gasMask.json":()=>q(()=>import("./gasMask-Cu6WbYgI.js"),[]),"../locales/en/local/humiliation.json":()=>q(()=>import("./humiliation-D38KZgue.js"),[]),"../locales/en/local/kissing.json":()=>q(()=>import("./kissing-DW0pyV1M.js"),[]),"../locales/en/local/pissPlay.json":()=>q(()=>import("./pissPlay-hDj3RXB4.js"),[]),"../locales/en/local/poppers.json":()=>q(()=>import("./poppers-DPi1vlVq.js"),[]),"../locales/en/local/spanking.json":()=>q(()=>import("./spanking-D5ucvdnf.js"),[]),"../locales/en/local/throatTraining.json":()=>q(()=>import("./throatTraining-C66R2Ubj.js"),[]),"../locales/en/local/tickling.json":()=>q(()=>import("./tickling-aQu3phvV.js"),[]),"../locales/en/local/titTorture.json":()=>q(()=>import("./titTorture-B-5XIvPm.js"),[]),"../locales/en/local/vaping.json":()=>q(()=>import("./vaping-Cw_EBTDr.js"),[]),"../locales/en/online/alcohol.json":()=>q(()=>import("./alcohol-mxUDnrw5.js"),[]),"../locales/en/online/ballBusting.json":()=>q(()=>import("./ballBusting-BtcwXD0u.js"),[]),"../locales/en/online/bating.json":()=>q(()=>import("./bating-DlWklRCC.js"),[]),"../locales/en/online/buttPlay.json":()=>q(()=>import("./buttPlay-DNlSUs1v.js"),[]),"../locales/en/online/gasMask.json":()=>q(()=>import("./gasMask-CF8uPBF1.js"),[]),"../locales/en/online/pissPlay.json":()=>q(()=>import("./pissPlay-D6UuWU9w.js"),[]),"../locales/en/online/poppers.json":()=>q(()=>import("./poppers-DYE8WgUc.js"),[]),"../locales/en/online/throatTraining.json":()=>q(()=>import("./throatTraining-CYz7x0-j.js"),[]),"../locales/en/online/titTorture.json":()=>q(()=>import("./titTorture-VJd7QlDN.js"),[]),"../locales/en/online/vaping.json":()=>q(()=>import("./vaping-Cn6qK-lN.js"),[]),"../locales/en/translation.json":()=>q(()=>import("./translation-DeSZgpz-.js"),[]),"../locales/es/local/alcohol.json":()=>q(()=>import("./alcohol-eOgMZGYI.js"),[]),"../locales/es/local/ballBusting.json":()=>q(()=>import("./ballBusting-DMROHcXY.js"),[]),"../locales/es/local/bating.json":()=>q(()=>import("./bating-BIyhCVw0.js"),[]),"../locales/es/local/bondage.json":()=>q(()=>import("./bondage-cr6DtteZ.js"),[]),"../locales/es/local/breathPlay.json":()=>q(()=>import("./breathPlay-BURg9OP8.js"),[]),"../locales/es/local/buttPlay.json":()=>q(()=>import("./buttPlay-DdmCLMQT.js"),[]),"../locales/es/local/footPlay.json":()=>q(()=>import("./footPlay-hFWj95hS.js"),[]),"../locales/es/local/gasMask.json":()=>q(()=>import("./gasMask-Bcj5DoFi.js"),[]),"../locales/es/local/humiliation.json":()=>q(()=>import("./humiliation-na7zWeaI.js"),[]),"../locales/es/local/kissing.json":()=>q(()=>import("./kissing-CB0VP-KF.js"),[]),"../locales/es/local/pissPlay.json":()=>q(()=>import("./pissPlay-UsPgHpnt.js"),[]),"../locales/es/local/poppers.json":()=>q(()=>import("./poppers-hlv7QJE8.js"),[]),"../locales/es/local/spanking.json":()=>q(()=>import("./spanking-B_mbCmIM.js"),[]),"../locales/es/local/throatTraining.json":()=>q(()=>import("./throatTraining-DgC8UUt0.js"),[]),"../locales/es/local/tickling.json":()=>q(()=>import("./tickling-3eKqnoqT.js"),[]),"../locales/es/local/titTorture.json":()=>q(()=>import("./titTorture-CmAbVlnl.js"),[]),"../locales/es/local/vaping.json":()=>q(()=>import("./vaping-sEIHH7E5.js"),[]),"../locales/es/online/alcohol.json":()=>q(()=>import("./alcohol-DHOb8-kr.js"),[]),"../locales/es/online/ballBusting.json":()=>q(()=>import("./ballBusting-CYCdXDgZ.js"),[]),"../locales/es/online/bating.json":()=>q(()=>import("./bating-C_-18RGA.js"),[]),"../locales/es/online/buttPlay.json":()=>q(()=>import("./buttPlay-C4FATzM0.js"),[]),"../locales/es/online/gasMask.json":()=>q(()=>import("./gasMask-C0h9kj6-.js"),[]),"../locales/es/online/pissPlay.json":()=>q(()=>import("./pissPlay-Q45xwfeM.js"),[]),"../locales/es/online/poppers.json":()=>q(()=>import("./poppers-DdRKJtxh.js"),[]),"../locales/es/online/throatTraining.json":()=>q(()=>import("./throatTraining-UnffRU_V.js"),[]),"../locales/es/online/titTorture.json":()=>q(()=>import("./titTorture-CrPrYCYf.js"),[]),"../locales/es/online/vaping.json":()=>q(()=>import("./vaping-BRzgwyKs.js"),[]),"../locales/es/translation.json":()=>q(()=>import("./translation-SvjJLGYg.js"),[]),"../locales/fr/local/alcohol.json":()=>q(()=>import("./alcohol-C70_emWC.js"),[]),"../locales/fr/local/ballBusting.json":()=>q(()=>import("./ballBusting-M8cUQ9qV.js"),[]),"../locales/fr/local/bating.json":()=>q(()=>import("./bating-BYM-GDc-.js"),[]),"../locales/fr/local/bondage.json":()=>q(()=>import("./bondage-DzQhYNpa.js"),[]),"../locales/fr/local/breathPlay.json":()=>q(()=>import("./breathPlay-DKOcasfb.js"),[]),"../locales/fr/local/buttPlay.json":()=>q(()=>import("./buttPlay-D5GsOhtK.js"),[]),"../locales/fr/local/electric.json":()=>q(()=>import("./electric-DuoRN1_a.js"),[]),"../locales/fr/local/footPlay.json":()=>q(()=>import("./footPlay-CQmZIGLH.js"),[]),"../locales/fr/local/humiliation.json":()=>q(()=>import("./humiliation-CSr078q2.js"),[]),"../locales/fr/local/kissing.json":()=>q(()=>import("./kissing-CKHo9oqj.js"),[]),"../locales/fr/local/pissPlay.json":()=>q(()=>import("./pissPlay-CmhfVL8I.js"),[]),"../locales/fr/local/poppers.json":()=>q(()=>import("./poppers-B30bn8dw.js"),[]),"../locales/fr/local/spanking.json":()=>q(()=>import("./spanking-D5Brjlga.js"),[]),"../locales/fr/local/throatTraining.json":()=>q(()=>import("./throatTraining-C5pM1N0y.js"),[]),"../locales/fr/local/tickling.json":()=>q(()=>import("./tickling-BIx4hqsq.js"),[]),"../locales/fr/local/titTorture.json":()=>q(()=>import("./titTorture-CsVRpiYC.js"),[]),"../locales/fr/local/vaping.json":()=>q(()=>import("./vaping-BKBmcz9l.js"),[]),"../locales/fr/online/alcohol.json":()=>q(()=>import("./alcohol-Dc380shx.js"),[]),"../locales/fr/online/ballBusting.json":()=>q(()=>import("./ballBusting-4gGsUFBf.js"),[]),"../locales/fr/online/bating.json":()=>q(()=>import("./bating-UlGM_QXh.js"),[]),"../locales/fr/online/buttPlay.json":()=>q(()=>import("./buttPlay-CKK7cdVw.js"),[]),"../locales/fr/online/gasMask.json":()=>q(()=>import("./gasMask-DCZ-6Sqx.js"),[]),"../locales/fr/online/pissPlay.json":()=>q(()=>import("./pissPlay-uXhaE7LP.js"),[]),"../locales/fr/online/poppers.json":()=>q(()=>import("./poppers-Ciaf_5HC.js"),[]),"../locales/fr/online/throatTraining.json":()=>q(()=>import("./throatTraining-dt4emaCF.js"),[]),"../locales/fr/online/titTorture.json":()=>q(()=>import("./titTorture-DuMCmKhS.js"),[]),"../locales/fr/online/vaping.json":()=>q(()=>import("./vaping-VGay9Awe.js"),[]),"../locales/fr/translation.json":()=>q(()=>import("./translation-DeoTeW7j.js"),[]),"../locales/languages.json":()=>q(()=>import("./languages-KK0t13AM.js"),[])});for(const i in r)if(i.startsWith(`../locales/${n}/${e}/`)){const a=i.split("/").pop().replace(".json","");t[a]=await r[i]()}return t}const{customTiles:Qc}=yn,pr={online:!1,local:!1};function sy(n,e="en",t="online"){const r=[];return Object.entries(n).forEach(([i,a])=>{!a.actions||Object.keys(a.actions).length===0||Object.entries(a.actions).forEach(([u,h],f)=>{!h||h.length===0||h.forEach(p=>{r.push({group:i,intensity:f,action:p,isEnabled:1,tags:[gf("default","Default")],gameMode:t,isCustom:0,locale:e})})})}),r}function oy(n,e,t){return!Array.isArray(n)||n.length===0?!1:n.filter(a=>a.locale===e&&a.gameMode===t&&a.isCustom===0).length>=4}async function ay(n){const e=n||"en",t=["online","local"];try{for(const r of t)if(!pr[r]){pr[r]=!0;try{const i=await ns({locale:e,gameMode:r,paginated:!1}),a=Array.isArray(i)?i:[];if(oy(a,e,r))continue;const u=await iy(e,r),h=sy(u,e,r),f=await uy(h,e,r);f.length>0&&await cg(f)}finally{pr[r]=!1}}}catch(r){console.error(`Error importing default actions for ${e}:`,r),pr.online=!1,pr.local=!1}}async function uy(n,e,t){const r=await Qc.where("locale").equals(e).and(a=>a.gameMode===t&&a.isCustom===0).toArray(),i=new Set;return r.forEach(a=>{const u=`${a.group}-${a.intensity}-${a.action}`;i.add(u)}),n.filter(a=>{const u=`${a.group}-${a.intensity}-${a.action}`;return!i.has(u)})}async function rl(n,e){try{const t=await ns({locale:n,gameMode:e,paginated:!1});if(!Array.isArray(t)||t.length===0)return;const r=t.filter(u=>u.isCustom===0);if(r.length<=1)return;const i=new Map,a=[];if(r.forEach(u=>{const h=`${u.group}-${u.intensity}-${u.action}`;i.has(h)?a.push(u.id):i.set(h,u.id)}),a.length>0)for(const u of a)await Qc.delete(u)}catch(t){console.error(`Error removing duplicate default actions for ${n}/${e}:`,t)}}async function ly(n){await rl(n,"online"),await rl(n,"local"),await ay(n)}let di=null;function cy(n){di&&clearTimeout(di),di=setTimeout(()=>{try{ly(n).catch(e=>{console.error("Error during initial default actions import:",e)})}catch(e){console.error("Error during initial default actions import:",e)}di=null},1e3)}const hy=ke.lazy(()=>q(()=>import("./index-CsdNNf4B.js"),__vite__mapDeps([9,1,2,10,4,11,12,13,14,3,15,16]))),fy=ke.lazy(()=>q(()=>import("./index-CKe2RiDj.js"),__vite__mapDeps([17,1,2,18,4,11,19,20,3,21]))),dy=ke.lazy(()=>q(()=>import("./index-BwRH_o8S.js"),__vite__mapDeps([22,1,2,18,4,11,23,10,12,24,20,25,13,26,19,3,27])));function il({children:n}){return Re.jsx(ey,{children:Re.jsx(ny,{children:Re.jsx(Jg,{children:n})})})}function py(){const n=Eg();ke.useEffect(()=>(window.authContext=n,()=>{window.authContext=null}),[n]),pl.on("languageChanged",t=>{cy(t)});const e=n.user?Re.jsx(dy,{}):Re.jsx(hy,{});return Re.jsxs(Oh,{future:{v7_startTransition:!0},children:[Re.jsx(js,{path:"/",element:Re.jsx(Rh,{replace:!0,to:"/public"})}),Re.jsx(js,{path:"/:id/cast",element:Re.jsx(il,{children:Re.jsx(ke.Suspense,{children:Re.jsx(fy,{})})})}),Re.jsx(js,{path:"/:id",element:Re.jsx(il,{children:Re.jsx(ke.Suspense,{children:e})})})]})}function my(){return Re.jsxs(Sh,{theme:ry,children:[Re.jsx(Ih,{}),Re.jsx(cd,{dateAdapter:Gg,children:Re.jsx(Ph,{children:Re.jsx(py,{})})})]})}const _y=ud.createRoot(document.getElementById("root"));_y.render(Re.jsx(Js.StrictMode,{children:Re.jsx(bg,{children:Re.jsx(Js.Suspense,{children:Re.jsx(my,{})})})}));sd();export{Gc as A,By as B,ns as C,Ky as D,Vy as E,cg as F,eu as G,kf as H,ze as I,mg as J,Yy as K,cd as L,Xg as M,Hy as N,dg as O,ty as S,Zg as U,q as _,Qy as a,Wy as b,Xy as c,Ay as d,Cy as e,Iy as f,qy as g,_g as h,iy as i,D_ as j,M_ as k,zy as l,If as m,Of as n,Gy as o,xy as p,by as q,R_ as r,ky as s,Ey as t,Eg as u,Sy as v,Py as w,Ty as x,Uy as y,hg as z};
