import{j as e,f,ax as U,ay as N,az as P,g as se,R as w,i as oe,U as ue,V as F,h as g,D as L,G as M,aA as T,ar as Oe,as as Le,aB as Te,au as $e,aC as Ue,aD as Be,aE as Ie,l as W,aF as te,a1 as Ne,aG as xe,x as Pe,y as Q,B as $,aH as We,aa as Ee,aI as Ge,aJ as ze,aK as Fe,aL as Ve,aM as qe,o as _e,q as He,p as Je}from"./mui-VGUUbzNb.js";import{a as H,u as he,C as Ye}from"./index-CcHQ0oEU.js";import{r as b,u as J,l as Qe,k as Xe}from"./vendor-yP7igga9.js";import{d as R,i as C,a as Ze,b as X}from"./strings-BjbSR3e6.js";import{i as V,u as O,T as x,t as De}from"./translations-Bhk7i5vx.js";import{s as je,v as en,i as nn,g as pe,h as ge,b as me,u as be}from"./index-ibjflcvy.js";import{u as ne}from"./index-BLZhfqs4.js";import{a as sn,i as tn}from"./urls-bwAPA7IR.js";import{T as ln}from"./index-lCKdBxpn.js";import{u as ye,a as fe,C as rn}from"./useActionList-BLGHB78u.js";import on from"./languages-KK0t13AM.js";function cn(n){const{t:s}=V;let t=`### ${s("roomSettings")}\r
`;return Object.entries(n).forEach(([i,r])=>{if(i!=="room"){if(i==="roomBackgroundURL"&&r!==""){t+=`* ${s(i)}: [${sn(r)}:link:](${r})\r
`;return}if(i==="roomRealtime"){t+=`* ${s("playerList")}: ${s(r?"delayed":"realtime")}\r
`;return}r!==""&&(t+=`* ${s(i)}: ${r}\r
`)}}),t}function an(n){const s={};return Object.entries(n).forEach(([t,i])=>{t.startsWith("room")&&!["roomUpdated","roomBackground"].some(r=>r===t)&&(s[t]=i)}),s}async function dn(n,s,t){let i=n;return s!==void 0&&s.length>0&&(i=await t(s)),i}function un(n,s){const t=an(n);return je({room:n.room,user:s,text:cn(t),type:"room",settings:JSON.stringify(t)})}function xn(n,s,t){const i=Object.entries(t).filter(([l])=>n[l]).reduce((l,[o,a])=>(l[o]=Object.keys(a.actions).slice(1,n[o]+1),l),{});return(s==null?void 0:s.filter(l=>{if(l.group==="misc")return!0;const o=i[l.group];return o&&o.length>=Number(l.intensity)})).length}function hn(n,s,t,i){const{t:r}=V;let l=`### ${V.t("gameSettings")}\r
`;if(i&&(l+=`##### ${i}\r
`),l+=`--- \r
`,Object.entries(t).forEach(([d,h])=>{var S;if(!n[d])return;const{role:u,variation:j,level:p}=n[d],y=u||n.role||"sub";if(p>0){if(l+=`* ${h==null?void 0:h.label}: ${(S=Object.keys(h==null?void 0:h.actions))==null?void 0:S[p]}`,j&&(l+=` (${r(j)})`),!R(n.gameMode)&&!j){const m=h[y]??r(y);l+=` (${m})`}l+=`\r
`}}),l.endsWith(`--- \r
`))return"";const{finishRange:o,difficulty:a}=n;l+=`--- \r
`,l+=`* ${r("difficulty")}: ${r(a??"normal")} \r
`,o&&(l+=`* ${r("finishSlider")} ${o[0]}%  | ${o[1]-o[0]}% | ${100-o[1]}%`);const c=xn(n,s,t);return c&&(l+=`* ${r("customTilesLabel")}: ${c} \r
`),l}function jn(n){const s={};return Object.entries(n).forEach(([t,i])=>{!["displayName","background","boardUpdated","chatSound","mySound","otherSound","othersDialog","playerDialog","readRoll","hideBoardActions","advancedSettings"].includes(t)&&!t.startsWith("room")&&(s[t]=i)}),s}async function pn({title:n,formData:s,user:t,actionsList:i,tiles:r,customTiles:l=[],reason:o=""}){const a=JSON.stringify(jn(s)),c=await en({title:n,gameBoard:JSON.stringify(r),settings:a}),d=hn(s,l,i,o);if(!(!(c!=null&&c.id)||d===""))return je({room:(s==null?void 0:s.room)||"PUBLIC",user:t,text:d,type:"settings",gameBoardId:c.id,boardSize:r.length,gameMode:s.gameMode})}function gn(n){for(let s=n.length-1;s>0;s-=1){const t=Math.floor(Math.random()*(s+1));[n[s],n[t]]=[n[t],n[s]]}return n}function ce(n){n.length>1&&n.push(n.shift())}function ae(n,s){return(n==null?void 0:n.length)!==(s==null?void 0:s.length)?!1:n.every((t,i)=>t===s[i])}const{t:E}=V;function mn(n,s){return n.filter(t=>s==="vers"?t.includes("{sub}")&&t.includes("{dom}")||t.includes("{player}"):!t.match(/{(dom|sub)}/)||t.includes(`{${s}}`))}function bn(n,s,t){var l;const i=((l=n[s])==null?void 0:l.role)??n.role??"sub";return Object.keys(t).reduce((o,a,c)=>{var d;return c>0&&c<=((d=n[s])==null?void 0:d.level)&&(o[a]=gn(mn(t[a],i))),o},{})}function yn(n,s){return Object.entries(n).filter(([t])=>{var i;return((i=s[t])==null?void 0:i.level)>0}).map(([t,i])=>{var r;return{label:i.label,actions:bn(s,t,i==null?void 0:i.actions),key:t,standalone:!1,role:((r=s[t])==null?void 0:r.role)??s.role??"sub"}})}function fn(n,s){return s.length&&(s.some(({group:t})=>t==="misc")&&n.push({label:E("misc"),actions:{All:[]},key:"misc",standalone:!1}),s.forEach(({group:t,intensity:i,action:r})=>{const l=n.find(o=>o.key===t);if(l&&Object.keys(l.actions).length>=i){const o=Object.values(l.actions)[i-1],a=Math.floor(Math.random()*(o.length+1));o.splice(a,0,r)}})),n}function Sn(n){return Object.entries(n).reduce((s,[t,i])=>(i!=null&&i.variation&&(s[t]=i),s),{})}function vn(n,s){const t=[],i=[...s];return Object.entries(n).forEach(([r,{level:l,variation:o}])=>{if(l<=0)return;const a=s.findIndex(d=>d.key===r);if(o==="standalone"){i[a].standalone=!0;return}const c=o==="appendSome"?.4:.9;t.push({...s[a],frequency:c}),i.splice(a,1)}),{appendList:t,listWithoutAppend:i}}function Cn(n,s,t,i){if([void 0,"normal"].includes(i)){const r=n/s;return Math.floor(t/r)}return s>=3&&Math.random()>=.6?s-2:s-1}function de(n,s,t,i){ce(n);const{actions:r,label:l,standalone:o,frequency:a,role:c}=n[0],d=Math.random();if(a&&a<=d)return{description:""};const h=Object.keys(r),u=Object.values(r);let j=Cn(s,h.length,t,i==null?void 0:i.difficulty);return u[j]||(j-=1),ce(u[j]),{title:l,description:u[j][0],standalone:o,role:c}}function kn(n,s,t){const i=Sn(s),{listWithoutAppend:r,appendList:l}=vn(i,n),o=[];for(let a=1;a<=t;a+=1){const{title:c,description:d,standalone:h,role:u}=de(r,t,a,s);let j="";if(!h&&l.length){const{description:p}=de(l,t,a,s);j=`${p.trim().replace(/([^.,!?])$/,"$1.")} ${d}`}else j=d;o.push({title:c,description:j.trim(),role:u})}return o}function wn(n,s){const t={title:E("start"),description:E("start")},{finishRange:i}=s,r=`${E("noCum")} ${i[0]}%\r
${E("ruined")} ${i[1]-i[0]}%\r
${E("cum")} ${100-i[1]}%`,l={title:E("finish"),description:r};return[t,...n,l]}function Kn(n,s,t=[],i=40){const r=Object.entries(s).reduce((c,[d,h])=>(c[d]={...h,actions:Object.keys(h.actions||{}).reduce((u,j)=>(u[j]=[],u),{})},c),{}),l=yn(r,n);!l.length&&!t.length&&(localStorage.clear(),window.location.reload());const o=fn(l,t),a=kn(o,n,i-2);return wn(a,n)}function An(){const n=ne(me),[s,t]=H("gameSettings"),{i18n:i}=O();async function r(l={}){var v;const o=l!=null&&l.roomUpdate||l!=null&&l.boardUpdated?l:{...s,...l};let{gameMode:a,boardUpdated:c}=o;const{roomTileCount:d=40,finishRange:h,room:u}=o,j=C(u);if(!h)return{};j&&!R(a)&&(a="online",c=!0);const p=await nn(i.resolvedLanguage,a),y=j?40:d,S=await pe(a),m=Kn(o,p,S,y);return(l!=null&&l.boardUpdated||c||((v=n==null?void 0:n.tiles)==null?void 0:v.length)!==m.length)&&(await t(o),await ge({title:(n==null?void 0:n.title)||"",tiles:m})),{settingsBoardUpdated:c,gameMode:a,newBoard:m}}return(l={})=>r(l)}function Z({children:n,value:s,index:t,style:i,...r}){return e.jsx("div",{role:"tabpanel",hidden:s!==t,id:`simple-tabpanel-${t}`,"aria-labelledby":`simple-tab-${t}`,...r,children:s===t&&e.jsx(f,{sx:{p:3,...i},children:n})})}function Se({formData:n,setFormData:s,backgrounds:t,isRoom:i=!1}){const{t:r}=O(),l=i?"roomBackground":"background",o=i?"roomBackgroundURL":"backgroundURL",[a,c]=b.useState((n==null?void 0:n[l])||Object.keys(t)[0]),d=()=>Object.entries(t).map(([j,p])=>e.jsx(w,{value:j,children:p},j)),h=j=>{s({...n,[l]:j.target.value}),c(j.target.value)};b.useEffect(()=>{a!==(n==null?void 0:n[l])&&c(n==null?void 0:n[l])},[n==null?void 0:n[l]]);const u=j=>{const p={...n,[l]:"custom",[o]:j.target.value};i&&(p.roomUpdated=!0),s(p)};return e.jsxs(e.Fragment,{children:[e.jsxs(U,{fullWidth:!0,margin:"normal",children:[e.jsx(N,{id:"background-label",children:r("background")}),e.jsx(P,{labelId:"background-label",id:"background",label:r("background"),value:a||"",onChange:h,children:d()})]}),a==="custom"&&e.jsx(se,{sx:{mt:2},label:r("url"),value:n==null?void 0:n[o],fullWidth:!0,onChange:u,helperText:e.jsxs(e.Fragment,{children:[r("supportedSites"),e.jsx("br",{}),r("requiresEmbeddedUrl")]})})]})}function Mn({boardUpdated:n}){const{i18n:s}=O(),[t,i]=b.useState(s.resolvedLanguage);function r(o){i(o),s.changeLanguage(o),n()}const l=Object.entries(on).map(([o,a])=>e.jsx(w,{value:o,children:a.label},o));return e.jsx(f,{sx:{minWidth:120,mt:1,mb:2},children:e.jsxs(U,{fullWidth:!0,children:[e.jsxs(N,{id:"language-label",sx:{display:"flex",alignItems:"center"},children:[e.jsx(oe,{sx:{mr:1}}),e.jsx(x,{i18nKey:"language"})]}),e.jsx(P,{labelId:"language-label",id:"language-select",value:t,label:e.jsxs(e.Fragment,{children:[e.jsx(oe,{}),e.jsx(x,{i18nKey:"language"})]}),onChange:o=>r(o.target.value),children:l})]})})}function q({trueCondition:n,onChange:s,yesLabel:t,noLabel:i=null,sx:r={}}){const l=i??t;return e.jsx(f,{sx:{display:"flex",justifyContent:"center",my:1,...r},children:e.jsx(ue,{control:e.jsx(F,{checked:n||!1,onChange:s}),label:e.jsx(x,{i18nKey:n?t:l})})})}function I({field:n,formData:s,handleSwitch:t}){return e.jsx(q,{trueCondition:s[n],onChange:i=>t(i,n),yesLabel:`${n}Enable`,sx:{justifyContent:"left"}})}function Rn({formData:n,setFormData:s,boardUpdated:t}){const[i,r]=H("gameSettings"),{t:l}=O(),o={color:l("color"),gray:l("gray"),"metronome.gif":l("hypnoDick"),"pink-spiral.gif":l("pinkSpiral"),custom:l("customURL")};function a(c,d){s({...n,[d]:c.target.checked}),r({...i,[d]:c.target.checked})}return e.jsxs(e.Fragment,{children:[e.jsx(Mn,{boardUpdated:t}),e.jsx(g,{variant:"h5",children:e.jsx(x,{i18nKey:"dialog"})}),e.jsx(I,{field:"playerDialog",formData:n,handleSwitch:a}),e.jsx(I,{field:"othersDialog",formData:n,handleSwitch:a}),e.jsx(L,{}),e.jsx(g,{variant:"h5",sx:{mt:2},children:e.jsx(x,{i18nKey:"sounds"})}),e.jsx(I,{field:"mySound",formData:n,handleSwitch:a}),e.jsx(I,{field:"otherSound",formData:n,handleSwitch:a}),e.jsx(I,{field:"chatSound",formData:n,handleSwitch:a}),e.jsx(I,{field:"readRoll",formData:n,handleSwitch:a}),e.jsx(L,{}),e.jsx(g,{variant:"h5",sx:{mt:2,textTransform:"capitalize"},children:e.jsx(x,{i18nKey:"miscellaneous"})}),e.jsx(I,{field:"hideBoardActions",formData:n,handleSwitch:a}),e.jsx(I,{field:"advancedSettings",formData:n,handleSwitch:a}),e.jsx(Se,{formData:n,setFormData:s,backgrounds:o}),e.jsx(L,{})]})}function D({children:n}){return e.jsx(M,{size:{xs:12,md:5},children:n})}const _=b.forwardRef(({value:n,onChange:s,label:t,options:i,defaultValue:r=null,sx:l,helpIcon:o=!1,fullWidth:a=!0,...c},d)=>{const h=i.map(u=>typeof u=="string"?e.jsx(w,{value:u,children:e.jsx(x,{i18nKey:u})},u):e.jsx(w,{value:u.value,children:u.label},u.value));return e.jsxs(U,{fullWidth:a,margin:"normal",sx:l,...c,ref:d,children:[e.jsxs(N,{id:`${t}Label`,children:[e.jsx(x,{i18nKey:t}),!!o&&e.jsx(T,{sx:{ml:1,fontSize:16}})]}),e.jsx(P,{labelId:`${t}Label`,id:t,label:e.jsxs(e.Fragment,{children:[e.jsx(x,{i18nKey:t}),!!o&&e.jsx(T,{sx:{ml:1,fontSize:16}})]}),value:n||r,onChange:s,children:h})]})});function ee({children:n,title:s,subtitle:t,defaultExpanded:i=!1,...r}){return e.jsxs(Oe,{defaultExpanded:i,...r,sx:{backgroundColor:"inherit",backgroundImage:"none",boxShadow:"none"},children:[e.jsxs(Le,{expandIcon:e.jsx(Te,{}),sx:{px:0},children:[e.jsxs(g,{variant:"h6",sx:{width:"33%"},children:[s,":"]}),e.jsx(g,{sx:{pt:.5},children:t})]}),e.jsx($e,{sx:{px:0},children:e.jsx(M,{container:!0,columnSpacing:2,justifyContent:"space-evenly",className:"columned-grid",children:n})})]})}function On({formData:n,setFormData:s}){const t=(r,l)=>{s({...n,finishRange:l,boardUpdated:!0})},i=(n==null?void 0:n.finishRange)||[30,70];return e.jsxs(f,{children:[e.jsx(L,{}),e.jsx(g,{id:"finish-slider",sx:{my:1},children:e.jsx(x,{i18nKey:"finishSlider"})}),e.jsx(Ue,{"aria-labelledby":"finish-slider",value:i,onChange:t,valueLabelDisplay:"off"}),e.jsxs(f,{display:"flex",flexDirection:"column",justifyContent:"space-between",textAlign:"center",children:[e.jsxs(g,{whiteSpace:"nowrap",children:[e.jsx(x,{i18nKey:"noCum"})," ",i[0],"%"]}),e.jsxs(g,{whiteSpace:"nowrap",children:[e.jsx(x,{i18nKey:"ruined"})," ",i[1]-i[0],"%"]}),e.jsxs(g,{whiteSpace:"nowrap",children:[e.jsx(x,{i18nKey:"cum"})," ",100-i[1],"%"]})]}),e.jsx(L,{sx:{my:1}})]})}function Ln(){const[n,s]=b.useState(!1);return b.useEffect(()=>{const t=window.matchMedia("(pointer: fine)");s(t.matches);const i=r=>{s(r.matches)};return t.addEventListener("change",i),()=>{t.removeEventListener("change",i)}},[]),n}function ie({actionsFolder:n,settings:s,option:t,onChange:i,initValue:r=0}){var p,y,S;const l=`${t}label`,o=(p=n[t])==null?void 0:p.label,a=Ln(),[c,d]=b.useState(((y=s[t])==null?void 0:y.level)||0),h=m=>{d(m)},u=m=>c>0&&m===0?!1:s.difficulty==="accelerated"?c<=2?c===m:c===m||c-1===m:c>=m;function j(m){var v;return Object.keys((v=n[m])==null?void 0:v.actions).map((A,k)=>e.jsxs(w,{value:k,onMouseOver:()=>h(k),children:[!!a&&e.jsx("span",{className:"menu-item-icon",children:u(k)?e.jsx(Be,{}):e.jsx(Ie,{})}),A]},`${m}-${A}`))}return e.jsxs(U,{margin:"normal",fullWidth:!0,children:[e.jsx(N,{id:l,children:o}),e.jsx(P,{labelId:l,id:t,label:o,value:((S=s[t])==null?void 0:S.level)||r,onChange:i,onOpen:()=>{var m;return d(((m=s[t])==null?void 0:m.level)||r)},onClose:()=>{var m;return d(((m=s[t])==null?void 0:m.level)||r)},children:j(t)})]})}function Tn({option:n,settings:s,setSettings:t,actionsFolder:i,type:r,showVariation:l=!1,showRole:o=!1}){var p,y,S,m;const{t:a}=O(),c=`${n}label`,d=(p=i[n])==null?void 0:p.label;function h(v,A,k){t(G=>{var z;return{...G,[A]:{...G[A],type:r,[k]:(z=v==null?void 0:v.target)==null?void 0:z.value},boardUpdated:!0}})}let u=12;(l||o)&&(u=6);let j=["dom","vers","sub"];return(y=i[n])!=null&&y.dom&&(j=[{label:i[n].dom,value:"dom"},{label:a("vers"),value:"vers"},{label:i[n].sub,value:"sub"}]),e.jsxs(M,{container:!0,justifyContent:"center",children:[e.jsx(M,{size:u,children:e.jsx(ie,{actionsFolder:i,settings:s,option:n,onChange:v=>h(v,n,"level")})}),!!o&&e.jsx(M,{size:6,children:e.jsx(_,{sx:{ml:1},value:(S=s[n])==null?void 0:S.role,onChange:v=>h(v,n,"role"),label:`${a("role")}: ${d}`,options:j,defaultValue:s.role||"sub"})}),!!l&&e.jsx(M,{size:6,children:e.jsx(W,{placement:"top",title:e.jsxs(x,{i18nKey:"variationTooltip",children:[e.jsx(g,{variant:"subtitle2",children:"Standalone = Its own tile. "}),e.jsx(g,{variant:"subtitle2",children:"Append Some = 50% chance."}),e.jsx(g,{variant:"subtitle2",children:"Append Most = 90% chance."})]}),arrow:!0,children:e.jsxs(U,{fullWidth:!0,margin:"normal",sx:{ml:1},children:[e.jsxs(N,{id:`${c}Variation`,children:[`${d} ${a("variation")}`,e.jsx(T,{sx:{ml:1,fontSize:16}})]}),e.jsxs(P,{labelId:`${c}Variation`,id:`${n}Variation`,label:e.jsxs(e.Fragment,{children:[d," ",a("variation"),e.jsx(T,{sx:{ml:1,fontSize:16}})]}),value:((m=s[n])==null?void 0:m.variation)||"standalone",onChange:v=>h(v,n,"variation"),children:[e.jsx(w,{value:"standalone",children:e.jsx(x,{i18nKey:"standalone"})}),e.jsx(w,{value:"appendSome",children:e.jsx(x,{i18nKey:"appendSome"})}),e.jsx(w,{value:"appendMost",children:e.jsx(x,{i18nKey:"appendMost"})})]})]})})})]},n)}function $n({formData:n,setFormData:s}){return e.jsxs(te,{direction:"row",spacing:1,alignItems:"center",justifyContent:"center",sx:{mt:1},children:[e.jsx(g,{children:e.jsx(x,{i18nKey:"solo"})}),e.jsx(W,{title:e.jsx(g,{variant:"subtitle2",children:e.jsx(x,{i18nKey:"soloTooltip"})}),arrow:!0,children:e.jsx(T,{sx:{fontSize:15}})}),e.jsx(F,{id:"gameMode",checked:!R(n.gameMode),onChange:t=>s({...n,gameMode:t.target.checked?"local":"online",boardUpdated:!0}),inputProps:{"aria-label":"Game Type"}}),e.jsx(g,{children:e.jsx(x,{i18nKey:"local"})}),e.jsx(W,{title:e.jsx(g,{variant:"subtitle2",children:e.jsx(x,{i18nKey:"localTooltip"})}),arrow:!0,children:e.jsx(T,{sx:{fontSize:15}})})]})}function Un({formData:n}){const[s,t]=b.useState(!1);return b.useEffect(()=>{const i=Object.values(n).filter(l=>(l==null?void 0:l.type)==="consumption"&&(l==null?void 0:l.level)>0).length,r=Object.values(n).filter(l=>(l==null?void 0:l.level)>0).length;t(i>1&&i>=r-i)},[n]),s?e.jsx(Ne,{severity:"warning",children:e.jsx(x,{i18nKey:"consumptionWarning"})}):null}function Bn({formData:n,setFormData:s,actionsList:t}){const{t:i}=O(),r=he("md"),l=!C(n==null?void 0:n.room)&&!R(n.gameMode);function o(c,d={}){return Object.keys(t).filter(h=>{var u;return((u=t[h])==null?void 0:u.type)===c}).map(h=>e.jsx(D,{sm:r&&!l?6:12,children:e.jsx(Tn,{option:h,settings:n,setSettings:s,actionsFolder:t,type:c,...d})},h))}const a=c=>{const d=JSON.parse(JSON.stringify(n));return Object.keys(d).forEach(h=>{d.role=c,h.includes("role")&&(d[h]=c)}),d};return e.jsxs(e.Fragment,{children:[e.jsx($n,{formData:n,setFormData:s}),C(n==null?void 0:n.room)&&!R(n.gameMode)&&e.jsx(M,{container:!0,alignContent:"center",justifyContent:"space-evenly",children:e.jsx(M,{sx:{py:3},children:e.jsx(g,{variant:"h5",children:e.jsx(x,{i18nKey:"privateRequired"})})})}),e.jsxs(M,{container:!0,columnSpacing:2,justifyContent:"space-evenly",children:[e.jsx(D,{children:e.jsx(W,{placement:"top",title:e.jsx(x,{i18nKey:"difficultyTooltip",children:e.jsxs(g,{variant:"body2",children:["Normal = Slow ramp up. ",e.jsx("br",{}),e.jsx("br",{}),"Accelerated = Straight to max level + the level prior to it."]})}),arrow:!0,children:e.jsx(_,{value:n.difficulty,onChange:c=>s({...n,difficulty:c.target.value,boardUpdated:!0}),label:"difficulty",options:["normal","accelerated"],defaultValue:"normal",helpIcon:!0})})}),l&&e.jsx(D,{children:e.jsx(_,{value:n.role,onChange:c=>s({...a(c.target.value),boardUpdated:!0}),label:"mainRole",options:["dom","vers","sub"],defaultValue:"sub"})})]}),l?e.jsxs(e.Fragment,{children:[e.jsx(ee,{title:i("consumption"),subtitle:i("consumptionSubtitle"),children:o("consumption",{showVariation:!0})}),e.jsx(ee,{title:i("foreplay"),subtitle:i("foreplaySubtitle"),children:o("foreplay",{showRole:l})}),e.jsx(ee,{title:i("sex"),subtitle:i("sexSubtitle"),children:o("sex",{showRole:l})})]}):e.jsxs(e.Fragment,{children:[e.jsx(M,{container:!0,columnSpacing:2,justifyContent:"space-evenly",children:o("consumption",{showVariation:!0})}),e.jsx(L,{}),e.jsx(M,{container:!0,columnSpacing:2,justifyContent:"center",children:o("solo")})]}),e.jsx(On,{setFormData:s,formData:n}),e.jsx(Un,{formData:n})]})}function In({formData:n,setFormData:s}){const{t}=O(),i={"1d4":2.5,"1d6":3.5,"2d4":5},r=n!=null&&n.roomTileCount?Math.floor(n.roomTileCount/i[n.roomDice]):16,l=Array.from({length:7},(o,a)=>(a+2)*10).map(o=>e.jsx(w,{value:o,children:o},o));return e.jsxs(e.Fragment,{children:[e.jsx(g,{children:e.jsx(x,{i18nKey:"gameSpeed"})}),e.jsxs(f,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[e.jsxs(U,{sx:{m:1},fullWidth:!0,children:[e.jsx(N,{id:"diceRole-label",children:e.jsx(x,{i18nKey:"roomDice"})}),e.jsxs(P,{labelId:"diceRole-label",id:"diceRole-select",value:(n==null?void 0:n.roomDice)||"1d4",label:t("roomDice"),onChange:o=>s({...n,roomDice:o.target.value,roomUpdated:!0}),children:[e.jsx(w,{value:"1d4",children:"1d4"}),e.jsx(w,{value:"1d6",children:"1d6"}),e.jsx(w,{value:"2d4",children:"2d4"})]})]}),e.jsxs(U,{sx:{m:1},fullWidth:!0,children:[e.jsx(N,{id:"tile-count-label",children:e.jsx(x,{i18nKey:"roomTileCount"})}),e.jsx(P,{labelId:"tile-count-label",id:"tile-count-select",value:(n==null?void 0:n.roomTileCount)||40,label:t("roomTileCount"),onChange:o=>s({...n,roomTileCount:o.target.value,roomUpdated:!0}),children:l})]}),e.jsx(U,{fullWidth:!0,children:e.jsxs(g,{children:[e.jsx(x,{i18nKey:"averageRolls"}),r]})})]})]})}function Nn({formData:n,setFormData:s}){const t=b.useCallback(()=>{s({...n,roomRealtime:!n.roomRealtime,roomUpdated:!0})},[n,s]);return e.jsxs(e.Fragment,{children:[e.jsx(g,{children:e.jsx(x,{i18nKey:"playerListOptions"})}),e.jsxs(te,{direction:"row",spacing:1,alignItems:"center",justifyContent:"center",sx:{width:"100%"},children:[e.jsx(g,{children:e.jsx(x,{i18nKey:"realtime"})}),e.jsx(W,{title:e.jsx(g,{variant:"subtitle2",children:e.jsx(x,{i18nKey:"realtimeTooltip"})}),arrow:!0,children:e.jsx(T,{sx:{fontSize:15}})}),e.jsx(F,{id:"showPrivate",checked:!!n.roomRealtime,onChange:t,inputProps:{"aria-label":De("playerList")}}),e.jsx(g,{children:e.jsx(x,{i18nKey:"delayed"})}),e.jsx(W,{title:e.jsx(g,{variant:"subtitle2",children:e.jsx(x,{i18nKey:"delayedTooltip"})}),arrow:!0,children:e.jsx(T,{sx:{fontSize:15}})})]})]})}let Pn=n=>crypto.getRandomValues(new Uint8Array(n)),Wn=(n,s,t)=>{let i=(2<<Math.log2(n.length-1))-1,r=-~(1.6*i*s/n.length);return(l=s)=>{let o="";for(;;){let a=t(r),c=r|0;for(;c--;)if(o+=n[a[c]&i]||"",o.length>=l)return o}}},En=(n,s=21)=>Wn(n,s|0,Pn);function ve({formData:n,setFormData:s}){var a;const{id:t}=J(),{t:i}=O(),r=b.useCallback(c=>{let d;c.target.checked&&C(t)?d=En("123456789ABCDEFGHJKLMNPQRSTUVWXYZ",5)():c.target.checked&&!C(t)?d=t:d="PUBLIC",s({...n,room:d,gameMode:C(d)?"online":n.gameMode})},[t,n,s]),l=b.useCallback(c=>{s({...n,room:c.target.value,boardUpdated:!0})},[n,s]),o=!C(n.room);return e.jsxs(e.Fragment,{children:[e.jsxs(te,{direction:"row",spacing:1,alignItems:"center",justifyContent:"center",sx:{width:"100%"},children:[e.jsx(g,{children:e.jsx(x,{i18nKey:"public"})}),e.jsx(F,{id:"showPrivate",checked:o,onChange:r,inputProps:{"aria-label":i("room")}}),e.jsx(g,{children:e.jsx(x,{i18nKey:"private"})}),e.jsx(W,{title:e.jsx(g,{variant:"subtitle2",children:e.jsx(x,{i18nKey:"privateOptions"})}),arrow:!0,children:e.jsx(T,{sx:{fontSize:15}})})]}),e.jsx(xe,{in:o,timeout:500,children:e.jsx(se,{fullWidth:!0,id:"privateRoom",label:"Private Room",defaultValue:(a=n.room)==null?void 0:a.toUpperCase(),margin:"normal",onBlur:l,onKeyDown:l})})]})}function Gn({formData:n,setFormData:s}){const{t}=O(),i={app:t("appBackground"),custom:t("customURL")};return e.jsxs(f,{sx:{margin:"0.5rem"},children:[e.jsx(ve,{formData:n,setFormData:s}),!C(n.room)&&e.jsxs(e.Fragment,{children:[e.jsx(L,{sx:{my:1}}),e.jsx(In,{formData:n,setFormData:s}),e.jsx(L,{sx:{my:1}}),e.jsx(Nn,{formData:n,setFormData:s}),e.jsx(L,{sx:{my:1}}),e.jsx(Se,{formData:n,setFormData:s,backgrounds:i,isRoom:!0})]})]})}function zn(n){return Object.values(n).some(({level:s})=>s>0)}function Fn(n,s){return Object.entries(n).reduce((t,[i,r])=>{var l;return i in s&&((l=r==null?void 0:r.variation)!=null&&l.startsWith("append")?t.withAppend[i]=r:t.withoutAppend[i]=r),t},{withAppend:{},withoutAppend:{}})}function Vn(n){return Object.keys(n).length&&Object.values(n).some(({level:s})=>s>0)}function qn(n,s){const{withAppend:t,withoutAppend:i}=Fn(n,s);return zn(i)?C(n.room)&&!R(n.gameMode)?"privateRequired":null:Vn(t)?"appendWithAction":"pickSomething"}function le(){const{id:n}=J(),s=Qe();return i=>{n.toUpperCase()!==(i==null?void 0:i.toUpperCase())&&s(`/${i||"PUBLIC"}`)}}function _n(n){(!n.roomBackgroundURL||!tn(n.roomBackgroundURL))&&(n.roomBackground="app")}function Ce(){const{user:n,updateUser:s}=be(),{id:t}=J(),{t:i}=O(),r=An(),[l,o]=H("gameSettings"),a=ne(()=>pe(l.gameMode)),c=ne(me),d=le(),{messages:h}=Ze(),u=p=>{const y=t.toUpperCase()!==p.room.toUpperCase(),S=p.room&&!C(p.room),m=S&&p.roomTileCount!==l.roomTileCount;return{roomChanged:y,isPrivateRoom:S,privateBoardSizeChanged:m}};async function j(p,y){const{displayName:S}=p,m=await dn(n,S,s);_n(p);const{settingsBoardUpdated:v,gameMode:A,newBoard:k}=await r(p),{roomChanged:G,isPrivateRoom:z,privateBoardSizeChanged:K}=u(p);z&&(p.roomUpdated||!h.find(B=>B.type==="room"))&&await un(p,m),(c==null?void 0:c.tiles)!==k&&await ge({title:i("settingsGenerated"),tiles:k,isActive:1,gameMode:A}),(v||G||K)&&await pn({formData:p,user:m,customTiles:a,actionsList:y,title:"Settings Generated Board",tiles:k}),o({...p,boardUpdated:!1,roomUpdated:!1,gameMode:A}),d(p.room)}return(p,y)=>j(p,y)}function Hn({closeDialog:n}){const{user:s}=be(),{t}=O(),[i,r]=H("gameSettings"),[l,o]=b.useState(0),[a,c]=b.useState(null),[d,h]=b.useState(!1),[u,j]=ye(),p=le(),y=Ce(),{isLoading:S,actionsList:m}=fe(u==null?void 0:u.gameMode),v=(K,B)=>{o(B),p(u.room)},A=()=>r({...i,boardUpdated:!0});async function k(K){K.preventDefault();const{displayName:B,...Re}=u,re=qn(Re,m);return re?c(t(re)):(y(u,m),typeof n=="function"&&n(),null)}const G=b.useCallback(K=>{j(B=>({...B,displayName:K.target.value}))},[u]),z=b.useCallback(K=>{K.key==="Enter"&&(j(B=>({...B,displayName:K.target.value})),k(K))},[u,k]);return!u.room||S?e.jsxs(f,{children:[e.jsxs(g,{variant:"h2",children:[e.jsx(x,{i18nKey:"Loading"}),"..."]}),e.jsx(g,{variant:"body1",children:e.jsx(x,{i18nKey:"clearStorage"})})]}):e.jsxs(f,{component:"form",method:"post",onSubmit:k,className:"settings-box",children:[e.jsx(se,{fullWidth:!0,id:"displayName",label:t("displayName"),defaultValue:(s==null?void 0:s.displayName)||u.displayName||"",required:!0,autoFocus:!0,onBlur:G,onKeyDown:K=>z(K),margin:"normal"}),e.jsx(f,{sx:{borderBottom:1,borderColor:"divider"},children:e.jsxs(Pe,{value:l,onChange:v,"aria-label":"Game Settings",centered:!0,children:[e.jsx(Q,{label:t("gameboard"),...X(0)}),e.jsx(Q,{label:t("room"),...X(1)}),e.jsx(Q,{label:t("application"),...X(2)})]})}),e.jsx(Z,{value:l,index:0,style:{p:0},children:e.jsx(Bn,{formData:u,setFormData:j,actionsList:m})}),e.jsx(Z,{value:l,index:1,style:{p:0,pt:1},children:e.jsx(Gn,{formData:u,setFormData:j})}),e.jsx(Z,{value:l,index:2,style:{p:0,pt:1},children:e.jsx(Rn,{formData:u,setFormData:j,boardUpdated:A})}),e.jsxs("div",{className:"flex-buttons",children:[e.jsx($,{variant:"outlined",type:"button",onClick:()=>h(!0),children:e.jsx(x,{i18nKey:"customTilesLabel",children:"Game Tiles"})}),e.jsx($,{variant:"contained",type:"submit",children:e.jsx(x,{i18nKey:"update"})})]}),!!d&&e.jsx(rn,{open:d,setOpen:h,boardUpdated:A,actionsList:m}),e.jsx(ln,{open:!!a,setOpen:c,close:()=>c(null),children:a})]})}function Y({children:n,justifyContent:s="space-evenly"}){return e.jsx(f,{sx:{mt:3,display:"flex",flexDirection:"row",justifyContent:s,alignItems:"center"},children:n})}function Jn({formData:n,setFormData:s,nextStep:t}){const i=le();function r(){i(n.room),t(C(n.room)?2:1)}return e.jsxs(f,{sx:{m:1},children:[e.jsx(g,{variant:"h6",children:e.jsx(x,{i18nKey:"publicOrPrivate"})}),e.jsx(f,{sx:{margin:"0.5rem"},children:e.jsx(ve,{formData:n,setFormData:s})}),e.jsx(Y,{children:e.jsx($,{variant:"contained",onClick:r,children:e.jsx(x,{i18nKey:C(n.room)?"nextSkip":"next"})})})]})}function Yn({formData:n,setFormData:s,nextStep:t,prevStep:i}){const[r,l]=b.useState(!R(n==null?void 0:n.gameMode));return b.useEffect(()=>{l(!R(n==null?void 0:n.gameMode))},[n==null?void 0:n.gameMode]),e.jsxs(f,{sx:{minHeight:"200px",display:"flex",flexDirection:"column"},children:[e.jsx(g,{variant:"h6",children:e.jsx(x,{i18nKey:"playingWithPeople"})}),e.jsx(q,{trueCondition:!R(n==null?void 0:n.gameMode),onChange:o=>s({...n,gameMode:o.target.checked?"local":"online",roomRealtime:!o.target.checked}),yesLabel:"yesInteracting"}),e.jsx(xe,{in:r,timeout:500,sx:{mt:r?2:0},children:e.jsxs(f,{children:[e.jsx(g,{variant:"h6",children:e.jsx(x,{i18nKey:"yourRole"})}),e.jsx(f,{sx:{display:"flex",justifyContent:"center"},children:e.jsx(_,{value:n.role,onChange:o=>s({...n,role:o.target.value}),label:"mainRole",options:["dom","vers","sub"],defaultValue:"sub",fullWidth:!1})}),e.jsx(g,{variant:"h6",sx:{mt:1},children:e.jsx(x,{i18nKey:"areYouNaked"})}),e.jsx(g,{variant:"body2",sx:{mt:1},children:e.jsx(x,{i18nKey:"nakedDisclaimer"})}),e.jsx(q,{onChange:o=>s({...n,isNaked:o.target.checked}),trueCondition:n.isNaked,yesLabel:"yesNaked"})]})}),e.jsx(f,{sx:{flexGrow:1}}),e.jsxs(Y,{children:[e.jsx($,{onClick:i,children:e.jsx(x,{i18nKey:"previous"})}),e.jsx($,{variant:"contained",onClick:t,children:e.jsx(x,{i18nKey:"next"})})]})]})}function ke(){return e.jsxs(g,{variant:"h6",sx:{mt:2},children:[e.jsx(x,{i18nKey:"setIntensityLevel"}),e.jsx(W,{title:e.jsx(x,{i18nKey:"intensityTooltip"}),arrow:!0,sx:{ml:1},children:e.jsx(T,{fontSize:"15"})})]})}const Qn=(n,s)=>{const{gameMode:t,isNaked:i}=n,r=R(t);return r&&["foreplay","sex"].includes(s.type)||!r&&i&&["solo","foreplay"].includes(s.type)||!r&&!i&&["solo","sex"].includes(s.type)},Xn=n=>Object.entries(n).reduce((s,[t,i])=>(Qn(n,i)||(s[t]=i),s),{}),we=(n,s,t)=>Object.entries(n).map(([i,r])=>{const l=s.find(o=>o.value===i);return r.type!==t||!l?null:i}).filter(i=>i),Zn=(n,s,t)=>{const i={...n};return Object.keys(i).forEach(r=>{i[r].type===s&&!t.includes(r)&&delete i[r]}),i},Ke=(n,s,t)=>{t(i=>{const r=Zn(i,s,n);return n.forEach(l=>{if(r[l])return;let o={type:s,level:1};s==="consumption"&&(o={...o,variation:r.isAppend?"appendMost":"standalone"}),r[l]=o}),r})},Ae=(n,s,t,i,r,l=null)=>{var a;const o=(a=n==null?void 0:n.target)==null?void 0:a.value;if(o===0)return r(c=>c.filter(d=>d!==s)),i(c=>{const d={...c};return delete d[s],d});i(c=>({...c,[s]:{...c[s],type:t,level:o,...!!l&&{variation:l}}}))};function Me({onChange:n,values:s,options:t,label:i}){function r(l){var o;return(o=t==null?void 0:t.find(a=>a.value===l))==null?void 0:o.label}return e.jsxs(U,{fullWidth:!0,children:[e.jsx(N,{id:`${i}-label`,children:i}),e.jsx(P,{labelId:`${i}-label`,id:`${i}`,multiple:!0,value:s,onChange:n,fullWidth:!0,input:e.jsx(ze,{label:e.jsx(x,{i18nKey:"actionsLabel"})}),renderValue:l=>e.jsx(f,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:l==null?void 0:l.map(o=>e.jsx(Ge,{label:r(o)},o))}),children:t==null?void 0:t.map(({label:l,value:o})=>e.jsxs(w,{value:o,children:[e.jsx(We,{checked:s.includes(o)}),e.jsx(Ee,{primary:l})]},o))})]})}const Dn=2;function es({formData:n,setFormData:s,options:t,actionsList:i}){const r="consumption",l=t(r),o=we(n,l,r),[a,c]=b.useState(o),d=u=>{const{value:j}=u.target;j.length<=Dn&&(c(j),Ke(j,r,s))},h=(u,j)=>{const p=j.reduce((y,S)=>(y[S]={...y[S],type:r,variation:u.target.checked?"appendMost":"standalone"},y),{...n,isAppend:u.target.checked});s(p)};return e.jsxs(e.Fragment,{children:[e.jsx(g,{variant:"h6",sx:{my:2},children:e.jsx(x,{i18nKey:"pickConsumptions"})}),e.jsx(Me,{onChange:d,values:a,options:l,label:e.jsx(x,{i18nKey:"consumables"})}),!!a.length&&e.jsxs(e.Fragment,{children:[e.jsx(ke,{}),a.map(u=>e.jsx(ie,{actionsFolder:i,settings:n,option:u,initValue:1,onChange:j=>Ae(j,u,r,s,c,n.isAppend?"appendMost":"standalone")},u)),e.jsx(g,{variant:"h6",sx:{mt:2},children:e.jsx(x,{i18nKey:"standaloneOrCombine"})}),e.jsx(q,{trueCondition:n.isAppend,onChange:u=>h(u,a),yesLabel:"combineWithActions"})]})]})}const ns=4,ss=n=>R(n==null?void 0:n.gameMode)?"solo":n.isNaked?"sex":"foreplay";function ts({formData:n,setFormData:s,options:t,actionsList:i}){const r=ss(n),l=t(r),o=we(n,l,r),[a,c]=b.useState(o),d=h=>{const{value:u}=h.target;u.length<=ns&&(c(u),Ke(u,r,s))};return e.jsxs(e.Fragment,{children:[e.jsx(g,{variant:"h6",sx:{my:2},children:e.jsx(x,{i18nKey:"pickActions"})}),e.jsx(Me,{onChange:d,values:a,options:l,label:e.jsx(x,{i18nKey:"actionsLabel"})}),!!a.length&&e.jsxs(e.Fragment,{children:[e.jsx(ke,{}),a.map(h=>e.jsx(ie,{actionsFolder:i,settings:n,option:h,initValue:1,onChange:u=>Ae(u,h,r,s,c)},h))]})]})}function is({formData:n,setFormData:s,nextStep:t,prevStep:i,actionsList:r}){function l(c){return Object.keys(r).filter(d=>{var h;return((h=r[d])==null?void 0:h.type)===c})}b.useEffect(()=>{const c=Xn(n);s(c)},[]);const o=c=>l(c).map(d=>{var h;return{value:d,label:(h=r[d])==null?void 0:h.label}}),a=!Object.keys(n).some(c=>n[c].level>0&&n[c].variation!=="appendMost");return e.jsxs(f,{children:[e.jsx(g,{variant:"body",sx:{my:2},children:e.jsx(x,{i18nKey:"actionsDisclaimer"})}),e.jsx(ts,{formData:n,setFormData:s,options:o,actionsList:r}),e.jsx(es,{formData:n,setFormData:s,options:o,actionsList:r}),e.jsxs(Y,{children:[e.jsx($,{onClick:()=>i(C(n.room)?2:1),children:e.jsx(x,{i18nKey:"previous"})}),e.jsx($,{variant:"contained",disabled:a,onClick:t,children:e.jsx(x,{i18nKey:"next"})})]})]})}function ls({formData:n,setFormData:s,prevStep:t,actionsList:i,close:r}){const l=[100,100],o=[0,0],a=ae(n.finishRange,o),c=Ce();function d(u){s({...n,finishRange:u.target.checked?o:l})}b.useEffect(()=>{let u={...n,boardUpdated:!0};(!a||!ae(n.finishRange,l))&&(u.finishRange=l),s(u)},[]);async function h(){await c(n,i),typeof r=="function"&&r()}return e.jsxs(f,{children:[e.jsx(g,{variant:"h6",sx:{my:2},children:e.jsx(x,{i18nKey:"WillYouOrgasm"})}),e.jsx(g,{variant:"body2",children:e.jsx(x,{i18nKey:"orgasmDisclaimer"})}),e.jsx(f,{sx:{display:"flex",justifyContent:"center",my:1},children:e.jsx(ue,{control:e.jsx(F,{checked:a||!1,onChange:d}),label:e.jsx(x,{i18nKey:a?"yesOrgasm":"noOrgasm"})})}),e.jsxs(Y,{children:[e.jsx($,{onClick:t,children:e.jsx(x,{i18nKey:"previous"})}),e.jsx($,{variant:"contained",onClick:h,children:e.jsx(x,{i18nKey:"buildGame"})})]})]})}function rs({close:n}){const{id:s}=J(),[t,i]=b.useState(1),r={room:s};C(s)&&(r.gameMode="online",r.roomRealtime=!0);const[l,o]=ye({gameMode:"online",roomRealtime:!0,actions:[],consumption:[],role:"sub"},r),a=b.useRef(!0),{actionsList:c}=fe(l.gameMode);b.useEffect(()=>{if(a.current){if(a.current=!1,l.advancedSettings)return u();if(typeof n=="function"){if(C(s))return i(3);i(2)}}},[l]);const d=p=>{if(!Number.isInteger(p))return i(t+1);i(t+p)},h=p=>{if(!Number.isInteger(p))return i(t-1);i(t-p)},u=()=>i("advanced"),j=()=>{switch(t){case 1:return e.jsx(Jn,{formData:l,setFormData:o,nextStep:d});case 2:return e.jsx(Yn,{formData:l,setFormData:o,nextStep:d,prevStep:h});case 3:return e.jsx(is,{formData:l,setFormData:o,nextStep:d,prevStep:h,actionsList:c});case 4:return e.jsx(ls,{formData:l,setFormData:o,prevStep:h,actionsList:c,close:n});default:return null}};return t==="advanced"?e.jsx(Hn,{closeDialog:n}):e.jsxs(f,{children:[e.jsx(f,{sx:{width:"100%",mt:2,mb:4},children:e.jsx(Fe,{activeStep:t-1,alternativeLabel:!0,children:[1,2,3,4].map(p=>e.jsx(Ve,{children:e.jsx(qe,{})},p))})}),j(),e.jsx(L,{sx:{mt:3}}),e.jsx($,{onClick:u,children:e.jsx(x,{i18nKey:"advancedSetup"})})]})}function os({open:n,close:s=null}){const t=he(),[i]=Xe();return i.get("importBoard")?null:e.jsxs(_e,{fullScreen:t,open:n,maxWidth:"md",children:[e.jsxs(He,{children:[e.jsx(x,{i18nKey:"gameSettings"}),typeof s=="function"&&e.jsx(Ye,{close:s})]}),e.jsx(Je,{children:e.jsx(rs,{close:s})})]})}const ys=Object.freeze(Object.defineProperty({__proto__:null,default:os},Symbol.toStringTag,{value:"Module"}));export{Hn as G,Z as T,pn as a,os as b,ys as i,un as s,An as u};
