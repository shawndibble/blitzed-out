import{j as e,f as $,aA as M,aB as I,aC as N,g as D,R as C,i as ie,U as ge,V as G,h as m,D as O,G as w,az as A,as as me,at as be,aK as fe,av as ye,aL as Se,aM as ve,aN as Ce,l as P,aO as ee,a1 as we,x as ke,y as _,B as re}from"./mui-tA4JU52E.js";import{T as Te}from"./index-EIdLQve3.js";import{d as W,i as U,a as Re,b as J}from"./strings-De54QQg-.js";import{s as ce,x as Ue,i as $e,g as ae,j as de,c as ue,l as Oe,u as he}from"./index-BemYt25L.js";import{a as V}from"./index-CDXSmTYn.js";import{r as f,u as ne,l as Ae}from"./vendor-poSPCy8P.js";import{u as Be,a as Le,C as Me}from"./useActionList-CFVl_jD8.js";import{i as z,u as k,T as j,t as te}from"./translations-C_O5cPfK.js";import{u as X}from"./index-CCfVmb6b.js";import{a as Ke,i as Ie}from"./urls-BP4ggioV.js";function Ne(n){const{t}=z;let s=`### ${t("roomSettings")}\r
`;return Object.entries(n).forEach(([i,l])=>{if(i!=="room"){if(i==="roomBackgroundURL"&&l!==""){s+=`* ${t(i)}: [${Ke(l)}:link:](${l})\r
`;return}if(i==="roomRealtime"){s+=`* ${t("playerList")}: ${t(l?"delayed":"realtime")}\r
`;return}l!==""&&(s+=`* ${t(i)}: ${l}\r
`)}}),s}function Pe(n){const t={};return Object.entries(n).forEach(([s,i])=>{s.startsWith("room")&&!["roomUpdated","roomBackground"].some(l=>l===s)&&(t[s]=i)}),t}async function Ee(n,t,s){let i=n;return t!==void 0&&t.length>0&&(i=await s(t)),i}function We(n,t){const s=Pe(n);return ce({room:n.room,user:t,text:Ne(s),type:"room",settings:JSON.stringify(s)})}function ze(n,t,s){const i=Object.entries(s).filter(([r])=>n[r]).reduce((r,[o,c])=>(r[o]=Object.keys(c.actions).slice(1,n[o]+1),r),{});return((t==null?void 0:t.filter(r=>{if(r.group==="misc")return!0;const o=i[r.group];return o&&o.length>=Number(r.intensity)}))||[]).length}function Ge(n,t,s,i){const{t:l}=z;let r=`### ${z.t("gameSettings")}\r
`;if(i&&(r+=`##### ${i}\r
`),r+=`--- \r
`,Object.entries(s).forEach(([d,x])=>{if(!n[d])return;const{role:p,variation:u,level:h}=n[d],y=p||n.role||"sub";if(h>0){const S=Object.keys((x==null?void 0:x.actions)||{});if(r+=`* ${x==null?void 0:x.label}: ${S[h]||""}`,u&&(r+=` (${l(u)})`),!W(n.gameMode)&&!u){const g=x[y]??l(y);r+=` (${g})`}r+=`\r
`}}),r.endsWith(`--- \r
`))return"";const{finishRange:o,difficulty:c}=n;r+=`--- \r
`,r+=`* ${l("difficulty")}: ${l(c??"normal")} \r
`,o&&(r+=`* ${l("finishSlider")} ${o[0]}%  | ${o[1]-o[0]}% | ${100-o[1]}%`);const a=ze(n,t,s);return a&&(r+=`* ${l("customTilesLabel")}: ${a} \r
`),r}function Ve(n){const t={};return Object.entries(n).forEach(([s,i])=>{!["displayName","background","boardUpdated","chatSound","mySound","otherSound","othersDialog","playerDialog","readRoll","hideBoardActions","advancedSettings"].includes(s)&&!s.startsWith("room")&&(t[s]=i)}),t}async function Fe({title:n,formData:t,user:s,actionsList:i,tiles:l,customTiles:r=[],reason:o=""}){const c=JSON.stringify(Ve(t)),a=await Ue({title:n,gameBoard:JSON.stringify(l),settings:c}),d=Ge(t,r,i,o);if(!(!(a!=null&&a.id)||d===""))return ce({room:(t==null?void 0:t.room)||"PUBLIC",user:s,text:d,type:"settings",gameBoardId:a.id,boardSize:l.length,gameMode:t.gameMode})}function qe(n){for(let t=n.length-1;t>0;t-=1){const s=Math.floor(Math.random()*(t+1));[n[t],n[s]]=[n[s],n[t]]}return n}function le(n){n.length>1&&n.push(n.shift())}function Pn(n,t){return(n==null?void 0:n.length)!==(t==null?void 0:t.length)?!1:n.every((s,i)=>s===t[i])}const{t:K}=z;function _e(n,t){return n.filter(s=>t==="vers"?s.includes("{sub}")&&s.includes("{dom}")||s.includes("{player}"):!s.match(/{(dom|sub)}/)||s.includes(`{${t}}`))}function Je(n,t,s){var r;const i=((r=n[t])==null?void 0:r.role)??n.role??"sub";return Object.keys(s).reduce((o,c,a)=>{var d;return a>0&&a<=((d=n[t])==null?void 0:d.level)&&(o[c]=qe(_e(s[c],i))),o},{})}function He(n,t){return Object.entries(n).filter(([s])=>{var i;return((i=t[s])==null?void 0:i.level)>0}).map(([s,i])=>{var l;return{label:i.label,actions:Je(t,s,i==null?void 0:i.actions),key:s,standalone:!1,role:((l=t[s])==null?void 0:l.role)??t.role??"sub"}})}function Qe(n,t){return t.length&&(t.some(({group:s})=>s==="misc")&&n.push({label:K("misc"),actions:{All:[]},key:"misc",standalone:!1}),t.forEach(({group:s,intensity:i,action:l})=>{const r=n.find(o=>o.key===s);if(r&&Object.keys(r.actions).length>=i){const o=Object.values(r.actions)[i-1];if(o){const c=Math.floor(Math.random()*(o.length+1));o.splice(c,0,l)}}})),n}function Ye(n){return Object.entries(n).reduce((t,[s,i])=>(i!=null&&i.variation&&(t[s]=i),t),{})}function Xe(n,t){const s=[],i=[...t];return Object.entries(n).forEach(([l,{level:r,variation:o}])=>{if(r<=0)return;const c=t.findIndex(d=>d.key===l);if(c===-1)return;if(o==="standalone"){i[c].standalone=!0;return}const a=o==="appendSome"?.4:.9;s.push({...t[c],frequency:a}),i.splice(c,1)}),{appendList:s,listWithoutAppend:i}}function Ze(n,t,s,i){if([void 0,"normal"].includes(i)){const l=n/t;return Math.floor(s/l)}return t>=3&&Math.random()>=.6?t-2:t-1}function oe(n,t,s,i){le(n);const{actions:l,label:r,standalone:o,frequency:c,role:a}=n[0],d=Math.random();if(c&&c<=d)return{title:"",description:""};const x=Object.keys(l),p=Object.values(l);let u=Ze(t,x.length,s,i==null?void 0:i.difficulty);return p[u]||(u=Math.max(0,u-1)),p[u]&&p[u].length>0?(le(p[u]),{title:r,description:p[u][0],standalone:o,role:a}):{title:"",description:""}}function De(n,t,s){const i=Ye(t),{listWithoutAppend:l,appendList:r}=Xe(i,n),o=[];for(let c=1;c<=s;c+=1){const{title:a,description:d,standalone:x,role:p}=oe(l,s,c,t);let u="";if(!x&&r.length&&d){const{description:h}=oe(r,s,c,t);h?u=`${h.trim().replace(/([^.,!?])$/,"$1.")} ${d}`:u=d}else u=d||"";o.push({title:a,description:u.trim(),role:p})}return o}function en(n,t){const s={title:K("start"),description:K("start")},{finishRange:i=[33,66]}=t,l=`${K("noCum")} ${i[0]}%\r
${K("ruined")} ${i[1]-i[0]}%\r
${K("cum")} ${100-i[1]}%`,r={title:K("finish"),description:l};return[s,...n,r]}function nn(n,t,s=[],i=40){const l=Object.entries(t).reduce((a,[d,x])=>(a[d]={...x,actions:Object.keys(x.actions||{}).reduce((p,u)=>(p[u]=[],p),{})},a),{}),r=He(l,n);!r.length&&!s.length&&(localStorage.clear(),window.location.reload());const o=Qe(r,s),c=De(o,n,i-2);return en(c,n)}function tn(){const n=X(ue),[t,s]=V("gameSettings"),{i18n:i}=k(),l=f.useCallback(async r=>{var b;const o=r!=null&&r.roomUpdate||r!=null&&r.boardUpdated?r:{...t,...r};let{gameMode:c,boardUpdated:a}=o;const{roomTileCount:d=40,finishRange:x,room:p}=o,u=U(p||"");if(!r||!x)return{gameMode:c};u&&!W(c||"")&&(c="online",a=!0);const h=await $e(i.resolvedLanguage,c||"online"),y=u?40:d||40,S=await ae(c||"online"),g=nn(o,h,S,y);return(r!=null&&r.boardUpdated||a||((b=n==null?void 0:n.tiles)==null?void 0:b.length)!==g.length)&&(await s(o),await de({title:(n==null?void 0:n.title)||"",tiles:g})),{settingsBoardUpdated:a,gameMode:c,newBoard:g}},[n,i.resolvedLanguage,t,s]);return f.useCallback(r=>l(r),[l])}function H({children:n,value:t,index:s,style:i,...l}){return e.jsx("div",{role:"tabpanel",hidden:t!==s,id:`simple-tabpanel-${s}`,"aria-labelledby":`simple-tab-${s}`,...l,children:t===s&&e.jsx($,{sx:{p:3,...i},children:n})})}function xe({formData:n,setFormData:t,backgrounds:s,isRoom:i=!1}){const{t:l}=k(),r=i?"roomBackground":"background",o=i?"roomBackgroundURL":"backgroundURL",[c,a]=f.useState((n==null?void 0:n[r])||Object.keys(s)[0]),d=()=>Object.entries(s).map(([u,h])=>e.jsx(C,{value:u,children:h},u)),x=u=>{t({...n,[r]:u.target.value}),a(u.target.value)};f.useEffect(()=>{c!==(n==null?void 0:n[r])&&a((n==null?void 0:n[r])||"")},[n,c,r]);const p=u=>{const h={...n,[r]:"custom",[o]:u.target.value};i&&(h.roomUpdated=!0),t(h)};return e.jsxs(e.Fragment,{children:[e.jsxs(M,{fullWidth:!0,margin:"normal",children:[e.jsx(I,{id:"background-label",children:l("background")}),e.jsx(N,{labelId:"background-label",id:"background",label:l("background"),value:c||"",onChange:x,children:d()})]}),c==="custom"&&e.jsx(D,{sx:{mt:2},label:l("url"),value:(n==null?void 0:n[o])||"",fullWidth:!0,onChange:p,helperText:e.jsxs(e.Fragment,{children:[l("supportedSites"),e.jsx("br",{}),l("requiresEmbeddedUrl")]})})]})}function sn({boardUpdated:n}){const{i18n:t}=k(),[s,i]=f.useState(t.resolvedLanguage||"en");function l(o){i(o),t.changeLanguage(o),n()}const r=Object.entries(Oe).map(([o,c])=>e.jsx(C,{value:o,children:c.label},o));return e.jsx($,{sx:{minWidth:120,mt:1,mb:2},children:e.jsxs(M,{fullWidth:!0,children:[e.jsxs(I,{id:"language-label",sx:{display:"flex",alignItems:"center"},children:[e.jsx(ie,{sx:{mr:1}}),e.jsx(j,{i18nKey:"language"})]}),e.jsx(N,{labelId:"language-label",id:"language-select",value:s,label:e.jsxs(e.Fragment,{children:[e.jsx(ie,{}),e.jsx(j,{i18nKey:"language"})]}),onChange:o=>l(o.target.value),children:r})]})})}function rn({trueCondition:n,onChange:t,yesLabel:s,noLabel:i=null,sx:l={}}){const r=i??s;return e.jsx($,{sx:{display:"flex",justifyContent:"center",my:1,...l},children:e.jsx(ge,{control:e.jsx(G,{checked:n||!1,onChange:t}),label:te(n?s:r)})})}function L({field:n,formData:t,handleSwitch:s}){return e.jsx(rn,{trueCondition:t[n],onChange:i=>s(i,n),yesLabel:`${n}Enable`,sx:{justifyContent:"left"}})}function ln({formData:n,setFormData:t,boardUpdated:s}){const[i,l]=V("gameSettings"),{t:r}=k(),o={color:r("color"),gray:r("gray"),"metronome.gif":r("hypnoDick"),"pink-spiral.gif":r("pinkSpiral"),custom:r("customURL")};function c(a,d){t({...n,[d]:a.target.checked}),l({...i,[d]:a.target.checked})}return e.jsxs(e.Fragment,{children:[e.jsx(sn,{boardUpdated:s}),e.jsx(m,{variant:"h5",children:e.jsx(j,{i18nKey:"dialog"})}),e.jsx(L,{field:"playerDialog",formData:n,handleSwitch:c}),e.jsx(L,{field:"othersDialog",formData:n,handleSwitch:c}),e.jsx(O,{}),e.jsx(m,{variant:"h5",sx:{mt:2},children:e.jsx(j,{i18nKey:"sounds"})}),e.jsx(L,{field:"mySound",formData:n,handleSwitch:c}),e.jsx(L,{field:"otherSound",formData:n,handleSwitch:c}),e.jsx(L,{field:"chatSound",formData:n,handleSwitch:c}),e.jsx(L,{field:"readRoll",formData:n,handleSwitch:c}),e.jsx(O,{}),e.jsx(m,{variant:"h5",sx:{mt:2,textTransform:"capitalize"},children:e.jsx(j,{i18nKey:"misc"})}),e.jsx(L,{field:"hideBoardActions",formData:n,handleSwitch:c}),e.jsx(L,{field:"advancedSettings",formData:n,handleSwitch:c}),e.jsx(xe,{formData:n,setFormData:t,backgrounds:o}),e.jsx(O,{})]})}function Q({children:n}){return e.jsx(w,{size:{xs:12,md:5},children:n})}const Z=f.forwardRef(({value:n,onChange:t,label:s,options:i,defaultValue:l=null,sx:r,helpIcon:o=!1,fullWidth:c=!0,...a},d)=>{const x=i.map(p=>typeof p=="string"?e.jsx(C,{value:p,children:te(p)},p):e.jsx(C,{value:p.value,children:p.label},p.value));return e.jsxs(M,{fullWidth:c,margin:"normal",sx:r,...a,ref:d,children:[e.jsxs(I,{id:`${s}Label`,children:[e.jsx(j,{i18nKey:s}),!!o&&e.jsx(A,{sx:{ml:1,fontSize:16}})]}),e.jsx(N,{labelId:`${s}Label`,id:s,label:e.jsxs(e.Fragment,{children:[e.jsx(j,{i18nKey:s}),!!o&&e.jsx(A,{sx:{ml:1,fontSize:16}})]}),value:n||l||"",onChange:t,children:x})]})});function Y({children:n,title:t,subtitle:s,defaultExpanded:i=!1,...l}){return e.jsxs(me,{defaultExpanded:i,...l,sx:{backgroundColor:"inherit",backgroundImage:"none",boxShadow:"none"},children:[e.jsxs(be,{expandIcon:e.jsx(fe,{}),sx:{px:0},children:[e.jsxs(m,{variant:"h6",sx:{width:"33%"},children:[t,":"]}),e.jsx(m,{sx:{pt:.5},children:s})]}),e.jsx(ye,{sx:{px:0},children:e.jsx(w,{container:!0,columnSpacing:2,justifyContent:"space-evenly",className:"columned-grid",children:n})})]})}function on({formData:n,setFormData:t}){const s=(l,r)=>{t({...n,finishRange:r,boardUpdated:!0})},i=(n==null?void 0:n.finishRange)||[30,70];return e.jsxs($,{children:[e.jsx(O,{}),e.jsx(m,{id:"finish-slider",sx:{my:1},children:e.jsx(j,{i18nKey:"finishSlider"})}),e.jsx(Se,{"aria-labelledby":"finish-slider",value:i,onChange:s,valueLabelDisplay:"off"}),e.jsxs($,{display:"flex",flexDirection:"column",justifyContent:"space-between",textAlign:"center",children:[e.jsxs(m,{whiteSpace:"nowrap",children:[e.jsx(j,{i18nKey:"noCum"})," ",i[0],"%"]}),e.jsxs(m,{whiteSpace:"nowrap",children:[e.jsx(j,{i18nKey:"ruined"})," ",i[1]-i[0],"%"]}),e.jsxs(m,{whiteSpace:"nowrap",children:[e.jsx(j,{i18nKey:"cum"})," ",100-i[1],"%"]})]}),e.jsx(O,{sx:{my:1}})]})}function cn(){const[n,t]=f.useState(!1);return f.useEffect(()=>{const s=window.matchMedia("(pointer: fine)");t(s.matches);const i=l=>{t(l.matches)};return s.addEventListener("change",i),()=>{s.removeEventListener("change",i)}},[]),n}function an({actionsFolder:n,settings:t,option:s,onChange:i,initValue:l=0}){var h,y,S;const r=`${s}label`,o=(h=n[s])==null?void 0:h.label,c=cn(),[a,d]=f.useState(((y=t[s])==null?void 0:y.level)||0),x=g=>{d(g)},p=g=>a>0&&g===0?!1:t.difficulty==="accelerated"?a<=2?a===g:a===g||a-1===g:a>=g;function u(g){var b;return Object.keys(((b=n[g])==null?void 0:b.actions)||{}).map((T,v)=>e.jsxs(C,{value:v,onMouseOver:()=>x(v),children:[!!c&&e.jsx("span",{className:"menu-item-icon",children:p(v)?e.jsx(ve,{}):e.jsx(Ce,{})}),T]},`${g}-${T}`))}return e.jsxs(M,{margin:"normal",fullWidth:!0,children:[e.jsx(I,{id:r,children:o}),e.jsx(N,{labelId:r,id:s,label:o,value:((S=t[s])==null?void 0:S.level)||l,onChange:i,onOpen:()=>{var g;return d(((g=t[s])==null?void 0:g.level)||l)},onClose:()=>{var g;return d(((g=t[s])==null?void 0:g.level)||l)},children:u(s)})]})}function dn({option:n,settings:t,setSettings:s,actionsFolder:i,type:l,showVariation:r=!1,showRole:o=!1}){var h,y,S,g;const{t:c}=k(),a=`${n}label`,d=(h=i[n])==null?void 0:h.label;function x(b,T,v){var B;s({...t,[T]:{...t[T],type:l,[v]:(B=b==null?void 0:b.target)==null?void 0:B.value},boardUpdated:!0})}let p=12;(r||o)&&(p=6);let u=["dom","vers","sub"];return(y=i[n])!=null&&y.dom&&(u=[{label:i[n].dom,value:"dom"},{label:c("vers"),value:"vers"},{label:i[n].sub,value:"sub"}]),e.jsxs(w,{container:!0,justifyContent:"center",children:[e.jsx(w,{size:p,children:e.jsx(an,{actionsFolder:i,settings:t,option:n,onChange:b=>x(b,n,"level")})}),!!o&&e.jsx(w,{size:6,children:e.jsx(Z,{sx:{ml:1},value:(S=t[n])==null?void 0:S.role,onChange:b=>x(b,n,"role"),label:`${c("role")}: ${d}`,options:u,defaultValue:t.role||"sub"})}),!!r&&e.jsx(w,{size:6,children:e.jsx(P,{placement:"top",title:e.jsxs(j,{i18nKey:"variationTooltip",children:[e.jsx(m,{variant:"subtitle2",children:"Standalone = Its own tile. "}),e.jsx(m,{variant:"subtitle2",children:"Append Some = 50% chance."}),e.jsx(m,{variant:"subtitle2",children:"Append Most = 90% chance."})]}),arrow:!0,children:e.jsxs(M,{fullWidth:!0,margin:"normal",sx:{ml:1},children:[e.jsxs(I,{id:`${a}Variation`,children:[`${d} ${c("variation")}`,e.jsx(A,{sx:{ml:1,fontSize:16}})]}),e.jsxs(N,{labelId:`${a}Variation`,id:`${n}Variation`,label:e.jsxs(e.Fragment,{children:[d," ",c("variation"),e.jsx(A,{sx:{ml:1,fontSize:16}})]}),value:((g=t[n])==null?void 0:g.variation)||"standalone",onChange:b=>x(b,n,"variation"),children:[e.jsx(C,{value:"standalone",children:e.jsx(j,{i18nKey:"standalone"})}),e.jsx(C,{value:"appendSome",children:e.jsx(j,{i18nKey:"appendSome"})}),e.jsx(C,{value:"appendMost",children:e.jsx(j,{i18nKey:"appendMost"})})]})]})})})]},n)}function un({formData:n,setFormData:t}){return e.jsxs(ee,{direction:"row",spacing:1,alignItems:"center",justifyContent:"center",sx:{mt:1},children:[e.jsx(m,{children:e.jsx(j,{i18nKey:"solo"})}),e.jsx(P,{title:e.jsx(m,{variant:"subtitle2",children:e.jsx(j,{i18nKey:"soloTooltip"})}),arrow:!0,children:e.jsx(A,{sx:{fontSize:15}})}),e.jsx(G,{id:"gameMode",checked:!W(n.gameMode),onChange:s=>t({...n,gameMode:s.target.checked?"local":"online",boardUpdated:!0}),inputProps:{"aria-label":"Game Type"}}),e.jsx(m,{children:e.jsx(j,{i18nKey:"local"})}),e.jsx(P,{title:e.jsx(m,{variant:"subtitle2",children:e.jsx(j,{i18nKey:"localTooltip"})}),arrow:!0,children:e.jsx(A,{sx:{fontSize:15}})})]})}function hn({formData:n}){const[t,s]=f.useState(!1);return f.useEffect(()=>{const i=Object.values(n).filter(r=>typeof r=="object"&&(r==null?void 0:r.type)==="consumption"&&(r==null?void 0:r.level)>0).length,l=Object.values(n).filter(r=>typeof r=="object"&&(r==null?void 0:r.level)>0).length;s(i>1&&i>=l-i)},[n]),t?e.jsx(we,{severity:"warning",children:e.jsx(j,{i18nKey:"consumptionWarning"})}):null}function xn({formData:n,setFormData:t,actionsList:s}){const{t:i}=k(),l=!U(n==null?void 0:n.room)&&!W(n.gameMode);function r(c,a={}){return Object.keys(s).filter(d=>{var x;return((x=s[d])==null?void 0:x.type)===c}).map(d=>e.jsx(Q,{children:e.jsx(dn,{option:d,settings:n,setSettings:t,actionsFolder:s,type:c,...a})},d))}const o=c=>{const a=JSON.parse(JSON.stringify(n));return Object.keys(a).forEach(d=>{a.role=c,d.includes("role")&&(a[d]=c)}),a};return e.jsxs(e.Fragment,{children:[e.jsx(un,{formData:n,setFormData:t}),U(n==null?void 0:n.room)&&!W(n.gameMode)&&e.jsx(w,{container:!0,alignContent:"center",justifyContent:"space-evenly",children:e.jsx(w,{sx:{py:3},children:e.jsx(m,{variant:"h5",children:e.jsx(j,{i18nKey:"privateRequired"})})})}),e.jsxs(w,{container:!0,columnSpacing:2,justifyContent:"space-evenly",children:[e.jsx(Q,{children:e.jsx(P,{placement:"top",title:e.jsx(j,{i18nKey:"difficultyTooltip",children:e.jsxs(m,{variant:"body2",children:["Normal = Slow ramp up. ",e.jsx("br",{}),e.jsx("br",{}),"Accelerated = Straight to max level + the level prior to it."]})}),arrow:!0,children:e.jsx(Z,{value:n.difficulty,onChange:c=>t({...n,difficulty:c.target.value,boardUpdated:!0}),label:"difficulty",options:["normal","accelerated"],defaultValue:"normal",helpIcon:!0})})}),l&&e.jsx(Q,{children:e.jsx(Z,{value:n.role,onChange:c=>t({...o(c.target.value),boardUpdated:!0}),label:"mainRole",options:["dom","vers","sub"],defaultValue:"sub"})})]}),l?e.jsxs(e.Fragment,{children:[e.jsx(Y,{title:i("consumption"),subtitle:i("consumptionSubtitle"),children:r("consumption",{showVariation:!0})}),e.jsx(Y,{title:i("foreplay"),subtitle:i("foreplaySubtitle"),children:r("foreplay",{showRole:l})}),e.jsx(Y,{title:i("sex"),subtitle:i("sexSubtitle"),children:r("sex",{showRole:l})})]}):e.jsxs(e.Fragment,{children:[e.jsx(w,{container:!0,columnSpacing:2,justifyContent:"space-evenly",children:r("consumption",{showVariation:!0})}),e.jsx(O,{}),e.jsx(w,{container:!0,columnSpacing:2,justifyContent:"center",children:r("solo")})]}),e.jsx(on,{setFormData:t,formData:n}),e.jsx(hn,{formData:n})]})}function jn({formData:n,setFormData:t}){const{t:s}=k(),i={"1d4":2.5,"1d6":3.5,"2d4":5},l=n!=null&&n.roomTileCount?Math.floor(n.roomTileCount/i[n.roomDice||"1d6"]):16,r=Array.from({length:7},(o,c)=>(c+2)*10).map(o=>e.jsx(C,{value:o,children:o},o));return e.jsxs(e.Fragment,{children:[e.jsx(m,{children:e.jsx(j,{i18nKey:"gameSpeed"})}),e.jsxs($,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[e.jsxs(M,{sx:{m:1},fullWidth:!0,children:[e.jsx(I,{id:"diceRole-label",children:e.jsx(j,{i18nKey:"roomDice"})}),e.jsxs(N,{labelId:"diceRole-label",id:"diceRole-select",value:(n==null?void 0:n.roomDice)||"1d4",label:s("roomDice"),onChange:o=>t({...n,roomDice:o.target.value,roomUpdated:!0}),children:[e.jsx(C,{value:"1d4",children:"1d4"}),e.jsx(C,{value:"1d6",children:"1d6"}),e.jsx(C,{value:"2d4",children:"2d4"})]})]}),e.jsxs(M,{sx:{m:1},fullWidth:!0,children:[e.jsx(I,{id:"tile-count-label",children:e.jsx(j,{i18nKey:"roomTileCount"})}),e.jsx(N,{labelId:"tile-count-label",id:"tile-count-select",value:String((n==null?void 0:n.roomTileCount)||40),label:s("roomTileCount"),onChange:o=>t({...n,roomTileCount:Number(o.target.value),roomUpdated:!0}),children:r})]}),e.jsx(M,{fullWidth:!0,children:e.jsxs(m,{children:[e.jsx(j,{i18nKey:"averageRolls"}),l]})})]})]})}function pn({formData:n,setFormData:t}){const s=f.useCallback(()=>{t({...n,roomRealtime:!n.roomRealtime,roomUpdated:!0})},[n,t]);return e.jsxs(e.Fragment,{children:[e.jsx(m,{children:e.jsx(j,{i18nKey:"playerListOptions"})}),e.jsxs(ee,{direction:"row",spacing:1,alignItems:"center",justifyContent:"center",sx:{width:"100%"},children:[e.jsx(m,{children:e.jsx(j,{i18nKey:"realtime"})}),e.jsx(P,{title:e.jsx(m,{variant:"subtitle2",children:e.jsx(j,{i18nKey:"realtimeTooltip"})}),arrow:!0,children:e.jsx(A,{sx:{fontSize:15}})}),e.jsx(G,{id:"showPrivate",checked:!!n.roomRealtime,onChange:s,inputProps:{"aria-label":te("playerList")}}),e.jsx(m,{children:e.jsx(j,{i18nKey:"delayed"})}),e.jsx(P,{title:e.jsx(m,{variant:"subtitle2",children:e.jsx(j,{i18nKey:"delayedTooltip"})}),arrow:!0,children:e.jsx(A,{sx:{fontSize:15}})})]})]})}let gn=n=>crypto.getRandomValues(new Uint8Array(n)),mn=(n,t,s)=>{let i=(2<<Math.log2(n.length-1))-1,l=-~(1.6*i*t/n.length);return(r=t)=>{let o="";for(;;){let c=s(l),a=l|0;for(;a--;)if(o+=n[c[a]&i]||"",o.length>=r)return o}}},bn=(n,t=21)=>mn(n,t|0,gn);function fn({formData:n,setFormData:t}){var a;const{id:s}=ne(),{t:i}=k(),l=d=>{let x;d.target.checked&&U(s)?x=bn("123456789ABCDEFGHJKLMNPQRSTUVWXYZ",5)():s&&d.target.checked&&!U(s)?x=s:x="PUBLIC",t({...n,room:x,gameMode:U(x)?"online":n.gameMode})},r=f.useCallback(d=>{t({...n,room:d.currentTarget.value,boardUpdated:!0})},[n,t]),o=f.useCallback(d=>{d.key==="Enter"&&t({...n,room:d.currentTarget.value,boardUpdated:!0})},[n,t]),c=!U(n.room);return e.jsxs(e.Fragment,{children:[e.jsxs(ee,{direction:"row",spacing:1,alignItems:"center",justifyContent:"center",sx:{width:"100%"},children:[e.jsx(m,{children:e.jsx(j,{i18nKey:"public"})}),e.jsx(G,{id:"showPrivate",checked:c,onChange:l,slotProps:{input:{"aria-label":i("room")}}}),e.jsx(m,{children:e.jsx(j,{i18nKey:"private"})}),e.jsx(P,{title:e.jsx(m,{variant:"subtitle2",children:e.jsx(j,{i18nKey:"privateOptions"})}),arrow:!0,children:e.jsx(A,{sx:{fontSize:15}})})]}),c&&e.jsx(D,{fullWidth:!0,id:"privateRoom",label:"Private Room",defaultValue:(a=n.room)==null?void 0:a.toUpperCase(),margin:"normal",onBlur:r,onKeyDown:o})]})}function yn({formData:n,setFormData:t}){const{t:s}=k(),i={app:s("appBackground"),custom:s("customURL")};return e.jsxs($,{sx:{margin:"0.5rem"},children:[e.jsx(fn,{formData:n,setFormData:t}),!U(n.room)&&e.jsxs(e.Fragment,{children:[e.jsx(O,{sx:{my:1}}),e.jsx(jn,{formData:n,setFormData:t}),e.jsx(O,{sx:{my:1}}),e.jsx(pn,{formData:n,setFormData:t}),e.jsx(O,{sx:{my:1}}),e.jsx(xe,{formData:n,setFormData:t,backgrounds:i,isRoom:!0})]})]})}function Sn(n){return Object.values(n).some(({level:t})=>t>0)}function vn(n,t){return Object.entries(n).reduce((s,[i,l])=>{var r;return i in t&&((r=l==null?void 0:l.variation)!=null&&r.startsWith("append")?s.withAppend[i]=l:s.withoutAppend[i]=l),s},{withAppend:{},withoutAppend:{}})}function Cn(n){return Object.keys(n).length>0&&Object.values(n).some(({level:t})=>t>0)}function wn(n,t){const{withAppend:s,withoutAppend:i}=vn(n,t);return Sn(i)?U(n.room)&&!W(n.gameMode)?"privateRequired":null:Cn(s)?"appendWithAction":"pickSomething"}function je(){const{id:n}=ne(),t=Ae();return i=>{(n==null?void 0:n.toUpperCase())!==(i==null?void 0:i.toUpperCase())&&t(`/${i||"PUBLIC"}`)}}function kn(n){(!n.roomBackgroundURL||!Ie(n.roomBackgroundURL))&&(n.roomBackground="app")}function Tn(){const{user:n,updateUser:t}=he(),{id:s}=ne(),{t:i}=k(),l=tn(),[r,o]=V("gameSettings"),c=X(()=>ae(r==null?void 0:r.gameMode)),a=X(ue),d=je(),{messages:x}=Re(),p=f.useCallback(h=>{const y=(s==null?void 0:s.toUpperCase())!==h.room.toUpperCase(),S=!!(h.room&&!U(h.room)),g=S&&h.roomTileCount!==(r==null?void 0:r.roomTileCount);return{roomChanged:y,isPrivateRoom:S,privateBoardSizeChanged:g}},[s,r==null?void 0:r.roomTileCount]),u=f.useCallback(async(h,y)=>{const{displayName:S}=h,g=await Ee(n,S,t);kn(h);const{settingsBoardUpdated:b,gameMode:T,newBoard:v=[]}=await l(h),{roomChanged:B,isPrivateRoom:F,privateBoardSizeChanged:q}=p(h);g&&(F&&(h.roomUpdated||!x.find(R=>R.type==="room"))&&await We(h,g),(a==null?void 0:a.tiles)!==v&&await de({title:i("settingsGenerated"),tiles:v,isActive:1,gameMode:T}),(b||B||q)&&await Fe({formData:h,user:g,customTiles:c,actionsList:y,title:"Settings Generated Board",tiles:v}),o({...h,boardUpdated:!1,roomUpdated:!1,gameMode:T}),d(h.room))},[n,t,l,p,x,a,i,c,o,d]);return f.useCallback((h,y)=>u(h,y),[u])}function Rn({closeDialog:n,initialTab:t=0}){const{user:s}=he(),{t:i}=k(),[l,r]=V("gameSettings"),[o,c]=f.useState(t),[a,d]=f.useState(null),[x,p]=f.useState(!1),[u,h]=Be(),y=je(),S=Tn(),{isLoading:g,actionsList:b}=Le(u==null?void 0:u.gameMode),T=(R,E)=>{c(E),y(u.room)},v=()=>r({...l,boardUpdated:!0});async function B(R){R.preventDefault();const{displayName:E,...pe}=u,se=wn(pe,b);return se?(d(i(se)),null):(S(u,b),typeof n=="function"&&n(),null)}const F=f.useCallback(R=>{h(E=>({...E,displayName:R.target.value}))},[h]),q=f.useCallback(R=>{R.key==="Enter"&&(h(E=>({...E,displayName:R.target.value})),B(R))},[B,h]);return!u.room||g?e.jsxs($,{children:[e.jsxs(m,{variant:"h2",children:[e.jsx(j,{i18nKey:"loading"}),"..."]}),e.jsx(m,{variant:"body1",children:e.jsx(j,{i18nKey:"clearStorage"})})]}):e.jsxs($,{component:"form",method:"post",onSubmit:B,className:"settings-box",children:[e.jsx(D,{fullWidth:!0,id:"displayName",label:i("displayName"),defaultValue:(s==null?void 0:s.displayName)||u.displayName||"",required:!0,autoFocus:!0,onBlur:F,onKeyDown:q,margin:"normal"}),e.jsx($,{sx:{borderBottom:1,borderColor:"divider"},children:e.jsxs(ke,{value:o,onChange:T,"aria-label":"Game Settings",centered:!0,children:[e.jsx(_,{label:i("gameboard"),...J(0)}),e.jsx(_,{label:i("room"),...J(1)}),e.jsx(_,{label:i("application"),...J(2)})]})}),e.jsx(H,{value:o,index:0,style:{p:0},children:e.jsx(xn,{formData:u,setFormData:h,actionsList:b})}),e.jsx(H,{value:o,index:1,style:{p:0,pt:1},children:e.jsx(yn,{formData:u,setFormData:h})}),e.jsx(H,{value:o,index:2,style:{p:0,pt:1},children:e.jsx(ln,{formData:u,setFormData:h,boardUpdated:v})}),e.jsxs("div",{className:"flex-buttons",children:[e.jsx(re,{variant:"outlined",type:"button",onClick:()=>p(!0),children:e.jsx(j,{i18nKey:"customTilesLabel",children:"Game Tiles"})}),e.jsx(re,{variant:"contained",type:"submit",children:e.jsx(j,{i18nKey:"update"})})]}),!!x&&e.jsx(Me,{open:x,setOpen:p,boardUpdated:v,actionsList:b}),e.jsx(Te,{open:!!a,close:()=>d(null),children:a})]})}const En=Object.freeze(Object.defineProperty({__proto__:null,default:Rn},Symbol.toStringTag,{value:"Module"}));export{Rn as G,an as I,fn as R,Z as S,H as T,rn as Y,Fe as a,je as b,Pn as c,Tn as d,En as i,We as s,tn as u};
