import{j as e,g as F,k as N,i as K,b4 as q,t as H,n as G,p as M,o as R,f as E,B as z,b5 as Q,h as S,V as U,l as X,X as Y}from"./mui-BnTXCE-8.js";import{a as _,C as J,A as Z,c as b,d as ee}from"./index-Dp22mWpS.js";import{C as P,u as te}from"./index-DUaPncvf.js";import{a as h}from"./vendor-Bf6wU4zJ.js";import{a as V,u as se,b as ie,d as ne,c as oe}from"./gameBoard-B4NCWdD8.js";import{u as ae,T as L,t as g}from"./translations-CairTNs2.js";import{T as re}from"./index-BEyo3J6m.js";import{u as le,n as ce,s as de}from"./index-CzcRMrQJ.js";import"./strings-DL3cDbr1.js";import"./firebase-CsLsfVdN.js";function ue({open:f,close:B,setAlert:a,board:n}){const{t:s}=ae(),[d,p]=h.useState(""),[r,D]=h.useState(n.title);function T(i){try{return r.length?i.map((o,u)=>{const[l,...j]=o.split(`
`).filter(A=>A);if(l===void 0)throw a({message:s("importNoEmpty")});if(!/^\[.+\]$/.test(l))throw a({message:s("importInvalidTitle",{entry:u+1})});if(!j.length)throw a({message:s("importMissingDescription",{entry:u+1})});return{title:l==null?void 0:l.replace(/\[|\]/g,""),description:j.join(`
`)}}):a({message:s("importTitleRequired")})}catch{return null}}const m=async()=>{const i=d.split(/~+/).filter(u=>u),o=T(i);if(!o)return null;if(JSON.stringify(n.tiles)===JSON.stringify(o))return a({message:s("importNoChange")});V({...n,title:r,tiles:o}),a({message:s("saved"),type:"success"}),B()},w=()=>{var o;const i=(o=n==null?void 0:n.tiles)==null?void 0:o.map(({title:u,description:l})=>`[${u}]
${l}`);p(i==null?void 0:i.join(`
~~
`))},k=i=>{D(i.target.value)},I=async i=>{if(!i.target.value.length)return a({message:s("importTitleRequired")});V({...n,title:i.target.value})};return h.useEffect(()=>{f&&w()},[f]),e.jsxs(e.Fragment,{children:[e.jsx(F,{fullWidth:!0,label:s("title"),value:r,onChange:k,onBlur:I}),e.jsx(F,{sx:{mt:2},multiline:!0,fullWidth:!0,value:d,onChange:i=>p(i.target.value),InputProps:{endAdornment:e.jsxs("div",{style:{display:"flex",flexDirection:"column",position:"sticky",top:0},children:[e.jsx(N,{title:s("save"),children:e.jsx(K,{size:"small",onClick:m,children:e.jsx(q,{color:"success"})})}),e.jsx(P,{text:d}),e.jsx(P,{text:`${window.location.href}?importBoard=${n.id}`,copiedText:s("copiedLink"),icon:e.jsx(H,{}),tooltip:s("copyShareLink")})]}),sx:{alignItems:"flex-start"}}})]})}function ve({open:f,close:B,isMobile:a}){var O;const n=te(oe),[s,d]=h.useState(null),[p,r]=h.useState(!1),[D,T]=h.useState(!1),m=_("gameSettings")[0],{user:w}=le();if(!n)return null;const k=t=>t[t.length-1].description.match(/\d+%/g);async function I({title:t,tiles:c}){const x=c.map(({title:W})=>`* ${W} 
`);x.pop(),x.shift();let y=`### ${g("activated")}: ${t}
`;y+=`---
`,y+=[...new Set(x)].join(" "),y+=`---
`;const v=k(c);v.length===3&&(y+=`* ${g("finishSlider")} ${v[0]}  | ${v[1]} | ${v[2]}`);const C=await ce({gameBoard:JSON.stringify(c),settings:JSON.stringify(m)});C!=null&&C.id&&await de({room:m.room||"PUBLIC",user:w,text:y,type:"settings",gameBoardId:C.id,boardSize:c.length,gameMode:m.gameMode})}const i=async()=>{const t=await se({isActive:0});T(t)},o=t=>{ie(t.id),I(t),d({message:g("boardEnabled"),type:"success"})},u=t=>{r(t)},l=()=>{ne(p),r(0)},j=t=>(c,x)=>{T(x?t:!1)},$=t=>!t.tiles||t.tiles.length!==(m.roomTileCount||40),A=t=>$(t)?g("boardWrongSize",{size:m.roomTileCount||40}):t.isActive?g("boardActive"):g("enableBoard");return e.jsxs(e.Fragment,{children:[e.jsxs(G,{fullScreen:a,open:f,onClose:B,PaperProps:{sx:{maxHeight:"100%",height:"100%"}},children:[e.jsxs(M,{children:[e.jsx(L,{i18nKey:"manageGameBoards"}),e.jsx(J,{close:B})]}),e.jsxs(R,{style:{overflowY:"scroll"},children:[e.jsxs(E,{sx:{mb:1},children:[e.jsx(z,{variant:"outlined",onClick:i,endIcon:e.jsx(Q,{}),sx:{float:"right"},children:e.jsx(L,{i18nKey:"add"})}),e.jsx(S,{children:e.jsx(L,{i18nKey:"gameBoardDescription"})})]}),n.map(t=>{var c;return e.jsxs(Z,{expanded:D===t.id,onChange:j(t.id),children:[e.jsxs(b,{children:[e.jsxs(E,{children:[e.jsx(S,{variant:"body1",children:t.title}),e.jsxs(S,{variant:"body2",children:[(c=t.tiles)==null?void 0:c.length," tiles"]})]}),e.jsxs(E,{style:{marginLeft:"auto"},justifyContent:"flex-end",children:[e.jsx(N,{title:A(t),children:e.jsx("span",{children:e.jsx(U,{checked:!!t.isActive,disabled:!!t.isActive||$(t),onChange:()=>o(t),size:"small"})})}),e.jsx(N,{title:g("delete"),children:e.jsx(K,{onClick:()=>u(t.id),size:"small",children:e.jsx(X,{color:"error"})})})]})]}),e.jsx(ee,{children:e.jsx(ue,{open:f,close:j(null),setAlert:d,board:t})})]},t.id)})]})]}),e.jsx(re,{open:!!(s!=null&&s.message),type:(s==null?void 0:s.type)||"error",setOpen:d,close:()=>d(null),children:s==null?void 0:s.message}),e.jsxs(G,{open:!!p,onClose:()=>r(0),children:[e.jsxs(M,{children:["Delete Board",e.jsx(J,{close:()=>r(0)})]}),e.jsx(R,{children:e.jsxs(S,{variant:"body1",children:['Are you sure you want to delete "',(O=n.find(t=>t.id===p))==null?void 0:O.title,'"?']})}),e.jsxs(Y,{children:[e.jsx(z,{onClick:()=>r(0),children:"Cancel"}),e.jsx(z,{onClick:l,children:"Delete"})]})]})]})}export{ve as default};
