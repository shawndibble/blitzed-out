import{j as e,g as F,l as L,k as q,br as Q,v as U,o as G,q as M,p as P,f as E,B as N,bs as H,h as k,U as Y,m as _,W as X}from"./mui-BDjMQLu-.js";import{a as Z,C as R,b,c as ee,d as te}from"./index-w5x1-X-D.js";import{C as J,u as se}from"./index-BZAjTd9A.js";import{r as g}from"./vendor-DoDY-zMw.js";import{N as W,u as ne,j as ie,O as oe,P as le,x as re,s as ae,Q as ce}from"./index-DbDl3cvH.js";import{u as de,T as z,t as x}from"./translations-CW-OSHAD.js";import{T as ue}from"./index-pDQ-cv9k.js";import"./strings-BQQ7uF5O.js";import"./firebase-CfKEY2sz.js";function me({open:f,close:y,setAlert:r,board:o}){const{t:s}=de(),[m,p]=g.useState(""),[a,D]=g.useState(o.title||"");function v(n){try{return a.length?n.map((l,u)=>{const[c,...B]=l.split(`
`).filter(T=>T);if(c===void 0)throw r({message:s("importNoEmpty")});if(!/^\[.+\]$/.test(c))throw r({message:s("importInvalidTitle",{entry:u+1})});if(!B.length)throw r({message:s("importMissingDescription",{entry:u+1})});return{title:c==null?void 0:c.replace(/\[|\]/g,""),description:B.join(`
`)}}):(r({message:s("importTitleRequired")}),null)}catch{return null}}const i=async()=>{const n=m.split(/~+/).filter(u=>u),l=v(n);return l?JSON.stringify(o.tiles)===JSON.stringify(l)?(r({message:s("importNoChange")}),null):(W({...o,title:a,tiles:l}),r({message:s("saved"),type:"success"}),y(),null):null},w=()=>{var l;const n=(l=o==null?void 0:o.tiles)==null?void 0:l.map(({title:u,description:c})=>`[${u}]
${c}`);p((n==null?void 0:n.join(`
~~
`))||"")},$=n=>{D(n.target.value)},A=async n=>{if(!n.target.value.length)return r({message:s("importTitleRequired")}),null;W({...o,title:n.target.value})};return g.useEffect(()=>{f&&w()},[f]),e.jsxs(e.Fragment,{children:[e.jsx(F,{fullWidth:!0,label:s("title"),value:a,onChange:$,onBlur:A}),e.jsx(F,{sx:{mt:2},multiline:!0,fullWidth:!0,value:m,onChange:n=>p(n.target.value),InputProps:{endAdornment:e.jsxs("div",{style:{display:"flex",flexDirection:"column",position:"sticky",top:0},children:[e.jsx(L,{title:s("save"),children:e.jsx(q,{size:"small",onClick:i,children:e.jsx(Q,{color:"success"})})}),e.jsx(J,{text:m}),e.jsx(J,{text:`${window.location.href}?importBoard=${o.id}`,copiedText:s("copiedLink"),icon:e.jsx(U,{}),tooltip:s("copyShareLink")})]}),sx:{alignItems:"flex-start"}}})]})}function Te({open:f,close:y,isMobile:r}){var O;const o=se(ce),[s,m]=g.useState(null),[p,a]=g.useState(0),[D,v]=g.useState(0),i=Z("gameSettings")[0],{user:w}=ne();if(!o)return null;const $=t=>t[t.length-1].description.match(/\d+%/g),A=t=>{m(t)};async function n({title:t,tiles:d}){const h=d.map(({title:V})=>`* ${V} 
`);h.pop(),h.shift();let j=`### ${x("activated")}: ${t}
`;j+=`---
`,j+=[...new Set(h)].join(" "),j+=`---
`;const C=$(d);C.length===3&&(j+=`* ${x("finishSlider")} ${C[0]}  | ${C[1]} | ${C[2]}`);const S=await re({title:t,gameBoard:JSON.stringify(d),settings:JSON.stringify(i)});S!=null&&S.id&&await ae({room:(i==null?void 0:i.room)||"PUBLIC",user:w,text:j,type:"settings",gameBoardId:S.id,boardSize:d.length,gameMode:i==null?void 0:i.gameMode})}const l=async()=>{const t=await ie({isActive:0})||0;v(t)},u=t=>{oe(t.id),n(t),m({message:x("boardEnabled"),type:"success"})},c=t=>{t!==0&&a(t)},B=()=>{typeof p=="number"&&le(p),a(0)},I=t=>(d,h)=>{v(h?t:0)},T=t=>!t.tiles||t.tiles.length!==((i==null?void 0:i.roomTileCount)||40),K=t=>T(t)?x("boardWrongSize",{size:(i==null?void 0:i.roomTileCount)||40}):t.isActive?x("boardActive"):x("enableBoard");return e.jsxs(e.Fragment,{children:[e.jsxs(G,{fullScreen:r,open:f,onClose:y,PaperProps:{sx:{maxHeight:"100%",height:"100%"}},children:[e.jsxs(M,{children:[e.jsx(z,{i18nKey:"manageGameBoards"}),e.jsx(R,{close:y})]}),e.jsxs(P,{style:{overflowY:"scroll"},children:[e.jsxs(E,{sx:{mb:1},children:[e.jsx(N,{variant:"outlined",onClick:l,endIcon:e.jsx(H,{}),sx:{float:"right"},children:e.jsx(z,{i18nKey:"add"})}),e.jsx(k,{children:e.jsx(z,{i18nKey:"gameBoardDescription"})})]}),o.map(t=>{var d;return e.jsxs(b,{expanded:D===t.id,onChange:I(t.id||0),children:[e.jsxs(ee,{children:[e.jsxs(E,{children:[e.jsx(k,{variant:"body1",children:t.title}),e.jsxs(k,{variant:"body2",children:[(d=t.tiles)==null?void 0:d.length," tiles"]})]}),e.jsxs(E,{style:{marginLeft:"auto"},justifyContent:"flex-end",children:[e.jsx(L,{title:K(t),children:e.jsx("div",{style:{display:"inline-block"},children:e.jsx(Y,{checked:!!t.isActive,disabled:!!t.isActive||T(t),onChange:()=>u(t),size:"small"})})}),e.jsx(L,{title:x("delete"),children:e.jsx("span",{style:{display:"inline-block"},children:e.jsx(q,{onClick:()=>c(t.id||0),size:"small",component:"span",children:e.jsx(_,{color:"error"})})})})]})]}),e.jsx(te,{children:e.jsx(me,{open:f,close:()=>I(t.id||0)(null,!1),setAlert:A,board:t})})]},t.id)})]})]}),e.jsx(ue,{open:!!(s!=null&&s.message),type:(s==null?void 0:s.type)||"error",close:()=>m(null),children:s==null?void 0:s.message}),e.jsxs(G,{open:!!p,onClose:()=>a(0),children:[e.jsxs(M,{children:["Delete Board",e.jsx(R,{close:()=>a(0)})]}),e.jsx(P,{children:e.jsxs(k,{variant:"body1",children:['Are you sure you want to delete "',(O=o.find(t=>t.id===p))==null?void 0:O.title,'"?']})}),e.jsxs(X,{children:[e.jsx(N,{onClick:()=>a(0),children:"Cancel"}),e.jsx(N,{onClick:B,children:"Delete"})]})]})]})}export{Te as default};
