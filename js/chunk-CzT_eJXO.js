import{j as e,B as k,al as M,am as O,an as K,i as ne,o as S,k as le,t as je,S as V,T as b,D as B,G as C,aj as $,ab as fe,ac as be,av as ye,ae as ve,aw as Se,ax as Ce,ay as Te,z as G,az as se,a8 as we,O as ke,Q as J,e as ae}from"./chunk-DIlwDadr.js";import{T as Ae}from"./chunk-CNWeA5_I.js";import{i as w,a as E,b as H}from"./chunk-Bp62TkGl.js";import{u as de}from"./chunk-DC3TRfg3.js";import{u as F}from"./chunk-CJduil8-.js";import{r as v,u as ie,k as Be}from"./chunk-C88u9tZG.js";import{g as $e,u as Re,a as Ue,C as Me}from"./chunk-CbQTXT_2.js";import{u as T,T as g}from"./chunk-YF5ZW6Ae.js";import{l as Le}from"./chunk-CWqJFa1D.js";import{z as Oe,B as Ke,i as z,u as ue,d as he,t as oe,C as Ge,s as pe,D as Ie,g as Ne}from"../assets/index-FDKIJ2h2.js";import{b as Ee}from"./chunk-C6-_sXvy.js";import{u as ee}from"./chunk-CF2XvJ7D.js";import{a as Pe,i as We}from"./chunk-B4PEA_xj.js";import{u as ze}from"./chunk-BBWT4fup.js";function ce(t){t.length>1&&t.push(t.shift())}function Et(t,n){return t?.length!==n?.length?!1:t.every((i,s)=>i===n[s])}const{t:N}=z;function Ve(t,n){return t.filter(i=>{const s=i.action;return n==="vers"?s.includes("{sub}")&&s.includes("{dom}")||s.includes("{player}"):!s.match(/{(dom|sub)}/)||s.includes(`{${n}}`)})}function Fe(t,n,i,s){if([void 0,"normal"].includes(s)){const r=t/n;return Math.floor(i/r)+1}return n>=3&&Math.random()>=.6?n-1:n}function Q(t,n,i){return t.filter(s=>s.group===n&&s.intensity===i&&s.isEnabled)}function ge(t,n,i,s,r,o){if(!t.length)return{title:"",description:""};ce(t);const a=t[0],l=i[a.name];if(!l||l.level<=0)return{title:"",description:""};if(l.variation){const p=l.variation==="appendSome"?.4:l.variation==="appendMost"?.9:1;if(l.variation!=="standalone"&&Math.random()>p)return{title:"",description:""}}const u=Math.max(...a.intensities.map(p=>p.value)),c=Fe(r,u,s,o.difficulty),h=Math.min(c,l.level),m=[...new Set(n.filter(p=>p.group===a.name&&p.isEnabled).map(p=>p.intensity))].sort((p,x)=>p-x)[0]||1;let d=Q(n,a.name,h);if(!d.length){for(let p=h-1;p>=1;p--){const x=Q(n,a.name,p);if(x.length>0){d=x;break}}if(!d.length&&m>h){const p=Q(n,a.name,m);p.length>0&&(d=p)}if(!d.length)return{title:"",description:""}}return ce(d),{title:a.label,description:d[0].action,standalone:l.variation==="standalone",role:o.role||"sub"}}function _e(t,n,i,s,r,o,a){if(t.standalone||!n.length||!t.description)return t.description||"";const l=ge(n,i,s,r,o,a);return l.description?`${l.description.trim().replace(/([^.,!?])$/,"$1.")} ${t.description}`:t.description}async function qe(t,n,i,s){const r=i.selectedActions||{},o=t.filter(u=>{const c=r[u.name];return c&&c.level>0&&(!c.variation||c.variation==="standalone")}),a=t.filter(u=>{const c=r[u.name];return c&&c.level>0&&(c.variation==="appendSome"||c.variation==="appendMost")}),l=[];for(let u=1;u<=s;u++){const c=ge(o,n,r,u,s,i),h=_e(c,a,n,r,u,s,i);l.push({title:c.title,description:h.trim(),role:c.role})}return l}function Y(t,n){const i={title:N("start"),description:N("start")},{finishRange:s=[33,66]}=n,r=`${N("noCum")} ${s[0]}%\r
${N("ruined")} ${s[1]-s[0]}%\r
${N("cum")} ${100-s[1]}%`,o={title:N("finish"),description:r};return[i,...t.map(a=>({title:a.title,description:a.description})),o]}async function Je(t,n,i,s=40){try{const[r,o]=await Promise.all([Oe({locale:n,gameMode:i}),Ke({locale:n,gameMode:i})]),a=t.selectedActions||{},l=Object.keys(a).filter(y=>a[y]?.level>0),u=r.filter(y=>l.includes(y.name)),c=r.map(y=>y.name),h=l.filter(y=>!c.includes(y)),j=t.role||"sub",d=Ve(o,j).filter(y=>l.includes(y.group));if(!u.length||!d.length)return{board:Y([],t),metadata:{totalTiles:s+2,tilesWithContent:2,selectedGroups:l,missingGroups:h,availableTileCount:d.length}};const p=await qe(u,d,t,s),x=p.filter(y=>y.description.trim().length>0).length,f=Y(p,t);return{board:f,metadata:{totalTiles:f.length,tilesWithContent:x+2,selectedGroups:l,missingGroups:h,availableTileCount:d.length}}}catch(r){return console.error("Error building game board:",r),{board:Y([],t),metadata:{totalTiles:2,tilesWithContent:2,selectedGroups:[],missingGroups:[],availableTileCount:0}}}}function He(){const t=ee(he),[n,i]=F(),{i18n:s}=T(),r=v.useCallback(async o=>{const a=o?.roomUpdate||o?.boardUpdated?o:{...n,...o,selectedActions:{...n.selectedActions,...o.selectedActions}};let{gameMode:l,boardUpdated:u}=a;const{roomTileCount:c=40,finishRange:h,room:j}=a,m=w(j||"");if(!o||!h)return{gameMode:l};m&&!E(l||"")&&(l="online",u=!0);const d=l||"online",p=s.resolvedLanguage||"en",x=m?40:c||40,f=await Je(a,p,d,x);return f.metadata.missingGroups.length>0&&console.warn("Missing groups for board building:",f.metadata.missingGroups),f.metadata.tilesWithContent<x/2&&console.warn("Low tile content ratio:",{tilesWithContent:f.metadata.tilesWithContent,totalTiles:f.metadata.totalTiles,availableTileCount:f.metadata.availableTileCount}),(o?.boardUpdated||u||(t?.tiles?.length??0)!==f.board.length)&&(await i(a),await ue({title:t?.title||"",tiles:f.board})),{settingsBoardUpdated:u,gameMode:l,newBoard:f.board,metadata:f.metadata}},[t,s.resolvedLanguage,n,i]);return v.useCallback(o=>r(o),[r])}function X({children:t,value:n,index:i,style:s,...r}){return e.jsx("div",{role:"tabpanel",hidden:n!==i,id:`simple-tabpanel-${i}`,"aria-labelledby":`simple-tab-${i}`,...r,children:n===i&&e.jsx(k,{sx:{p:3,...s},children:t})})}function me({formData:t,setFormData:n,backgrounds:i,isRoom:s=!1}){const{t:r}=T(),o=s?"roomBackground":"background",a=s?"roomBackgroundURL":"backgroundURL",[l,u]=v.useState(t?.[o]||Object.keys(i)[0]),c=()=>Object.entries(i).map(([m,d])=>e.jsx(S,{value:m,children:d},m)),h=m=>{n({...t,[o]:m.target.value}),u(m.target.value)};v.useEffect(()=>{l!==t?.[o]&&u(t?.[o]||"")},[t,l,o]);const j=m=>{const d={...t,[o]:"custom",[a]:m.target.value};s&&(d.roomUpdated=!0),n(d)};return e.jsxs(e.Fragment,{children:[e.jsxs(M,{fullWidth:!0,margin:"normal",children:[e.jsx(O,{id:"background-label",children:r("background")}),e.jsx(K,{labelId:"background-label",id:"background",label:r("background"),value:l||"",onChange:h,children:c()})]}),l==="custom"&&e.jsx(ne,{sx:{mt:2},label:r("url"),value:t?.[a]||"",fullWidth:!0,onChange:j,helperText:e.jsxs(e.Fragment,{children:[r("supportedSites"),e.jsx("br",{}),r("requiresEmbeddedUrl")]})})]})}function Qe({boardUpdated:t}){const{i18n:n}=T(),[i,s]=v.useState(n.resolvedLanguage||"en");function r(a){s(a),n.changeLanguage(a),t()}const o=Object.entries(Le).map(([a,l])=>e.jsx(S,{value:a,children:l.label},a));return e.jsx(k,{sx:{minWidth:120,mt:1,mb:2},children:e.jsxs(M,{fullWidth:!0,children:[e.jsxs(O,{id:"language-label",sx:{display:"flex",alignItems:"center"},children:[e.jsx(le,{sx:{mr:1}}),e.jsx(g,{i18nKey:"language"})]}),e.jsx(K,{labelId:"language-label",id:"language-select",value:i,label:e.jsxs(e.Fragment,{children:[e.jsx(le,{}),e.jsx(g,{i18nKey:"language"})]}),onChange:a=>r(a.target.value),children:o})]})})}function Ye({trueCondition:t,onChange:n,yesLabel:i,noLabel:s=null,sx:r={}}){const o=s??i;return e.jsx(k,{sx:{display:"flex",justifyContent:"center",my:1,...r},children:e.jsx(je,{control:e.jsx(V,{checked:t||!1,onChange:n}),label:oe(t?i:o)})})}function U({field:t,formData:n,handleSwitch:i}){return e.jsx(Ye,{trueCondition:n[t],onChange:s=>i(s,t),yesLabel:`${t}Enable`,sx:{justifyContent:"left"}})}function Xe({formData:t,setFormData:n,boardUpdated:i}){const[s,r]=F(),{t:o}=T(),a={color:o("color"),gray:o("gray"),"metronome.gif":o("hypnoDick"),"pink-spiral.gif":o("pinkSpiral"),custom:o("customURL")};function l(u,c){n({...t,[c]:u.target.checked}),r({...s,[c]:u.target.checked})}return e.jsxs(e.Fragment,{children:[e.jsx(Qe,{boardUpdated:i}),e.jsx(b,{variant:"h5",children:e.jsx(g,{i18nKey:"dialog"})}),e.jsx(U,{field:"playerDialog",formData:t,handleSwitch:l}),e.jsx(U,{field:"othersDialog",formData:t,handleSwitch:l}),e.jsx(B,{}),e.jsx(b,{variant:"h5",sx:{mt:2},children:e.jsx(g,{i18nKey:"sounds"})}),e.jsx(U,{field:"mySound",formData:t,handleSwitch:l}),e.jsx(U,{field:"otherSound",formData:t,handleSwitch:l}),e.jsx(U,{field:"chatSound",formData:t,handleSwitch:l}),e.jsx(U,{field:"readRoll",formData:t,handleSwitch:l}),e.jsx(B,{}),e.jsx(b,{variant:"h5",sx:{mt:2,textTransform:"capitalize"},children:e.jsx(g,{i18nKey:"misc"})}),e.jsx(U,{field:"hideBoardActions",formData:t,handleSwitch:l}),e.jsx(U,{field:"advancedSettings",formData:t,handleSwitch:l}),e.jsx(me,{formData:t,setFormData:n,backgrounds:a}),e.jsx(B,{})]})}function Z({children:t}){return e.jsx(C,{size:{xs:12,md:5},children:t})}const te=v.forwardRef(({value:t,onChange:n,label:i,options:s,defaultValue:r=null,sx:o,helpIcon:a=!1,fullWidth:l=!0,...u},c)=>{const h=v.useMemo(()=>s.map(j=>typeof j=="string"?e.jsx(S,{value:j,children:oe(j)},j):e.jsx(S,{value:j.value,children:j.label},j.value)),[s]);return e.jsxs(M,{fullWidth:l,margin:"normal",sx:o,...u,ref:c,children:[e.jsxs(O,{id:`${i}Label`,children:[e.jsx(g,{i18nKey:i}),!!a&&e.jsx($,{sx:{ml:1,fontSize:16}})]}),e.jsx(K,{labelId:`${i}Label`,id:i,label:e.jsxs(e.Fragment,{children:[e.jsx(g,{i18nKey:i}),!!a&&e.jsx($,{sx:{ml:1,fontSize:16}})]}),value:t||r||"",onChange:n,children:h})]})});function D({children:t,title:n,subtitle:i,defaultExpanded:s=!1,...r}){return e.jsxs(fe,{defaultExpanded:s,...r,sx:{backgroundColor:"inherit",backgroundImage:"none",boxShadow:"none"},children:[e.jsxs(be,{expandIcon:e.jsx(ye,{}),sx:{px:0},children:[e.jsxs(b,{variant:"h6",sx:{width:"33%"},children:[n,":"]}),e.jsx(b,{sx:{pt:.5},children:i})]}),e.jsx(ve,{sx:{px:0},children:e.jsx(C,{container:!0,columnSpacing:2,justifyContent:"space-evenly",className:"columned-grid",children:t})})]})}function Ze({formData:t,setFormData:n}){const i=(r,o)=>{n({...t,finishRange:o,boardUpdated:!0})},s=t?.finishRange||[30,70];return e.jsxs(k,{children:[e.jsx(B,{}),e.jsx(b,{id:"finish-slider",sx:{my:1},children:e.jsx(g,{i18nKey:"finishSlider"})}),e.jsx(Se,{"aria-labelledby":"finish-slider",value:s,onChange:i,valueLabelDisplay:"off"}),e.jsxs(k,{display:"flex",flexDirection:"column",justifyContent:"space-between",textAlign:"center",children:[e.jsxs(b,{whiteSpace:"nowrap",children:[e.jsx(g,{i18nKey:"noCum"})," ",s[0],"%"]}),e.jsxs(b,{whiteSpace:"nowrap",children:[e.jsx(g,{i18nKey:"ruined"})," ",s[1]-s[0],"%"]}),e.jsxs(b,{whiteSpace:"nowrap",children:[e.jsx(g,{i18nKey:"cum"})," ",100-s[1],"%"]})]}),e.jsx(B,{sx:{my:1}})]})}function De(){const[t,n]=v.useState(!1);return v.useEffect(()=>{const i=window.matchMedia("(pointer: fine)");n(i.matches);const s=r=>{n(r.matches)};return i.addEventListener("change",s),()=>{i.removeEventListener("change",s)}},[]),t}function et({actionsFolder:t,settings:n,option:i,onChange:s,initValue:r=0}){const o=`${i}label`,a=t[i]?.label,l=()=>n.selectedActions?.[i]?.level||r,u=De(),[c,h]=v.useState(l()),j=x=>{s(x)},m=x=>{h(x)},d=x=>c>0&&x===0?!1:n.difficulty==="accelerated"?c<=2?c===x:c===x||c-1===x:c>=x;function p(x){return Object.keys(t[x]?.actions||{}).map((f,y)=>e.jsxs(S,{value:y,onMouseOver:()=>m(y),children:[!!u&&e.jsx("span",{className:"menu-item-icon",children:d(y)?e.jsx(Ce,{}):e.jsx(Te,{})}),f]},`${x}-${f}`))}return e.jsxs(M,{margin:"normal",fullWidth:!0,children:[e.jsx(O,{id:o,children:a}),e.jsx(K,{labelId:o,id:i,label:a,value:l(),onChange:j,onOpen:()=>h(l()),onClose:()=>h(l()),children:p(i)})]})}function tt({option:t,settings:n,setSettings:i,actionsFolder:s,type:r,showVariation:o=!1,showRole:a=!1}){const{t:l}=T(),u=`${t}label`,c=s[t]?.label;function h(d,p,x){const f=n.selectedActions?.[p];i({...n,selectedActions:{...n.selectedActions,[p]:{...f,type:r,level:f?.level??0,[x]:d?.target?.value}},boardUpdated:!0})}let j=12;(o||a)&&(j=6);let m=["dom","vers","sub"];return s[t]?.dom&&(m=[{label:s[t].dom,value:"dom"},{label:l("vers"),value:"vers"},{label:s[t].sub,value:"sub"}]),e.jsxs(C,{container:!0,justifyContent:"center",children:[e.jsx(C,{size:j,children:e.jsx(et,{actionsFolder:s,settings:n,option:t,onChange:d=>h(d,t,"level")})}),!!a&&e.jsx(C,{size:6,children:e.jsx(te,{sx:{ml:1},value:n.selectedActions?.[t]?.role,onChange:d=>h(d,t,"role"),label:`${l("role")}: ${c}`,options:m,defaultValue:n.role||"sub"})}),!!o&&e.jsx(C,{size:6,children:e.jsx(G,{placement:"top",title:e.jsxs(g,{i18nKey:"variationTooltip",children:[e.jsx(b,{variant:"subtitle2",children:"Standalone = Its own tile. "}),e.jsx(b,{variant:"subtitle2",children:"Append Some = 50% chance."}),e.jsx(b,{variant:"subtitle2",children:"Append Most = 90% chance."})]}),arrow:!0,children:e.jsxs(M,{fullWidth:!0,margin:"normal",sx:{ml:1},children:[e.jsxs(O,{id:`${u}Variation`,children:[`${c} ${l("variation")}`,e.jsx($,{sx:{ml:1,fontSize:16}})]}),e.jsxs(K,{labelId:`${u}Variation`,id:`${t}Variation`,label:e.jsxs(e.Fragment,{children:[c," ",l("variation"),e.jsx($,{sx:{ml:1,fontSize:16}})]}),value:n.selectedActions?.[t]?.variation||"standalone",onChange:d=>h(d,t,"variation"),children:[e.jsx(S,{value:"standalone",children:e.jsx(g,{i18nKey:"standalone"})}),e.jsx(S,{value:"appendSome",children:e.jsx(g,{i18nKey:"appendSome"})}),e.jsx(S,{value:"appendMost",children:e.jsx(g,{i18nKey:"appendMost"})})]})]})})})]},t)}function nt({formData:t,setFormData:n}){return e.jsxs(se,{direction:"row",spacing:1,alignItems:"center",justifyContent:"center",sx:{mt:1},children:[e.jsx(b,{children:e.jsx(g,{i18nKey:"solo"})}),e.jsx(G,{title:e.jsx(b,{variant:"subtitle2",children:e.jsx(g,{i18nKey:"soloTooltip"})}),arrow:!0,children:e.jsx($,{sx:{fontSize:15}})}),e.jsx(V,{id:"gameMode",checked:!E(t.gameMode),onChange:i=>n({...t,gameMode:i.target.checked?"local":"online",boardUpdated:!0}),inputProps:{"aria-label":"Game Type"}}),e.jsx(b,{children:e.jsx(g,{i18nKey:"local"})}),e.jsx(G,{title:e.jsx(b,{variant:"subtitle2",children:e.jsx(g,{i18nKey:"localTooltip"})}),arrow:!0,children:e.jsx($,{sx:{fontSize:15}})})]})}function st({formData:t}){const[n,i]=v.useState(!1);return v.useEffect(()=>{const s=Object.values(t).filter(o=>typeof o=="object"&&o?.type==="consumption"&&o?.level>0).length,r=Object.values(t).filter(o=>typeof o=="object"&&o?.level>0).length;i(s>1&&s>=r-s)},[t]),n?e.jsx(we,{severity:"warning",children:e.jsx(g,{i18nKey:"consumptionWarning"})}):null}function it({formData:t,setFormData:n,actionsList:i}){const{t:s}=T(),r=!w(t?.room)&&!E(t.gameMode);function o(l,u={}){return Object.keys(i).filter(c=>i[c]?.type===l).map(c=>e.jsx(Z,{children:e.jsx(tt,{option:c,settings:t,setSettings:n,actionsFolder:i,type:l,...u})},c))}const a=l=>{const u=JSON.parse(JSON.stringify(t));return Object.keys(u).forEach(c=>{u.role=l,c.includes("role")&&(u[c]=l)}),u};return e.jsxs(e.Fragment,{children:[e.jsx(nt,{formData:t,setFormData:n}),w(t?.room)&&!E(t.gameMode)&&e.jsx(C,{container:!0,alignContent:"center",justifyContent:"space-evenly",children:e.jsx(C,{sx:{py:3},children:e.jsx(b,{variant:"h5",children:e.jsx(g,{i18nKey:"privateRequired"})})})}),e.jsxs(C,{container:!0,columnSpacing:2,justifyContent:"space-evenly",children:[e.jsx(Z,{children:e.jsx(G,{placement:"top",title:e.jsx(g,{i18nKey:"difficultyTooltip",children:e.jsxs(b,{variant:"body2",children:["Normal = Slow ramp up. ",e.jsx("br",{}),e.jsx("br",{}),"Accelerated = Straight to max level + the level prior to it."]})}),arrow:!0,children:e.jsx(te,{value:t.difficulty,onChange:l=>n({...t,difficulty:l.target.value,boardUpdated:!0}),label:"difficulty",options:["normal","accelerated"],defaultValue:"normal",helpIcon:!0})})}),r&&e.jsx(Z,{children:e.jsx(te,{value:t.role,onChange:l=>n({...a(l.target.value),boardUpdated:!0}),label:"mainRole",options:["dom","vers","sub"],defaultValue:"sub"})})]}),r?e.jsxs(e.Fragment,{children:[e.jsx(D,{title:s("consumption"),subtitle:s("consumptionSubtitle"),children:o("consumption",{showVariation:!0})}),e.jsx(D,{title:s("foreplay"),subtitle:s("foreplaySubtitle"),children:o("foreplay",{showRole:r})}),e.jsx(D,{title:s("sex"),subtitle:s("sexSubtitle"),children:o("sex",{showRole:r})})]}):e.jsxs(e.Fragment,{children:[e.jsx(C,{container:!0,columnSpacing:2,justifyContent:"space-evenly",children:o("consumption",{showVariation:!0})}),e.jsx(B,{}),e.jsx(C,{container:!0,columnSpacing:2,justifyContent:"center",children:o("solo")})]}),e.jsx(Ze,{setFormData:n,formData:t}),e.jsx(st,{formData:t})]})}function ot({formData:t,setFormData:n}){const{t:i}=T(),s={"1d4":2.5,"1d6":3.5,"2d4":5},r=t?.roomTileCount?Math.floor(t.roomTileCount/s[t.roomDice||"1d6"]):16,o=Array.from({length:7},(a,l)=>(l+2)*10).map(a=>e.jsx(S,{value:a,children:a},a));return e.jsxs(e.Fragment,{children:[e.jsx(b,{children:e.jsx(g,{i18nKey:"gameSpeed"})}),e.jsxs(k,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[e.jsxs(M,{sx:{m:1},fullWidth:!0,children:[e.jsx(O,{id:"diceRole-label",children:e.jsx(g,{i18nKey:"roomDice"})}),e.jsxs(K,{labelId:"diceRole-label",id:"diceRole-select",value:t?.roomDice||"1d4",label:i("roomDice"),onChange:a=>n({...t,roomDice:a.target.value,roomUpdated:!0}),children:[e.jsx(S,{value:"1d4",children:"1d4"}),e.jsx(S,{value:"1d6",children:"1d6"}),e.jsx(S,{value:"2d4",children:"2d4"})]})]}),e.jsxs(M,{sx:{m:1},fullWidth:!0,children:[e.jsx(O,{id:"tile-count-label",children:e.jsx(g,{i18nKey:"roomTileCount"})}),e.jsx(K,{labelId:"tile-count-label",id:"tile-count-select",value:String(t?.roomTileCount||40),label:i("roomTileCount"),onChange:a=>n({...t,roomTileCount:Number(a.target.value),roomUpdated:!0}),children:o})]}),e.jsx(M,{fullWidth:!0,children:e.jsxs(b,{children:[e.jsx(g,{i18nKey:"averageRolls"}),r]})})]})]})}function rt({formData:t,setFormData:n}){const i=v.useCallback(()=>{n({...t,roomRealtime:!t.roomRealtime,roomUpdated:!0})},[t,n]);return e.jsxs(e.Fragment,{children:[e.jsx(b,{children:e.jsx(g,{i18nKey:"playerListOptions"})}),e.jsxs(se,{direction:"row",spacing:1,alignItems:"center",justifyContent:"center",sx:{width:"100%"},children:[e.jsx(b,{children:e.jsx(g,{i18nKey:"realtime"})}),e.jsx(G,{title:e.jsx(b,{variant:"subtitle2",children:e.jsx(g,{i18nKey:"realtimeTooltip"})}),arrow:!0,children:e.jsx($,{sx:{fontSize:15}})}),e.jsx(V,{id:"showPrivate",checked:!!t.roomRealtime,onChange:i,inputProps:{"aria-label":oe("playerList")}}),e.jsx(b,{children:e.jsx(g,{i18nKey:"delayed"})}),e.jsx(G,{title:e.jsx(b,{variant:"subtitle2",children:e.jsx(g,{i18nKey:"delayedTooltip"})}),arrow:!0,children:e.jsx($,{sx:{fontSize:15}})})]})]})}function lt({formData:t,setFormData:n}){const{id:i}=ie(),{t:s}=T(),r=c=>{let h;c.target.checked&&w(i)?h=Ee("123456789ABCDEFGHJKLMNPQRSTUVWXYZ",5)():i&&c.target.checked&&!w(i)?h=i:h="PUBLIC",n({...t,room:h.toUpperCase(),gameMode:w(h)?"online":t.gameMode})},o=v.useCallback(c=>{n({...t,room:c.currentTarget.value,boardUpdated:!0})},[t,n]),a=v.useCallback(c=>{c.key==="Enter"&&n({...t,room:c.currentTarget.value,boardUpdated:!0})},[t,n]),l=v.useCallback(c=>{const h=c.target.value.toUpperCase();c.target.value=h},[]),u=!w(t.room);return e.jsxs(e.Fragment,{children:[e.jsxs(se,{direction:"row",spacing:1,alignItems:"center",justifyContent:"center",sx:{width:"100%"},children:[e.jsx(b,{children:e.jsx(g,{i18nKey:"public"})}),e.jsx(V,{id:"showPrivate",checked:u,onChange:r,slotProps:{input:{"aria-label":s("room")}}}),e.jsx(b,{children:e.jsx(g,{i18nKey:"private"})}),e.jsx(G,{title:e.jsx(b,{variant:"subtitle2",children:e.jsx(g,{i18nKey:"privateOptions"})}),arrow:!0,children:e.jsx($,{sx:{fontSize:15}})})]}),u&&e.jsx(ne,{fullWidth:!0,id:"privateRoom",label:"Private Room",defaultValue:t.room?.toUpperCase(),margin:"normal",onBlur:o,onKeyDown:a,onChange:l,inputProps:{style:{textTransform:"uppercase"}}})]})}function at({formData:t,setFormData:n}){const{t:i}=T(),s={app:i("appBackground"),custom:i("customURL")};return e.jsxs(k,{sx:{margin:"0.5rem"},children:[e.jsx(lt,{formData:t,setFormData:n}),!w(t.room)&&e.jsxs(e.Fragment,{children:[e.jsx(B,{sx:{my:1}}),e.jsx(ot,{formData:t,setFormData:n}),e.jsx(B,{sx:{my:1}}),e.jsx(rt,{formData:t,setFormData:n}),e.jsx(B,{sx:{my:1}}),e.jsx(me,{formData:t,setFormData:n,backgrounds:s,isRoom:!0})]})]})}function ct(t){return Object.values(t).some(({level:n})=>n>0)}function dt(t,n){const i=t.selectedActions||{};return Object.entries(i).reduce((s,[r,o])=>(r in n&&(o?.variation?.startsWith("append")?s.withAppend[r]=o:s.withoutAppend[r]=o),s),{withAppend:{},withoutAppend:{}})}function ut(t){return Object.keys(t).length>0&&Object.values(t).some(({level:n})=>n>0)}function ht(t,n){const{withAppend:i,withoutAppend:s}=dt(t,n);return ct(s)?w(t.room)&&!E(t.gameMode)?"privateRequired":null:ut(i)?"appendWithAction":"pickSomething"}function pt(t,n,i){const s=t.selectedActions||{},r=Object.entries(i).filter(([a])=>s[a]).reduce((a,[l,u])=>(a[l]=Object.keys(u.actions).slice(1,s[l].level+1),a),{});return(n?.filter(a=>{if(!a.isCustom)return!1;if(a.group==="misc")return!0;const l=r[a.group];return l&&l.length>=Number(a.intensity)})||[]).length}async function gt(t,n,i,s){const{t:r}=z;let o=`### ${z.t("gameSettings")}\r
`;s&&(o+=`##### ${s}\r
`),o+=`--- \r
`;const a=t.selectedActions||{};if(Object.entries(i).forEach(([h,j])=>{if(!a[h])return;const{role:m,variation:d,level:p}=a[h],x=m||t.role||"sub";if(p>0){const f=Object.keys(j?.actions||{});if(o+=`* ${j?.label}: ${f[p]||""}`,d&&(o+=` (${r(d)})`),!E(t.gameMode)&&!d){const y=j[x]??r(x);o+=` (${y})`}o+=`\r
`}}),t.customGroups&&Array.isArray(t.customGroups)){for(const h of t.customGroups)if(h.groupName&&h.intensity)try{const m=(await Ie(h.groupName,t.locale||"en",t.gameMode||"online"))?.label||h.groupName;o+=`* ${m}: Level ${h.intensity} (Custom)\r
`}catch(j){console.error(`Error loading custom group ${h.groupName}:`,j),o+=`* ${h.groupName}: Level ${h.intensity} (Custom)\r
`}}if(o.endsWith(`--- \r
`))return"";const{finishRange:l,difficulty:u}=t;o+=`--- \r
`,o+=`* ${r("difficulty")}: ${r(u??"normal")} \r
`,l&&(o+=`* ${r("finishSlider")} ${l[0]}%  | ${l[1]-l[0]}% | ${100-l[1]}% \r
`);const c=pt(t,n,i);return c&&(o+=`* ${r("customTilesLabel")}: ${c} \r
`),o}function mt(t){const n={};return Object.entries(t).forEach(([i,s])=>{!["displayName","background","boardUpdated","chatSound","mySound","otherSound","othersDialog","playerDialog","readRoll","hideBoardActions","advancedSettings"].includes(i)&&!i.startsWith("room")&&(n[i]=s)}),n}async function xt({title:t,formData:n,user:i,actionsList:s,tiles:r,customTiles:o=[],reason:a=""}){const l=JSON.stringify(mt(n)),u=await Ge({title:t,gameBoard:JSON.stringify(r),settings:l}),c=await gt(n,o,s,a);if(!(!u?.id||c===""))return pe({room:n?.room||"PUBLIC",user:i,text:c,type:"settings",gameBoardId:u.id,boardSize:r.length,gameMode:n.gameMode})}function jt(t){const{t:n}=z;let i=`### ${n("roomSettings")}\r
`;return Object.entries(t).forEach(([s,r])=>{if(s!=="room"){if(s==="roomBackgroundURL"&&r!==""){i+=`* ${n(s)}: [${Pe(r)}:link:](${r})\r
`;return}if(s==="roomRealtime"){i+=`* ${n("playerList")}: ${n(r?"delayed":"realtime")}\r
`;return}r!==""&&(i+=`* ${n(s)}: ${r}\r
`)}}),i}function ft(t){const n={};return Object.entries(t).forEach(([i,s])=>{i.startsWith("room")&&!["roomUpdated","roomBackground"].some(r=>r===i)&&(n[i]=s)}),n}async function bt(t,n,i){let s=t;return n!==void 0&&n.length>0&&(s=await i(n)),s}function yt(t,n){const i=ft(t);return pe({room:t.room,user:n,text:jt(i),type:"room",settings:JSON.stringify(i)})}function xe(){const{id:t}=ie(),n=Be();return i=>{if(t!==void 0&&t?.toUpperCase()!==i?.toUpperCase()){const s=i?.replace(/^\/+/,"")||"PUBLIC";n(`/${s}`)}}}function vt(t){(!t.roomBackgroundURL||!We(t.roomBackgroundURL))&&(t.roomBackground="app")}function St(t){const n={...t},i={};t.selectedActions&&Object.entries(t.selectedActions).forEach(([r,o])=>{o&&o.level>0&&(i[r]=o)});const s=$e();return Object.keys(n).forEach(r=>{const o=n[r];o&&typeof o=="object"&&o.type&&s.VALID_GROUP_TYPES.includes(o.type)&&delete n[r]}),n.selectedActions=i,n}function Ct(){const{user:t,updateUser:n}=de(),{id:i}=ie(),{t:s}=T(),r=He(),[o,a]=F(),l=ee(()=>Ne(o?.gameMode)),u=ee(he),c=xe(),{messages:h}=ze(),j=v.useCallback(d=>{const p=i?.toUpperCase()!==d.room.toUpperCase(),x=!!(d.room&&!w(d.room)),f=x&&d.roomTileCount!==o?.roomTileCount;return{roomChanged:p,isPrivateRoom:x,privateBoardSizeChanged:f}},[i,o?.roomTileCount]),m=v.useCallback(async(d,p)=>{const{displayName:x}=d,f=await bt(t,x,n);vt(d);const{settingsBoardUpdated:y,gameMode:W,newBoard:I=[]}=await r(d),{roomChanged:P,isPrivateRoom:_,privateBoardSizeChanged:q}=j(d);if(!f)return;_&&(d.roomUpdated||!h.find(L=>L.type==="room"))&&await yt(d,f),u?.tiles!==I&&await ue({title:s("settingsGenerated"),tiles:I,isActive:1,gameMode:W}),(y||P||q)&&!h.some(L=>L.type==="settings"&&L.uid===f.uid&&Date.now()-(L.timestamp?.toMillis()||0)<5e3)&&await xt({formData:d,user:f,customTiles:l,actionsList:p,title:"Settings Generated Board",tiles:I});const R=St(d);a({...R,boardUpdated:!1,roomUpdated:!1,gameMode:W}),c(d.room)},[t,n,r,j,h,u,s,l,a,c]);return v.useCallback((d,p)=>m(d,p),[m])}function Tt({closeDialog:t,initialTab:n=0}){const{user:i}=de(),{t:s}=T(),[r,o]=F(),[a,l]=v.useState(n),[u,c]=v.useState(null),[h,j]=v.useState(!1),[m,d]=Re(),p=xe(),x=Ct(),{isLoading:f,actionsList:y}=Ue(m?.gameMode),W=(A,R)=>{l(R),p(m.room)},I=()=>o({...r,boardUpdated:!0}),P=v.useCallback(async A=>{A.preventDefault();const{displayName:R,...L}=m,re=ht(L,y);return re?(c(s(re)),null):(x(m,y),typeof t=="function"&&t(),null)},[m,y,s,c,x,t]),_=v.useCallback(A=>{d(R=>({...R,displayName:A.target.value}))},[d]),q=v.useCallback(A=>{A.key==="Enter"&&(d(R=>({...R,displayName:A.target.value})),P(A))},[P,d]);return!m.room||f?e.jsxs(k,{children:[e.jsxs(b,{variant:"h2",children:[e.jsx(g,{i18nKey:"loading"}),"..."]}),e.jsx(b,{variant:"body1",children:e.jsx(g,{i18nKey:"clearStorage"})})]}):e.jsxs(k,{component:"form",method:"post",onSubmit:P,className:"settings-box",children:[e.jsx(ne,{fullWidth:!0,id:"displayName",label:s("displayName"),defaultValue:i?.displayName||m.displayName||"",required:!0,autoFocus:!0,onBlur:_,onKeyDown:q,margin:"normal"}),e.jsx(k,{sx:{borderBottom:1,borderColor:"divider"},children:e.jsxs(ke,{value:a,onChange:W,"aria-label":"Game Settings",centered:!0,children:[e.jsx(J,{label:s("gameboard"),...H(0)}),e.jsx(J,{label:s("room"),...H(1)}),e.jsx(J,{label:s("application"),...H(2)})]})}),e.jsx(X,{value:a,index:0,style:{p:0},children:e.jsx(it,{formData:m,setFormData:d,actionsList:y})}),e.jsx(X,{value:a,index:1,style:{p:0,pt:1},children:e.jsx(at,{formData:m,setFormData:d})}),e.jsx(X,{value:a,index:2,style:{p:0,pt:1},children:e.jsx(Xe,{formData:m,setFormData:d,boardUpdated:I})}),e.jsxs("div",{className:"flex-buttons",children:[e.jsx(ae,{variant:"outlined",type:"button",onClick:()=>j(!0),children:e.jsx(g,{i18nKey:"customTilesLabel",children:"Game Tiles"})}),e.jsx(ae,{variant:"contained",type:"submit",children:e.jsx(g,{i18nKey:"update"})})]}),h&&e.jsx(Me,{open:h,setOpen:j,boardUpdated:I,actionsList:y}),e.jsx(Ae,{open:!!u,close:()=>c(null),children:u})]})}const Pt=Object.freeze(Object.defineProperty({__proto__:null,default:Tt},Symbol.toStringTag,{value:"Module"}));export{Tt as G,et as I,lt as R,te as S,X as T,Ye as Y,yt as a,xe as b,Et as c,Ct as d,Pt as i,xt as s,He as u};
