import{j as e,i as G,z as N,E as q,bt as W,J as H,p as J,q as L,s as M,B as A,e as I,bu as Q,T as w,S as U,H as Y,w as _}from"./chunk-DIlwDadr.js";import{C as O}from"./chunk-Cox8a3_y.js";import{C as R,u as b}from"./chunk-Kd4QBae4.js";import{r as x}from"./chunk-C88u9tZG.js";import{a2 as P,t as g,u as X,a3 as Z,a4 as ee,C as te,s as se,a5 as ie}from"../assets/index-Bjnmik-V.js";import{u as ne,T as z}from"./chunk-B9fCqsQI.js";import{T as re}from"./chunk-KmIEHkQK.js";import{A as oe,a as ae,b as le}from"./chunk-05ZANaPc.js";import{u as ce}from"./chunk-BVnPSbgD.js";import{u as de}from"./chunk-BUH-pnvO.js";import"./chunk-C6-_sXvy.js";import"./chunk-Bde8qXua.js";function ue({open:f,close:B,setAlert:o,board:n}){const{t:s}=ne(),[d,u]=x.useState(""),[a,v]=x.useState(n.title||"");function T(i){try{return a.length?i.map((r,l)=>{const[p,...C]=r.split(`
`).filter(S=>S);if(p===void 0)throw o({message:s("importNoEmpty")});if(!/^\[.+\]$/.test(p))throw o({message:s("importInvalidTitle",{entry:l+1})});if(!C.length)throw o({message:s("importMissingDescription",{entry:l+1})});return{title:p?.replace(/\[|\]/g,""),description:C.join(`
`)}}):(o({message:s("importTitleRequired")}),null)}catch{return null}}const m=async()=>{const i=d.split(/~+/).filter(l=>l),r=T(i);if(!r)return null;try{if(JSON.stringify(n.tiles)===JSON.stringify(r))return o({message:s("importNoChange")}),null}catch{return o({message:s("error"),type:"error"}),null}return P({...n,title:a,tiles:r}),o({message:s("saved"),type:"success"}),B(),null},D=()=>{const i=n?.tiles?.map(r=>{if(!r)return"";const l=r.title||"",p=r.description||"";return`[${l}]
${p}`}).filter(Boolean);u(i?.join(`
~~
`)||"")},k=i=>{v(i.target.value)},E=async i=>{if(!i.target.value.length)return o({message:s("importTitleRequired")}),null;P({...n,title:i.target.value})};return x.useEffect(()=>{f&&D()},[f]),x.useEffect(()=>{v(n.title||"")},[n.title]),e.jsxs(e.Fragment,{children:[e.jsx(G,{fullWidth:!0,label:s("title"),value:a,onChange:k,onBlur:E}),e.jsx(G,{sx:{mt:2},multiline:!0,fullWidth:!0,value:d,onChange:i=>u(i.target.value),InputProps:{endAdornment:e.jsxs("div",{style:{display:"flex",flexDirection:"column",position:"sticky",top:0},children:[e.jsx(N,{title:s("save"),children:e.jsx(q,{size:"small",onClick:m,"aria-label":s("save"),children:e.jsx(W,{color:"success"})})}),e.jsx(R,{text:d}),e.jsx(R,{text:`${window.location.href}?importBoard=${n.id}`,copiedText:s("copiedLink"),icon:e.jsx(H,{}),tooltip:s("copyShareLink")})]}),sx:{alignItems:"flex-start"}}})]})}function Se({open:f,close:B,isMobile:o}){const n=b(ie),[s,d]=x.useState(null),[u,a]=x.useState(0),[v,T]=x.useState(0),m=ce()[0],{user:D}=de();if(!n)return null;const k=t=>{if(!t||!t.length)return null;const c=t[t.length-1];return c?.description?c.description.match(/\d+%/g):null},E=t=>{d(t)};async function i({title:t,tiles:c}){const h=c.map(({title:V})=>`* ${V} 
`);h.pop(),h.shift();let j=`### ${g("activated")}: ${t}
`;j+=`---
`,j+=[...new Set(h)].join(" "),j+=`---
`;const y=k(c);y&&y.length===3&&(j+=`* ${g("finishSlider")} ${y[0]}  | ${y[1]} | ${y[2]}`);const F=await te({title:t,gameBoard:JSON.stringify(c),settings:JSON.stringify(m)});F?.id&&await se({room:m?.room||"PUBLIC",user:D,text:j,type:"settings",gameBoardId:F.id,boardSize:c.length,gameMode:m?.gameMode})}const r=async()=>{const t=await X({isActive:0})||0;T(t)},l=t=>{Z(t.id),i(t),d({message:g("boardEnabled"),type:"success"})},p=t=>{t!==0&&a(t)},C=()=>{typeof u=="number"&&ee(u),a(0)},$=t=>(c,h)=>{T(h?t:0)},S=t=>!t.tiles||t.tiles.length!==(m?.roomTileCount||40),K=t=>S(t)?g("boardWrongSize",{size:m?.roomTileCount||40}):t.isActive?g("boardActive"):g("enableBoard");return e.jsxs(e.Fragment,{children:[e.jsxs(J,{fullScreen:o,open:f,onClose:B,PaperProps:{sx:{maxHeight:"100%",height:"100%"}},children:[e.jsxs(L,{children:[e.jsx(z,{i18nKey:"manageGameBoards"}),e.jsx(O,{close:B})]}),e.jsxs(M,{style:{overflowY:"scroll"},children:[e.jsxs(A,{sx:{mb:1},children:[e.jsx(I,{variant:"outlined",onClick:r,endIcon:e.jsx(Q,{}),sx:{float:"right"},children:e.jsx(z,{i18nKey:"add"})}),e.jsx(w,{children:e.jsx(z,{i18nKey:"gameBoardDescription"})})]}),n.map(t=>e.jsxs(oe,{expanded:v===t.id,onChange:$(t.id||0),children:[e.jsxs(ae,{children:[e.jsxs(A,{children:[e.jsx(w,{variant:"body1",children:t.title}),e.jsxs(w,{variant:"body2",children:[t.tiles?.length," tiles"]})]}),e.jsxs(A,{style:{marginLeft:"auto"},justifyContent:"flex-end",children:[e.jsx(N,{title:K(t),children:e.jsx("div",{style:{display:"inline-block"},children:e.jsx(U,{checked:!!t.isActive,disabled:!!t.isActive||S(t),onChange:()=>l(t),size:"small"})})}),e.jsx(N,{title:g("delete"),children:e.jsx("span",{style:{display:"inline-block"},children:e.jsx(q,{onClick:()=>p(t.id||0),size:"small",component:"span",children:e.jsx(Y,{color:"error"})})})})]})]}),e.jsx(le,{children:e.jsx(ue,{open:f,close:()=>$(t.id||0)(null,!1),setAlert:E,board:t})})]},t.id))]})]}),e.jsx(re,{open:!!s?.message,type:s?.type||"error",close:()=>d(null),children:s?.message}),e.jsxs(J,{open:!!u,onClose:()=>a(0),children:[e.jsxs(L,{children:["Delete Board",e.jsx(O,{close:()=>a(0)})]}),e.jsx(M,{children:e.jsxs(w,{variant:"body1",children:['Are you sure you want to delete "',n.find(t=>t.id===u)?.title,'"?']})}),e.jsxs(_,{children:[e.jsx(I,{onClick:()=>a(0),children:"Cancel"}),e.jsx(I,{onClick:C,children:"Delete"})]})]})]})}export{Se as default};
