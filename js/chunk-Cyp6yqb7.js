const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["js/getUniqueImportRecords.ts-DhRxBImL.js","js/chunk-CJVoFoqV.js","js/chunk-CsdNKD0V.js","js/chunk-DvmTZbFC.js","assets/index-BHUshCQG.js","js/chunk-CdWLCell.js","js/chunk-CxcwKXog.js","js/chunk-CpqhyqeY.js","js/schedule.tsx-dFnjltiV.js","js/chunk-CaEDXWoe.js","js/theme.tsx-D3MtnY0r.js","js/chunk-arCWr7CA.js","js/chunk-KX2hDaPG.js","js/chunk-Buz77Oyr.js","js/chunk-DWTSEXP2.js","js/chunk-LolS9Tp_.js","js/chunk-DJOIqVXf.js","js/chunk-D9_D7Pb0.js","js/chunk-q-nx_Rpp.js","js/chunk-CoxDZOLR.js","js/chunk-D9NIOe8w.js","js/chunk-B2GYjlo-.js"])))=>i.map(i=>d[i]);
import{r as i,ak as ne,j as e,T as G,ar as k,am as w,z as Y,y as H,as as J,M as $,A as te,aR as Ve,Q as Z,at as Le,U as he,W as fe,av as ye,$ as rt,Z as _e,Y as be,V as je,a7 as it,S as ve,aO as Ce,b8 as ot,I as se,a1 as de,R as Me,b9 as at,aN as Fe,ba as $e,ap as lt,aP as ct,aA as ut,bb as dt,G as pt,bc as mt,ao as me}from"./chunk-CJVoFoqV.js";import{n as ge,u as gt}from"./chunk-CsdNKD0V.js";import{D as xt,j as ue,w as Te,x as ce,B as Be,k as Ue,C as De,E as qe,F as Ae,G as Ye,y as Ne,H as ht,I as ft,J as yt,K as bt,L as jt,M as Oe,N as vt,O as Ct,m as Tt,u as Gt}from"./chunk-DvmTZbFC.js";import{A as oe,b as ae,c as le,u as Ge}from"./chunk-CxcwKXog.js";import{T as It}from"./chunk-DWTSEXP2.js";import{i as xe}from"./chunk-LolS9Tp_.js";import{_ as He}from"../assets/index-BHUshCQG.js";import{C as St}from"./chunk-D9_D7Pb0.js";import{g as wt,b as Et}from"./chunk-arCWr7CA.js";import{v as Je,g as Lt,d as Dt,e as Pe}from"./chunk-q-nx_Rpp.js";import{B as Xe,F as Ie,r as At,Y as Re,Z as We,K as Ke,_ as Nt,t as kt,$ as _t,a0 as Mt,a1 as Ft,a2 as $t,a3 as Ot,g as Pt}from"./chunk-CpqhyqeY.js";import{l as Rt}from"./chunk-KX2hDaPG.js";(function(){var o=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};o.SENTRY_RELEASE={id:"8380c411008c81db0d03192c8a87321e8e40e84f"}})();try{(function(){var o=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},m=new o.Error().stack;m&&(o._sentryDebugIds=o._sentryDebugIds||{},o._sentryDebugIds[m]="99b43faf-2be3-412d-9444-f9f1291bb1c5",o._sentryDebugIdIdentifier="sentry-dbid-99b43faf-2be3-412d-9444-f9f1291bb1c5")})()}catch{}function Qe(o){return Object.entries(o).flatMap(([m,{label:r,actions:h}])=>h?Object.keys(h).filter(y=>y!==xt).map((y,c)=>({group:wt(m),groupLabel:r,value:m,intensity:Number(c+1),translatedIntensity:y,label:`${r} - ${y}`})):[])}const Se="2.0.0",Wt=2,Ze=0;async function we(o="en",m={}){try{let r;if(m.exportScope==="single"&&m.singleGroup){const s=await ue(m.singleGroup,o);r=s&&!s.isDefault?[s]:[]}else m.exportScope==="default"?r=[]:r=(await Te({locale:o})).filter(l=>!l.isDefault);const h=await Te({locale:o}),a=new Set(h.filter(s=>s.isDefault).map(s=>s.name)),c=(await ce({isCustom:1})).filter(s=>{const l=!s.locale||s.locale===o;return m.exportScope==="single"&&m.singleGroup?l&&s.group===m.singleGroup:m.exportScope==="default"?l&&a.has(s.group):l}),t={};for(const s of r){const l=s.intensities.sort((E,_)=>E.value-_.value).map(E=>E.label),C=s.intensities.find(E=>E.value===Ze),A=l.filter(E=>E!==C?.label),N=C?[C.label,...A]:l;t[s.name]={label:s.label,type:s.type||"sex",intensities:N}}const d={};for(const s of c)d[s.group]||(d[s.group]={}),d[s.group][s.intensity]||(d[s.group][s.intensity]=[]),s.tags&&s.tags.length>0?d[s.group][s.intensity].push({action:s.action,tags:s.tags}):d[s.group][s.intensity].push(s.action);const u={};Object.keys(t).sort().forEach(s=>{u[s]=t[s]});const p={};return Object.keys(d).sort().forEach(s=>{p[s]={},Object.keys(d[s]).sort((l,C)=>Number.parseInt(l,10)-Number.parseInt(C,10)).forEach(l=>{p[s][Number.parseInt(l,10)]=d[s][Number.parseInt(l,10)]})}),JSON.stringify({version:Se,locale:o,groups:u,customTiles:p},(s,l)=>(Array.isArray(l)&&l.length>0&&typeof l[0]=="string",l),Wt)}catch(r){throw console.error("Error exporting clean data:",r),new Error(`Export failed: ${r}`)}}async function Kt(o,m={}){const r={success:!1,importedGroups:0,importedTiles:0,errors:[],warnings:[]};try{let h;try{h=JSON.parse(o)}catch(c){return r.errors.push("Invalid JSON format"),console.warn("Failed to parse import data JSON:",c),r}if(!h.version||!h.groups||!h.customTiles)return r.errors.push("Invalid export format - missing version, groups, or customTiles"),r;h.version!==Se&&r.warnings.push(`Format version mismatch: expected ${Se}, got ${h.version}`);const a=m.locale||h.locale||"en",y=m.mergeStrategy||"skip";for(const[c,t]of Object.entries(h.groups))try{const d=await ue(c,a);let u=c;if(d)switch(y){case"skip":r.warnings.push(`Skipped existing group: ${c}`);continue;case"overwrite":r.warnings.push(`Will update existing group: ${c}`);break;case"rename":{let l=1;for(u=`${c}_imported`;await ue(u,a);)u=`${c}_imported_${l}`,l++;r.warnings.push(`Renamed group from ${c} to ${u}`);break}}const p=t.intensities.map((l,C)=>({id:`intensity-${C}`,label:l,value:C,isDefault:C===Ze})),n={name:u,label:t.label,intensities:p,type:t.type,locale:a,isDefault:!1},s=await Je(n);if(!s.isValid){r.errors.push(`Invalid group ${u}: ${s.errors.join(", ")}`);continue}d&&y==="overwrite"?await Be(d.id,n):await Ue(n),r.importedGroups++}catch(d){r.errors.push(`Error importing group ${c}: ${d}`)}for(const[c,t]of Object.entries(h.customTiles))try{const d=await ue(c,a);if(!d){r.warnings.push(`Group ${c} not found for custom tiles, skipping tiles`);continue}for(const[u,p]of Object.entries(t)){const n=Number.parseInt(u,10);if(!d.intensities.find(l=>l.value===n)){r.warnings.push(`Intensity ${n} not valid for group ${c}, skipping tiles`);continue}for(const l of p)try{let C,A=[];if(typeof l=="string")C=l;else if(l&&typeof l=="object"&&"action"in l)C=l.action,A=l.tags||[];else{r.warnings.push(`Invalid tile data format in group ${c}, skipping`);continue}if((await ce()).find(_=>_.group===c&&_.intensity===n&&_.action===C&&(!_.locale||_.locale===a))&&y==="skip"){r.warnings.push(`Skipped existing tile: ${C.substring(0,50)}...`);continue}await De({group:c,intensity:n,action:C,tags:A,isCustom:1,locale:a}),r.importedTiles++}catch(C){r.errors.push(`Error importing tile "${typeof l=="string"?l.substring(0,30):"object"}...": ${C}`)}}}catch(d){r.errors.push(`Error importing tiles for group ${c}: ${d}`)}return r.success=r.errors.length===0,r}catch(h){return r.errors.push(`Import failed: ${h}`),r}}async function zt(o,m,r="en",h="online"){const a={success:!1,importedGroups:0,importedTiles:0,errors:[],warnings:[]};try{const{default:y}=await He(async()=>{const{default:u}=await import("./getUniqueImportRecords.ts-DhRxBImL.js");return{default:u}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21])),c=await ce(),{newUniqueRecords:t,changedTagRecords:d}=y(o,c,m);for(const u of t)try{await De(u),a.importedTiles++}catch(p){a.errors.push(`Error importing tile: ${p}`)}for(const u of d)try{u.id&&await qe(u.id,u)}catch(p){a.errors.push(`Error updating tile: ${p}`)}return a.success=a.errors.length===0,a.warnings.push("Imported using legacy format. Consider exporting in clean v2.0 format for better compatibility."),a}catch(y){return a.errors.push(`Legacy import failed: ${y}`),a}}async function Vt(o,m="en"){return we(m,{singleGroup:o,exportScope:"single"})}async function Bt(o,m,r={}){const h=o.trim();try{const a=JSON.parse(h);if(a.version&&a.groups)return Kt(h,r);if(a.version&&a.customGroups!==void 0)return{success:!1,importedGroups:0,importedTiles:0,errors:["Old enhanced format no longer supported. Please use clean v2.0 format."],warnings:[]}}catch{}return zt(h,m,r.locale||"en",r.gameMode||"online")}async function Ut(o="en"){try{const r=(await Te({locale:o})).filter(a=>!a.isDefault),h=await ce({isCustom:1});return r.map(a=>{const y=h.filter(c=>c.group===a.name&&(!c.locale||c.locale===o));return{name:a.name,label:a.label,tileCount:y.length}})}catch(m){return console.error("Error getting available groups for export:",m),[]}}function qt({expanded:o,handleChange:m,customTiles:r,mappedGroups:h,setSubmitMessage:a,bulkImport:y}){const c=i.useRef(null),{t}=ne(),{settings:d}=Ae(),[u,p]=i.useState(""),[n,s]=i.useState(null),[l,C]=i.useState("clean"),[A,N]=i.useState("all"),[E,_]=i.useState(""),[D,P]=i.useState([]),[b,F]=i.useState("skip"),M=i.useCallback(async()=>{try{if(l==="clean"){let f;switch(A){case"single":if(!E){a({message:t("errors.selectGroupToExport"),type:"error"});return}f=await Vt(E,d.locale||"en");break;case"default":f=await we(d.locale||"en",{exportScope:"default"});break;default:f=await we(d.locale||"en",{exportScope:"all"});break}p(f)}else{const g=r.filter(v=>v.isCustom).map(({group:v,intensity:S,action:z,tags:B,gameMode:K="online"})=>{const j=Qe(h[K]||{}).find(O=>O?.intensity===Number(S)&&O?.value===v);let L="";return L+=`[${j?.group||v} - ${j?.translatedIntensity||S}]
`,L+=z,L+=B?.length?`
Tags: `+B?.join(", "):"",L+=`
GameMode: ${K}`,L});p(g.join(`
---
`))}}catch(f){console.error("Error exporting data:",f),a({message:t("errors.exportFailed",{error:f}),type:"error"})}},[r,h,p,l,A,E,d.locale,a,t]);async function R(f){if(!f.current)return;const v=f.current.importData.value;if(!v.trim())return a({type:"error",message:t("enterDataToImport")});try{a({type:"info",message:t("importMessages.importing")});const S=await Bt(v,h,{locale:d.locale||"en",mergeStrategy:b});if(s(S),S.success){S.importedTiles>0&&(await He(()=>import("./chunk-DvmTZbFC.js").then(K=>K.W),__vite__mapDeps([3,4,1,2,5])).then(K=>K.getTiles({isCustom:1}))).slice(-S.importedTiles).forEach(async K=>{Ye(`${K.group} - ${K.intensity}`,K.action)});let z=t("importMessages.importSuccess");S.importedGroups>0&&(z+=` ${t("importMessages.importedGroups",{count:S.importedGroups})}`),S.importedTiles>0&&(z+=` ${t("importMessages.importedTiles",{count:S.importedTiles})}`),a({type:"success",message:z}),await M()}else a({type:"error",message:t("errors.importFailed",{errors:S.errors.join(", ")})})}catch(S){console.error("Import error:",S),a({type:"error",message:t("errors.importFailed",{errors:S.message||S})}),s(null)}}const T=i.useCallback(async()=>{try{const f=await Ut(d.locale||"en");P(f)}catch(f){console.error("Error loading available groups:",f)}},[d.locale]);return i.useEffect(()=>{o==="ctImport"&&(T(),M())},[o,r,M,T]),e.jsxs(oe,{expanded:o==="ctImport",onChange:m("ctImport"),className:"about-accordion",children:[e.jsx(ae,{"aria-controls":"ctImport-content",id:"ctImport-header",children:e.jsx(G,{className:"accordion-title",children:e.jsx(k,{i18nKey:"importExport"})})}),e.jsxs(le,{children:[e.jsx(G,{variant:"body1",sx:{mb:2},children:e.jsx(k,{i18nKey:"ctImportDescription"})}),e.jsxs(w,{sx:{display:"flex",flexWrap:"wrap",gap:2,mb:2,"& .MuiFormControl-root":{minWidth:150,flex:"1 1 auto"}},children:[e.jsxs(Y,{size:"small",children:[e.jsx(H,{children:t("labels.exportFormat")}),e.jsxs(J,{value:l,onChange:f=>C(f.target.value),label:t("labels.exportFormat"),children:[e.jsx($,{value:"clean",children:t("exportFormat.clean")}),e.jsx($,{value:"legacy",children:t("exportFormat.legacy")})]})]}),l==="clean"&&e.jsxs(Y,{size:"small",children:[e.jsx(H,{children:t("labels.exportScope")}),e.jsxs(J,{value:A,onChange:f=>{N(f.target.value),_("")},label:t("labels.exportScope"),children:[e.jsx($,{value:"all",children:t("exportScope.all")}),e.jsx($,{value:"default",children:t("exportScope.default")}),e.jsx($,{value:"single",children:t("exportScope.single")})]})]}),e.jsxs(Y,{size:"small",children:[e.jsx(H,{children:t("labels.importStrategy")}),e.jsxs(J,{value:b,onChange:f=>F(f.target.value),label:t("labels.importStrategy"),children:[e.jsx($,{value:"skip",children:t("importStrategy.skip")}),e.jsx($,{value:"overwrite",children:t("importStrategy.overwrite")}),e.jsx($,{value:"rename",children:t("importStrategy.rename")})]})]})]}),l==="clean"&&A==="single"&&e.jsx(w,{sx:{mb:2},children:e.jsxs(Y,{size:"small",fullWidth:!0,children:[e.jsx(H,{children:t("labels.selectGroup")}),e.jsx(J,{value:E,onChange:f=>_(f.target.value),label:t("labels.selectGroup"),children:D.map(f=>e.jsxs($,{value:f.name,children:[f.label," (",f.tileCount," tiles)"]},f.name))})]})}),e.jsxs(w,{component:"form",method:"post",ref:c,children:[e.jsx(te,{id:"importData",name:"importData",multiline:!0,required:!0,fullWidth:!0,rows:6,sx:{pb:2},value:u,onChange:f=>p(f.target.value),placeholder:t(l==="clean"?"placeholder.cleanFormat":"placeholder.legacyFormat"),InputProps:{endAdornment:e.jsx(St,{text:u}),sx:{alignItems:"flex-start"}}}),n&&e.jsxs(Ve,{severity:n.success?"success":"error",sx:{mb:2},onClose:()=>s(null),children:[e.jsx(G,{variant:"body2",children:e.jsx("strong",{children:e.jsx(k,{i18nKey:"importResults.title"})})}),n.importedGroups>0&&e.jsxs(G,{variant:"body2",children:["•"," ",e.jsx(k,{i18nKey:"importResults.groupsImported",values:{count:n.importedGroups}})]}),n.importedTiles>0&&e.jsxs(G,{variant:"body2",children:["•"," ",e.jsx(k,{i18nKey:"importResults.tilesImported",values:{count:n.importedTiles}})]}),n.warnings.length>0&&e.jsxs(w,{sx:{mt:1},children:[e.jsx(G,{variant:"body2",color:"warning.main",children:e.jsx("strong",{children:e.jsx(k,{i18nKey:"importResults.warnings"})})}),n.warnings.map((f,g)=>e.jsxs(G,{variant:"body2",color:"warning.main",children:["• ",f]},g))]}),n.errors.length>0&&e.jsxs(w,{sx:{mt:1},children:[e.jsx(G,{variant:"body2",color:"error.main",children:e.jsx("strong",{children:e.jsx(k,{i18nKey:"importResults.errors"})})}),n.errors.map((f,g)=>e.jsxs(G,{variant:"body2",color:"error.main",children:["• ",f]},g))]})]}),e.jsx(Z,{fullWidth:!0,variant:"contained",type:"button",onClick:()=>R(c),children:e.jsx(k,{i18nKey:"import"})})]}),l==="clean"&&e.jsxs(oe,{sx:{mt:2},className:"about-accordion",children:[e.jsx(ae,{children:e.jsx(G,{variant:"subtitle2",className:"accordion-title",children:e.jsx(k,{i18nKey:"formatGuide.title"})})}),e.jsxs(le,{children:[e.jsx(G,{variant:"body2",sx:{mb:2},children:e.jsx(k,{i18nKey:"formatGuide.description"})}),e.jsx(G,{variant:"body2",sx:{mb:1,fontWeight:"bold"},children:e.jsx(k,{i18nKey:"formatGuide.keySections"})}),e.jsx(G,{variant:"body2",component:"div",sx:{mb:2,ml:2},children:e.jsx(k,{i18nKey:"formatGuide.keySectionsContent",components:{strong1:e.jsx("strong",{}),strong2:e.jsx("strong",{}),br:e.jsx("br",{})}})}),e.jsx(G,{variant:"body2",sx:{mb:1,fontWeight:"bold"},children:e.jsx(k,{i18nKey:"formatGuide.manualEditing"})}),e.jsx(G,{variant:"body2",component:"div",sx:{mb:2,ml:2},children:e.jsx(k,{i18nKey:"formatGuide.manualEditingContent",components:{br:e.jsx("br",{})}})}),e.jsx(G,{variant:"body2",sx:{mb:1,fontWeight:"bold"},children:e.jsx(k,{i18nKey:"formatGuide.customTilesFormat"})}),e.jsx(G,{variant:"body2",component:"div",sx:{ml:2},children:e.jsx(k,{i18nKey:"formatGuide.customTilesFormatContent",components:{br:e.jsx("br",{}),code1:e.jsx("code",{}),code2:e.jsx("code",{})}})})]})]})]})]})}function Yt({value:o,onChange:m,locale:r,gameMode:h,includeDefault:a=!0,disabled:y=!1,refreshTrigger:c=0}){const{t}=ne(),[d,u]=i.useState([]),[p,n]=i.useState(!0);return i.useEffect(()=>{(async()=>{n(!0);try{const l=await Ne(r,h),C=a?l:l.filter(A=>!A.isDefault);u(C)}catch(l){console.error("Error loading custom groups:",l),u([])}finally{n(!1)}})()},[r,h,a,c]),p?e.jsxs(Y,{fullWidth:!0,disabled:!0,children:[e.jsx(H,{children:t("customGroups.loadingGroups")}),e.jsx(J,{value:"",children:e.jsx($,{value:"",children:e.jsxs(w,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Le,{size:16}),e.jsx("span",{children:t("customGroups.loadingGroups")})]})})})]}):e.jsx(w,{children:e.jsxs(Y,{fullWidth:!0,disabled:y,children:[e.jsx(H,{id:"group-label",children:t("group")}),e.jsx(J,{labelId:"group-label",value:o,onChange:s=>m(s.target.value),label:t("group"),children:d.length===0?e.jsx($,{value:"",disabled:!0,children:e.jsx(G,{color:"text.secondary",children:t("customGroups.noGroupsAvailable",{locale:r,gameMode:h})})}):d.map(s=>e.jsx($,{value:s.name,children:e.jsxs(w,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx("span",{children:s.label}),s.isDefault&&e.jsx(he,{label:t("default"),size:"small",variant:"outlined"})]})},s.id))})]})})}function Ht({groupName:o,value:m,onChange:r,locale:h,gameMode:a,disabled:y=!1}){const{t:c}=ne(),[t,d]=i.useState([]),[u,p]=i.useState(!1);i.useEffect(()=>{(async()=>{if(!o){d([]);return}p(!0);try{const l=await ht(o,h,a);d(l)}catch(l){console.error("Error loading group intensities:",l),d([])}finally{p(!1)}})()},[o,h,a]);const n=i.useMemo(()=>t.sort((s,l)=>s.value-l.value),[t]);return i.useEffect(()=>{if(t.length>0&&m&&!t.some(s=>s.value===m)){const s=n[0];s&&r(s.value)}},[t,m,r,n]),o?u?e.jsxs(Y,{fullWidth:!0,disabled:!0,children:[e.jsx(H,{children:c("customGroups.loadingIntensities")}),e.jsx(J,{value:"",children:e.jsx($,{value:"",children:e.jsxs(w,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Le,{size:16}),e.jsx("span",{children:c("customGroups.loadingIntensities")})]})})})]}):t.length===0?e.jsxs(Y,{fullWidth:!0,disabled:!0,children:[e.jsx(H,{children:c("intensity")}),e.jsx(J,{value:"",children:e.jsx($,{value:"",disabled:!0,children:e.jsx(G,{color:"text.secondary",children:c("customGroups.noIntensitiesAvailable",{groupName:o})})})})]}):e.jsx(w,{children:e.jsxs(Y,{fullWidth:!0,disabled:y,children:[e.jsx(H,{children:c("intensity")}),e.jsx(J,{value:m||"",onChange:s=>r(Number(s.target.value)),label:c("intensity"),children:n.map(s=>e.jsx($,{value:s.value,children:s.label},s.id))})]})}):e.jsxs(Y,{fullWidth:!0,disabled:!0,children:[e.jsx(H,{children:c("intensity")}),e.jsx(J,{value:"",children:e.jsx($,{value:"",disabled:!0,children:e.jsx(G,{color:"text.secondary",children:c("customGroups.selectGroupFirst")})})})]})}const Ee=[{name:"Basic (1-4)",intensities:[{label:"intensityLabels.light",value:1,isDefault:!0},{label:"intensityLabels.medium",value:2,isDefault:!0},{label:"intensityLabels.intense",value:3,isDefault:!0},{label:"intensityLabels.extreme",value:4,isDefault:!0}]},{name:"Simple (1-3)",intensities:[{label:"intensityLabels.beginner",value:1,isDefault:!0},{label:"intensityLabels.intermediate",value:2,isDefault:!0},{label:"intensityLabels.advanced",value:3,isDefault:!0}]},{name:"Extended (1-5)",intensities:[{label:"intensityLabels.veryLight",value:1,isDefault:!0},{label:"intensityLabels.light",value:2,isDefault:!0},{label:"intensityLabels.medium",value:3,isDefault:!0},{label:"intensityLabels.intense",value:4,isDefault:!0},{label:"intensityLabels.veryIntense",value:5,isDefault:!0}]}],ze=o=>{const m=Ee.findIndex(r=>r.intensities.length===o.length);return m>=0?m:1};function Jt({open:o,onClose:m,onGroupCreated:r,onGroupUpdated:h,editingGroup:a,locale:y,gameMode:c}){const{t}=ne(),[d,u]=i.useState(0),[p,n]=i.useState([]),[s,l]=i.useState(!0),[C,A]=i.useState({}),N=Lt(),[E,_]=i.useState(""),[D,P]=i.useState(""),[b,F]=i.useState(1),[M,R]=i.useState([t("intensityLabels.beginner"),t("intensityLabels.intermediate"),t("intensityLabels.advanced")]),[T,f]=i.useState(null),[g,v]=i.useState(!1),[S,z]=i.useState({isValid:!0,errors:[]}),[B,K]=i.useState(!1),[q,j]=i.useState(null),L=i.useCallback(async()=>{try{const I=(await Ne(y,c)).filter(U=>!U.isDefault);n(I);const W={};await Promise.all(I.map(async U=>{W[U.id]=await ft(U.name,y,c)})),A(W)}catch(x){console.error("Error reloading groups:",x)}},[y,c]);i.useEffect(()=>{(async()=>{if(o){l(!0);try{await L()}catch(I){console.error("Error loading groups:",I)}finally{l(!1)}}})()},[o,y,c,L]);const O=x=>x.toLowerCase().replace(/[^a-z0-9\s]/g,"").replace(/\s+/g,"_").substring(0,20)||`group_${ge(6).toLowerCase()}`;i.useEffect(()=>{a?(f(a),_(a.label),P(a.type||""),R(a.intensities.map(x=>x.label)),F(ze(a.intensities))):T?(_(T.label),P(T.type||""),R(T.intensities.map(x=>x.label)),F(ze(T.intensities))):(f(null),_(""),P(""),F(1),R([t("intensityLabels.beginner"),t("intensityLabels.intermediate"),t("intensityLabels.advanced")])),z({isValid:!0,errors:[]})},[a,T,o,t]);const X=x=>{const I=Ee[x];F(x),R(I.intensities.map(W=>t(W.label)))},re=(x,I)=>{const W=[...M];W[x]=I,R(W)},Q=()=>{M.length>=N.MAX_INTENSITIES_COUNT||R([...M,t("customGroups.levelLabel",{level:M.length+1})])},ee=x=>{if(M.length<=N.MIN_INTENSITIES_COUNT)return;const I=M.filter((W,U)=>U!==x);R(I)};i.useEffect(()=>{(async()=>{if(!E.trim()&&!D&&M.length===0){z({isValid:!0,errors:[]});return}const I=[];if(D&&!N.VALID_GROUP_TYPES.includes(D)&&I.push(t("typeValidationError",{types:N.VALID_GROUP_TYPES.join(", ")})),E.trim()&&!D&&I.push(t("typeRequiredError")),I.length>0){z({isValid:!1,errors:I});return}const W=M.map((st,nt)=>({id:ge(),label:st,value:nt+1,isDefault:!1})),U={name:T?T.name:O(E),label:E.trim(),intensities:W,type:D||void 0,locale:y,gameMode:c,isDefault:!1},tt=await Je(U,T?.id);z(tt)})()},[E,D,M,y,c,T,t,N.VALID_GROUP_TYPES]);const V=x=>{f(x),_(x.label),R(x.intensities.map(I=>I.label)),u(1)},ie=async x=>{const I=p.find(U=>U.id===x);if(!I)return;const W=C[x]||0;j({id:x,name:I.label,tileCount:W}),K(!0)},pe=async()=>{if(!q)return;const{id:x,tileCount:I}=q,W=p.find(U=>U.id===x);if(W)try{I>0&&await yt(W.name,y,c),await bt(x),await L(),h?.(null)}catch(U){console.error("Error deleting group:",U)}finally{K(!1),j(null)}},et=async()=>{if(!(!S.isValid||g)){v(!0);try{const x=M.map((W,U)=>({id:ge(),label:W,value:U+1,isDefault:!1})),I={name:T?T.name:O(E),label:E.trim(),intensities:x,type:D||void 0,locale:y,gameMode:c,isDefault:!1};if(T)await Be(T.id,I),h?.(T);else{const W=await Ue(I);W&&r?.({...I,id:W,createdAt:new Date,updatedAt:new Date,isDefault:!1,locale:y,gameMode:c})}ke(),m()}catch(x){console.error("Error saving custom group:",x),z({isValid:!1,errors:[t("failedToSaveGroup",{error:x})]})}finally{v(!1)}}},ke=()=>{f(null),_(""),P(""),F(1),R([t("intensityLabels.beginner"),t("intensityLabels.intermediate"),t("intensityLabels.advanced")]),z({isValid:!0,errors:[]})};return e.jsxs(e.Fragment,{children:[e.jsxs(fe,{open:o,onClose:m,maxWidth:"md",fullWidth:!0,PaperProps:{sx:{minHeight:"600px"}},children:[e.jsxs(ye,{children:[t("customGroups.manageCustomGroups"),e.jsx(G,{variant:"body2",color:"text.secondary",sx:{mt:1},children:t("customGroups.createNewGroupsDescription")}),e.jsxs(rt,{value:d,onChange:(x,I)=>{u(I),I===1&&!T&&ke()},sx:{mt:2,borderBottom:1,borderColor:"divider"},children:[e.jsx(_e,{label:t("customGroups.existingGroups")}),e.jsx(_e,{label:t(T?"customGroups.editGroup":"customGroups.createNew")})]})]}),e.jsxs(be,{dividers:!0,children:[d===0&&e.jsx(w,{children:s?e.jsx(G,{children:t("Loading groups...")}):p.length===0?e.jsx(G,{color:"text.secondary",sx:{textAlign:"center",py:4},children:t("customGroups.noCustomGroupsFound")}):e.jsx(je,{children:p.map((x,I)=>e.jsxs(it.Fragment,{children:[e.jsxs(ve,{children:[e.jsx(Ce,{primary:x.label,secondary:e.jsxs(w,{component:"span",sx:{display:"block"},children:[e.jsxs(G,{variant:"body2",color:"text.secondary",component:"span",sx:{display:"block"},children:[t("customGroups.intensityLevelsCount",{count:x.intensities.length}),": ",x.intensities.map(W=>W.label).join(", ")]}),e.jsx(G,{variant:"body2",color:"text.secondary",component:"span",sx:{display:"block",mt:.5},children:t("customGroups.customTilesCount",{count:C[x.id]||0})})]})}),e.jsxs(ot,{children:[e.jsx(se,{edge:"end","aria-label":"edit",onClick:()=>V(x),sx:{mr:1},children:e.jsx(Xe,{})}),e.jsx(se,{edge:"end","aria-label":"delete",onClick:()=>ie(x.id),color:"error",children:e.jsx(Ie,{})})]})]}),I<p.length-1&&e.jsx(de,{})]},x.id))})}),d===1&&e.jsxs(w,{sx:{display:"flex",flexDirection:"column",gap:3},children:[!S.isValid&&e.jsx(Ve,{severity:"error",children:S.errors.map((x,I)=>e.jsx("div",{children:x},I))}),e.jsxs(w,{sx:{p:2,bgcolor:"background.paper",borderRadius:1,border:"1px solid",borderColor:"divider"},children:[e.jsx(G,{variant:"h6",sx:{mb:2},children:t("customGroups.groupInformation")}),e.jsx(te,{label:t("customGroups.groupLabel"),value:E,onChange:x=>_(x.target.value),placeholder:"e.g., My Custom Group",helperText:t("customGroups.groupLabelHelp",{maxLength:N.MAX_GROUP_LABEL_LENGTH}),fullWidth:!0,required:!0,error:E.trim().length>0&&!Dt(E).isValid,sx:{mb:2}}),e.jsxs(te,{select:!0,label:t("customGroups.groupType"),value:D,onChange:x=>P(x.target.value),helperText:t("customGroups.groupTypeHelp"),fullWidth:!0,required:!0,error:E.trim().length>0&&!D,sx:{mb:2},children:[e.jsx($,{value:"",children:e.jsx("em",{children:t("groupTypes.selectType")})}),e.jsx($,{value:"solo",children:t("groupTypes.solo")}),e.jsx($,{value:"foreplay",children:t("groupTypes.foreplay")}),e.jsx($,{value:"sex",children:t("groupTypes.sex")}),e.jsx($,{value:"consumption",children:t("groupTypes.consumption")})]}),e.jsxs(w,{sx:{display:"flex",flexDirection:"column",gap:.5},children:[e.jsxs(G,{variant:"body2",color:"text.secondary",children:[e.jsx("strong",{children:t("customGroups.locale")})," ",y," |"," ",e.jsx("strong",{children:t("customGroups.gameMode")})," ",c]}),T?e.jsxs(G,{variant:"body2",color:"text.secondary",children:[e.jsx("strong",{children:t("customGroups.internalId")})," ",T.name," ","(locked)"]}):e.jsxs(G,{variant:"body2",color:"text.secondary",children:[e.jsx("strong",{children:t("customGroups.internalId")})," ",E?O(E):t("customGroups.autoGenerated")]})]})]}),e.jsxs(w,{sx:{display:"flex",alignItems:"center",gap:2,p:2,bgcolor:"action.hover",borderRadius:1},children:[e.jsx(G,{variant:"body2",sx:{fontWeight:"medium",minWidth:"auto"},children:t("customGroups.quickStart")}),e.jsx(te,{select:!0,value:b,onChange:x=>X(Number(x.target.value)),size:"small",sx:{minWidth:200},label:t("customGroups.chooseTemplate"),children:Ee.map((x,I)=>e.jsx($,{value:I,children:x.name==="Basic (1-4)"?t("templateBasic"):x.name==="Simple (1-3)"?t("templateSimple"):x.name==="Extended (1-5)"?t("templateExtended"):x.name},I))}),e.jsx(G,{variant:"body2",color:"text.secondary",sx:{fontSize:"0.75rem"},children:t("customGroups.selectTemplateDescription")})]}),e.jsxs(w,{children:[e.jsxs(G,{variant:"h6",sx:{mb:2},children:[t("customGroups.intensityLabels")," (",M.length,"/",N.MAX_INTENSITIES_COUNT,")"]}),e.jsx(G,{variant:"body2",color:"text.secondary",sx:{mb:2},children:t("customGroups.customizeIntensityDescription")}),e.jsxs(w,{sx:{display:"flex",flexDirection:"column",gap:1.5},children:[M.map((x,I)=>e.jsxs(w,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(G,{variant:"body2",sx:{minWidth:"30px",fontWeight:"bold",color:"primary.main"},children:I+1}),e.jsx(te,{label:t("customGroups.levelInputLabel",{level:I+1}),value:x,onChange:W=>re(I,W.target.value),size:"small",sx:{flex:1},inputProps:{maxLength:N.MAX_INTENSITY_LABEL_LENGTH}}),e.jsx(se,{onClick:()=>ee(I),disabled:M.length<=N.MIN_INTENSITIES_COUNT,color:"error",size:"small",children:e.jsx(Ie,{})})]},I)),e.jsx(Z,{startIcon:e.jsx(At,{}),onClick:Q,disabled:M.length>=N.MAX_INTENSITIES_COUNT,variant:"outlined",size:"small",sx:{alignSelf:"flex-start",mt:1},children:t("customGroups.addIntensityLevel")})]})]})]})]}),e.jsxs(Me,{children:[e.jsx(Z,{onClick:m,disabled:g,children:t("cancel")}),e.jsx(Z,{onClick:et,variant:"contained",disabled:!S.isValid||g,children:t(g?"customGroups.saving":T?"customGroups.updateGroup":"customGroups.createGroup")})]})]}),e.jsxs(fe,{open:B,onClose:()=>K(!1),children:[e.jsx(ye,{children:t("customGroups.confirmDelete")}),e.jsx(be,{children:e.jsx(G,{children:(q?.tileCount??0)>0?t("customGroups.deleteGroupWithTiles",{name:q?.name,count:q?.tileCount}):t("customGroups.deleteGroupConfirm",{name:q?.name})})}),e.jsxs(Me,{children:[e.jsx(Z,{onClick:()=>K(!1),children:t("cancel")}),e.jsx(Z,{onClick:pe,color:"error",variant:"contained",children:t("delete")})]})]})]})}function Xt({setSubmitMessage:o,boardUpdated:m,customTiles:r,mappedGroups:h,expanded:a,handleChange:y,tagList:c,updateTileId:t,setUpdateTileId:d}){const{t:u}=ne(),{settings:p}=Ae(),[n,s]=i.useState({gameMode:p.gameMode||"online",group:"",intensity:"",action:"",tags:[u("custom")]}),[l,C]=i.useState(!1),[A,N]=i.useState(""),[E,_]=i.useState(0);i.useEffect(()=>{const v=setTimeout(async()=>{if(!n.group||!n.intensity||!n.action){N("");return}try{const S=await Pe({group:n.group,intensity:Number(n.intensity),action:n.action,tags:n.tags,gameMode:n.gameMode,isCustom:1},p.locale||"en",n.gameMode);S.isValid?N(""):N(S.errors.join(", "))}catch(S){console.error("Error validating tile:",S),N("")}},300);return()=>clearTimeout(v)},[n.group,n.intensity,n.action,n.gameMode,n.tags,p.locale]),i.useEffect(()=>{const v=(Array.isArray(r)?r:[]).find(({id:S})=>S===t);if(v){const S=v.gameMode||p.gameMode;s({gameMode:S,group:v.group||"",intensity:v.intensity||"",action:v.action||"",tags:v.tags||[u("custom")]})}else s(S=>({...S,gameMode:p.gameMode}))},[t,p.gameMode,r,u]);function D(g,v,S){return(Array.isArray(r)?r:[]).find(B=>B.group===g&&B.intensity===v&&B.action===S)}function P(){d(null),s({gameMode:p.gameMode,group:"",intensity:"",action:"",tags:[u("custom")]}),N("")}const b=g=>{s(v=>({...v,group:g.name,intensity:""})),C(!1),_(v=>v+1)},F=()=>{_(g=>g+1)},M=i.useCallback(g=>{s(v=>({...v,intensity:g.toString()}))},[]);async function R(){const g=document.querySelector('input[name="tags"]'),v=[...n.tags];g&&g.value.trim()&&(v.push(g.value.trim()),g.value="");const{gameMode:S,group:z,intensity:B,action:K}=n;if(!S||!z||!B||!K)return o({message:u("allFieldsRequired","All fields are required"),type:"error"});if(A)return o({message:A,type:"error"});if(t==null&&D(z,B,K))return o({message:u("actionExists"),type:"error"});const q={group:z,intensity:Number(B),action:K,tags:v,gameMode:S,isCustom:1};try{const j=await Pe(q,p.locale||"en",S);if(!j.isValid)return o({message:j.errors.join(", "),type:"error"});if(t===null){const L=`${z} - Level ${B}`;Ye(L,K),await De(q)}else await qe(t,q);return m(),s(L=>({...L,action:"",tags:[u("custom")]})),o({message:u(t?"customUpdated":"customAdded"),type:"success"})}catch(j){return console.error("Error saving custom tile:",j),o({message:u("errorSavingTile"),type:"error"})}}const T=g=>{switch(g.key){case",":case"Enter":{g.preventDefault(),g.stopPropagation(),g.currentTarget.value.length>0&&(s(v=>({...v,tags:[...v.tags,g.currentTarget.value]})),g.currentTarget.value="");break}}},f=g=>{g.target.value.length>0&&(s(v=>({...v,tags:[...v.tags,g.target.value]})),g.target.value=""),setTimeout(()=>{const v=document.querySelector(".MuiAutocomplete-popper");v&&(v.style.display="none")},150)};return e.jsxs(e.Fragment,{children:[e.jsxs(oe,{expanded:a==="ctAdd",onChange:y("ctAdd"),className:"about-accordion",children:[e.jsx(ae,{"aria-controls":"ctAdd-content",id:"ctAdd-header",children:e.jsx(G,{className:"accordion-title",children:e.jsx(k,{i18nKey:t?"ctUpdate":"ctAdd"})})}),e.jsx(le,{children:e.jsxs(w,{component:"form",method:"post",className:"settings-box",children:[e.jsxs(te,{select:!0,label:u("customTiles.gameMode"),value:n.gameMode,onChange:g=>{s(v=>({...v,gameMode:g.target.value,group:"",intensity:""}))},fullWidth:!0,sx:{mb:2},children:[e.jsx("option",{value:"online",children:u("online")}),e.jsx("option",{value:"local",children:u("local")}),e.jsx("option",{value:"solo",children:u("solo")})]}),e.jsx(Yt,{value:n.group,onChange:g=>{s(v=>({...v,group:g,intensity:""}))},locale:p.locale||"en",gameMode:n.gameMode,refreshTrigger:E}),e.jsx(w,{sx:{mt:2},children:e.jsx(Ht,{groupName:n.group,value:Number(n.intensity)||0,onChange:M,locale:p.locale||"en",gameMode:n.gameMode})}),A&&e.jsx(w,{sx:{mt:1,mb:2},children:e.jsx(G,{color:"error",variant:"body2",children:A})}),e.jsx(te,{id:"action",name:"action",required:!0,fullWidth:!0,label:u("action"),sx:{mt:2,pb:2},value:n.action,onChange:g=>{s({...n,action:g.target.value})}}),e.jsx(at,{id:"tags",disableCloseOnSelect:!0,multiple:!0,freeSolo:!0,options:c,value:n.tags,onChange:(g,v)=>{s({...n,tags:v})},renderInput:g=>(g.inputProps.onKeyDown=T,g.inputProps.onBlur=f,e.jsx(te,{...g,label:u("tags")})),sx:{pb:2},clearOnBlur:!0,blurOnSelect:!0,openOnFocus:!0,disablePortal:!1,componentsProps:{popper:{modifiers:[{name:"preventOverflow",options:{altAxis:!0,altBoundary:!0,padding:8}}]}}}),e.jsxs(w,{display:"flex",flexDirection:{xs:"column",sm:"row"},justifyContent:{xs:"stretch",sm:"space-evenly"},gap:1,children:[e.jsx(Z,{variant:"outlined",type:"button",onClick:()=>C(!0),children:u("manageGroups")}),e.jsx(Z,{variant:"contained",type:"button",onClick:()=>P(),children:e.jsx(k,{i18nKey:"clear"})}),e.jsx(Z,{variant:"contained",type:"button",onClick:R,children:e.jsx(k,{i18nKey:t?"ctUpdate":"ctAdd"})})]})]})})]}),e.jsx(Jt,{open:l,onClose:()=>C(!1),onGroupCreated:b,onGroupUpdated:F,locale:p.locale||"en",gameMode:n.gameMode})]})}function Qt({expanded:o,handleChange:m}){const r=Ge(),[h,a]=i.useState({}),[y,c]=i.useState({}),t=n=>{a(s=>({...s,[n]:!s[n]}))},d=n=>{c(s=>({...s,[n]:!s[n]}))},u=[{id:"custom-actions",icon:e.jsx(Re,{}),title:"Custom Actions",description:"Add your own personalized activities to the game",tip:"Think of custom tiles as your personal touch - add activities that match your style and preferences perfectly.",color:"primary"},{id:"category-intensity",icon:e.jsx(kt,{}),title:"Category & Intensity Rules",description:"Tiles appear based on your game settings",tip:"Your tiles only show up when you select their category and intensity level (or higher) in game settings.",color:"secondary"}],p=[{id:"new-activities",icon:e.jsx(_t,{}),title:"New Activities",description:"Create unique actions not in the default list",tips:["Think outside the box - what creative activities would make your game more exciting?",'Add themed tiles like "Movie Night Actions" or "Kitchen Adventures"',"Create seasonal tiles for holidays or special occasions","Design role-play scenarios with specific character actions"],color:"primary"},{id:"intensity-boost",icon:e.jsx(Mt,{}),title:"Early Intensity Boost",description:"Add advanced tiles to beginner levels",tips:["Pro tip: Add exciting advanced tiles to lower intensities to start games with more energy.","Copy your favorite advanced tiles and add them to beginner categories",'Create "gateway" tiles that introduce advanced concepts gradually',"Mix easy and challenging elements in the same tile for variety"],color:"secondary"},{id:"mix-match",icon:e.jsx(Ft,{}),title:"Mix & Match",description:"Combine different activities into one tile",tips:["Mix activities that don't usually go together for unexpected combinations.","Combine physical actions with mental challenges or games","Create multi-step tiles that build on each other","Blend different intensity levels within a single creative tile"],color:"success"},{id:"custom-groups",icon:e.jsx($t,{}),title:"Custom Groups",description:"Create your own tile categories with unique intensities",tips:['Design completely custom groups like "Couples Yoga" or "Adventure Challenges"',"Set your own intensity progression from gentle to wild","Create themed collections that tell a story or follow a theme","Build niche categories that perfectly match your interests"],color:"warning"},{id:"share-creations",icon:e.jsx(Ot,{}),title:"Share & Discover",description:"Import/export tiles to share with others",tips:["Export your best tile collections to share with friends or partners","Import creative tiles from others to expand your game options","Create themed tile packs and share them in communities","Backup your custom tiles by exporting them regularly"],color:"info"}];return e.jsxs(e.Fragment,{children:[e.jsxs(oe,{expanded:o==="help1",onChange:m("help1"),className:"about-accordion",children:[e.jsx(ae,{"aria-controls":"help1-content",id:"help1-header",children:e.jsxs(w,{sx:{display:"flex",alignItems:"center",gap:1,width:"100%"},children:[e.jsx(Re,{color:"primary"}),e.jsx(G,{className:"accordion-title",children:e.jsx(k,{i18nKey:"ctExplained"})})]})}),e.jsx(le,{sx:{p:0},children:e.jsx(je,{dense:!0,children:u.map((n,s)=>e.jsxs(w,{children:[e.jsxs(ve,{sx:{cursor:"pointer",borderRadius:1,"&:hover":{bgcolor:"action.hover",transform:"translateX(4px)",transition:"all 0.2s ease-in-out"},transition:"all 0.2s ease-in-out"},onClick:()=>d(n.id),children:[e.jsx(Fe,{sx:{minWidth:r?36:40},children:e.jsx(w,{sx:{color:`${n.color}.main`,display:"flex",alignItems:"center"},children:n.icon})}),e.jsx(Ce,{primary:e.jsx(G,{variant:"subtitle2",sx:{fontWeight:500,fontSize:r?"0.9rem":"1rem"},children:n.title}),secondary:e.jsx(G,{variant:"body2",sx:{fontSize:r?"0.8rem":"0.85rem",color:"text.secondary"},children:n.description})}),e.jsx(se,{size:"small",sx:{ml:1},children:y[n.id]?e.jsx(We,{}):e.jsx(Ke,{})})]}),e.jsx($e,{in:y[n.id],timeout:"auto",unmountOnExit:!0,children:e.jsx(w,{sx:{ml:r?4:6,mr:2,mb:1,p:1.5,bgcolor:"action.selected",borderRadius:1,borderLeft:3,borderLeftColor:`${n.color}.main`},children:e.jsxs(G,{variant:"body2",sx:{fontSize:r?"0.8rem":"0.85rem",fontStyle:"italic",color:"text.secondary"},children:["💡 ",n.tip]})})}),s<u.length-1&&e.jsx(de,{variant:"inset",sx:{ml:r?4:6}})]},n.id))})})]}),e.jsxs(oe,{expanded:o==="help2",onChange:m("help2"),className:"about-accordion",children:[e.jsx(ae,{"aria-controls":"help2-content",id:"help2-header",children:e.jsxs(w,{sx:{display:"flex",alignItems:"center",gap:1,width:"100%"},children:[e.jsx(Nt,{color:"primary"}),e.jsx(G,{className:"accordion-title",children:e.jsx(k,{i18nKey:"ctIdeas"})})]})}),e.jsx(le,{sx:{p:0},children:e.jsx(je,{dense:!0,children:p.map((n,s)=>e.jsxs(w,{children:[e.jsxs(ve,{sx:{cursor:"pointer",borderRadius:1,"&:hover":{bgcolor:"action.hover",transform:"translateX(4px)",transition:"all 0.2s ease-in-out"},transition:"all 0.2s ease-in-out"},onClick:()=>t(n.id),children:[e.jsx(Fe,{sx:{minWidth:r?36:40},children:e.jsx(w,{sx:{color:`${n.color}.main`,display:"flex",alignItems:"center"},children:n.icon})}),e.jsx(Ce,{primary:e.jsx(G,{variant:"subtitle2",sx:{fontWeight:500,fontSize:r?"0.9rem":"1rem"},children:n.title}),secondary:e.jsx(G,{variant:"body2",sx:{fontSize:r?"0.8rem":"0.85rem",color:"text.secondary"},children:n.description})}),e.jsx(se,{size:"small",sx:{ml:1},children:h[n.id]?e.jsx(We,{}):e.jsx(Ke,{})})]}),e.jsx($e,{in:h[n.id],timeout:"auto",unmountOnExit:!0,children:e.jsx(w,{sx:{ml:r?4:6,mr:2,mb:1,p:1.5,bgcolor:"action.selected",borderRadius:1,borderLeft:3,borderLeftColor:`${n.color}.main`},children:n.tips.map((l,C)=>e.jsx(G,{variant:"body2",sx:{fontSize:r?"0.8rem":"0.85rem",fontStyle:C===0?"italic":"normal",color:"text.secondary",mb:C<n.tips.length-1?1:0,"&:before":C===0?{content:'"💡 "'}:{content:'"• "'}},children:l},C))})}),s<p.length-1&&e.jsx(de,{variant:"inset",sx:{ml:r?4:6}})]},n.id))})})]})]})}function Zt({gameMode:o,groupFilter:m,intensityFilter:r,groups:h,mappedGroups:a,dexieGroups:y,onGameModeChange:c,onGroupChange:t,onIntensityChange:d,hideAll:u=!1,sx:p={}}){const{t:n}=ne(),[s,l]=i.useState([]),C=u?1:"all",A=i.useMemo(()=>{if(!a?.[o])return[];const b=Qe(a[o]);return Array.isArray(b)?b:[]},[a,o]),N=i.useCallback(b=>{if(y?.[b])return y[b].label||b;const F=A.find(M=>M.value===b);return F?.groupLabel?F.groupLabel:b},[y,A]),E=i.useCallback((b,F)=>{if(y?.[b]){const R=y[b].intensities.find(T=>T.value===Number(F));if(R?.label)return R.label}const M=A.find(R=>R.value===b&&R.intensity===Number(F));return M?.translatedIntensity?M.translatedIntensity:`Level ${Number(F)+1}`},[y,A]);i.useEffect(()=>{if(h){const b=Object.keys(h);l(b)}},[h,o]);function _(b){const F=b.target.value;t(F),d(C)}if(!s?.length)return null;const D=s.length===0||s.includes(m)?m:"",P=r==="all"?"all":r;return e.jsxs(w,{sx:{display:"flex",flexWrap:"wrap",gap:2,...p},children:[e.jsxs(Y,{sx:{width:125,flexShrink:0},children:[e.jsx(H,{id:"game-mode-filter-label",children:e.jsx(k,{i18nKey:"customTiles.gameMode"})}),e.jsxs(J,{labelId:"game-mode-filter-label",id:"game-mode-filter",value:o,label:n("customTiles.gameMode","Game Mode"),onChange:b=>{c(b.target.value)},slotProps:{input:{"aria-label":n("customTiles.gameMode","Game Mode")}},children:[e.jsx($,{value:"online",children:e.jsx(k,{i18nKey:"online"})}),e.jsx($,{value:"local",children:e.jsx(k,{i18nKey:"local"})})]})]}),e.jsxs(Y,{sx:{minWidth:150,flex:1},children:[e.jsx(H,{id:"group-filter-label",children:e.jsx(k,{i18nKey:"group"})}),e.jsx(J,{labelId:"group-filter-label",id:"group-filter",value:D,label:n("group"),onChange:_,slotProps:{input:{"aria-label":n("group")}},children:s.map(b=>e.jsxs($,{value:b,children:[N(b),!u&&h[b]&&` (${h[b].count})`]},b))})]}),e.jsxs(Y,{sx:{minWidth:200,flex:1},disabled:!D,children:[e.jsx(H,{id:"intensity-filter-label",children:e.jsx(k,{i18nKey:"customTiles.intensityLevel",children:"Intensity Level"})}),e.jsxs(J,{labelId:"intensity-filter-label",id:"intensity-filter",value:P,label:n("customTiles.intensityLevel","Intensity Level"),onChange:b=>d(b.target.value),slotProps:{input:{"aria-label":n("customTiles.intensityLevel","Intensity Level")}},children:[!u&&e.jsx($,{value:"all",children:e.jsx(k,{i18nKey:"all",children:"All"})},"all"),D&&h&&h[D]&&Object.entries(h[D].intensities||{}).sort(([b],[F])=>Number(b)-Number(F)).map(([b,F])=>e.jsxs($,{value:Number(b),children:[E(D,b),!u&&F!==void 0?` (${F})`:""]},b))]})]})]})}function es({tagList:o,boardUpdated:m,mappedGroups:r,updateTile:h,refreshTrigger:a}){const{t:y,i18n:c}=ne(),{settings:t}=Ae(),[d,u]=i.useState(null),[p,n]=i.useState(t.gameMode||"online"),[s,l]=i.useState(""),[C,A]=i.useState(""),[N,E]=i.useState(1),[_,D]=i.useState(!0),[P,b]=i.useState({items:[],total:0,totalPages:1}),[F,M]=i.useState({}),[R,T]=i.useState({}),f=10;i.useEffect(()=>{async function j(){try{D(!0);const[L,O]=await Promise.all([Ne(c.resolvedLanguage,p),jt(c.resolvedLanguage,p,d)]),X={};L.forEach(V=>{X[V.name]=V}),T(X);const re={};L.forEach(V=>{const ie=O[V.name]||{count:0,intensities:{}};re[V.name]={label:V.label||V.name,count:ie.count,intensities:ie.intensities}}),M(re);const Q=L.map(V=>V.name),ee=Q.includes(s);if((!s||!ee)&&Q.length>0)l(Q[0]),A("all");else if(ee&&C!=="all"){const V=L.find(ie=>ie.name===s);V&&(V.intensities.map(pe=>pe.value).includes(Number(C))||A("all"))}}catch(L){console.error("Error loading groups and counts:",L)}finally{D(!1)}}j()},[p,c.resolvedLanguage,d,s,C]),i.useEffect(()=>{let j=!0;async function L(){try{D(!0);const O={group:s,intensity:C==="all"?null:Number(C),tag:d,gameMode:p,locale:t.locale,page:N,limit:f,paginated:!0},X=await Oe(O);j&&(b(X),setTimeout(()=>{j&&D(!1)},300))}catch(O){console.error("Error loading tiles:",O),j&&D(!1)}}return s?L():D(!1),()=>{j=!1}},[s,C,d,p,N,f,a,t.locale]);function g(j){D(!0),u(d===j?null:j)}function v(j,L){D(!0),E(L)}async function S(j){await vt(j),m();const L={group:s,intensity:C==="all"?null:C,tag:d,gameMode:p,locale:t.locale,page:N,limit:f,paginated:!0},O=await Oe(L);b(O)}async function z(j){await Ct(j),m(),b(L=>({...L,items:L.items.map(O=>O.id===j?{...O,isEnabled:!O.isEnabled}:O)}))}function B(j){h(j);const L=document.querySelector(".MuiDialogContent-root");L&&(L.scrollTop=0)}function K(j,L){const O=R[j];if(O){const X=O.label||j,Q=O.intensities.find(ee=>ee.value===Number(L))?.label||`Level ${Number(L)+1}`;return`${X} - ${Q}`}return`${j} - Level ${Number(L)+1}`}const q=P.items?.map(({id:j,group:L,intensity:O,action:X,tags:re,isEnabled:Q=!0,isCustom:ee=!0})=>e.jsxs(lt,{sx:{my:2},children:[e.jsx(ct,{title:X,slotProps:{title:{variant:"body1"},subheader:{variant:"body2"},action:{"aria-label":y("customTiles.actions")}},subheader:K(L,O),action:e.jsxs(e.Fragment,{children:[e.jsx(ut,{checked:!!Q,onChange:()=>j!==void 0&&z(j),slotProps:{input:{"aria-label":y("customTiles.toggleTile")}}}),!!ee&&e.jsxs(e.Fragment,{children:[e.jsx(se,{onClick:()=>j!==void 0&&B(j),"aria-label":y("customTiles.update"),children:e.jsx(Xe,{})}),e.jsx(se,{onClick:()=>j!==void 0&&S(j),"aria-label":y("customTiles.delete"),children:e.jsx(Ie,{})})]})]}),sx:{pb:0}}),e.jsx(dt,{children:re?.map(V=>e.jsx(he,{label:V==="default"?y("default"):V,sx:{m:.5}},V))})]},j));return e.jsxs(w,{children:[e.jsx(w,{children:o?.map(j=>e.jsx(he,{label:j,sx:{m:.5},color:d===j?"primary":"default",onClick:()=>g(j)},j))}),e.jsx(w,{sx:{display:"flex",flexDirection:"column",gap:2,my:2,transition:"all 0.3s ease-in-out"},children:e.jsx(Zt,{gameMode:p,groupFilter:s,intensityFilter:C,groups:F,mappedGroups:r,dexieGroups:R,onGameModeChange:j=>{n(j),l(""),A(""),E(1)},onGroupChange:j=>{l(j),E(1)},onIntensityChange:j=>{A(j),E(1)}})}),e.jsxs(w,{sx:{position:"relative",minHeight:"200px"},children:[e.jsx(pt,{in:_,timeout:300,children:e.jsx(w,{sx:{position:"absolute",top:0,left:0,right:0,bottom:0,display:"flex",justifyContent:"center",alignItems:"center",backgroundColor:"rgba(255, 255, 255, 0)",zIndex:1,borderRadius:1},children:e.jsx(Le,{})})}),e.jsx(w,{sx:{opacity:_?.3:1,transition:"opacity 0.3s ease-in-out",pointerEvents:_?"none":"auto"},children:P.items.length===0?e.jsx(G,{variant:"body1",sx:{textAlign:"center",my:4},children:e.jsx(k,{i18nKey:"customTiles.noTilesFound",children:"No tiles found with the selected filters."})}):e.jsxs(e.Fragment,{children:[q,P.totalPages>1&&e.jsx(w,{sx:{display:"flex",justifyContent:"center",mt:3,mb:2},children:e.jsx(mt,{count:P.totalPages,page:N,onChange:v,color:"primary"})}),e.jsx(G,{variant:"body2",sx:{textAlign:"center",mt:2,color:"text.secondary"},children:e.jsxs(k,{i18nKey:"customTiles.showingTiles",values:{shown:P.items.length,total:P.total},children:["Showing ",{shown:P.items.length}," of ",{total:P.total}," tiles"]})})]})})]})]})}function ms({boardUpdated:o,setOpen:m,open:r=!1}){const{t:h,i18n:a}=ne(),y=Ge(),c=Ge("md"),[t,d]=i.useState({message:"",type:"info"}),[u,p]=i.useState("ctAdd"),[n,s]=i.useState(null),[l,C]=i.useState(0),[A,N]=i.useState({online:{},local:{},solo:{}}),[E,_]=i.useState(!0),D=i.useCallback(()=>{C(T=>T+1)},[]),P=T=>(f,g)=>{p(g?T:"")};i.useEffect(()=>{async function T(){_(!0);try{const[f,g,v]=await Promise.all([xe(a.resolvedLanguage,"online"),xe(a.resolvedLanguage,"local"),xe(a.resolvedLanguage,"solo")]);N({online:f,local:g,solo:v})}catch(f){console.error("Error loading game mode actions:",f)}finally{_(!1)}}T()},[a.resolvedLanguage]);const b=gt(()=>ce({locale:a.resolvedLanguage})),F=i.useMemo(()=>b?Array.isArray(b)?b.map(({tags:T})=>T).flat().filter((T,f,g)=>T&&g.indexOf(T)===f).sort():[]:[],[b]),M=i.useCallback(async T=>{await Tt(T),o(),D()},[o,D]);if(!b||E)return null;const R=()=>{const T=e.jsxs(e.Fragment,{children:[e.jsx(Qt,{expanded:u,handleChange:P}),e.jsx(Xt,{setSubmitMessage:d,boardUpdated:()=>{o(),D()},customTiles:b,mappedGroups:A,expanded:u,handleChange:P,tagList:F,updateTileId:n,setUpdateTileId:s}),e.jsx(qt,{expanded:u,handleChange:P,customTiles:b,mappedGroups:A,setSubmitMessage:d,bulkImport:M})]}),f=Array.isArray(b)&&b.length>0&&e.jsx(w,{children:e.jsx(es,{tagList:F,boardUpdated:()=>{o(),D()},mappedGroups:A,updateTile:g=>{s(g),p("ctAdd")},refreshTrigger:l})});return c?e.jsxs(e.Fragment,{children:[T,f&&e.jsxs(e.Fragment,{children:[e.jsx(de,{sx:{my:2}}),f]})]}):e.jsxs(me,{container:!0,spacing:2,children:[e.jsx(me,{size:{xs:12,md:6},children:T}),e.jsx(me,{size:{xs:12,md:6},children:f})]})};return e.jsxs(e.Fragment,{children:[e.jsxs(fe,{fullScreen:y,open:r,onClose:()=>m(!1),maxWidth:c?"sm":"lg",fullWidth:!0,children:[e.jsxs(ye,{children:[e.jsx(k,{i18nKey:"manageTiles"}),e.jsx(se,{"aria-label":h("close"),onClick:()=>m(!1),sx:{position:"absolute",right:8,top:8,color:T=>T.palette.grey[500]},children:e.jsx(Pt,{})})]}),e.jsx(be,{children:R()})]}),e.jsx(It,{open:!!t.message,close:()=>d({message:"",type:"info"}),type:t.type,children:t.message})]})}function gs(o={},m={}){const[r]=Gt(),h={...o,...r,selectedActions:r?.selectedActions||{},finishRange:r?.finishRange||[30,70],...m},[a,y]=i.useState(h),{messages:c}=Et(),[t,d]=i.useState(!1);return i.useEffect(()=>{const u=Rt(c,"room");if(u?.settings)try{const p=JSON.parse(u.settings);y(n=>t?n.selectedActions&&Object.keys(n.selectedActions).length>0?{...n,...p,selectedActions:n.selectedActions}:{...n,...p}:(d(!0),{...n,...p}))}catch(p){console.error("Error parsing message settings:",p)}else t||d(!0)},[c,t]),[a,y]}export{ms as C,Qe as g,gs as u};
//# sourceMappingURL=chunk-Cyp6yqb7.js.map
