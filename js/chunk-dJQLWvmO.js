import{i as b}from"./chunk-DTHeDMMX.js";import{g as x}from"./chunk-B4PEA_xj.js";import{l as h}from"./chunk-yLOK5aTh.js";import{r as g,j as d,am as k}from"./chunk-CXdXj9vr.js";import{u as v}from"./chunk-C5RMXZJv.js";import{c as w}from"./chunk-CwpkSHF3.js";function I(e){const t=/vimeo\.com\/(\d+)/,o=e.match(t);return`https://player.vimeo.com/video/${o?o[1]:""}?autoplay=1&loop=1&autostart=true`}function U(e){const t=/(?:youtube\.com\/(?:[^/]+\/.+\/|(?:v|e(?:mbed)?)\/|[^#]*[?&]v=|youtu\.be\/)([^"&?/ ]{11})|^(?:[^"&?/ ]{11})$)/,o=e.match(t);return`https://www.youtube.com/embed/${o?o[1]:""}?autoplay=1&loop=1&autostart=true`}function R(e){const t=/drive\.google\.com\/file\/d\/([^/]+)/,o=e.match(t);return`https://drive.google.com/file/d/${o?o[1]:""}/preview?loop=1`}function B(e){const t=/dropbox\.com\/s\/([^/]+)/,o=e.match(t);return`https://www.dropbox.com/s/${o?o[1]:""}?raw=1`}function $(e){return`https://pornhub.com/embed/${new URL(e).searchParams.get("viewkey")||""}?autoplay=1&loop=1&autostart=true`}function j(e){const t=e.split("-");return`https://xhamster.com/xembed.php?video=${t[t.length-1]}?autoplay=1&loop=1&autostart=true`}function L(e){try{const r=new URL(e);if((r.host==="discordapp.net"||r.host.endsWith(".discordapp.net"))&&r.pathname.startsWith("/external/")&&(r.pathname.includes("/https/i.imgur.com/")||r.pathname.includes("/https/imgur.com/")))return e}catch(r){h.debug("URL parsing failed for Discord proxy check:",r)}let t="",o=!1;try{const r=new URL(e);o=r.host==="imgur.com"||r.host==="i.imgur.com"}catch(r){return h.debug("URL parsing failed for Imgur processing:",r),""}if(!o)return"";if(e.includes("/gallery/")){const r=e.match(/imgur\.com\/gallery\/[^#]*#([a-zA-Z0-9]+)/);if(r)t=r[1];else{const s=e.match(/#([a-zA-Z0-9]+)/);s&&(t=s[1])}}else{const r=/imgur\.com\/([a-zA-Z0-9]+)(?:\.(mp4|jpg|jpeg|png|gif|webp))?|images-ext-\d+\.discordapp\.net\/external\/[^/]+\/https\/i\.imgur\.com\/([a-zA-Z0-9]+)\.(mp4|jpg|jpeg|png|gif|webp)/,s=e.match(r);t=s?s[1]||s[3]:""}return`https://i.imgur.com/${t}.mp4`}function y(e){return/\.(mp4|webm|ogg|mov)(\?.*)?$/.test(e)}function A(e){return f(e,["media.discordapp.net","cdn.discordapp.com"])&&!y(e)}function f(e,t){try{const o=new URL(e);return t.some(n=>o.host===n||o.host.endsWith("."+n))}catch(o){return h.debug("URL parsing failed in urlContainsAny, using fallback:",o),t.some(n=>e.includes(n))}}function P(e){let t=null,o=!0;if(!e)return{url:"",isVideo:!1};switch(!0){case e.includes("vimeo.com"):t=I(e);break;case f(e,["youtube.com","youtu.be"]):t=U(e);break;case e.includes("drive.google.com"):t=R(e);break;case e.includes("pornhub.com"):t=$(e);break;case e.includes("xhamster.com"):t=j(e);break;case e.includes("dropbox.com"):t=B(e);break;case f(e,["imgur.com","i.imgur.com"]):t=L(e);break;case f(e,["thisvid.com","boyfriendtv.com"]):t=e;break;case A(e):t=e,o=!1;break;case y(e):t=e;break;default:t=x(e),o=!1;break}return{url:t,isVideo:o}}function T(e,t){const{background:o,backgroundURL:n,roomBackground:r,roomBackgroundURL:s}=e,l=(c,u)=>{if(!c)return null;if(c==="custom")return u?s||null:n||null;if(c==="useAppBackground"){const a=o||"color";return a==="useRoomBackground"?"color":a==="custom"?n||null:a}if(c==="useRoomBackground"){if(b(t))return"color";const a=r||"useAppBackground";return a==="useAppBackground"?"color":a==="custom"?s||null:a}return c};let i=null;return!b(t)&&r&&r!=="useAppBackground"?i=l(r,!0):o?i=l(o,!1):i="color",i?i==="color"||i==="gray"?{url:i,isVideo:!1}:P(i):{url:null,isVideo:!1}}function F(e){return{uid:e.uid,displayName:e.displayName,isSelf:e.isSelf,isFinished:e.isFinished}}function C(e){const[t,o]=g.useState(null),n=v();return g.useEffect(()=>{if(!e)return;if(n.length<=1){o(null);return}const r=n.filter(c=>!c.isFinished);if(r.length<=1){o(null);return}let s=-1;s=r.findIndex(c=>c.uid===e.uid),s===-1&&(s=r.findIndex(c=>c.displayName===e.displayName)),s===-1&&(s=0);const l=(s+1)%r.length,i=r[l],m=F(i);o(m)},[e,n]),t}function S({url:e}){const[t,o]=g.useState("video"),[n,r]=g.useState(e);if(g.useEffect(()=>{r(e),o("video")},[e]),!e)return null;const s=()=>{let i=!1;try{const u=new URL(e);i=u.host==="imgur.com"||u.host==="i.imgur.com"}catch{i=!1}if(i){const u=e.match(/imgur\.com\/([a-zA-Z0-9]+)/)?.[1];if(u){const a=`https://i.imgur.com/${u}.jpg`;r(a),o("image");return}}const c=`${e.replace(/\.(mp4|webm|ogg|mov)(\?.*)?$/i,"")}.jpg`;r(c),o("image")},l=()=>{let i=!1;try{const m=new URL(e);i=m.host==="imgur.com"||m.host==="i.imgur.com"}catch{i=!1}if(i){const m=e.match(/imgur\.com\/([a-zA-Z0-9]+)/)?.[1];if(m){const c=["png","gif","jpeg","webp"],u=n?.split(".").pop(),a=c.find(p=>p!==u);if(a){const p=`https://i.imgur.com/${m}.${a}`;r(p)}}}else{const m=["png","gif","jpeg","webp"],c=n?.split(".").pop(),u=m.find(a=>a!==c);if(u&&n){const p=`${n.replace(/\.[^.]+(\?.*)?$/,"")}.${u}`;r(p)}}};return t==="video"?d.jsx("video",{autoPlay:!0,loop:!0,muted:!0,playsInline:!0,src:n||void 0,className:"video-background",onError:s}):d.jsxs(d.Fragment,{children:[d.jsx("div",{className:"image-background",style:{backgroundImage:`url(${n})`,backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat",width:"100%",height:"100%",position:"absolute",top:0,left:0}}),d.jsx("img",{src:n||void 0,onError:l,style:{display:"none"},alt:""})]})}function H({url:e=null,isVideo:t=null}){const o=e&&/\.(mp4|webm|ogg|mov)(\?.*)?$/i.test(e),n=e==="color"||e==="gray"||e?.includes("/color")||e?.includes("/gray"),r=e&&!n&&(t||!t&&e);return d.jsx(k,{className:w("main-container",!r&&"default-background"),role:"presentation",sx:{backgroundImage:!t&&e&&!n?`url(${e})`:"none"},children:t&&(o?d.jsx(S,{url:e}):d.jsx("iframe",{width:"100%",height:"100%",src:e||void 0,title:"video",allowFullScreen:!0,allow:"autoplay",style:{border:0}}))})}export{H as R,T as g,P as p,C as u};
