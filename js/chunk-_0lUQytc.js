import{b as d,j as p,u as D,W,D as J,ar as K}from"./chunk-DEpGQMoM.js";import{c as C}from"./chunk-Bb4N9MXk.js";import{g as Y}from"./chunk-Chz5q09A.js";import{i as q}from"./chunk-BoJodteh.js";import{l as L}from"./chunk-Bmx5YEUT.js";import{u as X}from"./chunk-GpkVa6vM.js";(function(){var e=typeof window!="undefined"?window:typeof global!="undefined"?global:typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:{};e.SENTRY_RELEASE={id:"b82d01bea29447e452b49ba3e85b9fac2f7942a4"}})();try{(function(){var e=typeof window!="undefined"?window:typeof global!="undefined"?global:typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:{},t=new e.Error().stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="90237fbc-eab2-40b6-8e6d-6c5314cf7f17",e._sentryDebugIdIdentifier="sentry-dbid-90237fbc-eab2-40b6-8e6d-6c5314cf7f17")})()}catch(e){}function G(e){let t="";for(const o of String(e)){const i=o.codePointAt(0);i>=0&&i<=31||i===127||i>=128&&i<=159||i===8232||i===8233||(t+=o)}return`url("${t.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}")`}const O=e=>e&&/\.(jpe?g|png|webp|bmp|svg|gif|avif|tiff?|heic|heif|jfif)(\?.*)?$/i.test(e)?"image":"video";function Q({url:e}){const[t,n]=d.useState(O(e)),[o,i]=d.useState(e);if(d.useEffect(()=>{i(e),n(O(e))},[e]),!o)return null;const s=()=>{var a,R;const v=(a=o!=null?o:e)!=null?a:"";let h=!1;try{const b=new URL(v);h=b.host==="imgur.com"||b.host==="i.imgur.com"}catch(b){h=!1}if(h){const b=(R=v.match(/(?:i\.)?imgur\.com\/([a-zA-Z0-9]+)(?:\.[a-z]+)?/))==null?void 0:R[1];if(b){const I=`https://i.imgur.com/${b}.jpg`;i(I),n("image");return}}const u=`${v.replace(/\.(mp4|webm|ogg|mov)(\?.*)?$/i,"")}.jpg`;i(u),n("image")},r=()=>{var a,R;const v=(a=o!=null?o:e)!=null?a:"";let h=!1;try{const c=new URL(v);h=c.host==="imgur.com"||c.host==="i.imgur.com"}catch(c){h=!1}if(h){const c=(R=v.match(/(?:i\.)?imgur\.com\/([a-zA-Z0-9]+)(?:\.[a-z]+)?/))==null?void 0:R[1];if(c){const u=["jpg","png","gif","jpeg","webp"],b=o==null?void 0:o.split(".").pop(),m=u.indexOf(b||"")+1;if(m<u.length){const U=u[m],$=`https://i.imgur.com/${c}.${U}`;i($)}}}else{const c=["jpg","png","gif","jpeg","webp"],u=o==null?void 0:o.split(".").pop(),I=c.indexOf(u||"")+1;if(I<c.length&&o){const m=c[I],$=`${o.replace(/\.[^.]+(\?.*)?$/,"")}.${m}`;i($)}}};return t==="video"?p.jsx("video",{autoPlay:!0,loop:!0,muted:!0,playsInline:!0,src:o||void 0,className:"video-background",onError:s,preload:"auto",crossOrigin:"anonymous",controls:!0}):p.jsxs(p.Fragment,{children:[p.jsx("div",{className:"image-background",style:{backgroundImage:o?G(o):void 0,backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat",width:"100%",height:"100%",position:"absolute",top:0,left:0}}),p.jsx("img",{src:o||void 0,onError:r,style:{display:"none"},alt:""})]})}function ee({images:e,className:t,zoomDuration:n=3e3,zoomScale:o=1.4}){const{t:i}=D(),[s,r]=d.useState(0),[a,R]=d.useState(0),[v,h]=d.useState(new Set),[c,u]=d.useState(new Set),[b,I]=d.useState(!1),m=d.useRef(null),U=d.useRef(new Map);d.useEffect(()=>{I(!1),h(new Set),u(new Set),U.current.clear(),r(0),R(0)},[e]),d.useEffect(()=>{if(e.length===0)return;const w=g=>new Promise(x=>{if(U.current.has(g)||c.has(g)){x();return}const l=new Image;l.onload=()=>{U.current.set(g,l),h(j=>{const _=new Set(j).add(g);return!b&&g===e[0]&&I(!0),_}),x()},l.onerror=()=>{u(j=>new Set(j).add(g)),x()},l.src=g});(async()=>{const g=Math.min(5,e.length),x=[];for(let l=0;l<g;l++){const j=(s+l)%e.length;x.push(w(e[j]))}await Promise.all(x)})()},[e,s,c,b]),d.useEffect(()=>{if(e.length===0||e.length===1)return;const w=()=>{m.current=window.setInterval(()=>{r(g=>(g+1)%e.length),R(g=>g+1)},n)},f=window.setTimeout(w,2e3);return()=>{window.clearTimeout(f),m.current&&(window.clearInterval(m.current),m.current=null)}},[e.length,n]),d.useEffect(()=>()=>{m.current&&(window.clearInterval(m.current),m.current=null)},[]);const $=e[s]||"",S=v.has($)||U.current.has($),k=c.has($);return d.useEffect(()=>{if(k&&e.length>1&&!e.every(f=>c.has(f))){const f=(s+1)%e.length;r(f),R(g=>g+1)}},[k,s,e.length,e,c]),e.length===0?null:p.jsxs("div",{className:C("image-slideshow-container",t),"aria-hidden":!0,children:[p.jsx("div",{className:"image-slideshow-fallback"}),!b&&e.length>0&&p.jsx("div",{className:"loading-message",children:i("loadingImages")}),S&&!k&&p.jsx("div",{className:"image-slideshow-slide",style:{backgroundImage:`url(${$})`,animationDuration:`${n}ms`,"--zoom-scale":o}},a)]})}function M(e){return e.replace(/&amp;/g,"&")}const H=["r.jina.ai","api.allorigins.win/get?url=","corsproxy.io/?"],te=(e,t=0)=>{const n=H[t];if(n==="api.allorigins.win/get?url=")return`https://${n}${encodeURIComponent(e)}`;if(n==="corsproxy.io/?")return`https://${n}${encodeURIComponent(e)}`;const o=e.replace(/^https?:\/\//,""),i=e.startsWith("https://")?"https":"http";return`https://${n}/${i}://${o}`};async function ne(e,t,n){var o,i,s,r,a,R,v,h,c,u,b;const I=new Set;let m=null;const U=[k=>`https://www.reddit.com/r/${e}/top.json?limit=100&t=year&raw_json=1${k?`&after=${k}`:""}`,k=>`https://www.reddit.com/r/${e}/hot.json?limit=100&raw_json=1${k?`&after=${k}`:""}`],$=async k=>{try{const w=await fetch(k,{signal:n,credentials:"omit",mode:"cors",headers:{"User-Agent":"BlitzedOut/1.0",Accept:"application/json, text/plain, */*","Accept-Language":"en-US,en;q=0.9"}});if(w.ok){const f=await w.text();try{return JSON.parse(f)}catch(g){const x=f.indexOf("{"),l=f.lastIndexOf("}");if(x!==-1&&l!==-1&&l>x)try{return JSON.parse(f.slice(x,l+1))}catch(j){return null}return null}}}catch(w){if(w instanceof DOMException&&w.name==="AbortError")throw w}for(let w=0;w<H.length;w++)try{const f=await fetch(te(k,w),{signal:n,credentials:"omit",mode:"cors",headers:{"User-Agent":"BlitzedOut/1.0",Accept:"application/json, text/plain, */*"}});if(!f.ok)continue;const g=await f.text();let x;try{const l=JSON.parse(g);x=l.contents?JSON.parse(l.contents):l}catch(l){const j=g.indexOf("{"),_=g.lastIndexOf("}");if(j!==-1&&_!==-1&&_>j)try{x=JSON.parse(g.slice(j,_+1))}catch(N){continue}else continue}if(x)return x}catch(f){if(f instanceof DOMException&&f.name==="AbortError")throw f;continue}return null};let S=0;for(;I.size<t&&S<U.length;){m=null;for(let k=0;k<5&&I.size<t;k+=1){const w=U[S](m),f=await $(w);if(!f)break;const g=(i=(o=f==null?void 0:f.data)==null?void 0:o.children)!=null?i:[];m=(r=(s=f==null?void 0:f.data)==null?void 0:s.after)!=null?r:null;for(const x of g){const l=x==null?void 0:x.data;if(!l)continue;const j=l.url_overridden_by_dest,_=l.post_hint;if(l.is_gallery&&l.media_metadata&&l.gallery_data){const A=l.gallery_data.items||[];for(const V of A){const E=l.media_metadata[V.media_id],T=((a=E==null?void 0:E.s)==null?void 0:a.u)||((R=E==null?void 0:E.s)==null?void 0:R.gif)||((v=E==null?void 0:E.s)==null?void 0:v.mp4);if(typeof T=="string"){const F=T.startsWith("http")?T:`https:${T}`;/\.(jpe?g|png|gif|webp)(\?.*)?$/i.test(F)&&I.add(M(F))}}continue}if(_==="image"&&typeof j=="string"&&/\.(jpe?g|png|gif|webp)(\?.*)?$/i.test(j)){I.add(M(j));continue}const N=(b=(u=(c=(h=l.preview)==null?void 0:h.images)==null?void 0:c[0])==null?void 0:u.source)==null?void 0:b.url;if(N){const A=N.startsWith("http")?N:`https:${N}`;I.add(M(A))}}if(!m)break}S+=1}return Array.from(I).slice(0,t)}async function oe(e,t){const n=e.maxImages||150;return{images:await ne(e.subreddit,n,t),source:`r/${e.subreddit}`}}function Z(e){try{const t=new URL(e);return/(^|\.)reddit\.com$/i.test(t.hostname)&&/\/r\//i.test(t.pathname)}catch(t){return!1}}function re(e){var t;try{const o=new URL(e).pathname.match(/\/r\/([^/]+)/i);return(t=o==null?void 0:o[1])!=null?t:null}catch(n){return null}}const ie=3e5,B=new Map,z=new Map;async function se(e,t){const n=JSON.stringify(e),o=Date.now(),i=B.get(n);if(i&&o-i.fetchedAt<ie)return i.result;const s=z.get(n);if(s)try{return await s}catch(a){}const r=oe(e,t).then(a=>(B.set(n,{fetchedAt:Date.now(),result:a}),a)).finally(()=>{z.delete(n)});return z.set(n,r),r}function ae(e){const{t}=D(),[n,o]=d.useState([]),[i,s]=d.useState(!1),[r,a]=d.useState(null),[R,v]=d.useState(null),h=d.useRef(null),c=d.useRef(null),u=d.useRef(null);return d.useEffect(()=>{if(h.current&&h.current.abort(),c.current&&(clearTimeout(c.current),c.current=null),u.current&&(clearTimeout(u.current),u.current=null),o([]),a(null),v(null),!e||!Z(e)){s(!1);return}const b=re(e);if(!b){a("invalidRedditUrl"),s(!1);return}const I={subreddit:b,maxImages:150};s(!0);const m=new AbortController;h.current=m;const U=async($=0)=>{try{const S=await se(I,m.signal);if(m.signal.aborted)return;o(S.images),v(S.source),a(null),s(!1)}catch(S){if(m.signal.aborted)return;if($<2){const w=Math.pow(2,$)*1e3;u.current=setTimeout(()=>{m.signal.aborted||U($+1)},w);return}a("redditBlocked"),o([]),v(null),s(!1)}};return c.current=setTimeout(U,300),()=>{m.abort(),c.current&&(clearTimeout(c.current),c.current=null),u.current&&(clearTimeout(u.current),u.current=null)}},[e]),d.useEffect(()=>()=>{h.current&&h.current.abort(),c.current&&(clearTimeout(c.current),c.current=null),u.current&&(clearTimeout(u.current),u.current=null)},[]),{images:n,isLoading:i,error:r?t(r):null,source:R}}function ce({url:e}){const{t}=D(),n=W(),{images:o,isLoading:i,error:s}=ae(e);return i?p.jsxs("div",{className:"slideshow-container slideshow-loading","aria-hidden":!0,children:[p.jsx("div",{className:"image-slideshow-fallback"}),p.jsx("div",{className:"loading-message",children:t("loadingRedditImages")})]}):s?p.jsxs("div",{className:"slideshow-container slideshow-error","aria-hidden":!0,children:[p.jsx("div",{className:"image-slideshow-fallback"}),p.jsxs("div",{className:"error-message",style:{position:"absolute",bottom:"20px",right:"20px",background:J(n.palette.background.paper,.7),color:n.palette.text.primary,padding:"12px 16px",borderRadius:"8px",fontSize:"14px",maxWidth:"300px",zIndex:1e3},children:[p.jsx("strong",{children:t("redditBackgroundNote")}),p.jsx("br",{}),t("redditBlocked")]})]}):o.length===0?p.jsx("div",{className:"slideshow-container slideshow-empty","aria-hidden":!0,children:p.jsx("div",{className:"image-slideshow-fallback"})}):p.jsx(ee,{images:o})}function Te({url:e=null,isVideo:t=null}){const n=e&&/\.(mp4|webm|ogg|mov|gif)(\?.*)?$/i.test(e),o=e?Z(e):!1,i=e==="color"||e==="gray"||(e==null?void 0:e.includes("/color"))||(e==null?void 0:e.includes("/gray")),s=e&&!i&&(t||!t&&e),r=!t&&o&&e;return p.jsxs(K,{className:C("main-container",!s&&"default-background"),role:"presentation",sx:{backgroundImage:!t&&e&&!i&&!o?`url(${e})`:"none"},children:[t&&!o&&(n?p.jsx(Q,{url:e}):p.jsx("iframe",{src:e||void 0,title:"video",width:"100%",height:"100%",allow:"autoplay; fullscreen; encrypted-media; picture-in-picture",sandbox:"allow-same-origin allow-scripts allow-presentation",style:{border:"none"}})),r?p.jsx(ce,{url:e}):null]})}function de(e){const t=/vimeo\.com\/(\d+)/,n=e.match(t);return`https://player.vimeo.com/video/${n?n[1]:""}?autoplay=1&loop=1&autostart=true`}function le(e){const t=/(?:youtube\.com\/(?:[^/]+\/.+\/|(?:v|e(?:mbed)?)\/|[^#]*[?&]v=|youtu\.be\/)([^"&?/ ]{11})|^(?:[^"&?/ ]{11})$)/,n=e.match(t);return`https://www.youtube.com/embed/${n?n[1]:""}?autoplay=1&loop=1&autostart=true&mute=1&playsinline=1&controls=0&disablekb=1&fs=0&modestbranding=1&rel=0&iv_load_policy=3`}function ue(e){const t=/drive\.google\.com\/file\/d\/([^/]+)/,n=e.match(t);return`https://drive.google.com/file/d/${n?n[1]:""}/preview?loop=1`}function me(e){const t=/dropbox\.com\/s\/([^/]+)/,n=e.match(t);return`https://www.dropbox.com/s/${n?n[1]:""}?raw=1`}function fe(e){return`https://pornhub.com/embed/${new URL(e).searchParams.get("viewkey")||""}?autoplay=1&loop=1&autostart=true&playsinline=1`}function pe(e){const t=e.split("-");return`https://xhamster.com/xembed.php?video=${t[t.length-1]}?autoplay=1&loop=1&autostart=true&playsinline=1`}function ge(e){const t=/media1?\.tenor\.com\/(?:m\/)?([a-zA-Z0-9_-]+)\/[^/]*\.(mp4|gif|webp|webm)/,n=e.match(t);if(n){const s=n[2].toLowerCase();return{url:e,isVideo:["mp4","webm"].includes(s)}}const o=/tenor\.com\/view\/[^/]*-(\d+)/,i=e.match(o);return i?{url:`https://tenor.com/embed/${i[1]}`,isVideo:!0}:{url:e,isVideo:!1}}function he(e){const t=/giphy\.com\/gifs\/[^/]*-([a-zA-Z0-9]+)/,n=e.match(t);return`https://media.giphy.com/media/${n?n[1]:""}/giphy.gif`}function be(e){return/\d+\.media\.tumblr\.com\/.*\.(gif|mp4|webm)(\?.*)?$/i.test(e),e}function we(e){const t=/(?:gfycat\.com|redgifs\.com)\/(?:watch\/)?([a-zA-Z0-9]+)/,n=e.match(t),o=n?n[1]:"";return y(e,["redgifs.com"])?`https://files.redgifs.com/${o}.mp4`:`https://giant.gfycat.com/${o}.mp4`}function ye(e){const t=/redtube\.com\/(\d+)/,n=e.match(t);return`https://embed.redtube.com/?id=${n?n[1]:""}&autoplay=true&auto_play=1&playsinline=1&controls=1`}function xe(e){const t=/youporn\.com\/watch\/(\d+)/,n=e.match(t);return`https://www.youporn.com/embed/${n?n[1]:""}?autoplay=1&playsinline=1`}function ve(e){const t=/tube8\.com\/[^/]+\/[^/]+\/(\d+)/,n=e.match(t);return`https://www.tube8.com/embed/${n?n[1]:""}?autoplay=1&playsinline=1`}function Ie(e){return`https://twitframe.com/show?url=${encodeURIComponent(e)}`}function Re(e){try{const r=new URL(e);if((r.host==="discordapp.net"||r.host.endsWith(".discordapp.net"))&&r.pathname.startsWith("/external/")&&(r.pathname.includes("/https/i.imgur.com/")||r.pathname.includes("/https/imgur.com/")))return e}catch(r){L.debug("URL parsing failed for Discord proxy check:",r)}try{const r=new URL(e);if(r.host==="i.imgur.com"&&(r.search||r.pathname.match(/\.[a-zA-Z0-9]+$/)))return e}catch(r){L.debug("URL parsing failed for direct link check:",r)}let t="",n=!1;try{const r=new URL(e);n=r.host==="imgur.com"||r.host==="i.imgur.com"}catch(r){return L.debug("URL parsing failed for Imgur processing:",r),""}if(!n)return"";if(e.includes("/gallery/")){const r=e.match(/imgur\.com\/gallery\/[^#]*#([a-zA-Z0-9]+)/);if(r)t=r[1];else{const a=e.match(/imgur\.com\/gallery\/.*-([a-zA-Z0-9]+)/);if(a)t=a[1];else return L.debug("Could not extract image ID from gallery URL, returning original:",e),e}}else{const r=/imgur\.com\/([a-zA-Z0-9]+)(?:\.(mp4|mov|avi|webm|mkv|flv|wmv|jpg|jpeg|png|gif|gifv|webp|bmp|tiff|svg))?|images-ext-\d+\.discordapp\.net\/external\/[^/]+\/https\/i\.imgur\.com\/([a-zA-Z0-9]+)\.(mp4|mov|avi|webm|mkv|flv|wmv|jpg|jpeg|png|gif|gifv|webp|bmp|tiff|svg)/,a=e.match(r);t=a?a[1]||a[3]:""}if(!t)return"";const o=e.match(/\.([a-zA-Z0-9]+)(?:\?.*)?$/);let i="jpg";if(o&&o[1]){let r=o[1].toLowerCase();const a={gifv:"mp4"};a[r]&&(r=a[r]),["jpg","jpeg","png","gif","webp","mp4","mov","avi","webm","mkv","flv","wmv","bmp","tiff","svg"].includes(r)&&(i=r)}return`https://i.imgur.com/${t}.${i}`}function P(e){return/\.(mp4|webm|ogg|mov)(\?.*)?$/.test(e)}function ke(e){return y(e,["media.discordapp.net","cdn.discordapp.com"])&&!P(e)}function y(e,t){try{const n=new URL(e);return t.some(o=>n.host===o||n.host.endsWith("."+o))}catch(n){return L.debug("URL parsing failed in isValidHost, rejecting for security:",n),!1}}function $e(e){let t=null,n=!0;if(!e)return{url:"",isVideo:!1};switch(!0){case y(e,["vimeo.com"]):t=de(e);break;case y(e,["youtube.com","youtu.be"]):t=le(e);break;case y(e,["drive.google.com"]):t=ue(e);break;case y(e,["pornhub.com"]):t=fe(e);break;case y(e,["xhamster.com"]):t=pe(e);break;case y(e,["dropbox.com"]):t=me(e);break;case y(e,["imgur.com","i.imgur.com"]):t=Re(e);break;case y(e,["tenor.com"]):{const o=ge(e);t=o.url,n=o.isVideo;break}case y(e,["giphy.com"]):t=he(e),n=!0;break;case(y(e,["tumblr.com","media.tumblr.com"])||/\d+\.media\.tumblr\.com/.test(e)):t=be(e),n=t?P(t):!1;break;case y(e,["gfycat.com","redgifs.com"]):t=we(e),n=!0;break;case y(e,["redtube.com"]):t=ye(e);break;case y(e,["youporn.com"]):t=xe(e);break;case y(e,["tube8.com"]):t=ve(e);break;case y(e,["twitter.com","x.com"]):t=Ie(e),n=!1;break;case y(e,["thisvid.com"]):t=e;break;case y(e,["boyfriendtv.com"]):t=e;break;case ke(e):t=e,n=!1;break;case P(e):t=e;break;default:t=Y(e),n=!1;break}return{url:t,isVideo:n}}function Ae(e,t){const{background:n,backgroundURL:o,roomBackgroundURL:i}=e;let s=null;return n?n==="custom"?s=o||null:n==="useRoomBackground"?!q(t)&&i?s=i:s="color":s=n:s="color",s||(s="color"),s==="color"||s==="gray"?{url:s,isVideo:!1}:$e(s)}function je(e){return{uid:e.uid,displayName:e.displayName,isSelf:e.isSelf,isFinished:e.isFinished}}function Me(e){const[t,n]=d.useState(null),o=X(),i=d.useMemo(()=>o.map(r=>`${r.uid}-${r.displayName}-${r.isFinished}-${r.isSelf}`).join("|"),[o]),s=d.useMemo(()=>e?`${e.uid}-${e.displayName||""}`:null,[e]);return d.useEffect(()=>{if(!e){n(null);return}if(o.length<=1){n(null);return}const r=o.filter(c=>!c.isFinished);if(r.length<=1){n(null);return}let a=-1;a=r.findIndex(c=>c.uid===e.uid),a===-1&&(a=r.findIndex(c=>c.displayName===e.displayName)),a===-1&&(a=0);const R=(a+1)%r.length,v=r[R],h=je(v);n(h)},[s,i]),t}export{Te as R,Ae as g,$e as p,Me as u};
//# sourceMappingURL=chunk-_0lUQytc.js.map
