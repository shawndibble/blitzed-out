import{a as f}from"./chunk-BfMAFFX0.js";(function(){var n=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};n.SENTRY_RELEASE={id:"b0aec1b7336667c3da787da9b7139ec106644213"}})();try{(function(){var n=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},a=new n.Error().stack;a&&(n._sentryDebugIds=n._sentryDebugIds||{},n._sentryDebugIds[a]="57d7891c-4465-49b5-b677-2f5510f023ee",n._sentryDebugIdIdentifier="sentry-dbid-57d7891c-4465-49b5-b677-2f5510f023ee")})()}catch{}const l=50,g=f((n,a)=>({onlineUsers:{},loading:!1,error:null,room:null,_performanceMetrics:{lastUpdateTime:Date.now(),updateCount:0,averageUpdateInterval:0},_pendingUpdates:{},_batchTimeout:null,setUsers:e=>{const t=Date.now();n(r=>{const o=t-r._performanceMetrics.lastUpdateTime,s=r._performanceMetrics.updateCount+1,i=(r._performanceMetrics.averageUpdateInterval*r._performanceMetrics.updateCount+o)/s;return{onlineUsers:e,loading:!1,error:null,_performanceMetrics:{lastUpdateTime:t,updateCount:s,averageUpdateInterval:i}}})},addUser:(e,t)=>{const r=a();r._pendingUpdates[e]=t,r._batchTimeout&&clearTimeout(r._batchTimeout);const o=setTimeout(()=>{r.flushPendingUpdates()},l);n({_batchTimeout:o})},removeUser:e=>{const t=a();t._pendingUpdates[e]=null,t._batchTimeout&&clearTimeout(t._batchTimeout);const r=setTimeout(()=>{t.flushPendingUpdates()},l);n({_batchTimeout:r})},batchUpdateUsers:e=>n(t=>{const r={...t.onlineUsers};Object.entries(e).forEach(([d,c])=>{if(c===null){const{[d]:U,...p}=r;Object.assign(r,p)}else r[d]=c});const o=Date.now(),s=o-t._performanceMetrics.lastUpdateTime,i=t._performanceMetrics.updateCount+1,u=(t._performanceMetrics.averageUpdateInterval*t._performanceMetrics.updateCount+s)/i;return{onlineUsers:r,_performanceMetrics:{lastUpdateTime:o,updateCount:i,averageUpdateInterval:u}}}),flushPendingUpdates:()=>{const e=a();Object.keys(e._pendingUpdates).length!==0&&(e.batchUpdateUsers(e._pendingUpdates),n(()=>({_pendingUpdates:{}})))},clearUsers:()=>n(()=>({onlineUsers:{},loading:!1,error:null,_pendingUpdates:{}})),setLoading:e=>n(()=>({loading:e})),setError:e=>n(()=>({error:e,loading:!1})),setRoom:e=>n(()=>({room:e})),getUsersByRoom:e=>{const t=a();return t.onlineUsers},getActiveUserCount:()=>{const e=a();return Object.keys(e.onlineUsers).length},getPerformanceMetrics:()=>a()._performanceMetrics}));export{g as u};
//# sourceMappingURL=chunk-BjQhdd70.js.map
