const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["js/syncOrchestrator.ts-SiG2KnyC.js","js/chunk-CRTEX306.js","js/chunk-3WZ0_FKg.js","js/chunk-8SCryGlh.js","js/chunk-BasRj4HO.js","js/chunk-C1r5CZhq.js","assets/index-7hT8f8fS.js","assets/index-DKbdyQom.css"])))=>i.map(i=>d[i]);
!function(){try{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{}).SENTRY_RELEASE={id:"78e5865df29dcd4e7e626167d5570a228ede4ae8"}}catch(t){}}();try{(e=(new(t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{}).Error).stack)&&(t._sentryDebugIds=t._sentryDebugIds||{},t._sentryDebugIds[e]="3858f869-8ea6-4cca-90e5-81200c0b6707",t._sentryDebugIdIdentifier="sentry-dbid-3858f869-8ea6-4cca-90e5-81200c0b6707")}catch(t){}var t,e;import{m as n,I as s,_ as a,x as r}from"./chunk-CRTEX306.js";import{a as i,b as c,d as o,u,e as d}from"../assets/index-7hT8f8fS.js";import{f as l,d as f,g as w,b as h,N as y}from"./chunk-BasRj4HO.js";import"./chunk-3WZ0_FKg.js";import"./chunk-8SCryGlh.js";import"./chunk-C1r5CZhq.js";const g=w(),m=d;async function p(){try{const t=await i({}),e=new Map;t.forEach(t=>{const n=`${t.group_id}|${t.intensity}|${t.action}`;e.has(n)||e.set(n,[]),e.get(n).push(t)});for(const[,n]of e)if(n.length>1){n.sort((t,e)=>(t.id||0)-(e.id||0));const t=n[0],e=n.slice(1),s=e.some(t=>0===t.isEnabled);for(const n of e)n.id&&await o(n.id);s&&1===t.isEnabled&&await u(t.id,{isEnabled:0})}return!0}catch(t){return!1}}async function b(){try{const t=(await n({isDefault:!1})).map(t=>r(t.id));return await Promise.all(t),!0}catch(t){return!1}}async function E(){try{const t=(await i({isCustom:0,isEnabled:0})).filter(t=>t.id).map(t=>u(t.id,{isEnabled:1}));return await Promise.all(t),!0}catch(t){return!1}}async function _(t){try{const e=await i({isCustom:0}),n=new Map;e.forEach(t=>{const e=`${t.group_id}|${t.intensity}|${t.action}`;n.set(e,t.id)});const s=[];return t.forEach(t=>{const e=`${t.group_id}|${t.intensity}|${t.action}`,a=n.get(e);a&&s.push(u(a,{isEnabled:0}))}),await Promise.all(s),!0}catch(e){return!1}}async function D(){const t=l().currentUser;if(!t)return!1;try{const e=await i({isCustom:1}),n=await i({isCustom:0,isEnabled:0}),s=100;return n.length>s&&n.splice(s),await y(f(g,"user-data",t.uid),{customTiles:e,disabledDefaults:n,lastUpdated:new Date},{merge:!0}),!0}catch(e){return!1}}async function $(){const t=l().currentUser;if(!t)return!1;try{const e=await n({isDefault:!1});return await y(f(g,"user-data",t.uid),{customGroups:e,lastUpdated:new Date},{merge:!0}),!0}catch(e){return!1}}async function U(){const t=l().currentUser;if(!t)return!1;try{const e=await c();return!e.length||(await y(f(g,"user-data",t.uid),{gameBoards:e,lastUpdated:new Date},{merge:!0}),!0)}catch(e){return!1}}async function j(){const t=l().currentUser;if(!t)return!1;try{const{settings:e}=s.getState(),{localPlayers:n,...a}=e,r=Object.fromEntries(Object.entries(a).filter(([,t])=>void 0!==t));return await y(f(g,"user-data",t.uid),{settings:r,lastUpdated:new Date},{merge:!0}),!0}catch(e){return!1}}async function I(){return await D(),await $(),await U(),await j(),!0}async function T(){const t=l().currentUser;if(!t)return{success:!1,conflicts:["No user logged in"]};try{const e=f(g,"user-data",t.uid),s=await h(e),a=await i({isCustom:1}),r=await n({isDefault:!1}),c=[];if(!s.exists())return await I(),{success:!0};const o=s.data(),u=o.customTiles||[],d=o.customGroups||[];return a.length>0&&u.length>0&&c.push(`Custom tiles: Local has ${a.length}, Firebase has ${u.length}`),r.length>0&&d.length>0&&c.push(`Custom groups: Local has ${r.length}, Firebase has ${d.length}`),c.length>0?{success:!1,conflicts:c}:{success:await C()}}catch(e){return{success:!1,conflicts:["Sync failed due to error"]}}}async function C(t={}){const{SyncOrchestrator:e}=await a(async()=>{const{SyncOrchestrator:t}=await import("./syncOrchestrator.ts-SiG2KnyC.js");return{SyncOrchestrator:t}},__vite__mapDeps([0,1,2,3,4,5,6,7]));return await e.syncFromFirebase(t)}let O=null;function S(t=5){k();const e=60*t*1e3;return O=window.setInterval(async()=>{const t=l();t.currentUser&&!t.currentUser.isAnonymous&&await C()},e),!0}function k(){return!!O&&(window.clearInterval(O),O=null,!0)}window.cleanupTiles=p;export{_ as applyDisabledDefaults,p as cleanupDuplicateTiles,b as clearUserCustomGroups,m as deleteAllCustomTiles,T as intelligentSync,E as resetDisabledDefaults,S as startPeriodicSync,k as stopPeriodicSync,I as syncAllDataToFirebase,$ as syncCustomGroupsToFirebase,D as syncCustomTilesToFirebase,C as syncDataFromFirebase,U as syncGameBoardsToFirebase,j as syncSettingsToFirebase};
//# sourceMappingURL=syncService.ts-B_cKh97-.js.map
