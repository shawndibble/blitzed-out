const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["js/chunk-1vD5DhKt.js","js/chunk-CfN-ANIX.js"])))=>i.map(i=>d[i]);
import{j as t,a6 as K,a7 as F,F as N,B as P,T as _,D as L,i as V}from"./chunk-Vuzv59E5.js";import{r as l,a as g}from"./chunk-CfN-ANIX.js";import{C as W}from"./chunk-DRmAB0Tz.js";import{u as H,C as J,G as q,s as z}from"./chunk-D2uAZ6cE.js";import{c as I,e as Q}from"./chunk-Bp62TkGl.js";import{u as B,_ as U,p as X,j as $}from"../assets/index-NXMOp5SB.js";import{T as D}from"./chunk-C3rktb3S.js";import{u as Y}from"./chunk-DwDV8mEA.js";import{t as Z}from"./chunk-DQ5s95rP.js";import{u as ee}from"./chunk-Cx3PWYtd.js";import{u as te}from"./chunk-DXy1pfJx.js";import{u as se}from"./chunk-BohQZKjk.js";import"./chunk-CuMUTfgR.js";import"./chunk-6JIRnTv3.js";import"./chunk-Bde8qXua.js";import"./chunk-CwKBHVCv.js";import"./chunk-BgYdbRXR.js";import"./chunk-DOYo4UL0.js";import"./chunk-D0hPV1-j.js";import"./chunk-B4PEA_xj.js";import"./chunk-PTntF1Bg.js";const ae=e=>({position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",maxWidth:800,bgcolor:"background.paper",border:"2px solid #000",boxShadow:24,p:4,[e.breakpoints.down("sm")]:{width:"90%"}});function oe({open:e,text:s="",displayName:a="",handleClose:n,stopAutoClose:d=()=>null,nextPlayer:i=null,isMyMessage:p=!1}){const{t:f}=B(),[M,b]=l.useState(!1),S=s?.match(/#\d*:.*(?=\n)/gs),T=I(s)||"",v=Q(s,f("seconds")),{timeLeft:x,togglePause:m}=H(20,!1),[r,j]=l.useState(!0),C=i?.displayName,c=l.useCallback(()=>{m(),d(),j(!1)},[m,d,j]),o=l.useCallback(()=>{c(),b(!0)},[c]),k=l.useCallback(()=>{b(!1)},[]);return t.jsxs("div",{children:[t.jsx(K,{"aria-labelledby":"transition-modal-title","aria-describedby":"transition-modal-description",open:e,onClose:n,slots:{backdrop:F},slotProps:{backdrop:{timeout:500}},children:t.jsx(N,{in:e,children:t.jsxs(P,{sx:ae,children:[t.jsx(_,{id:"transition-modal-title",variant:"h6",component:"h2",children:`${S} ${f("for")} ${a}`}),t.jsx(W,{close:n}),t.jsx(_,{id:"transition-modal-description",variant:"h4",sx:{mt:2},children:T}),t.jsx("br",{}),t.jsx(_,{variant:"caption",children:r?t.jsx(D,{i18nKey:"autoCloseModal",values:{timeLeft:x}}):t.jsx(D,{i18nKey:"autoCloseStopped"})}),t.jsx("br",{}),v?.length&&t.jsxs(t.Fragment,{children:[t.jsx(D,{i18nKey:"timers"}),v.map(h=>t.jsx(J,{textString:h,preventParentClose:c},h))]}),!!i&&t.jsxs(P,{textAlign:"center",children:[t.jsx(L,{style:{margin:"1rem 0 0.5rem"}}),t.jsx(_,{variant:"body1",children:i.isSelf?t.jsx(D,{i18nKey:"yourTurn"}):t.jsx(D,{i18nKey:"nextPlayersTurn",values:{player:C}})})]}),!!p&&s.includes(f("finish"))&&t.jsxs(P,{textAlign:"center",children:[t.jsx(L,{style:{margin:"1rem 0 0.5rem"}}),t.jsx(V,{onClick:o,children:t.jsx(_,{children:f("playAgain")})})]})]})})}),t.jsx(q,{isOpen:M,close:k})]})}const ne="/audio/roll-dice-DysgIh_A.mp3",re="/audio/message-CBVROrdp.mp3";function R(){return R=Object.assign?Object.assign.bind():function(e){for(var s=1;s<arguments.length;s++){var a=arguments[s];for(var n in a)({}).hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},R.apply(null,arguments)}function ie(e,s){if(e==null)return{};var a={};for(var n in e)if({}.hasOwnProperty.call(e,n)){if(s.indexOf(n)!==-1)continue;a[n]=e[n]}return a}function ue(e){l.useEffect(e,[])}var le=["id","volume","playbackRate","soundEnabled","interrupt","onload"];function G(e,s){var a={},n=a.volume,d=n===void 0?1:n,i=a.playbackRate,p=i===void 0?1:i,f=a.soundEnabled,M=f===void 0?!0:f,b=a.interrupt,S=b===void 0?!1:b,T=a.onload,v=ie(a,le),x=g.useRef(null),m=g.useRef(!1),r=g.useState(null),j=r[0],C=r[1],c=g.useState(null),o=c[0],k=c[1],h=function(){typeof T=="function"&&T.call(this),m.current&&C(this.duration()*1e3),k(this)};ue(function(){return U(()=>import("./chunk-1vD5DhKt.js").then(u=>u.h),__vite__mapDeps([0,1])).then(function(u){if(!m.current){var E;x.current=(E=u.Howl)!==null&&E!==void 0?E:u.default.Howl,m.current=!0,new x.current(R({src:Array.isArray(e)?e:[e],volume:d,rate:p,onload:h},v))}}),function(){m.current=!1}}),g.useEffect(function(){x.current&&o&&k(new x.current(R({src:Array.isArray(e)?e:[e],volume:d,onload:h},v)))},[JSON.stringify(e)]),g.useEffect(function(){o&&(o.volume(d),v.sprite||o.rate(p))},[o,d,p]);var O=g.useCallback(function(u){typeof u>"u"&&(u={}),!(!o||!M&&!u.forceSoundEnabled)&&(S&&o.stop(),u.playbackRate&&o.rate(u.playbackRate),o.play(u.id))},[o,M,S]),w=g.useCallback(function(u){o&&o.stop(u)},[o]),y=g.useCallback(function(u){o&&o.pause(u)},[o]),A=[O,{sound:o,stop:w,pause:y,duration:j}];return A}async function ce(e,s){try{await Z.speak(e,s,-2)}catch(a){console.error("TTS failed:",a)}}function de(){const{i18n:e}=B(),{user:s}=ee(),{messages:a}=te(),[n,d]=l.useState(!1),[i]=G(ne),[p]=G(re),[f]=Y(),{playerDialog:M,othersDialog:b,mySound:S,otherSound:T,chatSound:v,readRoll:x,voicePreference:m}=f||{},r=l.useMemo(()=>[...a].pop(),[a]),j=l.useCallback(async y=>{if(y)try{await ce(y,m)}catch(A){console.error("Failed to speak text:",A)}},[m]),C=l.useMemo(()=>{if(!r?.timestamp)return!1;const y=X(r.timestamp);return y?$(y).diff($(),"seconds")>=-2:!1},[r]),c=l.useMemo(()=>r?.uid===s?.uid,[r,s]),o=!!(M&&c),k=!!(b&&!c),h=(c&&S||!c&&T)&&r?.type==="actions",O=c&&x&&r?.type==="actions",w=v&&r?.type==="chat";return l.useEffect(()=>{if(z(e.resolvedLanguage||e.language),C&&r?.type==="actions"&&(o||k)&&d(r),C&&r){if(h&&i(),O){const y=I(r?.text);j(y)}w&&p()}},[e.resolvedLanguage,e.language,r,c,o,k,h,O,w,i,p,j,C]),{message:n,setMessage:d,isMyMessage:!!c}}const Ee=()=>{const{t:e}=B(),{message:s,setMessage:a,isMyMessage:n}=de(),d=se(s),i=l.useRef(void 0);l.useEffect(()=>(s&&(i.current=setTimeout(()=>a(!1),21e3)),()=>{i.current&&clearTimeout(i.current)}),[s,a]);const p=l.useCallback(()=>{i.current&&clearTimeout(i.current),a(!1)},[a]),f=l.useCallback(()=>{i.current&&clearTimeout(i.current)},[]);return!s||typeof s!="object"||!s.text||s.text.includes(e("start"))?null:t.jsx(oe,{text:s?.text,displayName:s?.displayName,open:!0,handleClose:p,stopAutoClose:f,nextPlayer:d,isMyMessage:n})};export{Ee as default};
