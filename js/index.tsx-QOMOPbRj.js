const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["js/index.tsx-CEnKVdFn.js","js/chunk-N4nyP3yz.js","js/chunk-BHSFqGHu.js","js/chunk-CadZxfdX.js","js/chunk-Bp62TkGl.js","js/chunk-By-oDuIf.js","js/chunk-BpB-XA3T.js","js/chunk-D_9T5wBr.js","assets/index-BER_zc5T.js","js/chunk-Bde8qXua.js","js/chunk-C27ee37V.js","js/chunk-IQBevIgc.js","js/chunk-CNgNUes7.js","js/chunk-D6tD9Wwo.js","js/chunk-DazuHQxB.js","js/chunk-CZROAdFX.js","js/chunk-DbLlg4nu.js","js/chunk-B4PEA_xj.js","js/index.tsx-BlfupDtQ.js","js/chunk-CwHqZEwd.js","js/chunk-DLz9Y0sc.js","js/chunk-Cu7_z1PM.js","js/index.tsx-BCTM9mYT.js","js/chunk-Dec7HA67.js"])))=>i.map(i=>d[i]);
import{a as _,b as ee,s as te,c as se,i as ne,g as re,d as oe,u as ae,t as B,_ as G,e as ie}from"../assets/index-BER_zc5T.js";import{j as t,e as A,A as le,P as ue,l as ce,m as me,n as de,M as fe,o as pe,p as ge,q as he,s as xe,B as L,t as je,S as be,T as z,i as I,v as V,I as Se,w as ye,x as Te,y as Re,C as Ce}from"./chunk-N4nyP3yz.js";import Me from"./index.tsx-DPV4x7Pi.js";import Ne from"./index.tsx-dvc7LsAO.js";import{g as ve,R as De}from"./chunk-Bz-4QXvr.js";import{T as W}from"./chunk-BpB-XA3T.js";import{u as $}from"./chunk-IQBevIgc.js";import{u as q}from"./chunk-DbLlg4nu.js";import{u as Be}from"./chunk-DWPmPthG.js";import{r as n,m as ke,u as Ae}from"./chunk-BHSFqGHu.js";import{T as J,u as w}from"./chunk-D_9T5wBr.js";import we from"./index.tsx-WNBqmLB9.js";import{u as F}from"./chunk-C27ee37V.js";import{a as Le}from"./chunk-Dec7HA67.js";import{u as Ee}from"./chunk-PurwGftr.js";import{u as Ie,s as Pe}from"./chunk-By-oDuIf.js";import{u as H}from"./chunk-D6tD9Wwo.js";import{i as E,a as Q}from"./chunk-Bp62TkGl.js";import{u as Oe}from"./chunk-DazuHQxB.js";import{N as K}from"./chunk-BzS7F8Tt.js";import{u as _e}from"./chunk-CwHqZEwd.js";import"./chunk-Bde8qXua.js";import"./chunk-CadZxfdX.js";import"./chunk-DLz9Y0sc.js";import"./chunk-B4PEA_xj.js";import"./chunk-CNgNUes7.js";import"./chunk-CZROAdFX.js";function Ge(){const{messages:l}=q(),[o,u]=n.useState(!1),r=_(l,"actions"),s=ee(l),c=Be(r),{playerDialog:a,othersDialog:f}=$()[0];if(n.useEffect(()=>{!c||s!==r||u(!0)},[c,s,r]),!r||!c)return null;const d=c?.isSelf;return!f&&d||!a&&!d?t.jsx(W,{open:o,close:()=>u(!1),type:d?"error":"info",vertical:"top",horizontal:"center",disableAutoHide:!0,children:d?t.jsx(J,{i18nKey:"yourTurn"}):t.jsx(J,{i18nKey:"playersTurn",values:{player:c.displayName}})}):null}function $e(l){const o=l.filter(s=>s).map(s=>s.split(": ")),u=[];o.forEach((s,c)=>{if(Number(s[1])===0)return;const a=Array(Number(s[1])).fill(c);u.push(...a)});const r=u[Math.floor(Math.random()*u.length)];return o.map(([s])=>s)[r]?.replace(/(\r\n|\n|\r)/gm,"")||""}function Fe(l,o,u){if(!l)return"";const r=l.split("%");return r.length<=1?Le(l,o||"",u||""):$e(r)}function Ue(l,o,u=[]){const{user:r}=F(),{t:s}=w(),c=Ee(),a=u.length,[f,d]=n.useState(u[0]||{}),p=a-1,h=n.useRef(0),S=n.useCallback((m,x,j,e)=>{if(!m){console.error("Tile not found at location:",j);return}let i="";const C=Fe(m.description||"",m.role||"",r?.displayName||"");x!==-1&&(i+=`${s("roll")}: ${x}
`),i+=`#${j+1}: ${m.title||s("unknownTile")}
`,i+=`${s("action")}: ${C}`,te({room:l,user:r,text:e?e+i:i,type:"actions"})},[l,r,s]),g=n.useCallback(m=>{if(m===-1)return{preMessage:`${s("restartingGame")}
`,newLocation:0};const x=c.find(e=>e.isSelf)?.location||0;if(x===p)return{preMessage:`${s("alreadyFinished")}
`,newLocation:m};const j=m+x;return j>=p?{newLocation:p}:{newLocation:j}},[s,c,p]);return n.useEffect(()=>{const m=Array.isArray(o.value)?o.value[0]:o.value,x=o.time;if(m===0||x<=h.current)return;h.current=x;const{preMessage:j,newLocation:e}=g(m);e>=0&&e<u.length&&u[e]?(d({...u[e],index:e}),S(u[e],m,e,j)):console.error(`Invalid location or missing tile: ${e}, gameBoard length: ${u.length}`)},[o,u,S,g]),{tile:f,playerList:c}}function ze(l,o){const{user:{displayName:u}}=F(),[r,s]=n.useState(null),[c,a]=n.useState(u||"");n.useEffect(()=>{(r!==l||u!==c)&&(se({newRoom:l,oldRoom:r,newDisplayName:u||"",oldDisplayName:c,removeOnDisconnect:o||l?.toUpperCase()==="PUBLIC"}),s(l),a(u||""))},[l,u,r,c,o])}function Ve(l,o){const{i18n:r,t:s}=w(),{user:c}=F(),[a,f]=$(),d=H(()=>re(a?.gameMode)),{messages:p,isLoading:h}=q(),[S,g]=n.useState("1d6"),[m,x]=n.useState(""),j=Ie(),e=n.useRef(!1),i=n.useCallback(async(b,N=null)=>{if(!e.current){e.current=!0;try{const{gameMode:T,newBoard:M}=await j(b),R={formData:{...a,...b},user:c,customTiles:d,actionsList:await ne(r.resolvedLanguage,T||"online"),tiles:M,title:s("settingsGenerated")};N&&(R.reason=s("rebuiltBoard",{messageUser:N})),await Pe(R)}finally{setTimeout(()=>{e.current=!1},500)}}},[a,c,d,r.resolvedLanguage,s,j]),C=n.useCallback(async()=>{a?.room!==l&&(await f({...a,room:l}),await i({...a,roomUpdated:!0,room:l}))},[a,l,f,i]);return n.useEffect(()=>{if(!(h||!p.length))try{const b=_(p,"room");if(b){const N=JSON.parse(b.settings),{roomDice:T,roomBackgroundURL:M,roomTileCount:R}=N;let D="1d6";!E(l)&&T&&(D=T),g(D),x(M||""),b.uid!==c?.uid&&R&&o?.length&&R!==o?.length&&!e.current&&i(N,b.displayName)}}catch(b){console.error("Error processing room message:",b)}},[p,h,l,c,o,i]),n.useEffect(()=>{if(!h)try{const b=_(p,"room");if(b||!E(l)&&!b||E(l)&&!Q(a?.gameMode||""))return;if(l!==a?.room&&o?.length&&!e.current){C();return}a?.roomBackgroundURL?.length&&x(a.roomBackgroundURL)}catch(b){console.error("Error in room change effect:",b)}},[l,a,o,p,h,C]),{roller:S,roomBgUrl:m}}function Je(l,o){const[u,r]=n.useState(null),[s,c]=ke(),a=s.get("importBoard"),{t:f}=w(),d=n.useCallback(()=>{r(null)},[]),p=n.useCallback(g=>{try{const m=JSON.parse(g);return Array.isArray(m)?m:null}catch{return null}},[]),h=n.useCallback(g=>{try{return g?JSON.parse(g):{}}catch{return{}}},[]),S=n.useCallback(async()=>{if(c({}),!a)return;const g=await oe(a);if(!g?.gameBoard)return r(f("failedBoardImport"));const m=p(g.gameBoard);if(!m)return r(f("failedBoardImport"));const x=g?.title!==f("settingsGenerated")?g.title:f("importedBoard");ae({...g,title:x,tiles:m,isActive:1});const j=h(g?.settings);o({...l,...j}),u!==f("updated")&&r(f("updated"))},[a,p,h,l,o,f,u,c]);return n.useEffect(()=>{a&&S()},[a,S]),[u,d]}const Ke=({selectedRoll:l,handleMenuItemClick:o})=>{const[u,r]=n.useState(!1),s=n.useRef(null),c=()=>{r(d=>!d)},a=d=>{d.target instanceof Node&&s.current?.contains(d.target)||r(!1)},f=new Map;return f.set("restart",B("restart")).set("manual",B("manual")).set("30",B("auto30")).set("60",B("auto60")).set("90",B("auto90")).set("custom",B("setTimer")),t.jsxs(t.Fragment,{children:[t.jsx(A,{size:"small","aria-controls":u?"split-button-menu":void 0,"aria-expanded":u?"true":void 0,"aria-label":"select roll options","aria-haspopup":"menu",onClick:c,ref:s,children:t.jsx(le,{})}),t.jsx(ue,{sx:{zIndex:1},open:u,anchorEl:s.current,transition:!0,disablePortal:!0,placement:"top-end",children:({TransitionProps:d})=>t.jsx(ce,{...d,style:{transformOrigin:"right bottom"},children:t.jsx(me,{children:t.jsx(de,{onClickAway:a,children:t.jsx(fe,{id:"split-button-menu",autoFocusItem:!0,children:Array.from(f).map(([p,h])=>t.jsx(pe,{selected:p===l,onClick:()=>o(p),children:h},p))})})})})})]})},k=10,We=({isOpen:l,onClose:o,onSubmit:u})=>{const{t:r}=w(),[s,c]=n.useState(30),[a,f]=n.useState(!1),[d,p]=n.useState(!1),[h,S]=n.useState(20),[g,m]=n.useState(60),x=()=>{if(d){let e=Number.parseInt(String(h),10),i=Number.parseInt(String(g),10);Number.isNaN(e)?(e=a?1:k,S(e)):!a&&e<k&&(e=k),Number.isNaN(i)||i<e?(i=e,m(i)):i===0&&(i=180,m(i)),a&&(e*=60,i*=60);const C=Math.floor(Math.random()*(i-e+1))+e;u(C,{isRange:!0,min:e,max:i})}else{let e=Number.parseInt(String(s),10);Number.isNaN(e)?(e=a?1:k,c(e)):a?e*=60:e<k&&(e=k),u(e,{isRange:!1})}o()},j=()=>{c(e=>{const i=Number.parseFloat(String(e));return Number.isNaN(i)||i<=0?e:a?(i*60).toString():(i/60).toString()}),S(e=>{const i=Number.parseFloat(String(e));return Number.isNaN(i)||i<=0?e:a?(i*60).toString():(i/60).toString()}),m(e=>{const i=Number.parseFloat(String(e));return Number.isNaN(i)||i<=0?e:a?(i*60).toString():(i/60).toString()}),f(e=>!e)};return t.jsxs(ge,{open:l,onClose:o,maxWidth:"xs",children:[t.jsx(he,{children:r("setTimer")}),t.jsxs(xe,{children:[t.jsx(L,{sx:{mb:2},children:t.jsx(je,{control:t.jsx(be,{checked:d,onChange:e=>p(e.target.checked)}),label:r("useRandomRange")})}),d?t.jsxs(L,{children:[t.jsx(z,{variant:"subtitle2",children:r("randomTimerRange")}),t.jsxs(L,{sx:{display:"flex",gap:2,my:2},children:[t.jsx(I,{label:r("minValue"),type:"number",value:h,onChange:e=>{const i=parseInt(e.target.value,10);S(i)},fullWidth:!0}),t.jsx(z,{variant:"body1",sx:{alignSelf:"center"},children:"-"}),t.jsx(I,{label:r("maxValue"),type:"number",value:g,onChange:e=>{const i=parseInt(e.target.value,10);m(Math.max(Number(h),i))},fullWidth:!0})]}),t.jsxs(A,{onClick:j,variant:"outlined",size:"small",children:[r(a?"minutes":"seconds"),t.jsx(V,{sx:{ml:1}})]})]}):t.jsx(I,{autoFocus:!0,type:"number",value:s,onChange:e=>c(e.target.value),sx:{width:"15rem"},slotProps:{input:{endAdornment:t.jsx(Se,{position:"end",children:t.jsxs(A,{onClick:j,variant:"text",children:[r(a?"minutes":"seconds"),t.jsx(V,{sx:{ml:1}})]})})}}})]}),t.jsxs(ye,{children:[t.jsx(A,{onClick:o,children:r("cancel")}),t.jsx(A,{onClick:x,children:r("set")})]})]})};function qe(l){return/^-?\d+$/.test(String(l))}function P(l,o,u){let r=0;for(let s=0;s<Number(l);s+=1)r+=Math.floor(Math.random()*Number(o))+1;u(r)}const He=n.memo(function({setRollValue:o,dice:u,isEndOfBoard:r}){const{t:s}=w(),[c,a]=n.useState(!1),[f,d]=n.useState("manual"),[p,h]=n.useState(0),[S,g]=n.useState(s("roll")),{timeLeft:m,setTimeLeft:x,togglePause:j,isPaused:e}=_e(p),[i,C]=n.useState(!1),[b,N]=n.useState({isRange:!1,min:30,max:120}),T=n.useCallback(y=>{o(y)},[o]),[M,R]=u.split("d"),D=()=>{if(f==="manual"){P(M,R,T),a(!0),setTimeout(()=>a(!1),4e3);return}e&&m===p&&P(M,R,T),j()},U=n.useCallback(y=>{if(y==="restart"){T(-1);return}if(d(String(y)),y==="custom"){C(!0);return}if(qe(y)){e||j();const v=Number(y);h(v),x(v)}},[e,x,j,T]),Y=()=>{C(!1)},X=(y,v={isRange:!1})=>{e||j(),h(y),x(y),N({...b,...v}),d("custom"),C(!1)};return n.useEffect(()=>{r&&j()},[r,j]),n.useEffect(()=>{if(c)g(s("wait"));else if(f==="manual")g(s("roll"));else if(e)g(`${s("play")} (${m})`);else if(m>0)g(`${s("pause")} (${m})`);else if(m===0&&!e&&f!=="manual"){P(M,R,T);let y;if(b.isRange){const{min:v,max:Z}=b;y=Math.floor(Math.random()*(Z-v+1))+v}else y=p;h(y),x(y),g(`${s("pause")} (${y})`)}},[c,f,m,e,p,b,s,M,R,T,x]),t.jsxs(t.Fragment,{children:[t.jsxs(Te,{variant:"contained",className:"dice-roller",children:[t.jsxs(A,{"aria-label":s("roll"),onClick:D,disabled:c,size:"large",children:[t.jsx(Re,{sx:{mr:1}}),S]}),t.jsx(Ke,{selectedRoll:f,handleMenuItemClick:U})]}),t.jsx(We,{isOpen:i,onClose:Y,onSubmit:X})]})}),Qe=n.lazy(()=>G(()=>import("./index.tsx-CEnKVdFn.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17]))),Ye=n.lazy(()=>G(()=>import("./index.tsx-BlfupDtQ.js"),__vite__mapDeps([18,1,2,3,4,10,8,9,16,5,6,7,11,12,13,14,15,17,19,20,21]))),Xe=n.lazy(()=>G(()=>import("./index.tsx-BCTM9mYT.js"),__vite__mapDeps([22,1,2,3,10,8,9,23,21])));function O(){return t.jsx(L,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100px",children:t.jsx(Ce,{size:24})})}function Nt(){const l=Ae(),o=l.id||"",u=Oe(),{t:r}=w(),[s,c]=$();ze(o,s?.roomRealtime);const[a,f]=n.useState({value:0,time:0}),d=H(ie)?.tiles,p=n.useCallback(D=>{f({value:D,time:Date.now()})},[]),{playerList:h,tile:S}=Ue(o,a,d),{roller:g,roomBgUrl:m}=Ve(o,d),[x,j]=Je(s,c);if(!d||!d.length||!Object.keys(s).length||E(o)&&!Q(s.gameMode))return t.jsxs(t.Fragment,{children:[t.jsx(K,{room:l.id,playerList:h}),t.jsx(we,{open:!0})]});const{isVideo:e,url:i}=ve(s,o,m),C=e?"video-adjust":"",{background:b,roomBackground:N}=s,T=!E(o)&&N!=="app"||b!=="color",M=t.jsx(n.Suspense,{fallback:t.jsx(O,{}),children:t.jsx(Xe,{playerList:h,isTransparent:T,gameBoard:d,settings:s})}),R=t.jsx("div",{className:"messages-container",children:t.jsxs(n.Suspense,{fallback:t.jsx(O,{}),children:[t.jsx(Ye,{room:o,isTransparent:T,currentGameBoardSize:d.length}),t.jsx(Me,{room:o,isTransparent:T})]})});return t.jsxs(t.Fragment,{children:[t.jsx(K,{room:o,playerList:h}),t.jsx(He,{setRollValue:p,dice:g,isEndOfBoard:S?.index!==void 0&&S.index>=(d?.length??0)-1}),t.jsx(De,{isVideo:e,url:i}),t.jsx(Ge,{}),u?t.jsx(n.Suspense,{fallback:t.jsx(O,{}),children:t.jsx(Qe,{tab1:M,tab2:R})}):t.jsxs(L,{className:`desktop-container ${C}`,children:[M,R]}),t.jsx(Ne,{}),t.jsx(W,{type:x===r("updated")?"success":"error",open:!!x,close:j,children:x})]})}export{Nt as default};
