import{u as O,r as o,q as S,v as D,j as e,t as B,x as A,M as z,L as K}from"./chunk-DDoLnHI0.js";import{i as F,e as Q,b as v}from"./chunk-Bp62TkGl.js";import{u as U}from"./chunk-CXIw3Iqt.js";import{u as W}from"./chunk-CrCBoQmf.js";import{a as q,s as H}from"./chunk-8ZYOspRI.js";import{u as V}from"./chunk-BmcVylZL.js";import{a as X,f as Y,i as Z,g as J,e as ee,h as se}from"../assets/index-BodytYbc.js";import{h as te,c as ae}from"./chunk-CoPHbQIg.js";import{O as ie,Q as ne,R as oe,D as w,B as y,U as L,T as I,h as re,V as b,W as le,X as ce,Y as M}from"./chunk-D59Sa5ya.js";import{C as me,G as de}from"./chunk-4GWdBvrH.js";import{T as ue}from"./chunk-JjknM9L9.js";import{C as R}from"./chunk-Ds_NjC-1.js";import{Z as xe,$ as ge}from"./chunk-CtIAsvv6.js";import"./chunk-BDM5WtNj.js";import"./chunk-B0nG6Nel.js";import"./chunk-BICGdz9x.js";import"./chunk-BFzXl2Wc.js";import"./chunk-Dk7I1tJi.js";import"./chunk-B4PEA_xj.js";import"./chunk-CbUvEgHM.js";import"./chunk-COViFSNc.js";import"./chunk-bqvoNmJe.js";function pe(s,t,d,n){if(!s&&t===40)return!0;if(!d)return!1;const{roomTileCount:r}=d;return t!==r?!1:t===n}function fe(s,t,d){const{id:n}=O(),[r,i]=o.useState(!1),{i18n:u}=S(),[a]=V(),h=D(()=>J(a?.gameMode)),l=D(ee),g=o.useCallback(async()=>{if(!a||d||r||!l?.tiles?.length||n===void 0)return;const x=!F(n||""),m={...a,room:n},p=X(t,"room");x&&!p&&await q(m,s),i(!0);const c=pe(x,l.tiles.length,p,a.roomTileCount);if(!Y(t,f=>f.type==="settings"&&f.uid===s.uid)&&c){const f=await Z(u.resolvedLanguage,a.gameMode);await H({formData:m,user:s,customTiles:h,actionsList:f,tiles:l.tiles,title:l.title})}},[l,h,u.resolvedLanguage,d,t,n,a,r,s]);o.useEffect(()=>{g()},[g])}function he({room:s,id:t}){return e.jsx(ie,{title:e.jsx(B,{i18nKey:"delete"}),children:e.jsx(ne,{onClick:()=>se(s,t),"aria-label":"delete",color:"error",size:"small",sx:{p:0,ml:1},children:e.jsx(oe,{fontSize:"inherit"})})})}function je({text:s}){const{t}=S();return o.useMemo(()=>{const n=Q(s,t("seconds"));let r=s;return n?.forEach(i=>{i&&(r=A(r,i,(u,a)=>e.jsx(me,{textString:i,preventParentClose:()=>null,noPadding:!0},u+a)))}),A(r,`
`,(i,u)=>e.jsx("br",{},`br${u}`))},[s,t])}const ye=o.memo(je),$=6e4;function be({message:s,isOwnMessage:t,isTransparent:d,currentGameBoardSize:n=40,room:r}){const{t:i}=S(),[u,a]=o.useState(!1),h=o.useCallback(()=>{a(!1)},[]),{id:l,displayName:g,text:x,uid:m,timestamp:p,type:c}=s;let C,f,T;if(c==="settings"||c==="room"){const j=s;C=j.boardSize,f=j.gameBoardId}c==="media"&&(T=s.image);const E=c==="settings"&&C===n,P=o.useMemo(()=>{const j=p?.toDate();if(!j)return"";const _=new Date(Math.floor(j.getTime()/$)*$);let k=te(_).fromNow();return k==="in a few seconds"&&(k="a few seconds ago"),k},[p]),N=o.useMemo(()=>c!=="media"||!T?!1:T,[c,T]),G=o.useMemo(()=>c==="actions"||!x||x.trim()===""?null:e.jsx(z,{remarkPlugins:[xe,ge],children:x}),[x,c]);return e.jsxs("li",{className:ae("message",t&&"own-message",d&&"transparent"),"data-testid":`message-${l}`,children:[e.jsxs("div",{className:"message-header",children:[e.jsxs("div",{className:"sender",children:[e.jsx(ue,{uid:m,displayName:g,size:"small"}),g]}),e.jsxs("div",{className:"timestamp",children:[P,!!t&&["media","chat"].includes(c)&&l&&e.jsx(he,{room:r,id:l})]})]}),e.jsx(w,{sx:{mb:1}}),e.jsxs("div",{className:"message-message",children:[c==="actions"?e.jsx(ye,{text:x}):G,!!N&&e.jsx("img",{src:N,alt:"uploaded by user"}),c==="settings"&&e.jsxs(e.Fragment,{children:[e.jsx(w,{sx:{my:.5}}),E?e.jsxs(y,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[e.jsx(K,{to:`?importBoard=${f}`,children:e.jsx(B,{i18nKey:"importBoard"})}),e.jsx(R,{text:`${window.location.href}?importBoard=${f}`,copiedText:i("copiedLink"),icon:e.jsx(L,{})})]}):e.jsx(B,{i18nKey:"incompatibleBoard"})]}),c==="room"&&e.jsxs(y,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[e.jsxs(I,{variant:"subtitle1",children:[i("room"),": ",e.jsx("a",{href:window.location.href,children:r})]}),e.jsx(R,{text:window.location.href,copiedText:i("copiedLink"),icon:e.jsx(L,{})})]}),x.includes(i("finish"))&&t&&e.jsxs(y,{textAlign:"center",children:[e.jsx(w,{sx:{mt:1}}),e.jsx(re,{onClick:()=>a(!0),children:e.jsx(I,{children:i("playAgain")})}),e.jsx(de,{isOpen:u,close:h})]})]})]})}function Te({count:s=3}){return e.jsx(e.Fragment,{children:Array.from({length:s},(t,d)=>e.jsxs("li",{style:{padding:"16px",listStyle:"none"},children:[e.jsxs(y,{display:"flex",alignItems:"center",gap:1,mb:1,children:[e.jsx(b,{variant:"circular",width:32,height:32}),e.jsx(b,{variant:"text",width:120,height:20}),e.jsx(y,{flexGrow:1}),e.jsx(b,{variant:"text",width:80,height:16})]}),e.jsx(w,{sx:{mb:1}}),e.jsxs(y,{ml:5,children:[e.jsx(b,{variant:"text",width:"90%",height:20}),e.jsx(b,{variant:"text",width:"70%",height:20})]})]},`skeleton-${d}`))})}function Qe({room:s,isTransparent:t,currentGameBoardSize:d=40}){const n=o.useRef(null),{user:r}=U(),{messages:i,isLoading:u}=W();fe(r,i,u);const[a,h]=o.useState(0),{t:l}=S(),g=o.useMemo(()=>i.filter(m=>a===1?["settings","room"].includes(m.type):a===2?["chat","media"].includes(m.type):a===3?m.type==="actions":!0),[i,a]);o.useLayoutEffect(()=>{n.current&&(n.current.scrollTop=n.current.scrollHeight)},[g.length]);const x=o.useCallback((m,p)=>{h(p)},[]);return e.jsxs("div",{className:"message-list-container",children:[e.jsx(le,{position:"sticky",children:e.jsxs(ce,{variant:"fullWidth",value:a,onChange:x,"aria-label":"chat filter",className:"message-tabs",children:[e.jsx(M,{label:l("all"),...v("all")}),e.jsx(M,{label:l("setting"),...v("settings")}),e.jsx(M,{label:l("chat"),...v("chat")}),e.jsx(M,{label:l("actions"),...v("actions")})]})}),e.jsx("div",{className:"message-list-scroll",ref:n,children:e.jsx("div",{className:"message-list-scroll-content",children:e.jsx("ul",{className:"message-list",children:u&&g.length===0?e.jsx(Te,{count:5}):g.map(m=>{const p=m.uid===r.uid;return e.jsx(be,{message:m,isOwnMessage:p,isTransparent:t,currentGameBoardSize:d,room:s},m.id)})})})})]})}export{Qe as default};
