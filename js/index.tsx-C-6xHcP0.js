import{r,ad as P,au as S,j as e,am as p,ao as j,T as f,Q as V,ar as _,a1 as D}from"./chunk-u7ZaklyY.js";import{p as q,u as z,R as B}from"./chunk-C7FGIcMV.js";import{T as O}from"./chunk-EGvb8o6m.js";import{g as K}from"./chunk-D4nXmTaT.js";import{l as L}from"./chunk-DWzmHgJq.js";import{l as Y}from"./chunk-CaZ9lMwi.js";import{b as G}from"./chunk-C9_0996G.js";import"./chunk-C1hnJ-He.js";import"./chunk-6vR-ehJY.js";import"./chunk-Co28FzxB.js";import"./chunk-TwlrgFmp.js";import"./chunk-oPiDCeK5.js";import"./chunk-DjaG2sW1.js";import"../assets/index-CVlHkNKo.js";import"./chunk-Bgbo4R2z.js";(function(){var t=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};t.SENTRY_RELEASE={id:"b0aec1b7336667c3da787da9b7139ec106644213"}})();try{(function(){var t=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},a=new t.Error().stack;a&&(t._sentryDebugIds=t._sentryDebugIds||{},t._sentryDebugIds[a]="e1e7a143-7b1d-44b2-82de-bf161c8f2563",t._sentryDebugIdIdentifier="sentry-dbid-e1e7a143-7b1d-44b2-82de-bf161c8f2563")})()}catch{}function J(){const[t,a]=r.useState(document.fullscreenElement!=null);r.useEffect(()=>{const s=()=>{a(document.fullscreenElement!=null)};return document.addEventListener("fullscreenchange",s),()=>{document.removeEventListener("fullscreenchange",s)}},[]);const i=r.useCallback(()=>{document.fullscreenElement==null?document.documentElement.requestFullscreen().catch(s=>{console.error("Error attempting to enable fullscreen:",s)}):document.exitFullscreen().catch(s=>{console.error("Error attempting to exit fullscreen:",s)})},[]);return{isFullscreen:t,toggleFullscreen:i}}function Q(t){const a=L(t,"room");let i=!1,s="";if(a){let n,l;try{const b=JSON.parse(a.settings||"{}");n=b.roomBackground,l=b.roomBackgroundURL}catch{}let g=null;n==="custom"&&l?g=l:n&&n!=="useAppBackground"?g=n:l&&(g=l);const u=q(g);i=!!u.isVideo,u.url&&(s=u.url)}return["color","gray"].some(n=>s.includes(n))&&(s=""),{isVideo:i,url:s}}const H="actions",W=t=>{const{text:a,displayName:i}=t;if(!i)return{};const s=a?.split(`
`),[n,l]=s?.slice(1)||[],g=n?.split(":")[1]?.trim(),u=l?.split(":")[1]?.trim();return{displayName:i,type:g,activity:u}};function fe(){const{id:t}=P(),[a,i]=r.useState(""),[s,n]=r.useState(!1),[l,g]=r.useState(!1),[u,b]=r.useState(!1),{messages:h,isLoading:C}=G(),{isVideo:x,url:o}=Q(h),E=L(h,H),T=z(E),{isFullscreen:F,toggleFullscreen:$}=J();r.useEffect(()=>{K().currentUser||Y("Cast Viewer").catch(m=>{console.error("Anonymous login failed:",m)})},[t]),r.useEffect(()=>{if(!x||!o)return;const d=()=>{const N=document.querySelectorAll("video"),w=document.querySelectorAll("iframe");N.forEach(c=>{c.paused&&(c.muted=!0,c.play().catch(y=>{console.log("Video autoplay attempt failed:",y),b(!0)}))}),w.forEach(c=>{if(c.src)try{const y=new URL(c.src,window.location.origin),v=y.searchParams;let I=!1;v.get("autoplay")!=="1"&&(v.set("autoplay","1"),I=!0),v.get("mute")!=="1"&&(v.set("mute","1"),I=!0),I&&(y.search=v.toString(),c.src=y.toString())}catch{if(!c.src.includes("autoplay=1")){const y=c.src.includes("?")?"&":"?";c.src+=`${y}autoplay=1&mute=1`}}})},m=setTimeout(d,500),A=setTimeout(d,2e3);return()=>{clearTimeout(m),clearTimeout(A)}},[x,o,h.length]),r.useEffect(()=>{const d=window.cast?.framework?.CastReceiverContext,m=navigator.userAgent,A=m.includes("CrKey")||m.includes("TV"),N=window.self!==window.top,w=d||A||window.location.search.includes("chromecast")||window.location.search.includes("receiver");return w&&(document.body.classList.add("cast-receiver-mode"),document.body.classList.remove("theme-light"),g(!0)),N&&document.body.classList.add("in-iframe"),()=>{w&&document.body.classList.remove("cast-receiver-mode"),N&&document.body.classList.remove("in-iframe")}},[]),r.useEffect(()=>{if(C)return;const d=h[h.length-1];d?.type==="settings"&&(n(!0),i(`${d.displayName} ${S("changedSettings")}`))},[h,C]);const R=()=>{document.querySelectorAll("video").forEach(m=>{m.paused&&m.play().catch(console.error)}),b(!1)};if(!E)return e.jsxs(p,{className:"flex-column cast-main-container",style:{backgroundImage:!x&&o?`url(${o})`:"none"},children:[!!o&&e.jsx(B,{url:o,isVideo:x}),u&&e.jsx(p,{onClick:R,className:"user-interaction-overlay",children:"Click to enable autoplay"}),e.jsx(j,{container:!0,spacing:0,direction:"column",alignItems:"center",justifyContent:"center",className:"cast-container cast-grid-container",children:e.jsx(j,{container:!0,justifyContent:"center",children:e.jsxs("div",{className:"action-box-large responsive-cast-box",children:[e.jsxs(f,{variant:"h2",className:"cast-title",children:["blitzedout.com/",t]}),C?e.jsx(f,{variant:"h4",className:"cast-loading-text",children:"Connecting to game..."}):e.jsx(f,{variant:"h4",className:"cast-ready-text",children:"Ready for game to start"})]})})})]});const{displayName:U,type:M,activity:k}=W(E);return e.jsxs(p,{className:"flex-column cast-main-container",onClick:u?R:void 0,style:{backgroundImage:!x&&o?`url(${o})`:"none",cursor:u?"pointer":"default"},children:[!!o&&e.jsx(B,{url:o,isVideo:x}),e.jsxs(p,{display:"flex",justifyContent:"space-between",className:"cast-header-bar",children:[e.jsx(p,{flex:"1",children:!l&&!F&&e.jsx(V,{variant:"text",onClick:$,className:"cast-fullscreen-button",children:S("fullscreen")})}),e.jsx(p,{textAlign:"center",flex:"1",children:!!T?.displayName&&e.jsx(f,{variant:"h4",className:"cast-next-player",children:e.jsx(_,{i18nKey:"nextPlayersTurn",values:{player:T.displayName}})})},T?.displayName),e.jsx(p,{flex:"1",textAlign:"right",className:"text-stroke",children:k&&e.jsxs(f,{variant:"h4",className:"cast-room-url",children:["blitzedout.com/",t]})})]}),e.jsx(j,{container:!0,spacing:0,direction:"column",alignItems:"center",justifyContent:"center",className:"cast-container cast-grid-container-adjusted",children:e.jsx(j,{container:!0,justifyContent:"center",children:k?e.jsxs(j,{size:12,className:"action-box-responsive responsive-cast-box",children:[e.jsx(f,{variant:"h3",className:"cast-type-text",children:`${M} ${S("for")} ${U}`}),e.jsx(p,{className:"cast-divider",children:e.jsx(D,{})}),e.jsx(f,{variant:"h1",className:"cast-activity-text",children:k})]}):e.jsx("div",{className:"action-box-responsive responsive-cast-box",children:e.jsxs(f,{variant:"h1",className:"cast-room-main",children:["blitzedout.com/",t]})})})},h.length),e.jsx(O,{open:!!s,close:()=>n(!1),hideCloseButton:!0,children:e.jsx(f,{variant:"h5",className:"cast-alert-text",children:a})})]})}export{fe as default};
//# sourceMappingURL=index.tsx-C-6xHcP0.js.map
