import{r,ad as $,au as E,j as e,am as h,ao as f,T as c,Q as P,ar as V,a1 as H}from"./chunk-BCLv-HyH.js";import{T as M}from"./chunk-SJIi4_E6.js";import{l as R}from"./chunk-CBEFxxIs.js";import{b as W}from"./chunk-Bbs4woUe.js";import{p as U,u as q,R as z}from"./chunk-Ped7Pw5V.js";import{l as O}from"./chunk-Bh7ETpNb.js";import{g as D}from"./chunk-B4ipE-Yx.js";import"./chunk-C5tDN2aE.js";import"./chunk-BqpKB5_W.js";import"../assets/index-LdsB_Vh_.js";import"./chunk-BBKbBimA.js";import"./chunk-B4PEA_xj.js";import"./chunk-yLOK5aTh.js";import"./chunk-XpVQE2X7.js";import"./chunk-Ch6HdZfs.js";function K(s){const l=R(s,"room");let n=!1,t="";if(l){const{roomBackgroundURL:m}=JSON.parse(l.settings),u=U(m);u?.isVideo&&(n=u.isVideo),u?.url&&(t=u.url)}return["color","gray"].some(m=>t.includes(m))&&(t=""),{isVideo:n,url:t}}function G(){const[s,l]=r.useState(document.fullscreenElement!=null);r.useEffect(()=>{const t=()=>{l(document.fullscreenElement!=null)};return document.addEventListener("fullscreenchange",t),()=>{document.removeEventListener("fullscreenchange",t)}},[]);const n=r.useCallback(()=>{document.fullscreenElement==null?document.documentElement.requestFullscreen().catch(t=>{console.error("Error attempting to enable fullscreen:",t)}):document.exitFullscreen().catch(t=>{console.error("Error attempting to exit fullscreen:",t)})},[]);return{isFullscreen:s,toggleFullscreen:n}}const J="actions",Q=s=>{const{text:l,displayName:n}=s;if(!n)return{};const t=l?.split(`
`),[m,u]=t?.slice(1)||[],b=m?.split(":")[1]?.trim(),g=u?.split(":")[1]?.trim();return{displayName:n,type:b,activity:g}};function ue(){const{id:s}=$(),[l,n]=r.useState(""),[t,m]=r.useState(!1),[u,b]=r.useState(!1),[g,N]=r.useState(!1),{messages:p,isLoading:w}=W(),{isVideo:x,url:o}=K(p),j=R(p,J),S=q(j),{isFullscreen:I,toggleFullscreen:B}=G();r.useEffect(()=>{D().currentUser||O("Cast Viewer").catch(i=>{console.error("Anonymous login failed:",i)})},[s]),r.useEffect(()=>{if(!x||!o)return;const a=()=>{const y=document.querySelectorAll("video"),v=document.querySelectorAll("iframe");y.forEach(d=>{d.paused&&(d.muted=!0,d.play().catch(A=>{console.log("Video autoplay attempt failed:",A),N(!0)}))}),v.forEach(d=>{if(d.src&&!d.src.includes("autoplay=1")){const A=d.src.includes("?")?"&":"?";d.src+=`${A}autoplay=1&mute=1`}})},i=setTimeout(a,500),k=setTimeout(a,2e3);return()=>{clearTimeout(i),clearTimeout(k)}},[x,o,p.length]),r.useEffect(()=>{const a=window.cast?.framework?.CastReceiverContext,i=navigator.userAgent,k=i.includes("CrKey")||i.includes("TV"),y=window.self!==window.top,v=a||k||window.location.search.includes("chromecast")||window.location.search.includes("receiver");return v&&(document.body.classList.add("cast-receiver-mode"),document.body.classList.remove("theme-light"),b(!0)),y&&document.body.classList.add("in-iframe"),()=>{v&&document.body.classList.remove("cast-receiver-mode"),y&&document.body.classList.remove("in-iframe")}},[]),r.useEffect(()=>{if(w)return;const a=p[p.length-1];a?.type==="settings"&&(m(!0),n(`${a.displayName} ${E("changedSettings")}`))},[p,w]);const T=()=>{document.querySelectorAll("video").forEach(i=>{i.paused&&i.play().catch(console.error)}),N(!1)};if(!j)return e.jsxs(h,{className:"flex-column",onClick:g?T:void 0,style:{backgroundColor:"transparent",color:"white",minHeight:"100vh",backgroundImage:!x&&o?`url(${o})`:"none",backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat",cursor:g?"pointer":"default"},children:[!!o&&e.jsx(z,{url:o,isVideo:x}),e.jsx(f,{container:!0,spacing:0,direction:"column",alignItems:"center",justifyContent:"center",className:"cast-container",style:{minHeight:"100vh"},children:e.jsx(f,{container:!0,justifyContent:"center",children:e.jsxs("div",{className:"action-box responsive-cast-box",style:{backgroundColor:"rgba(0,0,0,0.7)",padding:"clamp(1rem, 4vw, 4rem)",borderRadius:"clamp(0.5rem, 1vw, 1rem)",textAlign:"center",width:"clamp(320px, 90vw, 1400px)",margin:"0 auto"},children:[e.jsxs(c,{variant:"h2",style:{color:"white",textShadow:"2px 2px 4px rgba(0,0,0,0.8)",marginBottom:"1rem",fontSize:"clamp(1.5rem, 6vw, 4rem)"},children:["blitzedout.com/",s]}),w?e.jsx(c,{variant:"h4",style:{color:"#90CAF9",textShadow:"1px 1px 2px rgba(0,0,0,0.8)",fontSize:"clamp(1rem, 4vw, 2.5rem)"},children:"Connecting to game..."}):e.jsx(c,{variant:"h4",style:{color:"#A5D6A7",textShadow:"1px 1px 2px rgba(0,0,0,0.8)",fontSize:"clamp(1rem, 4vw, 2.5rem)"},children:"Ready for game to start"})]})})})]});const{displayName:F,type:L,activity:C}=Q(j);return e.jsxs(h,{className:"flex-column",onClick:g?T:void 0,style:{backgroundColor:"transparent",color:"white",minHeight:"100vh",backgroundImage:!x&&o?`url(${o})`:"none",backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat",cursor:g?"pointer":"default"},children:[!!o&&e.jsx(z,{url:o,isVideo:x}),e.jsxs(h,{display:"flex",justifyContent:"space-between",sx:{mx:2,mt:2,mb:-2},children:[e.jsx(h,{flex:"1",children:!u&&!I&&e.jsx(P,{variant:"text",onClick:B,style:{color:"white"},children:E("fullscreen")})}),e.jsx(h,{textAlign:"center",flex:"1",children:!!S?.displayName&&e.jsx(c,{variant:"h4",style:{color:"white",textShadow:"2px 2px 4px rgba(0,0,0,0.8)",fontSize:"clamp(1rem, 3vw, 2rem)"},children:e.jsx(V,{i18nKey:"nextPlayersTurn",values:{player:S.displayName}})})},S?.displayName),e.jsx(h,{flex:"1",textAlign:"right",className:"text-stroke",children:C&&e.jsxs(c,{variant:"h4",style:{color:"white",textShadow:"2px 2px 4px rgba(0,0,0,0.8)",fontSize:"clamp(0.8rem, 2.5vw, 1.5rem)"},children:["blitzedout.com/",s]})})]}),e.jsx(f,{container:!0,spacing:0,direction:"column",alignItems:"center",justifyContent:"center",className:"cast-container",style:{minHeight:"calc(100vh - 5rem)"},children:e.jsx(f,{container:!0,justifyContent:"center",children:C?e.jsxs(f,{size:12,className:"action-box responsive-cast-box",style:{backgroundColor:"rgba(0,0,0,0.7)",padding:"clamp(1rem, 4vw, 4rem)",borderRadius:"clamp(0.5rem, 1vw, 1rem)",maxWidth:"95vw",minWidth:"fit-content",margin:"0 auto"},children:[e.jsx(c,{variant:"h3",style:{color:"white",textShadow:"2px 2px 4px rgba(0,0,0,0.8)",fontSize:"clamp(1.2rem, 5vw, 3rem)"},children:`${L} ${E("for")} ${F}`}),e.jsx(h,{className:"divider",style:{marginTop:"-0.5rem",height:"0.5rem",backgroundColor:"white",border:"2px solid black"},children:e.jsx(H,{})}),e.jsx(c,{variant:"h1",style:{color:"white",textShadow:"2px 2px 4px rgba(0,0,0,0.8)",fontWeight:600,fontSize:"clamp(1.8rem, 8vw, 6rem)",lineHeight:1.2},children:C})]}):e.jsx("div",{className:"action-box responsive-cast-box",style:{backgroundColor:"rgba(0,0,0,0.7)",padding:"clamp(1rem, 4vw, 4rem)",borderRadius:"clamp(0.5rem, 1vw, 1rem)",maxWidth:"95vw",minWidth:"fit-content",margin:"0 auto"},children:e.jsxs(c,{variant:"h1",style:{color:"white",textShadow:"2px 2px 4px rgba(0,0,0,0.8)",fontWeight:600,fontSize:"clamp(1.8rem, 8vw, 6rem)",lineHeight:1.2},children:["blitzedout.com/",s]})})})},p.length),e.jsx(M,{open:!!t,close:()=>m(!1),hideCloseButton:!0,children:e.jsx(c,{variant:"h5",style:{color:"white"},children:l})})]})}export{ue as default};
