const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["js/index.tsx-D88JlLx0.js","js/chunk-CXdXj9vr.js","js/chunk-CwpkSHF3.js","js/theme.tsx-CFiEaNed.js","assets/index-D2GCO97j.js","js/chunk-B4ipE-Yx.js","js/chunk-DevrYHC1.js","js/chunk-B83tYlJb.js","js/chunk-CgSGzI2N.js","js/chunk-DRfcgs1-.js","js/chunk-B_qvgo8D.js","js/chunk-BuTqecSU.js","js/schedule.tsx-B1A1kf60.js"])))=>i.map(i=>d[i]);
var Xe=Object.defineProperty;var Ze=(e,t,r)=>t in e?Xe(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var F=(e,t,r)=>Ze(e,typeof t!="symbol"?t+"":t,r);import{A as me,_ as K}from"../assets/index-D2GCO97j.js";import{aa as re,r as A,j as T,a7 as et}from"./chunk-CXdXj9vr.js";import{g as C,E as tt,l as rt,s as nt,a as st,u as ye,c as ot,G as at,b as it,d as ct,e as ut,f as oe,h as x,i as Oe,T as lt,j as dt,k as mt,m as z,n as xe,o as ft,q as J,w as V,p as ne,r as se,t as Be,v as Le,x as gt,y as yt,z as ht,A as wt,B as pt,C as ae}from"./chunk-B4ipE-Yx.js";import{r as At,D as vt,n as qe,a as Et}from"./chunk-CwpkSHF3.js";class Y extends Error{constructor(t,r,s){super(t),this.code=r,this.cause=s,this.name="AppError"}}class H extends Y{constructor(t,r,s){super(t,r,s),this.name="AuthError"}}function Re(e){return e instanceof Y}function he(e){return e instanceof Error}function R(e){return he(e)?e.message:typeof e=="string"?e:"An unknown error occurred"}function bt(e){if(Re(e)||he(e)&&"code"in e)return e.code}function Q(e,t="An unexpected error occurred"){return Re(e)?e:he(e)?new Y(e.message||t,void 0,e):typeof e=="string"?new Y(e):new Y(t)}const Ce={"auth/user-not-found":"No account found with this email address","auth/wrong-password":"Incorrect password","auth/email-already-in-use":"An account with this email already exists","auth/weak-password":"Password is too weak","auth/invalid-email":"Invalid email address","auth/too-many-requests":"Too many login attempts. Please try again later","auth/network-request-failed":"Network error. Please check your connection","permission-denied":"You do not have permission to perform this action",unavailable:"Service is temporarily unavailable. Please try again"};function $(e){const t=bt(e);return t&&Ce[t]?Ce[t]:R(e)}var Ct=At();const Ne={apiKey:"AIzaSyCKS7tWQRYRWHsawNfN42uAmISdUbJHJJw",authDomain:"blitzout-49b39.firebaseapp.com",projectId:"blitzout-49b39",storageBucket:"blitzout-49b39.appspot.com",messagingSenderId:"852428606926",appId:"1:852428606926:web:17444e6f8dbc2f95f0ef9f",measurementId:"G-93YN1YMTQ7"},Se=Object.entries(Ne).filter(([e,t])=>!t).map(([e])=>e);Se.length>0&&(console.error("Missing Firebase environment variables:",Se),console.error("Please check your .env file and ensure all VITE_FIREBASE_* variables are set"));const St=ft(Ne),I=Oe(St);async function Tt(e=""){try{const t=C();return await ut(t),t.currentUser?(await ye(t.currentUser,{displayName:e}),t.currentUser):null}catch(t){throw console.error("Anonymous login error:",t),new H($(t),"ANONYMOUS_LOGIN_FAILED",Q(t))}}async function Dt(e,t,r=""){try{const s=C(),n=await ot(s,e,t);return await ye(n.user,{displayName:r}),n.user}catch(s){throw console.error("Registration error:",s),new H($(s),"REGISTRATION_FAILED",Q(s))}}async function _t(e,t){try{const r=C();return(await ct(r,e,t)).user}catch(r){throw console.error("Email login error:",r),new H($(r),"EMAIL_LOGIN_FAILED",Q(r))}}async function Mt(){try{const e=C(),t=new at;return(await it(e,t)).user}catch(e){throw console.error("Google login error:",e),new H($(e),"GOOGLE_LOGIN_FAILED",Q(e))}}async function It(e){try{const t=C();return await st(t,e),!0}catch(t){throw console.error("Password reset error:",t),new H($(t),"PASSWORD_RESET_FAILED",Q(t))}}async function Pt(e,t){try{const s=C().currentUser;if(s?.isAnonymous){const n=tt.credential(e,t);return(await rt(s,n)).user}else throw new Error("User is not anonymous or not logged in")}catch(r){throw console.error("Account conversion error:",r),new H($(r),"ACCOUNT_CONVERSION_FAILED",Q(r))}}async function Gt(){try{const e=C();return await nt(e),!0}catch(e){throw console.error(e),e}}function Ir(e,t,r={},s={}){if(!e)return;const{enableCache:n=!0,enableDebounce:o=!0}=s,a=e.toUpperCase(),c=pe("userList",a),i=Date.now();if(n){const u=D.get(c);if(u&&Ae(u,c)){u.queryCount++,D.set(c,u),_(c,Date.now()-i,!0);const l=Object.keys(u.data).sort().join(","),p=r?Object.keys(r).sort().join(","):"";l!==p&&t(u.data);return}}const m=async()=>{let u=!1;try{await ie();const l=ht(),p=wt(l,"users");pt(p,h=>{const E=Date.now(),d=E-i,b=h.val();if(!b){t({});return}const S={};Object.entries(b).forEach(([O,M])=>{M.room===a&&(S[O]={displayName:M.displayName,uid:O,lastSeen:M.lastSeen?new Date(M.lastSeen):new Date,isAnonymous:M.isAnonymous,joinedAt:M.joinedAt?new Date(M.joinedAt):new Date,room:M.room})});const g=S;if(n){we();const O=X(c);D.set(c,{data:g,timestamp:E,queryCount:1,priority:O})}_(c,d,!1,u);const v=Object.keys(g).sort().join(","),U=r?Object.keys(r).sort().join(","):"";v!==U&&t(g)},h=>{u=!0,console.error("getUserList error:",h),_(c,Date.now()-i,!1,!0)})}catch(l){u=!0,console.error("getUserList connection error:",l),_(c,Date.now()-i,!1,!0)}finally{ce()}};o?ve(c,m):m()}async function Ut(e=""){try{const t=C();return t.currentUser?(await ye(t.currentUser,{displayName:e}),t.currentUser):null}catch(t){return console.error(t),null}}async function Pr(e,t){try{await oe(x(I,"custom-actions"),{grouping:e,customAction:t,ttl:new Date(Date.now()+5760*60*1e3)})}catch(r){console.error(r)}}async function Ot(e){const t=J(x(I,"game-boards"),V("checksum","==",e)),r=await gt(t);return r.size?r.docs[0]:null}async function Gr({title:e,gameBoard:t,settings:r}){if(e)try{const s=Ct.sha256(t),n=await Ot(s);return n?(mt(n.ref,{ttl:new Date(Date.now()+720*60*60*1e3)}),n):await xt({title:e,gameBoard:t,settings:r,checksum:s})}catch(s){console.error(s)}}async function xt({title:e,gameBoard:t,settings:r,checksum:s}){try{return await oe(x(I,"game-boards"),{title:e,gameBoard:t,settings:r,checksum:s,ttl:new Date(Date.now()+720*60*60*1e3)})}catch(n){console.error(n);return}}async function Ur(e){try{const t=z(I,"game-boards",e),r=await xe(t);return r.exists()?r.data():void 0}catch(t){console.error(t);return}}let Te={};const D=new Map,j=new Map,De=15e3,Bt=5e3,_e=150,Lt=50,ke=50,qt=100,N={activeConnections:0,maxConnections:15,connectionQueue:[]},Me=new Map;function _(e,t,r,s=!1){const n=Me.get(e)||{queryCount:0,totalLatency:0,cacheHits:0,lastQueryTime:0,avgLatency:0,p95Latency:0,connectionPoolHits:0,networkErrors:0,latencyHistory:[]};if(n.queryCount++,n.totalLatency+=t,n.lastQueryTime=Date.now(),n.avgLatency=n.totalLatency/n.queryCount,n.latencyHistory.push(t),n.latencyHistory.length>20&&n.latencyHistory.shift(),n.latencyHistory.length>=5){const o=[...n.latencyHistory].sort((c,i)=>c-i),a=Math.floor(o.length*.95);n.p95Latency=o[a]}r&&n.cacheHits++,s&&n.networkErrors++,Me.set(e,n)}function X(e){return e.includes("messages")?"high":e.includes("userList")?"medium":"low"}function Rt(e){switch(e){case"high":return Bt;case"medium":return De;case"low":return De*2}}function Nt(e){switch(e){case"high":return Lt;case"medium":return _e;case"low":return _e*2}}function we(){if(D.size<=qt)return;const e=Array.from(D.entries());e.sort(([,r],[,s])=>{const n={low:0,medium:1,high:2},o=n[r.priority]-n[s.priority];if(o!==0)return o;const a=r.queryCount-s.queryCount;return a!==0?a:r.timestamp-s.timestamp});const t=Math.ceil(D.size*.2);for(let r=0;r<t;r++)D.delete(e[r][0])}function ie(){return new Promise(e=>{N.activeConnections<N.maxConnections?(N.activeConnections++,e()):N.connectionQueue.push(()=>{N.activeConnections++,e()})})}function ce(){if(N.activeConnections--,N.connectionQueue.length>0){const e=N.connectionQueue.shift();e&&e()}}function pe(e,t,r){return`${e}:${t||"global"}:${r||""}`}function Ae(e,t){const r=X(t),s=Rt(r);return Date.now()-e.timestamp<s}function ve(e,t,...r){const s=X(e),n=Nt(s),o=j.get(e);o&&clearTimeout(o);const a=setTimeout(async()=>{try{await ie(),t(...r)}catch(c){console.error("Query execution error:",c)}finally{ce(),j.delete(e)}},n);j.set(e,a)}async function Or({room:e,user:t,text:r="",type:s="chat",...n}){const o=["chat","actions","settings","room","media"];if(!o.includes(s)){let m="Invalid message type. Was expecting ";return m+=o.join(", "),m+=` but got ${s}`,console.error(m)}if(!t?.uid)return;const a={room:e,user:t.uid,text:r,type:s,...n};if(JSON.stringify(a)===JSON.stringify(Te))return;Te=a;const c=Date.now(),i=e?.toUpperCase()||"PUBLIC";try{return await oe(x(I,"chat-rooms",i,"messages"),{text:r.trim(),ttl:new Date(c+864e5),type:s,...n,uid:t.uid,displayName:t.displayName,timestamp:dt()})}catch(m){console.error("Failed to send message:",m);return}}async function xr(e,t){return yt(z(I,`/chat-rooms/${e.toUpperCase()}/messages/${t}`))}function Br(e,t,r={}){if(!e)return;const s=C();if(!s.currentUser){let n,o;return n=s.onAuthStateChanged(a=>{a&&(o=Ie(e,t,r),n&&(n(),n=void 0))}),()=>{n&&n(),o&&o()}}return Ie(e,t,r)}function Ie(e,t,r={}){const{limitCount:s=ke,startAfterDoc:n,enableCache:o=!0,enableDebounce:a=!0}=r,c=e.toUpperCase(),i=pe("messages",c,`limit:${s}`),m=Date.now();if(o){const l=D.get(i);if(l&&Ae(l,i))return l.queryCount++,D.set(i,l),_(i,Date.now()-m,!0),t(l.data),()=>{}}const u=()=>{let l=!1,p;try{ie();const h=new Date;h.setHours(h.getHours()-3);let E=J(x(I,"chat-rooms",c,"messages"),V("timestamp",">",h),ne("timestamp","desc"),se(s));return n&&(E=J(x(I,"chat-rooms",c,"messages"),V("timestamp",">",h),ne("timestamp","desc"),Be(n),se(s))),p=Le(E,d=>{const b=Date.now(),S=b-m,g=d.docs.map(v=>({id:v.id,...v.data()}));if(o&&g.length>0){we();const v=d.docs[d.docs.length-1],U=X(i);D.set(i,{data:g,timestamp:b,lastVisible:v,queryCount:1,priority:U})}_(i,S,!1,l),t(g)},d=>{l=!0,console.error("getMessages error:",d),_(i,Date.now()-m,!1,!0)}),p}catch(h){return l=!0,console.error("getMessages connection error:",h),_(i,Date.now()-m,!1,!0),()=>{}}finally{ce()}};if(a){let l;return ve(i,()=>{l=u()}),()=>{const p=j.get(i);p&&(clearTimeout(p),j.delete(i)),l&&l()}}return u()}function Lr(e,t={}){const{limitCount:r=ke,startAfterDoc:s,enableCache:n=!0,enableDebounce:o=!0}=t,a=pe("schedule",null,`limit:${r}`),c=Date.now();if(n){const u=D.get(a);if(u&&Ae(u,a))return u.queryCount++,D.set(a,u),_(a,Date.now()-c,!0),e(u.data),()=>{}}const i=async()=>{let u=!1,l;try{await ie();const p=new Date;p.setMinutes(p.getMinutes()-5);let h=J(x(I,"schedule"),V("dateTime",">",p),ne("dateTime","asc"),se(r));return s&&(h=J(x(I,"schedule"),V("dateTime",">",p),ne("dateTime","asc"),Be(s),se(r))),l=Le(h,E=>{const d=Date.now(),b=d-c,S=E.docs.map(g=>({id:g.id,...g.data()}));if(n&&S.length>0){we();const g=E.docs[E.docs.length-1],v=X(a);D.set(a,{data:S,timestamp:d,lastVisible:g,queryCount:1,priority:v})}_(a,b,!1,u),e(S)},E=>{u=!0,console.error("getSchedule error:",E),_(a,Date.now()-c,!1,!0)}),l||(()=>{})}catch(p){return u=!0,console.error("getSchedule connection error:",p),_(a,Date.now()-c,!1,!0),()=>{}}finally{ce()}};if(o){let u;return ve(a,async()=>{u=await i()}),()=>{const l=j.get(a);l&&(clearTimeout(l),j.delete(a)),u&&u()}}const m=i();return m instanceof Promise?()=>{}:m}async function qr(e,t,r="PUBLIC"){try{return await oe(x(I,"schedule"),{dateTime:lt.fromDate(e),url:t,room:r})}catch(s){return console.error(s)}}function kt(e={tables:["customTiles","gameBoard"]}){const{tables:t}=e,r=new Set(t),s={timeouts:{},queue:new Set,scheduleSync(n){this.timeouts[n]&&clearTimeout(this.timeouts[n]),this.queue.add(n),this.timeouts[n]=setTimeout(()=>{this.processSyncQueue()},2e3)},processSyncQueue(){if(this.queue.size===0)return;const n=window;n.authContext?.user&&!n.authContext.user.isAnonymous&&n.authContext.syncData(),this.queue.clear(),Object.keys(this.timeouts).forEach(o=>{clearTimeout(this.timeouts[o]),delete this.timeouts[o]})}};return{stack:"dbcore",name:"syncMiddleware",create(n){return{...n,table(o){const a=n.table(o);return r.has(o)?{...a,mutate:async c=>{const i=await a.mutate(c);return["put","add","delete","deleteRange","update"].includes(c.type)&&s.scheduleSync(o),i}}:a}}}}}class Ft extends vt{constructor(){super("blitzedOut");F(this,"customTiles");F(this,"gameBoard");F(this,"customGroups");F(this,"localPlayerSessions");F(this,"localPlayerMoves");F(this,"localPlayerStats");this.version(2).stores({customTiles:"++id, group, intensity, action, isEnabled, tags, gameMode, isCustom, locale",gameBoard:"++id, title, tiles, tags, gameMode, isActive"}),this.version(3).stores({customTiles:"++id, group, intensity, action, isEnabled, tags, gameMode, isCustom, locale",gameBoard:"++id, title, tiles, tags, gameMode, isActive",customGroups:"++id, name, label, locale, gameMode, isDefault, createdAt"}),this.version(4).stores({customTiles:"++id, group, intensity, action, isEnabled, tags, gameMode, isCustom, locale",gameBoard:"++id, title, tiles, tags, gameMode, isActive",customGroups:"++id, name, label, locale, gameMode, isDefault, createdAt, [name+locale+gameMode]"}).upgrade(async r=>{const s=await r.table("customGroups").toArray(),n=new Set;for(const o of s){const a=`${o.name}-${o.locale}-${o.gameMode}`;n.has(a)?await r.table("customGroups").delete(o.id):n.add(a)}}),this.version(5).stores({customTiles:"++id, group, intensity, action, isEnabled, tags, gameMode, isCustom, locale",gameBoard:"++id, title, tiles, tags, gameMode, isActive",customGroups:"++id, name, label, locale, gameMode, isDefault, createdAt, [name+locale+gameMode]",localPlayerSessions:"++id, sessionId, roomId, isActive, createdAt, updatedAt",localPlayerMoves:"++id, sessionId, playerId, timestamp, sequence",localPlayerStats:"++id, sessionId, playerId, lastActive"})}}const k=new Ft;k.use(kt({tables:["customTiles","gameBoard","customGroups","localPlayerSessions","localPlayerMoves","localPlayerStats"]}));const Rr=Object.freeze(Object.defineProperty({__proto__:null,default:k},Symbol.toStringTag,{value:"Module"})),{customTiles:G}=k;G.hook("creating",function(e,t,r){t.locale===void 0&&(t.locale="en"),t.gameMode===void 0&&(t.gameMode="online"),t.isCustom===void 0&&(t.isCustom=1)});const jt=async e=>{const t=e.map(r=>({...r,isEnabled:1}));return await G.bulkAdd(t)},Fe=e=>{const t=["locale","gameMode","group","intensity","tag","isCustom","action"];let r=G.toCollection();return Object.entries(e).filter(([n])=>t.includes(n)).forEach(([n,o])=>{o==null||o===""||(n==="tag"?r=r.filter(a=>a.tags.includes(o)):r=r.filter(a=>a[n]===o))}),r},Ee=async(e={})=>{try{return await Fe(e).toArray()}catch(t){return console.error("Error in getTiles:",t),[]}},zt=async e=>{const{page:t=1,limit:r=50}=e;try{const s=Fe(e),n=await s.count(),o=(t-1)*r;return{items:await s.offset(o).limit(r).toArray(),total:n,page:t,limit:r,totalPages:Math.ceil(n/r)}}catch(s){return console.error("Error in getPaginatedTiles:",s),{items:[],total:0,page:t,limit:r,totalPages:0}}},je=(e="en",t="online")=>G.where("locale").equals(e).and(r=>r.gameMode===t),Ht=async(e="en",t="online",r=null)=>{let s=je(e,t);return r&&(s=s.and(o=>o.tags.some(a=>r.includes(a)))),(await s.toArray()).reduce((o,a)=>{const c=a.group;o[c]||(o[c]={count:0,intensities:{}}),o[c].count++;const i=Number(a.intensity);return o[c].intensities[i]||(o[c].intensities[i]=0),o[c].intensities[i]++,o},{})},Qt=(e=null)=>{const t=re.resolvedLanguage||re.language||"en";let r=G.where("locale").equals(t).and(s=>s.isEnabled===1);return e&&(r=r.and(s=>s.gameMode===e)),r.toArray()},ze=async e=>await G.add({...e,isEnabled:1}),$t=async(e,t)=>await G.update(e,t),Wt=async e=>{const t=await G.get(e);if(!t)throw new Error(`Custom tile with id ${e} not found`);return await G.update(e,{isEnabled:t.isEnabled?0:1})};async function He(){try{return await k.customTiles.where("isCustom").equals(1).delete(),!0}catch(e){return console.error("Error deleting custom tiles:",e),!1}}const Yt=async e=>{await G.delete(e)},Qe=(e,t="en",r="online")=>je(t,r).and(s=>s.group===e),Jt=async(e,t="en",r="online")=>{try{return await Qe(e,t,r).count()}catch(s){return console.error("Error counting tiles by group:",s),0}},Vt=async(e,t="en",r="online")=>{try{return await Qe(e,t,r).delete()}catch(s){return console.error("Error deleting tiles by group:",s),0}},Nr=Object.freeze(Object.defineProperty({__proto__:null,addCustomTile:ze,countTilesByGroup:Jt,deleteAllIsCustomTiles:He,deleteCustomTile:Yt,deleteCustomTilesByGroup:Vt,getActiveTiles:Qt,getPaginatedTiles:zt,getTileCountsByGroup:Ht,getTiles:Ee,importCustomTiles:jt,toggleCustomTile:Wt,updateCustomTile:$t},Symbol.toStringTag,{value:"Module"})),{customGroups:L}=k;L.hook("creating",function(e,t,r){t.id||(t.id=qe()),t.locale===void 0&&(t.locale=re.resolvedLanguage||re.language||"en"),t.gameMode===void 0&&(t.gameMode="online"),t.isDefault===void 0&&(t.isDefault=!1);const s=new Date;t.createdAt||(t.createdAt=s),t.updatedAt=s});L.hook("updating",function(e,t,r,s){e.updatedAt=new Date});const Kt=e=>{const t=["locale","gameMode","name","isDefault"];let r=L.toCollection();return Object.entries(e).filter(([n])=>t.includes(n)).forEach(([n,o])=>{o==null||o===""||(r=r.filter(a=>a[n]===o))}),r},ue=async(e={})=>{try{return await Kt(e).toArray()}catch(t){return console.error("Error in getCustomGroups:",t),[]}},be=async(e,t="en",r="online")=>{try{return await L.where("name").equals(e).and(s=>s.locale===t&&s.gameMode===r).first()}catch(s){console.error("Error in getCustomGroupByName:",s);return}},Xt=async e=>{try{const t={...e,createdAt:new Date,updatedAt:new Date};return await L.add(t)}catch(t){console.error("Error in addCustomGroup:",t);return}},Zt=async(e,t)=>{try{return await L.update(e,t)}catch(r){return console.error("Error in updateCustomGroup:",r),0}},$e=async e=>{try{await L.delete(e)}catch(t){console.error("Error in deleteCustomGroup:",t)}},We=async()=>{try{return await L.clear(),!0}catch(e){return console.error("Error deleting all custom groups:",e),!1}},Ye=async e=>{try{const t=new Date,r=e.map(s=>({name:s.name||"",label:s.label||"",intensities:s.intensities||[],id:s.id||qe(),locale:s.locale||"en",gameMode:s.gameMode||"online",isDefault:s.isDefault||!1,createdAt:s.createdAt||t,updatedAt:s.updatedAt||t}));return await L.bulkAdd(r)}catch(t){console.error("Error in importCustomGroups:",t);return}},er=async(e,t="en",r="online")=>{try{return(await be(e,t,r))?.intensities||[]}catch(s){return console.error("Error in getGroupIntensities:",s),[]}},tr=async(e,t="en",r="online",s)=>{try{const n=await be(e,t,r);return!!(!n||s&&n.id===s)}catch(n){return console.error("Error in isGroupNameUnique:",n),!1}},Je=async(e="en",t="online")=>{try{const r=await ue({locale:e,gameMode:t}),s=new Map;r.forEach(o=>{const a=s.get(o.name)||[];a.push(o),s.set(o.name,a)});let n=0;for(const[,o]of s)if(o.length>1){o.sort((a,c)=>{try{const i=a.createdAt instanceof Date?a.createdAt.getTime():new Date(a.createdAt).getTime(),m=c.createdAt instanceof Date?c.createdAt.getTime():new Date(c.createdAt).getTime();return i-m}catch(i){return console.warn("Date parsing failed in removeDuplicateGroups, using createdAt fallback:",i),a.createdAt.getTime()-c.createdAt.getTime()}});for(let a=1;a<o.length;a++)await $e(o[a].id),n++}return n}catch(r){return console.error("Error in removeDuplicateGroups:",r),0}},rr=async(e="en",t="online")=>{try{return await Je(e,t),(await ue({locale:e,gameMode:t})).filter((n,o,a)=>a.findIndex(c=>c.name===n.name)===o)}catch(r){return console.error("❌ getAllAvailableGroups: Database error",{locale:e,gameMode:t,error:r}),[]}},kr=Object.freeze(Object.defineProperty({__proto__:null,addCustomGroup:Xt,deleteAllCustomGroups:We,deleteCustomGroup:$e,getAllAvailableGroups:rr,getCustomGroupByName:be,getCustomGroups:ue,getGroupIntensities:er,importCustomGroups:Ye,isGroupNameUnique:tr,removeDuplicateGroups:Je,updateCustomGroup:Zt},Symbol.toStringTag,{value:"Module"})),{gameBoard:B}=k,nr=()=>B.orderBy("title").toArray(),Fr=async()=>B.where("isActive").equals(1)?.first(),sr=async e=>B.add(e),or=async(e,t)=>B.update(e.id,{...e,...t}),ar=async e=>{const t={title:e.title===void 0?"":e.title,tiles:e.tiles||[],isActive:e.isActive===void 0?1:e.isActive,tags:e.tags||[],gameMode:e.gameMode||"online"};if(!t?.title?.length&&t?.tiles?.length)return;const r=await B.where("title").equals(t.title).first();return k.transaction("rw",k.gameBoard,async()=>(t.isActive&&await ir(),r?(await or(r,e),r.id):await sr(t)))},jr=async e=>{const r=(await B.toArray()).map(s=>({...s,isActive:s.id===e?1:0}));await B.bulkPut(r)},zr=async e=>{await B.delete(e)},ir=async()=>{await B.where("isActive").equals(1).modify({isActive:0})};function cr(e,t){let r;try{r=e()}catch{return}return{getItem:n=>{var o;const a=i=>i===null?null:JSON.parse(i,void 0),c=(o=r.getItem(n))!=null?o:null;return c instanceof Promise?c.then(a):a(c)},setItem:(n,o)=>r.setItem(n,JSON.stringify(o,void 0)),removeItem:n=>r.removeItem(n)}}const fe=e=>t=>{try{const r=e(t);return r instanceof Promise?r:{then(s){return fe(s)(r)},catch(s){return this}}}catch(r){return{then(s){return this},catch(s){return fe(s)(r)}}}},ur=(e,t)=>(r,s,n)=>{let o={storage:cr(()=>localStorage),partialize:d=>d,version:0,merge:(d,b)=>({...b,...d}),...t},a=!1;const c=new Set,i=new Set;let m=o.storage;if(!m)return e((...d)=>{console.warn(`[zustand persist middleware] Unable to update item '${o.name}', the given storage is currently unavailable.`),r(...d)},s,n);const u=()=>{const d=o.partialize({...s()});return m.setItem(o.name,{state:d,version:o.version})},l=n.setState;n.setState=(d,b)=>{l(d,b),u()};const p=e((...d)=>{r(...d),u()},s,n);n.getInitialState=()=>p;let h;const E=()=>{var d,b;if(!m)return;a=!1,c.forEach(g=>{var v;return g((v=s())!=null?v:p)});const S=((b=o.onRehydrateStorage)==null?void 0:b.call(o,(d=s())!=null?d:p))||void 0;return fe(m.getItem.bind(m))(o.name).then(g=>{if(g)if(typeof g.version=="number"&&g.version!==o.version){if(o.migrate){const v=o.migrate(g.state,g.version);return v instanceof Promise?v.then(U=>[!0,U]):[!0,v]}console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,g.state];return[!1,void 0]}).then(g=>{var v;const[U,O]=g;if(h=o.merge(O,(v=s())!=null?v:p),r(h,!0),U)return u()}).then(()=>{S?.(h,void 0),h=s(),a=!0,i.forEach(g=>g(h))}).catch(g=>{S?.(void 0,g)})};return n.persist={setOptions:d=>{o={...o,...d},d.storage&&(m=d.storage)},clearStorage:()=>{m?.removeItem(o.name)},getOptions:()=>o,rehydrate:()=>E(),hasHydrated:()=>a,onHydrate:d=>(c.add(d),()=>{c.delete(d)}),onFinishHydration:d=>(i.add(d),()=>{i.delete(d)})},o.skipHydration||E(),h||p},lr=ur,Pe={locale:"en",gameMode:"online",boardUpdated:!1,room:"PUBLIC",background:"color",selectedActions:{},hasSeenRollButton:!1,themeMode:"system"},Z=Et()(lr(e=>({settings:Pe,updateSettings:t=>e(r=>({settings:{...r.settings,...t}})),setLocale:t=>e(r=>({settings:{...r.settings,locale:t}})),resetSettings:()=>e({settings:Pe}),updateSelectedAction:(t,r)=>e(s=>{const n={...s.settings.selectedActions};return r===null?delete n[t]:n[t]=r,{settings:{...s.settings,selectedActions:n}}}),removeSelectedAction:t=>e(r=>{const s={...r.settings.selectedActions};return delete s[t],{settings:{...r.settings,selectedActions:s}}}),clearSelectedActions:()=>e(t=>({settings:{...t.settings,selectedActions:{}}})),getSelectedActionsByType:t=>{const{selectedActions:r={}}=Z.getState().settings;return Object.entries(r||{}).filter(([,n])=>n.type===t).reduce((n,[o,a])=>(n[o]=a,n),{})}}),{name:"gameSettings",partialize:e=>({settings:e.settings})})),Hr=()=>{const{settings:e,updateSettings:t}=Z();return[e,t]},Qr=()=>{const{settings:e,updateSettings:t}=Z();return{settings:e,updateSettings:t}},$r="None",Wr=3e4,Ge=500,ee=Oe();async function dr(){const t=C().currentUser;if(!t)return console.error("No user logged in"),!1;try{const r=await Ee({isCustom:1});return await ae(z(ee,"user-data",t.uid),{customTiles:r,lastUpdated:new Date},{merge:!0}),!0}catch(r){return console.error("Error syncing custom tiles:",r),!1}}async function mr(){const t=C().currentUser;if(!t)return console.error("No user logged in"),!1;try{const r=await ue();return await ae(z(ee,"user-data",t.uid),{customGroups:r,lastUpdated:new Date},{merge:!0}),!0}catch(r){return console.error("Error syncing custom groups:",r),!1}}async function fr(){const t=C().currentUser;if(!t)return console.error("No user logged in"),!1;try{const r=await nr();return r.length&&await ae(z(ee,"user-data",t.uid),{gameBoards:r,lastUpdated:new Date},{merge:!0}),!0}catch(r){return console.error("Error syncing game boards:",r),!1}}async function gr(){const t=C().currentUser;if(!t)return console.error("No user logged in"),!1;try{const{settings:r}=Z.getState(),{localPlayers:s,...n}=r;return await ae(z(ee,"user-data",t.uid),{settings:n,lastUpdated:new Date},{merge:!0}),!0}catch(r){return console.error("Error syncing settings:",r),!1}}async function de(){return await dr(),await mr(),await fr(),await gr(),!0}async function ge(){const t=C().currentUser;if(!t)return console.error("No user logged in"),!1;try{const r=z(ee,"user-data",t.uid),s=await xe(r);if(!s.exists())return!1;const n=s.data();if(n.customTiles!==void 0&&(await He(),await new Promise(o=>setTimeout(o,Ge)),n.customTiles&&n.customTiles.length>0))for(const o of n.customTiles)try{(await Ee({gameMode:o.gameMode,group:o.group,intensity:o.intensity,action:o.action})).length===0&&await ze(o)}catch(a){console.error("Error importing custom tile:",o,a)}if(n.customGroups!==void 0&&(await We(),await new Promise(o=>setTimeout(o,Ge)),n.customGroups&&n.customGroups.length>0))try{await Ye(n.customGroups)}catch(o){console.error("Error importing custom groups:",o)}if(n.gameBoards&&n.gameBoards.length>0)for(const o of n.gameBoards)await ar({title:o.title,tiles:o.tiles,tags:o.tags||[],gameMode:o.gameMode||"online",isActive:o.isActive||0});if(n.settings)try{const{updateSettings:o}=Z.getState(),a=n.settings;o(a)}catch(o){console.error("Error importing settings:",o)}return!0}catch(r){return console.error("Error syncing data:",r),!1}}let te=null;function Ue(e=5){W();const t=e*60*1e3;return te=window.setInterval(async()=>{const r=C();r.currentUser&&!r.currentUser.isAnonymous&&await ge()},t),!0}function W(){return te?(window.clearInterval(te),te=null,!0):!1}const Ve=et.createContext(void 0);function yr(e){const[t,r]=A.useState(null),[s,n]=A.useState(!1),[o,a]=A.useState(!0),[c,i]=A.useState(null),[m,u]=A.useState({syncing:!1,lastSync:null}),l=A.useRef(null),p=A.useRef(!1),h=A.useCallback(async y=>{if(l.current&&(clearTimeout(l.current),l.current=null),!t||t.isAnonymous)return!1;try{return u({syncing:!0,lastSync:m.lastSync}),await y(),u({syncing:!1,lastSync:new Date}),!0}catch(f){return console.error("Sync error:",f),f instanceof Error?i(f.message):i("An unknown error occurred"),u({syncing:!1,lastSync:m.lastSync}),!1}},[t,l,u,m.lastSync,i]);async function E(y=""){try{const f=await Tt(y);return r(f),f}catch(f){const w=R(f);throw i(w),f}}async function d(y,f){try{n(!0);const w=await _t(y,f);return r(w),w}catch(w){const P=R(w);throw i(P),w}finally{n(!1)}}async function b(){try{n(!0);const y=await Mt();return r(y),y}catch(y){const f=R(y);throw i(f),y}finally{n(!1)}}async function S(y,f,w){try{n(!0);const P=await Dt(y,f,w);return r(P),P}catch(P){const q=R(P);throw i(q),P}finally{n(!1)}}async function g(y){try{return await It(y),!0}catch(f){const w=R(f);throw i(w),f}}const v=A.useCallback(async(y,f)=>{try{n(!0);const w=await Pt(y,f);return r(w),await h(de),w}catch(w){throw w instanceof Error&&i(w.message),w}finally{n(!1)}},[n,r,h,i]);async function U(y=""){try{const f=await Ut(y);return r(f),f}catch(f){const w=R(f);throw i(w),f}}const O=A.useCallback(async()=>{try{if(t&&!t.isAnonymous){const y=h(de),f=new Promise(w=>setTimeout(w,5e3,!1));await Promise.race([y,f])}await Gt(),r(null)}catch(y){const f=R(y);throw i(f),y}},[t,h,r,i]),M=A.useCallback(async()=>h(de),[h]);A.useEffect(()=>{const f=C().onAuthStateChanged(w=>{if(r(w||null),p.current||(p.current=!0,a(!1)),w&&!w.isAnonymous){const P=()=>{l.current&&clearTimeout(l.current),l.current=setTimeout(()=>{u({syncing:!0,lastSync:null});let q;try{q=ge?ge():Promise.resolve(!1)}catch(le){console.warn("syncDataFromFirebase is not available:",le),q=Promise.resolve(!1)}(!q||typeof q.then!="function")&&(q=Promise.resolve(!1)),q.then(()=>{u({syncing:!1,lastSync:new Date}),Ue&&Ue()}).catch(le=>{console.error("Error syncing from Firebase:",le),u({syncing:!1,lastSync:null})}).finally(()=>{l.current=null})},1e3)};typeof window<"u"&&"requestIdleCallback"in window?window.requestIdleCallback(P,{timeout:5e3}):setTimeout(P,100)}else W&&W()});return window.authContext={user:null},()=>{f(),l.current&&clearTimeout(l.current),W&&W(),window.authContext=void 0}},[]),A.useEffect(()=>{const y=window;y.authContext&&(y.authContext.user=t)},[t]);const Ke=A.useMemo(()=>({user:t,loading:s,initializing:o,error:c,syncStatus:m,login:E,loginEmail:d,loginGoogle:b,register:S,updateUser:U,forgotPassword:g,convertToRegistered:v,logout:O,syncData:M,isAnonymous:t?.isAnonymous||!1}),[t,s,o,c,m,v,O,M]);return T.jsx(Ve.Provider,{value:Ke,...e})}const hr=A.lazy(()=>K(()=>import("./index.tsx-D88JlLx0.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8]))),wr=A.lazy(()=>K(()=>import("./chunk-DRfcgs1-.js").then(e=>e.i),__vite__mapDeps([9,4,1,2]))),pr=A.lazy(()=>K(()=>import("./theme.tsx-CFiEaNed.js"),__vite__mapDeps([3,1,2,4,5])).then(e=>({default:e.ThemeProvider}))),Ar=A.lazy(()=>K(()=>import("./chunk-B_qvgo8D.js").then(e=>e.m),__vite__mapDeps([10,4,1,2,11])).then(e=>({default:e.MigrationProvider}))),vr=A.lazy(()=>K(()=>import("./schedule.tsx-B1A1kf60.js"),__vite__mapDeps([12,1,2,8,4,5])).then(e=>({default:e.ScheduleProvider})));function Er({children:e}){return T.jsx(A.Suspense,{fallback:T.jsx(me,{}),children:T.jsx(Ar,{children:T.jsx(vr,{children:e})})})}function br(){const e=A.useContext(Ve);return!e||e.initializing?T.jsx(me,{}):T.jsx(A.Suspense,{fallback:T.jsx(me,{}),children:T.jsx(pr,{children:T.jsx(Er,{children:T.jsx(hr,{children:T.jsx(wr,{})})})})})}function Cr(){return T.jsx(yr,{children:T.jsx(br,{})})}const Yr=Object.freeze(Object.defineProperty({__proto__:null,default:Cr},Symbol.toStringTag,{value:"Module"}));export{Ve as A,Zt as B,ze as C,$r as D,$t as E,Qr as F,Pr as G,er as H,Jt as I,Vt as J,$e as K,Ht as L,zt as M,Yt as N,Wt as O,xr as P,or as Q,jr as R,zr as S,nr as T,Wr as U,Rr as V,Nr as W,kr as X,Yr as Y,Ir as a,Z as b,Qt as c,Ur as d,ar as e,Fr as f,Br as g,qr as h,Lr as i,be as j,Xt as k,Tt as l,jt as m,_t as n,Dt as o,lr as p,Mt as q,Je as r,Or as s,tr as t,Hr as u,Gr as v,ue as w,Ee as x,rr as y,k as z};
