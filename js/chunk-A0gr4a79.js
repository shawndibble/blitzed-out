import{j as e,B as k,al as M,am as O,an as G,i as ne,o as S,k as ae,t as je,S as V,T as j,D as A,G as C,aj as $,ab as fe,ac as be,av as ye,ae as ve,aw as Se,ax as Ce,ay as Te,z as K,az as se,a8 as we,O as ke,Q as J,e as le}from"./chunk-BoIRgPCP.js";import{T as Be}from"./chunk-ht6BW3BQ.js";import{i as w,a as P,b as H}from"./chunk-Bp62TkGl.js";import{u as de}from"./chunk-Bmkbcf55.js";import{u as F}from"./chunk-DiRTbvB-.js";import{r as y,u as ie,k as Ae}from"./chunk-BHSFqGHu.js";import{g as $e,u as Re,a as Ue,C as Me}from"./chunk-y3DaHokJ.js";import{u as T,T as m}from"./chunk-CHKE5haP.js";import{l as Le}from"./chunk-CZnDLKd2.js";import{z as Oe,B as Ge,i as z,u as ue,d as he,t as oe,C as Ke,s as pe,D as Ne,g as Ie}from"../assets/index-DQAn7GQy.js";import{b as Pe}from"./chunk-DXd3GHw1.js";import{u as ee}from"./chunk-DnXXKaCT.js";import{a as Ee,i as We}from"./chunk-B4PEA_xj.js";import{u as ze}from"./chunk-8BUNLMgE.js";function Q(t){t.length>1&&t.push(t.shift())}function Pt(t,n){return t?.length!==n?.length?!1:t.every((i,s)=>i===n[s])}const{t:I}=z;function Ve(t,n){return t.filter(i=>{const s=i.action;return n==="vers"?s.includes("{sub}")&&s.includes("{dom}")||s.includes("{player}"):!s.match(/{(dom|sub)}/)||s.includes(`{${n}}`)})}function Fe(t,n,i,s){if([void 0,"normal"].includes(s)){const r=t/n;return Math.floor(i/r)+1}return n>=3&&Math.random()>=.6?n-1:n}function ce(t,n,i){return t.filter(s=>s.group===n&&s.intensity===i&&s.isEnabled)}function ge(t,n,i,s,r,o){if(!t.length)return{title:"",description:""};Q(t);const l=t[0],a=i[l.name];if(!a||a.level<=0)return{title:"",description:""};if(a.variation){const p=a.variation==="appendSome"?.4:a.variation==="appendMost"?.9:1;if(a.variation!=="standalone"&&Math.random()>p)return{title:"",description:""}}const d=Math.max(...l.intensities.map(p=>p.value)),c=Math.min(Fe(r,d,s,o.difficulty),a.level),h=ce(n,l.name,c);if(!h.length){for(let p=c-1;p>=1;p--){const g=ce(n,l.name,p);if(g.length>0)return Q(g),{title:l.label,description:g[0].action,standalone:a.variation==="standalone",role:o.role||"sub"}}return{title:"",description:""}}return Q(h),{title:l.label,description:h[0].action,standalone:a.variation==="standalone",role:o.role||"sub"}}function _e(t,n,i,s,r,o,l){if(t.standalone||!n.length||!t.description)return t.description||"";const a=ge(n,i,s,r,o,l);return a.description?`${a.description.trim().replace(/([^.,!?])$/,"$1.")} ${t.description}`:t.description}async function qe(t,n,i,s){const r=i.selectedActions||{},o=t.filter(d=>{const c=r[d.name];return c&&c.level>0&&(!c.variation||c.variation==="standalone")}),l=t.filter(d=>{const c=r[d.name];return c&&c.level>0&&(c.variation==="appendSome"||c.variation==="appendMost")}),a=[];for(let d=1;d<=s;d++){const c=ge(o,n,r,d,s,i),h=_e(c,l,n,r,d,s,i);a.push({title:c.title,description:h.trim(),role:c.role})}return a}function Y(t,n){const i={title:I("start"),description:I("start")},{finishRange:s=[33,66]}=n,r=`${I("noCum")} ${s[0]}%\r
${I("ruined")} ${s[1]-s[0]}%\r
${I("cum")} ${100-s[1]}%`,o={title:I("finish"),description:r};return[i,...t.map(l=>({title:l.title,description:l.description})),o]}async function Je(t,n,i,s=40){try{const[r,o]=await Promise.all([Oe({locale:n,gameMode:i}),Ge({locale:n,gameMode:i})]),l=t.selectedActions||{},a=Object.keys(l).filter(b=>l[b]?.level>0),d=r.filter(b=>a.includes(b.name)),c=r.map(b=>b.name),h=a.filter(b=>!c.includes(b)),p=t.role||"sub",u=Ve(o,p).filter(b=>a.includes(b.group));if(!d.length||!u.length)return console.warn("No available groups or tiles for board building",{selectedGroups:a,availableGroups:c,relevantTiles:u.length}),{board:Y([],t),metadata:{totalTiles:s+2,tilesWithContent:2,selectedGroups:a,missingGroups:h,availableTileCount:u.length}};const v=await qe(d,u,t,s),x=v.filter(b=>b.description.trim().length>0).length,f=Y(v,t);return{board:f,metadata:{totalTiles:f.length,tilesWithContent:x+2,selectedGroups:a,missingGroups:h,availableTileCount:u.length}}}catch(r){return console.error("Error building game board:",r),{board:Y([],t),metadata:{totalTiles:2,tilesWithContent:2,selectedGroups:[],missingGroups:[],availableTileCount:0}}}}function He(){const t=ee(he),[n,i]=F(),{i18n:s}=T(),r=y.useCallback(async o=>{const l=o?.roomUpdate||o?.boardUpdated?o:{...n,...o,selectedActions:{...n.selectedActions,...o.selectedActions}};let{gameMode:a,boardUpdated:d}=l;const{roomTileCount:c=40,finishRange:h,room:p}=l,g=w(p||"");if(!o||!h)return{gameMode:a};g&&!P(a||"")&&(a="online",d=!0);const u=a||"online",v=s.resolvedLanguage||"en",x=g?40:c||40,f=await Je(l,v,u,x);return f.metadata.missingGroups.length>0&&console.warn("Missing groups for board building:",f.metadata.missingGroups),f.metadata.tilesWithContent<x/2&&console.warn("Low tile content ratio:",{tilesWithContent:f.metadata.tilesWithContent,totalTiles:f.metadata.totalTiles,availableTileCount:f.metadata.availableTileCount}),(o?.boardUpdated||d||(t?.tiles?.length??0)!==f.board.length)&&(await i(l),await ue({title:t?.title||"",tiles:f.board})),{settingsBoardUpdated:d,gameMode:a,newBoard:f.board,metadata:f.metadata}},[t,s.resolvedLanguage,n,i]);return y.useCallback(o=>r(o),[r])}function X({children:t,value:n,index:i,style:s,...r}){return e.jsx("div",{role:"tabpanel",hidden:n!==i,id:`simple-tabpanel-${i}`,"aria-labelledby":`simple-tab-${i}`,...r,children:n===i&&e.jsx(k,{sx:{p:3,...s},children:t})})}function me({formData:t,setFormData:n,backgrounds:i,isRoom:s=!1}){const{t:r}=T(),o=s?"roomBackground":"background",l=s?"roomBackgroundURL":"backgroundURL",[a,d]=y.useState(t?.[o]||Object.keys(i)[0]),c=()=>Object.entries(i).map(([g,u])=>e.jsx(S,{value:g,children:u},g)),h=g=>{n({...t,[o]:g.target.value}),d(g.target.value)};y.useEffect(()=>{a!==t?.[o]&&d(t?.[o]||"")},[t,a,o]);const p=g=>{const u={...t,[o]:"custom",[l]:g.target.value};s&&(u.roomUpdated=!0),n(u)};return e.jsxs(e.Fragment,{children:[e.jsxs(M,{fullWidth:!0,margin:"normal",children:[e.jsx(O,{id:"background-label",children:r("background")}),e.jsx(G,{labelId:"background-label",id:"background",label:r("background"),value:a||"",onChange:h,children:c()})]}),a==="custom"&&e.jsx(ne,{sx:{mt:2},label:r("url"),value:t?.[l]||"",fullWidth:!0,onChange:p,helperText:e.jsxs(e.Fragment,{children:[r("supportedSites"),e.jsx("br",{}),r("requiresEmbeddedUrl")]})})]})}function Qe({boardUpdated:t}){const{i18n:n}=T(),[i,s]=y.useState(n.resolvedLanguage||"en");function r(l){s(l),n.changeLanguage(l),t()}const o=Object.entries(Le).map(([l,a])=>e.jsx(S,{value:l,children:a.label},l));return e.jsx(k,{sx:{minWidth:120,mt:1,mb:2},children:e.jsxs(M,{fullWidth:!0,children:[e.jsxs(O,{id:"language-label",sx:{display:"flex",alignItems:"center"},children:[e.jsx(ae,{sx:{mr:1}}),e.jsx(m,{i18nKey:"language"})]}),e.jsx(G,{labelId:"language-label",id:"language-select",value:i,label:e.jsxs(e.Fragment,{children:[e.jsx(ae,{}),e.jsx(m,{i18nKey:"language"})]}),onChange:l=>r(l.target.value),children:o})]})})}function Ye({trueCondition:t,onChange:n,yesLabel:i,noLabel:s=null,sx:r={}}){const o=s??i;return e.jsx(k,{sx:{display:"flex",justifyContent:"center",my:1,...r},children:e.jsx(je,{control:e.jsx(V,{checked:t||!1,onChange:n}),label:oe(t?i:o)})})}function U({field:t,formData:n,handleSwitch:i}){return e.jsx(Ye,{trueCondition:n[t],onChange:s=>i(s,t),yesLabel:`${t}Enable`,sx:{justifyContent:"left"}})}function Xe({formData:t,setFormData:n,boardUpdated:i}){const[s,r]=F(),{t:o}=T(),l={color:o("color"),gray:o("gray"),"metronome.gif":o("hypnoDick"),"pink-spiral.gif":o("pinkSpiral"),custom:o("customURL")};function a(d,c){n({...t,[c]:d.target.checked}),r({...s,[c]:d.target.checked})}return e.jsxs(e.Fragment,{children:[e.jsx(Qe,{boardUpdated:i}),e.jsx(j,{variant:"h5",children:e.jsx(m,{i18nKey:"dialog"})}),e.jsx(U,{field:"playerDialog",formData:t,handleSwitch:a}),e.jsx(U,{field:"othersDialog",formData:t,handleSwitch:a}),e.jsx(A,{}),e.jsx(j,{variant:"h5",sx:{mt:2},children:e.jsx(m,{i18nKey:"sounds"})}),e.jsx(U,{field:"mySound",formData:t,handleSwitch:a}),e.jsx(U,{field:"otherSound",formData:t,handleSwitch:a}),e.jsx(U,{field:"chatSound",formData:t,handleSwitch:a}),e.jsx(U,{field:"readRoll",formData:t,handleSwitch:a}),e.jsx(A,{}),e.jsx(j,{variant:"h5",sx:{mt:2,textTransform:"capitalize"},children:e.jsx(m,{i18nKey:"misc"})}),e.jsx(U,{field:"hideBoardActions",formData:t,handleSwitch:a}),e.jsx(U,{field:"advancedSettings",formData:t,handleSwitch:a}),e.jsx(me,{formData:t,setFormData:n,backgrounds:l}),e.jsx(A,{})]})}function Z({children:t}){return e.jsx(C,{size:{xs:12,md:5},children:t})}const te=y.forwardRef(({value:t,onChange:n,label:i,options:s,defaultValue:r=null,sx:o,helpIcon:l=!1,fullWidth:a=!0,...d},c)=>{const h=y.useMemo(()=>s.map(p=>typeof p=="string"?e.jsx(S,{value:p,children:oe(p)},p):e.jsx(S,{value:p.value,children:p.label},p.value)),[s]);return e.jsxs(M,{fullWidth:a,margin:"normal",sx:o,...d,ref:c,children:[e.jsxs(O,{id:`${i}Label`,children:[e.jsx(m,{i18nKey:i}),!!l&&e.jsx($,{sx:{ml:1,fontSize:16}})]}),e.jsx(G,{labelId:`${i}Label`,id:i,label:e.jsxs(e.Fragment,{children:[e.jsx(m,{i18nKey:i}),!!l&&e.jsx($,{sx:{ml:1,fontSize:16}})]}),value:t||r||"",onChange:n,children:h})]})});function D({children:t,title:n,subtitle:i,defaultExpanded:s=!1,...r}){return e.jsxs(fe,{defaultExpanded:s,...r,sx:{backgroundColor:"inherit",backgroundImage:"none",boxShadow:"none"},children:[e.jsxs(be,{expandIcon:e.jsx(ye,{}),sx:{px:0},children:[e.jsxs(j,{variant:"h6",sx:{width:"33%"},children:[n,":"]}),e.jsx(j,{sx:{pt:.5},children:i})]}),e.jsx(ve,{sx:{px:0},children:e.jsx(C,{container:!0,columnSpacing:2,justifyContent:"space-evenly",className:"columned-grid",children:t})})]})}function Ze({formData:t,setFormData:n}){const i=(r,o)=>{n({...t,finishRange:o,boardUpdated:!0})},s=t?.finishRange||[30,70];return e.jsxs(k,{children:[e.jsx(A,{}),e.jsx(j,{id:"finish-slider",sx:{my:1},children:e.jsx(m,{i18nKey:"finishSlider"})}),e.jsx(Se,{"aria-labelledby":"finish-slider",value:s,onChange:i,valueLabelDisplay:"off"}),e.jsxs(k,{display:"flex",flexDirection:"column",justifyContent:"space-between",textAlign:"center",children:[e.jsxs(j,{whiteSpace:"nowrap",children:[e.jsx(m,{i18nKey:"noCum"})," ",s[0],"%"]}),e.jsxs(j,{whiteSpace:"nowrap",children:[e.jsx(m,{i18nKey:"ruined"})," ",s[1]-s[0],"%"]}),e.jsxs(j,{whiteSpace:"nowrap",children:[e.jsx(m,{i18nKey:"cum"})," ",100-s[1],"%"]})]}),e.jsx(A,{sx:{my:1}})]})}function De(){const[t,n]=y.useState(!1);return y.useEffect(()=>{const i=window.matchMedia("(pointer: fine)");n(i.matches);const s=r=>{n(r.matches)};return i.addEventListener("change",s),()=>{i.removeEventListener("change",s)}},[]),t}function et({actionsFolder:t,settings:n,option:i,onChange:s,initValue:r=0}){const o=`${i}label`,l=t[i]?.label,a=()=>n.selectedActions?.[i]?.level||r,d=De(),[c,h]=y.useState(a()),p=x=>{s(x)},g=x=>{h(x)},u=x=>c>0&&x===0?!1:n.difficulty==="accelerated"?c<=2?c===x:c===x||c-1===x:c>=x;function v(x){return Object.keys(t[x]?.actions||{}).map((f,b)=>e.jsxs(S,{value:b,onMouseOver:()=>g(b),children:[!!d&&e.jsx("span",{className:"menu-item-icon",children:u(b)?e.jsx(Ce,{}):e.jsx(Te,{})}),f]},`${x}-${f}`))}return e.jsxs(M,{margin:"normal",fullWidth:!0,children:[e.jsx(O,{id:o,children:l}),e.jsx(G,{labelId:o,id:i,label:l,value:a(),onChange:p,onOpen:()=>h(a()),onClose:()=>h(a()),children:v(i)})]})}function tt({option:t,settings:n,setSettings:i,actionsFolder:s,type:r,showVariation:o=!1,showRole:l=!1}){const{t:a}=T(),d=`${t}label`,c=s[t]?.label;function h(u,v,x){i({...n,[v]:{...n[v],type:r,[x]:u?.target?.value},boardUpdated:!0})}let p=12;(o||l)&&(p=6);let g=["dom","vers","sub"];return s[t]?.dom&&(g=[{label:s[t].dom,value:"dom"},{label:a("vers"),value:"vers"},{label:s[t].sub,value:"sub"}]),e.jsxs(C,{container:!0,justifyContent:"center",children:[e.jsx(C,{size:p,children:e.jsx(et,{actionsFolder:s,settings:n,option:t,onChange:u=>h(u,t,"level")})}),!!l&&e.jsx(C,{size:6,children:e.jsx(te,{sx:{ml:1},value:n[t]?.role,onChange:u=>h(u,t,"role"),label:`${a("role")}: ${c}`,options:g,defaultValue:n.role||"sub"})}),!!o&&e.jsx(C,{size:6,children:e.jsx(K,{placement:"top",title:e.jsxs(m,{i18nKey:"variationTooltip",children:[e.jsx(j,{variant:"subtitle2",children:"Standalone = Its own tile. "}),e.jsx(j,{variant:"subtitle2",children:"Append Some = 50% chance."}),e.jsx(j,{variant:"subtitle2",children:"Append Most = 90% chance."})]}),arrow:!0,children:e.jsxs(M,{fullWidth:!0,margin:"normal",sx:{ml:1},children:[e.jsxs(O,{id:`${d}Variation`,children:[`${c} ${a("variation")}`,e.jsx($,{sx:{ml:1,fontSize:16}})]}),e.jsxs(G,{labelId:`${d}Variation`,id:`${t}Variation`,label:e.jsxs(e.Fragment,{children:[c," ",a("variation"),e.jsx($,{sx:{ml:1,fontSize:16}})]}),value:n[t]?.variation||"standalone",onChange:u=>h(u,t,"variation"),children:[e.jsx(S,{value:"standalone",children:e.jsx(m,{i18nKey:"standalone"})}),e.jsx(S,{value:"appendSome",children:e.jsx(m,{i18nKey:"appendSome"})}),e.jsx(S,{value:"appendMost",children:e.jsx(m,{i18nKey:"appendMost"})})]})]})})})]},t)}function nt({formData:t,setFormData:n}){return e.jsxs(se,{direction:"row",spacing:1,alignItems:"center",justifyContent:"center",sx:{mt:1},children:[e.jsx(j,{children:e.jsx(m,{i18nKey:"solo"})}),e.jsx(K,{title:e.jsx(j,{variant:"subtitle2",children:e.jsx(m,{i18nKey:"soloTooltip"})}),arrow:!0,children:e.jsx($,{sx:{fontSize:15}})}),e.jsx(V,{id:"gameMode",checked:!P(t.gameMode),onChange:i=>n({...t,gameMode:i.target.checked?"local":"online",boardUpdated:!0}),inputProps:{"aria-label":"Game Type"}}),e.jsx(j,{children:e.jsx(m,{i18nKey:"local"})}),e.jsx(K,{title:e.jsx(j,{variant:"subtitle2",children:e.jsx(m,{i18nKey:"localTooltip"})}),arrow:!0,children:e.jsx($,{sx:{fontSize:15}})})]})}function st({formData:t}){const[n,i]=y.useState(!1);return y.useEffect(()=>{const s=Object.values(t).filter(o=>typeof o=="object"&&o?.type==="consumption"&&o?.level>0).length,r=Object.values(t).filter(o=>typeof o=="object"&&o?.level>0).length;i(s>1&&s>=r-s)},[t]),n?e.jsx(we,{severity:"warning",children:e.jsx(m,{i18nKey:"consumptionWarning"})}):null}function it({formData:t,setFormData:n,actionsList:i}){const{t:s}=T(),r=!w(t?.room)&&!P(t.gameMode);function o(a,d={}){return Object.keys(i).filter(c=>i[c]?.type===a).map(c=>e.jsx(Z,{children:e.jsx(tt,{option:c,settings:t,setSettings:n,actionsFolder:i,type:a,...d})},c))}const l=a=>{const d=JSON.parse(JSON.stringify(t));return Object.keys(d).forEach(c=>{d.role=a,c.includes("role")&&(d[c]=a)}),d};return e.jsxs(e.Fragment,{children:[e.jsx(nt,{formData:t,setFormData:n}),w(t?.room)&&!P(t.gameMode)&&e.jsx(C,{container:!0,alignContent:"center",justifyContent:"space-evenly",children:e.jsx(C,{sx:{py:3},children:e.jsx(j,{variant:"h5",children:e.jsx(m,{i18nKey:"privateRequired"})})})}),e.jsxs(C,{container:!0,columnSpacing:2,justifyContent:"space-evenly",children:[e.jsx(Z,{children:e.jsx(K,{placement:"top",title:e.jsx(m,{i18nKey:"difficultyTooltip",children:e.jsxs(j,{variant:"body2",children:["Normal = Slow ramp up. ",e.jsx("br",{}),e.jsx("br",{}),"Accelerated = Straight to max level + the level prior to it."]})}),arrow:!0,children:e.jsx(te,{value:t.difficulty,onChange:a=>n({...t,difficulty:a.target.value,boardUpdated:!0}),label:"difficulty",options:["normal","accelerated"],defaultValue:"normal",helpIcon:!0})})}),r&&e.jsx(Z,{children:e.jsx(te,{value:t.role,onChange:a=>n({...l(a.target.value),boardUpdated:!0}),label:"mainRole",options:["dom","vers","sub"],defaultValue:"sub"})})]}),r?e.jsxs(e.Fragment,{children:[e.jsx(D,{title:s("consumption"),subtitle:s("consumptionSubtitle"),children:o("consumption",{showVariation:!0})}),e.jsx(D,{title:s("foreplay"),subtitle:s("foreplaySubtitle"),children:o("foreplay",{showRole:r})}),e.jsx(D,{title:s("sex"),subtitle:s("sexSubtitle"),children:o("sex",{showRole:r})})]}):e.jsxs(e.Fragment,{children:[e.jsx(C,{container:!0,columnSpacing:2,justifyContent:"space-evenly",children:o("consumption",{showVariation:!0})}),e.jsx(A,{}),e.jsx(C,{container:!0,columnSpacing:2,justifyContent:"center",children:o("solo")})]}),e.jsx(Ze,{setFormData:n,formData:t}),e.jsx(st,{formData:t})]})}function ot({formData:t,setFormData:n}){const{t:i}=T(),s={"1d4":2.5,"1d6":3.5,"2d4":5},r=t?.roomTileCount?Math.floor(t.roomTileCount/s[t.roomDice||"1d6"]):16,o=Array.from({length:7},(l,a)=>(a+2)*10).map(l=>e.jsx(S,{value:l,children:l},l));return e.jsxs(e.Fragment,{children:[e.jsx(j,{children:e.jsx(m,{i18nKey:"gameSpeed"})}),e.jsxs(k,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[e.jsxs(M,{sx:{m:1},fullWidth:!0,children:[e.jsx(O,{id:"diceRole-label",children:e.jsx(m,{i18nKey:"roomDice"})}),e.jsxs(G,{labelId:"diceRole-label",id:"diceRole-select",value:t?.roomDice||"1d4",label:i("roomDice"),onChange:l=>n({...t,roomDice:l.target.value,roomUpdated:!0}),children:[e.jsx(S,{value:"1d4",children:"1d4"}),e.jsx(S,{value:"1d6",children:"1d6"}),e.jsx(S,{value:"2d4",children:"2d4"})]})]}),e.jsxs(M,{sx:{m:1},fullWidth:!0,children:[e.jsx(O,{id:"tile-count-label",children:e.jsx(m,{i18nKey:"roomTileCount"})}),e.jsx(G,{labelId:"tile-count-label",id:"tile-count-select",value:String(t?.roomTileCount||40),label:i("roomTileCount"),onChange:l=>n({...t,roomTileCount:Number(l.target.value),roomUpdated:!0}),children:o})]}),e.jsx(M,{fullWidth:!0,children:e.jsxs(j,{children:[e.jsx(m,{i18nKey:"averageRolls"}),r]})})]})]})}function rt({formData:t,setFormData:n}){const i=y.useCallback(()=>{n({...t,roomRealtime:!t.roomRealtime,roomUpdated:!0})},[t,n]);return e.jsxs(e.Fragment,{children:[e.jsx(j,{children:e.jsx(m,{i18nKey:"playerListOptions"})}),e.jsxs(se,{direction:"row",spacing:1,alignItems:"center",justifyContent:"center",sx:{width:"100%"},children:[e.jsx(j,{children:e.jsx(m,{i18nKey:"realtime"})}),e.jsx(K,{title:e.jsx(j,{variant:"subtitle2",children:e.jsx(m,{i18nKey:"realtimeTooltip"})}),arrow:!0,children:e.jsx($,{sx:{fontSize:15}})}),e.jsx(V,{id:"showPrivate",checked:!!t.roomRealtime,onChange:i,inputProps:{"aria-label":oe("playerList")}}),e.jsx(j,{children:e.jsx(m,{i18nKey:"delayed"})}),e.jsx(K,{title:e.jsx(j,{variant:"subtitle2",children:e.jsx(m,{i18nKey:"delayedTooltip"})}),arrow:!0,children:e.jsx($,{sx:{fontSize:15}})})]})]})}function at({formData:t,setFormData:n}){const{id:i}=ie(),{t:s}=T(),r=c=>{let h;c.target.checked&&w(i)?h=Pe("123456789ABCDEFGHJKLMNPQRSTUVWXYZ",5)():i&&c.target.checked&&!w(i)?h=i:h="PUBLIC",n({...t,room:h.toUpperCase(),gameMode:w(h)?"online":t.gameMode})},o=y.useCallback(c=>{n({...t,room:c.currentTarget.value,boardUpdated:!0})},[t,n]),l=y.useCallback(c=>{c.key==="Enter"&&n({...t,room:c.currentTarget.value,boardUpdated:!0})},[t,n]),a=y.useCallback(c=>{const h=c.target.value.toUpperCase();c.target.value=h},[]),d=!w(t.room);return e.jsxs(e.Fragment,{children:[e.jsxs(se,{direction:"row",spacing:1,alignItems:"center",justifyContent:"center",sx:{width:"100%"},children:[e.jsx(j,{children:e.jsx(m,{i18nKey:"public"})}),e.jsx(V,{id:"showPrivate",checked:d,onChange:r,slotProps:{input:{"aria-label":s("room")}}}),e.jsx(j,{children:e.jsx(m,{i18nKey:"private"})}),e.jsx(K,{title:e.jsx(j,{variant:"subtitle2",children:e.jsx(m,{i18nKey:"privateOptions"})}),arrow:!0,children:e.jsx($,{sx:{fontSize:15}})})]}),d&&e.jsx(ne,{fullWidth:!0,id:"privateRoom",label:"Private Room",defaultValue:t.room?.toUpperCase(),margin:"normal",onBlur:o,onKeyDown:l,onChange:a,inputProps:{style:{textTransform:"uppercase"}}})]})}function lt({formData:t,setFormData:n}){const{t:i}=T(),s={app:i("appBackground"),custom:i("customURL")};return e.jsxs(k,{sx:{margin:"0.5rem"},children:[e.jsx(at,{formData:t,setFormData:n}),!w(t.room)&&e.jsxs(e.Fragment,{children:[e.jsx(A,{sx:{my:1}}),e.jsx(ot,{formData:t,setFormData:n}),e.jsx(A,{sx:{my:1}}),e.jsx(rt,{formData:t,setFormData:n}),e.jsx(A,{sx:{my:1}}),e.jsx(me,{formData:t,setFormData:n,backgrounds:s,isRoom:!0})]})]})}function ct(t){return Object.values(t).some(({level:n})=>n>0)}function dt(t,n){const i=t.selectedActions||{};return Object.entries(i).reduce((s,[r,o])=>(r in n&&(o?.variation?.startsWith("append")?s.withAppend[r]=o:s.withoutAppend[r]=o),s),{withAppend:{},withoutAppend:{}})}function ut(t){return Object.keys(t).length>0&&Object.values(t).some(({level:n})=>n>0)}function ht(t,n){const{withAppend:i,withoutAppend:s}=dt(t,n);return ct(s)?w(t.room)&&!P(t.gameMode)?"privateRequired":null:ut(i)?"appendWithAction":"pickSomething"}function pt(t,n,i){const s=t.selectedActions||{},r=Object.entries(i).filter(([l])=>s[l]).reduce((l,[a,d])=>(l[a]=Object.keys(d.actions).slice(1,s[a].level+1),l),{});return(n?.filter(l=>{if(!l.isCustom)return!1;if(l.group==="misc")return!0;const a=r[l.group];return a&&a.length>=Number(l.intensity)})||[]).length}async function gt(t,n,i,s){const{t:r}=z;let o=`### ${z.t("gameSettings")}\r
`;s&&(o+=`##### ${s}\r
`),o+=`--- \r
`;const l=t.selectedActions||{};if(Object.entries(i).forEach(([h,p])=>{if(!l[h])return;const{role:g,variation:u,level:v}=l[h],x=g||t.role||"sub";if(v>0){const f=Object.keys(p?.actions||{});if(o+=`* ${p?.label}: ${f[v]||""}`,u&&(o+=` (${r(u)})`),!P(t.gameMode)&&!u){const b=p[x]??r(x);o+=` (${b})`}o+=`\r
`}}),t.customGroups&&Array.isArray(t.customGroups)){for(const h of t.customGroups)if(h.groupName&&h.intensity)try{const g=(await Ne(h.groupName,t.locale||"en",t.gameMode||"online"))?.label||h.groupName;o+=`* ${g}: Level ${h.intensity} (Custom)\r
`}catch(p){console.error(`Error loading custom group ${h.groupName}:`,p),o+=`* ${h.groupName}: Level ${h.intensity} (Custom)\r
`}}if(o.endsWith(`--- \r
`))return"";const{finishRange:a,difficulty:d}=t;o+=`--- \r
`,o+=`* ${r("difficulty")}: ${r(d??"normal")} \r
`,a&&(o+=`* ${r("finishSlider")} ${a[0]}%  | ${a[1]-a[0]}% | ${100-a[1]}% \r
`);const c=pt(t,n,i);return c&&(o+=`* ${r("customTilesLabel")}: ${c} \r
`),o}function mt(t){const n={};return Object.entries(t).forEach(([i,s])=>{!["displayName","background","boardUpdated","chatSound","mySound","otherSound","othersDialog","playerDialog","readRoll","hideBoardActions","advancedSettings"].includes(i)&&!i.startsWith("room")&&(n[i]=s)}),n}async function xt({title:t,formData:n,user:i,actionsList:s,tiles:r,customTiles:o=[],reason:l=""}){const a=JSON.stringify(mt(n)),d=await Ke({title:t,gameBoard:JSON.stringify(r),settings:a}),c=await gt(n,o,s,l);if(!(!d?.id||c===""))return pe({room:n?.room||"PUBLIC",user:i,text:c,type:"settings",gameBoardId:d.id,boardSize:r.length,gameMode:n.gameMode})}function jt(t){const{t:n}=z;let i=`### ${n("roomSettings")}\r
`;return Object.entries(t).forEach(([s,r])=>{if(s!=="room"){if(s==="roomBackgroundURL"&&r!==""){i+=`* ${n(s)}: [${Ee(r)}:link:](${r})\r
`;return}if(s==="roomRealtime"){i+=`* ${n("playerList")}: ${n(r?"delayed":"realtime")}\r
`;return}r!==""&&(i+=`* ${n(s)}: ${r}\r
`)}}),i}function ft(t){const n={};return Object.entries(t).forEach(([i,s])=>{i.startsWith("room")&&!["roomUpdated","roomBackground"].some(r=>r===i)&&(n[i]=s)}),n}async function bt(t,n,i){let s=t;return n!==void 0&&n.length>0&&(s=await i(n)),s}function yt(t,n){const i=ft(t);return pe({room:t.room,user:n,text:jt(i),type:"room",settings:JSON.stringify(i)})}function xe(){const{id:t}=ie(),n=Ae();return i=>{if(t!==void 0&&t?.toUpperCase()!==i?.toUpperCase()){const s=i?.replace(/^\/+/,"")||"PUBLIC";n(`/${s}`)}}}function vt(t){(!t.roomBackgroundURL||!We(t.roomBackgroundURL))&&(t.roomBackground="app")}function St(t){const n={...t},i={};t.selectedActions&&Object.entries(t.selectedActions).forEach(([r,o])=>{o&&o.level>0&&(i[r]=o)});const s=$e();return Object.keys(n).forEach(r=>{const o=n[r];o&&typeof o=="object"&&o.type&&s.VALID_GROUP_TYPES.includes(o.type)&&delete n[r]}),n.selectedActions=i,n}function Ct(){const{user:t,updateUser:n}=de(),{id:i}=ie(),{t:s}=T(),r=He(),[o,l]=F(),a=ee(()=>Ie(o?.gameMode)),d=ee(he),c=xe(),{messages:h}=ze(),p=y.useCallback(u=>{const v=i?.toUpperCase()!==u.room.toUpperCase(),x=!!(u.room&&!w(u.room)),f=x&&u.roomTileCount!==o?.roomTileCount;return{roomChanged:v,isPrivateRoom:x,privateBoardSizeChanged:f}},[i,o?.roomTileCount]),g=y.useCallback(async(u,v)=>{const{displayName:x}=u,f=await bt(t,x,n);vt(u);const{settingsBoardUpdated:b,gameMode:W,newBoard:N=[]}=await r(u),{roomChanged:E,isPrivateRoom:_,privateBoardSizeChanged:q}=p(u);if(!f)return;_&&(u.roomUpdated||!h.find(L=>L.type==="room"))&&await yt(u,f),d?.tiles!==N&&await ue({title:s("settingsGenerated"),tiles:N,isActive:1,gameMode:W}),(b||E||q)&&!h.some(L=>L.type==="settings"&&L.uid===f.uid&&Date.now()-(L.timestamp?.toMillis()||0)<5e3)&&await xt({formData:u,user:f,customTiles:a,actionsList:v,title:"Settings Generated Board",tiles:N});const R=St(u);l({...R,boardUpdated:!1,roomUpdated:!1,gameMode:W}),c(u.room)},[t,n,r,p,h,d,s,a,l,c]);return y.useCallback((u,v)=>g(u,v),[g])}function Tt({closeDialog:t,initialTab:n=0}){const{user:i}=de(),{t:s}=T(),[r,o]=F(),[l,a]=y.useState(n),[d,c]=y.useState(null),[h,p]=y.useState(!1),[g,u]=Re(),v=xe(),x=Ct(),{isLoading:f,actionsList:b}=Ue(g?.gameMode),W=(B,R)=>{a(R),v(g.room)},N=()=>o({...r,boardUpdated:!0}),E=y.useCallback(async B=>{B.preventDefault();const{displayName:R,...L}=g,re=ht(L,b);return re?(c(s(re)),null):(x(g,b),typeof t=="function"&&t(),null)},[g,b,s,c,x,t]),_=y.useCallback(B=>{u(R=>({...R,displayName:B.target.value}))},[u]),q=y.useCallback(B=>{B.key==="Enter"&&(u(R=>({...R,displayName:B.target.value})),E(B))},[E,u]);return!g.room||f?e.jsxs(k,{children:[e.jsxs(j,{variant:"h2",children:[e.jsx(m,{i18nKey:"loading"}),"..."]}),e.jsx(j,{variant:"body1",children:e.jsx(m,{i18nKey:"clearStorage"})})]}):e.jsxs(k,{component:"form",method:"post",onSubmit:E,className:"settings-box",children:[e.jsx(ne,{fullWidth:!0,id:"displayName",label:s("displayName"),defaultValue:i?.displayName||g.displayName||"",required:!0,autoFocus:!0,onBlur:_,onKeyDown:q,margin:"normal"}),e.jsx(k,{sx:{borderBottom:1,borderColor:"divider"},children:e.jsxs(ke,{value:l,onChange:W,"aria-label":"Game Settings",centered:!0,children:[e.jsx(J,{label:s("gameboard"),...H(0)}),e.jsx(J,{label:s("room"),...H(1)}),e.jsx(J,{label:s("application"),...H(2)})]})}),e.jsx(X,{value:l,index:0,style:{p:0},children:e.jsx(it,{formData:g,setFormData:u,actionsList:b})}),e.jsx(X,{value:l,index:1,style:{p:0,pt:1},children:e.jsx(lt,{formData:g,setFormData:u})}),e.jsx(X,{value:l,index:2,style:{p:0,pt:1},children:e.jsx(Xe,{formData:g,setFormData:u,boardUpdated:N})}),e.jsxs("div",{className:"flex-buttons",children:[e.jsx(le,{variant:"outlined",type:"button",onClick:()=>p(!0),children:e.jsx(m,{i18nKey:"customTilesLabel",children:"Game Tiles"})}),e.jsx(le,{variant:"contained",type:"submit",children:e.jsx(m,{i18nKey:"update"})})]}),h&&e.jsx(Me,{open:h,setOpen:p,boardUpdated:N,actionsList:b}),e.jsx(Be,{open:!!d,close:()=>c(null),children:d})]})}const Et=Object.freeze(Object.defineProperty({__proto__:null,default:Tt},Symbol.toStringTag,{value:"Module"}));export{Tt as G,et as I,at as R,te as S,X as T,Ye as Y,yt as a,xe as b,Pt as c,Ct as d,Et as i,xt as s,He as u};
