const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["js/userList.tsx-C-ayKUgM.js","js/chunk-DJZJtpVs.js","js/chunk-7OQk-BoX.js","js/chunk-CXf22l7Q.js","assets/index-DHt7NlwD.js","js/chunk-B4ipE-Yx.js","js/chunk-DtF_b7C9.js","js/index.tsx-DyclJtJK.js","js/chunk-BNqjsRvb.js","js/chunk-D2qPQcBR.js","js/schedule.tsx-aeOoZTE8.js","js/chunk-CGbfZ7mk.js","js/chunk-DEqUmdJg.js","js/theme.tsx-B9yK9L9Z.js","js/index.tsx-CdTjPZvn.js","js/chunk-Dpw0C14I.js","js/index.tsx-C-Z3gExv.js","js/chunk-9fkTg0gS.js","js/chunk-Dr5sKK6t.js","js/chunk-B4PEA_xj.js","js/chunk-yLOK5aTh.js","js/chunk-Ch8mhPza.js","js/index.tsx-C8Vic5z1.js","js/chunk-_4CGWRax.js","js/chunk-DlFuOg2n.js","js/chunk-Cl0Xqspb.js","js/chunk-CBmvyzb9.js","js/chunk-DPBykhvv.js","js/chunk-Brk1q6wR.js"])))=>i.map(i=>d[i]);
import{A as f,_ as l}from"../assets/index-DHt7NlwD.js";import{a7 as C,ad as w,r as u,j as n,ae as v,af as E,ag as p,ah as R,ai as T,aj as A}from"./chunk-DJZJtpVs.js";import{p as D,g as S,A as L}from"./chunk-CXf22l7Q.js";import{a as P}from"./chunk-7OQk-BoX.js";function h(e){if(!e)return null;try{if(typeof e.toDate=="function")return e.toDate();if(typeof e=="string"){const s=new Date(e);if(isNaN(s.getTime()))throw new Error("Invalid serialized timestamp format");return s}else if(typeof e=="number"){const s=e<3250368e4?e*1e3:e,t=new Date(s);if(isNaN(t.getTime()))throw new Error("Invalid numeric timestamp format");return t}else if(typeof e=="object"&&e.seconds!==void 0){const s=e,t=new Date(s.seconds*1e3+(s.nanoseconds||0)/1e6);if(isNaN(t.getTime()))throw new Error("Invalid Firestore timestamp object format");return t}else{if(e instanceof Date)return e;throw console.warn("Unsupported timestamp format:",typeof e,e),new Error(`Unsupported timestamp format: ${typeof e}`)}}catch(s){return console.warn("Failed to parse timestamp:",s),null}}function m(e){return e.sort((s,t)=>{const r=h(s.timestamp),a=h(t.timestamp);return!r||!a?0:r.getTime()-a.getTime()})}function d(e){return JSON.parse(JSON.stringify(e)).reverse()}function b(e,s){return d(e).find(t=>t.type===s)}function O(e,s,t="ASC"){let r=d(e);return t==="DESC"&&(r=r.reverse()),r.filter(a=>a.type===s)}function K(e,s){return d(e).find(s)}function N(e){return d(e)[0]}const I={messages:[],loading:!0,error:null,room:null,paginationCursor:null},U=P()(D((e,s)=>({...I,loadMessages:t=>{const a=m(t);e({messages:a,loading:!1,error:null})},addMessage:t=>{const{messages:r}=s();if(r.find(i=>i.id===t.id))return;const o=[...r,t],c=m(o);e({messages:c})},updateMessage:(t,r)=>{const{messages:a}=s();let o=!1;const c=a.map(i=>{if(i.id===t){const g={...i,...r};if(Object.keys(r).some(x=>i[x]!==r[x]))return o=!0,g}return i});if(o){const i=m(c);e({messages:i})}},clearMessages:()=>{e({messages:[],loading:!1,error:null})},setLoading:t=>{const{loading:r}=s();r!==t&&e({loading:t})},setError:t=>{const{error:r}=s();r!==t&&e({error:t})},setRoom:t=>{const{room:r}=s();r!==t&&e({room:t})},setPaginationCursor:t=>{const{paginationCursor:r}=s();r!==t&&e({paginationCursor:t})},getMessagesByType:t=>{const{messages:r}=s(),a=[];for(let o=0;o<r.length;o++)r[o].type===t&&a.push(r[o]);return a},getLatestMessage:()=>{const{messages:t}=s();return N(t)},getLatestMessageByType:t=>{const{messages:r}=s();return b(r,t)},getFilteredMessages:t=>{const{messages:r}=s(),a=[];for(let o=0;o<r.length;o++)t(r[o])&&a.push(r[o]);return a},getOrderedMessagesByType:(t,r="ASC")=>{const{messages:a}=s();return O(a,t,r)}}),{name:"messages-storage",partialize:e=>({messages:e.messages,room:e.room,paginationCursor:e.paginationCursor}),onRehydrateStorage:()=>e=>{if(e){const s=new Date;s.setHours(s.getHours()-24);const t=e.messages.filter(r=>{try{const a=h(r.timestamp);if(!a)throw console.warn(`Failed to parse timestamp for message ${r.id}:`,typeof r.timestamp,r.timestamp),new Error(`Failed to parse timestamp for message ${r.id}`);return a>s}catch(a){return console.warn(`Failed to parse message timestamp for message ID ${r.id}:`,a.message),!0}});t.length!==e.messages.length&&e.loadMessages(t)}}})),z=C.createContext(void 0);function y(e){const{id:s}=w(),{messages:t,loading:r,loadMessages:a,setLoading:o,setRoom:c,clearMessages:i}=U();u.useEffect(()=>{if(o(!0),c(s||null),!s){i();return}return S(s,M=>{a(M)})},[s,a,o,c,i]);const g={messages:t,isLoading:r};return n.jsx(z.Provider,{value:g,...e})}const j=u.lazy(()=>l(()=>import("./userList.tsx-C-ayKUgM.js"),__vite__mapDeps([0,1,2,3,4,5,6])).then(e=>({default:e.UserListProvider}))),B=u.lazy(()=>l(()=>import("./index.tsx-DyclJtJK.js"),__vite__mapDeps([7,1,2,8,3,4,5,6,9,10,11,12,13,14,15]))),F=u.lazy(()=>l(()=>import("./index.tsx-C-Z3gExv.js"),__vite__mapDeps([16,1,2,17,12,8,3,4,5,6,18,19,20]))),V=u.lazy(()=>l(()=>import("./chunk-Ch8mhPza.js").then(e=>e.i),__vite__mapDeps([21,4,1,2,8,3,5,6,22,9,10,11,12,13,23,19,20,24,25,26,27,17,28,18])));function _({children:e}){const{id:s}=w(),t=T(),r=A();return u.useEffect(()=>{if(s&&s!==s.toUpperCase()){const a=r.pathname.replace(s,s.toUpperCase());t(a+r.search+r.hash,{replace:!0})}},[s,t,r]),n.jsx(n.Fragment,{children:e})}function $(){const e=u.useContext(L);if(u.useEffect(()=>(e&&(window.authContext=e),()=>{window.authContext=null}),[e]),!e||e.initializing)return n.jsx(f,{});const s=e.user?n.jsx(V,{}):n.jsx(B,{});return n.jsxs(E,{children:[n.jsx(p,{path:"/",element:n.jsx(R,{replace:!0,to:"/PUBLIC"})}),n.jsx(p,{path:"/:id/cast",element:n.jsx(_,{children:n.jsx(u.Suspense,{fallback:n.jsx(f,{}),children:n.jsx(j,{children:n.jsx(y,{children:n.jsx(F,{})})})})})}),n.jsx(p,{path:"/:id",element:n.jsx(_,{children:n.jsx(u.Suspense,{fallback:n.jsx(f,{}),children:n.jsx(j,{children:n.jsx(y,{children:s})})})})})]})}function k(){return n.jsx(v,{children:n.jsx($,{})})}const Q=Object.freeze(Object.defineProperty({__proto__:null,default:k},Symbol.toStringTag,{value:"Module"}));export{z as M,N as a,K as b,Q as i,b as l,O as o,h as p};
