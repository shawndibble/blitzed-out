const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["js/chunk-Ce3NdNab.js","js/chunk-gLqOAnAo.js","js/chunk-D9KXFDlS.js","js/chunk-DF6sfhGu.js","js/chunk-DFT8axIh.js","js/chunk-BOQuZLLs.js","assets/index-40AaoPFR.js"])))=>i.map(i=>d[i]);
import{d as E,g as oe,u as W,a as ae,c as ie,e as ce,l as le,f as p,w as ue,h as de,j as fe,k as ge,m as ye,n as me,o as we,p as N,_ as Y}from"./chunk-Ce3NdNab.js";import{i as j,r as u,j as T,R as he}from"./chunk-gLqOAnAo.js";import{A as L}from"../assets/index-40AaoPFR.js";import{g as b,C as P,t as S,i as pe,v as Te}from"./chunk-DF6sfhGu.js";(function(){var e=typeof window!="undefined"?window:typeof global!="undefined"?global:typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:{};e.SENTRY_RELEASE={id:"ba7d3cfce23f41097f343c1a83f9f2db3c72f794"}})();try{(function(){var e=typeof window!="undefined"?window:typeof global!="undefined"?global:typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:{},t=new e.Error().stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="62f442e4-a0d2-4f3b-a422-3e9af6b8f513",e._sentryDebugIdIdentifier="sentry-dbid-62f442e4-a0d2-4f3b-a422-3e9af6b8f513")})()}catch(e){}const{customTiles:y}=E;y.hook("creating",function(e,t,r){t.locale===void 0&&(t.locale="en"),t.gameMode===void 0&&(t.gameMode="online"),t.isCustom===void 0&&(t.isCustom=1)});const Ae=async e=>{const t=e.map(r=>({...r,isEnabled:1}));return await y.bulkAdd(t)},Q=e=>{const t=["locale","gameMode","group","intensity","tag","isCustom","action"];let r=y.toCollection();return Object.entries(e).filter(([n])=>t.includes(n)).forEach(([n,s])=>{s==null||s===""||(n==="tag"?r=r.filter(d=>d.tags.includes(s)):r=r.filter(d=>d[n]===s))}),r},U=async(e={})=>{try{return await Q(e).toArray()}catch(t){return console.error("Error in getTiles:",t),[]}},be=async e=>{const{page:t=1,limit:r=50}=e;try{const o=Q(e),n=await o.count(),s=(t-1)*r;return{items:await o.offset(s).limit(r).toArray(),total:n,page:t,limit:r,totalPages:Math.ceil(n/r)}}catch(o){return console.error("Error in getPaginatedTiles:",o),{items:[],total:0,page:t,limit:r,totalPages:0}}},$=(e="en",t="online")=>y.where("locale").equals(e).and(r=>r.gameMode===t),ve=async(e="en",t="online",r=null)=>{let o=$(e,t);return r&&(o=o.and(s=>s.tags.some(d=>r.includes(d)))),(await o.toArray()).reduce((s,d)=>{const m=d.group;s[m]||(s[m]={count:0,intensities:{}}),s[m].count++;const l=Number(d.intensity);return s[m].intensities[l]||(s[m].intensities[l]=0),s[m].intensities[l]++,s},{})},_e=(e=null)=>{const t=j.resolvedLanguage||j.language||"en";let r=y.where("locale").equals(t).and(o=>o.isEnabled===1);return e&&(r=r.and(o=>o.gameMode===e)),r.toArray()},V=async e=>await y.add({...e,isEnabled:1}),Ce=async(e,t)=>await y.update(e,t),Ee=async e=>{const t=await y.get(e);if(!t)throw new Error(`Custom tile with id ${e} not found`);return await y.update(e,{isEnabled:t.isEnabled?0:1})};async function H(){try{return await E.customTiles.where("isCustom").equals(1).delete(),!0}catch(e){return console.error("Error deleting custom tiles:",e),!1}}const Se=async e=>{await y.delete(e)},K=(e,t="en",r="online")=>$(t,r).and(o=>o.group===e),De=async(e,t="en",r="online")=>{try{return await K(e,t,r).count()}catch(o){return console.error("Error counting tiles by group:",o),0}},xe=async(e,t="en",r="online")=>{try{return await K(e,t,r).delete()}catch(o){return console.error("Error deleting tiles by group:",o),0}},$e=Object.freeze({__proto__:null,addCustomTile:V,countTilesByGroup:De,deleteAllIsCustomTiles:H,deleteCustomTile:Se,deleteCustomTilesByGroup:xe,getActiveTiles:_e,getPaginatedTiles:be,getTileCountsByGroup:ve,getTiles:U,importCustomTiles:Ae,toggleCustomTile:Ee,updateCustomTile:Ce}),{gameBoard:w}=E,Pe=()=>w.orderBy("title").toArray(),Ve=async()=>{var e;return(e=w.where("isActive").equals(1))==null?void 0:e.first()},Be=async e=>w.add(e),Ie=async(e,t)=>w.update(e.id,{...e,...t}),Me=async e=>{var t,r;const o={title:e.title===void 0?"":e.title,tiles:e.tiles||[],isActive:e.isActive===void 0?1:e.isActive,tags:e.tags||[],gameMode:e.gameMode||"online"};if(!((t=o==null?void 0:o.title)!=null&&t.length)&&((r=o==null?void 0:o.tiles)!=null&&r.length))return;const n=await w.where("title").equals(o.title).first();return E.transaction("rw",E.gameBoard,async()=>(o.isActive&&await Ue(),n?(await Ie(n,e),n.id):await Be(o)))},He=async e=>{const r=(await w.toArray()).map(o=>({...o,isActive:o.id===e?1:0}));await w.bulkPut(r)},Ke=async e=>{await w.delete(e)},Ue=async()=>{await w.where("isActive").equals(1).modify({isActive:0})},Je="None",Xe=3e4,O=500,D=pe();async function Fe(){const t=b().currentUser;if(!t)return console.error("No user logged in"),!1;try{const r=await U({isCustom:1});return await P(S(D,"user-data",t.uid),{customTiles:r,lastUpdated:new Date},{merge:!0}),!0}catch(r){return console.error("Error syncing custom tiles:",r),!1}}async function Ge(){const t=b().currentUser;if(!t)return console.error("No user logged in"),!1;try{const r=await oe();return await P(S(D,"user-data",t.uid),{customGroups:r,lastUpdated:new Date},{merge:!0}),!0}catch(r){return console.error("Error syncing custom groups:",r),!1}}async function ke(){const t=b().currentUser;if(!t)return console.error("No user logged in"),!1;try{const r=await Pe();return r.length&&await P(S(D,"user-data",t.uid),{gameBoards:r,lastUpdated:new Date},{merge:!0}),!0}catch(r){return console.error("Error syncing game boards:",r),!1}}async function Re(){const t=b().currentUser;if(!t)return console.error("No user logged in"),!1;try{const{settings:r}=W.getState(),{localPlayers:o,...n}=r;return await P(S(D,"user-data",t.uid),{settings:n,lastUpdated:new Date},{merge:!0}),!0}catch(r){return console.error("Error syncing settings:",r),!1}}async function I(){return await Fe(),await Ge(),await ke(),await Re(),!0}async function M(){const t=b().currentUser;if(!t)return console.error("No user logged in"),!1;try{const r=S(D,"user-data",t.uid),o=await Te(r);if(!o.exists())return!1;const n=o.data();if(n.customTiles!==void 0&&(await H(),await new Promise(s=>setTimeout(s,O)),n.customTiles&&n.customTiles.length>0))for(const s of n.customTiles)try{(await U({gameMode:s.gameMode,group:s.group,intensity:s.intensity,action:s.action})).length===0&&await V(s)}catch(d){console.error("Error importing custom tile:",s,d)}if(n.customGroups!==void 0&&(await ae(),await new Promise(s=>setTimeout(s,O)),n.customGroups&&n.customGroups.length>0))try{await ie(n.customGroups)}catch(s){console.error("Error importing custom groups:",s)}if(n.gameBoards&&n.gameBoards.length>0)for(const s of n.gameBoards)await Me({title:s.title,tiles:s.tiles,tags:s.tags||[],gameMode:s.gameMode||"online",isActive:s.isActive||0});if(n.settings)try{const{updateSettings:s}=W.getState(),d=n.settings;s(d)}catch(s){console.error("Error importing settings:",s)}return!0}catch(r){return console.error("Error syncing data:",r),!1}}let x=null;function z(e=5){C();const t=e*60*1e3;return x=window.setInterval(async()=>{const r=b();r.currentUser&&!r.currentUser.isAnonymous&&await M()},t),!0}function C(){return x?(window.clearInterval(x),x=null,!0):!1}const J=he.createContext(void 0);function qe(e){const[t,r]=u.useState(null),[o,n]=u.useState(!1),[s,d]=u.useState(!0),[m,l]=u.useState(null),[_,A]=u.useState({syncing:!1,lastSync:null}),f=u.useRef(null),F=u.useRef(!1),v=u.useCallback(async i=>{if(f.current&&(clearTimeout(f.current),f.current=null),!t||t.isAnonymous)return!1;try{return A({syncing:!0,lastSync:_.lastSync}),await i(),A({syncing:!1,lastSync:new Date}),!0}catch(a){return console.error("Sync error:",a),a instanceof Error?l(a.message):l("An unknown error occurred"),A({syncing:!1,lastSync:_.lastSync}),!1}},[t,f,A,_.lastSync,l]);async function X(i=""){try{l(null);const a=await we(i);if(!a){const c=new Error("Login failed: No user returned from Firebase");throw N("auth_context_no_user",c,{authentication:{step:"auth_context_no_user",displayName:i}}),l(c.message),c}return r(a),a}catch(a){const c=p(a);throw N("auth_context_login_failed",a,{authentication:{step:"auth_context_login_failed",displayName:i}}),l(c),a}}async function Z(i,a){try{n(!0);const c=await me(i,a);return r(c),c}catch(c){const g=p(c);throw l(g),c}finally{n(!1)}}async function ee(){try{n(!0);const i=await ye();return r(i),i}catch(i){const a=p(i);throw l(a),i}finally{n(!1)}}async function te(i,a,c){try{n(!0);const g=await ge(i,a,c);return r(g),g}catch(g){const h=p(g);throw l(h),g}finally{n(!1)}}async function re(i){try{return await de(i),!0}catch(a){const c=p(a);throw l(c),a}}const G=u.useCallback(async(i,a)=>{try{n(!0);const c=await ce(i,a);return r(c),await v(I),c}catch(c){throw c instanceof Error&&l(c.message),c}finally{n(!1)}},[n,r,v,l]);async function se(i=""){try{const a=await fe(i);return r(a),a}catch(a){const c=p(a);throw l(c),a}}const k=u.useCallback(async()=>{try{if(t&&!t.isAnonymous){const i=v(I),a=new Promise(c=>setTimeout(c,5e3,!1));await Promise.race([i,a])}await le(),r(null)}catch(i){const a=p(i);throw l(a),i}},[t,v,r,l]),R=u.useCallback(async()=>{try{await ue(),r(null),window.location.reload()}catch(i){const a=p(i);throw l(a),i}},[r,l]),q=u.useCallback(async()=>v(I),[v]);u.useEffect(()=>{const a=b().onAuthStateChanged(c=>{if(r(c||null),F.current||(F.current=!0,d(!1)),c&&!c.isAnonymous){const g=()=>{f.current&&clearTimeout(f.current),f.current=setTimeout(()=>{A({syncing:!0,lastSync:null});let h;try{h=M?M():Promise.resolve(!1)}catch(B){console.warn("syncDataFromFirebase is not available:",B),h=Promise.resolve(!1)}(!h||typeof h.then!="function")&&(h=Promise.resolve(!1)),h.then(()=>{A({syncing:!1,lastSync:new Date}),z&&z()}).catch(B=>{console.error("Error syncing from Firebase:",B),A({syncing:!1,lastSync:null})}).finally(()=>{f.current=null})},1e3)};typeof window!="undefined"&&"requestIdleCallback"in window?window.requestIdleCallback(g,{timeout:5e3}):setTimeout(g,100)}else C&&C()});return window.authContext={user:null},()=>{typeof a=="function"&&a(),f.current&&clearTimeout(f.current),C&&C(),window.authContext=void 0}},[]),u.useEffect(()=>{const i=window;i.authContext&&(i.authContext.user=t)},[t]);const ne=u.useMemo(()=>({user:t,loading:o,initializing:s,error:m,syncStatus:_,login:X,loginEmail:Z,loginGoogle:ee,register:te,updateUser:se,forgotPassword:re,convertToRegistered:G,logout:k,wipeAllData:R,syncData:q,isAnonymous:(t==null?void 0:t.isAnonymous)||!1}),[t,o,s,m,_,G,k,R,q]);return T.jsx(J.Provider,{value:ne,...e})}const Ne=u.lazy(()=>Y(()=>import("./chunk-Ce3NdNab.js").then(function(e){return e.Y}),__vite__mapDeps([0,1,2,3,4]))),je=u.lazy(()=>Y(()=>import("./chunk-BOQuZLLs.js").then(function(e){return e.i}),__vite__mapDeps([5,0,1,2,3,4,6])));function Le(){const e=u.useContext(J);return!e||e.initializing?T.jsx(L,{}):T.jsx(u.Suspense,{fallback:T.jsx(L,{}),children:T.jsx(Ne,{children:T.jsx(je,{})})})}function Oe(){return T.jsx(qe,{children:T.jsx(Le,{})})}const Ze=Object.freeze({__proto__:null,default:Oe});export{J as A,Je as D,Xe as U,Ve as a,U as b,V as c,Ce as d,De as e,xe as f,_e as g,ve as h,Ae as i,be as j,Se as k,Ie as l,He as m,Ke as n,Pe as o,$e as p,Ze as q,Ee as t,Me as u};
//# sourceMappingURL=chunk-C9KfLBvM.js.map
