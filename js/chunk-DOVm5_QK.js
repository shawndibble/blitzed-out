const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["js/getUniqueImportRecords.ts-BjqXMB2K.js","js/chunk-CMb_ATvh.js","js/chunk-BVhHzeSz.js","assets/index-BPZ_Msrf.js","js/chunk-B90GCnie.js","js/chunk-jdmcjs0s.js","js/chunk-DQWlF9SU.js","js/chunk-ClYjm9Ad.js","js/chunk-Bp-jfObm.js","js/chunk-DF6wAis7.js","js/chunk-C7PvMB7v.js","js/chunk-BHUSFDWr.js","js/chunk-B-Pfj4Vk.js","js/chunk-BUE_ixxi.js","js/chunk-B4PEA_xj.js","js/chunk-B8IgU524.js"])))=>i.map(i=>d[i]);
import{ac as ae,r as a,am as se,j as e,T as y,ax as A,aa as N,y as Y,x as H,ay as J,M as $,z as te,aP as Me,Q as Z,ab as Se,U as fe,W as ye,aD as be,$ as Xe,Z as Le,Y as je,V as Qe,a7 as Ze,S as et,aY as tt,b1 as st,I as ie,a1 as $e,R as Ae,b2 as nt,av as rt,b3 as it,aF as at,b4 as ot,E as lt,b5 as ct,au as ge}from"./chunk-CMb_ATvh.js";import{n as he,u as ut}from"./chunk-BVhHzeSz.js";import{D as pe,F as dt,z as de,x as ve,y as ue,G as Oe,I as Pe,J as we,_ as We,K as Ke,L as Re,N as pt,O as mt,P as gt,Q as ht,R as xt,T as Ne,V as ft,W as yt,X as bt,l as jt}from"../assets/index-BPZ_Msrf.js";import{u as ke}from"./chunk-DQWlF9SU.js";import{T as vt}from"./chunk-ClYjm9Ad.js";import{A as oe,a as le,b as ce}from"./chunk-Bp-jfObm.js";import{C as Gt}from"./chunk-DF6wAis7.js";import{d as Tt}from"./chunk-C7PvMB7v.js";import{v as Ve,g as Ct,f as It,h as _e}from"./chunk-BHUSFDWr.js";import{a as Ee,u as St}from"./chunk-BUE_ixxi.js";import{m as ze,D as Ge,n as wt,j as Et}from"./chunk-jdmcjs0s.js";import{u as Dt}from"./chunk-B8IgU524.js";const Lt=c=>{const p={};for(const n of c){const x={label:n.label||n.name,type:n.type||"action",actions:{None:[]}};if(n.intensities&&Array.isArray(n.intensities))for(const i of n.intensities)x.actions[i.label]=[];p[n.name]=x}return p},xe=async(c="en",p="online")=>{try{const n=await pe(c,p);return Lt(n)}catch(n){return console.error("Error importing actions from Dexie:",n),{}}};function Ue(c){return[...Object.entries(c).flatMap(([n,{label:x,actions:i}])=>i?Object.keys(i).filter(o=>o!==dt).map((o,t)=>({group:Tt(n),groupLabel:x,value:n,intensity:Number(t+1),translatedIntensity:o,label:`${x} - ${o}`})):[]),{group:ae.t("misc"),groupLabel:ae.t("misc"),value:"misc",intensity:1,translatedIntensity:ae.t("all"),label:`${ae.t("misc")} - ${ae.t("all")}`}]}const Te="2.0.0",At=2,Be=0;async function Ce(c="en",p={}){try{let n;if(p.exportScope==="single"&&p.singleGroup){const s=await de(p.singleGroup,c);n=s&&!s.isDefault?[s]:[]}else p.exportScope==="default"?n=[]:n=(await ve({locale:c})).filter(l=>!l.isDefault);const x=await ve({locale:c}),i=new Set(x.filter(s=>s.isDefault).map(s=>s.name)),o=(await ue({isCustom:1})).filter(s=>{const l=!s.locale||s.locale===c;return p.exportScope==="single"&&p.singleGroup?l&&s.group===p.singleGroup:p.exportScope==="default"?l&&i.has(s.group):l}),t={};for(const s of n){const l=s.intensities.sort((w,_)=>w.value-_.value).map(w=>w.label),I=s.intensities.find(w=>w.value===Be),L=l.filter(w=>w!==I?.label),k=I?[I.label,...L]:l;t[s.name]={label:s.label,type:s.type||"sex",intensities:k}}const d={};for(const s of o)d[s.group]||(d[s.group]={}),d[s.group][s.intensity]||(d[s.group][s.intensity]=[]),s.tags&&s.tags.length>0?d[s.group][s.intensity].push({action:s.action,tags:s.tags}):d[s.group][s.intensity].push(s.action);const u={};Object.keys(t).sort().forEach(s=>{u[s]=t[s]});const m={};return Object.keys(d).sort().forEach(s=>{m[s]={},Object.keys(d[s]).sort((l,I)=>Number.parseInt(l,10)-Number.parseInt(I,10)).forEach(l=>{m[s][Number.parseInt(l,10)]=d[s][Number.parseInt(l,10)]})}),JSON.stringify({version:Te,locale:c,groups:u,customTiles:m},(s,l)=>(Array.isArray(l)&&l.length>0&&typeof l[0]=="string",l),At)}catch(n){throw console.error("Error exporting clean data:",n),new Error(`Export failed: ${n}`)}}async function Nt(c,p={}){const n={success:!1,importedGroups:0,importedTiles:0,errors:[],warnings:[]};try{let x;try{x=JSON.parse(c)}catch{return n.errors.push("Invalid JSON format"),n}if(!x.version||!x.groups||!x.customTiles)return n.errors.push("Invalid export format - missing version, groups, or customTiles"),n;x.version!==Te&&n.warnings.push(`Format version mismatch: expected ${Te}, got ${x.version}`);const i=p.locale||x.locale||"en",G=p.mergeStrategy||"skip";for(const[o,t]of Object.entries(x.groups))try{const d=await de(o,i);let u=o;if(d)switch(G){case"skip":n.warnings.push(`Skipped existing group: ${o}`);continue;case"overwrite":n.warnings.push(`Will update existing group: ${o}`);break;case"rename":{let l=1;for(u=`${o}_imported`;await de(u,i);)u=`${o}_imported_${l}`,l++;n.warnings.push(`Renamed group from ${o} to ${u}`);break}}const m=t.intensities.map((l,I)=>({id:`intensity-${I}`,label:l,value:I,isDefault:I===Be})),r={name:u,label:t.label,intensities:m,type:t.type,locale:i,isDefault:!1},s=await Ve(r);if(!s.isValid){n.errors.push(`Invalid group ${u}: ${s.errors.join(", ")}`);continue}d&&G==="overwrite"?await Oe(d.id,r):await Pe(r),n.importedGroups++}catch(d){n.errors.push(`Error importing group ${o}: ${d}`)}for(const[o,t]of Object.entries(x.customTiles))try{const d=await de(o,i);if(!d){n.warnings.push(`Group ${o} not found for custom tiles, skipping tiles`);continue}for(const[u,m]of Object.entries(t)){const r=Number.parseInt(u,10);if(!d.intensities.find(l=>l.value===r)){n.warnings.push(`Intensity ${r} not valid for group ${o}, skipping tiles`);continue}for(const l of m)try{let I,L=[];if(typeof l=="string")I=l;else if(l&&typeof l=="object"&&"action"in l)I=l.action,L=l.tags||[];else{n.warnings.push(`Invalid tile data format in group ${o}, skipping`);continue}if((await ue()).find(_=>_.group===o&&_.intensity===r&&_.action===I&&(!_.locale||_.locale===i))&&G==="skip"){n.warnings.push(`Skipped existing tile: ${I.substring(0,50)}...`);continue}await we({group:o,intensity:r,action:I,tags:L,isCustom:1,locale:i}),n.importedTiles++}catch(I){n.errors.push(`Error importing tile "${typeof l=="string"?l.substring(0,30):"object"}...": ${I}`)}}}catch(d){n.errors.push(`Error importing tiles for group ${o}: ${d}`)}return n.success=n.errors.length===0,n}catch(x){return n.errors.push(`Import failed: ${x}`),n}}async function kt(c,p,n="en",x="online"){const i={success:!1,importedGroups:0,importedTiles:0,errors:[],warnings:[]};try{const{default:G}=await We(async()=>{const{default:u}=await import("./getUniqueImportRecords.ts-BjqXMB2K.js");return{default:u}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15])),o=await ue(),{newUniqueRecords:t,changedTagRecords:d}=G(c,o,p);for(const u of t)try{await we(u),i.importedTiles++}catch(m){i.errors.push(`Error importing tile: ${m}`)}for(const u of d)try{u.id&&await Ke(u.id,u)}catch(m){i.errors.push(`Error updating tile: ${m}`)}return i.success=i.errors.length===0,i.warnings.push("Imported using legacy format. Consider exporting in clean v2.0 format for better compatibility."),i}catch(G){return i.errors.push(`Legacy import failed: ${G}`),i}}async function _t(c,p="en"){return Ce(p,{singleGroup:c,exportScope:"single"})}async function Ft(c,p,n={}){const x=c.trim();try{const i=JSON.parse(x);if(i.version&&i.groups)return Nt(x,n);if(i.version&&i.customGroups!==void 0)return{success:!1,importedGroups:0,importedTiles:0,errors:["Old enhanced format no longer supported. Please use clean v2.0 format."],warnings:[]}}catch{}return kt(x,p,n.locale||"en",n.gameMode||"online")}async function Mt(c="en"){try{const n=(await ve({locale:c})).filter(i=>!i.isDefault),x=await ue({isCustom:1});return n.map(i=>{const G=x.filter(o=>o.group===i.name&&(!o.locale||o.locale===c));return{name:i.name,label:i.label,tileCount:G.length}})}catch(p){return console.error("Error getting available groups for export:",p),[]}}function $t({expanded:c,handleChange:p,customTiles:n,mappedGroups:x,setSubmitMessage:i,bulkImport:G}){const o=a.useRef(null),{t}=se(),{settings:d}=Ee(),[u,m]=a.useState(""),[r,s]=a.useState(null),[l,I]=a.useState("clean"),[L,k]=a.useState("all"),[w,_]=a.useState(""),[D,P]=a.useState([]),[b,M]=a.useState("skip"),F=a.useCallback(async()=>{try{if(l==="clean"){let f;switch(L){case"single":if(!w){i({message:t("errors.selectGroupToExport"),type:"error"});return}f=await _t(w,d.locale||"en");break;case"default":f=await Ce(d.locale||"en",{exportScope:"default"});break;default:f=await Ce(d.locale||"en",{exportScope:"all"});break}m(f)}else{const g=n.filter(v=>v.isCustom).map(({group:v,intensity:S,action:V,tags:U,gameMode:R="online"})=>{const j=Ue(x[R]||{}).find(O=>O?.intensity===Number(S)&&O?.value===v);let E="";return E+=`[${j?.group||v} - ${j?.translatedIntensity||S}]
`,E+=V,E+=U?.length?`
Tags: `+U?.join(", "):"",E+=`
GameMode: ${R}`,E});m(g.join(`
---
`))}}catch(f){console.error("Error exporting data:",f),i({message:t("errors.exportFailed",{error:f}),type:"error"})}},[n,x,m,l,L,w,d.locale,i,t]);async function W(f){if(!f.current)return;const v=f.current.importData.value;if(!v.trim())return i({type:"error",message:t("enterDataToImport")});try{i({type:"info",message:t("importMessages.importing")});const S=await Ft(v,x,{locale:d.locale||"en",mergeStrategy:b});if(s(S),S.success){S.importedTiles>0&&(await We(()=>import("../assets/index-BPZ_Msrf.js").then(R=>R.a1),__vite__mapDeps([3,1,2,4,5])).then(R=>R.getTiles({isCustom:1}))).slice(-S.importedTiles).forEach(async R=>{Re(`${R.group} - ${R.intensity}`,R.action)});let V=t("importMessages.importSuccess");S.importedGroups>0&&(V+=` ${t("importMessages.importedGroups",{count:S.importedGroups})}`),S.importedTiles>0&&(V+=` ${t("importMessages.importedTiles",{count:S.importedTiles})}`),i({type:"success",message:V}),await F()}else i({type:"error",message:t("errors.importFailed",{errors:S.errors.join(", ")})})}catch(S){console.error("Import error:",S),i({type:"error",message:t("errors.importFailed",{errors:S.message||S})}),s(null)}}const T=a.useCallback(async()=>{try{const f=await Mt(d.locale||"en");P(f)}catch(f){console.error("Error loading available groups:",f)}},[d.locale]);return a.useEffect(()=>{c==="ctImport"&&(T(),F())},[c,n,F,T]),e.jsxs(oe,{expanded:c==="ctImport",onChange:p("ctImport"),children:[e.jsx(le,{"aria-controls":"ctImport-content",id:"ctImport-header",children:e.jsx(y,{children:e.jsx(A,{i18nKey:"importExport"})})}),e.jsxs(ce,{children:[e.jsx(y,{variant:"body1",sx:{mb:2},children:e.jsx(A,{i18nKey:"ctImportDescription"})}),e.jsxs(N,{sx:{display:"flex",flexWrap:"wrap",gap:2,mb:2,"& .MuiFormControl-root":{minWidth:150,flex:"1 1 auto"}},children:[e.jsxs(Y,{size:"small",children:[e.jsx(H,{children:t("labels.exportFormat")}),e.jsxs(J,{value:l,onChange:f=>I(f.target.value),label:t("labels.exportFormat"),children:[e.jsx($,{value:"clean",children:t("exportFormat.clean")}),e.jsx($,{value:"legacy",children:t("exportFormat.legacy")})]})]}),l==="clean"&&e.jsxs(Y,{size:"small",children:[e.jsx(H,{children:t("labels.exportScope")}),e.jsxs(J,{value:L,onChange:f=>{k(f.target.value),_("")},label:t("labels.exportScope"),children:[e.jsx($,{value:"all",children:t("exportScope.all")}),e.jsx($,{value:"default",children:t("exportScope.default")}),e.jsx($,{value:"single",children:t("exportScope.single")})]})]}),e.jsxs(Y,{size:"small",children:[e.jsx(H,{children:t("labels.importStrategy")}),e.jsxs(J,{value:b,onChange:f=>M(f.target.value),label:t("labels.importStrategy"),children:[e.jsx($,{value:"skip",children:t("importStrategy.skip")}),e.jsx($,{value:"overwrite",children:t("importStrategy.overwrite")}),e.jsx($,{value:"rename",children:t("importStrategy.rename")})]})]})]}),l==="clean"&&L==="single"&&e.jsx(N,{sx:{mb:2},children:e.jsxs(Y,{size:"small",fullWidth:!0,children:[e.jsx(H,{children:t("labels.selectGroup")}),e.jsx(J,{value:w,onChange:f=>_(f.target.value),label:t("labels.selectGroup"),children:D.map(f=>e.jsxs($,{value:f.name,children:[f.label," (",f.tileCount," tiles)"]},f.name))})]})}),e.jsxs(N,{component:"form",method:"post",ref:o,children:[e.jsx(te,{id:"importData",name:"importData",multiline:!0,required:!0,fullWidth:!0,rows:6,sx:{pb:2},value:u,onChange:f=>m(f.target.value),placeholder:t(l==="clean"?"placeholder.cleanFormat":"placeholder.legacyFormat"),InputProps:{endAdornment:e.jsx(Gt,{text:u}),sx:{alignItems:"flex-start"}}}),r&&e.jsxs(Me,{severity:r.success?"success":"error",sx:{mb:2},onClose:()=>s(null),children:[e.jsx(y,{variant:"body2",children:e.jsx("strong",{children:e.jsx(A,{i18nKey:"importResults.title"})})}),r.importedGroups>0&&e.jsxs(y,{variant:"body2",children:["•"," ",e.jsx(A,{i18nKey:"importResults.groupsImported",values:{count:r.importedGroups}})]}),r.importedTiles>0&&e.jsxs(y,{variant:"body2",children:["•"," ",e.jsx(A,{i18nKey:"importResults.tilesImported",values:{count:r.importedTiles}})]}),r.warnings.length>0&&e.jsxs(N,{sx:{mt:1},children:[e.jsx(y,{variant:"body2",color:"warning.main",children:e.jsx("strong",{children:e.jsx(A,{i18nKey:"importResults.warnings"})})}),r.warnings.map((f,g)=>e.jsxs(y,{variant:"body2",color:"warning.main",children:["• ",f]},g))]}),r.errors.length>0&&e.jsxs(N,{sx:{mt:1},children:[e.jsx(y,{variant:"body2",color:"error.main",children:e.jsx("strong",{children:e.jsx(A,{i18nKey:"importResults.errors"})})}),r.errors.map((f,g)=>e.jsxs(y,{variant:"body2",color:"error.main",children:["• ",f]},g))]})]}),e.jsx(Z,{fullWidth:!0,variant:"contained",type:"button",onClick:()=>W(o),children:e.jsx(A,{i18nKey:"import"})})]}),l==="clean"&&e.jsxs(oe,{sx:{mt:2},children:[e.jsx(le,{children:e.jsx(y,{variant:"subtitle2",children:e.jsx(A,{i18nKey:"formatGuide.title"})})}),e.jsxs(ce,{children:[e.jsx(y,{variant:"body2",sx:{mb:2},children:e.jsx(A,{i18nKey:"formatGuide.description"})}),e.jsx(y,{variant:"body2",sx:{mb:1,fontWeight:"bold"},children:e.jsx(A,{i18nKey:"formatGuide.keySections"})}),e.jsx(y,{variant:"body2",component:"div",sx:{mb:2,ml:2},children:e.jsx(A,{i18nKey:"formatGuide.keySectionsContent",components:{strong1:e.jsx("strong",{}),strong2:e.jsx("strong",{}),br:e.jsx("br",{})}})}),e.jsx(y,{variant:"body2",sx:{mb:1,fontWeight:"bold"},children:e.jsx(A,{i18nKey:"formatGuide.manualEditing"})}),e.jsx(y,{variant:"body2",component:"div",sx:{mb:2,ml:2},children:e.jsx(A,{i18nKey:"formatGuide.manualEditingContent",components:{br:e.jsx("br",{})}})}),e.jsx(y,{variant:"body2",sx:{mb:1,fontWeight:"bold"},children:e.jsx(A,{i18nKey:"formatGuide.customTilesFormat"})}),e.jsx(y,{variant:"body2",component:"div",sx:{ml:2},children:e.jsx(A,{i18nKey:"formatGuide.customTilesFormatContent",components:{br:e.jsx("br",{}),code1:e.jsx("code",{}),code2:e.jsx("code",{})}})})]})]})]})]})}function Ot({value:c,onChange:p,locale:n,gameMode:x,includeDefault:i=!0,disabled:G=!1,refreshTrigger:o=0}){const{t}=se(),[d,u]=a.useState([]),[m,r]=a.useState(!0);return a.useEffect(()=>{(async()=>{r(!0);try{const l=await pe(n,x),I=i?l:l.filter(L=>!L.isDefault);u(I)}catch(l){console.error("Error loading custom groups:",l),u([])}finally{r(!1)}})()},[n,x,i,o]),m?e.jsxs(Y,{fullWidth:!0,disabled:!0,children:[e.jsx(H,{children:t("customGroups.loadingGroups")}),e.jsx(J,{value:"",children:e.jsx($,{value:"",children:e.jsxs(N,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Se,{size:16}),e.jsx("span",{children:t("customGroups.loadingGroups")})]})})})]}):e.jsx(N,{children:e.jsxs(Y,{fullWidth:!0,disabled:G,children:[e.jsx(H,{id:"group-label",children:t("group")}),e.jsx(J,{labelId:"group-label",value:c,onChange:s=>p(s.target.value),label:t("group"),children:d.length===0?e.jsx($,{value:"",disabled:!0,children:e.jsx(y,{color:"text.secondary",children:t("customGroups.noGroupsAvailable",{locale:n,gameMode:x})})}):d.map(s=>e.jsx($,{value:s.name,children:e.jsxs(N,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx("span",{children:s.label}),s.isDefault&&e.jsx(fe,{label:t("default"),size:"small",variant:"outlined"})]})},s.id))})]})})}function Pt({groupName:c,value:p,onChange:n,locale:x,gameMode:i,disabled:G=!1}){const{t:o}=se(),[t,d]=a.useState([]),[u,m]=a.useState(!1);a.useEffect(()=>{(async()=>{if(!c){d([]);return}m(!0);try{const l=await pt(c,x,i);d(l)}catch(l){console.error("Error loading group intensities:",l),d([])}finally{m(!1)}})()},[c,x,i]);const r=a.useMemo(()=>t.sort((s,l)=>s.value-l.value),[t]);return a.useEffect(()=>{if(t.length>0&&p&&!t.some(s=>s.value===p)){const s=r[0];s&&n(s.value)}},[t,p,n,r]),c?u?e.jsxs(Y,{fullWidth:!0,disabled:!0,children:[e.jsx(H,{children:o("customGroups.loadingIntensities")}),e.jsx(J,{value:"",children:e.jsx($,{value:"",children:e.jsxs(N,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Se,{size:16}),e.jsx("span",{children:o("customGroups.loadingIntensities")})]})})})]}):t.length===0?e.jsxs(Y,{fullWidth:!0,disabled:!0,children:[e.jsx(H,{children:o("intensity")}),e.jsx(J,{value:"",children:e.jsx($,{value:"",disabled:!0,children:e.jsx(y,{color:"text.secondary",children:o("customGroups.noIntensitiesAvailable",{groupName:c})})})})]}):e.jsx(N,{children:e.jsxs(Y,{fullWidth:!0,disabled:G,children:[e.jsx(H,{children:o("intensity")}),e.jsx(J,{value:p||"",onChange:s=>n(Number(s.target.value)),label:o("intensity"),children:r.map(s=>e.jsx($,{value:s.value,children:s.label},s.id))})]})}):e.jsxs(Y,{fullWidth:!0,disabled:!0,children:[e.jsx(H,{children:o("intensity")}),e.jsx(J,{value:"",children:e.jsx($,{value:"",disabled:!0,children:e.jsx(y,{color:"text.secondary",children:o("customGroups.selectGroupFirst")})})})]})}const Ie=[{name:"Basic (1-4)",intensities:[{label:"intensityLabels.light",value:1,isDefault:!0},{label:"intensityLabels.medium",value:2,isDefault:!0},{label:"intensityLabels.intense",value:3,isDefault:!0},{label:"intensityLabels.extreme",value:4,isDefault:!0}]},{name:"Simple (1-3)",intensities:[{label:"intensityLabels.beginner",value:1,isDefault:!0},{label:"intensityLabels.intermediate",value:2,isDefault:!0},{label:"intensityLabels.advanced",value:3,isDefault:!0}]},{name:"Extended (1-5)",intensities:[{label:"intensityLabels.veryLight",value:1,isDefault:!0},{label:"intensityLabels.light",value:2,isDefault:!0},{label:"intensityLabels.medium",value:3,isDefault:!0},{label:"intensityLabels.intense",value:4,isDefault:!0},{label:"intensityLabels.veryIntense",value:5,isDefault:!0}]}],Fe=c=>{const p=Ie.findIndex(n=>n.intensities.length===c.length);return p>=0?p:1};function Wt({open:c,onClose:p,onGroupCreated:n,onGroupUpdated:x,editingGroup:i,locale:G,gameMode:o}){const{t}=se(),[d,u]=a.useState(0),[m,r]=a.useState([]),[s,l]=a.useState(!0),[I,L]=a.useState({}),k=Ct(),[w,_]=a.useState(""),[D,P]=a.useState(""),[b,M]=a.useState(1),[F,W]=a.useState([t("intensityLabels.beginner"),t("intensityLabels.intermediate"),t("intensityLabels.advanced")]),[T,f]=a.useState(null),[g,v]=a.useState(!1),[S,V]=a.useState({isValid:!0,errors:[]}),[U,R]=a.useState(!1),[q,j]=a.useState(null),E=a.useCallback(async()=>{try{const C=(await pe(G,o)).filter(B=>!B.isDefault);r(C);const K={};await Promise.all(C.map(async B=>{K[B.id]=await mt(B.name,G,o)})),L(K)}catch(h){console.error("Error reloading groups:",h)}},[G,o]);a.useEffect(()=>{(async()=>{if(c){l(!0);try{await E()}catch(C){console.error("Error loading groups:",C)}finally{l(!1)}}})()},[c,G,o,E]);const O=h=>h.toLowerCase().replace(/[^a-z0-9\s]/g,"").replace(/\s+/g,"_").substring(0,20)||`group_${he(6).toLowerCase()}`;a.useEffect(()=>{i?(f(i),_(i.label),P(i.type||""),W(i.intensities.map(h=>h.label)),M(Fe(i.intensities))):T?(_(T.label),P(T.type||""),W(T.intensities.map(h=>h.label)),M(Fe(T.intensities))):(f(null),_(""),P(""),M(1),W([t("intensityLabels.beginner"),t("intensityLabels.intermediate"),t("intensityLabels.advanced")])),V({isValid:!0,errors:[]})},[i,T,c,t]);const X=h=>{const C=Ie[h];M(h),W(C.intensities.map(K=>t(K.label)))},ne=(h,C)=>{const K=[...F];K[h]=C,W(K)},Q=()=>{F.length>=k.MAX_INTENSITIES_COUNT||W([...F,t("customGroups.levelLabel",{level:F.length+1})])},ee=h=>{if(F.length<=k.MIN_INTENSITIES_COUNT)return;const C=F.filter((K,B)=>B!==h);W(C)};a.useEffect(()=>{(async()=>{if(!w.trim()&&!D&&F.length===0){V({isValid:!0,errors:[]});return}const C=[];if(D&&!k.VALID_GROUP_TYPES.includes(D)&&C.push(t("typeValidationError",{types:k.VALID_GROUP_TYPES.join(", ")})),w.trim()&&!D&&C.push(t("typeRequiredError")),C.length>0){V({isValid:!1,errors:C});return}const K=F.map((He,Je)=>({id:he(),label:He,value:Je+1,isDefault:!1})),B={name:T?T.name:O(w),label:w.trim(),intensities:K,type:D||void 0,locale:G,gameMode:o,isDefault:!1},Ye=await Ve(B,T?.id);V(Ye)})()},[w,D,F,G,o,T,t,k.VALID_GROUP_TYPES]);const z=h=>{f(h),_(h.label),W(h.intensities.map(C=>C.label)),u(1)},re=async h=>{const C=m.find(B=>B.id===h);if(!C)return;const K=I[h]||0;j({id:h,name:C.label,tileCount:K}),R(!0)},me=async()=>{if(!q)return;const{id:h,tileCount:C}=q,K=m.find(B=>B.id===h);if(K)try{C>0&&await gt(K.name,G,o),await ht(h),await E(),x?.(null)}catch(B){console.error("Error deleting group:",B)}finally{R(!1),j(null)}},qe=async()=>{if(!(!S.isValid||g)){v(!0);try{const h=F.map((K,B)=>({id:he(),label:K,value:B+1,isDefault:!1})),C={name:T?T.name:O(w),label:w.trim(),intensities:h,type:D||void 0,locale:G,gameMode:o,isDefault:!1};if(T)await Oe(T.id,C),x?.(T);else{const K=await Pe(C);K&&n?.({...C,id:K,createdAt:new Date,updatedAt:new Date,isDefault:!1,locale:G,gameMode:o})}De(),p()}catch(h){console.error("Error saving custom group:",h),V({isValid:!1,errors:[t("failedToSaveGroup",{error:h})]})}finally{v(!1)}}},De=()=>{f(null),_(""),P(""),M(1),W([t("intensityLabels.beginner"),t("intensityLabels.intermediate"),t("intensityLabels.advanced")]),V({isValid:!0,errors:[]})};return e.jsxs(e.Fragment,{children:[e.jsxs(ye,{open:c,onClose:p,maxWidth:"md",fullWidth:!0,PaperProps:{sx:{minHeight:"600px"}},children:[e.jsxs(be,{children:[t("customGroups.manageCustomGroups"),e.jsx(y,{variant:"body2",color:"text.secondary",sx:{mt:1},children:t("customGroups.createNewGroupsDescription")}),e.jsxs(Xe,{value:d,onChange:(h,C)=>{u(C),C===1&&!T&&De()},sx:{mt:2,borderBottom:1,borderColor:"divider"},children:[e.jsx(Le,{label:t("customGroups.existingGroups")}),e.jsx(Le,{label:t(T?"customGroups.editGroup":"customGroups.createNew")})]})]}),e.jsxs(je,{dividers:!0,children:[d===0&&e.jsx(N,{children:s?e.jsx(y,{children:t("Loading groups...")}):m.length===0?e.jsx(y,{color:"text.secondary",sx:{textAlign:"center",py:4},children:t("customGroups.noCustomGroupsFound")}):e.jsx(Qe,{children:m.map((h,C)=>e.jsxs(Ze.Fragment,{children:[e.jsxs(et,{children:[e.jsx(tt,{primary:h.label,secondary:e.jsxs(N,{component:"span",sx:{display:"block"},children:[e.jsxs(y,{variant:"body2",color:"text.secondary",component:"span",sx:{display:"block"},children:[t("customGroups.intensityLevelsCount",{count:h.intensities.length}),": ",h.intensities.map(K=>K.label).join(", ")]}),e.jsx(y,{variant:"body2",color:"text.secondary",component:"span",sx:{display:"block",mt:.5},children:t("customGroups.customTilesCount",{count:I[h.id]||0})})]})}),e.jsxs(st,{children:[e.jsx(ie,{edge:"end","aria-label":"edit",onClick:()=>z(h),sx:{mr:1},children:e.jsx(ze,{})}),e.jsx(ie,{edge:"end","aria-label":"delete",onClick:()=>re(h.id),color:"error",children:e.jsx(Ge,{})})]})]}),C<m.length-1&&e.jsx($e,{})]},h.id))})}),d===1&&e.jsxs(N,{sx:{display:"flex",flexDirection:"column",gap:3},children:[!S.isValid&&e.jsx(Me,{severity:"error",children:S.errors.map((h,C)=>e.jsx("div",{children:h},C))}),e.jsxs(N,{sx:{p:2,bgcolor:"background.paper",borderRadius:1,border:"1px solid",borderColor:"divider"},children:[e.jsx(y,{variant:"h6",sx:{mb:2},children:t("customGroups.groupInformation")}),e.jsx(te,{label:t("customGroups.groupLabel"),value:w,onChange:h=>_(h.target.value),placeholder:"e.g., My Custom Group",helperText:t("customGroups.groupLabelHelp",{maxLength:k.MAX_GROUP_LABEL_LENGTH}),fullWidth:!0,required:!0,error:w.trim().length>0&&!It(w).isValid,sx:{mb:2}}),e.jsxs(te,{select:!0,label:t("customGroups.groupType"),value:D,onChange:h=>P(h.target.value),helperText:t("customGroups.groupTypeHelp"),fullWidth:!0,required:!0,error:w.trim().length>0&&!D,sx:{mb:2},children:[e.jsx($,{value:"",children:e.jsx("em",{children:t("groupTypes.selectType")})}),e.jsx($,{value:"solo",children:t("groupTypes.solo")}),e.jsx($,{value:"foreplay",children:t("groupTypes.foreplay")}),e.jsx($,{value:"sex",children:t("groupTypes.sex")}),e.jsx($,{value:"consumption",children:t("groupTypes.consumption")})]}),e.jsxs(N,{sx:{display:"flex",flexDirection:"column",gap:.5},children:[e.jsxs(y,{variant:"body2",color:"text.secondary",children:[e.jsx("strong",{children:t("customGroups.locale")})," ",G," |"," ",e.jsx("strong",{children:t("customGroups.gameMode")})," ",o]}),T?e.jsxs(y,{variant:"body2",color:"text.secondary",children:[e.jsx("strong",{children:t("customGroups.internalId")})," ",T.name," ","(locked)"]}):e.jsxs(y,{variant:"body2",color:"text.secondary",children:[e.jsx("strong",{children:t("customGroups.internalId")})," ",w?O(w):t("customGroups.autoGenerated")]})]})]}),e.jsxs(N,{sx:{display:"flex",alignItems:"center",gap:2,p:2,bgcolor:"action.hover",borderRadius:1},children:[e.jsx(y,{variant:"body2",sx:{fontWeight:"medium",minWidth:"auto"},children:t("customGroups.quickStart")}),e.jsx(te,{select:!0,value:b,onChange:h=>X(Number(h.target.value)),size:"small",sx:{minWidth:200},label:t("customGroups.chooseTemplate"),children:Ie.map((h,C)=>e.jsx($,{value:C,children:h.name==="Basic (1-4)"?t("templateBasic"):h.name==="Simple (1-3)"?t("templateSimple"):h.name==="Extended (1-5)"?t("templateExtended"):h.name},C))}),e.jsx(y,{variant:"body2",color:"text.secondary",sx:{fontSize:"0.75rem"},children:t("customGroups.selectTemplateDescription")})]}),e.jsxs(N,{children:[e.jsxs(y,{variant:"h6",sx:{mb:2},children:[t("customGroups.intensityLabels")," (",F.length,"/",k.MAX_INTENSITIES_COUNT,")"]}),e.jsx(y,{variant:"body2",color:"text.secondary",sx:{mb:2},children:t("customGroups.customizeIntensityDescription")}),e.jsxs(N,{sx:{display:"flex",flexDirection:"column",gap:1.5},children:[F.map((h,C)=>e.jsxs(N,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(y,{variant:"body2",sx:{minWidth:"30px",fontWeight:"bold",color:"primary.main"},children:C+1}),e.jsx(te,{label:t("customGroups.levelInputLabel",{level:C+1}),value:h,onChange:K=>ne(C,K.target.value),size:"small",sx:{flex:1},inputProps:{maxLength:k.MAX_INTENSITY_LABEL_LENGTH}}),e.jsx(ie,{onClick:()=>ee(C),disabled:F.length<=k.MIN_INTENSITIES_COUNT,color:"error",size:"small",children:e.jsx(Ge,{})})]},C)),e.jsx(Z,{startIcon:e.jsx(wt,{}),onClick:Q,disabled:F.length>=k.MAX_INTENSITIES_COUNT,variant:"outlined",size:"small",sx:{alignSelf:"flex-start",mt:1},children:t("customGroups.addIntensityLevel")})]})]})]})]}),e.jsxs(Ae,{children:[e.jsx(Z,{onClick:p,disabled:g,children:t("cancel")}),e.jsx(Z,{onClick:qe,variant:"contained",disabled:!S.isValid||g,children:t(g?"customGroups.saving":T?"customGroups.updateGroup":"customGroups.createGroup")})]})]}),e.jsxs(ye,{open:U,onClose:()=>R(!1),children:[e.jsx(be,{children:t("customGroups.confirmDelete")}),e.jsx(je,{children:e.jsx(y,{children:(q?.tileCount??0)>0?t("customGroups.deleteGroupWithTiles",{name:q?.name,count:q?.tileCount}):t("customGroups.deleteGroupConfirm",{name:q?.name})})}),e.jsxs(Ae,{children:[e.jsx(Z,{onClick:()=>R(!1),children:t("cancel")}),e.jsx(Z,{onClick:me,color:"error",variant:"contained",children:t("delete")})]})]})]})}function Kt({setSubmitMessage:c,boardUpdated:p,customTiles:n,mappedGroups:x,expanded:i,handleChange:G,tagList:o,updateTileId:t,setUpdateTileId:d}){const{t:u}=se(),{settings:m}=Ee(),[r,s]=a.useState({gameMode:m.gameMode||"online",group:"",intensity:"",action:"",tags:[u("custom")]}),[l,I]=a.useState(!1),[L,k]=a.useState(""),[w,_]=a.useState(0);a.useEffect(()=>{const v=setTimeout(async()=>{if(!r.group||!r.intensity||!r.action){k("");return}try{const S=await _e({group:r.group,intensity:Number(r.intensity),action:r.action,tags:r.tags,gameMode:r.gameMode,isCustom:1},m.locale||"en",r.gameMode);S.isValid?k(""):k(S.errors.join(", "))}catch(S){console.error("Error validating tile:",S),k("")}},300);return()=>clearTimeout(v)},[r.group,r.intensity,r.action,r.gameMode,r.tags,m.locale]),a.useEffect(()=>{const v=(Array.isArray(n)?n:[]).find(({id:S})=>S===t);if(v){const S=v.gameMode||m.gameMode;s({gameMode:S,group:v.group||"",intensity:v.intensity||"",action:v.action||"",tags:v.tags||[u("custom")]})}else s(S=>({...S,gameMode:m.gameMode}))},[t,m.gameMode,n,u]);function D(g,v,S){return(Array.isArray(n)?n:[]).find(U=>U.group===g&&U.intensity===v&&U.action===S)}function P(){d(null),s({gameMode:m.gameMode,group:"",intensity:"",action:"",tags:[u("custom")]}),k("")}const b=g=>{s(v=>({...v,group:g.name,intensity:""})),I(!1),_(v=>v+1)},M=()=>{_(g=>g+1)},F=a.useCallback(g=>{s(v=>({...v,intensity:g.toString()}))},[]);async function W(){const g=document.querySelector('input[name="tags"]'),v=[...r.tags];g&&g.value.trim()&&(v.push(g.value.trim()),g.value="");const{gameMode:S,group:V,intensity:U,action:R}=r;if(!S||!V||!U||!R)return c({message:u("allFieldsRequired","All fields are required"),type:"error"});if(L)return c({message:L,type:"error"});if(t==null&&D(V,U,R))return c({message:u("actionExists"),type:"error"});const q={group:V,intensity:Number(U),action:R,tags:v,gameMode:S,isCustom:1};try{const j=await _e(q,m.locale||"en",S);if(!j.isValid)return c({message:j.errors.join(", "),type:"error"});if(t===null){const E=`${V} - Level ${U}`;Re(E,R),await we(q)}else await Ke(t,q);return p(),s(E=>({...E,action:"",tags:[u("custom")]})),c({message:u(t?"customUpdated":"customAdded"),type:"success"})}catch(j){return console.error("Error saving custom tile:",j),c({message:u("errorSavingTile"),type:"error"})}}const T=g=>{switch(g.key){case",":case"Enter":{g.preventDefault(),g.stopPropagation(),g.currentTarget.value.length>0&&(s(v=>({...v,tags:[...v.tags,g.currentTarget.value]})),g.currentTarget.value="");break}}},f=g=>{g.target.value.length>0&&(s(v=>({...v,tags:[...v.tags,g.target.value]})),g.target.value=""),setTimeout(()=>{const v=document.querySelector(".MuiAutocomplete-popper");v&&(v.style.display="none")},150)};return e.jsxs(e.Fragment,{children:[e.jsxs(oe,{expanded:i==="ctAdd",onChange:G("ctAdd"),children:[e.jsx(le,{"aria-controls":"ctAdd-content",id:"ctAdd-header",children:e.jsx(y,{children:e.jsx(A,{i18nKey:t?"ctUpdate":"ctAdd"})})}),e.jsx(ce,{children:e.jsxs(N,{component:"form",method:"post",className:"settings-box",children:[e.jsxs(te,{select:!0,label:u("customTiles.gameMode"),value:r.gameMode,onChange:g=>{s(v=>({...v,gameMode:g.target.value,group:"",intensity:""}))},fullWidth:!0,sx:{mb:2},children:[e.jsx("option",{value:"online",children:u("online")}),e.jsx("option",{value:"local",children:u("local")}),e.jsx("option",{value:"solo",children:u("solo")})]}),e.jsx(Ot,{value:r.group,onChange:g=>{s(v=>({...v,group:g,intensity:""}))},locale:m.locale||"en",gameMode:r.gameMode,refreshTrigger:w}),e.jsx(N,{sx:{mt:2},children:e.jsx(Pt,{groupName:r.group,value:Number(r.intensity)||0,onChange:F,locale:m.locale||"en",gameMode:r.gameMode})}),L&&e.jsx(N,{sx:{mt:1,mb:2},children:e.jsx(y,{color:"error",variant:"body2",children:L})}),e.jsx(te,{id:"action",name:"action",required:!0,fullWidth:!0,label:u("action"),sx:{mt:2,pb:2},value:r.action,onChange:g=>{s({...r,action:g.target.value})}}),e.jsx(nt,{id:"tags",disableCloseOnSelect:!0,multiple:!0,freeSolo:!0,options:o,value:r.tags,onChange:(g,v)=>{s({...r,tags:v})},renderInput:g=>(g.inputProps.onKeyDown=T,g.inputProps.onBlur=f,e.jsx(te,{...g,label:u("tags")})),sx:{pb:2},clearOnBlur:!0,blurOnSelect:!0,openOnFocus:!0,disablePortal:!1,componentsProps:{popper:{modifiers:[{name:"preventOverflow",options:{altAxis:!0,altBoundary:!0,padding:8}}]}}}),e.jsxs(N,{display:"flex",justifyContent:"space-evenly",gap:1,children:[e.jsx(Z,{variant:"outlined",type:"button",onClick:()=>I(!0),children:u("manageGroups")}),e.jsx(Z,{variant:"contained",type:"button",onClick:()=>P(),children:e.jsx(A,{i18nKey:"clear"})}),e.jsx(Z,{variant:"contained",type:"button",onClick:W,children:e.jsx(A,{i18nKey:t?"ctUpdate":"ctAdd"})})]})]})})]}),e.jsx(Wt,{open:l,onClose:()=>I(!1),onGroupCreated:b,onGroupUpdated:M,locale:m.locale||"en",gameMode:r.gameMode})]})}function Rt({expanded:c,handleChange:p}){return e.jsxs(e.Fragment,{children:[e.jsxs(oe,{expanded:c==="help1",onChange:p("help1"),children:[e.jsx(le,{"aria-controls":"help1-content",id:"help1-header",children:e.jsx(y,{children:e.jsx(A,{i18nKey:"ctExplained"})})}),e.jsx(ce,{children:e.jsxs(A,{i18nKey:"ctExplainedDescription",children:[e.jsx(y,{sx:{mb:2},children:"Custom tiles let you add your own variations to the game board. Utilize this dialog to add and remove tiles as you see fit."}),e.jsx(y,{sx:{mb:2},children:"Custom tiles are added based on the kink and intensity you pick from the drop down. As such, you need to have that kink and intensity (or a higher intensity) selected for your custom tiles to show on the board."}),e.jsx(y,{children:"Miscellaneous tiles are the only exception to the above. Regardless of what other options you pick, Miscellaneous tiles will show as their own group. If you use this option, ensure that you add multiple tiles to minimize repeats."})]})})]}),e.jsxs(oe,{expanded:c==="help2",onChange:p("help2"),children:[e.jsx(le,{"aria-controls":"help2-content",id:"help2-header",children:e.jsx(y,{children:e.jsx(A,{i18nKey:"ctIdeas"})})}),e.jsx(ce,{children:e.jsxs(A,{i18nKey:"ctIdeasDescription",children:[e.jsx(y,{variant:"h6",children:"Add new Activities"}),e.jsx(y,{variant:"subtitle2",sx:{mb:2},children:"Come up with new activities that are not part of the existing list"}),e.jsx(y,{variant:"h6",children:"Add harder tiles to easier intensities"}),e.jsx(y,{variant:"subtitle2",sx:{mb:1},children:"When you pick higher intensity levels, the game will use the earlier intensity level and gradual move to whatyou picked. If you want harder tiles early on, add several to lower intensities."}),e.jsx(y,{variant:"subtitle2",sx:{mb:2},children:"Example: You play Poppers - Advanced. Add advanced tiles to Poppers - Beginner"}),e.jsx(y,{variant:"h6",children:"Combine activities into a single tile"}),e.jsx(y,{variant:"subtitle2",sx:{mb:1},children:"Combine multiple activites together in a single tile that normally would not go together."}),e.jsx(y,{variant:"subtitle2",sx:{mb:2},children:"Example: Spit roast. Use a toy in your throat and ass at the same time."}),e.jsx(y,{variant:"h6",children:"Miscellaneous custom tiles"}),e.jsx(y,{variant:"subtitle2",sx:{mb:1},children:"Miscellaneous tiles allow you to add your own tiles without including other groups. Be aware, you will want to add several options to this group to minimize repeats."})]})})]})]})}function Vt({gameMode:c,groupFilter:p,intensityFilter:n,groups:x,mappedGroups:i,dexieGroups:G,onGameModeChange:o,onGroupChange:t,onIntensityChange:d,hideAll:u=!1,sx:m={}}){const{t:r}=se(),[s,l]=a.useState([]),I=u?1:"all",L=a.useMemo(()=>{if(!i?.[c])return[];const b=Ue(i[c]);return Array.isArray(b)?b:[]},[i,c]),k=a.useCallback(b=>{if(G?.[b])return G[b].label||b;const M=L.find(F=>F.value===b);return M?.groupLabel?M.groupLabel:b},[G,L]),w=a.useCallback((b,M)=>{if(G?.[b]){const W=G[b].intensities.find(T=>T.value===Number(M));if(W?.label)return W.label}const F=L.find(W=>W.value===b&&W.intensity===Number(M));return F?.translatedIntensity?F.translatedIntensity:`Level ${Number(M)+1}`},[G,L]);a.useEffect(()=>{if(x){const b=Object.keys(x);l(b)}},[x,c]);function _(b){const M=b.target.value;t(M),d(I)}if(!s?.length)return null;const D=s.length===0||s.includes(p)?p:"",P=n==="all"?"all":n;return e.jsxs(N,{sx:{display:"flex",flexWrap:"wrap",gap:2,...m},children:[e.jsxs(Y,{sx:{width:125,flexShrink:0},children:[e.jsx(H,{id:"game-mode-filter-label",children:e.jsx(A,{i18nKey:"customTiles.gameMode"})}),e.jsxs(J,{labelId:"game-mode-filter-label",id:"game-mode-filter",value:c,label:r("customTiles.gameMode","Game Mode"),onChange:b=>{o(b.target.value)},slotProps:{input:{"aria-label":r("customTiles.gameMode","Game Mode")}},children:[e.jsx($,{value:"online",children:e.jsx(A,{i18nKey:"online"})}),e.jsx($,{value:"local",children:e.jsx(A,{i18nKey:"local"})})]})]}),e.jsxs(Y,{sx:{minWidth:150,flex:1},children:[e.jsx(H,{id:"group-filter-label",children:e.jsx(A,{i18nKey:"group"})}),e.jsx(J,{labelId:"group-filter-label",id:"group-filter",value:D,label:r("group"),onChange:_,slotProps:{input:{"aria-label":r("group")}},children:s.map(b=>e.jsxs($,{value:b,children:[k(b),!u&&x[b]&&` (${x[b].count})`]},b))})]}),e.jsxs(Y,{sx:{minWidth:200,flex:1},disabled:!D,children:[e.jsx(H,{id:"intensity-filter-label",children:e.jsx(A,{i18nKey:"customTiles.intensityLevel",children:"Intensity Level"})}),e.jsxs(J,{labelId:"intensity-filter-label",id:"intensity-filter",value:P,label:r("customTiles.intensityLevel","Intensity Level"),onChange:b=>d(b.target.value),slotProps:{input:{"aria-label":r("customTiles.intensityLevel","Intensity Level")}},children:[!u&&e.jsx($,{value:"all",children:e.jsx(A,{i18nKey:"all",children:"All"})},"all"),D&&x&&x[D]&&Object.entries(x[D].intensities||{}).sort(([b],[M])=>Number(b)-Number(M)).map(([b,M])=>e.jsxs($,{value:Number(b),children:[w(D,b),!u&&M!==void 0?` (${M})`:""]},b))]})]})]})}function zt({tagList:c,boardUpdated:p,mappedGroups:n,updateTile:x,refreshTrigger:i}){const{t:G,i18n:o}=se(),{settings:t}=Ee(),[d,u]=a.useState(null),[m,r]=a.useState(t.gameMode||"online"),[s,l]=a.useState(""),[I,L]=a.useState(""),[k,w]=a.useState(1),[_,D]=a.useState(!0),[P,b]=a.useState({items:[],total:0,totalPages:1}),[M,F]=a.useState({}),[W,T]=a.useState({}),f=10;a.useEffect(()=>{async function j(){try{D(!0);const[E,O]=await Promise.all([pe(o.resolvedLanguage,m),xt(o.resolvedLanguage,m,d)]),X={};E.forEach(z=>{X[z.name]=z}),T(X);const ne={};E.forEach(z=>{const re=O[z.name]||{count:0,intensities:{}};ne[z.name]={label:z.label||z.name,count:re.count,intensities:re.intensities}}),F(ne);const Q=E.map(z=>z.name),ee=Q.includes(s);if((!s||!ee)&&Q.length>0)l(Q[0]),L("all");else if(ee&&I!=="all"){const z=E.find(re=>re.name===s);z&&(z.intensities.map(me=>me.value).includes(Number(I))||L("all"))}}catch(E){console.error("Error loading groups and counts:",E)}finally{D(!1)}}j()},[m,o.resolvedLanguage,d,s,I]),a.useEffect(()=>{let j=!0;async function E(){try{D(!0);const O={group:s,intensity:I==="all"?null:Number(I),tag:d,gameMode:m,locale:t.locale,page:k,limit:f,paginated:!0},X=await Ne(O);j&&(b(X),setTimeout(()=>{j&&D(!1)},300))}catch(O){console.error("Error loading tiles:",O),j&&D(!1)}}return s?E():D(!1),()=>{j=!1}},[s,I,d,m,k,f,i,t.locale]);function g(j){D(!0),u(d===j?null:j)}function v(j,E){D(!0),w(E)}async function S(j){await ft(j),p();const E={group:s,intensity:I==="all"?null:I,tag:d,gameMode:m,locale:t.locale,page:k,limit:f,paginated:!0},O=await Ne(E);b(O)}async function V(j){await yt(j),p(),b(E=>({...E,items:E.items.map(O=>O.id===j?{...O,isEnabled:!O.isEnabled}:O)}))}function U(j){x(j);const E=document.querySelector(".MuiDialogContent-root");E&&(E.scrollTop=0)}function R(j,E){const O=W[j];if(O){const X=O.label||j,Q=O.intensities.find(ee=>ee.value===Number(E))?.label||`Level ${Number(E)+1}`;return`${X} - ${Q}`}return`${j} - Level ${Number(E)+1}`}const q=P.items?.map(({id:j,group:E,intensity:O,action:X,tags:ne,isEnabled:Q=!0,isCustom:ee=!0})=>e.jsxs(rt,{sx:{my:2},children:[e.jsx(it,{title:X,slotProps:{title:{variant:"body1"},subheader:{variant:"body2"},action:{"aria-label":G("customTiles.actions")}},subheader:R(E,O),action:e.jsxs(e.Fragment,{children:[e.jsx(at,{checked:!!Q,onChange:()=>j!==void 0&&V(j),slotProps:{input:{"aria-label":G("customTiles.toggleTile")}}}),!!ee&&e.jsxs(e.Fragment,{children:[e.jsx(ie,{onClick:()=>j!==void 0&&U(j),"aria-label":G("customTiles.update"),children:e.jsx(ze,{})}),e.jsx(ie,{onClick:()=>j!==void 0&&S(j),"aria-label":G("customTiles.delete"),children:e.jsx(Ge,{})})]})]}),sx:{pb:0}}),e.jsx(ot,{children:ne?.map(z=>e.jsx(fe,{label:z==="default"?G("default"):z,sx:{m:.5}},z))})]},j));return e.jsxs(N,{children:[e.jsx(N,{children:c?.map(j=>e.jsx(fe,{label:j,sx:{m:.5},color:d===j?"primary":"default",onClick:()=>g(j)},j))}),e.jsx(N,{sx:{display:"flex",flexDirection:"column",gap:2,my:2,transition:"all 0.3s ease-in-out"},children:e.jsx(Vt,{gameMode:m,groupFilter:s,intensityFilter:I,groups:M,mappedGroups:n,dexieGroups:W,onGameModeChange:j=>{r(j),l(""),L(""),w(1)},onGroupChange:j=>{l(j),w(1)},onIntensityChange:j=>{L(j),w(1)}})}),e.jsxs(N,{sx:{position:"relative",minHeight:"200px"},children:[e.jsx(lt,{in:_,timeout:300,children:e.jsx(N,{sx:{position:"absolute",top:0,left:0,right:0,bottom:0,display:"flex",justifyContent:"center",alignItems:"center",backgroundColor:"rgba(255, 255, 255, 0)",zIndex:1,borderRadius:1},children:e.jsx(Se,{})})}),e.jsx(N,{sx:{opacity:_?.3:1,transition:"opacity 0.3s ease-in-out",pointerEvents:_?"none":"auto"},children:P.items.length===0?e.jsx(y,{variant:"body1",sx:{textAlign:"center",my:4},children:e.jsx(A,{i18nKey:"customTiles.noTilesFound",children:"No tiles found with the selected filters."})}):e.jsxs(e.Fragment,{children:[q,P.totalPages>1&&e.jsx(N,{sx:{display:"flex",justifyContent:"center",mt:3,mb:2},children:e.jsx(ct,{count:P.totalPages,page:k,onChange:v,color:"primary"})}),e.jsx(y,{variant:"body2",sx:{textAlign:"center",mt:2,color:"text.secondary"},children:e.jsxs(A,{i18nKey:"customTiles.showingTiles",values:{shown:P.items.length,total:P.total},children:["Showing ",{shown:P.items.length}," of ",{total:P.total}," tiles"]})})]})})]})]})}function ns({boardUpdated:c,setOpen:p,open:n=!1}){const{t:x,i18n:i}=se(),G=ke(),o=ke("md"),[t,d]=a.useState({message:"",type:"info"}),[u,m]=a.useState("ctAdd"),[r,s]=a.useState(null),[l,I]=a.useState(0),[L,k]=a.useState({online:{},local:{},solo:{}}),[w,_]=a.useState(!0),D=a.useCallback(()=>{I(T=>T+1)},[]),P=T=>(f,g)=>{m(g?T:"")};a.useEffect(()=>{async function T(){_(!0);try{const[f,g,v]=await Promise.all([xe(i.resolvedLanguage,"online"),xe(i.resolvedLanguage,"local"),xe(i.resolvedLanguage,"solo")]);k({online:f,local:g,solo:v})}catch(f){console.error("Error loading game mode actions:",f)}finally{_(!1)}}T()},[i.resolvedLanguage]);const b=ut(()=>ue({locale:i.resolvedLanguage})),M=a.useMemo(()=>b?Array.isArray(b)?b.map(({tags:T})=>T).flat().filter((T,f,g)=>T&&g.indexOf(T)===f).sort():[]:[],[b]),F=a.useCallback(async T=>{await bt(T),c(),D()},[c,D]);if(!b||w)return null;const W=()=>{const T=e.jsxs(e.Fragment,{children:[e.jsx(Rt,{expanded:u,handleChange:P}),e.jsx(Kt,{setSubmitMessage:d,boardUpdated:()=>{c(),D()},customTiles:b,mappedGroups:L,expanded:u,handleChange:P,tagList:M,updateTileId:r,setUpdateTileId:s}),e.jsx($t,{expanded:u,handleChange:P,customTiles:b,mappedGroups:L,setSubmitMessage:d,bulkImport:F})]}),f=Array.isArray(b)&&b.length>0&&e.jsx(N,{children:e.jsx(zt,{tagList:M,boardUpdated:()=>{c(),D()},mappedGroups:L,updateTile:g=>{s(g),m("ctAdd")},refreshTrigger:l})});return o?e.jsxs(e.Fragment,{children:[T,f&&e.jsxs(e.Fragment,{children:[e.jsx($e,{sx:{my:2}}),f]})]}):e.jsxs(ge,{container:!0,spacing:2,children:[e.jsx(ge,{size:{xs:12,md:6},children:T}),e.jsx(ge,{size:{xs:12,md:6},children:f})]})};return e.jsxs(e.Fragment,{children:[e.jsxs(ye,{fullScreen:G,open:n,onClose:()=>p(!1),maxWidth:o?"sm":"lg",fullWidth:!0,children:[e.jsxs(be,{children:[e.jsx(A,{i18nKey:"manageTiles"}),e.jsx(ie,{"aria-label":x("close"),onClick:()=>p(!1),sx:{position:"absolute",right:8,top:8,color:T=>T.palette.grey[500]},children:e.jsx(Et,{})})]}),e.jsx(je,{children:W()})]}),e.jsx(vt,{open:!!t.message,close:()=>d({message:"",type:"info"}),type:t.type,children:t.message})]})}function rs(c={},p={}){const[n]=St(),x={...c,...n,selectedActions:n?.selectedActions||{},...p},[i,G]=a.useState(x),{messages:o}=Dt(),[t,d]=a.useState(!1);return a.useEffect(()=>{const u=jt(o,"room");if(u?.settings)try{const m=JSON.parse(u.settings);G(r=>t?r.selectedActions&&Object.keys(r.selectedActions).length>0?{...r,...m,selectedActions:r.selectedActions}:{...r,...m}:(d(!0),{...r,...m}))}catch(m){console.error("Error parsing message settings:",m)}else t||d(!0)},[o,t]),[i,G]}export{ns as C,Ue as g,xe as i,rs as u};
