import{g as v}from"./chunk-B4PEA_xj.js";import{i as y}from"./chunk-BWD_BDpu.js";import{l as h}from"./chunk-yLOK5aTh.js";import{r as g,j as l,am as x}from"./chunk-BCLv-HyH.js";import{u as w}from"./chunk-BMz6ukbJ.js";import{c as k}from"./chunk-C5tDN2aE.js";function I(e){const t=/vimeo\.com\/(\d+)/,o=e.match(t);return`https://player.vimeo.com/video/${o?o[1]:""}?autoplay=1&loop=1&autostart=true`}function $(e){const t=/(?:youtube\.com\/(?:[^/]+\/.+\/|(?:v|e(?:mbed)?)\/|[^#]*[?&]v=|youtu\.be\/)([^"&?/ ]{11})|^(?:[^"&?/ ]{11})$)/,o=e.match(t);return`https://www.youtube.com/embed/${o?o[1]:""}?autoplay=1&loop=1&autostart=true&mute=1&playsinline=1&controls=0&disablekb=1&fs=0&modestbranding=1&rel=0&iv_load_policy=3`}function R(e){const t=/drive\.google\.com\/file\/d\/([^/]+)/,o=e.match(t);return`https://drive.google.com/file/d/${o?o[1]:""}/preview?loop=1`}function U(e){const t=/dropbox\.com\/s\/([^/]+)/,o=e.match(t);return`https://www.dropbox.com/s/${o?o[1]:""}?raw=1`}function B(e){return`https://pornhub.com/embed/${new URL(e).searchParams.get("viewkey")||""}?autoplay=1&loop=1&autostart=true&playsinline=1`}function j(e){const t=e.split("-");return`https://xhamster.com/xembed.php?video=${t[t.length-1]}?autoplay=1&loop=1&autostart=true&playsinline=1`}function A(e){const t=/media\.tenor\.com\/([a-zA-Z0-9_-]+)\/[^/]*\.(mp4|gif|webp)/;if(e.match(t))return e;const r=/tenor\.com\/view\/[^/]*-(\d+)/,n=e.match(r);return`https://tenor.com/embed/${n?n[1]:""}?autoplay=1`}function L(e){const t=/giphy\.com\/gifs\/[^/]*-([a-zA-Z0-9]+)/,o=e.match(t);return`https://media.giphy.com/media/${o?o[1]:""}/giphy.gif`}function M(e){const t=/(?:gfycat\.com|redgifs\.com)\/(?:watch\/)?([a-zA-Z0-9]+)/,o=e.match(t),r=o?o[1]:"";return s(e,["redgifs.com"])?`https://files.redgifs.com/${r}.mp4`:`https://giant.gfycat.com/${r}.mp4`}function P(e){const t=/redtube\.com\/(\d+)/,o=e.match(t);return`https://embed.redtube.com/?id=${o?o[1]:""}&autoplay=true&auto_play=1&playsinline=1&controls=1`}function z(e){const t=/youporn\.com\/watch\/(\d+)/,o=e.match(t);return`https://www.youporn.com/embed/${o?o[1]:""}?autoplay=1&playsinline=1`}function N(e){const t=/tube8\.com\/[^/]+\/[^/]+\/(\d+)/,o=e.match(t);return`https://www.tube8.com/embed/${o?o[1]:""}?autoplay=1&playsinline=1`}function F(e){try{const n=new URL(e);if((n.host==="discordapp.net"||n.host.endsWith(".discordapp.net"))&&n.pathname.startsWith("/external/")&&(n.pathname.includes("/https/i.imgur.com/")||n.pathname.includes("/https/imgur.com/")))return e}catch(n){h.debug("URL parsing failed for Discord proxy check:",n)}let t="",o=!1;try{const n=new URL(e);o=n.host==="imgur.com"||n.host==="i.imgur.com"}catch(n){return h.debug("URL parsing failed for Imgur processing:",n),""}if(!o)return"";if(e.includes("/gallery/")){const n=e.match(/imgur\.com\/gallery\/[^#]*#([a-zA-Z0-9]+)/);if(n)t=n[1];else{const a=e.match(/#([a-zA-Z0-9]+)/);a&&(t=a[1])}}else{const n=/imgur\.com\/([a-zA-Z0-9]+)(?:\.(mp4|jpg|jpeg|png|gif|webp))?|images-ext-\d+\.discordapp\.net\/external\/[^/]+\/https\/i\.imgur\.com\/([a-zA-Z0-9]+)\.(mp4|jpg|jpeg|png|gif|webp)/,a=e.match(n);t=a?a[1]||a[3]:""}return`https://i.imgur.com/${t}.mp4`}function b(e){return/\.(mp4|webm|ogg|mov)(\?.*)?$/.test(e)}function S(e){return s(e,["media.discordapp.net","cdn.discordapp.com"])&&!b(e)}function s(e,t){try{const o=new URL(e);return t.some(r=>o.host===r||o.host.endsWith("."+r))}catch(o){return h.debug("URL parsing failed in isValidHost, rejecting for security:",o),!1}}function Z(e){let t=null,o=!0;if(!e)return{url:"",isVideo:!1};switch(!0){case s(e,["vimeo.com"]):t=I(e);break;case s(e,["youtube.com","youtu.be"]):t=$(e);break;case s(e,["drive.google.com"]):t=R(e);break;case s(e,["pornhub.com"]):t=B(e);break;case s(e,["xhamster.com"]):t=j(e);break;case s(e,["dropbox.com"]):t=U(e);break;case s(e,["imgur.com","i.imgur.com"]):t=F(e);break;case s(e,["tenor.com","media.tenor.com"]):t=A(e),o=!0;break;case s(e,["giphy.com"]):t=L(e),o=!0;break;case s(e,["gfycat.com","redgifs.com"]):t=M(e),o=!0;break;case s(e,["redtube.com"]):t=P(e);break;case s(e,["youporn.com"]):t=z(e);break;case s(e,["tube8.com"]):t=N(e);break;case s(e,["twitter.com","x.com"]):t=e,o=!1;break;case s(e,["thisvid.com"]):t=e;break;case s(e,["boyfriendtv.com"]):t=e;break;case S(e):t=e,o=!1;break;case b(e):t=e;break;default:t=v(e),o=!1;break}return{url:t,isVideo:o}}function W(e,t){const{background:o,backgroundURL:r,roomBackground:n,roomBackgroundURL:a}=e,m=(d,u)=>{if(!d)return null;if(d==="custom")return u?a||null:r||null;if(d==="useAppBackground"){const i=o||"color";return i==="useRoomBackground"?"color":i==="custom"?r||null:i}if(d==="useRoomBackground"){if(y(t))return"color";const i=n||"useAppBackground";return i==="useAppBackground"?"color":i==="custom"?a||null:i}return d};let c=null;return!y(t)&&n&&n!=="useAppBackground"?c=m(n,!0):o?c=m(o,!1):c="color",c?c==="color"||c==="gray"?{url:c,isVideo:!1}:Z(c):{url:null,isVideo:!1}}function E(e){return{uid:e.uid,displayName:e.displayName,isSelf:e.isSelf,isFinished:e.isFinished}}function O(e){const[t,o]=g.useState(null),r=w(),n=g.useMemo(()=>r.map(m=>`${m.uid}-${m.displayName}-${m.isFinished}-${m.isSelf}`).join("|"),[r]),a=g.useMemo(()=>e?`${e.uid}-${e.displayName||""}`:null,[e]);return g.useEffect(()=>{if(!e){o(null);return}if(r.length<=1){o(null);return}const m=r.filter(i=>!i.isFinished);if(m.length<=1){o(null);return}let c=-1;c=m.findIndex(i=>i.uid===e.uid),c===-1&&(c=m.findIndex(i=>i.displayName===e.displayName)),c===-1&&(c=0);const p=(c+1)%m.length,d=m[p],u=E(d);o(u)},[a,n]),t}function H({url:e}){const[t,o]=g.useState("video"),[r,n]=g.useState(e);if(g.useEffect(()=>{n(e),o("video")},[e]),!e)return null;const a=()=>{let c=!1;try{const u=new URL(e);c=u.host==="imgur.com"||u.host==="i.imgur.com"}catch{c=!1}if(c){const u=e.match(/imgur\.com\/([a-zA-Z0-9]+)/)?.[1];if(u){const i=`https://i.imgur.com/${u}.jpg`;n(i),o("image");return}}const d=`${e.replace(/\.(mp4|webm|ogg|mov)(\?.*)?$/i,"")}.jpg`;n(d),o("image")},m=()=>{let c=!1;try{const p=new URL(e);c=p.host==="imgur.com"||p.host==="i.imgur.com"}catch{c=!1}if(c){const p=e.match(/imgur\.com\/([a-zA-Z0-9]+)/)?.[1];if(p){const d=["png","gif","jpeg","webp"],u=r?.split(".").pop(),i=d.find(f=>f!==u);if(i){const f=`https://i.imgur.com/${p}.${i}`;n(f)}}}else{const p=["png","gif","jpeg","webp"],d=r?.split(".").pop(),u=p.find(i=>i!==d);if(u&&r){const f=`${r.replace(/\.[^.]+(\?.*)?$/,"")}.${u}`;n(f)}}};return t==="video"?l.jsx("video",{autoPlay:!0,loop:!0,muted:!0,playsInline:!0,src:r||void 0,className:"video-background",onError:a,preload:"auto",crossOrigin:"anonymous",controls:!0}):l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"image-background",style:{backgroundImage:`url(${r})`,backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat",width:"100%",height:"100%",position:"absolute",top:0,left:0}}),l.jsx("img",{src:r||void 0,onError:m,style:{display:"none"},alt:""})]})}function q({url:e=null,isVideo:t=null}){const o=typeof window<"u"&&(window.location.search.includes("receiver=true")||window.location.search.includes("chromecast=true")||navigator.userAgent.includes("CrKey")||navigator.userAgent.includes("TV")),r=e&&/\.(mp4|webm|ogg|mov|gif)(\?.*)?$/i.test(e),n=e==="color"||e==="gray"||e?.includes("/color")||e?.includes("/gray"),a=e&&!n&&(t||!t&&e);return l.jsx(x,{className:k("main-container",!a&&"default-background"),role:"presentation",sx:{backgroundImage:!t&&e&&!n?`url(${e})`:"none"},children:t&&(r||o?l.jsx(H,{url:e}):l.jsx("iframe",{width:"100%",height:"100%",src:e||void 0,title:"video",allow:"autoplay; fullscreen; encrypted-media; picture-in-picture",sandbox:"allow-same-origin allow-scripts allow-presentation",style:{border:0}}))})}export{q as R,W as g,Z as p,O as u};
