import{a7 as U,ad as w,r as t,j as E}from"./chunk-CJVoFoqV.js";import{a as R}from"./chunk-DvmTZbFC.js";import{u as S}from"./chunk-Buz77Oyr.js";import"./chunk-CsdNKD0V.js";import"../assets/index-BHUshCQG.js";import"./chunk-CdWLCell.js";(function(){var n=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};n.SENTRY_RELEASE={id:"8380c411008c81db0d03192c8a87321e8e40e84f"}})();try{(function(){var n=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},e=new n.Error().stack;e&&(n._sentryDebugIds=n._sentryDebugIds||{},n._sentryDebugIds[e]="16825557-318e-47ff-aa06-b9ef869d849b",n._sentryDebugIdIdentifier="sentry-dbid-16825557-318e-47ff-aa06-b9ef869d849b")})()}catch{}function v(n){if(!n||typeof n!="object")return!1;const e=n;return typeof e.displayName=="string"&&typeof e.uid=="string"&&(e.lastSeen instanceof Date||typeof e.lastSeen=="number"||typeof e.lastSeen=="string")}const h=U.createContext(void 0);function P(n){const{id:e}=w(),{onlineUsers:i,setUsers:l,setRoom:a,clearUsers:o,flushPendingUpdates:u}=S(),f=t.useRef(null),d=t.useRef(e),c=t.useCallback(p=>{if(p===null)o();else{const b={};Object.entries(p).forEach(([y,r])=>{if(v(r)){const m={...r,lastSeen:r.lastSeen instanceof Date?r.lastSeen:new Date(r.lastSeen)};b[y]=m}else console.warn(`Invalid user data for uid ${y}:`,r)}),l(b)}},[l,o]),s=t.useCallback(()=>{f.current&&(f.current(),f.current=null),u()},[u]);t.useEffect(()=>{if(d.current!==e&&(a(e||null),d.current=e),!e){s(),o();return}return s(),R(e,c),f.current=null,s},[e,a,o,c,s]),t.useEffect(()=>s,[s]);const g=t.useMemo(()=>({onlineUsers:i}),[i]);return E.jsx(h.Provider,{value:g,...n})}export{h as UserListContext,P as UserListProvider};
//# sourceMappingURL=userList.tsx-CDfNYHwG.js.map
