const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["js/userList.tsx-CWf72k_f.js","js/chunk-gLqOAnAo.js","js/chunk-D9KXFDlS.js","js/chunk-Ce3NdNab.js","js/chunk-DF6sfhGu.js","js/chunk-DFT8axIh.js","js/chunk-Cxiyhgvx.js","js/index.tsx-Bi7nBfs_.js","js/chunk-VapU_6Ln.js","js/chunk-C9KfLBvM.js","assets/index-40AaoPFR.js","js/chunk-CoT3YRZL.js","js/chunk-DfmEhtRA.js","js/index.tsx-DQVCdLLc.js","js/index.tsx-BlFGTCeC.js","js/chunk-C69zMA5l.js","js/chunk-o-iJoEXR.js","js/chunk-BhiRFd-u.js","js/chunk-DdEKJDdy.js","js/chunk-BRW-j_h2.js","js/chunk-BpLDF4zL.js","js/chunk-BxKR8B91.js","js/chunk-qCrWNMY5.js","js/chunk-XmCmKjvy.js","js/chunk-fFmCiWfE.js","js/chunk-yJSp0bHd.js","js/index.tsx-DIysf6jZ.js"])))=>i.map(i=>d[i]);
import{q as E,s as v,_ as c}from"./chunk-Ce3NdNab.js";import{R as C,aj as b,r as u,j as o,ak as R,al as T,am as p,an as D,ao as A,ap as L}from"./chunk-gLqOAnAo.js";import{A as S}from"./chunk-C9KfLBvM.js";import{a as I}from"./chunk-D9KXFDlS.js";import{A as m,l}from"../assets/index-40AaoPFR.js";(function(){var e=typeof window!="undefined"?window:typeof global!="undefined"?global:typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:{};e.SENTRY_RELEASE={id:"ba7d3cfce23f41097f343c1a83f9f2db3c72f794"}})();try{(function(){var e=typeof window!="undefined"?window:typeof global!="undefined"?global:typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:{},s=new e.Error().stack;s&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[s]="f8af4c5d-a2c4-4d7d-8b0f-7ddcd1d716d1",e._sentryDebugIdIdentifier="sentry-dbid-f8af4c5d-a2c4-4d7d-8b0f-7ddcd1d716d1")})()}catch(e){}function y(e){if(!e)return null;try{if(typeof e.toDate=="function")return e.toDate();if(typeof e=="string"){const s=new Date(e);if(isNaN(s.getTime()))throw new Error("Invalid serialized timestamp format");return s}else if(typeof e=="number"){const s=e<3250368e4?e*1e3:e,t=new Date(s);if(isNaN(t.getTime()))throw new Error("Invalid numeric timestamp format");return t}else if(typeof e=="object"&&e.seconds!==void 0){const s=e,t=new Date(s.seconds*1e3+(s.nanoseconds||0)/1e6);if(isNaN(t.getTime()))throw new Error("Invalid Firestore timestamp object format");return t}else{if(e instanceof Date)return e;throw console.warn("Unsupported timestamp format:",typeof e,e),new Error(`Unsupported timestamp format: ${typeof e}`)}}catch(s){return console.warn("Failed to parse timestamp:",s),null}}function h(e){return e.sort((s,t)=>{const r=y(s.timestamp),n=y(t.timestamp);return!r||!n?0:r.getTime()-n.getTime()})}function f(e){return JSON.parse(JSON.stringify(e)).reverse()}function P(e,s){return f(e).find(t=>t.type===s)}function N(e,s,t="ASC"){let r=f(e);return t==="DESC"&&(r=r.reverse()),r.filter(n=>n.type===s)}function K(e,s){return f(e).find(s)}function O(e){return f(e)[0]}const U={messages:[],loading:!0,error:null,room:null,paginationCursor:null},B=I()(E((e,s)=>({...U,loadMessages:t=>{const n=h(t);e({messages:n,loading:!1,error:null})},addMessage:t=>{const{messages:r}=s();if(r.find(i=>i.id===t.id))return;const a=[...r,t],d=h(a);e({messages:d})},updateMessage:(t,r)=>{const{messages:n}=s();let a=!1;const d=n.map(i=>{if(i.id===t){const g={...i,...r};if(Object.keys(r).some(w=>i[w]!==r[w]))return a=!0,g}return i});if(a){const i=h(d);e({messages:i})}},clearMessages:()=>{e({messages:[],loading:!1,error:null})},setLoading:t=>{const{loading:r}=s();r!==t&&e({loading:t})},setError:t=>{const{error:r}=s();r!==t&&e({error:t})},setRoom:t=>{const{room:r}=s();r!==t&&e({room:t})},setPaginationCursor:t=>{const{paginationCursor:r}=s();r!==t&&e({paginationCursor:t})},getMessagesByType:t=>{const{messages:r}=s(),n=[];for(let a=0;a<r.length;a++)r[a].type===t&&n.push(r[a]);return n},getLatestMessage:()=>{const{messages:t}=s();return O(t)},getLatestMessageByType:t=>{const{messages:r}=s();return P(r,t)},getFilteredMessages:t=>{const{messages:r}=s(),n=[];for(let a=0;a<r.length;a++)t(r[a])&&n.push(r[a]);return n},getOrderedMessagesByType:(t,r="ASC")=>{const{messages:n}=s();return N(n,t,r)}}),{name:"messages-storage",partialize:e=>({messages:e.messages,room:e.room,paginationCursor:e.paginationCursor}),onRehydrateStorage:()=>e=>{if(e){const s=new Date;s.setHours(s.getHours()-24);const t=e.messages.filter(r=>{try{const n=y(r.timestamp);if(!n)throw console.warn(`Failed to parse timestamp for message ${r.id}:`,typeof r.timestamp,r.timestamp),new Error(`Failed to parse timestamp for message ${r.id}`);return n>s}catch(n){return console.warn(`Failed to parse message timestamp for message ID ${r.id}:`,n.message),!0}});t.length!==e.messages.length&&e.loadMessages(t)}}})),F=C.createContext(void 0);function x(e){const{id:s}=b(),{messages:t,loading:r,loadMessages:n,setLoading:a,setRoom:d,clearMessages:i}=B();u.useEffect(()=>{if(a(!0),d(s||null),!s){i();return}return v(s,M=>{n(M)})},[s,n,a,d,i]);const g={messages:t,isLoading:r};return o.jsx(F.Provider,{value:g,...e})}const _=l(()=>c(()=>import("./userList.tsx-CWf72k_f.js"),__vite__mapDeps([0,1,2,3,4,5,6])).then(e=>({default:e.UserListProvider}))),k=l(()=>c(()=>import("./index.tsx-Bi7nBfs_.js"),__vite__mapDeps([7,1,2,8,3,4,5,9,10,11,12,6,13]))),z=l(()=>c(()=>import("./index.tsx-BlFGTCeC.js"),__vite__mapDeps([14,1,2,15,16,12,9,3,4,5,10,6,17,18,19,20]))),V=l(()=>c(()=>import("./chunk-BxKR8B91.js").then(function(e){return e.i}),__vite__mapDeps([21,3,1,2,4,5,22,11,12,9,10,6,19,23,20,24,25,16,17,26,15,18])));function j({children:e}){const{id:s}=b(),t=A(),r=L();return u.useEffect(()=>{if(s&&s!==s.toUpperCase()){const n=r.pathname.replace(s,s.toUpperCase());t(n+r.search+r.hash,{replace:!0})}},[s,t,r]),o.jsx(o.Fragment,{children:e})}function $(){const e=u.useContext(S);if(u.useEffect(()=>(e&&(window.authContext=e),()=>{window.authContext=null}),[e]),!e||e.initializing)return o.jsx(m,{});const s=e.user?o.jsx(V,{}):o.jsx(k,{});return o.jsxs(T,{children:[o.jsx(p,{path:"/",element:o.jsx(D,{replace:!0,to:"/PUBLIC"})}),o.jsx(p,{path:"/:id/cast",element:o.jsx(j,{children:o.jsx(u.Suspense,{fallback:o.jsx(m,{}),children:o.jsx(_,{children:o.jsx(x,{children:o.jsx(z,{})})})})})}),o.jsx(p,{path:"/:id",element:o.jsx(j,{children:o.jsx(u.Suspense,{fallback:o.jsx(m,{}),children:o.jsx(_,{children:o.jsx(x,{children:s})})})})})]})}function H(){return o.jsx(R,{children:o.jsx($,{})})}const Q=Object.freeze({__proto__:null,default:H});export{F as M,K as a,Q as i,P as l,N as o,y as p};
//# sourceMappingURL=chunk-BOQuZLLs.js.map
