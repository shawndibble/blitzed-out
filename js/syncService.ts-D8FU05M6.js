const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["js/syncOrchestrator.ts-B3tqlJBe.js","js/chunk-B6uxn1sA.js","js/chunk-BhF7R1NT.js","js/chunk-BBJIVzQU.js","js/chunk-BCjx6cJl.js","js/chunk-BWo3O9hy.js","assets/index-B8oiQc0B.js","assets/index-C3HF6PXQ.css"])))=>i.map(i=>d[i]);
!function(){try{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{}).SENTRY_RELEASE={id:"8c56366aa217e00acfd7aafcaffac334ddff11c8"}}catch(t){}}();try{(e=(new(t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{}).Error).stack)&&(t._sentryDebugIds=t._sentryDebugIds||{},t._sentryDebugIds[e]="d538516e-d385-4e5d-b02e-dd9b4822e50b",t._sentryDebugIdIdentifier="sentry-dbid-d538516e-d385-4e5d-b02e-dd9b4822e50b")}catch(t){}var t,e;import{m as s,q as n,_ as a,y as r}from"./chunk-B6uxn1sA.js";import{a as i,b as c,d as o,u,e as d}from"../assets/index-B8oiQc0B.js";import{f as l,d as f,g as w,b as y,Q as h}from"./chunk-BCjx6cJl.js";import"./chunk-BhF7R1NT.js";import"./chunk-BBJIVzQU.js";import"./chunk-BWo3O9hy.js";const g=w(),m=d;async function p(){try{const t=await i({}),e=new Map;t.forEach(t=>{const s=`${t.group_id}|${t.intensity}|${t.action}`;e.has(s)||e.set(s,[]),e.get(s).push(t)});for(const[,s]of e)if(s.length>1){s.sort((t,e)=>(t.id||0)-(e.id||0));const t=s[0],e=s.slice(1),n=e.some(t=>0===t.isEnabled);for(const s of e)s.id&&await o(s.id);n&&1===t.isEnabled&&await u(t.id,{isEnabled:0})}return!0}catch(t){return!1}}async function b(){try{const t=(await s({isDefault:!1})).map(t=>r(t.id));return await Promise.all(t),!0}catch(t){return!1}}async function E(){try{const t=(await i({isCustom:0,isEnabled:0})).filter(t=>t.id).map(t=>u(t.id,{isEnabled:1}));return await Promise.all(t),!0}catch(t){return!1}}async function _(t){try{const e=await i({isCustom:0}),s=new Map;e.forEach(t=>{const e=`${t.group_id}|${t.intensity}|${t.action}`;s.set(e,t.id)});const n=[];return t.forEach(t=>{const e=`${t.group_id}|${t.intensity}|${t.action}`,a=s.get(e);a&&n.push(u(a,{isEnabled:0}))}),await Promise.all(n),!0}catch(e){return!1}}async function D(){const t=l().currentUser;if(!t)return!1;try{const e=await i({isCustom:1}),s=await i({isCustom:0,isEnabled:0}),n=100;return s.length>n&&s.splice(n),await h(f(g,"user-data",t.uid),{customTiles:e,disabledDefaults:s,lastUpdated:new Date},{merge:!0}),!0}catch(e){return!1}}async function $(){const t=l().currentUser;if(!t)return!1;try{const e=await s({isDefault:!1});return await h(f(g,"user-data",t.uid),{customGroups:e,lastUpdated:new Date},{merge:!0}),!0}catch(e){return!1}}async function U(){const t=l().currentUser;if(!t)return!1;try{const e=await c();return!e.length||(await h(f(g,"user-data",t.uid),{gameBoards:e,lastUpdated:new Date},{merge:!0}),!0)}catch(e){return!1}}async function j(){const t=l().currentUser;if(!t)return!1;try{const{settings:e}=n.getState(),{localPlayers:s,...a}=e,r=Object.fromEntries(Object.entries(a).filter(([,t])=>void 0!==t));return await h(f(g,"user-data",t.uid),{settings:r,lastUpdated:new Date},{merge:!0}),!0}catch(e){return!1}}async function T(){return await D(),await $(),await U(),await j(),!0}async function I(){const t=l().currentUser;if(!t)return{success:!1,conflicts:["No user logged in"]};try{const e=f(g,"user-data",t.uid),n=await y(e),a=await i({isCustom:1}),r=await s({isDefault:!1}),c=[];if(!n.exists())return await T(),{success:!0};const o=n.data(),u=o.customTiles||[],d=o.customGroups||[];return a.length>0&&u.length>0&&c.push(`Custom tiles: Local has ${a.length}, Firebase has ${u.length}`),r.length>0&&d.length>0&&c.push(`Custom groups: Local has ${r.length}, Firebase has ${d.length}`),c.length>0?{success:!1,conflicts:c}:{success:await C()}}catch(e){return{success:!1,conflicts:["Sync failed due to error"]}}}async function C(t={}){const{SyncOrchestrator:e}=await a(async()=>{const{SyncOrchestrator:t}=await import("./syncOrchestrator.ts-B3tqlJBe.js");return{SyncOrchestrator:t}},__vite__mapDeps([0,1,2,3,4,5,6,7]));return await e.syncFromFirebase(t)}let O=null;function S(t=5){k();const e=60*t*1e3;return O=window.setInterval(async()=>{const t=l();t.currentUser&&!t.currentUser.isAnonymous&&await C()},e),!0}function k(){return!!O&&(window.clearInterval(O),O=null,!0)}window.cleanupTiles=p;export{_ as applyDisabledDefaults,p as cleanupDuplicateTiles,b as clearUserCustomGroups,m as deleteAllCustomTiles,I as intelligentSync,E as resetDisabledDefaults,S as startPeriodicSync,k as stopPeriodicSync,T as syncAllDataToFirebase,$ as syncCustomGroupsToFirebase,D as syncCustomTilesToFirebase,C as syncDataFromFirebase,U as syncGameBoardsToFirebase,j as syncSettingsToFirebase};
//# sourceMappingURL=syncService.ts-D8FU05M6.js.map
