import{g as x}from"./chunk-B4PEA_xj.js";import{i as b,c as k}from"./chunk-CcANclkl.js";import{l as y}from"./chunk-yLOK5aTh.js";import{r as f,j as g,am as w}from"./chunk-BCLv-HyH.js";import{u as I}from"./chunk-BEBdd3U0.js";import{c as $}from"./chunk-C5tDN2aE.js";function R(e){const t=/vimeo\.com\/(\d+)/,o=e.match(t);return`https://player.vimeo.com/video/${o?o[1]:""}?autoplay=1&loop=1&autostart=true`}function U(e){const t=/(?:youtube\.com\/(?:[^/]+\/.+\/|(?:v|e(?:mbed)?)\/|[^#]*[?&]v=|youtu\.be\/)([^"&?/ ]{11})|^(?:[^"&?/ ]{11})$)/,o=e.match(t);return`https://www.youtube.com/embed/${o?o[1]:""}?autoplay=1&loop=1&autostart=true&mute=1&playsinline=1&controls=0&disablekb=1&fs=0&modestbranding=1&rel=0&iv_load_policy=3`}function B(e){const t=/drive\.google\.com\/file\/d\/([^/]+)/,o=e.match(t);return`https://drive.google.com/file/d/${o?o[1]:""}/preview?loop=1`}function j(e){const t=/dropbox\.com\/s\/([^/]+)/,o=e.match(t);return`https://www.dropbox.com/s/${o?o[1]:""}?raw=1`}function A(e){return`https://pornhub.com/embed/${new URL(e).searchParams.get("viewkey")||""}?autoplay=1&loop=1&autostart=true&playsinline=1`}function L(e){const t=e.split("-");return`https://xhamster.com/xembed.php?video=${t[t.length-1]}?autoplay=1&loop=1&autostart=true&playsinline=1`}function z(e){const t=/media\.tenor\.com\/([a-zA-Z0-9_-]+)\/[^/]*\.(mp4|gif|webp)/;if(e.match(t))return e;const r=/tenor\.com\/view\/[^/]*-(\d+)/,n=e.match(r);return`https://tenor.com/embed/${n?n[1]:""}?autoplay=1`}function P(e){const t=/giphy\.com\/gifs\/[^/]*-([a-zA-Z0-9]+)/,o=e.match(t);return`https://media.giphy.com/media/${o?o[1]:""}/giphy.gif`}function M(e){const t=/(?:gfycat\.com|redgifs\.com)\/(?:watch\/)?([a-zA-Z0-9]+)/,o=e.match(t),r=o?o[1]:"";return s(e,["redgifs.com"])?`https://files.redgifs.com/${r}.mp4`:`https://giant.gfycat.com/${r}.mp4`}function N(e){const t=/redtube\.com\/(\d+)/,o=e.match(t);return`https://embed.redtube.com/?id=${o?o[1]:""}&autoplay=true&auto_play=1&playsinline=1&controls=1`}function E(e){const t=/youporn\.com\/watch\/(\d+)/,o=e.match(t);return`https://www.youporn.com/embed/${o?o[1]:""}?autoplay=1&playsinline=1`}function F(e){const t=/tube8\.com\/[^/]+\/[^/]+\/(\d+)/,o=e.match(t);return`https://www.tube8.com/embed/${o?o[1]:""}?autoplay=1&playsinline=1`}function S(e){try{const n=new URL(e);if((n.host==="discordapp.net"||n.host.endsWith(".discordapp.net"))&&n.pathname.startsWith("/external/")&&(n.pathname.includes("/https/i.imgur.com/")||n.pathname.includes("/https/imgur.com/")))return e}catch(n){y.debug("URL parsing failed for Discord proxy check:",n)}let t="",o=!1;try{const n=new URL(e);o=n.host==="imgur.com"||n.host==="i.imgur.com"}catch(n){return y.debug("URL parsing failed for Imgur processing:",n),""}if(!o)return"";if(e.includes("/gallery/")){const n=e.match(/imgur\.com\/gallery\/[^#]*#([a-zA-Z0-9]+)/);if(n)t=n[1];else{const i=e.match(/#([a-zA-Z0-9]+)/);i&&(t=i[1])}}else{const n=/imgur\.com\/([a-zA-Z0-9]+)(?:\.(mp4|jpg|jpeg|png|gif|webp))?|images-ext-\d+\.discordapp\.net\/external\/[^/]+\/https\/i\.imgur\.com\/([a-zA-Z0-9]+)\.(mp4|jpg|jpeg|png|gif|webp)/,i=e.match(n);t=i?i[1]||i[3]:""}return`https://i.imgur.com/${t}.mp4`}function v(e){return/\.(mp4|webm|ogg|mov)(\?.*)?$/.test(e)}function Z(e){return s(e,["media.discordapp.net","cdn.discordapp.com"])&&!v(e)}function s(e,t){try{const o=new URL(e);return t.some(r=>o.host===r||o.host.endsWith("."+r))}catch(o){return y.debug("URL parsing failed in isValidHost, rejecting for security:",o),!1}}function H(e){let t=null,o=!0;if(!e)return{url:"",isVideo:!1};switch(!0){case s(e,["vimeo.com"]):t=R(e);break;case s(e,["youtube.com","youtu.be"]):t=U(e);break;case s(e,["drive.google.com"]):t=B(e);break;case s(e,["pornhub.com"]):t=A(e);break;case s(e,["xhamster.com"]):t=L(e);break;case s(e,["dropbox.com"]):t=j(e);break;case s(e,["imgur.com","i.imgur.com"]):t=S(e);break;case s(e,["tenor.com","media.tenor.com"]):t=z(e),o=!0;break;case s(e,["giphy.com"]):t=P(e),o=!0;break;case s(e,["gfycat.com","redgifs.com"]):t=M(e),o=!0;break;case s(e,["redtube.com"]):t=N(e);break;case s(e,["youporn.com"]):t=E(e);break;case s(e,["tube8.com"]):t=F(e);break;case s(e,["twitter.com","x.com"]):t=e,o=!1;break;case s(e,["thisvid.com"]):t=e;break;case s(e,["boyfriendtv.com"]):t=e;break;case Z(e):t=e,o=!1;break;case v(e):t=e;break;default:t=x(e),o=!1;break}return{url:t,isVideo:o}}function G(e,t){const{background:o,backgroundURL:r,roomBackground:n,roomBackgroundURL:i}=e,a=(d,p)=>{if(!d)return null;if(d==="custom")return p?i||null:r||null;if(d==="useAppBackground"){const c=o||"color";return c==="useRoomBackground"?"color":c==="custom"?r||null:c}if(d==="useRoomBackground"){if(b(t))return"color";const c=n||"useAppBackground";return c==="useAppBackground"?"color":c==="custom"?i||null:c}return d};let m=null;return!b(t)&&n&&n!=="useAppBackground"?m=a(n,!0):o?m=a(o,!1):m="color",m?m==="color"||m==="gray"?{url:m,isVideo:!1}:H(m):{url:null,isVideo:!1}}function D(e){return{uid:e.uid,displayName:e.displayName,isSelf:e.isSelf,isFinished:e.isFinished}}function J(e){const[t,o]=f.useState(null),r=I(),n=f.useMemo(()=>r.map(a=>`${a.uid}-${a.displayName}-${a.isFinished}-${a.isSelf}`).join("|"),[r]),i=f.useMemo(()=>e?`${e.uid}-${e.displayName||""}`:null,[e]);return f.useEffect(()=>{if(!e){o(null);return}if(r.length<=1){o(null);return}const a=r.filter(c=>!c.isFinished);if(a.length<=1){o(null);return}let m=-1;m=a.findIndex(c=>c.uid===e.uid),m===-1&&(m=a.findIndex(c=>c.displayName===e.displayName)),m===-1&&(m=0);const u=(m+1)%a.length,d=a[u],p=D(d);o(p)},[i,n]),t}function T({url:e,isMobile:t}){const[o,r]=f.useState("video"),[n,i]=f.useState(e);if(f.useEffect(()=>{i(e),r("video")},[e]),!e)return null;const a=()=>{let u=!1;try{const c=new URL(e);u=c.host==="imgur.com"||c.host==="i.imgur.com"}catch{u=!1}if(u){const c=e.match(/imgur\.com\/([a-zA-Z0-9]+)/)?.[1];if(c){const l=`https://i.imgur.com/${c}.jpg`;i(l),r("image");return}}const p=`${e.replace(/\.(mp4|webm|ogg|mov)(\?.*)?$/i,"")}.jpg`;i(p),r("image")},m=()=>{let u=!1;try{const d=new URL(e);u=d.host==="imgur.com"||d.host==="i.imgur.com"}catch{u=!1}if(u){const d=e.match(/imgur\.com\/([a-zA-Z0-9]+)/)?.[1];if(d){const p=["png","gif","jpeg","webp"],c=n?.split(".").pop(),l=p.find(h=>h!==c);if(l){const h=`https://i.imgur.com/${d}.${l}`;i(h)}}}else{const d=["png","gif","jpeg","webp"],p=n?.split(".").pop(),c=d.find(l=>l!==p);if(c&&n){const h=`${n.replace(/\.[^.]+(\?.*)?$/,"")}.${c}`;i(h)}}};return o==="video"?g.jsx("video",{autoPlay:!0,loop:!0,muted:!0,playsInline:!0,src:n||void 0,className:"video-background",onError:a,preload:"auto",crossOrigin:"anonymous",controls:t,style:{marginBottom:t?"48px":"0",height:t?"calc(100vh - 48px)":"100vh"}}):g.jsxs(g.Fragment,{children:[g.jsx("div",{className:"image-background",style:{backgroundImage:`url(${n})`,backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat",width:"100%",height:"100%",position:"absolute",top:0,left:0}}),g.jsx("img",{src:n||void 0,onError:m,style:{display:"none"},alt:""})]})}function Q({url:e=null,isVideo:t=null}){const o=k(),r=typeof window<"u"&&(window.location.search.includes("receiver=true")||window.location.search.includes("chromecast=true")||navigator.userAgent.includes("CrKey")||navigator.userAgent.includes("TV")),n=e&&/\.(mp4|webm|ogg|mov|gif)(\?.*)?$/i.test(e),i=e==="color"||e==="gray"||e?.includes("/color")||e?.includes("/gray"),a=e&&!i&&(t||!t&&e);return g.jsx(w,{className:$("main-container",!a&&"default-background",o&&t&&"mobile-video-background"),role:"presentation",sx:{backgroundImage:!t&&e&&!i?`url(${e})`:"none",paddingBottom:o&&t?"48px":"0",height:o&&t?"calc(100vh - 48px)":"100vh"},children:t&&(n||r?g.jsx(T,{url:e,isMobile:o}):g.jsx("iframe",{width:"100%",height:"100%",src:e||void 0,title:"video",allow:"autoplay; fullscreen; encrypted-media; picture-in-picture",sandbox:"allow-same-origin allow-scripts allow-presentation",style:{border:0,pointerEvents:"auto",position:"relative",zIndex:1}}))})}export{Q as R,G as g,H as p,J as u};
