import{r as l,ad as k,au as C,j as e,am as g,Q as R,T as m,ar as L,ao as w,a1 as O}from"./chunk-DJZJtpVs.js";import{T as B}from"./chunk-9fkTg0gS.js";import{l as T}from"./chunk-BMKafGEG.js";import{b as M}from"./chunk-BNqjsRvb.js";import{p as D,u as I,R as U}from"./chunk-Dr5sKK6t.js";import{l as F}from"./chunk-CXf22l7Q.js";import{g as z}from"./chunk-B4ipE-Yx.js";import"./chunk-7OQk-BoX.js";import"./chunk-DEqUmdJg.js";import"../assets/index-DHt7NlwD.js";import"./chunk-DtF_b7C9.js";import"./chunk-B4PEA_xj.js";import"./chunk-yLOK5aTh.js";function W(s){const c=T(s,"room");let i=!1,o="";if(c){const{roomBackgroundURL:d}=JSON.parse(c.settings),r=D(d);r?.isVideo&&(i=r.isVideo),r?.url&&(o=r.url)}return["color","gray"].some(d=>o.includes(d))&&(o=""),{isVideo:i,url:o}}function H(){const[s,c]=l.useState(document.fullscreenElement!=null);l.useEffect(()=>{const o=()=>{c(document.fullscreenElement!=null)};return document.addEventListener("fullscreenchange",o),()=>{document.removeEventListener("fullscreenchange",o)}},[]);const i=l.useCallback(()=>{document.fullscreenElement==null?document.documentElement.requestFullscreen().catch(o=>{console.error("Error attempting to enable fullscreen:",o)}):document.exitFullscreen().catch(o=>{console.error("Error attempting to exit fullscreen:",o)})},[]);return{isFullscreen:s,toggleFullscreen:i}}const P="actions",V=s=>{const{text:c,displayName:i}=s;if(!i)return{};const o=c?.split(`
`),[d,r]=o?.slice(1)||[],x=d?.split(":")[1]?.trim(),t=r?.split(":")[1]?.trim();return{displayName:i,type:x,activity:t}};function se(){const{id:s}=k(),[c,i]=l.useState(""),[o,d]=l.useState(!1),[r,x]=l.useState(!1);try{console.log("=== CAST COMPONENT LOADED ==="),console.log("Room:",s),console.log("Window location:",window.location.href),console.log("User agent:",navigator.userAgent),console.log("Environment checks:",{isProduction:!0,hasConsole:typeof console<"u",hasAlert:typeof alert<"u",hasDocument:typeof document<"u",hasWindow:typeof window<"u",documentTitle:document.title,timestamp:new Date().toISOString()})}catch(n){typeof alert<"u"&&alert("Cast component loaded, room: "+s+" Error: "+n)}const{messages:t,isLoading:a}=M();console.log("=== HOOK RESULTS ==="),console.log("Messages loaded:",{messagesCount:t?.length||0,isLoading:a,firstMessage:t?.[0]||null,lastMessage:t?.[t.length-1]||null});const{isVideo:b,url:f}=W(t);console.log("Background info:",{isVideo:b,url:f||"none"});const h=T(t,P);console.log("Last action:",h||"none");const p=I(h);console.log("Next player:",p||"none");const{isFullscreen:S,toggleFullscreen:A}=H();if(console.log("Fullscreen status:",S),l.useEffect(()=>{const n=z();console.log("=== AUTH CHECK FOR CAST ==="),console.log("Current user:",n.currentUser?.uid||"none"),console.log("Is anonymous:",n.currentUser?.isAnonymous||!1),n.currentUser?console.log("User already authenticated, proceeding..."):(console.log("No user found, attempting anonymous login..."),F("Cast Viewer").then(u=>{console.log("Anonymous login successful:",u?.uid||"failed")}).catch(u=>{console.error("Anonymous login failed:",u)}))},[]),l.useEffect(()=>{const n=window.cast?.framework?.CastReceiverContext,u=navigator.userAgent,j=u.includes("CrKey")||u.includes("TV"),v=n||j||window.location.search.includes("chromecast");return console.log("Cast detection:",{isCastEnvironment:!!n,isChromecast:j,userAgent:u,isActuallyCasting:v,url:window.location.href}),v&&(document.body.classList.add("cast-receiver-mode"),document.body.classList.remove("theme-light"),x(!0),console.log("Cast receiver mode activated, light theme removed")),()=>{v&&(document.body.classList.remove("cast-receiver-mode"),console.log("Cast receiver mode deactivated"))}},[]),l.useEffect(()=>{if(console.log("=== LOADING STATE MONITOR ==="),console.log("isLoading changed to:",a),a){console.log("Still loading, skipping effects...");return}console.log("Loading finished, checking messages...");const n=t[t.length-1];n?.type==="settings"&&(d(!0),i(`${n.displayName} ${C("changedSettings")}`))},[t,a]),l.useEffect(()=>{if(!a)return;const n=setTimeout(()=>{console.log("=== LOADING TIMEOUT ==="),console.log("Messages have been loading for 10 seconds, this might indicate an auth issue")},1e4);return()=>clearTimeout(n)},[a]),console.log("=== RENDER STATE ==="),console.log("Cast render state:",{isLoading:a,messagesLength:t?.length||0,lastAction:!!h,room:s,isCastReceiver:r,url:window.location.href,windowDimensions:{width:window.innerWidth,height:window.innerHeight},bodyClasses:document.body.className,hasRoomBackground:!!f}),console.log("=== DOM DEBUG ==="),console.log("Document ready state:",document.readyState),console.log("Body background color:",getComputedStyle(document.body).backgroundColor),console.log("Cast container exists:",!!document.querySelector(".cast-container")),!h)return console.log("No lastAction found, showing fallback"),e.jsx("div",{style:{backgroundColor:"#000",color:"#fff",minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"24px",fontFamily:"Arial, sans-serif",textAlign:"center",padding:"20px"},children:e.jsxs("div",{children:[e.jsxs("div",{style:{fontSize:"48px",marginBottom:"20px"},children:["blitzedout.com/",s]}),e.jsx("div",{style:{fontSize:"24px"},children:a?"Loading...":"Waiting for game to start"}),e.jsxs("div",{style:{fontSize:"16px",marginTop:"20px",opacity:.7},children:["DEBUG: Cast fallback mode - Room: ",s," | Loading: ",a?"yes":"no"," | Messages: ",t?.length||0]}),e.jsxs("div",{style:{fontSize:"12px",marginTop:"10px",opacity:.5},children:["Time: ",new Date().toLocaleTimeString()," | UA: ",navigator.userAgent.substring(0,50),"..."]}),e.jsxs("div",{style:{fontSize:"12px",marginTop:"5px",opacity:.5},children:["Cast Receiver: ",r?"YES":"NO"," | Body Classes:"," ",document.body.className||"none"]})]})});const{displayName:E,type:N,activity:y}=V(h);return e.jsxs(g,{className:"flex-column",style:{backgroundColor:r?"#000":"transparent",color:"white",minHeight:"100vh"},children:[!!f&&e.jsx(U,{url:f,isVideo:b}),e.jsxs(g,{display:"flex",justifyContent:"space-between",sx:{mx:2,mt:2,mb:-2},children:[e.jsx(g,{flex:"1",children:!r&&!S&&e.jsx(R,{variant:"text",onClick:A,style:{color:"white"},children:C("fullscreen")})}),e.jsx(g,{textAlign:"center",flex:"1",children:!!p?.displayName&&e.jsx(m,{variant:"h4",style:{color:"white",textShadow:"2px 2px 4px rgba(0,0,0,0.8)"},children:e.jsx(L,{i18nKey:"nextPlayersTurn",values:{player:p.displayName}})})},p?.displayName),e.jsx(g,{flex:"1",textAlign:"right",className:"text-stroke",children:y&&e.jsxs(m,{variant:"h4",style:{color:"white",textShadow:"2px 2px 4px rgba(0,0,0,0.8)"},children:["blitzedout.com/",s]})})]}),e.jsx(w,{container:!0,spacing:0,direction:"column",alignItems:"center",justifyContent:"center",className:"cast-container",style:{minHeight:"calc(100vh - 5rem)"},children:e.jsx(w,{container:!0,justifyContent:"center",children:y?e.jsxs(w,{size:12,className:"action-box",style:{backgroundColor:"rgba(0,0,0,0.7)",padding:"2rem",borderRadius:"0.5rem",maxWidth:"80%",margin:"0 auto"},children:[e.jsx(m,{variant:"h3",style:{color:"white",textShadow:"2px 2px 4px rgba(0,0,0,0.8)"},children:`${N} ${C("for")} ${E}`}),e.jsx(g,{className:"divider",style:{marginTop:"-0.5rem",height:"0.5rem",backgroundColor:"white",border:"2px solid black"},children:e.jsx(O,{})}),e.jsx(m,{variant:"h1",style:{color:"white",textShadow:"2px 2px 4px rgba(0,0,0,0.8)",fontWeight:600},children:y})]}):e.jsx("div",{className:"action-box",style:{backgroundColor:"rgba(0,0,0,0.7)",padding:"2rem",borderRadius:"0.5rem",maxWidth:"80%",margin:"0 auto"},children:e.jsxs(m,{variant:"h1",style:{color:"white",textShadow:"2px 2px 4px rgba(0,0,0,0.8)",fontWeight:600},children:["blitzedout.com/",s]})})})},t.length),e.jsx(B,{open:!!o,close:()=>d(!1),hideCloseButton:!0,children:e.jsx(m,{variant:"h5",style:{color:"white"},children:c})})]})}export{se as default};
