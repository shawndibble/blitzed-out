import{ak as A,r,j as e,am as v,aR as S,A as y,Q as p,at as C,ar as c,T as k,a1 as E,au as L,W as F,av as K,Y as T,R as G}from"./chunk-D6lSgkQl.js";import{n as R,o as q,q as I,A as N}from"./chunk-C_oFcKuT.js";import{G as B}from"./chunk-CM1AJoxz.js";import{u as z,C as V}from"./chunk-BtqLIqNe.js";function H({onSuccess:a,onSwitchToRegister:o,onSwitchToForgotPassword:l,isLinking:t=!1}){const{t:s}=A(),[i,n]=r.useState(""),[u,d]=r.useState(""),[f,m]=r.useState(""),[x,g]=r.useState(!1),w=async j=>{j.preventDefault(),m(""),g(!0);try{await R(i,u),a&&a()}catch(b){console.error("Login error:",b),m(b.message||"Failed to sign in")}finally{g(!1)}};return e.jsxs(v,{component:"form",onSubmit:w,sx:{mt:1},children:[f&&e.jsx(S,{severity:"error",sx:{mb:2},children:f}),e.jsx(y,{margin:"normal",required:!0,fullWidth:!0,id:"email",label:s("email"),name:"email",autoComplete:"email",autoFocus:!0,value:i,onChange:j=>n(j.target.value)}),e.jsx(y,{margin:"normal",required:!0,fullWidth:!0,name:"password",label:s("password"),type:"password",id:"password",autoComplete:"current-password",value:u,onChange:j=>d(j.target.value)}),e.jsx(p,{type:"submit",fullWidth:!0,variant:"contained",sx:{mt:3,mb:2},disabled:x,children:x?e.jsx(C,{size:24}):t?e.jsx(c,{i18nKey:"linkAccount",children:"Link Account"}):e.jsx(c,{i18nKey:"signIn"})}),e.jsxs(k,{align:"center",children:[e.jsx(p,{onClick:o,variant:"text",children:e.jsx(c,{i18nKey:"needAccount"})})," | ",e.jsx(p,{onClick:l,variant:"text",children:e.jsx(c,{i18nKey:"forgotPassword"})})]})]})}function M({onSuccess:a,onSwitchToLogin:o,isAnonymous:l=!1}){const{t}=A(),[s,i]=r.useState(""),[n,u]=r.useState(""),[d,f]=r.useState(""),[m,x]=r.useState(""),[g,w]=r.useState(""),[j,b]=r.useState(!1),D=async h=>{if(h.preventDefault(),w(""),d!==m){w(t("passwordsDoNotMatch")||"Passwords do not match");return}b(!0);try{await q(n?.trim(),d,s?.trim()),a&&a()}catch(W){console.error("Registration error:",W),w(W.message||"Failed to create account")}finally{b(!1)}};return e.jsxs(v,{component:"form",onSubmit:D,sx:{mt:1},children:[g&&e.jsx(S,{severity:"error",sx:{mb:2},children:g}),e.jsx(y,{margin:"normal",required:!0,fullWidth:!0,id:"displayName",label:t("displayName"),name:"displayName",autoComplete:"name",autoFocus:!0,value:s,onChange:h=>i(h.target.value)}),e.jsx(y,{margin:"normal",required:!0,fullWidth:!0,id:"email",label:t("email"),name:"email",autoComplete:"email",value:n,onChange:h=>u(h.target.value)}),e.jsx(y,{margin:"normal",required:!0,fullWidth:!0,name:"password",label:t("password"),type:"password",id:"password",autoComplete:"new-password",value:d,onChange:h=>f(h.target.value)}),e.jsx(y,{margin:"normal",required:!0,fullWidth:!0,name:"confirmPassword",label:t("confirmPassword"),type:"password",id:"confirmPassword",autoComplete:"new-password",value:m,onChange:h=>x(h.target.value)}),e.jsx(p,{type:"submit",fullWidth:!0,variant:"contained",sx:{mt:3,mb:2},disabled:j,children:j?e.jsx(C,{size:24}):l?e.jsx(c,{i18nKey:"linkAccount"}):e.jsx(c,{i18nKey:"createAccount"})}),e.jsx(k,{align:"center",children:e.jsx(p,{onClick:o,variant:"text",children:e.jsx(c,{i18nKey:"alreadyHaveAccount"})})})]})}function O({onSuccess:a,isLinking:o=!1}){const[l,t]=r.useState(""),[s,i]=r.useState(!1),n=async()=>{t(""),i(!0);try{await I(),a&&a()}catch(u){t(u.message||"Failed to sign in with Google")}finally{i(!1)}};return e.jsxs(v,{sx:{mt:2,mb:2},children:[l&&e.jsx(S,{severity:"error",sx:{mb:2},children:l}),e.jsx(E,{sx:{mb:2},children:e.jsx(k,{variant:"body2",color:"text.secondary",children:e.jsx(c,{i18nKey:"or",children:"OR"})})}),e.jsx(p,{fullWidth:!0,variant:"outlined",startIcon:e.jsx(B,{}),onClick:n,disabled:s,sx:{mb:1},"aria-busy":s,"aria-live":"polite",children:s?e.jsx(C,{size:24}):o?L("linkWithGoogle","Link with Google"):L("signInWithGoogle","Sign in with Google")})]})}function P(){const a=r.useContext(N);if(a===void 0)throw new Error("useAuth must be used within an AuthProvider");return a}function Q({children:a,open:o,close:l=null,isMobile:t=null,title:s=null,isLoading:i=!1,maxWidth:n="md",fullWidth:u=!1,ariaLabelledby:d,ariaDescribedby:f,actions:m}){const x=z(),g=t!==null?t:x;return i?null:e.jsxs(F,{fullScreen:g,open:o,maxWidth:n,fullWidth:u,"aria-labelledby":d,"aria-describedby":f,children:[e.jsxs(K,{children:[s,typeof l=="function"&&e.jsx(V,{close:l})]}),e.jsx(T,{children:a}),m&&e.jsx(G,{sx:{p:2,gap:1},children:m})]})}function Y({onToggleForm:a}){const[o,l]=r.useState(""),[t,s]=r.useState(""),[i,n]=r.useState(!1),[u,d]=r.useState(!1),{forgotPassword:f}=P(),m=async x=>{x.preventDefault(),s(""),n(!1),d(!0);try{await f(o),n(!0)}catch(g){s(g.message||"Failed to send reset email")}finally{d(!1)}};return e.jsxs(v,{component:"form",onSubmit:m,sx:{mt:1},children:[t&&e.jsx(S,{severity:"error",sx:{mb:2},children:t}),i&&e.jsx(S,{severity:"success",sx:{mb:2},children:e.jsx(c,{i18nKey:"resetEmailSent"})}),e.jsx(y,{margin:"normal",required:!0,fullWidth:!0,id:"email",label:e.jsx(c,{i18nKey:"email"}),name:"email",autoComplete:"email",autoFocus:!0,value:o,onChange:x=>l(x.target.value)}),e.jsx(p,{type:"submit",fullWidth:!0,variant:"contained",sx:{mt:3,mb:2},disabled:u,children:u?e.jsx(C,{size:24}):e.jsx(c,{i18nKey:"sendResetLink"})}),e.jsx(v,{sx:{textAlign:"center"},children:e.jsx(p,{variant:"text",onClick:()=>a("login"),children:e.jsx(c,{i18nKey:"backToLogin"})})})]})}function _({open:a,close:o,initialView:l="login"}){const[t,s]=r.useState(l),{isAnonymous:i}=P(),{t:n}=A(),u=()=>{switch(t){case"login":return n(i?"linkAccount":"signIn");case"register":return n("createAccount");case"reset":return n("resetPassword");default:return n("Authentication")}};return e.jsxs(Q,{title:u(),open:a,close:o,children:[t==="login"&&e.jsxs(e.Fragment,{children:[e.jsx(H,{onSwitchToRegister:()=>s("register"),onSwitchToForgotPassword:()=>s("reset"),onSuccess:o,isLinking:i}),e.jsx(O,{onSuccess:o,isLinking:i})]}),t==="reset"&&e.jsx(Y,{onToggleForm:s}),t==="register"&&e.jsx(M,{onSwitchToLogin:()=>s("login"),onSuccess:o,isAnonymous:i})]})}export{_ as A,Q as D,P as u};
