import{j as e,aa as S,am as w,r as g,y as k,x as R,ay as M,z as Q,M as v,T as x,aH as O,I as re,ax as u,ab as oe,aE as ce,az as Y,aF as N,a1 as T,au as C,aQ as de,aR as ue,aS as he,b6 as xe,aV as J,aP as ge,ad as je,$ as pe,Z as $,Q as Z}from"./chunk-CMb_ATvh.js";import{T as me}from"./chunk-ClYjm9Ad.js";import{b as B,i as P,c as G}from"./chunk-C7PvMB7v.js";import{u as be}from"./chunk-B-Pfj4Vk.js";import{l as ye,u as se}from"./chunk-BUE_ixxi.js";import{u as fe,C as ve}from"./chunk-DOVm5_QK.js";import{o as Se,b as D,H as A,E as Ce,p as we,q as ke}from"./chunk-jdmcjs0s.js";import{e as Te}from"../assets/index-BPZ_Msrf.js";import{d as Ae}from"./chunk-BVhHzeSz.js";import{b as Ke,d as Le,e as Ve}from"./chunk-BHUSFDWr.js";function _({children:n,value:s,index:l,style:t,...o}){return e.jsx("div",{role:"tabpanel",hidden:s!==l,id:`simple-tabpanel-${l}`,"aria-labelledby":`simple-tab-${l}`,...o,children:s===l&&e.jsx(S,{sx:{p:3,...t},children:n})})}function te({formData:n,setFormData:s,backgrounds:l,isRoom:t=!1}){const{t:o}=w(),i=t?"roomBackground":"background",c=t?"roomBackgroundURL":"backgroundURL",[r,d]=g.useState(n?.[i]||Object.keys(l)[0]),a=()=>Object.entries(l).map(([j,b])=>e.jsx(v,{value:j,children:b},j)),h=j=>{s({...n,[i]:j.target.value}),d(j.target.value)};g.useEffect(()=>{r!==n?.[i]&&d(n?.[i]||"")},[n,r,i]);const p=j=>{const b={...n,[i]:"custom",[c]:j.target.value};t&&(b.roomUpdated=!0),s(b)};return e.jsxs(e.Fragment,{children:[e.jsxs(k,{fullWidth:!0,margin:"normal",children:[e.jsx(R,{id:"background-label",children:o("background")}),e.jsx(M,{labelId:"background-label",id:"background",label:o("background"),value:r||"",onChange:h,children:a()})]}),r==="custom"&&e.jsx(Q,{sx:{mt:2},label:o("url"),value:n?.[c]||"",fullWidth:!0,onChange:p,helperText:e.jsxs(e.Fragment,{children:[o("supportedSites"),e.jsx("br",{}),o("requiresEmbeddedUrl")]})})]})}const ee={en:["alex","samantha","google uk english male","google uk english female","google us english male","google us english female","victoria","allison","ava","susan","daniel","karen","moira","fiona"],es:["google español","google español de estados unidos","monica","jorge","diego","paulina","juan","esperanza","carlos","rosa"],fr:["google français","amelie","thomas","aurelie","marie","pierre","brigitte","bernard","claire","sylvie"],zh:["google 中文","google 中文（中国大陆）","ting-ting","sin-ji","mei-jia","yu-shu","li-mu","ya-ling","xiao-bao","xiao-rong"],hi:["google हिन्दी","lekha","sangeeta","veena","rishi","kalpana","hemant","kavita","arun","shilpa"]},ne={en:"Take a drink and enjoy the game.",es:"Toma un trago y disfruta del juego.",fr:"Prenez une boisson et profitez du jeu.",zh:"喝一杯，享受游戏。",hi:"एक पेय लें और खेल का आनंद लें।"};class Ie{getAvailableVoices(s){const l=window.speechSynthesis.getVoices(),t=s?.split("-")[0]||"en",o=ee[t]||ee.en;return l.filter(i=>{const c=i.name.toLowerCase();return o.some(r=>c.includes(r.toLowerCase()))}).map(i=>({name:i.name,displayName:i.name}))}getPreferredVoice(s){const l=this.getAvailableVoices(s);return l.length>0?l[0].name:null}getSampleText(s){const l=s.split("-")[0];return ne[l]||ne.en}async speak(s,l,t=0){return new Promise((o,i)=>{if(!("speechSynthesis"in window)){i(new Error("Speech synthesis not supported"));return}const c=new SpeechSynthesisUtterance(s);if(c.pitch=t,l){const d=window.speechSynthesis.getVoices().find(a=>a.name===l);d&&(c.voice=d)}c.onend=()=>o(),c.onerror=r=>i(new Error(`Speech failed: ${r.error}`)),window.speechSynthesis.speak(c)})}stop(){window.speechSynthesis?.speaking&&window.speechSynthesis.cancel()}isAvailable(){return"speechSynthesis"in window}}const z=new Ie,Pe=()=>{const[n,s]=g.useState(!1),[l,t]=g.useState(!1),[o,i]=g.useState(null),c=g.useCallback(()=>{z.stop(),s(!1),t(!1)},[]),r=g.useCallback(async(d,a={})=>{try{t(!0),i(null),c(),s(!0),await z.speak(d,a.voice,a.pitch),t(!1),s(!1)}catch(h){const p=h instanceof Error?h.message:"TTS failed";i(p),s(!1),t(!1),console.error("TTS Error:",h)}},[c]);return g.useEffect(()=>()=>{c()},[c]),{speak:r,stop:c,isPlaying:n,error:o,isLoading:l}};function Re({formData:n,setFormData:s,onVoiceChange:l}){const{t,i18n:o}=w(),[i,c]=g.useState([]),[r,d]=g.useState(!0),{speak:a}=Pe(),h=n.locale||o.language||"en",p=n.voicePreference||"",j=g.useCallback(m=>{const f={...n,voicePreference:m};s(f),l?.(m)},[n,s,l]);g.useEffect(()=>{let m=!0;return(async()=>{try{if(m){const L=z.getAvailableVoices(h);if(c(L),!p&&L.length>0){const U=z.getPreferredVoice(h);U&&j(U)}d(!1)}}catch(L){console.error("Failed to load voices:",L),m&&d(!1)}})(),()=>{m=!1}},[h,p,j]);const b=m=>{j(m.target.value)},K=async()=>{const m=p||(i.length>0?i[0].name:"");if(!m)return;const f=z.getSampleText(h);try{await a(f,{voice:m,pitch:-2})}catch(L){console.error("Failed to play sample:",L)}},y=m=>m.displayName;return r?e.jsx(S,{sx:{py:1},children:e.jsx(x,{variant:"body2",color:"text.secondary",children:t("loadingVoices","Loading voices...")})}):i.length===0?e.jsx(S,{sx:{py:1},children:e.jsx(x,{variant:"body2",color:"text.secondary",children:t("noVoicesAvailable","No voices available for this language")})}):e.jsxs(S,{sx:{display:"flex",alignItems:"center",gap:1,py:1},children:[e.jsxs(k,{fullWidth:!0,size:"small",children:[e.jsx(R,{id:"voice-select-label",children:t("voiceSelection","Voice")}),e.jsx(M,{labelId:"voice-select-label",value:p,label:t("voiceSelection","Voice"),onChange:b,children:i.map(m=>e.jsx(v,{value:m.name,children:y(m)},m.name))})]}),e.jsx(O,{title:t("playSample","Play sample"),children:e.jsx(re,{onClick:K,color:"primary",disabled:!p,size:"small",children:e.jsx(Se,{})})})]})}function Me({boardUpdated:n}){const{i18n:s}=w(),[l,t]=g.useState(s.resolvedLanguage||"en"),[o,i]=g.useState(!1);async function c(d){i(!0),t(d);try{await Te(d),await s.changeLanguage(d),n()}catch(a){console.error("Error changing language:",a),await s.changeLanguage(d),n()}finally{i(!1)}}const r=Object.entries(ye).map(([d,a])=>e.jsx(v,{value:d,children:a.label},d));return e.jsx(S,{sx:{minWidth:120,mt:1,mb:2},children:e.jsxs(k,{fullWidth:!0,children:[e.jsxs(R,{id:"language-label",sx:{display:"flex",alignItems:"center"},children:[e.jsx(D,{sx:{mr:1}}),e.jsx(u,{i18nKey:"language"})]}),e.jsx(M,{labelId:"language-label",id:"language-select",value:l,disabled:o,label:e.jsxs(e.Fragment,{children:[e.jsx(D,{}),e.jsx(u,{i18nKey:"language"})]}),onChange:d=>c(d.target.value),inputProps:{endAdornment:o&&e.jsx(oe,{size:20})},children:r})]})})}function Oe({trueCondition:n,onChange:s,yesLabel:l,noLabel:t=null,sx:o={}}){const i=t??l;return e.jsx(S,{sx:{display:"flex",justifyContent:"center",my:1,...o},children:e.jsx(ce,{control:e.jsx(N,{checked:n||!1,onChange:s}),label:Y(n?l:i)})})}function I({field:n,formData:s,handleSwitch:l}){return e.jsx(Oe,{trueCondition:s[n],onChange:t=>l(t,n),yesLabel:`${n}Enable`,sx:{justifyContent:"left"}})}function Ee({formData:n,setFormData:s,boardUpdated:l}){const[t,o]=se(),{t:i}=w(),c={color:i("color"),gray:i("gray"),"metronome.gif":i("hypnoDick"),"pink-spiral.gif":i("pinkSpiral"),custom:i("customURL")};function r(a,h){s({...n,[h]:a.target.checked}),o({...t,[h]:a.target.checked})}function d(a){o({...t,voicePreference:a})}return e.jsxs(e.Fragment,{children:[e.jsx(Me,{boardUpdated:l}),e.jsx(x,{variant:"h5",children:e.jsx(u,{i18nKey:"dialog"})}),e.jsx(I,{field:"playerDialog",formData:n,handleSwitch:r}),e.jsx(I,{field:"othersDialog",formData:n,handleSwitch:r}),e.jsx(T,{}),e.jsx(x,{variant:"h5",sx:{mt:2},children:e.jsx(u,{i18nKey:"sounds"})}),e.jsx(I,{field:"mySound",formData:n,handleSwitch:r}),e.jsx(I,{field:"otherSound",formData:n,handleSwitch:r}),e.jsx(I,{field:"chatSound",formData:n,handleSwitch:r}),e.jsx(I,{field:"readRoll",formData:n,handleSwitch:r}),n.readRoll&&e.jsx(Re,{formData:n,setFormData:s,onVoiceChange:d}),e.jsx(T,{}),e.jsx(x,{variant:"h5",sx:{mt:2,textTransform:"capitalize"},children:e.jsx(u,{i18nKey:"misc"})}),e.jsx(I,{field:"hideBoardActions",formData:n,handleSwitch:r}),e.jsx(I,{field:"advancedSettings",formData:n,handleSwitch:r}),e.jsx(te,{formData:n,setFormData:s,backgrounds:c}),e.jsx(T,{})]})}function F({children:n}){return e.jsx(C,{size:{xs:12,md:5},children:n})}const q=g.forwardRef(({value:n,onChange:s,label:l,options:t,defaultValue:o=null,sx:i,helpIcon:c=!1,fullWidth:r=!0,...d},a)=>{const h=g.useMemo(()=>t.map(p=>typeof p=="string"?e.jsx(v,{value:p,children:Y(p)},p):e.jsx(v,{value:p.value,children:p.label},p.value)),[t]);return e.jsxs(k,{fullWidth:r,margin:"normal",sx:i,...d,ref:a,children:[e.jsxs(R,{id:`${l}Label`,children:[e.jsx(u,{i18nKey:l}),!!c&&e.jsx(A,{sx:{ml:1,fontSize:16}})]}),e.jsx(M,{labelId:`${l}Label`,id:l,label:e.jsxs(e.Fragment,{children:[e.jsx(u,{i18nKey:l}),!!c&&e.jsx(A,{sx:{ml:1,fontSize:16}})]}),value:n||o||"",onChange:s,children:h})]})});function H({children:n,title:s,subtitle:l,defaultExpanded:t=!1,...o}){return e.jsxs(de,{defaultExpanded:t,...o,sx:{backgroundColor:"inherit",backgroundImage:"none",boxShadow:"none"},children:[e.jsxs(ue,{expandIcon:e.jsx(Ce,{}),sx:{px:0},children:[e.jsxs(x,{variant:"h6",sx:{width:"33%"},children:[s,":"]}),e.jsx(x,{sx:{pt:.5},children:l})]}),e.jsx(he,{sx:{px:0},children:e.jsx(C,{container:!0,columnSpacing:2,justifyContent:"space-evenly",className:"columned-grid",children:n})})]})}function Ue({formData:n,setFormData:s}){const l=(o,i)=>{s({...n,finishRange:i,boardUpdated:!0})},t=n?.finishRange||[30,70];return e.jsxs(S,{children:[e.jsx(T,{}),e.jsx(x,{id:"finish-slider",sx:{my:1},children:e.jsx(u,{i18nKey:"finishSlider"})}),e.jsx(xe,{"aria-labelledby":"finish-slider",value:t,onChange:l,valueLabelDisplay:"off"}),e.jsxs(S,{display:"flex",flexDirection:"column",justifyContent:"space-between",textAlign:"center",children:[e.jsxs(x,{whiteSpace:"nowrap",children:[e.jsx(u,{i18nKey:"noCum"})," ",t[0],"%"]}),e.jsxs(x,{whiteSpace:"nowrap",children:[e.jsx(u,{i18nKey:"ruined"})," ",t[1]-t[0],"%"]}),e.jsxs(x,{whiteSpace:"nowrap",children:[e.jsx(u,{i18nKey:"cum"})," ",100-t[1],"%"]})]}),e.jsx(T,{sx:{my:1}})]})}function ze(){const[n,s]=g.useState(!1);return g.useEffect(()=>{const l=window.matchMedia("(pointer: fine)");s(l.matches);const t=o=>{s(o.matches)};return l.addEventListener("change",t),()=>{l.removeEventListener("change",t)}},[]),n}function Be({actionsFolder:n,settings:s,option:l,onChange:t,initValue:o=0}){const i=`${l}label`,c=n[l]?.label,r=()=>s.selectedActions?.[l]?.level||o,d=ze(),[a,h]=g.useState(r()),p=y=>{t(y)},j=y=>{h(y)},b=y=>a>0&&y===0?!1:s.difficulty==="accelerated"?a<=2?a===y:a===y||a-1===y:a>=y;function K(y){return Object.keys(n[y]?.actions||{}).map((m,f)=>e.jsxs(v,{value:f,onMouseOver:()=>j(f),children:[!!d&&e.jsx("span",{className:"menu-item-icon",children:b(f)?e.jsx(we,{}):e.jsx(ke,{})}),m]},`${y}-${m}`))}return e.jsxs(k,{margin:"normal",fullWidth:!0,children:[e.jsx(R,{id:i,children:c}),e.jsx(M,{labelId:i,id:l,label:c,value:r(),onChange:p,onOpen:()=>h(r()),onClose:()=>h(r()),children:K(l)})]})}function Ne({option:n,settings:s,setSettings:l,actionsFolder:t,type:o,showVariation:i=!1,showRole:c=!1}){const{t:r}=w(),d=`${n}label`,a=t[n]?.label;function h(b,K,y){const m=s.selectedActions?.[K];l({...s,selectedActions:{...s.selectedActions,[K]:{...m,type:o,level:m?.level??0,[y]:b?.target?.value}},boardUpdated:!0})}let p=12;(i||c)&&(p=6);let j=["dom","vers","sub"];return t[n]?.dom&&(j=[{label:t[n].dom,value:"dom"},{label:r("vers"),value:"vers"},{label:t[n].sub,value:"sub"}]),e.jsxs(C,{container:!0,justifyContent:"center",children:[e.jsx(C,{size:p,children:e.jsx(Be,{actionsFolder:t,settings:s,option:n,onChange:b=>h(b,n,"level")})}),!!c&&e.jsx(C,{size:6,children:e.jsx(q,{sx:{ml:1},value:s.selectedActions?.[n]?.role,onChange:b=>h(b,n,"role"),label:`${r("role")}: ${a}`,options:j,defaultValue:s.role||"sub"})}),!!i&&e.jsx(C,{size:6,children:e.jsx(O,{placement:"top",title:e.jsxs(u,{i18nKey:"variationTooltip",children:[e.jsx(x,{variant:"subtitle2",children:"Standalone = Its own tile. "}),e.jsx(x,{variant:"subtitle2",children:"Append Some = 50% chance."}),e.jsx(x,{variant:"subtitle2",children:"Append Most = 90% chance."})]}),arrow:!0,children:e.jsxs(k,{fullWidth:!0,margin:"normal",sx:{ml:1},children:[e.jsxs(R,{id:`${d}Variation`,children:[`${a} ${r("variation")}`,e.jsx(A,{sx:{ml:1,fontSize:16}})]}),e.jsxs(M,{labelId:`${d}Variation`,id:`${n}Variation`,label:e.jsxs(e.Fragment,{children:[a," ",r("variation"),e.jsx(A,{sx:{ml:1,fontSize:16}})]}),value:s.selectedActions?.[n]?.variation||"standalone",onChange:b=>h(b,n,"variation"),children:[e.jsx(v,{value:"standalone",children:e.jsx(u,{i18nKey:"standalone"})}),e.jsx(v,{value:"appendSome",children:e.jsx(u,{i18nKey:"appendSome"})}),e.jsx(v,{value:"appendMost",children:e.jsx(u,{i18nKey:"appendMost"})})]})]})})})]},n)}function We({formData:n,setFormData:s}){return e.jsxs(J,{direction:"row",spacing:1,alignItems:"center",justifyContent:"center",sx:{mt:1},children:[e.jsx(x,{children:e.jsx(u,{i18nKey:"solo"})}),e.jsx(O,{title:e.jsx(x,{variant:"subtitle2",children:e.jsx(u,{i18nKey:"soloTooltip"})}),arrow:!0,children:e.jsx(A,{sx:{fontSize:15}})}),e.jsx(N,{id:"gameMode",checked:!B(n.gameMode),onChange:l=>s({...n,gameMode:l.target.checked?"local":"online",boardUpdated:!0}),inputProps:{"aria-label":"Game Type"}}),e.jsx(x,{children:e.jsx(u,{i18nKey:"local"})}),e.jsx(O,{title:e.jsx(x,{variant:"subtitle2",children:e.jsx(u,{i18nKey:"localTooltip"})}),arrow:!0,children:e.jsx(A,{sx:{fontSize:15}})})]})}function $e({formData:n}){const[s,l]=g.useState(!1);return g.useEffect(()=>{const t=Object.values(n).filter(i=>typeof i=="object"&&i?.type==="consumption"&&i?.level>0).length,o=Object.values(n).filter(i=>typeof i=="object"&&i?.level>0).length;l(t>1&&t>=o-t)},[n]),s?e.jsx(ge,{severity:"warning",children:e.jsx(u,{i18nKey:"consumptionWarning"})}):null}function Ge({formData:n,setFormData:s,actionsList:l}){const{t}=w(),o=!P(n?.room)&&!B(n.gameMode);function i(r,d={}){return Object.keys(l).filter(a=>l[a]?.type===r).map(a=>e.jsx(F,{children:e.jsx(Ne,{option:a,settings:n,setSettings:s,actionsFolder:l,type:r,...d})},a))}const c=r=>{const d=JSON.parse(JSON.stringify(n));return Object.keys(d).forEach(a=>{d.role=r,a.includes("role")&&(d[a]=r)}),d};return e.jsxs(e.Fragment,{children:[e.jsx(We,{formData:n,setFormData:s}),P(n?.room)&&!B(n.gameMode)&&e.jsx(C,{container:!0,alignContent:"center",justifyContent:"space-evenly",children:e.jsx(C,{sx:{py:3},children:e.jsx(x,{variant:"h5",children:e.jsx(u,{i18nKey:"privateRequired"})})})}),e.jsxs(C,{container:!0,columnSpacing:2,justifyContent:"space-evenly",children:[e.jsx(F,{children:e.jsx(O,{placement:"top",title:e.jsx(u,{i18nKey:"difficultyTooltip",children:e.jsxs(x,{variant:"body2",children:["Normal = Slow ramp up. ",e.jsx("br",{}),e.jsx("br",{}),"Accelerated = Straight to max level + the level prior to it."]})}),arrow:!0,children:e.jsx(q,{value:n.difficulty,onChange:r=>s({...n,difficulty:r.target.value,boardUpdated:!0}),label:"difficulty",options:["normal","accelerated"],defaultValue:"normal",helpIcon:!0})})}),o&&e.jsx(F,{children:e.jsx(q,{value:n.role,onChange:r=>s({...c(r.target.value),boardUpdated:!0}),label:"mainRole",options:["dom","vers","sub"],defaultValue:"sub"})})]}),o?e.jsxs(e.Fragment,{children:[e.jsx(H,{title:t("consumption"),subtitle:t("consumptionSubtitle"),children:i("consumption",{showVariation:!0})}),e.jsx(H,{title:t("foreplay"),subtitle:t("foreplaySubtitle"),children:i("foreplay",{showRole:o})}),e.jsx(H,{title:t("sex"),subtitle:t("sexSubtitle"),children:i("sex",{showRole:o})})]}):e.jsxs(e.Fragment,{children:[e.jsx(C,{container:!0,columnSpacing:2,justifyContent:"space-evenly",children:i("consumption",{showVariation:!0})}),e.jsx(T,{}),e.jsx(C,{container:!0,columnSpacing:2,justifyContent:"center",children:i("solo")})]}),e.jsx(Ue,{setFormData:s,formData:n}),e.jsx($e,{formData:n})]})}function _e({formData:n,setFormData:s}){const{t:l}=w(),t={"1d4":2.5,"1d6":3.5,"2d4":5},o=n?.roomTileCount?Math.floor(n.roomTileCount/t[n.roomDice||"1d6"]):16,i=Array.from({length:7},(c,r)=>(r+2)*10).map(c=>e.jsx(v,{value:c,children:c},c));return e.jsxs(e.Fragment,{children:[e.jsx(x,{children:e.jsx(u,{i18nKey:"gameSpeed"})}),e.jsxs(S,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[e.jsxs(k,{sx:{m:1},fullWidth:!0,children:[e.jsx(R,{id:"diceRole-label",children:e.jsx(u,{i18nKey:"roomDice"})}),e.jsxs(M,{labelId:"diceRole-label",id:"diceRole-select",value:n?.roomDice||"1d4",label:l("roomDice"),onChange:c=>s({...n,roomDice:c.target.value,roomUpdated:!0}),children:[e.jsx(v,{value:"1d4",children:"1d4"}),e.jsx(v,{value:"1d6",children:"1d6"}),e.jsx(v,{value:"2d4",children:"2d4"})]})]}),e.jsxs(k,{sx:{m:1},fullWidth:!0,children:[e.jsx(R,{id:"tile-count-label",children:e.jsx(u,{i18nKey:"roomTileCount"})}),e.jsx(M,{labelId:"tile-count-label",id:"tile-count-select",value:String(n?.roomTileCount||40),label:l("roomTileCount"),onChange:c=>s({...n,roomTileCount:Number(c.target.value),roomUpdated:!0}),children:i})]}),e.jsx(k,{fullWidth:!0,children:e.jsxs(x,{children:[e.jsx(u,{i18nKey:"averageRolls"}),o]})})]})]})}function Fe({formData:n,setFormData:s}){const l=g.useCallback(()=>{s({...n,roomRealtime:!n.roomRealtime,roomUpdated:!0})},[n,s]);return e.jsxs(e.Fragment,{children:[e.jsx(x,{children:e.jsx(u,{i18nKey:"playerListOptions"})}),e.jsxs(J,{direction:"row",spacing:1,alignItems:"center",justifyContent:"center",sx:{width:"100%"},children:[e.jsx(x,{children:e.jsx(u,{i18nKey:"realtime"})}),e.jsx(O,{title:e.jsx(x,{variant:"subtitle2",children:e.jsx(u,{i18nKey:"realtimeTooltip"})}),arrow:!0,children:e.jsx(A,{sx:{fontSize:15}})}),e.jsx(N,{id:"showPrivate",checked:!!n.roomRealtime,onChange:l,inputProps:{"aria-label":Y("playerList")}}),e.jsx(x,{children:e.jsx(u,{i18nKey:"delayed"})}),e.jsx(O,{title:e.jsx(x,{variant:"subtitle2",children:e.jsx(u,{i18nKey:"delayedTooltip"})}),arrow:!0,children:e.jsx(A,{sx:{fontSize:15}})})]})]})}function He({formData:n,setFormData:s}){const{id:l}=je(),{t}=w(),o=a=>{let h;a.target.checked&&P(l)?h=Ae("123456789ABCDEFGHJKLMNPQRSTUVWXYZ",5)():l&&a.target.checked&&!P(l)?h=l:h="PUBLIC",s({...n,room:h.toUpperCase(),gameMode:P(h)?"online":n.gameMode})},i=g.useCallback(a=>{s({...n,room:a.currentTarget.value,boardUpdated:!0})},[n,s]),c=g.useCallback(a=>{a.key==="Enter"&&s({...n,room:a.currentTarget.value,boardUpdated:!0})},[n,s]),r=g.useCallback(a=>{const h=a.target.value.toUpperCase();a.target.value=h},[]),d=!P(n.room);return e.jsxs(e.Fragment,{children:[e.jsxs(J,{direction:"row",spacing:1,alignItems:"center",justifyContent:"center",sx:{width:"100%"},children:[e.jsx(x,{children:e.jsx(u,{i18nKey:"public"})}),e.jsx(N,{id:"showPrivate",checked:d,onChange:o,slotProps:{input:{"aria-label":t("room")}}}),e.jsx(x,{children:e.jsx(u,{i18nKey:"private"})}),e.jsx(O,{title:e.jsx(x,{variant:"subtitle2",children:e.jsx(u,{i18nKey:"privateOptions"})}),arrow:!0,children:e.jsx(A,{sx:{fontSize:15}})})]}),d&&e.jsx(Q,{fullWidth:!0,id:"privateRoom",label:t("privateRoom"),defaultValue:n.room?.toUpperCase(),margin:"normal",onBlur:i,onKeyDown:c,onChange:r,inputProps:{style:{textTransform:"uppercase"}}})]})}function qe({formData:n,setFormData:s}){const{t:l}=w(),t={app:l("appBackground"),custom:l("customURL")};return e.jsxs(S,{sx:{margin:"0.5rem"},children:[e.jsx(He,{formData:n,setFormData:s}),!P(n.room)&&e.jsxs(e.Fragment,{children:[e.jsx(T,{sx:{my:1}}),e.jsx(_e,{formData:n,setFormData:s}),e.jsx(T,{sx:{my:1}}),e.jsx(Fe,{formData:n,setFormData:s}),e.jsx(T,{sx:{my:1}}),e.jsx(te,{formData:n,setFormData:s,backgrounds:t,isRoom:!0})]})]})}function Qe(n){return Object.values(n).some(({level:s})=>s>0)}function Ye(n,s){const l=n.selectedActions||{};return Object.entries(l).reduce((t,[o,i])=>(o in s&&(i?.variation?.startsWith("append")?t.withAppend[o]=i:t.withoutAppend[o]=i),t),{withAppend:{},withoutAppend:{}})}function Je(n){return Object.keys(n).length>0&&Object.values(n).some(({level:s})=>s>0)}function Xe(n,s){const{withAppend:l,withoutAppend:t}=Ye(n,s);return Qe(t)?P(n.room)&&!B(n.gameMode)?"privateRequired":null:Je(l)?"appendWithAction":"pickSomething"}function Ze({closeDialog:n,initialTab:s=0}){const{user:l}=be(),{t}=w(),[o,i]=se(),[c,r]=g.useState(s),[d,a]=g.useState(null),[h,p]=g.useState(!1),[j,b]=fe(),K=Ke(),y=Le(),{isLoading:m,actionsList:f}=Ve(j?.gameMode),L=(V,E)=>{r(E),K(j.room)},U=()=>i({...o,boardUpdated:!0}),W=g.useCallback(async V=>{V.preventDefault();const{displayName:E,...ae}=j,X=Xe(ae,f);return X?(a(t(X)),null):(y(j,f),typeof n=="function"&&n(),null)},[j,f,t,a,y,n]),le=g.useCallback(V=>{b(E=>({...E,displayName:V.target.value}))},[b]),ie=g.useCallback(V=>{V.key==="Enter"&&(b(E=>({...E,displayName:V.target.value})),W(V))},[W,b]);return!j.room||m?e.jsxs(S,{children:[e.jsxs(x,{variant:"h2",children:[e.jsx(u,{i18nKey:"loading"}),"..."]}),e.jsx(x,{variant:"body1",children:e.jsx(u,{i18nKey:"clearStorage"})})]}):e.jsxs(S,{component:"form",method:"post",onSubmit:W,className:"settings-box",children:[e.jsx(Q,{fullWidth:!0,id:"displayName",label:t("displayName"),defaultValue:l?.displayName||j.displayName||"",required:!0,autoFocus:!0,onBlur:le,onKeyDown:ie,margin:"normal"}),e.jsx(S,{sx:{borderBottom:1,borderColor:"divider"},children:e.jsxs(pe,{value:c,onChange:L,"aria-label":t("gameSettings"),centered:!0,children:[e.jsx($,{label:t("gameboard"),...G(0)}),e.jsx($,{label:t("room"),...G(1)}),e.jsx($,{label:t("application"),...G(2)})]})}),e.jsx(_,{value:c,index:0,style:{p:0},children:e.jsx(Ge,{formData:j,setFormData:b,actionsList:f})}),e.jsx(_,{value:c,index:1,style:{p:0,pt:1},children:e.jsx(qe,{formData:j,setFormData:b})}),e.jsx(_,{value:c,index:2,style:{p:0,pt:1},children:e.jsx(Ee,{formData:j,setFormData:b,boardUpdated:U})}),e.jsxs("div",{className:"flex-buttons",children:[e.jsx(Z,{variant:"outlined",type:"button",onClick:()=>p(!0),children:e.jsx(u,{i18nKey:"customTilesLabel",children:"Game Tiles"})}),e.jsx(Z,{variant:"contained",type:"submit",children:e.jsx(u,{i18nKey:"update"})})]}),h&&e.jsx(ve,{open:h,setOpen:p,boardUpdated:U,actionsList:f}),e.jsx(me,{open:!!d,close:()=>a(null),children:d})]})}const dn=Object.freeze(Object.defineProperty({__proto__:null,default:Ze},Symbol.toStringTag,{value:"Module"}));export{Ze as G,Be as I,_ as T,Oe as Y,dn as i,z as t};
