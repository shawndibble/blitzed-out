const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["js/userList.tsx-CDfNYHwG.js","js/chunk-CJVoFoqV.js","js/chunk-CsdNKD0V.js","js/chunk-DvmTZbFC.js","assets/index-BHUshCQG.js","js/chunk-CdWLCell.js","js/chunk-Buz77Oyr.js","js/index.tsx-CnNNDJf7.js","js/chunk-D8jbiAue.js","js/chunk-CpqhyqeY.js","js/chunk-CxcwKXog.js","js/schedule.tsx-dFnjltiV.js","js/chunk-CaEDXWoe.js","js/theme.tsx-D3MtnY0r.js","js/chunk-arCWr7CA.js","js/index.tsx-DfQReaU4.js","js/index.tsx-CHcOCKdb.js","js/chunk-BcMa1deU.js","js/chunk-CoxDZOLR.js","js/chunk-D9NIOe8w.js","js/chunk-DpS0D7mt.js","js/chunk-B2GYjlo-.js","js/chunk-DWTSEXP2.js","js/chunk-pkH-lruR.js","js/chunk-DdYsL39M.js","js/chunk-Cyp6yqb7.js","js/chunk-LolS9Tp_.js","js/chunk-DJOIqVXf.js","js/chunk-D9_D7Pb0.js","js/chunk-q-nx_Rpp.js","js/index.tsx-BOPYyR7P.js"])))=>i.map(i=>d[i]);
import{A as g,_ as c}from"../assets/index-BHUshCQG.js";import{a7 as b,ad as j,r as d,j as o,ae as E,af as v,ag as p,ah as C,ai as T,aj as D}from"./chunk-CJVoFoqV.js";import{p as R,g as S,A}from"./chunk-DvmTZbFC.js";import{a as L}from"./chunk-CsdNKD0V.js";(function(){var e=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};e.SENTRY_RELEASE={id:"8380c411008c81db0d03192c8a87321e8e40e84f"}})();try{(function(){var e=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},s=new e.Error().stack;s&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[s]="09d245d9-2546-4cbd-863d-c1d9eeb7e8a5",e._sentryDebugIdIdentifier="sentry-dbid-09d245d9-2546-4cbd-863d-c1d9eeb7e8a5")})()}catch{}function h(e){if(!e)return null;try{if(typeof e.toDate=="function")return e.toDate();if(typeof e=="string"){const s=new Date(e);if(isNaN(s.getTime()))throw new Error("Invalid serialized timestamp format");return s}else if(typeof e=="number"){const s=e<3250368e4?e*1e3:e,t=new Date(s);if(isNaN(t.getTime()))throw new Error("Invalid numeric timestamp format");return t}else if(typeof e=="object"&&e.seconds!==void 0){const s=e,t=new Date(s.seconds*1e3+(s.nanoseconds||0)/1e6);if(isNaN(t.getTime()))throw new Error("Invalid Firestore timestamp object format");return t}else{if(e instanceof Date)return e;throw console.warn("Unsupported timestamp format:",typeof e,e),new Error(`Unsupported timestamp format: ${typeof e}`)}}catch(s){return console.warn("Failed to parse timestamp:",s),null}}function m(e){return e.sort((s,t)=>{const r=h(s.timestamp),n=h(t.timestamp);return!r||!n?0:r.getTime()-n.getTime()})}function l(e){return JSON.parse(JSON.stringify(e)).reverse()}function I(e,s){return l(e).find(t=>t.type===s)}function P(e,s,t="ASC"){let r=l(e);return t==="DESC"&&(r=r.reverse()),r.filter(n=>n.type===s)}function G(e,s){return l(e).find(s)}function N(e){return l(e)[0]}const O={messages:[],loading:!0,error:null,room:null,paginationCursor:null},U=L()(R((e,s)=>({...O,loadMessages:t=>{const n=m(t);e({messages:n,loading:!1,error:null})},addMessage:t=>{const{messages:r}=s();if(r.find(i=>i.id===t.id))return;const a=[...r,t],u=m(a);e({messages:u})},updateMessage:(t,r)=>{const{messages:n}=s();let a=!1;const u=n.map(i=>{if(i.id===t){const f={...i,...r};if(Object.keys(r).some(M=>i[M]!==r[M]))return a=!0,f}return i});if(a){const i=m(u);e({messages:i})}},clearMessages:()=>{e({messages:[],loading:!1,error:null})},setLoading:t=>{const{loading:r}=s();r!==t&&e({loading:t})},setError:t=>{const{error:r}=s();r!==t&&e({error:t})},setRoom:t=>{const{room:r}=s();r!==t&&e({room:t})},setPaginationCursor:t=>{const{paginationCursor:r}=s();r!==t&&e({paginationCursor:t})},getMessagesByType:t=>{const{messages:r}=s(),n=[];for(let a=0;a<r.length;a++)r[a].type===t&&n.push(r[a]);return n},getLatestMessage:()=>{const{messages:t}=s();return N(t)},getLatestMessageByType:t=>{const{messages:r}=s();return I(r,t)},getFilteredMessages:t=>{const{messages:r}=s(),n=[];for(let a=0;a<r.length;a++)t(r[a])&&n.push(r[a]);return n},getOrderedMessagesByType:(t,r="ASC")=>{const{messages:n}=s();return P(n,t,r)}}),{name:"messages-storage",partialize:e=>({messages:e.messages,room:e.room,paginationCursor:e.paginationCursor}),onRehydrateStorage:()=>e=>{if(e){const s=new Date;s.setHours(s.getHours()-24);const t=e.messages.filter(r=>{try{const n=h(r.timestamp);if(!n)throw console.warn(`Failed to parse timestamp for message ${r.id}:`,typeof r.timestamp,r.timestamp),new Error(`Failed to parse timestamp for message ${r.id}`);return n>s}catch(n){return console.warn(`Failed to parse message timestamp for message ID ${r.id}:`,n.message),!0}});t.length!==e.messages.length&&e.loadMessages(t)}}})),z=b.createContext(void 0);function w(e){const{id:s}=j(),{messages:t,loading:r,loadMessages:n,setLoading:a,setRoom:u,clearMessages:i}=U();d.useEffect(()=>{if(a(!0),u(s||null),!s){i();return}return S(s,y=>{n(y)})},[s,n,a,u,i]);const f={messages:t,isLoading:r};return o.jsx(z.Provider,{value:f,...e})}const x=d.lazy(()=>c(()=>import("./userList.tsx-CDfNYHwG.js"),__vite__mapDeps([0,1,2,3,4,5,6])).then(e=>({default:e.UserListProvider}))),B=d.lazy(()=>c(()=>import("./index.tsx-CnNNDJf7.js"),__vite__mapDeps([7,1,2,8,3,4,5,9,10,11,12,13,14,6,15]))),F=d.lazy(()=>c(()=>import("./index.tsx-CHcOCKdb.js"),__vite__mapDeps([16,1,2,17,18,14,3,4,5,6,19,20,21,22,9]))),k=d.lazy(()=>c(()=>import("./chunk-pkH-lruR.js").then(e=>e.i),__vite__mapDeps([23,4,1,2,24,9,10,11,3,5,12,13,14,6,21,25,22,26,27,28,29,18,19,30,17,20])));function _({children:e}){const{id:s}=j(),t=T(),r=D();return d.useEffect(()=>{if(s&&s!==s.toUpperCase()){const n=r.pathname.replace(s,s.toUpperCase());t(n+r.search+r.hash,{replace:!0})}},[s,t,r]),o.jsx(o.Fragment,{children:e})}function V(){const e=d.useContext(A);if(d.useEffect(()=>(e&&(window.authContext=e),()=>{window.authContext=null}),[e]),!e||e.initializing)return o.jsx(g,{});const s=e.user?o.jsx(k,{}):o.jsx(B,{});return o.jsxs(v,{children:[o.jsx(p,{path:"/",element:o.jsx(C,{replace:!0,to:"/PUBLIC"})}),o.jsx(p,{path:"/:id/cast",element:o.jsx(_,{children:o.jsx(d.Suspense,{fallback:o.jsx(g,{}),children:o.jsx(x,{children:o.jsx(w,{children:o.jsx(F,{})})})})})}),o.jsx(p,{path:"/:id",element:o.jsx(_,{children:o.jsx(d.Suspense,{fallback:o.jsx(g,{}),children:o.jsx(x,{children:o.jsx(w,{children:s})})})})})]})}function $(){return o.jsx(E,{children:o.jsx(V,{})})}const K=Object.freeze(Object.defineProperty({__proto__:null,default:$},Symbol.toStringTag,{value:"Module"}));export{z as M,G as a,K as i,I as l,P as o,h as p};
//# sourceMappingURL=chunk-KX2hDaPG.js.map
