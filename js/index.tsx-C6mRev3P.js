import{r as i,ad as R,au as v,j as e,am as l,ao as m,T as a,Q as B,ar as F,a1 as L}from"./chunk-DJZJtpVs.js";import{T as I}from"./chunk-9fkTg0gS.js";import{l as N}from"./chunk-Cooj4iTJ.js";import{b as M}from"./chunk-DaGklt_l.js";import{p as P,u as V,R as w}from"./chunk-B4lVJWV8.js";import"./chunk-7OQk-BoX.js";import"./chunk-DEqUmdJg.js";import"../assets/index-D_WZw1uN.js";import"./chunk-BtIOZ8dK.js";import"./chunk-B4ipE-Yx.js";import"./chunk-DtF_b7C9.js";import"./chunk-B4PEA_xj.js";import"./chunk-yLOK5aTh.js";function W(r){const s=N(r,"room");let n=!1,t="";if(s){const{roomBackgroundURL:c}=JSON.parse(s.settings),o=P(c);o?.isVideo&&(n=o.isVideo),o?.url&&(t=o.url)}return["color","gray"].some(c=>t.includes(c))&&(t=""),{isVideo:n,url:t}}function $(){const[r,s]=i.useState(document.fullscreenElement!=null);i.useEffect(()=>{const t=()=>{s(document.fullscreenElement!=null)};return document.addEventListener("fullscreenchange",t),()=>{document.removeEventListener("fullscreenchange",t)}},[]);const n=i.useCallback(()=>{document.fullscreenElement==null?document.documentElement.requestFullscreen().catch(t=>{console.error("Error attempting to enable fullscreen:",t)}):document.exitFullscreen().catch(t=>{console.error("Error attempting to exit fullscreen:",t)})},[]);return{isFullscreen:r,toggleFullscreen:n}}const z="actions",O=r=>{const{text:s,displayName:n}=r;if(!n)return{};const t=s?.split(`
`),[c,o]=t?.slice(1)||[],x=c?.split(":")[1]?.trim(),d=o?.split(":")[1]?.trim();return{displayName:n,type:x,activity:d}};function te(){const{id:r}=R(),{messages:s,isLoading:n}=M(),[t,c]=i.useState(""),[o,x]=i.useState(!1),[d,E]=i.useState(!1),{isVideo:b,url:h}=W(s),g=N(s,z),p=V(g),{isFullscreen:k,toggleFullscreen:S}=$();if(i.useEffect(()=>{const u=window.cast?.framework?.CastReceiverContext,y=navigator.userAgent,C=y.includes("CrKey")||y.includes("TV"),j=u||C||window.location.search.includes("chromecast");return console.log("Cast detection:",{isCastEnvironment:!!u,isChromecast:C,userAgent:y,isActuallyCasting:j,url:window.location.href}),j&&(document.body.classList.add("cast-receiver-mode"),E(!0),console.log("Cast receiver mode activated")),()=>{j&&document.body.classList.remove("cast-receiver-mode")}},[]),i.useEffect(()=>{if(n)return;const u=s[s.length-1];u?.type==="settings"&&(x(!0),c(`${u.displayName} ${v("changedSettings")}`))},[s,n]),console.log("Cast render state:",{isLoading:n,messagesLength:s?.length||0,lastAction:!!g,room:r,isCastReceiver:d}),!g)return console.log("No lastAction found, showing fallback"),e.jsxs(l,{className:"flex-column",children:[!!h&&e.jsx(w,{url:h,isVideo:b}),e.jsx(m,{container:!0,spacing:0,direction:"column",alignItems:"center",justifyContent:"center",className:"cast-container",children:e.jsx(m,{container:!0,justifyContent:"center",children:e.jsxs("div",{className:"action-box",children:[e.jsxs(a,{variant:"h1",style:{color:"white"},children:["blitzedout.com/",r]}),e.jsx(a,{variant:"h3",style:{color:"white",marginTop:"1rem"},children:n?"Loading...":"Waiting for game to start"})]})})})]});const{displayName:T,type:A,activity:f}=O(g);return e.jsxs(l,{className:"flex-column",style:{backgroundColor:d?"#000":"transparent",color:"white",minHeight:"100vh"},children:[!!h&&e.jsx(w,{url:h,isVideo:b}),e.jsxs(l,{display:"flex",justifyContent:"space-between",sx:{mx:2,mt:2,mb:-2},children:[e.jsx(l,{flex:"1",children:!d&&!k&&e.jsx(B,{variant:"text",onClick:S,style:{color:"white"},children:v("fullscreen")})}),e.jsx(l,{textAlign:"center",flex:"1",children:!!p?.displayName&&e.jsx(a,{variant:"h4",style:{color:"white",textShadow:"2px 2px 4px rgba(0,0,0,0.8)"},children:e.jsx(F,{i18nKey:"nextPlayersTurn",values:{player:p.displayName}})})},p?.displayName),e.jsx(l,{flex:"1",textAlign:"right",className:"text-stroke",children:f&&e.jsxs(a,{variant:"h4",style:{color:"white",textShadow:"2px 2px 4px rgba(0,0,0,0.8)"},children:["blitzedout.com/",r]})})]}),e.jsx(m,{container:!0,spacing:0,direction:"column",alignItems:"center",justifyContent:"center",className:"cast-container",style:{minHeight:"calc(100vh - 5rem)"},children:e.jsx(m,{container:!0,justifyContent:"center",children:f?e.jsxs(m,{size:12,className:"action-box",style:{backgroundColor:"rgba(0,0,0,0.7)",padding:"2rem",borderRadius:"0.5rem",maxWidth:"80%",margin:"0 auto"},children:[e.jsx(a,{variant:"h3",style:{color:"white",textShadow:"2px 2px 4px rgba(0,0,0,0.8)"},children:`${A} ${v("for")} ${T}`}),e.jsx(l,{className:"divider",style:{marginTop:"-0.5rem",height:"0.5rem",backgroundColor:"white",border:"2px solid black"},children:e.jsx(L,{})}),e.jsx(a,{variant:"h1",style:{color:"white",textShadow:"2px 2px 4px rgba(0,0,0,0.8)",fontWeight:600},children:f})]}):e.jsx("div",{className:"action-box",style:{backgroundColor:"rgba(0,0,0,0.7)",padding:"2rem",borderRadius:"0.5rem",maxWidth:"80%",margin:"0 auto"},children:e.jsxs(a,{variant:"h1",style:{color:"white",textShadow:"2px 2px 4px rgba(0,0,0,0.8)",fontWeight:600},children:["blitzedout.com/",r]})})})},s.length),e.jsx(I,{open:!!o,close:()=>x(!1),hideCloseButton:!0,children:e.jsx(a,{variant:"h5",style:{color:"white"},children:t})})]})}export{te as default};
