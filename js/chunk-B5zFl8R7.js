var ze=Object.defineProperty;var Be=(n,s,t)=>s in n?ze(n,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[s]=t;var ge=(n,s,t)=>Be(n,typeof s!="symbol"?s+"":s,t);import{ak as q,r as d,j as e,ap as _,s as Ne,am as m,b1 as ve,T as y,U as B,I as ue,aN as ye,M as A,aO as pe,aP as ce,aq as H,z as N,y as M,as as O,b2 as Me,aH as $,W as Oe,ay as We,Y as Ue,A as re,aS as Z,R as Fe,Q as E,ar as g,aQ as $e,b3 as Ge,b4 as _e,aA as ne,au as he,aB as X,at as He,a1 as Q,b5 as Ye,ao as V,aE as Je,aG as Qe,aF as Ze,aR as xe,ad as Xe,$ as De,Z as ae}from"./chunk-CXdXj9vr.js";import{x as en,m as nn,y as Se,z as sn,B as tn,F as me,p as je,b as fe,H as rn,J as U,K as Ce,N as an,r as ln,O as on,T as cn,W as dn}from"./chunk-DevrYHC1.js";import{l as un}from"./chunk-BvuvIKW1.js";import{u as Pe}from"./chunk-CKpixgpZ.js";import{d as se,i as W,u as hn,f as le}from"./chunk-YGCm9ryG.js";import{a as xn,u as mn}from"./chunk-DtueUwTg.js";import{u as gn,C as yn}from"./chunk-BvtAX5up.js";import{d as pn}from"./chunk-CwpkSHF3.js";import{T as jn}from"./chunk-D_3adld7.js";import{a as fn,b as bn}from"./chunk-C-zM8NG2.js";const we=[{id:"tritone",name:"Tri-tone",frequency:1318,type:"sine",duration:400,category:"classic",frequencies:[1318,1568,1175]},{id:"rebound",name:"Rebound",frequency:800,type:"triangle",duration:350,category:"classic"},{id:"chime",name:"Chime",frequency:1e3,type:"sine",duration:500,category:"classic",frequencies:[1e3,1200,1400]},{id:"boop",name:"Boop",frequency:600,type:"sine",duration:150,category:"classic"},{id:"breeze",name:"Breeze",frequency:400,type:"triangle",duration:600,category:"classic",frequencies:[400,500,600,500]},{id:"pong",name:"Pong",frequency:1100,type:"square",duration:200,category:"classic"},{id:"glass",name:"Glass",frequency:1800,type:"sine",duration:300,category:"classic",frequencies:[1800,1600,1400]},{id:"funk",name:"Funk",frequency:220,type:"sawtooth",duration:400,category:"classic"}],ke=[{id:"c4",name:"C Note",frequency:261.63,type:"sine",duration:300,category:"musical"},{id:"d4",name:"D Note",frequency:293.66,type:"sine",duration:300,category:"musical"},{id:"e4",name:"E Note",frequency:329.63,type:"sine",duration:300,category:"musical"},{id:"f4",name:"F Note",frequency:349.23,type:"sine",duration:300,category:"musical"},{id:"g4",name:"G Note",frequency:392,type:"sine",duration:300,category:"musical"},{id:"ascending",name:"Ascending",frequency:261.63,type:"triangle",duration:800,category:"musical",frequencies:[261.63,293.66,329.63,349.23]},{id:"descending",name:"Descending",frequency:523.25,type:"triangle",duration:800,category:"musical",frequencies:[523.25,466.16,415.3,369.99]},{id:"chord",name:"Major Chord",frequency:261.63,type:"sine",duration:600,category:"musical",frequencies:[261.63,329.63,392]},{id:"arpeggio",name:"Arpeggio",frequency:261.63,type:"triangle",duration:1e3,category:"musical",frequencies:[261.63,329.63,392,523.25]}],Te=[{id:"bell",name:"Bell",frequency:800,type:"sine",duration:200,category:"notification"},{id:"ding",name:"Ding",frequency:1200,type:"square",duration:150,category:"notification"},{id:"chirp",name:"Chirp",frequency:1500,type:"sine",duration:80,category:"notification"},{id:"beep",name:"Beep",frequency:600,type:"sine",duration:100,category:"notification"},{id:"tick",name:"Tick",frequency:2e3,type:"square",duration:50,category:"notification"},{id:"ping",name:"Ping",frequency:1800,type:"triangle",duration:120,category:"notification"},{id:"bubble",name:"Bubble",frequency:800,type:"sine",duration:200,category:"notification",frequencies:[800,1200]},{id:"pop",name:"Pop",frequency:1e3,type:"square",duration:80,category:"notification"}],Ae=[{id:"buzz",name:"Buzz",frequency:400,type:"sawtooth",duration:250,category:"game"},{id:"whoosh",name:"Whoosh",frequency:200,type:"sawtooth",duration:500,category:"game",frequencies:[200,150,100]},{id:"bloop",name:"Bloop",frequency:300,type:"sine",duration:400,category:"game",frequencies:[300,400,350]},{id:"zap",name:"Zap",frequency:1500,type:"square",duration:120,category:"game",frequencies:[1500,1e3,500]},{id:"bounce",name:"Bounce",frequency:500,type:"triangle",duration:300,category:"game",frequencies:[500,700,600,800]},{id:"powerup",name:"Power Up",frequency:440,type:"square",duration:600,category:"game",frequencies:[440,523,659,784]},{id:"coin",name:"Coin",frequency:1046,type:"square",duration:300,category:"game",frequencies:[1046,1318]},{id:"fanfare",name:"Fanfare",frequency:523,type:"triangle",duration:1200,category:"game",frequencies:[523,659,784,1046]}],vn=[{id:"classic",name:"Classic System Alerts",sounds:we},{id:"musical",name:"Musical Notes & Melodies",sounds:ke},{id:"notification",name:"Notification Alerts",sounds:Te},{id:"game",name:"Game & Action Sounds",sounds:Ae}],de=[...we,...ke,...Te,...Ae];async function Sn(n){try{if(!n||!n.frequency||!n.type||!n.duration)return!1;const s=window.AudioContext||window.webkitAudioContext;if(!s)return!1;const t=new s;if(n.frequencies&&n.frequencies.length>1)return Cn(t,n);const r=t.createOscillator(),o=t.createGain();return r.connect(o),o.connect(t.destination),r.frequency.value=n.frequency,r.type=n.type,o.gain.setValueAtTime?(o.gain.setValueAtTime(.3,t.currentTime),o.gain.exponentialRampToValueAtTime(.01,t.currentTime+n.duration/1e3)):o.gain.value=.3,r.start(),r.stop(t.currentTime+n.duration/1e3),setTimeout(()=>{t.close()},n.duration+100),!0}catch(s){return console.warn("Sound playback failed:",s),!1}}async function Cn(n,s){try{const t=s.frequencies,r=s.duration/t.length,o=n.createGain();return o.connect(n.destination),o.gain.setValueAtTime?o.gain.setValueAtTime(.3,n.currentTime):o.gain.value=.3,t.forEach((a,l)=>{const i=n.createOscillator(),u=n.createGain();i.connect(u),u.connect(o),i.frequency.value=a,i.type=s.type;const c=n.currentTime+l*r/1e3,x=c+r/1e3;u.gain.setValueAtTime?(u.gain.setValueAtTime(1,c),u.gain.exponentialRampToValueAtTime(.01,x)):u.gain.value=1,i.start(c),i.stop(x)}),setTimeout(()=>{n.close()},s.duration+100),!0}catch(t){return console.warn("Melody playback failed:",t),!1}}function ee(){return de[Math.floor(Math.random()*de.length)]}function Pn(n){return n&&de.find(s=>s.id===n)||null}const wn=Ne(H)(`
  &:last-child {
    padding-bottom: 8px;
  }
`);function kn({player:n,index:s,isActive:t,canEdit:r=!0,canDelete:o=!0,onEdit:a,onDelete:l,onRoleChange:i}){const{t:u}=q(),[c,x]=d.useState(null),[p,f]=d.useState(null),b=v=>{x(v.currentTarget)},h=()=>{x(null)},S=v=>{v.stopPropagation(),f(v.currentTarget)},C=()=>{f(null)},w=()=>{h(),a?.(n)},L=()=>{h(),l?.(n.id)},P=v=>{C(),i?.(n.id,v)},I=v=>v.split(" ").map(k=>k.charAt(0)).join("").toUpperCase().slice(0,2)||"P",j=v=>{switch(v){case"dom":return"primary";case"sub":return"secondary";case"vers":return"default";default:return"default"}};return e.jsxs(_,{sx:{border:t?"2px solid":"1px solid",borderColor:t?"primary.main":"divider",bgcolor:t?"action.selected":"background.paper",transition:"all 0.2s ease-in-out","&:hover":{borderColor:"primary.main",elevation:2}},children:[e.jsx(wn,{children:e.jsxs(m,{sx:{display:"flex",alignItems:"flex-start",gap:2},children:[e.jsx(ve,{sx:{bgcolor:t?"primary.main":"grey.500",marginTop:.5,width:24,height:24,fontWeight:"bold"},children:I(n.name)}),e.jsx(m,{sx:{flexGrow:1,minWidth:0},children:e.jsxs(m,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[e.jsx(y,{variant:"h6",component:"h3",sx:{fontWeight:t?600:500,color:t?"primary.main":"text.primary",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",flexGrow:1},children:n.name||u("localPlayers.defaultPlayerName",{number:s+1})}),e.jsx(B,{label:u(`roles.${n.role}`),size:"small",variant:"outlined",color:j(n.role),onClick:r?S:void 0,sx:{cursor:r?"pointer":"default","&:hover":r?{bgcolor:"action.hover"}:{}}}),t&&e.jsx(B,{label:u("localPlayers.currentPlayer"),size:"small",color:"primary",icon:e.jsx(en,{})})]})}),(r||o)&&e.jsx(ue,{size:"small",onClick:b,"aria-label":u("localPlayers.playerActions",{name:n.name}),children:e.jsx(nn,{})})]})}),e.jsxs(ye,{anchorEl:c,open:!!c,onClose:h,transformOrigin:{horizontal:"right",vertical:"top"},anchorOrigin:{horizontal:"right",vertical:"bottom"},children:[r&&e.jsxs(A,{onClick:w,children:[e.jsx(pe,{children:e.jsx(Se,{fontSize:"small"})}),e.jsx(ce,{children:u("localPlayers.editPlayer")})]}),o&&e.jsxs(A,{onClick:L,sx:{color:"error.main"},children:[e.jsx(pe,{children:e.jsx(sn,{fontSize:"small",sx:{color:"error.main"}})}),e.jsx(ce,{children:u("localPlayers.deletePlayer")})]})]}),e.jsx(ye,{anchorEl:p,open:!!p,onClose:C,transformOrigin:{horizontal:"left",vertical:"top"},anchorOrigin:{horizontal:"left",vertical:"bottom"},children:["dom","sub","vers"].map(v=>e.jsx(A,{onClick:()=>P(v),selected:n.role===v,children:e.jsx(B,{label:u(`roles.${v}`),size:"small",variant:n.role===v?"filled":"outlined",color:j(v)})},v))})]})}function Tn({selectedSoundId:n,onSoundChange:s,label:t="Turn Sound"}){const r=async()=>{if(!n)return;const a=Pn(n);if(a)try{await Sn(a)||console.error("Failed to play sound")}catch(l){console.error("Failed to play sound:",l)}},o=a=>{s(a.target.value)};return e.jsxs(m,{sx:{display:"flex",alignItems:"center",gap:1,py:1},children:[e.jsxs(N,{fullWidth:!0,size:"small",children:[e.jsx(M,{id:"sound-select-label",children:t}),e.jsxs(O,{labelId:"sound-select-label",value:n||"",label:t,onChange:o,children:[e.jsx(A,{value:"",children:e.jsxs(m,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(tn,{fontSize:"small"}),"No sound"]})}),vn.map(a=>[e.jsx(Me,{sx:{fontWeight:"bold"},children:a.name},`header-${a.id}`),...a.sounds.map(l=>e.jsx(A,{value:l.id,sx:{pl:3},children:l.name},l.id))])]})]}),e.jsx($,{title:"Play sample",children:e.jsx(ue,{onClick:r,color:"primary",disabled:!n,size:"small",children:e.jsx(me,{})})})]})}function An({open:n,player:s,existingPlayers:t,onSubmit:r,onCancel:o}){const{t:a}=q(),[l,i]=d.useState({name:"",role:"vers",sound:ee().id}),[u,c]=d.useState({}),[x,p]=d.useState(!1);d.useEffect(()=>{i(s?{name:s.name,role:s.role,sound:s.sound||ee().id}:{name:"",role:"vers",sound:ee().id}),c({})},[s,n]);const f=d.useCallback(()=>{const j={},v=l.name.trim();return v?v.length<2?j.name=a("localPlayers.form.errors.nameTooShort"):v.length>20?j.name=a("localPlayers.form.errors.nameTooLong"):t.some(K=>K.id!==s?.id&&K.name.toLowerCase()===v.toLowerCase())&&(j.name=a("localPlayers.form.errors.nameDuplicate")):j.name=a("localPlayers.form.errors.nameRequired"),(!l.role||!["dom","sub","vers"].includes(l.role))&&(j.role=a("localPlayers.form.errors.roleRequired")),c(j),Object.keys(j).length===0},[l,t,s,a]),b=d.useCallback(j=>{const v=j.target.value;i(k=>({...k,name:v})),u.name&&c(k=>({...k,name:void 0}))},[u.name]),h=d.useCallback(j=>{const v=j.target.value;i(k=>({...k,role:v})),u.role&&c(k=>({...k,role:void 0}))},[u.role]),S=d.useCallback(j=>{i(v=>({...v,sound:j}))},[]),C=d.useCallback(async()=>{if(f()){p(!0);try{const j={name:l.name.trim(),role:l.role,sound:l.sound};await r(j)}catch(j){console.error("Error submitting player form:",j)}finally{p(!1)}}},[l,f,r]),w=d.useCallback(()=>{i({name:"",role:"vers",sound:ee().id}),c({}),o()},[o]),L=d.useCallback(j=>j.split(" ").map(v=>v.charAt(0)).join("").toUpperCase().slice(0,2)||"P",[]),P=j=>{switch(j){case"dom":return"primary";case"sub":return"secondary";case"vers":return"default";default:return"default"}},I=!!s;return e.jsxs(Oe,{open:n,onClose:w,maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{borderRadius:2}},children:[e.jsx(We,{children:a(I?"localPlayers.form.editPlayerTitle":"localPlayers.form.addPlayerTitle")}),e.jsxs(Ue,{children:[e.jsxs(m,{sx:{display:"flex",alignItems:"center",gap:2,mb:3,p:2,bgcolor:"action.hover",borderRadius:1},children:[e.jsx(ve,{sx:{bgcolor:"primary.main",width:56,height:56,fontSize:"1.5rem",fontWeight:"bold"},children:L(l.name||"P")}),e.jsxs(m,{sx:{direction:"row"},children:[e.jsx(y,{variant:"h6",children:l.name||a("localPlayers.form.previewName")}),e.jsx(m,{sx:{display:"flex",alignItems:"center",gap:1,mt:.5},children:e.jsx(B,{label:a(`roles.${l.role}`),size:"small",color:P(l.role),variant:"outlined"})})]})]}),e.jsxs(m,{sx:{display:"flex",flexDirection:"column",gap:3},children:[e.jsx(re,{label:a("localPlayers.form.nameLabel"),value:l.name,onChange:b,error:!!u.name,helperText:u.name||a("localPlayers.form.nameHelper"),placeholder:a("localPlayers.form.namePlaceholder"),fullWidth:!0,autoFocus:!I,inputProps:{maxLength:20}}),e.jsxs(N,{fullWidth:!0,error:!!u.role,children:[e.jsx(M,{children:a("localPlayers.form.roleLabel")}),e.jsxs(O,{value:l.role,onChange:h,label:a("localPlayers.form.roleLabel"),children:[e.jsx(A,{value:"dom",children:e.jsxs(m,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(B,{label:a("roles.dom"),size:"small",color:"primary",variant:"outlined"}),e.jsx(y,{variant:"body2",color:"text.secondary",children:a("localPlayers.form.roleDescriptions.dom")})]})}),e.jsx(A,{value:"sub",children:e.jsxs(m,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(B,{label:a("roles.sub"),size:"small",color:"secondary",variant:"outlined"}),e.jsx(y,{variant:"body2",color:"text.secondary",children:a("localPlayers.form.roleDescriptions.sub")})]})}),e.jsx(A,{value:"vers",children:e.jsxs(m,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(B,{label:a("roles.vers"),size:"small",color:"default",variant:"outlined"}),e.jsx(y,{variant:"body2",color:"text.secondary",children:a("localPlayers.form.roleDescriptions.vers")})]})})]}),u.role&&e.jsx(y,{variant:"caption",color:"error",sx:{mt:1,ml:1.5},children:u.role})]}),e.jsx(Tn,{selectedSoundId:l.sound,onSoundChange:S,label:a("localPlayers.form.soundLabel","Turn Sound")}),e.jsx(Z,{severity:"info",sx:{mt:1},children:e.jsx(y,{variant:"body2",children:a("localPlayers.form.helpText")})})]})]}),e.jsxs(Fe,{sx:{p:3,pt:1},children:[e.jsx(E,{onClick:w,disabled:x,children:a("cancel")}),e.jsx(E,{onClick:C,variant:"contained",disabled:x||!l.name.trim(),children:a(x?"localPlayers.form.saving":I?"localPlayers.form.saveChanges":"localPlayers.form.addPlayer")})]})]})}function In({roomId:n,isPrivateRoom:s,onComplete:t,onCancel:r,initialPlayers:o=[],initialSettings:a}){const{t:l}=q();console.debug("Setting up local players for room:",n);const[i,u]=d.useState(o),[c,x]=d.useState(!1),[p,f]=d.useState(null),[b,h]=d.useState(!1),[S,C]=d.useState(!1),[w,L]=d.useState(null),[P]=d.useState(a||{showTurnTransitions:!0,enableTurnSounds:!0,showPlayerAvatars:!0}),I=d.useCallback(()=>{const T=i.length>=2&&i.length<=4,R=i.every(J=>J.name.trim().length>0),G=new Set(i.map(J=>J.name.toLowerCase())).size===i.length,z=T&&R&&G;return x(z),i.length<2?f(l("localPlayers.errors.minimumPlayers")):i.length>4?f(l("localPlayers.errors.maximumPlayers")):f(R?G?null:l("localPlayers.errors.duplicateNames"):l("localPlayers.errors.emptyNames")),z},[i,l]);d.useEffect(()=>{o.length>0&&u(o)},[]),d.useEffect(()=>{I()},[I]);const j=d.useCallback(()=>`local_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,[]),v=d.useCallback(()=>l("localPlayers.defaultPlayerName",{number:i.length+1}),[i.length,l]),k=d.useCallback(()=>{i.length>=4||(L(null),C(!0))},[i.length]),K=d.useCallback(T=>{u(R=>R.filter(z=>z.id!==T).map((z,J)=>({...z,order:J,isActive:J===0})))},[]),Y=d.useCallback((T,R)=>{u(G=>G.map(z=>z.id===T?{...z,...R}:z))},[]),D=d.useCallback((T,R)=>{Y(T,{role:R})},[Y]),qe=d.useCallback(T=>{L(T),C(!0)},[]),Re=d.useCallback(async T=>{if(w)Y(w.id,T);else{const R={id:j(),name:T.name||v(),role:T.role||"vers",order:i.length,isActive:i.length===0,deviceId:"current_device",location:0,isFinished:!1,sound:T.sound};u(G=>[...G,R])}C(!1),L(null)},[w,Y,j,v,i.length]),Ke=d.useCallback(()=>{C(!1),L(null)},[]),Ve=d.useCallback(async()=>{if(I()){h(!0),f(null);try{await t(i,P)}catch(T){f(T instanceof Error?T.message:l("localPlayers.errors.sessionCreation"))}finally{h(!1)}}},[i,P,I,t,l]),Ee=d.useCallback(()=>{r()},[r]);return s?e.jsxs(_,{children:[e.jsx($e,{title:e.jsx(y,{variant:"h5",component:"h2",children:e.jsx(g,{i18nKey:"localPlayers.setupTitle"})}),subheader:e.jsx(y,{variant:"body2",color:"text.secondary",children:e.jsx(g,{i18nKey:"localPlayers.setupSubtitle"})})}),e.jsxs(H,{children:[p&&e.jsx(Z,{severity:"error",sx:{mb:2},children:p}),e.jsxs(m,{sx:{mb:3},children:[e.jsxs(m,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsx(y,{variant:"h6",children:e.jsx(g,{i18nKey:"localPlayers.playersTitle"})}),e.jsx(y,{variant:"body2",color:"text.secondary",children:l("localPlayers.playersCount",{count:i.length})})]}),i.length===0?e.jsxs(m,{sx:{textAlign:"center",py:4,border:"2px dashed",borderColor:"divider",borderRadius:1,bgcolor:"action.hover"},children:[e.jsx(y,{variant:"body1",color:"text.secondary",gutterBottom:!0,children:e.jsx(g,{i18nKey:"localPlayers.noPlayersYet"})}),e.jsx(E,{variant:"contained",startIcon:e.jsx(je,{}),onClick:k,children:e.jsx(g,{i18nKey:"localPlayers.addFirstPlayer"})})]}):e.jsxs(e.Fragment,{children:[e.jsx(m,{sx:{display:"flex",flexDirection:"column",gap:2},children:i.map((T,R)=>e.jsx(kn,{player:T,index:R,isActive:T.isActive,canEdit:!0,canDelete:i.length>1,onEdit:qe,onDelete:K,onRoleChange:D},T.id))}),i.length<4&&e.jsx(m,{sx:{display:"flex",justifyContent:"center",mt:2},children:e.jsx(Ge,{size:"small",color:"primary",onClick:k,"aria-label":"Add player",children:e.jsx(je,{})})})]})]}),e.jsxs(m,{sx:{display:"flex",gap:2,justifyContent:"flex-end"},children:[e.jsx(E,{variant:"outlined",onClick:Ee,disabled:b,children:e.jsx(g,{i18nKey:"cancel"})}),e.jsx(E,{variant:"contained",onClick:Ve,disabled:!c||b,children:b?e.jsx(g,{i18nKey:"localPlayers.creatingSession"}):e.jsx(g,{i18nKey:"localPlayers.startSession"})})]})]}),e.jsx(An,{open:S,player:w,existingPlayers:i,onSubmit:Re,onCancel:Ke})]}):e.jsx(_,{children:e.jsx(H,{children:e.jsx(Z,{severity:"warning",children:e.jsx(y,{children:e.jsx(g,{i18nKey:"localPlayers.privateRoomRequired"})})})})})}function Ln({actionName:n,actionLabel:s,selectedLevels:t,availableLevels:r,intensityNames:o={},onChange:a,disabled:l=!1}){const{t:i}=q(),u=`${n}-intensity-label`,c=p=>{const f=p.target.value,b=(typeof f=="string"?f.split(","):f).map(Number).filter(h=>!isNaN(h)).sort((h,S)=>h-S);a(b)},x=p=>p.length===0?i("none"):p.map(f=>o[f]||`${i("level")} ${f}`).join(", ");return r.length===0?e.jsx(e.Fragment,{}):e.jsxs(N,{margin:"normal",fullWidth:!0,disabled:l,children:[e.jsx(M,{id:u,children:s}),e.jsx(O,{labelId:u,id:n,label:s,multiple:!0,value:t,onChange:c,renderValue:x,children:r.map(p=>e.jsxs(A,{value:p,children:[e.jsx(_e,{checked:t.includes(p)}),e.jsx(ce,{primary:o[p]||`${i("level")} ${p}`})]},p))})]})}function qn({trueCondition:n,onChange:s,yesLabel:t,noLabel:r=null,sx:o={}}){const a=r??t;return e.jsx(m,{sx:{display:"flex",justifyContent:"center",my:1,...o},children:e.jsx(ne,{control:e.jsx(X,{checked:n||!1,onChange:s}),label:he(n?t:a)})})}function Ie({formData:n,setFormData:s,backgrounds:t,isRoom:r=!1}){const{t:o}=q(),a=r?"roomBackground":"background",l=r?"roomBackgroundURL":"backgroundURL",u=r?"useAppBackground":"color",c=n?.[a]||u,[x,p]=d.useState(c);d.useEffect(()=>{n?.[a]||s({...n,[a]:u})},[n,a,u,s]);const f=()=>Object.entries(t).map(([S,C])=>e.jsx(A,{value:S,children:C},S)),b=S=>{s({...n,[a]:S.target.value}),p(S.target.value)};d.useEffect(()=>{x!==c&&p(c)},[x,c]);const h=S=>{const C={...n,[a]:"custom",[l]:S.target.value};r&&(C.roomUpdated=!0),s(C)};return e.jsxs(e.Fragment,{children:[e.jsxs(N,{fullWidth:!0,margin:"normal",children:[e.jsx(M,{id:"background-label",children:o("background")}),e.jsx(O,{labelId:"background-label",id:"background",label:o("background"),value:x,onChange:b,children:f()})]}),x==="custom"&&e.jsx(re,{sx:{mt:2},label:o("url"),value:n?.[l]||"",fullWidth:!0,onChange:h,helperText:e.jsxs(e.Fragment,{children:[o("supportedSites"),e.jsx("br",{}),o("requiresEmbeddedUrl")]})})]})}class Rn{constructor(){ge(this,"voiceLoadPromise")}async waitForVoices(){return this.voiceLoadPromise?this.voiceLoadPromise:(this.voiceLoadPromise=new Promise(s=>{let t=window.speechSynthesis.getVoices();if(t.length>0){s(t);return}const r=()=>{t=window.speechSynthesis.getVoices(),t.length>0&&(window.speechSynthesis.removeEventListener("voiceschanged",r),s(t))};window.speechSynthesis.addEventListener("voiceschanged",r),setTimeout(()=>{window.speechSynthesis.removeEventListener("voiceschanged",r),s(window.speechSynthesis.getVoices())},3e3)}),this.voiceLoadPromise)}async getAvailableVoicesAsync(){return(await this.waitForVoices()).map(t=>({name:t.name,displayName:`${t.name} (${t.lang})`}))}async getPreferredVoiceAsync(){const s=await this.getAvailableVoicesAsync();return s.length>0?s[0].name:null}async speak(s,t,r=0){return new Promise((o,a)=>{if(!("speechSynthesis"in window)){a(new Error("Speech synthesis not supported"));return}const l=new SpeechSynthesisUtterance(s);if(l.pitch=r,t){const u=window.speechSynthesis.getVoices().find(c=>c.name===t);u&&(l.voice=u)}l.onend=()=>o(),l.onerror=i=>a(new Error(`Speech failed: ${i.error}`)),window.speechSynthesis.speak(l)})}stop(){window.speechSynthesis?.speaking&&window.speechSynthesis.cancel()}isAvailable(){return"speechSynthesis"in window}}const te=new Rn,Kn=()=>{const[n,s]=d.useState(!1),[t,r]=d.useState(!1),[o,a]=d.useState(null),l=d.useCallback(()=>{te.stop(),s(!1),r(!1)},[]),i=d.useCallback(async(u,c={})=>{try{r(!0),a(null),l(),s(!0),await te.speak(u,c.voice,c.pitch),r(!1),s(!1)}catch(x){const p=x instanceof Error?x.message:"TTS failed";a(p),s(!1),r(!1),console.error("TTS Error:",x)}},[l]);return d.useEffect(()=>()=>{l()},[l]),{speak:i,stop:l,isPlaying:n,error:o,isLoading:t}};function Vn({formData:n,setFormData:s,onVoiceChange:t}){const{t:r}=q(),[o,a]=d.useState([]),[l,i]=d.useState(!0),{speak:u}=Kn(),c=n.voicePreference||"",x=d.useCallback(h=>{const S={...n,voicePreference:h};s(S),t?.(h)},[n,s,t]);d.useEffect(()=>{let h=!0;return(async()=>{try{if(h){i(!0);const C=await te.getAvailableVoicesAsync();if(h){if(a(C),!c&&C.length>0){const w=await te.getPreferredVoiceAsync();w&&h&&x(w)}i(!1)}}}catch(C){console.error("Failed to load voices:",C),h&&i(!1)}})(),()=>{h=!1}},[c,x]);const p=h=>{x(h.target.value)},f=async()=>{const h=c||(o.length>0?o[0].name:"");if(!h)return;const S=r("tts.sampleText","Take a drink and enjoy the game.");try{await u(S,{voice:h,pitch:-2})}catch(C){console.error("Failed to play sample:",C)}},b=h=>h.displayName;return l?e.jsx(m,{sx:{py:1},children:e.jsx(y,{variant:"body2",color:"text.secondary",children:r("loadingVoices","Loading voices...")})}):o.length===0?e.jsx(m,{sx:{py:1},children:e.jsx(y,{variant:"body2",color:"text.secondary",children:r("noVoicesAvailable","No voices available for this language")})}):e.jsxs(m,{sx:{display:"flex",alignItems:"center",gap:1,py:1},children:[e.jsxs(N,{fullWidth:!0,size:"small",children:[e.jsx(M,{id:"voice-select-label",children:r("voiceSelection","Voice")}),e.jsx(O,{labelId:"voice-select-label",value:c,label:r("voiceSelection","Voice"),onChange:p,children:o.map(h=>e.jsx(A,{value:h.name,children:b(h)},h.name))})]}),e.jsx($,{title:r("playSample","Play sample"),children:e.jsx(ue,{onClick:f,color:"primary",disabled:!c,size:"small",children:e.jsx(me,{})})})]})}function En({boardUpdated:n}){const{i18n:s}=q(),[t,r]=d.useState(s.resolvedLanguage||"en"),[o,a]=d.useState(!1);async function l(u){a(!0),r(u);try{await s.changeLanguage(u),n()}catch(c){console.error("Error changing language:",c),await s.changeLanguage(u),n()}finally{a(!1)}}const i=Object.entries(un).map(([u,c])=>e.jsx(A,{value:u,children:c.label},u));return e.jsx(m,{sx:{minWidth:120,mt:1,mb:2},children:e.jsxs(N,{fullWidth:!0,children:[e.jsxs(M,{id:"language-label",sx:{display:"flex",alignItems:"center"},children:[e.jsx(fe,{sx:{mr:1}}),e.jsx(g,{i18nKey:"language"})]}),e.jsx(O,{labelId:"language-label",id:"language-select",value:t,disabled:o,label:e.jsxs(e.Fragment,{children:[e.jsx(fe,{}),e.jsx(g,{i18nKey:"language"})]}),onChange:u=>l(u.target.value),endAdornment:o&&e.jsx(He,{size:20}),MenuProps:{disableScrollLock:!0,BackdropProps:{invisible:!0},PaperProps:{style:{backdropFilter:"none",WebkitBackdropFilter:"none"}}},children:i})]})})}function F({field:n,formData:s,handleSwitch:t}){return e.jsx(qn,{trueCondition:s[n],onChange:r=>t(r,n),yesLabel:n,sx:{justifyContent:"left"}})}function zn({formData:n,setFormData:s,boardUpdated:t}){const[r,o]=Pe(),{t:a}=q(),l={useRoomBackground:a("useRoomBackground"),color:a("color"),gray:a("gray"),"metronome.gif":a("hypnoDick"),"pink-spiral.gif":a("pinkSpiral"),custom:a("customURL")};function i(c,x){s({...n,[x]:c.target.checked}),o({...r,[x]:c.target.checked})}function u(c){o({...r,voicePreference:c})}return e.jsxs(e.Fragment,{children:[e.jsx(En,{boardUpdated:t}),e.jsx(y,{variant:"h5",children:e.jsx(g,{i18nKey:"dialog"})}),e.jsx(F,{field:"playerDialog",formData:n,handleSwitch:i}),e.jsx(F,{field:"othersDialog",formData:n,handleSwitch:i}),e.jsx(Q,{}),e.jsx(y,{variant:"h5",sx:{mt:2},children:e.jsx(g,{i18nKey:"sounds"})}),e.jsx(F,{field:"mySound",formData:n,handleSwitch:i}),e.jsx(F,{field:"otherSound",formData:n,handleSwitch:i}),e.jsx(F,{field:"chatSound",formData:n,handleSwitch:i}),e.jsx(F,{field:"readRoll",formData:n,handleSwitch:i}),n.readRoll&&e.jsx(Vn,{formData:n,setFormData:s,onVoiceChange:u}),e.jsx(Q,{}),e.jsx(y,{variant:"h5",sx:{mt:2,textTransform:"capitalize"},children:e.jsx(g,{i18nKey:"misc"})}),e.jsx(F,{field:"hideBoardActions",formData:n,handleSwitch:i}),e.jsx(F,{field:"advancedSettings",formData:n,handleSwitch:i}),e.jsx(Ie,{formData:n,setFormData:s,backgrounds:l}),e.jsx(Q,{})]})}function Bn({formData:n,setFormData:s}){const t=(o,a)=>{s({...n,finishRange:a,boardUpdated:!0})},r=n?.finishRange||[30,70];return e.jsxs(m,{children:[e.jsx(Q,{}),e.jsx(y,{id:"finish-slider",sx:{my:1},children:e.jsx(g,{i18nKey:"finishSlider"})}),e.jsx(Ye,{"aria-labelledby":"finish-slider",value:r,onChange:t,valueLabelDisplay:"off"}),e.jsxs(m,{display:"flex",flexDirection:"column",justifyContent:"space-between",textAlign:"center",children:[e.jsxs(y,{whiteSpace:"nowrap",children:[e.jsx(g,{i18nKey:"noCum"})," ",r[0],"%"]}),e.jsxs(y,{whiteSpace:"nowrap",children:[e.jsx(g,{i18nKey:"ruined"})," ",r[1]-r[0],"%"]}),e.jsxs(y,{whiteSpace:"nowrap",children:[e.jsx(g,{i18nKey:"cum"})," ",100-r[1],"%"]})]}),e.jsx(Q,{sx:{my:1}})]})}function be({children:n}){return e.jsx(V,{size:{xs:12,md:5},children:n})}function ie({children:n,title:s,subtitle:t,defaultExpanded:r=!1,...o}){return e.jsxs(Je,{defaultExpanded:r,...o,sx:{backgroundColor:"inherit",backgroundImage:"none",boxShadow:"none"},children:[e.jsxs(Qe,{expandIcon:e.jsx(rn,{}),sx:{px:0},children:[e.jsxs(y,{variant:"h6",sx:{width:"33%"},children:[s,":"]}),e.jsx(y,{sx:{pt:.5},children:t})]}),e.jsx(Ze,{sx:{px:0},children:e.jsx(V,{container:!0,columnSpacing:2,justifyContent:"space-evenly",className:"columned-grid",children:n})})]})}const Le=d.forwardRef(({value:n,onChange:s,label:t,options:r,defaultValue:o=null,sx:a,helpIcon:l=!1,fullWidth:i=!0,...u},c)=>{const x=d.useMemo(()=>r.map(p=>typeof p=="string"?e.jsx(A,{value:p,children:he(p)},p):e.jsx(A,{value:p.value,children:p.label},p.value)),[r]);return e.jsxs(N,{fullWidth:i,margin:"normal",sx:a,...u,ref:c,children:[e.jsxs(M,{id:`${t}Label`,children:[e.jsx(g,{i18nKey:t}),!!l&&e.jsx(U,{sx:{ml:1,fontSize:16}})]}),e.jsx(O,{labelId:`${t}Label`,id:t,label:e.jsxs(e.Fragment,{children:[e.jsx(g,{i18nKey:t}),!!l&&e.jsx(U,{sx:{ml:1,fontSize:16}})]}),value:n||o||"",onChange:s,children:x})]})});function Nn({option:n,settings:s,setSettings:t,actionsFolder:r,type:o,showVariation:a=!1,showRole:l=!1}){const{t:i}=q(),u=`${n}label`,c=r[n]?.label;function x(h,S,C){const w=s.selectedActions?.[S];t({...s,selectedActions:{...s.selectedActions,[S]:{...w,type:o,levels:w?.levels??[],[C]:h?.target?.value}},boardUpdated:!0})}function p(h,S){const C=s.selectedActions?.[S];t({...s,selectedActions:{...s.selectedActions,[S]:{...C,type:o,levels:h}},boardUpdated:!0})}let f=12;(a||l)&&(f=6);let b=["dom","vers","sub"];return r[n]?.dom&&(b=[{label:r[n].dom,value:"dom"},{label:i("vers"),value:"vers"},{label:r[n].sub,value:"sub"}]),e.jsxs(V,{container:!0,justifyContent:"center",children:[e.jsx(V,{size:f,children:(()=>{const h=r[n],S=h?.intensities?Object.keys(h.intensities).map(Number).filter(w=>w>0).sort((w,L)=>w-L):[1,2,3,4],C=s.selectedActions?.[n]?.levels||[];return e.jsx(Ln,{actionName:n,actionLabel:h?.label||n,selectedLevels:C,availableLevels:S,intensityNames:h?.intensities||{},onChange:w=>p(w,n)})})()}),!!l&&e.jsx(V,{size:6,children:e.jsx(Le,{sx:{ml:1},value:s.selectedActions?.[n]?.role,onChange:h=>x(h,n,"role"),label:`${i("role")}: ${c}`,options:b,defaultValue:s.role||"sub"})}),!!a&&e.jsx(V,{size:6,children:e.jsx($,{placement:"top",title:e.jsxs(g,{i18nKey:"variationTooltip",children:[e.jsx(y,{variant:"subtitle2",children:"Standalone = Its own tile. "}),e.jsx(y,{variant:"subtitle2",children:"Append Some = 50% chance."}),e.jsx(y,{variant:"subtitle2",children:"Append Most = 90% chance."})]}),arrow:!0,children:e.jsxs(N,{fullWidth:!0,margin:"normal",sx:{ml:1},children:[e.jsxs(M,{id:`${u}Variation`,children:[`${c} ${i("variation")}`,e.jsx(U,{sx:{ml:1,fontSize:16}})]}),e.jsxs(O,{labelId:`${u}Variation`,id:`${n}Variation`,label:e.jsxs(e.Fragment,{children:[c," ",i("variation"),e.jsx(U,{sx:{ml:1,fontSize:16}})]}),value:s.selectedActions?.[n]?.variation||"standalone",onChange:h=>x(h,n,"variation"),children:[e.jsx(A,{value:"standalone",children:e.jsx(g,{i18nKey:"standalone"})}),e.jsx(A,{value:"appendSome",children:e.jsx(g,{i18nKey:"appendSome"})}),e.jsx(A,{value:"appendMost",children:e.jsx(g,{i18nKey:"appendMost"})})]})]})})})]},n)}function Mn({formData:n,setFormData:s}){return e.jsxs(xe,{direction:"row",spacing:1,alignItems:"center",justifyContent:"center",sx:{mt:1},children:[e.jsx(y,{children:e.jsx(g,{i18nKey:"solo"})}),e.jsx($,{title:e.jsx(y,{variant:"subtitle2",children:e.jsx(g,{i18nKey:"soloTooltip"})}),arrow:!0,children:e.jsx(U,{sx:{fontSize:15}})}),e.jsx(X,{id:"gameMode",checked:!se(n.gameMode),onChange:t=>s({...n,gameMode:t.target.checked?"local":"online",boardUpdated:!0}),inputProps:{"aria-label":"Game Type"}}),e.jsx(y,{children:e.jsx(g,{i18nKey:"local"})}),e.jsx($,{title:e.jsx(y,{variant:"subtitle2",children:e.jsx(g,{i18nKey:"localTooltip"})}),arrow:!0,children:e.jsx(U,{sx:{fontSize:15}})})]})}function On({formData:n}){const[s,t]=d.useState(!1);return d.useEffect(()=>{const r=Object.values(n).filter(a=>typeof a=="object"&&a?.type==="consumption"&&a?.levels&&a.levels.length>0).length,o=Object.values(n).filter(a=>typeof a=="object"&&a?.levels&&a.levels.length>0).length;t(r>1&&r>=o-r)},[n]),s?e.jsx(Z,{severity:"warning",children:e.jsx(g,{i18nKey:"consumptionWarning"})}):null}function Wn({formData:n,setFormData:s,actionsList:t}){const{t:r}=q(),{hasLocalPlayers:o}=xn(),a=!W(n?.room)&&!se(n.gameMode),l=a&&!o();function i(c,x={}){return Object.keys(t).filter(p=>t[p]?.type===c).map(p=>e.jsx(be,{children:e.jsx(Nn,{option:p,settings:n,setSettings:s,actionsFolder:t,type:c,...x})},p))}const u=c=>{const x=JSON.parse(JSON.stringify(n));return Object.keys(x).forEach(p=>{x.role=c,p.includes("role")&&(x[p]=c)}),x};return e.jsxs(e.Fragment,{children:[e.jsx(Mn,{formData:n,setFormData:s}),W(n?.room)&&!se(n.gameMode)&&e.jsx(V,{container:!0,alignContent:"center",justifyContent:"space-evenly",children:e.jsx(V,{sx:{py:3},children:e.jsx(y,{variant:"h5",children:e.jsx(g,{i18nKey:"privateRequired"})})})}),e.jsx(V,{container:!0,columnSpacing:2,justifyContent:"space-evenly",children:l&&e.jsx(be,{children:e.jsx(Le,{value:n.role,onChange:c=>s({...u(c.target.value),boardUpdated:!0}),label:"mainRole",options:["dom","vers","sub"],defaultValue:"sub"})})}),a?e.jsxs(e.Fragment,{children:[e.jsx(ie,{title:r("consumption"),subtitle:r("consumptionSubtitle"),children:i("consumption",{showVariation:!0})}),e.jsx(ie,{title:r("foreplay"),subtitle:r("foreplaySubtitle"),children:i("foreplay",{showRole:l})}),e.jsx(ie,{title:r("sex"),subtitle:r("sexSubtitle"),children:i("sex",{showRole:l})})]}):e.jsxs(e.Fragment,{children:[e.jsx(V,{container:!0,columnSpacing:2,justifyContent:"space-evenly",children:i("consumption",{showVariation:!0})}),e.jsx(Q,{}),e.jsx(V,{container:!0,columnSpacing:2,justifyContent:"center",children:i("sex")})]}),e.jsx(Bn,{setFormData:s,formData:n}),e.jsx(On,{formData:n})]})}function Un({formData:n,setFormData:s}){const{t}=q(),r={"1d4":2.5,"1d6":3.5,"2d4":5},o=n?.roomTileCount?Math.floor(n.roomTileCount/r[n.roomDice||"1d6"]):16,a=Array.from({length:7},(l,i)=>(i+2)*10).map(l=>e.jsx(A,{value:l,children:l},l));return e.jsxs(m,{children:[e.jsx(y,{variant:"subtitle1",sx:{mb:2,fontWeight:"medium"},children:e.jsx(g,{i18nKey:"gameSpeed"})}),e.jsxs(m,{sx:{display:"flex",gap:2,alignItems:"flex-end",flexWrap:"wrap"},children:[e.jsxs(N,{sx:{minWidth:120,flex:1},children:[e.jsx(M,{id:"diceRole-label",children:e.jsx(g,{i18nKey:"roomDice"})}),e.jsxs(O,{labelId:"diceRole-label",id:"diceRole-select",value:n?.roomDice||"1d4",label:t("roomDice"),onChange:l=>s({...n,roomDice:l.target.value,roomUpdated:!0}),children:[e.jsx(A,{value:"1d4",children:"1d4"}),e.jsx(A,{value:"1d6",children:"1d6"}),e.jsx(A,{value:"2d4",children:"2d4"})]})]}),e.jsxs(N,{sx:{minWidth:120,flex:1},children:[e.jsx(M,{id:"tile-count-label",children:e.jsx(g,{i18nKey:"roomTileCount"})}),e.jsx(O,{labelId:"tile-count-label",id:"tile-count-select",value:String(n?.roomTileCount||40),label:t("roomTileCount"),onChange:l=>s({...n,roomTileCount:Number(l.target.value),roomUpdated:!0}),children:a})]}),e.jsxs(m,{sx:{display:"flex",flexDirection:"column",alignItems:"center",minWidth:120},children:[e.jsx(y,{variant:"body2",color:"text.secondary",sx:{mb:1},children:e.jsx(g,{i18nKey:"averageRolls"})}),e.jsx(B,{label:o,color:"primary",variant:"outlined",sx:{minWidth:50,fontWeight:"bold"}})]})]})]})}function Fn({formData:n,setFormData:s}){const t=d.useCallback(()=>{s({...n,roomRealtime:!n.roomRealtime,roomUpdated:!0})},[n,s]);return e.jsxs(m,{children:[e.jsx(y,{variant:"subtitle1",sx:{mb:2,fontWeight:"medium"},children:e.jsx(g,{i18nKey:"playerListOptions"})}),e.jsx(m,{sx:{display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsxs(xe,{direction:"row",spacing:2,alignItems:"center",children:[e.jsxs(m,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(y,{variant:"body2",color:"text.secondary",children:e.jsx(g,{i18nKey:"realtime"})}),e.jsx($,{title:e.jsx(y,{variant:"subtitle2",children:e.jsx(g,{i18nKey:"realtimeTooltip"})}),arrow:!0,children:e.jsx(U,{sx:{fontSize:16,color:"text.secondary"}})})]}),e.jsx(ne,{control:e.jsx(X,{checked:!!n.roomRealtime,onChange:t,inputProps:{"aria-label":he("playerList")}}),label:"",sx:{margin:0}}),e.jsxs(m,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(y,{variant:"body2",color:"text.secondary",children:e.jsx(g,{i18nKey:"delayed"})}),e.jsx($,{title:e.jsx(y,{variant:"subtitle2",children:e.jsx(g,{i18nKey:"delayedTooltip"})}),arrow:!0,children:e.jsx(U,{sx:{fontSize:16,color:"text.secondary"}})})]})]})})]})}function $n({formData:n,setFormData:s}){const{id:t}=Xe(),{t:r}=q(),o=c=>{let x;c.target.checked&&W(t)?x=pn("123456789ABCDEFGHJKLMNPQRSTUVWXYZ",5)():t&&c.target.checked&&!W(t)?x=t:x="PUBLIC",s({...n,room:x.toUpperCase(),gameMode:W(x)?"online":n.gameMode})},a=d.useCallback(c=>{s({...n,room:c.currentTarget.value,boardUpdated:!0})},[n,s]),l=d.useCallback(c=>{c.key==="Enter"&&s({...n,room:c.currentTarget.value,boardUpdated:!0})},[n,s]),i=d.useCallback(c=>{const x=c.target.value.toUpperCase();c.target.value=x},[]),u=!W(n.room);return e.jsxs(e.Fragment,{children:[e.jsxs(xe,{direction:"row",spacing:1,alignItems:"center",justifyContent:"center",sx:{width:"100%"},children:[e.jsx(y,{children:e.jsx(g,{i18nKey:"public"})}),e.jsx(X,{id:"showPrivate",checked:u,onChange:o,slotProps:{input:{"aria-label":r("room")}}}),e.jsx(y,{children:e.jsx(g,{i18nKey:"private"})}),e.jsx($,{title:e.jsx(y,{variant:"subtitle2",children:e.jsx(g,{i18nKey:"privateOptions"})}),arrow:!0,children:e.jsx(U,{sx:{fontSize:15}})})]}),u&&e.jsx(re,{fullWidth:!0,id:"privateRoom",label:r("privateRoom"),defaultValue:n.room?.toUpperCase(),margin:"normal",onBlur:a,onKeyDown:l,onChange:i,inputProps:{style:{textTransform:"uppercase"}}})]})}function Gn({roomId:n="PRIVATE",isPrivateRoom:s=!0}){const{t}=q(),{localPlayers:r,hasLocalPlayers:o,session:a,sessionSettings:l,clearLocalSession:i,updateSettings:u,createLocalSession:c}=mn(),[x,p]=d.useState(!1),[f,b]=d.useState(null),h=d.useCallback(()=>{p(!0),b(null)},[]),S=d.useCallback(()=>{p(!1),b(null)},[]),C=d.useCallback(async(P,I)=>{try{await c(n,P,I),p(!1),b(null)}catch(j){b(j instanceof Error?j.message:"Failed to save local player configuration")}},[n,c]),w=d.useCallback(async()=>{try{await i(),b(null)}catch(P){b(P instanceof Error?P.message:"Failed to clear local session")}},[i]),L=d.useCallback(async(P,I)=>{if(l)try{const j={...l,[P]:I};await u(j),b(null)}catch(j){b(j instanceof Error?j.message:"Failed to update settings")}},[l,u]);return x?e.jsxs(m,{children:[f&&e.jsx(Z,{severity:"error",sx:{mb:2},children:f}),e.jsx(In,{roomId:n,isPrivateRoom:s,onComplete:C,onCancel:S,initialPlayers:r,initialSettings:l})]}):e.jsxs(m,{children:[f&&e.jsx(Z,{severity:"error",sx:{mb:2},children:f}),o?e.jsxs(m,{children:[e.jsxs(m,{sx:{mb:3},children:[e.jsx(m,{sx:{display:"flex",flexDirection:"column",gap:1,mb:2},children:r.map(P=>e.jsxs(m,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",p:1,borderRadius:1,bgcolor:P.isActive?"primary.50":"background.default",border:P.isActive?"1px solid":"1px solid transparent",borderColor:P.isActive?"primary.main":"transparent"},children:[e.jsxs(m,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsxs(y,{variant:"body2",color:"text.secondary",children:["#",P.order+1]}),e.jsx(y,{variant:"body1",fontWeight:P.isActive?"bold":"normal",children:P.name}),e.jsx(B,{label:t(`roles.${P.role}`),size:"small",variant:"outlined"})]}),P.isActive&&e.jsx(B,{label:t("localPlayerSettings.players.currentTurn"),color:"primary",size:"small"})]},P.id))}),e.jsxs(m,{sx:{display:"flex",gap:1},children:[e.jsx(E,{variant:"outlined",startIcon:e.jsx(Se,{}),onClick:h,size:"small",children:e.jsx(g,{i18nKey:"localPlayerSettings.session.editButton"})}),e.jsx(E,{variant:"outlined",color:"error",startIcon:e.jsx(an,{}),onClick:w,size:"small",children:e.jsx(g,{i18nKey:"localPlayerSettings.session.clearButton"})})]})]}),a?.settings&&e.jsxs(m,{sx:{mt:3,p:2,borderRadius:1,bgcolor:"action.hover"},children:[e.jsxs(m,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[e.jsx(ln,{sx:{color:"text.secondary"}}),e.jsx(y,{variant:"subtitle1",component:"h4",children:e.jsx(g,{i18nKey:"localPlayerSettings.settings.title"})})]}),e.jsxs(m,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsx(ne,{control:e.jsx(X,{checked:a.settings.showTurnTransitions,onChange:P=>L("showTurnTransitions",P.target.checked)}),label:t("localPlayerSettings.settings.showTurnTransitions")}),e.jsx(ne,{control:e.jsx(X,{checked:a.settings.enableTurnSounds,onChange:P=>L("enableTurnSounds",P.target.checked)}),label:t("localPlayerSettings.settings.playTurnSounds")})]})]})]}):e.jsxs(m,{sx:{textAlign:"center",py:2},children:[e.jsx(Ce,{sx:{fontSize:48,color:"text.secondary",mb:2}}),e.jsx(y,{variant:"body1",color:"text.secondary",paragraph:!0,children:e.jsx(g,{i18nKey:"localPlayerSettings.noPlayers.description"})}),e.jsx(E,{variant:"contained",startIcon:e.jsx(me,{}),onClick:h,size:"large",children:e.jsx(g,{i18nKey:"localPlayerSettings.noPlayers.setupButton"})})]})]})}function _n({formData:n,setFormData:s}){const{t}=q(),r={useAppBackground:t("useAppBackground"),color:t("color"),gray:t("gray"),"metronome.gif":t("hypnoDick"),"pink-spiral.gif":t("pinkSpiral"),custom:t("customURL")};return e.jsxs(m,{sx:{p:2},children:[e.jsx(_,{variant:"outlined",sx:{mb:3},children:e.jsxs(H,{children:[e.jsxs(m,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[e.jsx(on,{sx:{color:"primary.main"}}),e.jsx(y,{variant:"h6",component:"h3",children:t("roomType")})]}),e.jsx($n,{formData:n,setFormData:s})]})}),!W(n.room)&&e.jsxs(e.Fragment,{children:[e.jsx(_,{variant:"outlined",sx:{mb:3},children:e.jsxs(H,{children:[e.jsxs(m,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[e.jsx(Ce,{sx:{color:"primary.main"}}),e.jsx(y,{variant:"h6",component:"h3",children:t("localPlayerSettings.title")})]}),e.jsx(Gn,{roomId:n.room,isPrivateRoom:!W(n.room)})]})}),e.jsx(_,{variant:"outlined",sx:{mb:3},children:e.jsxs(H,{children:[e.jsxs(m,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[e.jsx(cn,{sx:{color:"primary.main"}}),e.jsx(y,{variant:"h6",component:"h3",children:t("gameConfiguration")})]}),e.jsx(m,{sx:{mb:3},children:e.jsx(Un,{formData:n,setFormData:s})}),e.jsx(m,{sx:{p:2,borderRadius:1,bgcolor:"action.hover"},children:e.jsx(Fn,{formData:n,setFormData:s})})]})}),e.jsx(_,{variant:"outlined",sx:{mb:3},children:e.jsxs(H,{children:[e.jsxs(m,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[e.jsx(dn,{sx:{color:"primary.main"}}),e.jsx(y,{variant:"h6",component:"h3",children:t("visualSettings")})]}),e.jsx(Ie,{formData:n,setFormData:s,backgrounds:r,isRoom:!0})]})})]})]})}function oe({children:n,value:s,index:t,style:r,...o}){return e.jsx("div",{role:"tabpanel",hidden:s!==t,id:`simple-tabpanel-${t}`,"aria-labelledby":`simple-tab-${t}`,...o,children:s===t&&e.jsx(m,{sx:{p:3,...r},children:n})})}function Hn(n){return Object.values(n).some(({level:s})=>s>0)}function Yn(n,s){const t=n.selectedActions||{};return Object.entries(t).reduce((r,[o,a])=>(o in s&&(a?.variation?.startsWith("append")?r.withAppend[o]=a:r.withoutAppend[o]=a),r),{withAppend:{},withoutAppend:{}})}function Jn(n){return Object.keys(n).length>0&&Object.values(n).some(({level:s})=>s>0)}function Qn(n,s){const{withAppend:t,withoutAppend:r}=Yn(n,s);return Hn(r)?W(n.room)&&!se(n.gameMode)?"privateRequired":null:Jn(t)?"appendWithAction":"pickSomething"}function Zn({closeDialog:n,initialTab:s=0,onOpenSetupWizard:t}){const{user:r}=hn(),{t:o}=q(),[a,l]=Pe(),[i,u]=d.useState(s),[c,x]=d.useState(null),[p,f]=d.useState(!1),[b,h]=gn(),S=fn(),{isLoading:C,actionsList:w}=bn(b?.gameMode),L=(k,K)=>{u(K)},P=()=>l({...a,boardUpdated:!0}),I=d.useCallback(async k=>{k.preventDefault();const{displayName:K,...Y}=b,D=Qn(Y,w);return D?(x(o(D)),null):(await S(b,w),typeof n=="function"&&n(),null)},[b,w,o,x,S,n]),j=d.useCallback(k=>{h(K=>({...K,displayName:k.target.value}))},[h]),v=d.useCallback(k=>{k.key==="Enter"&&(h(K=>({...K,displayName:k.target.value})),I(k))},[I,h]);return!b.room||C?e.jsxs(m,{children:[e.jsxs(y,{variant:"h2",children:[e.jsx(g,{i18nKey:"loading"}),"..."]}),e.jsx(y,{variant:"body1",children:e.jsx(g,{i18nKey:"clearStorage"})})]}):e.jsxs(m,{component:"form",method:"post",onSubmit:I,className:"settings-box",children:[e.jsx(re,{fullWidth:!0,id:"displayName",label:o("displayName"),defaultValue:r?.displayName||b.displayName||"",required:!0,autoFocus:!0,onBlur:j,onKeyDown:v,margin:"normal"}),e.jsx(m,{sx:{borderBottom:1,borderColor:"divider"},children:e.jsxs(De,{value:i,onChange:L,"aria-label":o("gameSettings"),centered:!0,children:[e.jsx(ae,{label:o("gameboard"),...le(0)}),e.jsx(ae,{label:o("room"),...le(1)}),e.jsx(ae,{label:o("application"),...le(2)})]})}),e.jsx(oe,{value:i,index:0,style:{p:0},children:e.jsx(Wn,{formData:b,setFormData:h,actionsList:w})}),e.jsx(oe,{value:i,index:1,style:{p:0,pt:1},children:e.jsx(_n,{formData:b,setFormData:h})}),e.jsx(oe,{value:i,index:2,style:{p:0,pt:1},children:e.jsx(zn,{formData:b,setFormData:h,boardUpdated:P})}),e.jsxs("div",{className:"flex-buttons",children:[e.jsxs("div",{className:"left-buttons",children:[t&&e.jsx(E,{variant:"outlined",type:"button",onClick:t,children:e.jsx(g,{i18nKey:"setupWizard"})}),i===0&&e.jsx(E,{variant:"outlined",type:"button",onClick:()=>f(!0),children:e.jsx(g,{i18nKey:"customTilesLabel",children:"Game Tiles"})})]}),e.jsx(E,{variant:"contained",type:"submit",children:e.jsx(g,{i18nKey:"update"})})]}),p&&e.jsx(yn,{open:p,setOpen:f,boardUpdated:P,actionsList:w}),e.jsx(jn,{open:!!c,close:()=>x(null),children:c})]})}const cs=Object.freeze(Object.defineProperty({__proto__:null,default:Zn},Symbol.toStringTag,{value:"Module"}));export{Zn as G,In as L,Ln as M,oe as T,qn as Y,Pn as g,cs as i,Sn as p,te as t};
