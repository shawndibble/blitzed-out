const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["js/userList.tsx-5WXa-Bfy.js","js/chunk-DVu0ELID.js","js/chunk-Cv9LRx66.js","js/chunk-C4JUBbif.js","assets/index-C2TnOMdU.js","js/chunk-B37hsyTU.js","js/chunk-BCF63dVT.js","js/index.tsx-C7vLsIEf.js","js/chunk-Bh208MzB.js","js/chunk-CoCDAHy1.js","js/chunk-C37-iVkQ.js","js/schedule.tsx-BCJcF7a6.js","js/chunk-SfE-Iupz.js","js/theme.tsx-B-iOAgAd.js","js/chunk-Bl2I3sq_.js","js/index.tsx-BcSdRQlE.js","js/index.tsx-BobrgCH9.js","js/chunk-BU5Lbkq0.js","js/chunk-NPenkmUw.js","js/chunk-EL58PX5i.js","js/chunk-gkT8UsGz.js","js/chunk-DmVEMEf_.js","js/chunk-DYk7asbE.js","js/chunk-Cr2typhD.js","js/chunk-BV0OJ1j_.js","js/chunk-Du4Zw8zw.js","js/chunk-Dwsz7qGG.js","js/chunk-uAevzuqj.js","js/chunk-BScuUneS.js","js/chunk-hwdOzYKs.js","js/index.tsx-B5HXCzEq.js","js/SentryTest.tsx-DpGkfvCx.js"])))=>i.map(i=>d[i]);
import{A as d,_ as l}from"../assets/index-C2TnOMdU.js";import{a7 as C,ad as w,r as i,j as n,ae as E,af as v,ag as T,ah as p,ai as R,aj as P}from"./chunk-DVu0ELID.js";import{p as S,g as A,A as D}from"./chunk-C4JUBbif.js";import{a as L}from"./chunk-Cv9LRx66.js";function h(e){if(!e)return null;try{if(typeof e.toDate=="function")return e.toDate();if(typeof e=="string"){const r=new Date(e);if(isNaN(r.getTime()))throw new Error("Invalid serialized timestamp format");return r}else if(typeof e=="number"){const r=e<3250368e4?e*1e3:e,t=new Date(r);if(isNaN(t.getTime()))throw new Error("Invalid numeric timestamp format");return t}else if(typeof e=="object"&&e.seconds!==void 0){const r=e,t=new Date(r.seconds*1e3+(r.nanoseconds||0)/1e6);if(isNaN(t.getTime()))throw new Error("Invalid Firestore timestamp object format");return t}else{if(e instanceof Date)return e;throw console.warn("Unsupported timestamp format:",typeof e,e),new Error(`Unsupported timestamp format: ${typeof e}`)}}catch(r){return console.warn("Failed to parse timestamp:",r),null}}function m(e){return e.sort((r,t)=>{const s=h(r.timestamp),a=h(t.timestamp);return!s||!a?0:s.getTime()-a.getTime()})}function g(e){return JSON.parse(JSON.stringify(e)).reverse()}function b(e,r){return g(e).find(t=>t.type===r)}function O(e,r,t="ASC"){let s=g(e);return t==="DESC"&&(s=s.reverse()),s.filter(a=>a.type===r)}function Q(e,r){return g(e).find(r)}function I(e){return g(e)[0]}const N={messages:[],loading:!0,error:null,room:null,paginationCursor:null},U=L()(S((e,r)=>({...N,loadMessages:t=>{const a=m(t);e({messages:a,loading:!1,error:null})},addMessage:t=>{const{messages:s}=r();if(s.find(c=>c.id===t.id))return;const o=[...s,t],u=m(o);e({messages:u})},updateMessage:(t,s)=>{const{messages:a}=r();let o=!1;const u=a.map(c=>{if(c.id===t){const f={...c,...s};if(Object.keys(s).some(x=>c[x]!==s[x]))return o=!0,f}return c});if(o){const c=m(u);e({messages:c})}},clearMessages:()=>{e({messages:[],loading:!1,error:null})},setLoading:t=>{const{loading:s}=r();s!==t&&e({loading:t})},setError:t=>{const{error:s}=r();s!==t&&e({error:t})},setRoom:t=>{const{room:s}=r();s!==t&&e({room:t})},setPaginationCursor:t=>{const{paginationCursor:s}=r();s!==t&&e({paginationCursor:t})},getMessagesByType:t=>{const{messages:s}=r(),a=[];for(let o=0;o<s.length;o++)s[o].type===t&&a.push(s[o]);return a},getLatestMessage:()=>{const{messages:t}=r();return I(t)},getLatestMessageByType:t=>{const{messages:s}=r();return b(s,t)},getFilteredMessages:t=>{const{messages:s}=r(),a=[];for(let o=0;o<s.length;o++)t(s[o])&&a.push(s[o]);return a},getOrderedMessagesByType:(t,s="ASC")=>{const{messages:a}=r();return O(a,t,s)}}),{name:"messages-storage",partialize:e=>({messages:e.messages,room:e.room,paginationCursor:e.paginationCursor}),onRehydrateStorage:()=>e=>{if(e){const r=new Date;r.setHours(r.getHours()-24);const t=e.messages.filter(s=>{try{const a=h(s.timestamp);if(!a)throw console.warn(`Failed to parse timestamp for message ${s.id}:`,typeof s.timestamp,s.timestamp),new Error(`Failed to parse timestamp for message ${s.id}`);return a>r}catch(a){return console.warn(`Failed to parse message timestamp for message ID ${s.id}:`,a.message),!0}});t.length!==e.messages.length&&e.loadMessages(t)}}})),z=C.createContext(void 0);function y(e){const{id:r}=w(),{messages:t,loading:s,loadMessages:a,setLoading:o,setRoom:u,clearMessages:c}=U();i.useEffect(()=>{if(o(!0),u(r||null),!r){c();return}return A(r,M=>{a(M)})},[r,a,o,u,c]);const f={messages:t,isLoading:s};return n.jsx(z.Provider,{value:f,...e})}const j=i.lazy(()=>l(()=>import("./userList.tsx-5WXa-Bfy.js"),__vite__mapDeps([0,1,2,3,4,5,6])).then(e=>({default:e.UserListProvider}))),B=i.lazy(()=>l(()=>import("./index.tsx-C7vLsIEf.js"),__vite__mapDeps([7,1,2,8,3,4,5,9,10,11,12,13,14,6,15]))),F=i.lazy(()=>l(()=>import("./index.tsx-BobrgCH9.js"),__vite__mapDeps([16,1,2,17,18,14,3,4,5,6,19,20,21,22,9]))),V=i.lazy(()=>l(()=>import("./chunk-Cr2typhD.js").then(e=>e.i),__vite__mapDeps([23,4,1,2,24,9,10,11,3,5,12,13,14,6,21,25,22,26,27,28,29,18,19,30,17,20]))),k=i.lazy(()=>l(()=>import("./SentryTest.tsx-DpGkfvCx.js"),__vite__mapDeps([31,1,2,4])));function _({children:e}){const{id:r}=w(),t=P(),s=v();return i.useEffect(()=>{if(r&&r!==r.toUpperCase()){const a=s.pathname.replace(r,r.toUpperCase());t(a+s.search+s.hash,{replace:!0})}},[r,t,s]),n.jsx(n.Fragment,{children:e})}function $(){const e=i.useContext(D),r=v(),s=new URLSearchParams(r.search).get("sentry-test")==="true";if(i.useEffect(()=>(e&&(window.authContext=e),()=>{window.authContext=null}),[e]),!e||e.initializing)return n.jsx(d,{});if(s)return n.jsx(i.Suspense,{fallback:n.jsx(d,{}),children:n.jsx(k,{})});const a=e.user?n.jsx(V,{}):n.jsx(B,{});return n.jsxs(T,{children:[n.jsx(p,{path:"/",element:n.jsx(R,{replace:!0,to:"/PUBLIC"})}),n.jsx(p,{path:"/:id/cast",element:n.jsx(_,{children:n.jsx(i.Suspense,{fallback:n.jsx(d,{}),children:n.jsx(j,{children:n.jsx(y,{children:n.jsx(F,{})})})})})}),n.jsx(p,{path:"/:id",element:n.jsx(_,{children:n.jsx(i.Suspense,{fallback:n.jsx(d,{}),children:n.jsx(j,{children:n.jsx(y,{children:a})})})})})]})}function H(){return n.jsx(E,{children:n.jsx($,{})})}const W=Object.freeze(Object.defineProperty({__proto__:null,default:H},Symbol.toStringTag,{value:"Module"}));export{z as M,Q as a,W as i,b as l,O as o,h as p};
