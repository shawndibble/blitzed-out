import{q as $,r as D,j as e,t as R}from"./chunk-DDoLnHI0.js";import{C as _}from"./chunk-bqvoNmJe.js";import{T as K}from"./chunk-BDM5WtNj.js";import{d as N}from"./chunk-CoPHbQIg.js";import{u as H}from"./chunk-Bt1viq1_.js";import{a as Y}from"./chunk-B4PEA_xj.js";import{ab as z,h as P,aK as h,a4 as W,aL as q,w as T,aM as y,aN as Q,at as I,ae as Z,aO as J,aP as X,aQ as ee,G as U,B as b,aR as A,T as u,au as te,aS as ne,aT as ae,x as re,y as oe,z as se,k as O,aF as M,l as B,aD as F,t as le,aU as ie,aV as de,m as ce}from"./chunk-D59Sa5ya.js";import"./chunk-CtIAsvv6.js";import"../assets/index-BodytYbc.js";import"./chunk-CbUvEgHM.js";import"./chunk-Dk7I1tJi.js";import"./chunk-COViFSNc.js";import"./chunk-BICGdz9x.js";import"./chunk-Bp62TkGl.js";function me({title:r,date:n,url:t,description:s="",location:o="",baseUrl:l="https://blitzedout.com/PUBLIC",downloadIcs:i,buttonSx:j={}}){const d=z(),{t:a}=$(),[k,v]=D.useState(null),p=!!k,S=m=>{v(m.currentTarget)},g=()=>{v(null)},c=()=>r||a("calendar.gameTitle"),w=()=>{i(c(),n,t,x()),g()},x=()=>{let m=`${c()}`;return l&&(m+=`
${l}`),t&&(m+=`

${a("calendar.videoLink")}: ${t}`),s&&(m+=`

${s}`),m},E=()=>{const m=n.toISOString().replace(/-|:|\.\d+/g,""),f=new Date(n.getTime()+3600*1e3).toISOString().replace(/-|:|\.\d+/g,""),L="https://calendar.google.com/calendar/render",C=new URLSearchParams({action:"TEMPLATE",text:c(),dates:`${m}/${f}`,details:x()});return(o||t)&&C.append("location",o||t||""),`${L}?${C.toString()}`},G=()=>{const m="https://outlook.live.com/calendar/0/deeplink/compose",f=new URLSearchParams({path:"/calendar/action/compose",rru:"addevent",subject:c(),startdt:n.toISOString(),enddt:new Date(n.getTime()+36e5).toISOString(),body:x()});return(o||t)&&f.append("location",o||t||""),`${m}?${f.toString()}`},V=()=>{const m=Math.floor(n.getTime()/1e3),f=Math.floor((n.getTime()+3600*1e3)/1e3),L="https://calendar.yahoo.com/",C=new URLSearchParams({v:"60",title:c(),st:m.toString(),et:f.toString(),desc:x()});return(o||t)&&C.append("in_loc",o||t||""),`${L}?${C.toString()}`};return e.jsxs(e.Fragment,{children:[e.jsx(P,{variant:"outlined",size:"small",startIcon:e.jsx(W,{fontSize:"small"}),onClick:S,"aria-controls":p?"calendar-menu":void 0,"aria-haspopup":"true","aria-expanded":p?"true":void 0,sx:{borderColor:h(d.palette.secondary.main,.3),color:d.palette.secondary.main,"&:hover":{borderColor:d.palette.secondary.main,backgroundColor:h(d.palette.secondary.main,.05)},...j},children:a("calendar.addToCalendar")}),e.jsxs(q,{id:"calendar-menu",anchorEl:k,open:p,onClose:g,MenuListProps:{"aria-labelledby":"calendar-button",dense:!0},children:[e.jsxs(T,{onClick:w,children:[e.jsx(y,{children:e.jsx(Q,{fontSize:"small"})}),e.jsx(I,{children:a("calendar.downloadIcs")})]}),e.jsxs(T,{component:"a",href:E(),target:"_blank",rel:"noopener noreferrer",onClick:g,children:[e.jsx(y,{children:e.jsx(Z,{fontSize:"small"})}),e.jsx(I,{children:a("calendar.googleCalendar")})]}),e.jsxs(T,{component:"a",href:G(),target:"_blank",rel:"noopener noreferrer",onClick:g,children:[e.jsx(y,{children:e.jsx(J,{fontSize:"small"})}),e.jsx(I,{children:a("calendar.outlookCalendar")})]}),e.jsxs(T,{component:"a",href:V(),target:"_blank",rel:"noopener noreferrer",onClick:g,children:[e.jsx(y,{children:e.jsx(X,{fontSize:"small"})}),e.jsx(I,{children:a("calendar.yahooCalendar")})]}),e.jsxs(T,{onClick:w,children:[e.jsx(y,{children:e.jsx(ee,{fontSize:"small"})}),e.jsx(I,{children:a("calendar.appleCalendar")})]})]})]})}const he=(r,n,t,s)=>{const o=new Date(n.getTime()+36e5),l=a=>a.toISOString().replace(/-|:|\.\d+/g,"").slice(0,15)+"Z",i=l(n),j=l(o);let d=["BEGIN:VCALENDAR","VERSION:2.0","CALSCALE:GREGORIAN","METHOD:PUBLISH","BEGIN:VEVENT",`DTSTART:${i}`,`DTEND:${j}`,`SUMMARY:${r}`,`DESCRIPTION:${s?.replace(/\n/g,"\\n")||r}`,"STATUS:CONFIRMED"];return t&&d.push(`URL:${t}`),d=d.concat(["END:VEVENT","END:VCALENDAR"]),d.join(`\r
`)},pe=(r,n,t,s)=>{const o=he(r,n,t,s),l=new Blob([o],{type:"text/calendar;charset=utf-8"}),i=document.createElement("a");i.href=URL.createObjectURL(l),i.download=`blitzed-out-game-${n.toISOString().split("T")[0]}.ics`,document.body.appendChild(i),i.click(),document.body.removeChild(i)},xe=r=>{try{const{href:n}=new URL(r),t=Y(r);return e.jsx(P,{href:n,target:"_blank",rel:"noreferrer",variant:"outlined",size:"small",startIcon:r.includes("meet")||r.includes("zoom")?e.jsx(ne,{}):e.jsx(ae,{}),children:t})}catch{return null}};function ue({game:r}){const n=z(),{t}=$(),s=r.dateTime.toDate(),o=new Date().toDateString()===s.toDateString(),l=s.getTime()-new Date().getTime()<1440*60*1e3&&s>new Date;return e.jsxs(U,{container:!0,spacing:2,alignItems:"center",children:[e.jsx(U,{size:12,children:e.jsxs(b,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(A,{fontSize:"small",color:o?"secondary":"action",sx:{opacity:o?1:.7}}),e.jsxs(b,{sx:{display:"flex",gap:2},children:[e.jsx(u,{variant:"body2",fontWeight:o?"bold":"normal",children:s.toLocaleString([],{weekday:"short",month:"short",day:"numeric"})}),e.jsx(u,{variant:"body2",color:"text.secondary",children:s.toLocaleString([],{hour:"numeric",minute:"2-digit"})})]}),l&&e.jsx(te,{label:t("soon"),size:"small",color:"primary",sx:{height:20,fontSize:"0.7rem",ml:1,borderRadius:1,fontWeight:"bold",backgroundColor:h(n.palette.success.main,.8)}})]})}),e.jsx(U,{size:12,children:e.jsxs(b,{sx:{display:"flex",alignItems:"center",gap:1},children:[r.url?xe(r.url):e.jsx(u,{variant:"body2",color:"text.secondary",sx:{fontStyle:"italic",fontSize:"0.85rem"},children:t("noLinkProvided")}),e.jsx(me,{title:t("calendar.gameTitle"),date:s,url:r.url,downloadIcs:pe,buttonSx:{ml:1}})]})})]})}function Le({open:r,close:n,isMobile:t}){const{t:s}=$(),[o,l]=D.useState(""),{schedule:i,addToSchedule:j}=H(),d=N().add(2,"week"),a=z(),k=D.useCallback(()=>{l(null)},[]),v=D.useCallback(p=>{p.preventDefault();const S=p.currentTarget,g=S.elements.namedItem("date-time"),c=new Date(g.value),x=S.elements.namedItem("link").value;if(!c||!(c instanceof Date)){l("Please select a date and time");return}if(c<N().toDate()){l("Please select a date and time in the future");return}if(i.find(E=>E.dateTime.toDate().toUTCString()===c.toUTCString())){l("A game is already scheduled for this date and time");return}if(c>d.toDate()){l("Please select a date and time within the next two weeks");return}if(x&&!x.startsWith("http")){l("Please enter a valid URL");return}j(c,x),S.reset()},[i,j,d]);return e.jsxs(e.Fragment,{children:[e.jsx(re,{fullScreen:t,open:r,onClose:n,maxWidth:"md",children:e.jsxs("form",{onSubmit:v,children:[e.jsxs(oe,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(W,{color:"primary"}),e.jsx(u,{variant:"h5",component:"span",fontWeight:"bold",children:e.jsx(R,{i18nKey:"schedule"})}),e.jsx(_,{close:n})]}),e.jsxs(se,{children:[e.jsxs(O,{elevation:3,sx:{mb:4,background:h(a.palette.primary.main,.05),border:`1px solid ${h(a.palette.primary.main,.1)}`,borderRadius:2,overflow:"visible",position:"relative"},children:[e.jsx(M,{title:e.jsxs(b,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(A,{color:"primary"}),e.jsx(u,{variant:"h6",fontWeight:"bold",children:"Planned Games"})]}),sx:{pb:1,borderBottom:`1px solid ${h(a.palette.divider,.1)}`}}),e.jsx(B,{sx:{p:2},children:i.length?e.jsx(F,{spacing:2,children:i?.map(p=>e.jsx(le,{elevation:1,sx:{p:1.5,borderRadius:1.5},children:e.jsx(ue,{game:p})},p.id))}):e.jsxs(b,{sx:{p:3,textAlign:"center",color:h(a.palette.text.primary,.6),borderRadius:1,background:h(a.palette.background.paper,.5)},children:[e.jsx(u,{variant:"body1",children:"No Planned Games"}),e.jsx(u,{variant:"body2",sx:{mt:1,fontSize:"0.85rem"},children:"Use the form below to schedule your first game"})]})})]}),e.jsxs(O,{elevation:2,sx:{background:h(a.palette.background.paper,.7),borderRadius:2},children:[e.jsx(M,{title:e.jsxs(b,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(ie,{color:"secondary"}),e.jsx(u,{variant:"h6",fontWeight:"bold",children:e.jsx(R,{i18nKey:"scheduleGame"})})]}),sx:{pb:1,borderBottom:`1px solid ${h(a.palette.divider,.1)}`}}),e.jsx(B,{children:e.jsxs(F,{spacing:3,sx:{mt:1},children:[e.jsx(de,{name:"date-time",label:s("dateTime"),closeOnSelect:!1,disablePast:!0,maxDate:d,timeSteps:{minutes:30},sx:{width:"100%"},slotProps:{textField:{variant:"outlined",fullWidth:!0}}}),e.jsx(ce,{label:s("camUrl"),variant:"outlined",name:"link",fullWidth:!0,placeholder:"https://...",helperText:"Optional: Link to your stream or meeting"}),e.jsx(P,{variant:"contained",type:"submit",fullWidth:!0,size:"large",startIcon:e.jsx(A,{}),sx:{mt:2,py:1.2,borderRadius:1.5,fontWeight:"bold",textTransform:"none",boxShadow:a.shadows[4],"&:hover":{boxShadow:a.shadows[8]}},children:e.jsx(R,{i18nKey:"schedule"})})]})})]})]})]})}),e.jsx(K,{open:!!o,close:k,children:o})]})}export{Le as default};
