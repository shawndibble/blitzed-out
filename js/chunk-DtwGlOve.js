import{r as p,j as h,am as F}from"./chunk-DX6P0x0s.js";import{c as L}from"./chunk-kXcKns83.js";import{g as T}from"./chunk-B4PEA_xj.js";import{i as S}from"./chunk-DL-gC0ib.js";import{l as j}from"./chunk-EL58PX5i.js";import{u as M}from"./chunk-DbcbeV7n.js";function z({url:e}){const[n,t]=p.useState("video"),[r,o]=p.useState(e);if(p.useEffect(()=>{o(e),t("video")},[e]),!e)return null;const i=()=>{let c=!1;try{const s=new URL(e);c=s.host==="imgur.com"||s.host==="i.imgur.com"}catch{c=!1}if(c){const s=e.match(/imgur\.com\/([a-zA-Z0-9]+)/)?.[1];if(s){const a=`https://i.imgur.com/${s}.jpg`;o(a),t("image");return}}const d=`${e.replace(/\.(mp4|webm|ogg|mov)(\?.*)?$/i,"")}.jpg`;o(d),t("image")},u=()=>{let c=!1;try{const l=new URL(e);c=l.host==="imgur.com"||l.host==="i.imgur.com"}catch{c=!1}if(c){const l=e.match(/imgur\.com\/([a-zA-Z0-9]+)/)?.[1];if(l){const d=["jpg","png","gif","jpeg","webp"],s=r?.split(".").pop(),m=d.indexOf(s||"")+1;if(m<d.length){const f=d[m],y=`https://i.imgur.com/${l}.${f}`;o(y)}}}else{const l=["jpg","png","gif","jpeg","webp"],d=r?.split(".").pop(),a=l.indexOf(d||"")+1;if(a<l.length&&r){const m=l[a],y=`${r.replace(/\.[^.]+(\?.*)?$/,"")}.${m}`;o(y)}}};return n==="video"?h.jsx("video",{autoPlay:!0,loop:!0,muted:!0,playsInline:!0,src:r||void 0,className:"video-background",onError:i,preload:"auto",crossOrigin:"anonymous",controls:!0}):h.jsxs(h.Fragment,{children:[h.jsx("div",{className:"image-background",style:{backgroundImage:`url(${r})`,backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat",width:"100%",height:"100%",position:"absolute",top:0,left:0}}),h.jsx("img",{src:r||void 0,onError:u,style:{display:"none"},alt:""})]})}function O({images:e,className:n,zoomDuration:t=3e3,zoomScale:r=1.4}){const[o,i]=p.useState(0),[u,c]=p.useState(0),l=p.useRef(null);if(p.useEffect(()=>{if(e.length===0||e.length===1)return;const s=()=>{l.current=window.setInterval(()=>{i(m=>(m+1)%e.length),c(m=>m+1)},t)},a=window.setTimeout(s,1e3);return()=>{window.clearTimeout(a),l.current&&(window.clearInterval(l.current),l.current=null)}},[e.length,t]),p.useEffect(()=>()=>{l.current&&(window.clearInterval(l.current),l.current=null)},[]),e.length===0)return null;const d=e[o];return h.jsx("div",{className:L("image-slideshow-container",n),"aria-hidden":!0,children:h.jsx("div",{className:"image-slideshow-slide",style:{backgroundImage:`url(${d})`,animationDuration:`${t}ms`,"--zoom-scale":r}},u)})}function $(e){return e.replace(/&amp;/g,"&")}async function P(e,n,t){const r=new Set;let o=null;const i=[s=>`https://api.reddit.com/r/${e}/top.json?limit=100&t=year&raw_json=1${s?`&after=${s}`:""}`,s=>`https://api.reddit.com/r/${e}/hot.json?limit=100&raw_json=1${s?`&after=${s}`:""}`],u="r.jina.ai",c=s=>`https://${u}/http://${s.replace(/^https?:\/\//,"")}`,l=async s=>{try{const a=await fetch(s,{signal:t,credentials:"omit",mode:"cors"});if(a.ok){const m=await a.text();try{return JSON.parse(m)}catch{const f=m.indexOf("{"),y=m.lastIndexOf("}");if(f!==-1&&y!==-1&&y>f)try{return JSON.parse(m.slice(f,y+1))}catch{return null}return null}}}catch{}try{const a=await fetch(c(s),{signal:t,credentials:"omit",mode:"cors"});if(!a.ok)return null;const m=await a.text();try{return JSON.parse(m)}catch{const f=m.indexOf("{"),y=m.lastIndexOf("}");if(f!==-1&&y!==-1&&y>f)try{return JSON.parse(m.slice(f,y+1))}catch{return null}return null}}catch{return null}};let d=0;for(;r.size<n&&d<i.length;){o=null;for(let s=0;s<5&&r.size<n;s+=1){const a=i[d](o),m=await l(a);if(!m)break;const f=m?.data?.children??[];o=m?.data?.after??null;for(const y of f){const b=y?.data;if(!b)continue;const I=b.url_overridden_by_dest,N=b.post_hint;if(b.is_gallery&&b.media_metadata&&b.gallery_data){const v=b.gallery_data.items||[];for(const A of v){const k=b.media_metadata[A.media_id],x=k?.s?.u||k?.s?.gif||k?.s?.mp4;if(typeof x=="string"){const U=x.startsWith("http")?x:`https:${x}`;/\.(jpe?g|png|gif|webp)(\?.*)?$/i.test(U)&&r.add($(U))}}continue}if(N==="image"&&typeof I=="string"&&/\.(jpe?g|png|gif|webp)(\?.*)?$/i.test(I)){r.add($(I));continue}const w=b.preview?.images?.[0]?.source?.url;if(w){const v=w.startsWith("http")?w:`https:${w}`;r.add($(v))}}if(!o)break}d+=1}return Array.from(r).slice(0,n)}async function H(e,n){const t=e.maxImages||150;switch(e.type){case"reddit":{const r=C(e.url);if(!r)throw new Error("Invalid Reddit URL");return{images:await P(r,t,n),source:`r/${r}`}}case"custom":return{images:[e.url],source:"Custom"};default:throw new Error(`Unsupported feed type: ${e.type}`)}}function B(e){return D(e)?"reddit":null}function D(e){try{const n=new URL(e);return/(^|\.)reddit\.com$/i.test(n.hostname)&&/\/r\//i.test(n.pathname)}catch{return!1}}function C(e){try{return new URL(e).pathname.match(/\/r\/([^/]+)/i)?.[1]??null}catch{return null}}const Z=3e5,E=new Map,R=new Map;async function J(e,n){const t=JSON.stringify(e),r=Date.now(),o=E.get(t);if(o&&r-o.fetchedAt<Z)return o.result;const i=R.get(t);if(i)try{return await i}catch{}const u=H(e,n).then(c=>(E.set(t,{fetchedAt:Date.now(),result:c}),c)).finally(()=>{R.delete(t)});return R.set(t,u),u}function K(e){const[n,t]=p.useState([]),[r,o]=p.useState(!1),[i,u]=p.useState(null),[c,l]=p.useState(null),d=p.useRef(null);return p.useEffect(()=>{if(d.current&&d.current.abort(),t([]),u(null),l(null),!e){o(!1);return}o(!0);const s=new AbortController;d.current=s;const a=async()=>{try{const f=await J(e,s.signal);if(s.signal.aborted)return;t(f.images),l(f.source),u(null)}catch(f){if(s.signal.aborted)return;u(f instanceof Error?f.message:"Failed to load images"),t([]),l(null)}finally{s.signal.aborted||o(!1)}},m=window.setTimeout(a,300);return()=>{s.abort(),window.clearTimeout(m)}},[e]),p.useEffect(()=>()=>{d.current&&d.current.abort()},[]),{images:n,isLoading:r,error:i,source:c}}function W({url:e}){const n=p.useMemo(()=>{const i=B(e);return i?{type:i,url:e,maxImages:150}:null},[e]),{images:t,isLoading:r,error:o}=K(n);return r?h.jsx("div",{className:"slideshow-container slideshow-loading","aria-hidden":!0,children:h.jsx("div",{className:"loading-message",children:"Loading images..."})}):o||t.length===0?null:h.jsx(O,{images:t})}function ye({url:e=null,isVideo:n=null}){const t=e&&/\.(mp4|webm|ogg|mov|gif)(\?.*)?$/i.test(e),o=!!(e?B(e):null),i=e==="color"||e==="gray"||e?.includes("/color")||e?.includes("/gray"),u=e&&!i&&(n||!n&&e);return h.jsxs(F,{className:L("main-container",!u&&"default-background"),role:"presentation",sx:{backgroundImage:!n&&e&&!i&&!o?`url(${e})`:"none"},children:[n&&!o&&(t?h.jsx(z,{url:e}):h.jsx("iframe",{width:"100%",height:"100%",src:e||void 0,title:"video",allow:"autoplay; fullscreen; encrypted-media; picture-in-picture",sandbox:"allow-same-origin allow-scripts allow-presentation",style:{border:0}})),!n&&o&&e?h.jsx(W,{url:e}):null]})}function V(e){const n=/vimeo\.com\/(\d+)/,t=e.match(n);return`https://player.vimeo.com/video/${t?t[1]:""}?autoplay=1&loop=1&autostart=true`}function X(e){const n=/(?:youtube\.com\/(?:[^/]+\/.+\/|(?:v|e(?:mbed)?)\/|[^#]*[?&]v=|youtu\.be\/)([^"&?/ ]{11})|^(?:[^"&?/ ]{11})$)/,t=e.match(n);return`https://www.youtube.com/embed/${t?t[1]:""}?autoplay=1&loop=1&autostart=true&mute=1&playsinline=1&controls=0&disablekb=1&fs=0&modestbranding=1&rel=0&iv_load_policy=3`}function Y(e){const n=/drive\.google\.com\/file\/d\/([^/]+)/,t=e.match(n);return`https://drive.google.com/file/d/${t?t[1]:""}/preview?loop=1`}function q(e){const n=/dropbox\.com\/s\/([^/]+)/,t=e.match(n);return`https://www.dropbox.com/s/${t?t[1]:""}?raw=1`}function G(e){return`https://pornhub.com/embed/${new URL(e).searchParams.get("viewkey")||""}?autoplay=1&loop=1&autostart=true&playsinline=1`}function Q(e){const n=e.split("-");return`https://xhamster.com/xembed.php?video=${n[n.length-1]}?autoplay=1&loop=1&autostart=true&playsinline=1`}function ee(e){const n=/media\.tenor\.com\/([a-zA-Z0-9_-]+)\/[^/]*\.(mp4|gif|webp)/;if(e.match(n))return e;const r=/tenor\.com\/view\/[^/]*-(\d+)/,o=e.match(r);return`https://tenor.com/embed/${o?o[1]:""}?autoplay=1`}function te(e){const n=/giphy\.com\/gifs\/[^/]*-([a-zA-Z0-9]+)/,t=e.match(n);return`https://media.giphy.com/media/${t?t[1]:""}/giphy.gif`}function ne(e){const n=/(?:gfycat\.com|redgifs\.com)\/(?:watch\/)?([a-zA-Z0-9]+)/,t=e.match(n),r=t?t[1]:"";return g(e,["redgifs.com"])?`https://files.redgifs.com/${r}.mp4`:`https://giant.gfycat.com/${r}.mp4`}function oe(e){const n=/redtube\.com\/(\d+)/,t=e.match(n);return`https://embed.redtube.com/?id=${t?t[1]:""}&autoplay=true&auto_play=1&playsinline=1&controls=1`}function re(e){const n=/youporn\.com\/watch\/(\d+)/,t=e.match(n);return`https://www.youporn.com/embed/${t?t[1]:""}?autoplay=1&playsinline=1`}function se(e){const n=/tube8\.com\/[^/]+\/[^/]+\/(\d+)/,t=e.match(n);return`https://www.tube8.com/embed/${t?t[1]:""}?autoplay=1&playsinline=1`}function ce(e){return`https://twitframe.com/show?url=${encodeURIComponent(e)}`}function ae(e){try{const o=new URL(e);if((o.host==="discordapp.net"||o.host.endsWith(".discordapp.net"))&&o.pathname.startsWith("/external/")&&(o.pathname.includes("/https/i.imgur.com/")||o.pathname.includes("/https/imgur.com/")))return e}catch(o){j.debug("URL parsing failed for Discord proxy check:",o)}let n="",t=!1;try{const o=new URL(e);t=o.host==="imgur.com"||o.host==="i.imgur.com"}catch(o){return j.debug("URL parsing failed for Imgur processing:",o),""}if(!t)return"";if(e.includes("/gallery/")){const o=e.match(/imgur\.com\/gallery\/[^#]*#([a-zA-Z0-9]+)/);if(o)n=o[1];else{const i=e.match(/#([a-zA-Z0-9]+)/);i&&(n=i[1])}}else{const o=/imgur\.com\/([a-zA-Z0-9]+)(?:\.(mp4|jpg|jpeg|png|gif|webp))?|images-ext-\d+\.discordapp\.net\/external\/[^/]+\/https\/i\.imgur\.com\/([a-zA-Z0-9]+)\.(mp4|jpg|jpeg|png|gif|webp)/,i=e.match(o);n=i?i[1]||i[3]:""}return`https://i.imgur.com/${n}.mp4`}function _(e){return/\.(mp4|webm|ogg|mov)(\?.*)?$/.test(e)}function ie(e){return g(e,["media.discordapp.net","cdn.discordapp.com"])&&!_(e)}function g(e,n){try{const t=new URL(e);return n.some(r=>t.host===r||t.host.endsWith("."+r))}catch(t){return j.debug("URL parsing failed in isValidHost, rejecting for security:",t),!1}}function ue(e){let n=null,t=!0;if(!e)return{url:"",isVideo:!1};switch(!0){case g(e,["vimeo.com"]):n=V(e);break;case g(e,["youtube.com","youtu.be"]):n=X(e);break;case g(e,["drive.google.com"]):n=Y(e);break;case g(e,["pornhub.com"]):n=G(e);break;case g(e,["xhamster.com"]):n=Q(e);break;case g(e,["dropbox.com"]):n=q(e);break;case g(e,["imgur.com","i.imgur.com"]):n=ae(e);break;case g(e,["tenor.com","media.tenor.com"]):n=ee(e),t=!0;break;case g(e,["giphy.com"]):n=te(e),t=!0;break;case g(e,["gfycat.com","redgifs.com"]):n=ne(e),t=!0;break;case g(e,["redtube.com"]):n=oe(e);break;case g(e,["youporn.com"]):n=re(e);break;case g(e,["tube8.com"]):n=se(e);break;case g(e,["twitter.com","x.com"]):n=ce(e),t=!1;break;case g(e,["thisvid.com"]):n=e;break;case g(e,["boyfriendtv.com"]):n=e;break;case ie(e):n=e,t=!1;break;case _(e):n=e;break;default:n=T(e),t=!1;break}return{url:n,isVideo:t}}function be(e,n){const{background:t,backgroundURL:r,roomBackground:o,roomBackgroundURL:i}=e,u=(d,s)=>{if(!d)return null;if(d==="custom")return s?i||null:r||null;if(d==="useAppBackground"){const a=t||"color";return a==="useRoomBackground"?"color":a==="custom"?r||null:a}if(d==="useRoomBackground"){if(S(n))return"color";const a=o||"useAppBackground";return a==="useAppBackground"?"color":a==="custom"?i||null:a}return d};let c=null;return!S(n)&&o&&o!=="useAppBackground"?c=u(o,!0):t?c=u(t,!1):c="color",c?c==="color"||c==="gray"?{url:c,isVideo:!1}:ue(c):{url:null,isVideo:!1}}function de(e){return{uid:e.uid,displayName:e.displayName,isSelf:e.isSelf,isFinished:e.isFinished}}function we(e){const[n,t]=p.useState(null),r=M(),o=p.useMemo(()=>r.map(u=>`${u.uid}-${u.displayName}-${u.isFinished}-${u.isSelf}`).join("|"),[r]),i=p.useMemo(()=>e?`${e.uid}-${e.displayName||""}`:null,[e]);return p.useEffect(()=>{if(!e){t(null);return}if(r.length<=1){t(null);return}const u=r.filter(a=>!a.isFinished);if(u.length<=1){t(null);return}let c=-1;c=u.findIndex(a=>a.uid===e.uid),c===-1&&(c=u.findIndex(a=>a.displayName===e.displayName)),c===-1&&(c=0);const l=(c+1)%u.length,d=u[l],s=de(d);t(s)},[i,o]),n}export{ye as R,be as g,ue as p,we as u};
