const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["js/getUniqueImportRecords.ts-CRmpVKeE.js","js/chunk-BoIRgPCP.js","js/chunk-BHSFqGHu.js","js/chunk-DXd3GHw1.js","js/chunk-DnXXKaCT.js","js/chunk-ht6BW3BQ.js","js/chunk-CHKE5haP.js","assets/index-DQAn7GQy.js","js/chunk-Bde8qXua.js","js/chunk-D5QWNTV5.js","js/chunk-JK3oC_qz.js","js/chunk-Bp62TkGl.js","js/chunk-DiRTbvB-.js","js/chunk-8BUNLMgE.js"])))=>i.map(i=>d[i]);
import{j as e,T as j,B as E,al as B,am as K,an as H,o as k,i as se,a8 as Ue,e as Z,C as De,ak as ye,p as be,q as je,O as nt,Q as $e,s as ve,aA as rt,aB as it,ap as at,aC as ot,E as ie,aD as Re,H as Te,D as We,aE as lt,w as Me,aF as ct,g as ut,aG as dt,S as mt,aH as pt,F as ht,aI as gt,af as xt,G as he}from"./chunk-BoIRgPCP.js";import{r as d,a as ft}from"./chunk-BHSFqGHu.js";import{C as yt,u as bt}from"./chunk-DnXXKaCT.js";import{E as oe,F as qe,i as ae,D as ce,G as jt,z as vt,B as pe,I as ze,J as Be,K as Ne,_ as Ke,L as He,N as Xe,O as Tt,P as It,Q as Ct,R as Gt,T as wt,V as ke,W as Et,X as Lt,Y as At,l as St,Z as Dt}from"../assets/index-DQAn7GQy.js";import{u as Pe}from"./chunk-D5QWNTV5.js";import{T as Nt}from"./chunk-ht6BW3BQ.js";import{A as ue,a as de,b as me}from"./chunk-JK3oC_qz.js";import{d as _t}from"./chunk-Bp62TkGl.js";import{a as _e,u as $t}from"./chunk-DiRTbvB-.js";import{u as ee,T as U}from"./chunk-CHKE5haP.js";import{n as ge}from"./chunk-DXd3GHw1.js";import{u as Mt}from"./chunk-8BUNLMgE.js";const kt=s=>{const a={};for(const n of s){const i={label:n.label||n.name,type:n.type||"action",actions:{None:[]}};if(n.intensities&&Array.isArray(n.intensities))for(const r of n.intensities)i.actions[r.label]=[];a[n.name]=i}return a},xe=async(s="en",a="online")=>{try{const n=await oe(s,a);return kt(n)}catch(n){return console.error("Error importing actions from Dexie:",n),{}}};function Ye(s){return[...Object.entries(s).flatMap(([n,{label:i,actions:r}])=>r?Object.keys(r).filter(u=>u!==qe).map((u,t)=>({group:_t(n),groupLabel:i,value:n,intensity:Number(t+1),translatedIntensity:u,label:`${i} - ${u}`})):[]),{group:ae.t("misc"),groupLabel:ae.t("misc"),value:"misc",intensity:1,translatedIntensity:ae.t("all"),label:`${ae.t("misc")} - ${ae.t("all")}`}]}const Ie=50,Ce=100,Ge=50,we=1,Ee=10,Le=1,Ae=10,Je=["none","all","default","undefined","null"],Pt=["solo","foreplay","sex","consumption"],Vt=(s,a="en",n="online",i)=>{const r=[],h=[];if(!s||s.trim().length===0)return r.push("Group name is required"),{isValid:!1,errors:r,warnings:h};const u=s.trim();return u.length>Ie&&r.push(`Group name must be ${Ie} characters or less`),Je.includes(u.toLowerCase())&&r.push(`"${u}" is a reserved name and cannot be used`),/^[a-zA-Z0-9_-]+$/.test(u)||r.push("Group name can only contain letters, numbers, hyphens, and underscores"),/^[a-zA-Z]/.test(u)||r.push("Group name must start with a letter"),{isValid:r.length===0,errors:r,warnings:h}},Qe=s=>{const a=[],n=[];return!s||s.trim().length===0?(a.push("Group label is required"),{isValid:!1,errors:a,warnings:n}):(s.trim().length>Ce&&a.push(`Group label must be ${Ce} characters or less`),{isValid:a.length===0,errors:a,warnings:n})},Ot=s=>{const a=[],n=[];if(!s||s.length===0)return a.push("At least one intensity level is required"),{isValid:!1,errors:a,warnings:n};s.length<Le&&a.push(`At least ${Le} intensity level is required`),s.length>Ae&&a.push(`Maximum ${Ae} intensity levels allowed`);const i=new Set,r=new Set;for(let t=0;t<s.length;t++){const o=s[t];if((!o.id||o.id.trim().length===0)&&a.push(`Intensity level ${t+1} is missing an ID`),!o.label||o.label.trim().length===0)a.push(`Intensity level ${t+1} is missing a label`);else{const c=o.label.trim();c.length>Ge&&a.push(`Intensity level ${t+1} label must be ${Ge} characters or less`),r.has(c.toLowerCase())?a.push(`Intensity label "${c}" is used multiple times`):r.add(c.toLowerCase())}typeof o.value!="number"||!Number.isInteger(o.value)?a.push(`Intensity level ${t+1} must have a valid integer value`):((o.value<we||o.value>Ee)&&a.push(`Intensity level ${t+1} value must be between ${we} and ${Ee}`),i.has(o.value)?a.push(`Intensity value ${o.value} is used multiple times`):i.add(o.value))}const h=Array.from(i).sort((t,o)=>t-o);let u=h[0];for(const t of h){if(t!==u){n.push("Intensity values are not sequential. Consider using values like 1, 2, 3, 4 for better user experience");break}u++}return{isValid:a.length===0,errors:a,warnings:n}},Ze=async(s,a)=>{const n=[],i=[],r=Vt(s.name,s.locale||"en",s.gameMode||"online");n.push(...r.errors),i.push(...r.warnings||[]);const h=Qe(s.label);n.push(...h.errors),i.push(...h.warnings||[]);const u=Ot(s.intensities);if(n.push(...u.errors),i.push(...u.warnings||[]),r.isValid&&s.name)try{await jt(s.name,s.locale||"en",s.gameMode||"online",a)||n.push(`A group with the name "${s.name}" already exists for this locale and game mode`)}catch{i.push("Could not verify group name uniqueness")}return{isValid:n.length===0,errors:n,warnings:i}},Ve=async(s,a="en",n="online")=>{const i=[],r=[];if(!s.group||s.group.trim().length===0)return i.push("Tile must belong to a group"),{isValid:!1,errors:i,warnings:r};try{const h=await ce(s.group,a,n);if(!h)return i.push(`Group "${s.group}" does not exist for ${a}/${n}`),{isValid:!1,errors:i,warnings:r};const u=h.intensities.map(t=>t.value);u.includes(s.intensity)||i.push(`Intensity ${s.intensity} is not valid for group "${s.group}". Valid intensities: ${u.join(", ")}`),(!s.action||s.action.trim().length===0)&&i.push("Tile action is required")}catch(h){i.push(`Error validating tile: ${h}`)}return{isValid:i.length===0,errors:i,warnings:r}},Ft=()=>({MAX_GROUP_NAME_LENGTH:Ie,MAX_GROUP_LABEL_LENGTH:Ce,MAX_INTENSITY_LABEL_LENGTH:Ge,MIN_INTENSITY_VALUE:we,MAX_INTENSITY_VALUE:Ee,MIN_INTENSITIES_COUNT:Le,MAX_INTENSITIES_COUNT:Ae,RESERVED_GROUP_NAMES:Je,VALID_GROUP_TYPES:Pt}),Se="2.0.0";async function Ut(s="en",a="online"){try{const n=await vt({locale:s,gameMode:a}),i=await pe({isCustom:1}),r={version:Se,exportedAt:new Date().toISOString(),locale:s,gameMode:a,customGroups:n,customTiles:i};return JSON.stringify(r,null,2)}catch(n){throw console.error("Error exporting enhanced data:",n),new Error(`Export failed: ${n}`)}}async function Rt(s,a={}){const n={success:!1,importedGroups:0,importedTiles:0,errors:[],warnings:[]};try{let i;try{i=JSON.parse(s)}catch{return n.errors.push("Invalid JSON format"),n}if(!i.version||!i.customGroups||!i.customTiles)return n.errors.push("Invalid export format"),n;i.version!==Se&&n.warnings.push(`Format version mismatch: expected ${Se}, got ${i.version}`);const r=a.locale||i.locale||"en",h=a.gameMode||i.gameMode||"online",u=a.mergeStrategy||"skip";for(const o of i.customGroups)try{let c=o;const g=await ce(c.name,r,h);if(g)switch(u){case"skip":n.warnings.push(`Skipped existing group: ${c.name}`);continue;case"overwrite":await ze(g.id,{...c,locale:r,gameMode:h}),n.warnings.push(`Updated existing group: ${c.name}`);break;case"rename":{let w=`${c.name}_imported`,L=1;for(;await ce(w,r,h);)w=`${c.name}_imported_${L}`,L++;const S=c.name;c={...c,name:w},n.warnings.push(`Renamed group from ${S} to ${w}`);break}}const l=await Ze({...c,locale:r,gameMode:h});if(!l.isValid){n.errors.push(`Invalid group ${c.name}: ${l.errors.join(", ")}`);continue}await Be({...c,locale:r,gameMode:h})&&n.importedGroups++}catch(c){n.errors.push(`Error importing group ${o.name}: ${c}`)}const t=await pe();for(const o of i.customTiles)try{if(t.find(p=>p.group===o.group&&p.intensity===o.intensity&&p.action===o.action&&p.gameMode===o.gameMode)&&u==="skip"){n.warnings.push(`Skipped existing tile: ${o.action}`);continue}const g=await ce(o.group,r,h);if(!g){n.errors.push(`Tile references non-existent group: ${o.group}`);continue}if(!g.intensities.map(p=>p.value).includes(o.intensity)){n.errors.push(`Tile intensity ${o.intensity} not valid for group ${o.group}`);continue}await Ne({...o,gameMode:h}),n.importedTiles++}catch(c){n.errors.push(`Error importing tile: ${c}`)}return n.success=n.errors.length===0,n}catch(i){return n.errors.push(`Import failed: ${i}`),n}}async function Wt(s,a,n="en",i="online"){const r={success:!1,importedGroups:0,importedTiles:0,errors:[],warnings:[]};try{const{default:h}=await Ke(async()=>{const{default:c}=await import("./getUniqueImportRecords.ts-CRmpVKeE.js");return{default:c}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13])),u=await pe(),{newUniqueRecords:t,changedTagRecords:o}=h(s,u,a);for(const c of t)try{await Ne(c),r.importedTiles++}catch(g){r.errors.push(`Error importing tile: ${g}`)}for(const c of o)try{c.id&&await He(c.id,c)}catch(g){r.errors.push(`Error updating tile: ${g}`)}return r.success=r.errors.length===0,r.warnings.push("Imported using legacy format. Consider exporting in new format for better compatibility."),r}catch(h){return r.errors.push(`Legacy import failed: ${h}`),r}}async function qt(s,a,n={}){const i=s.trim();try{const r=JSON.parse(i);if(r.version&&r.customGroups!==void 0)return Rt(i,n)}catch{}return Wt(i,a,n.locale||"en",n.gameMode||"online")}function zt({expanded:s,handleChange:a,customTiles:n,mappedGroups:i,setSubmitMessage:r,bulkImport:h}){const u=d.useRef(null),{t}=ee(),{settings:o}=_e(),[c,g]=d.useState(""),[l,p]=d.useState(null),[w,L]=d.useState("enhanced"),[S,_]=d.useState("skip"),N=d.useCallback(async()=>{try{if(w==="enhanced"){const y=await Ut(o.locale||"en",o.gameMode||"online");g(y)}else{const D=n.filter(m=>m.isCustom).map(({group:m,intensity:T,action:G,tags:P,gameMode:C="online"})=>{const x=Ye(i[C]||{}).find(M=>M?.intensity===Number(T)&&M?.value===m);let b="";return b+=`[${x?.group||m} - ${x?.translatedIntensity||T}]
`,b+=G,b+=P?.length?`
Tags: `+P?.join(", "):"",b+=`
GameMode: ${C}`,b});g(D.join(`
---
`))}}catch(y){console.error("Error exporting data:",y),r({message:`Export failed: ${y}`,type:"error"})}},[n,i,g,w,o.locale,o.gameMode,r]);async function V(y){if(!y.current)return;const m=y.current.importData.value;if(!m.trim())return r({type:"error",message:t("Please enter data to import")});try{r({type:"info",message:"Importing data..."});const T=await qt(m,i,{locale:o.locale||"en",gameMode:o.gameMode||"online",mergeStrategy:S});if(p(T),T.success){T.importedTiles>0&&(await Ke(()=>import("../assets/index-DQAn7GQy.js").then(C=>C.a6),__vite__mapDeps([7,1,2,3,8])).then(C=>C.getTiles({isCustom:1}))).slice(-T.importedTiles).forEach(async C=>{Xe(`${C.group} - ${C.intensity}`,C.action)});let G="Import completed successfully!";T.importedGroups>0&&(G+=` Imported ${T.importedGroups} custom groups.`),T.importedTiles>0&&(G+=` Imported ${T.importedTiles} custom tiles.`),r({type:"success",message:G}),await N()}else r({type:"error",message:`Import failed: ${T.errors.join(", ")}`})}catch(T){console.error("Import error:",T),r({type:"error",message:`Import failed: ${T.message||T}`}),p(null)}}return d.useEffect(()=>{s==="ctImport"&&N()},[s,n,N]),e.jsxs(ue,{expanded:s==="ctImport",onChange:a("ctImport"),children:[e.jsx(de,{"aria-controls":"ctImport-content",id:"ctImport-header",children:e.jsx(j,{children:e.jsx(U,{i18nKey:"importExport"})})}),e.jsxs(me,{children:[e.jsx(j,{variant:"body1",sx:{mb:2},children:e.jsx(U,{i18nKey:"ctImportDescription"})}),e.jsxs(E,{sx:{mb:2},children:[e.jsx(j,{variant:"subtitle2",sx:{mb:1},children:"Export Format"}),e.jsxs(B,{size:"small",sx:{minWidth:150},children:[e.jsx(K,{children:"Format"}),e.jsxs(H,{value:w,onChange:y=>L(y.target.value),label:"Format",children:[e.jsx(k,{value:"enhanced",children:"Enhanced (v2.0)"}),e.jsx(k,{value:"legacy",children:"Legacy"})]})]}),e.jsx(j,{variant:"caption",display:"block",sx:{mt:.5,color:"text.secondary"},children:"Enhanced format includes custom groups. Legacy format is for backward compatibility."})]}),e.jsxs(E,{sx:{mb:2},children:[e.jsx(j,{variant:"subtitle2",sx:{mb:1},children:"Import Strategy"}),e.jsxs(B,{size:"small",sx:{minWidth:150},children:[e.jsx(K,{children:"Strategy"}),e.jsxs(H,{value:S,onChange:y=>_(y.target.value),label:"Strategy",children:[e.jsx(k,{value:"skip",children:"Skip Existing"}),e.jsx(k,{value:"overwrite",children:"Overwrite"}),e.jsx(k,{value:"rename",children:"Rename Conflicts"})]})]}),e.jsx(j,{variant:"caption",display:"block",sx:{mt:.5,color:"text.secondary"},children:"How to handle items that already exist during import."})]}),e.jsxs(E,{component:"form",method:"post",ref:u,children:[e.jsx(se,{id:"importData",name:"importData",multiline:!0,required:!0,fullWidth:!0,rows:6,sx:{pb:2},value:c,onChange:y=>g(y.target.value),placeholder:w==="enhanced"?"Paste enhanced format JSON data here...":"Paste legacy format data here...",InputProps:{endAdornment:e.jsx(yt,{text:c}),sx:{alignItems:"flex-start"}}}),l&&e.jsxs(Ue,{severity:l.success?"success":"error",sx:{mb:2},onClose:()=>p(null),children:[e.jsx(j,{variant:"body2",children:e.jsx("strong",{children:"Import Results:"})}),l.importedGroups>0&&e.jsxs(j,{variant:"body2",children:["• ",l.importedGroups," custom groups imported"]}),l.importedTiles>0&&e.jsxs(j,{variant:"body2",children:["• ",l.importedTiles," custom tiles imported"]}),l.warnings.length>0&&e.jsxs(E,{sx:{mt:1},children:[e.jsx(j,{variant:"body2",color:"warning.main",children:e.jsx("strong",{children:"Warnings:"})}),l.warnings.map((y,D)=>e.jsxs(j,{variant:"body2",color:"warning.main",children:["• ",y]},D))]}),l.errors.length>0&&e.jsxs(E,{sx:{mt:1},children:[e.jsx(j,{variant:"body2",color:"error.main",children:e.jsx("strong",{children:"Errors:"})}),l.errors.map((y,D)=>e.jsxs(j,{variant:"body2",color:"error.main",children:["• ",y]},D))]})]}),e.jsx(Z,{fullWidth:!0,variant:"contained",type:"button",onClick:()=>V(u),children:e.jsx(U,{i18nKey:"import"})})]})]})]})}function Bt({value:s,onChange:a,locale:n,gameMode:i,includeDefault:r=!0,disabled:h=!1,refreshTrigger:u=0}){const{t}=ee(),[o,c]=d.useState([]),[g,l]=d.useState(!0);return d.useEffect(()=>{(async()=>{l(!0);try{const w=await oe(n,i),L=r?w:w.filter(S=>!S.isDefault);c(L)}catch(w){console.error("Error loading custom groups:",w),c([])}finally{l(!1)}})()},[n,i,r,u]),g?e.jsxs(B,{fullWidth:!0,disabled:!0,children:[e.jsx(K,{children:t("customGroups.loadingGroups")}),e.jsx(H,{value:"",children:e.jsx(k,{value:"",children:e.jsxs(E,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(De,{size:16}),e.jsx("span",{children:t("customGroups.loadingGroups")})]})})})]}):e.jsx(E,{children:e.jsxs(B,{fullWidth:!0,disabled:h,children:[e.jsx(K,{children:t("Group")}),e.jsx(H,{value:s,onChange:p=>a(p.target.value),label:t("Group"),children:o.length===0?e.jsx(k,{value:"",disabled:!0,children:e.jsx(j,{color:"text.secondary",children:t("customGroups.noGroupsAvailable",{locale:n,gameMode:i})})}):o.map(p=>e.jsx(k,{value:p.name,children:e.jsxs(E,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx("span",{children:p.label}),p.isDefault&&e.jsx(ye,{label:t("default"),size:"small",variant:"outlined"})]})},p.id))})]})})}function Kt({groupName:s,value:a,onChange:n,locale:i,gameMode:r,disabled:h=!1}){const{t:u}=ee(),[t,o]=d.useState([]),[c,g]=d.useState(!1);d.useEffect(()=>{(async()=>{if(!s){o([]);return}g(!0);try{const w=await Tt(s,i,r);o(w)}catch(w){console.error("Error loading group intensities:",w),o([])}finally{g(!1)}})()},[s,i,r]);const l=d.useMemo(()=>t.sort((p,w)=>p.value-w.value),[t]);return d.useEffect(()=>{if(t.length>0&&a&&!t.some(p=>p.value===a)){const p=l[0];p&&n(p.value)}},[t,a,n,l]),s?c?e.jsxs(B,{fullWidth:!0,disabled:!0,children:[e.jsx(K,{children:u("customGroups.loadingIntensities")}),e.jsx(H,{value:"",children:e.jsx(k,{value:"",children:e.jsxs(E,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(De,{size:16}),e.jsx("span",{children:u("customGroups.loadingIntensities")})]})})})]}):t.length===0?e.jsxs(B,{fullWidth:!0,disabled:!0,children:[e.jsx(K,{children:u("intensity")}),e.jsx(H,{value:"",children:e.jsx(k,{value:"",disabled:!0,children:e.jsx(j,{color:"text.secondary",children:u("customGroups.noIntensitiesAvailable",{groupName:s})})})})]}):e.jsx(E,{children:e.jsxs(B,{fullWidth:!0,disabled:h,children:[e.jsx(K,{children:u("intensity")}),e.jsx(H,{value:a||"",onChange:p=>n(Number(p.target.value)),label:u("intensity"),children:l.map(p=>e.jsx(k,{value:p.value,children:p.label},p.id))})]})}):e.jsxs(B,{fullWidth:!0,disabled:!0,children:[e.jsx(K,{children:u("intensity")}),e.jsx(H,{value:"",children:e.jsx(k,{value:"",disabled:!0,children:e.jsx(j,{color:"text.secondary",children:u("customGroups.selectGroupFirst")})})})]})}const Oe=[{name:"Basic (1-4)",intensities:[{label:"intensityLabels.light",value:1,isDefault:!0},{label:"intensityLabels.medium",value:2,isDefault:!0},{label:"intensityLabels.intense",value:3,isDefault:!0},{label:"intensityLabels.extreme",value:4,isDefault:!0}]},{name:"Simple (1-3)",intensities:[{label:"intensityLabels.beginner",value:1,isDefault:!0},{label:"intensityLabels.intermediate",value:2,isDefault:!0},{label:"intensityLabels.advanced",value:3,isDefault:!0}]},{name:"Extended (1-5)",intensities:[{label:"intensityLabels.veryLight",value:1,isDefault:!0},{label:"intensityLabels.light",value:2,isDefault:!0},{label:"intensityLabels.medium",value:3,isDefault:!0},{label:"intensityLabels.intense",value:4,isDefault:!0},{label:"intensityLabels.veryIntense",value:5,isDefault:!0}]}];function Ht({open:s,onClose:a,onGroupCreated:n,onGroupUpdated:i,editingGroup:r,locale:h,gameMode:u}){const{t}=ee(),[o,c]=d.useState(0),[g,l]=d.useState([]),[p,w]=d.useState(!0),[L,S]=d.useState({}),_=Ft(),[N,V]=d.useState(""),[y,D]=d.useState(""),[m,T]=d.useState([t("intensityLabels.beginner"),t("intensityLabels.intermediate"),t("intensityLabels.advanced")]),[G,P]=d.useState(null),[C,O]=d.useState(!1),[x,b]=d.useState({isValid:!0,errors:[]}),[M,z]=d.useState(!1),[R,Y]=d.useState(null),J=d.useCallback(async()=>{try{const I=(await oe(h,u)).filter(q=>!q.isDefault);l(I);const $={};await Promise.all(I.map(async q=>{$[q.id]=await It(q.name,h,u)})),S($)}catch(f){console.error("Error reloading groups:",f)}},[h,u]);d.useEffect(()=>{(async()=>{if(s){w(!0);try{await J()}catch(I){console.error("Error loading groups:",I)}finally{w(!1)}}})()},[s,h,u,J]);const v=f=>f.toLowerCase().replace(/[^a-z0-9\s]/g,"").replace(/\s+/g,"_").substring(0,20)||`group_${ge(6).toLowerCase()}`;d.useEffect(()=>{r?(P(r),V(r.label),D(r.type||""),T(r.intensities.map(f=>f.label))):G?(V(G.label),D(G.type||""),T(G.intensities.map(f=>f.label))):(P(null),V(""),D(""),T([t("intensityLabels.beginner"),t("intensityLabels.intermediate"),t("intensityLabels.advanced")])),b({isValid:!0,errors:[]})},[r,G,s,t]);const A=f=>{const I=Oe[f];T(I.intensities.map($=>t($.label)))},F=(f,I)=>{const $=[...m];$[f]=I,T($)},X=()=>{m.length>=_.MAX_INTENSITIES_COUNT||T([...m,t("customGroups.levelLabel",{level:m.length+1})])},ne=f=>{if(m.length<=_.MIN_INTENSITIES_COUNT)return;const I=m.filter(($,q)=>q!==f);T(I)};d.useEffect(()=>{(async()=>{if(!N.trim()&&!y&&m.length===0){b({isValid:!0,errors:[]});return}const I=[];if(y&&!_.VALID_GROUP_TYPES.includes(y)&&I.push(`Type must be one of: ${_.VALID_GROUP_TYPES.join(", ")}`),N.trim()&&!y&&I.push("Type is required when creating a group"),I.length>0){b({isValid:!1,errors:I});return}const $=m.map((tt,st)=>({id:ge(),label:tt,value:st+1,isDefault:!1})),q={name:G?G.name:v(N),label:N.trim(),intensities:$,type:y||void 0,locale:h,gameMode:u,isDefault:!1},et=await Ze(q,G?.id);b(et)})()},[N,y,m,h,u,G,t,_.VALID_GROUP_TYPES]);const Q=f=>{P(f),V(f.label),T(f.intensities.map(I=>I.label)),c(1)},te=async f=>{const I=g.find(q=>q.id===f);if(!I)return;const $=L[f]||0;Y({id:f,name:I.label,tileCount:$}),z(!0)},W=async()=>{if(!R)return;const{id:f,tileCount:I}=R,$=g.find(q=>q.id===f);if($)try{I>0&&await Ct($.name,h,u),await Gt(f),await J(),i?.(null)}catch(q){console.error("Error deleting group:",q)}finally{z(!1),Y(null)}},re=async()=>{if(!(!x.isValid||C)){O(!0);try{const f=m.map(($,q)=>({id:ge(),label:$,value:q+1,isDefault:!1})),I={name:G?G.name:v(N),label:N.trim(),intensities:f,type:y||void 0,locale:h,gameMode:u,isDefault:!1};if(G)await ze(G.id,I),i?.(G);else{const $=await Be(I);$&&n?.({...I,id:$,createdAt:new Date,updatedAt:new Date,isDefault:!1,locale:h,gameMode:u})}le(),a()}catch(f){console.error("Error saving custom group:",f),b({isValid:!1,errors:[`Failed to save group: ${f}`]})}finally{O(!1)}}},le=()=>{P(null),V(""),D(""),T([t("intensityLabels.beginner"),t("intensityLabels.intermediate"),t("intensityLabels.advanced")]),b({isValid:!0,errors:[]})};return e.jsxs(e.Fragment,{children:[e.jsxs(be,{open:s,onClose:a,maxWidth:"md",fullWidth:!0,PaperProps:{sx:{minHeight:"600px"}},children:[e.jsxs(je,{children:[t("Manage Custom Groups"),e.jsx(j,{variant:"body2",color:"text.secondary",sx:{mt:1},children:t("Create new groups or manage existing custom groups")}),e.jsxs(nt,{value:o,onChange:(f,I)=>{c(I),I===1&&!G&&le()},sx:{mt:2,borderBottom:1,borderColor:"divider"},children:[e.jsx($e,{label:t("Existing Groups")}),e.jsx($e,{label:t(G?"Edit Group":"Create New")})]})]}),e.jsxs(ve,{dividers:!0,children:[o===0&&e.jsx(E,{children:p?e.jsx(j,{children:t("Loading groups...")}):g.length===0?e.jsx(j,{color:"text.secondary",sx:{textAlign:"center",py:4},children:t('No custom groups found. Create your first group using the "Create New" tab.')}):e.jsx(rt,{children:g.map((f,I)=>e.jsxs(ft.Fragment,{children:[e.jsxs(it,{children:[e.jsx(at,{primary:f.label,secondary:e.jsxs(E,{component:"span",sx:{display:"block"},children:[e.jsxs(j,{variant:"body2",color:"text.secondary",component:"span",sx:{display:"block"},children:[t("customGroups.intensityLevelsCount",{count:f.intensities.length}),": ",f.intensities.map($=>$.label).join(", ")]}),e.jsx(j,{variant:"body2",color:"text.secondary",component:"span",sx:{display:"block",mt:.5},children:t("customGroups.customTilesCount",{count:L[f.id]||0})})]})}),e.jsxs(ot,{children:[e.jsx(ie,{edge:"end","aria-label":"edit",onClick:()=>Q(f),sx:{mr:1},children:e.jsx(Re,{})}),e.jsx(ie,{edge:"end","aria-label":"delete",onClick:()=>te(f.id),color:"error",children:e.jsx(Te,{})})]})]}),I<g.length-1&&e.jsx(We,{})]},f.id))})}),o===1&&e.jsxs(E,{sx:{display:"flex",flexDirection:"column",gap:3},children:[!x.isValid&&e.jsx(Ue,{severity:"error",children:x.errors.map((f,I)=>e.jsx("div",{children:f},I))}),e.jsxs(E,{sx:{p:2,bgcolor:"background.paper",borderRadius:1,border:"1px solid",borderColor:"divider"},children:[e.jsx(j,{variant:"h6",sx:{mb:2},children:t("customGroups.groupInformation")}),e.jsx(se,{label:t("customGroups.groupLabel"),value:N,onChange:f=>V(f.target.value),placeholder:"e.g., My Custom Group",helperText:t("customGroups.groupLabelHelp",{maxLength:_.MAX_GROUP_LABEL_LENGTH}),fullWidth:!0,required:!0,error:N.trim().length>0&&!Qe(N).isValid,sx:{mb:2}}),e.jsxs(se,{select:!0,label:t("customGroups.groupType"),value:y,onChange:f=>D(f.target.value),helperText:t("customGroups.groupTypeHelp"),fullWidth:!0,required:!0,error:N.trim().length>0&&!y,sx:{mb:2},children:[e.jsx(k,{value:"",children:e.jsx("em",{children:t("groupTypes.selectType")})}),e.jsx(k,{value:"solo",children:t("groupTypes.solo")}),e.jsx(k,{value:"foreplay",children:t("groupTypes.foreplay")}),e.jsx(k,{value:"sex",children:t("groupTypes.sex")}),e.jsx(k,{value:"consumption",children:t("groupTypes.consumption")})]}),e.jsxs(E,{sx:{display:"flex",flexDirection:"column",gap:.5},children:[e.jsxs(j,{variant:"body2",color:"text.secondary",children:[e.jsx("strong",{children:t("customGroups.locale")})," ",h," |"," ",e.jsx("strong",{children:t("customGroups.gameMode")})," ",u]}),G?e.jsxs(j,{variant:"body2",color:"text.secondary",children:[e.jsx("strong",{children:t("customGroups.internalId")})," ",G.name," ","(locked)"]}):e.jsxs(j,{variant:"body2",color:"text.secondary",children:[e.jsx("strong",{children:t("customGroups.internalId")})," ",N?v(N):t("customGroups.autoGenerated")]})]})]}),e.jsxs(E,{sx:{display:"flex",alignItems:"center",gap:2,p:2,bgcolor:"action.hover",borderRadius:1},children:[e.jsx(j,{variant:"body2",sx:{fontWeight:"medium",minWidth:"auto"},children:t("customGroups.quickStart")}),e.jsx(se,{select:!0,value:0,onChange:f=>A(Number(f.target.value)),size:"small",sx:{minWidth:200},label:t("customGroups.chooseTemplate"),children:Oe.map((f,I)=>e.jsx(k,{value:I,children:f.name},I))}),e.jsx(j,{variant:"body2",color:"text.secondary",sx:{fontSize:"0.75rem"},children:t("customGroups.selectTemplateDescription")})]}),e.jsxs(E,{children:[e.jsxs(j,{variant:"h6",sx:{mb:2},children:[t("customGroups.intensityLabels")," (",m.length,"/",_.MAX_INTENSITIES_COUNT,")"]}),e.jsx(j,{variant:"body2",color:"text.secondary",sx:{mb:2},children:t("customGroups.customizeIntensityDescription")}),e.jsxs(E,{sx:{display:"flex",flexDirection:"column",gap:1.5},children:[m.map((f,I)=>e.jsxs(E,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(j,{variant:"body2",sx:{minWidth:"30px",fontWeight:"bold",color:"primary.main"},children:I+1}),e.jsx(se,{label:t("customGroups.levelInputLabel",{level:I+1}),value:f,onChange:$=>F(I,$.target.value),size:"small",sx:{flex:1},inputProps:{maxLength:_.MAX_INTENSITY_LABEL_LENGTH}}),e.jsx(ie,{onClick:()=>ne(I),disabled:m.length<=_.MIN_INTENSITIES_COUNT,color:"error",size:"small",children:e.jsx(Te,{})})]},I)),e.jsx(Z,{startIcon:e.jsx(lt,{}),onClick:X,disabled:m.length>=_.MAX_INTENSITIES_COUNT,variant:"outlined",size:"small",sx:{alignSelf:"flex-start",mt:1},children:t("customGroups.addIntensityLevel")})]})]})]})]}),e.jsxs(Me,{children:[e.jsx(Z,{onClick:a,disabled:C,children:t("Cancel")}),e.jsx(Z,{onClick:re,variant:"contained",disabled:!x.isValid||C,children:t(C?"customGroups.saving":G?"customGroups.updateGroup":"customGroups.createGroup")})]})]}),e.jsxs(be,{open:M,onClose:()=>z(!1),children:[e.jsx(je,{children:t("customGroups.confirmDelete")}),e.jsx(ve,{children:e.jsx(j,{children:(R?.tileCount??0)>0?t("customGroups.deleteGroupWithTiles",{name:R?.name,count:R?.tileCount}):t("customGroups.deleteGroupConfirm",{name:R?.name})})}),e.jsxs(Me,{children:[e.jsx(Z,{onClick:()=>z(!1),children:t("Cancel")}),e.jsx(Z,{onClick:W,color:"error",variant:"contained",children:t("Delete")})]})]})]})}function Xt({setSubmitMessage:s,boardUpdated:a,customTiles:n,mappedGroups:i,expanded:r,handleChange:h,tagList:u,updateTileId:t,setUpdateTileId:o}){const{t:c}=ee(),{settings:g}=_e(),[l,p]=d.useState({gameMode:g.gameMode||"online",group:"",intensity:"",action:"",tags:[c("custom")]}),[w,L]=d.useState(!1),[S,_]=d.useState(""),[N,V]=d.useState(0);d.useEffect(()=>{const b=setTimeout(async()=>{if(!l.group||!l.intensity||!l.action){_("");return}try{const M=await Ve({group:l.group,intensity:Number(l.intensity),action:l.action,tags:l.tags,gameMode:l.gameMode,isCustom:1},g.locale||"en",l.gameMode);M.isValid?_(""):_(M.errors.join(", "))}catch(M){console.error("Error validating tile:",M),_("")}},300);return()=>clearTimeout(b)},[l.group,l.intensity,l.action,l.gameMode,l.tags,g.locale]),d.useEffect(()=>{const b=(Array.isArray(n)?n:[]).find(({id:M})=>M===t);if(b){const M=b.gameMode||g.gameMode;p({gameMode:M,group:b.group||"",intensity:b.intensity||"",action:b.action||"",tags:b.tags||[c("custom")]})}else p(M=>({...M,gameMode:g.gameMode}))},[t,g.gameMode,n,c]);function y(x,b,M){return(Array.isArray(n)?n:[]).find(R=>R.group===x&&R.intensity===b&&R.action===M)}function D(){o(null),p({gameMode:g.gameMode,group:"",intensity:"",action:"",tags:[c("custom")]}),_("")}const m=x=>{p(b=>({...b,group:x.name,intensity:""})),L(!1),V(b=>b+1)},T=()=>{V(x=>x+1)},G=d.useCallback(x=>{p(b=>({...b,intensity:x.toString()}))},[]);async function P(){const x=document.querySelector('input[name="tags"]'),b=[...l.tags];x&&x.value.trim()&&(b.push(x.value.trim()),x.value="");const{gameMode:M,group:z,intensity:R,action:Y}=l;if(!M||!z||!R||!Y)return s({message:c("allFieldsRequired","All fields are required"),type:"error"});if(S)return s({message:S,type:"error"});if(t==null&&y(z,R,Y))return s({message:c("actionExists"),type:"error"});const J={group:z,intensity:Number(R),action:Y,tags:b,gameMode:M,isCustom:1};try{const v=await Ve(J,g.locale||"en",M);if(!v.isValid)return s({message:v.errors.join(", "),type:"error"});if(t===null){const A=`${z} - Level ${R}`;Xe(A,Y),await Ne(J)}else await He(t,J);return a(),p(A=>({...A,action:"",tags:[c("custom")]})),s({message:c(t?"customUpdated":"customAdded"),type:"success"})}catch(v){return console.error("Error saving custom tile:",v),s({message:c("Error saving tile"),type:"error"})}}const C=x=>{switch(x.key){case",":case"Enter":{x.preventDefault(),x.stopPropagation(),x.currentTarget.value.length>0&&(p(b=>({...b,tags:[...b.tags,x.currentTarget.value]})),x.currentTarget.value="");break}}},O=x=>{x.target.value.length>0&&(p(b=>({...b,tags:[...b.tags,x.target.value]})),x.target.value=""),setTimeout(()=>{const b=document.querySelector(".MuiAutocomplete-popper");b&&(b.style.display="none")},150)};return e.jsxs(e.Fragment,{children:[e.jsxs(ue,{expanded:r==="ctAdd",onChange:h("ctAdd"),children:[e.jsx(de,{"aria-controls":"ctAdd-content",id:"ctAdd-header",children:e.jsx(j,{children:e.jsx(U,{i18nKey:t?"ctUpdate":"ctAdd"})})}),e.jsx(me,{children:e.jsxs(E,{component:"form",method:"post",className:"settings-box",children:[e.jsxs(se,{select:!0,label:c("Game Mode"),value:l.gameMode,onChange:x=>{p(b=>({...b,gameMode:x.target.value,group:"",intensity:""}))},fullWidth:!0,sx:{mb:2},children:[e.jsx("option",{value:"online",children:"Online"}),e.jsx("option",{value:"local",children:"Local"}),e.jsx("option",{value:"solo",children:"Solo"})]}),e.jsx(Bt,{value:l.group,onChange:x=>{p(b=>({...b,group:x,intensity:""}))},locale:g.locale||"en",gameMode:l.gameMode,refreshTrigger:N}),e.jsx(E,{sx:{mt:2},children:e.jsx(Kt,{groupName:l.group,value:Number(l.intensity)||0,onChange:G,locale:g.locale||"en",gameMode:l.gameMode})}),S&&e.jsx(E,{sx:{mt:1,mb:2},children:e.jsx(j,{color:"error",variant:"body2",children:S})}),e.jsx(se,{id:"action",name:"action",required:!0,fullWidth:!0,label:c("action"),sx:{mt:2,pb:2},value:l.action,onChange:x=>{p({...l,action:x.target.value})}}),e.jsx(ct,{id:"tags",disableCloseOnSelect:!0,multiple:!0,freeSolo:!0,options:u,value:l.tags,onChange:(x,b)=>{p({...l,tags:b})},renderInput:x=>(x.inputProps.onKeyDown=C,x.inputProps.onBlur=O,e.jsx(se,{...x,label:c("tags")})),sx:{pb:2},clearOnBlur:!0,blurOnSelect:!0,openOnFocus:!0,disablePortal:!1,componentsProps:{popper:{modifiers:[{name:"preventOverflow",options:{altAxis:!0,altBoundary:!0,padding:8}}]}}}),e.jsxs(E,{display:"flex",justifyContent:"space-evenly",gap:1,children:[e.jsx(Z,{variant:"outlined",type:"button",onClick:()=>L(!0),children:c("Manage Groups")}),e.jsx(Z,{variant:"contained",type:"button",onClick:()=>D(),children:e.jsx(U,{i18nKey:"clear"})}),e.jsx(Z,{variant:"contained",type:"button",onClick:P,children:e.jsx(U,{i18nKey:t?"ctUpdate":"ctAdd"})})]})]})})]}),e.jsx(Ht,{open:w,onClose:()=>L(!1),onGroupCreated:m,onGroupUpdated:T,locale:g.locale||"en",gameMode:l.gameMode})]})}function Yt({expanded:s,handleChange:a}){return e.jsxs(e.Fragment,{children:[e.jsxs(ue,{expanded:s==="help1",onChange:a("help1"),children:[e.jsx(de,{"aria-controls":"help1-content",id:"help1-header",children:e.jsx(j,{children:e.jsx(U,{i18nKey:"ctExplained"})})}),e.jsx(me,{children:e.jsxs(U,{i18nKey:"ctExplainedDescription",children:[e.jsx(j,{sx:{mb:2},children:"Custom tiles let you add your own variations to the game board. Utilize this dialog to add and remove tiles as you see fit."}),e.jsx(j,{sx:{mb:2},children:"Custom tiles are added based on the kink and intensity you pick from the drop down. As such, you need to have that kink and intensity (or a higher intensity) selected for your custom tiles to show on the board."}),e.jsx(j,{children:"Miscellaneous tiles are the only exception to the above. Regardless of what other options you pick, Miscellaneous tiles will show as their own group. If you use this option, ensure that you add multiple tiles to minimize repeats."})]})})]}),e.jsxs(ue,{expanded:s==="help2",onChange:a("help2"),children:[e.jsx(de,{"aria-controls":"help2-content",id:"help2-header",children:e.jsx(j,{children:e.jsx(U,{i18nKey:"ctIdeas"})})}),e.jsx(me,{children:e.jsxs(U,{i18nKey:"ctIdeasDescription",children:[e.jsx(j,{variant:"h6",children:"Add new Activities"}),e.jsx(j,{variant:"subtitle2",sx:{mb:2},children:"Come up with new activities that are not part of the existing list"}),e.jsx(j,{variant:"h6",children:"Add harder tiles to easier intensities"}),e.jsx(j,{variant:"subtitle2",sx:{mb:1},children:"When you pick higher intensity levels, the game will use the earlier intensity level and gradual move to whatyou picked. If you want harder tiles early on, add several to lower intensities."}),e.jsx(j,{variant:"subtitle2",sx:{mb:2},children:"Example: You play Poppers - Advanced. Add advanced tiles to Poppers - Beginner"}),e.jsx(j,{variant:"h6",children:"Combine activities into a single tile"}),e.jsx(j,{variant:"subtitle2",sx:{mb:1},children:"Combine multiple activites together in a single tile that normally would not go together."}),e.jsx(j,{variant:"subtitle2",sx:{mb:2},children:"Example: Spit roast. Use a toy in your throat and ass at the same time."}),e.jsx(j,{variant:"h6",children:"Miscellaneous custom tiles"}),e.jsx(j,{variant:"subtitle2",sx:{mb:1},children:"Miscellaneous tiles allow you to add your own tiles without including other groups. Be aware, you will want to add several options to this group to minimize repeats."})]})})]})]})}function Jt({gameMode:s,groupFilter:a,intensityFilter:n,groups:i,mappedGroups:r,dexieGroups:h,onGameModeChange:u,onGroupChange:t,onIntensityChange:o,hideAll:c=!1,sx:g={}}){const{t:l}=ee(),[p,w]=d.useState([]),L=c?1:"all",S=d.useMemo(()=>{if(!r?.[s])return[];const m=Ye(r[s]);return Array.isArray(m)?m:[]},[r,s]),_=d.useCallback(m=>{if(h?.[m])return h[m].label||m;const T=S.find(G=>G.value===m);return T?.groupLabel?T.groupLabel:m},[h,S]),N=d.useCallback((m,T)=>{if(h?.[m]){const P=h[m].intensities.find(C=>C.value===Number(T));if(P?.label)return P.label}const G=S.find(P=>P.value===m&&P.intensity===Number(T));return G?.translatedIntensity?G.translatedIntensity:`Level ${Number(T)+1}`},[h,S]);d.useEffect(()=>{if(i){const m=Object.keys(i);w(m)}},[i,s]);function V(m){const T=m.target.value;t(T),o(L)}if(!p?.length)return null;const y=p.length===0||p.includes(a)?a:"",D=n==="all"?"all":n;return e.jsxs(E,{sx:{display:"flex",flexWrap:"wrap",gap:2,...g},children:[e.jsxs(B,{sx:{width:125,flexShrink:0},children:[e.jsx(K,{id:"game-mode-filter-label",children:e.jsx(U,{i18nKey:"customTiles.gameMode"})}),e.jsxs(H,{labelId:"game-mode-filter-label",id:"game-mode-filter",value:s,label:l("customTiles.gameMode","Game Mode"),onChange:m=>{u(m.target.value)},slotProps:{input:{"aria-label":l("customTiles.gameMode","Game Mode")}},children:[e.jsx(k,{value:"online",children:e.jsx(U,{i18nKey:"online"})}),e.jsx(k,{value:"local",children:e.jsx(U,{i18nKey:"local"})})]})]}),e.jsxs(B,{sx:{minWidth:150,flex:1},children:[e.jsx(K,{id:"group-filter-label",children:e.jsx(U,{i18nKey:"group"})}),e.jsx(H,{labelId:"group-filter-label",id:"group-filter",value:y,label:l("group"),onChange:V,slotProps:{input:{"aria-label":l("group")}},children:p.map(m=>e.jsxs(k,{value:m,children:[_(m),!c&&i[m]&&` (${i[m].count})`]},m))})]}),e.jsxs(B,{sx:{minWidth:200,flex:1},disabled:!y,children:[e.jsx(K,{id:"intensity-filter-label",children:e.jsx(U,{i18nKey:"customTiles.intensityLevel",children:"Intensity Level"})}),e.jsxs(H,{labelId:"intensity-filter-label",id:"intensity-filter",value:D,label:l("customTiles.intensityLevel","Intensity Level"),onChange:m=>o(m.target.value),slotProps:{input:{"aria-label":l("customTiles.intensityLevel","Intensity Level")}},children:[!c&&e.jsx(k,{value:"all",children:e.jsx(U,{i18nKey:"all",children:"All"})},"all"),y&&i&&i[y]&&Object.entries(i[y].intensities||{}).sort(([m],[T])=>Number(m)-Number(T)).map(([m,T])=>e.jsxs(k,{value:Number(m),children:[N(y,m),!c&&T!==void 0?` (${T})`:""]},m))]})]})]})}function Qt({tagList:s,boardUpdated:a,mappedGroups:n,updateTile:i,refreshTrigger:r}){const{t:h,i18n:u}=ee(),{settings:t}=_e(),[o,c]=d.useState(null),[g,l]=d.useState(t.gameMode||"online"),[p,w]=d.useState(""),[L,S]=d.useState(""),[_,N]=d.useState(1),[V,y]=d.useState(!0),[D,m]=d.useState({items:[],total:0,totalPages:1}),[T,G]=d.useState({}),[P,C]=d.useState({}),O=10;d.useEffect(()=>{async function v(){try{y(!0);const[A,F]=await Promise.all([oe(u.resolvedLanguage,g),wt(u.resolvedLanguage,g,o)]),X={};A.forEach(W=>{X[W.name]=W}),C(X);const ne={};A.forEach(W=>{const re=F[W.name]||{count:0,intensities:{}};ne[W.name]={label:W.label||W.name,count:re.count,intensities:re.intensities}}),G(ne);const Q=A.map(W=>W.name),te=Q.includes(p);if((!p||!te)&&Q.length>0)w(Q[0]),S("all");else if(te&&L!=="all"){const W=A.find(re=>re.name===p);W&&(W.intensities.map(le=>le.value).includes(Number(L))||S("all"))}}catch(A){console.error("Error loading groups and counts:",A)}finally{y(!1)}}v()},[g,u.resolvedLanguage,o,p,L]),d.useEffect(()=>{let v=!0;async function A(){try{y(!0);const F={group:p,intensity:L==="all"?null:Number(L),tag:o,gameMode:g,locale:t.locale,page:_,limit:O,paginated:!0},X=await ke(F);v&&(m(X),setTimeout(()=>{v&&y(!1)},300))}catch(F){console.error("Error loading tiles:",F),v&&y(!1)}}return p?A():y(!1),()=>{v=!1}},[p,L,o,g,_,O,r,t.locale]);function x(v){y(!0),c(o===v?null:v)}function b(v,A){y(!0),N(A)}async function M(v){await Et(v),a();const A={group:p,intensity:L==="all"?null:L,tag:o,gameMode:g,locale:t.locale,page:_,limit:O,paginated:!0},F=await ke(A);m(F)}async function z(v){await Lt(v),a(),m(A=>({...A,items:A.items.map(F=>F.id===v?{...F,isEnabled:!F.isEnabled}:F)}))}function R(v){i(v);const A=document.querySelector(".MuiDialogContent-root");A&&(A.scrollTop=0)}function Y(v,A){const F=P[v];if(F){const X=F.label||v,Q=F.intensities.find(te=>te.value===Number(A))?.label||`Level ${Number(A)+1}`;return`${X} - ${Q}`}return`${v} - Level ${Number(A)+1}`}const J=D.items?.map(({id:v,group:A,intensity:F,action:X,tags:ne,isEnabled:Q=!0,isCustom:te=!0})=>e.jsxs(ut,{sx:{my:2},children:[e.jsx(dt,{title:X,slotProps:{title:{variant:"body1"},subheader:{variant:"body2"},action:{"aria-label":h("customTiles.actions")}},subheader:Y(A,F),action:e.jsxs(e.Fragment,{children:[e.jsx(mt,{checked:!!Q,onChange:()=>v!==void 0&&z(v),slotProps:{input:{"aria-label":h("customTiles.toggleTile")}}}),!!te&&e.jsxs(e.Fragment,{children:[e.jsx(ie,{onClick:()=>v!==void 0&&R(v),"aria-label":h("customTiles.update"),children:e.jsx(Re,{})}),e.jsx(ie,{onClick:()=>v!==void 0&&M(v),"aria-label":h("customTiles.delete"),children:e.jsx(Te,{})})]})]}),sx:{pb:0}}),e.jsx(pt,{children:ne?.map(W=>e.jsx(ye,{label:W,sx:{m:.5}},W))})]},v));return e.jsxs(E,{children:[e.jsx(E,{children:s?.map(v=>e.jsx(ye,{label:v,sx:{m:.5},color:o===v?"primary":"default",onClick:()=>x(v)},v))}),e.jsx(E,{sx:{display:"flex",flexDirection:"column",gap:2,my:2,transition:"all 0.3s ease-in-out"},children:e.jsx(Jt,{gameMode:g,groupFilter:p,intensityFilter:L,groups:T,mappedGroups:n,dexieGroups:P,onGameModeChange:v=>{l(v),w(""),S(""),N(1)},onGroupChange:v=>{w(v),N(1)},onIntensityChange:v=>{S(v),N(1)}})}),e.jsxs(E,{sx:{position:"relative",minHeight:"200px"},children:[e.jsx(ht,{in:V,timeout:300,children:e.jsx(E,{sx:{position:"absolute",top:0,left:0,right:0,bottom:0,display:"flex",justifyContent:"center",alignItems:"center",backgroundColor:"rgba(255, 255, 255, 0)",zIndex:1,borderRadius:1},children:e.jsx(De,{})})}),e.jsx(E,{sx:{opacity:V?.3:1,transition:"opacity 0.3s ease-in-out",pointerEvents:V?"none":"auto"},children:D.items.length===0?e.jsx(j,{variant:"body1",sx:{textAlign:"center",my:4},children:e.jsx(U,{i18nKey:"customTiles.noTilesFound",children:"No tiles found with the selected filters."})}):e.jsxs(e.Fragment,{children:[J,D.totalPages>1&&e.jsx(E,{sx:{display:"flex",justifyContent:"center",mt:3,mb:2},children:e.jsx(gt,{count:D.totalPages,page:_,onChange:b,color:"primary"})}),e.jsx(j,{variant:"body2",sx:{textAlign:"center",mt:2,color:"text.secondary"},children:e.jsxs(U,{i18nKey:"customTiles.showingTiles",values:{shown:D.items.length,total:D.total},children:["Showing ",{shown:D.items.length}," of ",{total:D.total}," tiles"]})})]})})]})]})}function ds({boardUpdated:s,setOpen:a,open:n=!1}){const{t:i,i18n:r}=ee(),h=Pe(),u=Pe("md"),[t,o]=d.useState({message:"",type:"info"}),[c,g]=d.useState("ctAdd"),[l,p]=d.useState(null),[w,L]=d.useState(0),[S,_]=d.useState({online:{},local:{},solo:{}}),[N,V]=d.useState(!0),y=d.useCallback(()=>{L(C=>C+1)},[]),D=C=>(O,x)=>{g(x?C:"")};d.useEffect(()=>{async function C(){V(!0);try{const[O,x,b]=await Promise.all([xe(r.resolvedLanguage,"online"),xe(r.resolvedLanguage,"local"),xe(r.resolvedLanguage,"solo")]);_({online:O,local:x,solo:b})}catch(O){console.error("Error loading game mode actions:",O)}finally{V(!1)}}C()},[r.resolvedLanguage]);const m=bt(()=>pe({locale:r.resolvedLanguage})),T=d.useMemo(()=>m?Array.isArray(m)?m.map(({tags:C})=>C).flat().filter((C,O,x)=>C&&x.indexOf(C)===O).sort():[]:[],[m]),G=d.useCallback(async C=>{await At(C),s(),y()},[s,y]);if(!m||N)return null;const P=()=>{const C=e.jsxs(e.Fragment,{children:[e.jsx(Yt,{expanded:c,handleChange:D}),e.jsx(Xt,{setSubmitMessage:o,boardUpdated:()=>{s(),y()},customTiles:m,mappedGroups:S,expanded:c,handleChange:D,tagList:T,updateTileId:l,setUpdateTileId:p}),e.jsx(zt,{expanded:c,handleChange:D,customTiles:m,mappedGroups:S,setSubmitMessage:o,bulkImport:G})]}),O=Array.isArray(m)&&m.length>0&&e.jsx(E,{children:e.jsx(Qt,{tagList:T,boardUpdated:()=>{s(),y()},mappedGroups:S,updateTile:x=>{p(x),g("ctAdd")},refreshTrigger:w})});return u?e.jsxs(e.Fragment,{children:[C,O&&e.jsxs(e.Fragment,{children:[e.jsx(We,{sx:{my:2}}),O]})]}):e.jsxs(he,{container:!0,spacing:2,children:[e.jsx(he,{size:{xs:12,md:6},children:C}),e.jsx(he,{size:{xs:12,md:6},children:O})]})};return e.jsxs(e.Fragment,{children:[e.jsxs(be,{fullScreen:h,open:n,onClose:()=>a(!1),maxWidth:u?"sm":"lg",fullWidth:!0,children:[e.jsxs(je,{children:[e.jsx(U,{i18nKey:"manageTiles"}),e.jsx(ie,{"aria-label":i("close"),onClick:()=>a(!1),sx:{position:"absolute",right:8,top:8,color:C=>C.palette.grey[500]},children:e.jsx(xt,{})})]}),e.jsx(ve,{children:P()})]}),e.jsx(Nt,{open:!!t.message,close:()=>o({message:"",type:"info"}),type:t.type,children:t.message})]})}function ms(s={},a={}){const[n]=$t(),i={...s,...n,selectedActions:n?.selectedActions||{},...a},[r,h]=d.useState(i),{messages:u}=Mt(),[t,o]=d.useState(!1);return d.useEffect(()=>{const c=St(u,"room");if(c?.settings)try{const g=JSON.parse(c.settings);h(l=>t?l.selectedActions&&Object.keys(l.selectedActions).length>0?{...l,...g,selectedActions:l.selectedActions}:{...l,...g}:(o(!0),{...l,...g}))}catch(g){console.error("Error parsing message settings:",g)}else t||o(!0)},[u,t]),[r,h]}const fe=new Map,Fe=Dt;function ps(s){const{i18n:a}=ee(),[n,i]=d.useState({}),[r,h]=d.useState(!0),u=d.useMemo(()=>!s||!a.resolvedLanguage?"":`${a.resolvedLanguage}-${s}`,[a.resolvedLanguage,s]);d.useEffect(()=>{if(u){const o=fe.get(u);o&&Date.now()-o.timestamp<Fe&&(i(o.data),h(!1))}},[u]);const t=d.useCallback(async()=>{if(!s||!u)return;const o=fe.get(u);if(o&&Date.now()-o.timestamp<Fe){i(o.data),h(!1);return}h(!0);try{const c=await oe(a.resolvedLanguage,s),g={};for(const l of c){const p={[qe]:[]};l.intensities&&Array.isArray(l.intensities)&&l.intensities.sort((L,S)=>L.value-S.value).forEach(L=>{p[L.label]=[]});const w=l.type||"action";g[l.name]={label:l.label||l.name,type:w,actions:p}}fe.set(u,{data:g,timestamp:Date.now()}),i(g)}catch(c){console.error("Error loading unified actions:",c),i({})}finally{h(!1)}},[s,a.resolvedLanguage,u]);return d.useEffect(()=>{u&&t()},[t,u]),{actionsList:n,isLoading:r}}export{ds as C,ps as a,Ye as b,Ft as g,xe as i,ms as u};
