import{r as s,ad as P,au as k,j as e,am as f,ao as v,T as l,Q as U,ar as q,a1 as z}from"./chunk-DX6P0x0s.js";import{p as O,u as K,R}from"./chunk-C6Fv30pN.js";import{T as D}from"./chunk-DDpUFVAP.js";import{g as G}from"./chunk-B37hsyTU.js";import{l as B}from"./chunk-y_Mwc0dd.js";import{l as J}from"./chunk-CwsWjbbg.js";import{b as Q}from"./chunk-ClG1-VUV.js";import"./chunk-kXcKns83.js";import"./chunk-B4PEA_xj.js";import"./chunk-EL58PX5i.js";import"./chunk-CE037ghn.js";import"./chunk-Bh2yXkU5.js";import"./chunk-BdolcKhc.js";import"../assets/index-Di_HvON-.js";import"./chunk-DLb-D4CO.js";function Y(){const[n,u]=s.useState(document.fullscreenElement!=null);s.useEffect(()=>{const t=()=>{u(document.fullscreenElement!=null)};return document.addEventListener("fullscreenchange",t),()=>{document.removeEventListener("fullscreenchange",t)}},[]);const c=s.useCallback(()=>{document.fullscreenElement==null?document.documentElement.requestFullscreen().catch(t=>{console.error("Error attempting to enable fullscreen:",t)}):document.exitFullscreen().catch(t=>{console.error("Error attempting to exit fullscreen:",t)})},[]);return{isFullscreen:n,toggleFullscreen:c}}function _(n){const u=B(n,"room");let c=!1,t="";if(u){const{roomBackgroundURL:m}=JSON.parse(u.settings),d=O(m);d?.isVideo&&(c=d.isVideo),d?.url&&(t=d.url)}return["color","gray"].some(m=>t.includes(m))&&(t=""),{isVideo:c,url:t}}const H="actions",W=n=>{const{text:u,displayName:c}=n;if(!c)return{};const t=u?.split(`
`),[m,d]=t?.slice(1)||[],b=m?.split(":")[1]?.trim(),x=d?.split(":")[1]?.trim();return{displayName:c,type:b,activity:x}};function fe(){const{id:n}=P(),[u,c]=s.useState(""),[t,m]=s.useState(!1),[d,b]=s.useState(!1),[x,I]=s.useState(!1),{messages:p,isLoading:C}=Q(),{isVideo:g,url:a}=_(p),E=B(p,H),A=K(E),{isFullscreen:F,toggleFullscreen:$}=Y();s.useEffect(()=>{G().currentUser||J("Cast Viewer").catch(i=>{console.error("Anonymous login failed:",i)})},[n]),s.useEffect(()=>{if(!g||!a)return;const o=()=>{const j=document.querySelectorAll("video"),N=document.querySelectorAll("iframe");j.forEach(r=>{r.paused&&(r.muted=!0,r.play().catch(h=>{console.log("Video autoplay attempt failed:",h),I(!0)}))}),N.forEach(r=>{if(r.src)try{const h=new URL(r.src,window.location.origin),y=h.searchParams;let T=!1;y.get("autoplay")!=="1"&&(y.set("autoplay","1"),T=!0),y.get("mute")!=="1"&&(y.set("mute","1"),T=!0),T&&(h.search=y.toString(),r.src=h.toString())}catch{if(!r.src.includes("autoplay=1")){const h=r.src.includes("?")?"&":"?";r.src+=`${h}autoplay=1&mute=1`}}})},i=setTimeout(o,500),S=setTimeout(o,2e3);return()=>{clearTimeout(i),clearTimeout(S)}},[g,a,p.length]),s.useEffect(()=>{const o=window.cast?.framework?.CastReceiverContext,i=navigator.userAgent,S=i.includes("CrKey")||i.includes("TV"),j=window.self!==window.top,N=o||S||window.location.search.includes("chromecast")||window.location.search.includes("receiver");return N&&(document.body.classList.add("cast-receiver-mode"),document.body.classList.remove("theme-light"),b(!0)),j&&document.body.classList.add("in-iframe"),()=>{N&&document.body.classList.remove("cast-receiver-mode"),j&&document.body.classList.remove("in-iframe")}},[]),s.useEffect(()=>{if(C)return;const o=p[p.length-1];o?.type==="settings"&&(m(!0),c(`${o.displayName} ${k("changedSettings")}`))},[p,C]);const L=()=>{document.querySelectorAll("video").forEach(i=>{i.paused&&i.play().catch(console.error)}),I(!1)};if(!E)return e.jsxs(f,{className:"flex-column cast-main-container",style:{backgroundImage:!g&&a?`url(${a})`:"none"},children:[!!a&&e.jsx(R,{url:a,isVideo:g}),x&&e.jsx(f,{onClick:L,className:"user-interaction-overlay",children:"Click to enable autoplay"}),e.jsx(v,{container:!0,spacing:0,direction:"column",alignItems:"center",justifyContent:"center",className:"cast-container cast-grid-container",children:e.jsx(v,{container:!0,justifyContent:"center",children:e.jsxs("div",{className:"action-box-large responsive-cast-box",children:[e.jsxs(l,{variant:"h2",className:"cast-title",children:["blitzedout.com/",n]}),C?e.jsx(l,{variant:"h4",className:"cast-loading-text",children:"Connecting to game..."}):e.jsx(l,{variant:"h4",className:"cast-ready-text",children:"Ready for game to start"})]})})})]});const{displayName:V,type:M,activity:w}=W(E);return e.jsxs(f,{className:"flex-column cast-main-container",onClick:x?L:void 0,style:{backgroundImage:!g&&a?`url(${a})`:"none",cursor:x?"pointer":"default"},children:[!!a&&e.jsx(R,{url:a,isVideo:g}),e.jsxs(f,{display:"flex",justifyContent:"space-between",className:"cast-header-bar",children:[e.jsx(f,{flex:"1",children:!d&&!F&&e.jsx(U,{variant:"text",onClick:$,className:"cast-fullscreen-button",children:k("fullscreen")})}),e.jsx(f,{textAlign:"center",flex:"1",children:!!A?.displayName&&e.jsx(l,{variant:"h4",className:"cast-next-player",children:e.jsx(q,{i18nKey:"nextPlayersTurn",values:{player:A.displayName}})})},A?.displayName),e.jsx(f,{flex:"1",textAlign:"right",className:"text-stroke",children:w&&e.jsxs(l,{variant:"h4",className:"cast-room-url",children:["blitzedout.com/",n]})})]}),e.jsx(v,{container:!0,spacing:0,direction:"column",alignItems:"center",justifyContent:"center",className:"cast-container cast-grid-container-adjusted",children:e.jsx(v,{container:!0,justifyContent:"center",children:w?e.jsxs(v,{size:12,className:"action-box-responsive responsive-cast-box",children:[e.jsx(l,{variant:"h3",className:"cast-type-text",children:`${M} ${k("for")} ${V}`}),e.jsx(f,{className:"cast-divider",children:e.jsx(z,{})}),e.jsx(l,{variant:"h1",className:"cast-activity-text",children:w})]}):e.jsx("div",{className:"action-box-responsive responsive-cast-box",children:e.jsxs(l,{variant:"h1",className:"cast-room-main",children:["blitzedout.com/",n]})})})},p.length),e.jsx(D,{open:!!t,close:()=>m(!1),hideCloseButton:!0,children:e.jsx(l,{variant:"h5",className:"cast-alert-text",children:u})})]})}export{fe as default};
