import{i as b}from"./chunk-Bbs4woUe.js";import{g as v}from"./chunk-B4PEA_xj.js";import{l as h}from"./chunk-yLOK5aTh.js";import{r as g,j as p,am as x}from"./chunk-BCLv-HyH.js";import{u as w}from"./chunk-XpVQE2X7.js";import{c as k}from"./chunk-C5tDN2aE.js";function I(e){const t=/vimeo\.com\/(\d+)/,o=e.match(t);return`https://player.vimeo.com/video/${o?o[1]:""}?autoplay=1&loop=1&autostart=true`}function $(e){const t=/(?:youtube\.com\/(?:[^/]+\/.+\/|(?:v|e(?:mbed)?)\/|[^#]*[?&]v=|youtu\.be\/)([^"&?/ ]{11})|^(?:[^"&?/ ]{11})$)/,o=e.match(t);return`https://www.youtube.com/embed/${o?o[1]:""}?autoplay=1&loop=1&autostart=true&mute=1&playsinline=1&controls=0&disablekb=1&fs=0&modestbranding=1&rel=0&iv_load_policy=3`}function R(e){const t=/drive\.google\.com\/file\/d\/([^/]+)/,o=e.match(t);return`https://drive.google.com/file/d/${o?o[1]:""}/preview?loop=1`}function U(e){const t=/dropbox\.com\/s\/([^/]+)/,o=e.match(t);return`https://www.dropbox.com/s/${o?o[1]:""}?raw=1`}function B(e){return`https://pornhub.com/embed/${new URL(e).searchParams.get("viewkey")||""}?autoplay=1&loop=1&autostart=true`}function j(e){const t=e.split("-");return`https://xhamster.com/xembed.php?video=${t[t.length-1]}?autoplay=1&loop=1&autostart=true`}function A(e){const t=/media\.tenor\.com\/([a-zA-Z0-9_-]+)\/[^/]*\.(mp4|gif|webp)/;if(e.match(t))return e;const n=/tenor\.com\/view\/[^/]*-(\d+)/,c=e.match(n);return`https://tenor.com/embed/${c?c[1]:""}?autoplay=1`}function L(e){const t=/giphy\.com\/gifs\/[^/]*-([a-zA-Z0-9]+)/,o=e.match(t);return`https://media.giphy.com/media/${o?o[1]:""}/giphy.gif`}function M(e){const t=/(?:gfycat\.com|redgifs\.com)\/(?:watch\/)?([a-zA-Z0-9]+)/,o=e.match(t),n=o?o[1]:"";return e.includes("redgifs.com")?`https://files.redgifs.com/${n}.mp4`:`https://giant.gfycat.com/${n}.mp4`}function P(e){const t=/redtube\.com\/(\d+)/,o=e.match(t);return`https://embed.redtube.com/?id=${o?o[1]:""}&autoplay=1`}function z(e){const t=/youporn\.com\/watch\/(\d+)/,o=e.match(t);return`https://www.youporn.com/embed/${o?o[1]:""}?autoplay=1`}function N(e){const t=/tube8\.com\/[^/]+\/[^/]+\/(\d+)/,o=e.match(t);return`https://www.tube8.com/embed/${o?o[1]:""}?autoplay=1`}function F(e){if(e.includes("/embed/")||e.includes("/player/"))return e;const t=/thisvid\.com\/videos\/(?:[^/]*-)?(\d+)/,o=e.match(t),n=o?o[1]:"";return n?`https://thisvid.com/embed/${n}`:e}function S(e){if(e.includes("/embed/")||e.includes("/player/"))return e;const t=/boyfriendtv\.com\/videos\/(?:[^/]*-)?(\d+)/,o=e.match(t),n=o?o[1]:"";return n?`https://boyfriendtv.com/embed/${n}`:e}function Z(e){try{const c=new URL(e);if((c.host==="discordapp.net"||c.host.endsWith(".discordapp.net"))&&c.pathname.startsWith("/external/")&&(c.pathname.includes("/https/i.imgur.com/")||c.pathname.includes("/https/imgur.com/")))return e}catch(c){h.debug("URL parsing failed for Discord proxy check:",c)}let t="",o=!1;try{const c=new URL(e);o=c.host==="imgur.com"||c.host==="i.imgur.com"}catch(c){return h.debug("URL parsing failed for Imgur processing:",c),""}if(!o)return"";if(e.includes("/gallery/")){const c=e.match(/imgur\.com\/gallery\/[^#]*#([a-zA-Z0-9]+)/);if(c)t=c[1];else{const s=e.match(/#([a-zA-Z0-9]+)/);s&&(t=s[1])}}else{const c=/imgur\.com\/([a-zA-Z0-9]+)(?:\.(mp4|jpg|jpeg|png|gif|webp))?|images-ext-\d+\.discordapp\.net\/external\/[^/]+\/https\/i\.imgur\.com\/([a-zA-Z0-9]+)\.(mp4|jpg|jpeg|png|gif|webp)/,s=e.match(c);t=s?s[1]||s[3]:""}return`https://i.imgur.com/${t}.mp4`}function y(e){return/\.(mp4|webm|ogg|mov)(\?.*)?$/.test(e)}function E(e){return l(e,["media.discordapp.net","cdn.discordapp.com"])&&!y(e)}function l(e,t){try{const o=new URL(e);return t.some(n=>o.host===n||o.host.endsWith("."+n))}catch(o){return h.debug("URL parsing failed in urlContainsAny, using fallback:",o),t.some(n=>e.includes(n))}}function C(e){let t=null,o=!0;if(!e)return{url:"",isVideo:!1};switch(!0){case e.includes("vimeo.com"):t=I(e);break;case l(e,["youtube.com","youtu.be"]):t=$(e);break;case e.includes("drive.google.com"):t=R(e);break;case e.includes("pornhub.com"):t=B(e);break;case e.includes("xhamster.com"):t=j(e);break;case e.includes("dropbox.com"):t=U(e);break;case l(e,["imgur.com","i.imgur.com"]):t=Z(e);break;case l(e,["tenor.com","media.tenor.com"]):t=A(e),o=!0;break;case e.includes("giphy.com"):t=L(e),o=!0;break;case l(e,["gfycat.com","redgifs.com"]):t=M(e),o=!0;break;case e.includes("redtube.com"):t=P(e);break;case e.includes("youporn.com"):t=z(e);break;case e.includes("tube8.com"):t=N(e);break;case l(e,["twitter.com","x.com"]):t=e,o=!1;break;case e.includes("thisvid.com"):t=F(e);break;case e.includes("boyfriendtv.com"):t=S(e);break;case E(e):t=e,o=!1;break;case y(e):t=e;break;default:t=v(e),o=!1;break}return{url:t,isVideo:o}}function q(e,t){const{background:o,backgroundURL:n,roomBackground:c,roomBackgroundURL:s}=e,a=(d,m)=>{if(!d)return null;if(d==="custom")return m?s||null:n||null;if(d==="useAppBackground"){const i=o||"color";return i==="useRoomBackground"?"color":i==="custom"?n||null:i}if(d==="useRoomBackground"){if(b(t))return"color";const i=c||"useAppBackground";return i==="useAppBackground"?"color":i==="custom"?s||null:i}return d};let r=null;return!b(t)&&c&&c!=="useAppBackground"?r=a(c,!0):o?r=a(o,!1):r="color",r?r==="color"||r==="gray"?{url:r,isVideo:!1}:C(r):{url:null,isVideo:!1}}function D(e){return{uid:e.uid,displayName:e.displayName,isSelf:e.isSelf,isFinished:e.isFinished}}function G(e){const[t,o]=g.useState(null),n=w(),c=g.useMemo(()=>n.map(a=>`${a.uid}-${a.displayName}-${a.isFinished}-${a.isSelf}`).join("|"),[n]),s=g.useMemo(()=>e?`${e.uid}-${e.displayName||""}`:null,[e]);return g.useEffect(()=>{if(!e){o(null);return}if(n.length<=1){o(null);return}const a=n.filter(i=>!i.isFinished);if(a.length<=1){o(null);return}let r=-1;r=a.findIndex(i=>i.uid===e.uid),r===-1&&(r=a.findIndex(i=>i.displayName===e.displayName)),r===-1&&(r=0);const u=(r+1)%a.length,d=a[u],m=D(d);o(m)},[s,c]),t}function H({url:e}){const[t,o]=g.useState("video"),[n,c]=g.useState(e);if(g.useEffect(()=>{c(e),o("video")},[e]),!e)return null;const s=()=>{let r=!1;try{const m=new URL(e);r=m.host==="imgur.com"||m.host==="i.imgur.com"}catch{r=!1}if(r){const m=e.match(/imgur\.com\/([a-zA-Z0-9]+)/)?.[1];if(m){const i=`https://i.imgur.com/${m}.jpg`;c(i),o("image");return}}const d=`${e.replace(/\.(mp4|webm|ogg|mov)(\?.*)?$/i,"")}.jpg`;c(d),o("image")},a=()=>{let r=!1;try{const u=new URL(e);r=u.host==="imgur.com"||u.host==="i.imgur.com"}catch{r=!1}if(r){const u=e.match(/imgur\.com\/([a-zA-Z0-9]+)/)?.[1];if(u){const d=["png","gif","jpeg","webp"],m=n?.split(".").pop(),i=d.find(f=>f!==m);if(i){const f=`https://i.imgur.com/${u}.${i}`;c(f)}}}else{const u=["png","gif","jpeg","webp"],d=n?.split(".").pop(),m=u.find(i=>i!==d);if(m&&n){const f=`${n.replace(/\.[^.]+(\?.*)?$/,"")}.${m}`;c(f)}}};return t==="video"?p.jsx("video",{autoPlay:!0,loop:!0,muted:!0,playsInline:!0,src:n||void 0,className:"video-background",onError:s,preload:"auto",crossOrigin:"anonymous",controls:!1}):p.jsxs(p.Fragment,{children:[p.jsx("div",{className:"image-background",style:{backgroundImage:`url(${n})`,backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat",width:"100%",height:"100%",position:"absolute",top:0,left:0}}),p.jsx("img",{src:n||void 0,onError:a,style:{display:"none"},alt:""})]})}function J({url:e=null,isVideo:t=null}){const o=typeof window<"u"&&(window.location.search.includes("receiver=true")||window.location.search.includes("chromecast=true")||navigator.userAgent.includes("CrKey")||navigator.userAgent.includes("TV")),n=e&&/\.(mp4|webm|ogg|mov|gif)(\?.*)?$/i.test(e),c=e==="color"||e==="gray"||e?.includes("/color")||e?.includes("/gray"),s=e&&!c&&(t||!t&&e);return p.jsx(x,{className:k("main-container",!s&&"default-background"),role:"presentation",sx:{backgroundImage:!t&&e&&!c?`url(${e})`:"none"},children:t&&(n||o?p.jsx(H,{url:e}):p.jsx("iframe",{width:"100%",height:"100%",src:e||void 0,title:"video",allow:"autoplay; fullscreen; encrypted-media; picture-in-picture",sandbox:"allow-same-origin allow-scripts allow-presentation",style:{border:0}}))})}export{J as R,q as g,C as p,G as u};
