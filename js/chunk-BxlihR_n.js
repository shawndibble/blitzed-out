var Le=Object.defineProperty;var Me=(t,n,o)=>n in t?Le(t,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[n]=o;var G=(t,n,o)=>Me(t,typeof n!="symbol"?n+"":n,o);import{i as je,a as _e,b as he,g as y,r as B,o as ge,c as F,d as A,s as Ue,u as Ve,e as S,f as ye,h as Se,G as $e,j as ke,k as Be,l as K,q as U,w as V,m as xe,n as He,E as qe,p as Ne,t as Fe,v as Qe,x as We,T as ze,y as q,z as N,A as Ee,B as Te,C as ne,D as Y,F as se,H as Ge,I as we}from"./chunk-Tjtm3Awc.js";import{s as Ye,D as Je,p as ve,d as Ke}from"./chunk-lKy0gUf9.js";import{p as Ze,o as Xe,l as et,a as tt,n as J,_ as c,i as ot,b as nt}from"./chunk-DeAq10ee.js";import{e as Q}from"./chunk-Br5bPOQU.js";import{i as M,t as st}from"./chunk-Dk7I1tJi.js";import{l as rt}from"./chunk-COViFSNc.js";const at={apiKey:"AIzaSyCKS7tWQRYRWHsawNfN42uAmISdUbJHJJw",authDomain:"blitzout-49b39.firebaseapp.com",projectId:"blitzout-49b39",storageBucket:"blitzout-49b39.appspot.com",messagingSenderId:"852428606926",appId:"1:852428606926:web:17444e6f8dbc2f95f0ef9f",measurementId:"G-93YN1YMTQ7"},it=je(at),w=_e(it);async function vo(t=""){try{const n=y();return await We(n),n.currentUser?(await K(n.currentUser,{displayName:t}),n.currentUser):null}catch(n){return console.error(n),null}}async function bo(t,n,o=""){try{const s=y(),e=await Be(s,t,n);return await K(e.user,{displayName:o}),e.user}catch(s){throw console.error("Registration error:",s),s}}async function Ao(t,n){try{const o=y();return(await Se(o,t,n)).user}catch(o){throw console.error("Email login error:",o),o}}async function Do(){try{const t=y(),n=new $e;return(await ke(t,n)).user}catch(t){throw console.error("Google login error:",t),t}}async function Po(t){try{const n=y();return await Qe(n,t),!0}catch(n){throw console.error("Password reset error:",n),n}}async function Io(t,n){try{const s=y().currentUser;if(s?.isAnonymous){const e=qe.credential(t,n);return(await Ne(s,e)).user}else throw new Error("User is not anonymous or not logged in")}catch(o){throw console.error("Account conversion error:",o),o}}async function Co(){try{const t=y();return await Fe(t),!0}catch(t){throw console.error(t),t}}function Ro({newRoom:t,oldRoom:n,newDisplayName:o,oldDisplayName:s,removeOnDisconnect:e=!0}){const r=he(),i=y().currentUser?.uid,l=t?.toUpperCase(),d=n?.toUpperCase(),u=B(r,`rooms/${l}/uids/${i}`),m=B(r,`rooms/${d}/uids/${i}`),f=B(r,".info/connected");let p,_;ge(f,h=>{h.val()===!0&&(p=ne(u),_=ne(m),(d!==l||s!==o)&&Y(m),e&&(se(_).remove(),se(p).remove()),Ge(p,{displayName:o,lastActive:Date.now()}))}),document.addEventListener("beforeunload",()=>{_&&Y(_),p&&Y(p)})}function Oo(t,n,o={},s={}){if(!t)return;const{enableCache:e=!0,enableDebounce:r=!0}=s,a=t.toUpperCase(),i=X("userList",a),l=Date.now();if(e){const u=g.get(i);if(u&&ee(u,i)){u.queryCount++,g.set(i,u),E(i,Date.now()-l,!0);const m=Object.keys(u.data).sort().join(","),f=o?Object.keys(o).sort().join(","):"";m!==f&&n(u.data);return}}const d=async()=>{let u=!1;try{await W();const m=he(),f=B(m,`rooms/${a}/uids`);ge(f,p=>{const _=Date.now(),h=_-l,T=p.val();if(!T)return;if(e){Z();const P=$(i);g.set(i,{data:T,timestamp:_,queryCount:1,priority:P})}E(i,h,!1,u);const C=Object.keys(T).sort().join(","),v=o?Object.keys(o).sort().join(","):"";C!==v&&n(T)},p=>{u=!0,console.error("getUserList error:",p),E(i,Date.now()-l,!1,!0)})}catch(m){u=!0,console.error("getUserList connection error:",m),E(i,Date.now()-l,!1,!0)}finally{z()}};r?te(i,d):d()}async function Lo(t=""){try{const n=y();return n.currentUser?(await K(n.currentUser,{displayName:t}),n.currentUser):null}catch(n){return console.error(n),null}}async function Mo(t,n){try{await F(A(w,"custom-actions"),{grouping:t,customAction:n,ttl:new Date(Date.now()+5760*60*1e3)})}catch(o){console.error(o)}}async function ct(t){const n=U(A(w,"game-boards"),V("checksum","==",t)),o=await xe(n);return o.size?o.docs[0]:null}async function lt({title:t,gameBoard:n,settings:o}){if(t)try{const s=Ye.sha256(n),e=await ct(s);return e?(Ve(e.ref,{ttl:new Date(Date.now()+720*60*60*1e3)}),e):await ut({title:t,gameBoard:n,settings:o,checksum:s})}catch(s){console.error(s)}}async function ut({title:t,gameBoard:n,settings:o,checksum:s}){try{return await F(A(w,"game-boards"),{title:t,gameBoard:n,settings:o,checksum:s,ttl:new Date(Date.now()+720*60*60*1e3)})}catch(e){console.error(e);return}}async function jo(t){try{const n=S(w,"game-boards",t),o=await ye(n);return o.exists()?o.data():void 0}catch(n){console.error(n);return}}let re={};const g=new Map,O=new Map,ae=15e3,dt=5e3,ie=150,mt=50,be=50,ft=100,I={activeConnections:0,maxConnections:15,connectionQueue:[]},ce=new Map;function E(t,n,o,s=!1){const e=ce.get(t)||{queryCount:0,totalLatency:0,cacheHits:0,lastQueryTime:0,avgLatency:0,p95Latency:0,connectionPoolHits:0,networkErrors:0,latencyHistory:[]};if(e.queryCount++,e.totalLatency+=n,e.lastQueryTime=Date.now(),e.avgLatency=e.totalLatency/e.queryCount,e.latencyHistory.push(n),e.latencyHistory.length>20&&e.latencyHistory.shift(),e.latencyHistory.length>=5){const r=[...e.latencyHistory].sort((i,l)=>i-l),a=Math.floor(r.length*.95);e.p95Latency=r[a]}o&&e.cacheHits++,s&&e.networkErrors++,ce.set(t,e)}function $(t){return t.includes("messages")?"high":t.includes("userList")?"medium":"low"}function pt(t){switch(t){case"high":return dt;case"medium":return ae;case"low":return ae*2}}function _t(t){switch(t){case"high":return mt;case"medium":return ie;case"low":return ie*2}}function Z(){if(g.size<=ft)return;const t=Array.from(g.entries());t.sort(([,o],[,s])=>{const e={low:0,medium:1,high:2},r=e[o.priority]-e[s.priority];if(r!==0)return r;const a=o.queryCount-s.queryCount;return a!==0?a:o.timestamp-s.timestamp});const n=Math.ceil(g.size*.2);for(let o=0;o<n;o++)g.delete(t[o][0])}function W(){return new Promise(t=>{I.activeConnections<I.maxConnections?(I.activeConnections++,t()):I.connectionQueue.push(()=>{I.activeConnections++,t()})})}function z(){if(I.activeConnections--,I.connectionQueue.length>0){const t=I.connectionQueue.shift();t&&t()}}function X(t,n,o){return`${t}:${n||"global"}:${o||""}`}function ee(t,n){const o=$(n),s=pt(o);return Date.now()-t.timestamp<s}function te(t,n,...o){const s=$(t),e=_t(s),r=O.get(t);r&&clearTimeout(r);const a=setTimeout(async()=>{try{await W(),n(...o)}catch(i){console.error("Query execution error:",i)}finally{z(),O.delete(t)}},e);O.set(t,a)}async function ht({room:t,user:n,text:o="",type:s="chat",...e}){const r=["chat","actions","settings","room","media"];if(!r.includes(s)){let l="Invalid message type. Was expecting ";return l+=r.join(", "),l+=` but got ${s}`,console.error(l)}const a={room:t,user:n.uid,text:o,type:s,...e};if(JSON.stringify(a)===JSON.stringify(re))return;re=a;const i=Date.now();try{return await F(A(w,"chat-rooms",t?.toUpperCase()||"PUBLIC","messages"),{text:o.trim(),ttl:new Date(i+1440*60*1e3),type:s,...e,uid:n.uid,displayName:n.displayName,timestamp:Ue()})}catch(l){return console.error(l)}}async function Uo(t,n){return He(S(w,`/chat-rooms/${t.toUpperCase()}/messages/${n}`))}function Vo(t,n,o={}){if(!t)return;const{limitCount:s=be,startAfterDoc:e,enableCache:r=!0,enableDebounce:a=!0}=o,i=t.toUpperCase(),l=X("messages",i,`limit:${s}`),d=Date.now();if(r){const m=g.get(l);if(m&&ee(m,l))return m.queryCount++,g.set(l,m),E(l,Date.now()-d,!0),n(m.data),()=>{}}const u=()=>{let m=!1,f;try{W();const p=new Date;p.setHours(p.getHours()-3);let _=U(A(w,"chat-rooms",i,"messages"),V("timestamp",">",p),q("timestamp","asc"),N(s));return e&&(_=U(A(w,"chat-rooms",i,"messages"),V("timestamp",">",p),q("timestamp","asc"),Ee(e),N(s))),f=Te(_,h=>{const T=Date.now(),C=T-d,v=h.docs.map(P=>({id:P.id,...P.data()}));if(r&&v.length>0){Z();const P=h.docs[h.docs.length-1],Oe=$(l);g.set(l,{data:v,timestamp:T,lastVisible:P,queryCount:1,priority:Oe})}E(l,C,!1,m),n(v)},h=>{m=!0,console.error("getMessages error:",h),E(l,Date.now()-d,!1,!0)}),f}catch(p){return m=!0,console.error("getMessages connection error:",p),E(l,Date.now()-d,!1,!0),()=>{}}finally{z()}};if(a){let m;return te(l,()=>{m=u()}),()=>{const f=O.get(l);f&&(clearTimeout(f),O.delete(l)),m&&m()}}return u()}function So(t,n={}){const{limitCount:o=be,startAfterDoc:s,enableCache:e=!0,enableDebounce:r=!0}=n,a=X("schedule",null,`limit:${o}`),i=Date.now();if(e){const u=g.get(a);if(u&&ee(u,a))return u.queryCount++,g.set(a,u),E(a,Date.now()-i,!0),t(u.data),()=>{}}const l=async()=>{let u=!1,m;try{await W();const f=new Date;f.setMinutes(f.getMinutes()-5);let p=U(A(w,"schedule"),V("dateTime",">",f),q("dateTime","asc"),N(o));return s&&(p=U(A(w,"schedule"),V("dateTime",">",f),q("dateTime","asc"),Ee(s),N(o))),m=Te(p,_=>{const h=Date.now(),T=h-i,C=_.docs.map(v=>({id:v.id,...v.data()}));if(e&&C.length>0){Z();const v=_.docs[_.docs.length-1],P=$(a);g.set(a,{data:C,timestamp:h,lastVisible:v,queryCount:1,priority:P})}E(a,T,!1,u),t(C)},_=>{u=!0,console.error("getSchedule error:",_),E(a,Date.now()-i,!1,!0)}),m||(()=>{})}catch(f){return u=!0,console.error("getSchedule connection error:",f),E(a,Date.now()-i,!1,!0),()=>{}}finally{z()}};if(r){let u;return te(a,async()=>{u=await l()}),()=>{const m=O.get(a);m&&(clearTimeout(m),O.delete(a)),u&&u()}}const d=l();return d instanceof Promise?()=>{}:d}async function $o(t,n,o="PUBLIC"){try{return await F(A(w,"schedule"),{dateTime:ze.fromDate(t),url:n,room:o})}catch(s){return console.error(s)}}function gt(t={tables:["customTiles","gameBoard"]}){const{tables:n}=t,o=new Set(n),s={timeouts:{},queue:new Set,scheduleSync(e){this.timeouts[e]&&clearTimeout(this.timeouts[e]),this.queue.add(e),this.timeouts[e]=setTimeout(()=>{this.processSyncQueue()},2e3)},processSyncQueue(){if(this.queue.size===0)return;const e=window;e.authContext?.user&&!e.authContext.user.isAnonymous&&e.authContext.syncData(),this.queue.clear(),Object.keys(this.timeouts).forEach(r=>{clearTimeout(this.timeouts[r]),delete this.timeouts[r]})}};return{stack:"dbcore",name:"syncMiddleware",create(e){return{...e,table(r){const a=e.table(r);return o.has(r)?{...a,mutate:async i=>{const l=await a.mutate(i);return["put","add","delete","deleteRange","update"].includes(i.type)&&s.scheduleSync(r),l}}:a}}}}}class yt extends Je{constructor(){super("blitzedOut");G(this,"customTiles");G(this,"gameBoard");this.version(2).stores({customTiles:"++id, group, intensity, action, isEnabled, tags, gameMode, isCustom, locale",gameBoard:"++id, title, tiles, tags, gameMode, isActive"})}}const L=new yt;L.use(gt({tables:["customTiles","gameBoard"]}));const{customTiles:b}=L;b.hook("creating",function(t,n,o){n.locale===void 0&&(n.locale="en"),n.gameMode===void 0&&(n.gameMode="online"),n.isCustom===void 0&&(n.isCustom=1)});const Et=async t=>{const n=t.map(o=>({...o,isEnabled:1}));return await b.bulkAdd(n)},Ae=t=>{const n=["locale","gameMode","group","intensity","tag","isCustom","action"];let o=b.toCollection();return Object.entries(t).filter(([e])=>n.includes(e)).forEach(([e,r])=>{r==null||r===""||(e==="tag"?o=o.filter(a=>a.tags.includes(r)):o=o.filter(a=>a[e]===r))}),o},De=async(t={})=>{try{return await Ae(t).toArray()}catch(n){return console.error("Error in getTiles:",n),[]}},Pe=async t=>{const{page:n=1,limit:o=50}=t;try{const s=Ae(t),e=await s.count(),r=(n-1)*o;return{items:await s.offset(r).limit(o).toArray(),total:e,page:n,limit:o,totalPages:Math.ceil(e/o)}}catch(s){return console.error("Error in getPaginatedTiles:",s),{items:[],total:0,page:n,limit:o,totalPages:0}}},ko=async(t="en",n="online",o=null)=>{let s=b.where("locale").equals(t).and(r=>r.gameMode===n);return o&&(s=s.and(r=>r.tags.some(a=>o.includes(a)))),(await s.toArray()).reduce((r,a)=>{const i=a.group;r[i]||(r[i]={label:i,count:0,intensities:{}}),r[i].count++;const l=Number(a.intensity);return r[i].intensities[l]||(r[i].intensities[l]=0),r[i].intensities[l]++,r},{})},Bo=(t=null)=>{const n=M.resolvedLanguage||M.language||"en";let o=b.where("locale").equals(n).and(s=>s.isEnabled===1);return t&&(o=o.and(s=>s.gameMode===t)),o.toArray()},Tt=async t=>await b.add({...t,isEnabled:1}),xo=async(t,n)=>await b.update(t,n),Ho=async t=>{const n=await b.get(t);if(!n)throw new Error(`Custom tile with id ${t} not found`);return await b.update(t,{isEnabled:n.isEnabled?0:1})};async function wt(){try{return await L.customTiles.where("isCustom").equals(1).delete(),!0}catch(t){return console.error("Error deleting custom tiles:",t),!1}}const qo=async t=>{await b.delete(t)},{gameBoard:D}=L,vt=()=>D.orderBy("title").toArray(),No=async()=>D.where("isActive").equals(1)?.first(),bt=async t=>D.add(t),At=async(t,n)=>D.update(t.id,{...t,...n}),Dt=async t=>{const n={title:t.title===void 0?"":t.title,tiles:t.tiles||[],isActive:t.isActive===void 0?1:t.isActive,tags:t.tags||[],gameMode:t.gameMode||"online"};if(!n?.title?.length&&n?.tiles?.length)return;const o=await D.where("title").equals(n.title).first();return L.transaction("rw",L.gameBoard,async()=>(n.isActive&&await Pt(),o?(await At(o,t),o.id):await bt(n)))},Fo=async t=>{const o=(await D.toArray()).map(s=>({...s,isActive:s.id===t?1:0}));await D.bulkPut(o)},Qo=async t=>{await D.delete(t)},Pt=async()=>{await D.where("isActive").equals(1).modify({isActive:0})},oe=_e();async function It(){const n=y().currentUser;if(!n)return console.error("No user logged in"),!1;try{const o=await De({isCustom:1});return await we(S(oe,"user-data",n.uid),{customTiles:o,lastUpdated:new Date},{merge:!0}),!0}catch(o){return console.error("Error syncing custom tiles:",o),!1}}async function Ct(){const n=y().currentUser;if(!n)return console.error("No user logged in"),!1;try{const o=await vt();return o.length&&await we(S(oe,"user-data",n.uid),{gameBoards:o,lastUpdated:new Date},{merge:!0}),!0}catch(o){return console.error("Error syncing game boards:",o),!1}}async function Wo(){return await It(),await Ct(),!0}async function Rt(){const n=y().currentUser;if(!n)return console.error("No user logged in"),!1;try{const o=S(oe,"user-data",n.uid),s=await ye(o);if(!s.exists())return!1;const e=s.data();if(e.customTiles!==void 0)if(await wt(),await new Promise(r=>setTimeout(r,500)),e.customTiles&&e.customTiles.length>0){for(const r of e.customTiles)try{(await De({gameMode:r.gameMode,group:r.group,intensity:r.intensity,action:r.action})).length===0&&await Tt(r)}catch(a){console.error("Error importing custom tile:",r,a)}console.log(`${e.customTiles.length} custom tiles imported`)}else console.log("No custom tiles to import");if(e.gameBoards&&e.gameBoards.length>0){for(const r of e.gameBoards)await Dt({title:r.title,tiles:r.tiles,tags:r.tags||[],gameMode:r.gameMode||"online",isActive:r.isActive||0});console.log(`${e.gameBoards?.length} game boards imported`)}return!0}catch(o){return console.error("Error syncing data:",o),!1}}let x=null;function zo(t=5){Ot();const n=t*60*1e3;return x=window.setInterval(async()=>{const o=y();o.currentUser&&!o.currentUser.isAnonymous?(console.log("Performing periodic sync from Firebase..."),await Rt()):console.log("Skipping periodic sync - no user logged in")},n),!0}function Ot(){return x?(window.clearInterval(x),x=null,!0):!1}const Lt={messages:[],loading:!0,error:null,room:null,paginationCursor:null},Go=Q()(ve((t,n)=>({...Lt,loadMessages:o=>{const e=J(o);t({messages:e,loading:!1,error:null})},addMessage:o=>{const{messages:s}=n();if(s.find(i=>i.id===o.id))return;const r=[...s,o],a=J(r);t({messages:a})},updateMessage:(o,s)=>{const{messages:e}=n();let r=!1;const a=e.map(i=>{if(i.id===o){const l={...i,...s};if(Object.keys(s).some(u=>i[u]!==s[u]))return r=!0,l}return i});if(r){const i=J(a);t({messages:i})}},clearMessages:()=>{t({messages:[],loading:!1,error:null})},setLoading:o=>{const{loading:s}=n();s!==o&&t({loading:o})},setError:o=>{const{error:s}=n();s!==o&&t({error:o})},setRoom:o=>{const{room:s}=n();s!==o&&t({room:o})},setPaginationCursor:o=>{const{paginationCursor:s}=n();s!==o&&t({paginationCursor:o})},getMessagesByType:o=>{const{messages:s}=n(),e=[];for(let r=0;r<s.length;r++)s[r].type===o&&e.push(s[r]);return e},getLatestMessage:()=>{const{messages:o}=n();return tt(o)},getLatestMessageByType:o=>{const{messages:s}=n();return et(s,o)},getFilteredMessages:o=>{const{messages:s}=n(),e=[];for(let r=0;r<s.length;r++)o(s[r])&&e.push(s[r]);return e},getOrderedMessagesByType:(o,s="ASC")=>{const{messages:e}=n();return Xe(e,o,s)}}),{name:"messages-storage",partialize:t=>({messages:t.messages,room:t.room,paginationCursor:t.paginationCursor}),onRehydrateStorage:()=>t=>{if(t){const n=new Date;n.setHours(n.getHours()-24);const o=t.messages.filter(s=>{try{const e=Ze(s.timestamp);if(!e)throw console.warn(`Failed to parse timestamp for message ${s.id}:`,typeof s.timestamp,s.timestamp),new Error(`Failed to parse timestamp for message ${s.id}`);return e>n}catch(e){return console.warn(`Failed to parse message timestamp for message ID ${s.id}:`,e.message),!0}});o.length!==t.messages.length&&t.loadMessages(o)}}})),le=50,Yo=Q((t,n)=>({onlineUsers:{},loading:!1,error:null,room:null,_performanceMetrics:{lastUpdateTime:Date.now(),updateCount:0,averageUpdateInterval:0},_pendingUpdates:{},_batchTimeout:null,setUsers:o=>{const s=Date.now();t(e=>{const r=s-e._performanceMetrics.lastUpdateTime,a=e._performanceMetrics.updateCount+1,i=(e._performanceMetrics.averageUpdateInterval*e._performanceMetrics.updateCount+r)/a;return{onlineUsers:o,loading:!1,error:null,_performanceMetrics:{lastUpdateTime:s,updateCount:a,averageUpdateInterval:i}}})},addUser:(o,s)=>{const e=n();e._pendingUpdates[o]=s,e._batchTimeout&&clearTimeout(e._batchTimeout);const r=setTimeout(()=>{e.flushPendingUpdates()},le);t({_batchTimeout:r})},removeUser:o=>{const s=n();s._pendingUpdates[o]=null,s._batchTimeout&&clearTimeout(s._batchTimeout);const e=setTimeout(()=>{s.flushPendingUpdates()},le);t({_batchTimeout:e})},batchUpdateUsers:o=>t(s=>{const e={...s.onlineUsers};Object.entries(o).forEach(([d,u])=>{if(u===null){const{[d]:m,...f}=e;Object.assign(e,f)}else e[d]=u});const r=Date.now(),a=r-s._performanceMetrics.lastUpdateTime,i=s._performanceMetrics.updateCount+1,l=(s._performanceMetrics.averageUpdateInterval*s._performanceMetrics.updateCount+a)/i;return{onlineUsers:e,_performanceMetrics:{lastUpdateTime:r,updateCount:i,averageUpdateInterval:l}}}),flushPendingUpdates:()=>{const o=n();Object.keys(o._pendingUpdates).length!==0&&(o.batchUpdateUsers(o._pendingUpdates),t(()=>({_pendingUpdates:{}})))},clearUsers:()=>t(()=>({onlineUsers:{},loading:!1,error:null,_pendingUpdates:{}})),setLoading:o=>t(()=>({loading:o})),setError:o=>t(()=>({error:o,loading:!1})),setRoom:o=>t(()=>({room:o})),getUsersByRoom:o=>{const s=n();return s.onlineUsers},getActiveUserCount:()=>{const o=n();return Object.keys(o.onlineUsers).length},getPerformanceMetrics:()=>n()._performanceMetrics})),ue=300*1e3,Mt=100,Jo=Q((t,n)=>({schedule:[],loading:!1,error:null,_cache:{upcomingSchedule:{data:[],timestamp:0,limit:0},roomSchedule:{}},_performanceMetrics:{lastUpdateTime:Date.now(),updateCount:0,cacheHitRate:0},_pendingUpdates:[],_batchTimeout:null,loadSchedule:o=>{const s=Date.now();t(e=>{const r=e._performanceMetrics.updateCount+1;return{schedule:o,loading:!1,error:null,_performanceMetrics:{lastUpdateTime:s,updateCount:r,cacheHitRate:e._performanceMetrics.cacheHitRate}}}),n().invalidateCache()},addScheduleItem:o=>{const s=n();t(r=>({_pendingUpdates:[...r._pendingUpdates,o]})),s._batchTimeout&&clearTimeout(s._batchTimeout);const e=setTimeout(()=>{n().flushPendingScheduleUpdates()},Mt);t(()=>({_batchTimeout:e}))},batchAddScheduleItems:o=>t(s=>{const e=[...s.schedule,...o],r=Date.now(),a=s._performanceMetrics.updateCount+1;return{schedule:e,_performanceMetrics:{lastUpdateTime:r,updateCount:a,cacheHitRate:s._performanceMetrics.cacheHitRate}}}),flushPendingScheduleUpdates:()=>{const o=n();o._pendingUpdates.length!==0&&(o._batchTimeout&&clearTimeout(o._batchTimeout),o.batchAddScheduleItems(o._pendingUpdates),t(()=>({_pendingUpdates:[],_batchTimeout:null})),o.invalidateCache())},removeScheduleItem:o=>{t(s=>({schedule:s.schedule.filter(e=>e.id!==o)})),n().invalidateCache()},clearSchedule:()=>{const o=n();o._batchTimeout&&clearTimeout(o._batchTimeout),t(()=>({schedule:[],loading:!1,error:null,_pendingUpdates:[],_batchTimeout:null})),n().invalidateCache()},invalidateCache:()=>t(()=>({_cache:{upcomingSchedule:{data:[],timestamp:0,limit:0},roomSchedule:{}}})),setLoading:o=>t(()=>({loading:o})),setError:o=>t(()=>({error:o,loading:!1})),getUpcomingSchedule:(o=10)=>{const s=n(),e=Date.now(),r=s._cache.upcomingSchedule;if(r.timestamp>0&&e-r.timestamp<ue&&r.limit>=o){const d=s._performanceMetrics.updateCount+1,m=(s._performanceMetrics.cacheHitRate*(d-1)+1)/d;return t(f=>({_performanceMetrics:{...f._performanceMetrics,cacheHitRate:m}})),r.data.slice(0,o)}const i=Ke(),l=s.schedule.filter(d=>d.dateTime.isAfter(i)).sort((d,u)=>d.dateTime.valueOf()-u.dateTime.valueOf()).slice(0,Math.max(o,20));return t(d=>({_cache:{...d._cache,upcomingSchedule:{data:l,timestamp:e,limit:Math.max(o,20)}}})),l.slice(0,o)},getScheduleByRoom:o=>{const s=n(),e=Date.now(),r=s._cache.roomSchedule[o];if(r&&r.timestamp>0&&e-r.timestamp<ue){const l=s._performanceMetrics.updateCount+1,u=(s._performanceMetrics.cacheHitRate*(l-1)+1)/l;return t(m=>({_performanceMetrics:{...m._performanceMetrics,cacheHitRate:u}})),r.data}const i=s.schedule.filter(l=>l.room===o);return t(l=>({_cache:{...l._cache,roomSchedule:{...l._cache.roomSchedule,[o]:{data:i,timestamp:e}}}})),i},getPerformanceMetrics:()=>n()._performanceMetrics}));async function jt(t="en",n="online"){const o={},s=Object.assign({"../locales/en/local/alcohol.json":()=>c(()=>import("./chunk-COViFSNc.js").then(e=>e.b),[]),"../locales/en/local/ballBusting.json":()=>c(()=>import("./chunk-COViFSNc.js").then(e=>e.c),[]),"../locales/en/local/bating.json":()=>c(()=>import("./chunk-COViFSNc.js").then(e=>e.d),[]),"../locales/en/local/bondage.json":()=>c(()=>import("./chunk-COViFSNc.js").then(e=>e.e),[]),"../locales/en/local/breathPlay.json":()=>c(()=>import("./chunk-COViFSNc.js").then(e=>e.f),[]),"../locales/en/local/buttPlay.json":()=>c(()=>import("./chunk-COViFSNc.js").then(e=>e.g),[]),"../locales/en/local/electric.json":()=>c(()=>import("./chunk-COViFSNc.js").then(e=>e.h),[]),"../locales/en/local/footPlay.json":()=>c(()=>import("./chunk-COViFSNc.js").then(e=>e.i),[]),"../locales/en/local/gasMask.json":()=>c(()=>import("./chunk-COViFSNc.js").then(e=>e.j),[]),"../locales/en/local/humiliation.json":()=>c(()=>import("./chunk-COViFSNc.js").then(e=>e.k),[]),"../locales/en/local/kissing.json":()=>c(()=>import("./chunk-COViFSNc.js").then(e=>e.m),[]),"../locales/en/local/pissPlay.json":()=>c(()=>import("./chunk-COViFSNc.js").then(e=>e.p),[]),"../locales/en/local/poppers.json":()=>c(()=>import("./chunk-COViFSNc.js").then(e=>e.n),[]),"../locales/en/local/spanking.json":()=>c(()=>import("./chunk-COViFSNc.js").then(e=>e.s),[]),"../locales/en/local/throatTraining.json":()=>c(()=>import("./chunk-COViFSNc.js").then(e=>e.t),[]),"../locales/en/local/tickling.json":()=>c(()=>import("./chunk-COViFSNc.js").then(e=>e.o),[]),"../locales/en/local/titTorture.json":()=>c(()=>import("./chunk-COViFSNc.js").then(e=>e.q),[]),"../locales/en/local/vaping.json":()=>c(()=>import("./chunk-COViFSNc.js").then(e=>e.v),[]),"../locales/en/online/alcohol.json":()=>c(()=>import("./chunk-COViFSNc.js").then(e=>e.r),[]),"../locales/en/online/ballBusting.json":()=>c(()=>import("./chunk-COViFSNc.js").then(e=>e.u),[]),"../locales/en/online/bating.json":()=>c(()=>import("./chunk-COViFSNc.js").then(e=>e.w),[]),"../locales/en/online/buttPlay.json":()=>c(()=>import("./chunk-COViFSNc.js").then(e=>e.x),[]),"../locales/en/online/gasMask.json":()=>c(()=>import("./chunk-COViFSNc.js").then(e=>e.y),[]),"../locales/en/online/pissPlay.json":()=>c(()=>import("./chunk-COViFSNc.js").then(e=>e.z),[]),"../locales/en/online/poppers.json":()=>c(()=>import("./chunk-COViFSNc.js").then(e=>e.A),[]),"../locales/en/online/throatTraining.json":()=>c(()=>import("./chunk-COViFSNc.js").then(e=>e.B),[]),"../locales/en/online/titTorture.json":()=>c(()=>import("./chunk-COViFSNc.js").then(e=>e.C),[]),"../locales/en/online/vaping.json":()=>c(()=>import("./chunk-COViFSNc.js").then(e=>e.D),[]),"../locales/en/translation.json":()=>c(()=>import("./chunk-COViFSNc.js").then(e=>e.E),[]),"../locales/es/local/alcohol.json":()=>c(()=>import("./chunk-COViFSNc.js").then(e=>e.F),[]),"../locales/es/local/ballBusting.json":()=>c(()=>import("./chunk-COViFSNc.js").then(e=>e.G),[]),"../locales/es/local/bating.json":()=>c(()=>import("./chunk-COViFSNc.js").then(e=>e.H),[]),"../locales/es/local/bondage.json":()=>c(()=>import("./chunk-COViFSNc.js").then(e=>e.I),[]),"../locales/es/local/breathPlay.json":()=>c(()=>import("./chunk-COViFSNc.js").then(e=>e.J),[]),"../locales/es/local/buttPlay.json":()=>c(()=>import("./chunk-COViFSNc.js").then(e=>e.K),[]),"../locales/es/local/electric.json":()=>c(()=>import("./chunk-COViFSNc.js").then(e=>e.L),[]),"../locales/es/local/footPlay.json":()=>c(()=>import("./chunk-COViFSNc.js").then(e=>e.M),[]),"../locales/es/local/gasMask.json":()=>c(()=>import("./chunk-COViFSNc.js").then(e=>e.N),[]),"../locales/es/local/humiliation.json":()=>c(()=>import("./chunk-COViFSNc.js").then(e=>e.O),[]),"../locales/es/local/kissing.json":()=>c(()=>import("./chunk-COViFSNc.js").then(e=>e.P),[]),"../locales/es/local/pissPlay.json":()=>c(()=>import("./chunk-COViFSNc.js").then(e=>e.Q),[]),"../locales/es/local/poppers.json":()=>c(()=>import("./chunk-COViFSNc.js").then(e=>e.R),[]),"../locales/es/local/spanking.json":()=>c(()=>import("./chunk-COViFSNc.js").then(e=>e.S),[]),"../locales/es/local/throatTraining.json":()=>c(()=>import("./chunk-COViFSNc.js").then(e=>e.T),[]),"../locales/es/local/tickling.json":()=>c(()=>import("./chunk-COViFSNc.js").then(e=>e.U),[]),"../locales/es/local/titTorture.json":()=>c(()=>import("./chunk-COViFSNc.js").then(e=>e.V),[]),"../locales/es/local/vaping.json":()=>c(()=>import("./chunk-COViFSNc.js").then(e=>e.W),[]),"../locales/es/online/alcohol.json":()=>c(()=>import("./chunk-COViFSNc.js").then(e=>e.X),[]),"../locales/es/online/ballBusting.json":()=>c(()=>import("./chunk-COViFSNc.js").then(e=>e.Y),[]),"../locales/es/online/bating.json":()=>c(()=>import("./chunk-COViFSNc.js").then(e=>e.Z),[]),"../locales/es/online/buttPlay.json":()=>c(()=>import("./chunk-COViFSNc.js").then(e=>e._),[]),"../locales/es/online/gasMask.json":()=>c(()=>import("./chunk-COViFSNc.js").then(e=>e.$),[]),"../locales/es/online/pissPlay.json":()=>c(()=>import("./chunk-COViFSNc.js").then(e=>e.a0),[]),"../locales/es/online/poppers.json":()=>c(()=>import("./chunk-COViFSNc.js").then(e=>e.a1),[]),"../locales/es/online/throatTraining.json":()=>c(()=>import("./chunk-COViFSNc.js").then(e=>e.a2),[]),"../locales/es/online/titTorture.json":()=>c(()=>import("./chunk-COViFSNc.js").then(e=>e.a3),[]),"../locales/es/online/vaping.json":()=>c(()=>import("./chunk-COViFSNc.js").then(e=>e.a4),[]),"../locales/es/translation.json":()=>c(()=>import("./chunk-COViFSNc.js").then(e=>e.a5),[]),"../locales/fr/local/alcohol.json":()=>c(()=>import("./chunk-COViFSNc.js").then(e=>e.a6),[]),"../locales/fr/local/ballBusting.json":()=>c(()=>import("./chunk-COViFSNc.js").then(e=>e.a7),[]),"../locales/fr/local/bating.json":()=>c(()=>import("./chunk-COViFSNc.js").then(e=>e.a8),[]),"../locales/fr/local/bondage.json":()=>c(()=>import("./chunk-COViFSNc.js").then(e=>e.a9),[]),"../locales/fr/local/breathPlay.json":()=>c(()=>import("./chunk-COViFSNc.js").then(e=>e.aa),[]),"../locales/fr/local/buttPlay.json":()=>c(()=>import("./chunk-COViFSNc.js").then(e=>e.ab),[]),"../locales/fr/local/electric.json":()=>c(()=>import("./chunk-COViFSNc.js").then(e=>e.ac),[]),"../locales/fr/local/footPlay.json":()=>c(()=>import("./chunk-COViFSNc.js").then(e=>e.ad),[]),"../locales/fr/local/gasMask.json":()=>c(()=>import("./chunk-COViFSNc.js").then(e=>e.ae),[]),"../locales/fr/local/humiliation.json":()=>c(()=>import("./chunk-COViFSNc.js").then(e=>e.af),[]),"../locales/fr/local/kissing.json":()=>c(()=>import("./chunk-COViFSNc.js").then(e=>e.ag),[]),"../locales/fr/local/pissPlay.json":()=>c(()=>import("./chunk-COViFSNc.js").then(e=>e.ah),[]),"../locales/fr/local/poppers.json":()=>c(()=>import("./chunk-COViFSNc.js").then(e=>e.ai),[]),"../locales/fr/local/spanking.json":()=>c(()=>import("./chunk-COViFSNc.js").then(e=>e.aj),[]),"../locales/fr/local/throatTraining.json":()=>c(()=>import("./chunk-COViFSNc.js").then(e=>e.ak),[]),"../locales/fr/local/tickling.json":()=>c(()=>import("./chunk-COViFSNc.js").then(e=>e.al),[]),"../locales/fr/local/titTorture.json":()=>c(()=>import("./chunk-COViFSNc.js").then(e=>e.am),[]),"../locales/fr/local/vaping.json":()=>c(()=>import("./chunk-COViFSNc.js").then(e=>e.an),[]),"../locales/fr/online/alcohol.json":()=>c(()=>import("./chunk-COViFSNc.js").then(e=>e.ao),[]),"../locales/fr/online/ballBusting.json":()=>c(()=>import("./chunk-COViFSNc.js").then(e=>e.ap),[]),"../locales/fr/online/bating.json":()=>c(()=>import("./chunk-COViFSNc.js").then(e=>e.aq),[]),"../locales/fr/online/buttPlay.json":()=>c(()=>import("./chunk-COViFSNc.js").then(e=>e.ar),[]),"../locales/fr/online/gasMask.json":()=>c(()=>import("./chunk-COViFSNc.js").then(e=>e.as),[]),"../locales/fr/online/pissPlay.json":()=>c(()=>import("./chunk-COViFSNc.js").then(e=>e.at),[]),"../locales/fr/online/poppers.json":()=>c(()=>import("./chunk-COViFSNc.js").then(e=>e.au),[]),"../locales/fr/online/throatTraining.json":()=>c(()=>import("./chunk-COViFSNc.js").then(e=>e.av),[]),"../locales/fr/online/titTorture.json":()=>c(()=>import("./chunk-COViFSNc.js").then(e=>e.aw),[]),"../locales/fr/online/vaping.json":()=>c(()=>import("./chunk-COViFSNc.js").then(e=>e.ax),[]),"../locales/fr/translation.json":()=>c(()=>import("./chunk-COViFSNc.js").then(e=>e.ay),[]),"../locales/languages.json":()=>c(()=>import("./chunk-COViFSNc.js").then(e=>e.a),[])});for(const e in s)if(e.startsWith(`../locales/${t}/${n}/`)){const r=e.split("/").pop()?.replace(".json","")||"";r&&(o[r]=await s[e]())}return o}const Ut=rt,{customTiles:Ie}=L,j={online:!1,local:!1};function Vt(t,n="en",o="online"){const s=[];return Object.entries(t).forEach(([e,r])=>{!r.actions||Object.keys(r.actions).length===0||Object.entries(r.actions).forEach(([a,i],l)=>{!i||i.length===0||i.forEach(d=>{s.push({group:e,intensity:l,action:d,isEnabled:1,tags:[st("default","Default")],gameMode:o,isCustom:0,locale:n})})})}),s}function St(t,n,o){return!Array.isArray(t)||t.length===0?!1:t.filter(r=>r.locale===n&&r.gameMode===o&&r.isCustom===0).length>=4}async function $t(t){const n=t||"en",o=["online","local"];try{for(const s of o)if(!j[s]){j[s]=!0;try{const e=await Pe({locale:n,gameMode:s,paginated:!1}),r=Array.isArray(e)?e:[];if(St(r,n,s))continue;const a=await jt(n,s),i=Vt(a,n,s),l=await kt(i,n,s);l.length>0&&await Et(l)}finally{j[s]=!1}}}catch(s){console.error(`Error importing default actions for ${n}:`,s),j.online=!1,j.local=!1}}async function kt(t,n,o){const s=await Ie.where("locale").equals(n).and(r=>r.gameMode===o&&r.isCustom===0).toArray(),e=new Set;return s.forEach(r=>{const a=`${r.group}-${r.intensity}-${r.action}`;e.add(a)}),t.filter(r=>{const a=`${r.group}-${r.intensity}-${r.action}`;return!e.has(a)})}async function de(t,n){try{const o=await Pe({locale:t,gameMode:n,paginated:!1});if(!Array.isArray(o)||o.length===0)return;const s=o.filter(a=>a.isCustom===0);if(s.length<=1)return;const e=new Map,r=[];if(s.forEach(a=>{const i=`${a.group}-${a.intensity}-${a.action}`;e.has(i)?a.id!==void 0&&r.push(a.id):e.set(i,a.id)}),r.length>0)for(const a of r)await Ie.delete(a)}catch(o){console.error(`Error removing duplicate default actions for ${t}/${n}:`,o)}}async function Bt(t){await de(t,"online"),await de(t,"local"),await $t(t)}let k=null;function Ko(t){k&&clearTimeout(k),k=window.setTimeout(()=>{try{Bt(t).catch(n=>{console.error("Error during initial default actions import:",n)})}catch(n){console.error("Error during initial default actions import:",n)}k=null},1e3)}const me={locale:"en",gameMode:"online",boardUpdated:!1,room:"PUBLIC"},Ce=Q()(ve(t=>({settings:me,updateSettings:n=>t(o=>({settings:{...o.settings,...n}})),setLocale:n=>t(o=>({settings:{...o.settings,locale:n}})),resetSettings:()=>t({settings:me})}),{name:"gameSettings",partialize:t=>({settings:t.settings})})),Zo=()=>{const{settings:t,updateSettings:n}=Ce();return[t,n]},Xo=()=>{const{settings:t,updateSettings:n}=Ce();return{settings:t,updateSettings:n}};function xt(t){const n=t?.split(".");return!n||n?.length<2?!1:n?.[n.length-1]}function Ht(t){const n=xt(t);return typeof n=="string"&&["mp4","webm","mkv","flv","avi","mov","wmv","mpg","mv4"].includes(n)}function qt(t){return t?t?.startsWith("http")?t:Ht(t)?`/videos/${t}`:`/images/${t}`:""}function en(t){return new URL(t).hostname.replace("www.","").replace(".com","").replace(".net","").replace(".gg","")}function tn(t){return/^https?:\/\/.+\/.+$/.test(t)}function Nt(t){const n=/vimeo\.com\/(\d+)/,o=t.match(n);return`https://player.vimeo.com/video/${o?o[1]:""}?autoplay=1&loop=1&autostart=true`}function Ft(t){const n=/(?:youtube\.com\/(?:[^/]+\/.+\/|(?:v|e(?:mbed)?)\/|[^#]*[?&]v=|youtu\.be\/)([^"&?/ ]{11})|^(?:[^"&?/ ]{11})$)/,o=t.match(n);return`https://www.youtube.com/embed/${o?o[1]:""}?autoplay=1&loop=1&autostart=true`}function Qt(t){const n=/drive\.google\.com\/file\/d\/([^/]+)/,o=t.match(n);return`https://drive.google.com/file/d/${o?o[1]:""}/preview?loop=1`}function Wt(t){const n=/dropbox\.com\/s\/([^/]+)/,o=t.match(n);return`https://www.dropbox.com/s/${o?o[1]:""}?raw=1`}function zt(t){return`https://pornhub.com/embed/${new URL(t).searchParams.get("viewkey")||""}?autoplay=1&loop=1&autostart=true`}function Gt(t){const n=t.split("-");return`https://xhamster.com/xembed.php?video=${n[n.length-1]}?autoplay=1&loop=1&autostart=true`}function Yt(t){if(t.includes("discordapp.net")&&t.includes("imgur.com")&&t.endsWith(".mp4"))return t;const n=/imgur\.com\/([a-zA-Z0-9]+)(?:\.mp4)?|images-ext-\d+\.discordapp\.net\/external\/[^/]+\/https\/i\.imgur\.com\/([a-zA-Z0-9]+)\.mp4/,o=t.match(n);return`https://i.imgur.com/${o?o[1]||o[2]:""}.mp4`}function Re(t){return/\.(mp4|webm|ogg|mov)(\?.*)?$/.test(t)}function Jt(t){return H(t,["media.discordapp.net","cdn.discordapp.com"])&&!Re(t)}function H(t,n){return n.some(o=>t.includes(o))}function Kt(t){let n=null,o=!0;if(!t)return{url:"",isVideo:!1};switch(!0){case t.includes("vimeo.com"):n=Nt(t);break;case H(t,["youtube.com","youtu.be"]):n=Ft(t);break;case t.includes("drive.google.com"):n=Qt(t);break;case t.includes("pornhub.com"):n=zt(t);break;case t.includes("xhamster.com"):n=Gt(t);break;case t.includes("dropbox.com"):n=Wt(t);break;case H(t,["imgur.com","i.imgur.com","discordapp.net","imgur.com"]):n=Yt(t);break;case H(t,["thisvid.com","boyfriendtv.com"]):n=t;break;case Jt(t):n=t,o=!1;break;case Re(t):n=t;break;default:n=qt(t),o=!1;break}return{url:n,isVideo:o}}function on(t,n,o){const{background:s,backgroundURL:e,roomBackground:r}=t,a=s!=="custom"?s:e,i=r==="app"?r:o,l=!ot(n)&&r!=="app"?i:a;return l?Kt(l):{url:null,isVideo:!1}}function Zt(t){for(let n=t.length-1;n>0;n-=1){const o=Math.floor(Math.random()*(n+1));[t[n],t[o]]=[t[o],t[n]]}return t}function fe(t){t.length>1&&t.push(t.shift())}function nn(t,n){return t?.length!==n?.length?!1:t.every((o,s)=>o===n[s])}const{t:R}=M;function Xt(t,n){return t.filter(o=>n==="vers"?o.includes("{sub}")&&o.includes("{dom}")||o.includes("{player}"):!o.match(/{(dom|sub)}/)||o.includes(`{${n}}`))}function eo(t,n,o){const s=t[n]?.role??t.role??"sub";return Object.keys(o).reduce((r,a,i)=>(i>0&&i<=t[n]?.level&&(r[a]=Zt(Xt(o[a],s))),r),{})}function to(t,n){return Object.entries(t).filter(([o])=>n[o]?.level>0).map(([o,s])=>({label:s.label,actions:eo(n,o,s?.actions),key:o,standalone:!1,role:n[o]?.role??n.role??"sub"}))}function oo(t,n){return n.length&&(n.some(({group:o})=>o==="misc")&&t.push({label:R("misc"),actions:{All:[]},key:"misc",standalone:!1}),n.forEach(({group:o,intensity:s,action:e})=>{const r=t.find(a=>a.key===o);if(r&&Object.keys(r.actions).length>=s){const a=Object.values(r.actions)[s-1];if(a){const i=Math.floor(Math.random()*(a.length+1));a.splice(i,0,e)}}})),t}function no(t){return Object.entries(t).reduce((n,[o,s])=>(s?.variation&&(n[o]=s),n),{})}function so(t,n){const o=[],s=[...n];return Object.entries(t).forEach(([e,{level:r,variation:a}])=>{if(r<=0)return;const i=n.findIndex(d=>d.key===e);if(i===-1)return;if(a==="standalone"){s[i]&&(s[i].standalone=!0);return}const l=a==="appendSome"?.4:.9;o.push({...n[i],frequency:l}),s.splice(i,1)}),{appendList:o,listWithoutAppend:s}}function ro(t,n,o,s){if([void 0,"normal"].includes(s)){const e=t/n;return Math.floor(o/e)}return n>=3&&Math.random()>=.6?n-2:n-1}function pe(t,n,o,s){if(!t.length)return{title:"",description:""};fe(t);const{actions:e,label:r,standalone:a,frequency:i,role:l}=t[0],d=Math.random();if(i&&i<=d)return{title:"",description:""};const u=Object.keys(e),m=Object.values(e);let f=ro(n,u.length,o,s?.difficulty);return m[f]||(f=Math.max(0,f-1)),m[f]&&m[f].length>0?(fe(m[f]),{title:r,description:m[f][0],standalone:a,role:l}):{title:"",description:""}}function ao(t,n,o){const s=no(n),{listWithoutAppend:e,appendList:r}=so(s,t),a=[];for(let i=1;i<=o;i+=1){const{title:l,description:d,standalone:u,role:m}=pe(e,o,i,n);let f="";if(!u&&r.length&&d){const{description:p}=pe(r,o,i,n);p?f=`${p.trim().replace(/([^.,!?])$/,"$1.")} ${d}`:f=d}else f=d||"";a.push({title:l,description:f.trim(),role:m})}return a}function io(t,n){const o={title:R("start"),description:R("start")},{finishRange:s=[33,66]}=n,e=`${R("noCum")} ${s[0]}%\r
${R("ruined")} ${s[1]-s[0]}%\r
${R("cum")} ${100-s[1]}%`,r={title:R("finish"),description:e};return[o,...t,r]}function sn(t,n,o=[],s=40){const e=to(n,t);!e.length&&!o.length&&(localStorage.clear(),window.location.reload());const r=oo(e,o),a=ao(r,t,s-2);return io(a,t)}function co(t,n,o){const s=Object.entries(o).filter(([r])=>t[r]).reduce((r,[a,i])=>(r[a]=Object.keys(i.actions).slice(1,t[a]+1),r),{});return(n?.filter(r=>{if(r.group==="misc")return!0;const a=s[r.group];return a&&a.length>=Number(r.intensity)})||[]).length}function lo(t,n,o,s){const{t:e}=M;let r=`### ${M.t("gameSettings")}\r
`;if(s&&(r+=`##### ${s}\r
`),r+=`--- \r
`,Object.entries(o).forEach(([d,u])=>{if(!t[d])return;const{role:m,variation:f,level:p}=t[d],_=m||t.role||"sub";if(p>0){const h=Object.keys(u?.actions||{});if(r+=`* ${u?.label}: ${h[p]||""}`,f&&(r+=` (${e(f)})`),!nt(t.gameMode)&&!f){const T=u[_]??e(_);r+=` (${T})`}r+=`\r
`}}),r.endsWith(`--- \r
`))return"";const{finishRange:a,difficulty:i}=t;r+=`--- \r
`,r+=`* ${e("difficulty")}: ${e(i??"normal")} \r
`,a&&(r+=`* ${e("finishSlider")} ${a[0]}%  | ${a[1]-a[0]}% | ${100-a[1]}%`);const l=co(t,n,o);return l&&(r+=`* ${e("customTilesLabel")}: ${l} \r
`),r}function uo(t){const n={};return Object.entries(t).forEach(([o,s])=>{!["displayName","background","boardUpdated","chatSound","mySound","otherSound","othersDialog","playerDialog","readRoll","hideBoardActions","advancedSettings"].includes(o)&&!o.startsWith("room")&&(n[o]=s)}),n}async function rn({title:t,formData:n,user:o,actionsList:s,tiles:e,customTiles:r=[],reason:a=""}){const i=JSON.stringify(uo(n)),l=await lt({title:t,gameBoard:JSON.stringify(e),settings:i}),d=lo(n,r,s,a);if(!(!l?.id||d===""))return ht({room:n?.room||"PUBLIC",user:o,text:d,type:"settings",gameBoardId:l.id,boardSize:e.length,gameMode:n.gameMode})}function an(t,n){const o=new SpeechSynthesisUtterance;o.text=t,o.pitch=.5;const s=()=>{const e=window.speechSynthesis.getVoices(),r=["Google UK English Male","Microsoft David - English (United States)","Microsoft Mark - English (United States)","Microsoft George - English (United Kingdom)","Daniel"];let a=e.find(i=>i.name===Ut[n]?.voice);if(!a){for(const i of r){const l=e.find(d=>d.name===i);if(l){a=l;break}}a||(a=e.find(i=>i.name.toLowerCase().includes("male")||i.name.includes("David")||i.name.includes("Mark")||i.name.includes("George")||i.name.includes("Daniel"))),!a&&e.length>0&&(a=e[0])}a&&(o.voice=a,console.log(`Using voice: ${a.name}`)),window.speechSynthesis.speak(o)};window.speechSynthesis.getVoices().length===0?window.speechSynthesis.onvoiceschanged=s:s()}const{t:mo}=M;function fo(t){return t.replace(/(?:^|\.\s|!\s)(\w)/g,n=>n.toUpperCase())}function po(t,n,o){const s=Math.random(),e=t.includes("{dom}")&&t.includes("{sub}"),r=n==="vers";function a(i){if(i==="{player}")return!0;const l=i==="{dom}"||i==="{sub}";if(!r&&i===`{${n}}`||!e&&r&&l)return!0;if(e&&r){const d=i==="{dom}"&&s<.5,u=i==="{sub}"&&s>=.5;return d||u}return!1}return t.replace(/{(player|dom|sub)}/g,i=>a(i)?o:i)}function cn(t,n,o){const s=po(t,n,o).replace(/{(dom|sub)}/g,mo("anotherPlayer"));return fo(s)}export{vt as $,Jo as A,$o as B,So as C,Ut as D,Kt as E,Mo as F,xo as G,Xo as H,Tt as I,ko as J,Pe as K,qo as L,Ho as M,Et as N,De as O,en as P,tn as Q,nn as R,cn as S,Ro as T,jo as U,on as V,Ce as W,At as X,Fo as Y,Qo as Z,lt as _,Rt as a,Ko as a0,zo as b,Io as c,Ot as d,bo as e,Do as f,Ao as g,vo as h,Go as i,Vo as j,Yo as k,Co as l,Oo as m,ht as n,Zo as o,jt as p,Bo as q,Po as r,Wo as s,sn as t,Lo as u,Dt as v,No as w,an as x,rn as y,Uo as z};
