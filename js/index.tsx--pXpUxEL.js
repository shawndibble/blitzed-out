const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["js/index.tsx-CL9Xqo0X.js","js/chunk-DDoLnHI0.js","js/chunk-CtIAsvv6.js","js/chunk-D59Sa5ya.js","js/chunk-CoPHbQIg.js","js/chunk-Bp62TkGl.js","js/chunk-8ZYOspRI.js","js/chunk-BDM5WtNj.js","js/chunk-CXIw3Iqt.js","assets/index-BodytYbc.js","js/chunk-CbUvEgHM.js","js/chunk-Dk7I1tJi.js","js/chunk-COViFSNc.js","js/chunk-BmcVylZL.js","js/chunk-B0nG6Nel.js","js/chunk-BICGdz9x.js","js/chunk-BFzXl2Wc.js","js/chunk-Ds_NjC-1.js","js/chunk-CrCBoQmf.js","js/chunk-B4PEA_xj.js","js/index.tsx-o0iBdZOY.js","js/chunk-4GWdBvrH.js","js/chunk-bqvoNmJe.js","js/chunk-JjknM9L9.js","js/index.tsx-BB1mxAS-.js","js/chunk-r8FSinrW.js"])))=>i.map(i=>d[i]);
import{X as G}from"./chunk-CtIAsvv6.js";import{r as n,j as t,t as z,q as A,v as q,s as ee,u as te}from"./chunk-DDoLnHI0.js";import se from"./index.tsx-BlmnKiIW.js";import ne from"./index.tsx-ChW8R_IK.js";import{g as re,R as oe}from"./chunk-CbNvPdBh.js";import{T as H}from"./chunk-BDM5WtNj.js";import{a as _,b as ae,s as ie,c as le,i as ue,g as ce,d as me,u as de,e as fe}from"../assets/index-BodytYbc.js";import{u as $}from"./chunk-BmcVylZL.js";import{u as W}from"./chunk-CrCBoQmf.js";import{u as pe}from"./chunk-jE3-WMs2.js";import ge from"./index.tsx-Ca1Lw518.js";import{u as F}from"./chunk-CXIw3Iqt.js";import{a as he}from"./chunk-r8FSinrW.js";import{u as xe}from"./chunk-dH9yT-e4.js";import{u as je,s as be}from"./chunk-8ZYOspRI.js";import{i as L,a as Q}from"./chunk-Bp62TkGl.js";import{u as Se}from"./chunk-BICGdz9x.js";import{N as V}from"./chunk-Bt1viq1_.js";import{u as ye}from"./chunk-4GWdBvrH.js";import{t as B}from"./chunk-Dk7I1tJi.js";import{h as w,p as Te,P as Re,q as Ne,t as Ce,v as Me,M as ve,w as De,x as Be,y as ke,z as we,B as E,E as Ae,S as Le,T as J,m as I,H as K,I as Ee,J as Ie,K as Pe,N as Oe,C as _e}from"./chunk-D59Sa5ya.js";import"./chunk-CoPHbQIg.js";import"./chunk-bqvoNmJe.js";import"./chunk-B4PEA_xj.js";import"./chunk-CbUvEgHM.js";import"./chunk-COViFSNc.js";import"./chunk-B0nG6Nel.js";import"./chunk-BFzXl2Wc.js";import"./chunk-Ds_NjC-1.js";function Ge(){const{messages:l}=W(),[o,u]=n.useState(!1),r=_(l,"actions"),s=ae(l),c=pe(r),{playerDialog:a,othersDialog:f}=$()[0];if(n.useEffect(()=>{!c||s!==r||u(!0)},[c,s,r]),!r||!c)return null;const d=c?.isSelf;return!f&&d||!a&&!d?t.jsx(H,{open:o,close:()=>u(!1),type:d?"error":"info",vertical:"top",horizontal:"center",disableAutoHide:!0,children:d?t.jsx(z,{i18nKey:"yourTurn"}):t.jsx(z,{i18nKey:"playersTurn",values:{player:c.displayName}})}):null}function $e(l){const o=l.filter(s=>s).map(s=>s.split(": ")),u=[];o.forEach((s,c)=>{if(Number(s[1])===0)return;const a=Array(Number(s[1])).fill(c);u.push(...a)});const r=u[Math.floor(Math.random()*u.length)];return o.map(([s])=>s)[r]?.replace(/(\r\n|\n|\r)/gm,"")||""}function Fe(l,o,u){if(!l)return"";const r=l.split("%");return r.length<=1?he(l,o||"",u||""):$e(r)}function Ue(l,o,u=[]){const{user:r}=F(),{t:s}=A(),c=xe(),a=u.length,[f,d]=n.useState(u[0]||{}),p=a-1,h=n.useRef(0),S=n.useCallback((m,x,j,e)=>{if(!m){console.error("Tile not found at location:",j);return}let i="";const N=Fe(m.description||"",m.role||"",r?.displayName||"");x!==-1&&(i+=`${s("roll")}: ${x}
`),i+=`#${j+1}: ${m.title||s("unknownTile")}
`,i+=`${s("action")}: ${N}`,ie({room:l,user:r,text:e?e+i:i,type:"actions"})},[l,r,s]),g=n.useCallback(m=>{if(m===-1)return{preMessage:`${s("restartingGame")}
`,newLocation:0};const x=c.find(e=>e.isSelf)?.location||0;if(x===p)return{preMessage:`${s("alreadyFinished")}
`,newLocation:m};const j=m+x;return j>=p?{newLocation:p}:{newLocation:j}},[s,c,p]);return n.useEffect(()=>{const m=Array.isArray(o.value)?o.value[0]:o.value,x=o.time;if(m===0||x<=h.current)return;h.current=x;const{preMessage:j,newLocation:e}=g(m);e>=0&&e<u.length&&u[e]?(d({...u[e],index:e}),S(u[e],m,e,j)):console.error(`Invalid location or missing tile: ${e}, gameBoard length: ${u.length}`)},[o,u,S,g]),{tile:f,playerList:c}}function ze(l,o){const{user:{displayName:u}}=F(),[r,s]=n.useState(null),[c,a]=n.useState(u||"");n.useEffect(()=>{(r!==l||u!==c)&&(le({newRoom:l,oldRoom:r,newDisplayName:u||"",oldDisplayName:c,removeOnDisconnect:o||l?.toUpperCase()==="PUBLIC"}),s(l),a(u||""))},[l,u,r,c,o])}function Ve(l,o){const{i18n:r,t:s}=A(),{user:c}=F(),[a,f]=$(),d=q(()=>ce(a?.gameMode)),{messages:p,isLoading:h}=W(),[S,g]=n.useState("1d6"),[m,x]=n.useState(""),j=je(),e=n.useRef(!1),i=n.useCallback(async(b,M=null)=>{if(!e.current){e.current=!0;try{const{gameMode:T,newBoard:C}=await j(b),R={formData:{...a,...b},user:c,customTiles:d,actionsList:await ue(r.resolvedLanguage,T||"online"),tiles:C,title:s("settingsGenerated")};M&&(R.reason=s("rebuiltBoard",{messageUser:M})),await be(R)}finally{setTimeout(()=>{e.current=!1},500)}}},[a,c,d,r.resolvedLanguage,s,j]),N=n.useCallback(async()=>{a?.room!==l&&(await f({...a,room:l}),await i({...a,roomUpdated:!0,room:l}))},[a,l,f,i]);return n.useEffect(()=>{if(!(h||!p.length))try{const b=_(p,"room");if(b){const M=JSON.parse(b.settings),{roomDice:T,roomBackgroundURL:C,roomTileCount:R}=M;let D="1d6";!L(l)&&T&&(D=T),g(D),x(C||""),b.uid!==c?.uid&&R&&o?.length&&R!==o?.length&&!e.current&&i(M,b.displayName)}}catch(b){console.error("Error processing room message:",b)}},[p,h,l,c,o,i]),n.useEffect(()=>{if(!h)try{const b=_(p,"room");if(b||!L(l)&&!b||L(l)&&!Q(a?.gameMode||""))return;if(l!==a?.room&&o?.length&&!e.current){N();return}a?.roomBackgroundURL?.length&&x(a.roomBackgroundURL)}catch(b){console.error("Error in room change effect:",b)}},[l,a,o,p,h,N]),{roller:S,roomBgUrl:m}}function Je(l,o){const[u,r]=n.useState(null),[s,c]=ee(),a=s.get("importBoard"),{t:f}=A(),d=n.useCallback(()=>{r(null)},[]),p=n.useCallback(g=>{try{const m=JSON.parse(g);return Array.isArray(m)?m:null}catch{return null}},[]),h=n.useCallback(g=>{try{return g?JSON.parse(g):{}}catch{return{}}},[]),S=n.useCallback(async()=>{if(c({}),!a)return;const g=await me(a);if(!g?.gameBoard)return r(f("failedBoardImport"));const m=p(g.gameBoard);if(!m)return r(f("failedBoardImport"));const x=g?.title!==f("settingsGenerated")?g.title:f("importedBoard");de({...g,title:x,tiles:m,isActive:1});const j=h(g?.settings);o({...l,...j}),u!==f("updated")&&r(f("updated"))},[a,p,h,l,o,f,u,c]);return n.useEffect(()=>{a&&S()},[a,S]),[u,d]}const Ke=({selectedRoll:l,handleMenuItemClick:o})=>{const[u,r]=n.useState(!1),s=n.useRef(null),c=()=>{r(d=>!d)},a=d=>{d.target instanceof Node&&s.current?.contains(d.target)||r(!1)},f=new Map;return f.set("restart",B("restart")).set("manual",B("manual")).set("30",B("auto30")).set("60",B("auto60")).set("90",B("auto90")).set("custom",B("setTimer")),t.jsxs(t.Fragment,{children:[t.jsx(w,{size:"small","aria-controls":u?"split-button-menu":void 0,"aria-expanded":u?"true":void 0,"aria-label":"select roll options","aria-haspopup":"menu",onClick:c,ref:s,children:t.jsx(Te,{})}),t.jsx(Re,{sx:{zIndex:1},open:u,anchorEl:s.current,transition:!0,disablePortal:!0,placement:"top-end",children:({TransitionProps:d})=>t.jsx(Ne,{...d,style:{transformOrigin:"right bottom"},children:t.jsx(Ce,{children:t.jsx(Me,{onClickAway:a,children:t.jsx(ve,{id:"split-button-menu",autoFocusItem:!0,children:Array.from(f).map(([p,h])=>t.jsx(De,{selected:p===l,onClick:()=>o(p),children:h},p))})})})})})]})},k=10,qe=({isOpen:l,onClose:o,onSubmit:u})=>{const{t:r}=A(),[s,c]=n.useState(30),[a,f]=n.useState(!1),[d,p]=n.useState(!1),[h,S]=n.useState(20),[g,m]=n.useState(60),x=()=>{if(d){let e=Number.parseInt(String(h),10),i=Number.parseInt(String(g),10);Number.isNaN(e)?(e=a?1:k,S(e)):!a&&e<k&&(e=k),Number.isNaN(i)||i<e?(i=e,m(i)):i===0&&(i=180,m(i)),a&&(e*=60,i*=60);const N=Math.floor(Math.random()*(i-e+1))+e;u(N,{isRange:!0,min:e,max:i})}else{let e=Number.parseInt(String(s),10);Number.isNaN(e)?(e=a?1:k,c(e)):a?e*=60:e<k&&(e=k),u(e,{isRange:!1})}o()},j=()=>{c(e=>{const i=Number.parseFloat(String(e));return Number.isNaN(i)||i<=0?e:a?(i*60).toString():(i/60).toString()}),S(e=>{const i=Number.parseFloat(String(e));return Number.isNaN(i)||i<=0?e:a?(i*60).toString():(i/60).toString()}),m(e=>{const i=Number.parseFloat(String(e));return Number.isNaN(i)||i<=0?e:a?(i*60).toString():(i/60).toString()}),f(e=>!e)};return t.jsxs(Be,{open:l,onClose:o,maxWidth:"xs",children:[t.jsx(ke,{children:r("setTimer")}),t.jsxs(we,{children:[t.jsx(E,{sx:{mb:2},children:t.jsx(Ae,{control:t.jsx(Le,{checked:d,onChange:e=>p(e.target.checked)}),label:r("useRandomRange")})}),d?t.jsxs(E,{children:[t.jsx(J,{variant:"subtitle2",children:r("randomTimerRange")}),t.jsxs(E,{sx:{display:"flex",gap:2,my:2},children:[t.jsx(I,{label:r("minValue"),type:"number",value:h,onChange:e=>{const i=parseInt(e.target.value,10);S(i)},fullWidth:!0}),t.jsx(J,{variant:"body1",sx:{alignSelf:"center"},children:"-"}),t.jsx(I,{label:r("maxValue"),type:"number",value:g,onChange:e=>{const i=parseInt(e.target.value,10);m(Math.max(Number(h),i))},fullWidth:!0})]}),t.jsxs(w,{onClick:j,variant:"outlined",size:"small",children:[r(a?"minutes":"seconds"),t.jsx(K,{sx:{ml:1}})]})]}):t.jsx(I,{autoFocus:!0,type:"number",value:s,onChange:e=>c(e.target.value),sx:{width:"15rem"},slotProps:{input:{endAdornment:t.jsx(Ee,{position:"end",children:t.jsxs(w,{onClick:j,variant:"text",children:[r(a?"minutes":"seconds"),t.jsx(K,{sx:{ml:1}})]})})}}})]}),t.jsxs(Ie,{children:[t.jsx(w,{onClick:o,children:r("cancel")}),t.jsx(w,{onClick:x,children:r("set")})]})]})};function He(l){return/^-?\d+$/.test(String(l))}function P(l,o,u){let r=0;for(let s=0;s<Number(l);s+=1)r+=Math.floor(Math.random()*Number(o))+1;u(r)}const We=n.memo(function({setRollValue:o,dice:u,isEndOfBoard:r}){const{t:s}=A(),[c,a]=n.useState(!1),[f,d]=n.useState("manual"),[p,h]=n.useState(0),[S,g]=n.useState(s("roll")),{timeLeft:m,setTimeLeft:x,togglePause:j,isPaused:e}=ye(p),[i,N]=n.useState(!1),[b,M]=n.useState({isRange:!1,min:30,max:120}),T=n.useCallback(y=>{o(y)},[o]),[C,R]=u.split("d"),D=()=>{if(f==="manual"){P(C,R,T),a(!0),setTimeout(()=>a(!1),4e3);return}e&&m===p&&P(C,R,T),j()},U=n.useCallback(y=>{if(y==="restart"){T(-1);return}if(d(String(y)),y==="custom"){N(!0);return}if(He(y)){e||j();const v=Number(y);h(v),x(v)}},[e,x,j,T]),X=()=>{N(!1)},Y=(y,v={isRange:!1})=>{e||j(),h(y),x(y),M({...b,...v}),d("custom"),N(!1)};return n.useEffect(()=>{r&&j()},[r,j]),n.useEffect(()=>{if(c)g(s("wait"));else if(f==="manual")g(s("roll"));else if(e)g(`${s("play")} (${m})`);else if(m>0)g(`${s("pause")} (${m})`);else if(m===0&&!e&&f!=="manual"){P(C,R,T);let y;if(b.isRange){const{min:v,max:Z}=b;y=Math.floor(Math.random()*(Z-v+1))+v}else y=p;h(y),x(y),g(`${s("pause")} (${y})`)}},[c,f,m,e,p,b,s,C,R,T,x]),t.jsxs(t.Fragment,{children:[t.jsxs(Pe,{variant:"contained",className:"dice-roller",children:[t.jsxs(w,{"aria-label":s("roll"),onClick:D,disabled:c,size:"large",children:[t.jsx(Oe,{sx:{mr:1}}),S]}),t.jsx(Ke,{selectedRoll:f,handleMenuItemClick:U})]}),t.jsx(qe,{isOpen:i,onClose:X,onSubmit:Y})]})}),Qe=n.lazy(()=>G(()=>import("./index.tsx-CL9Xqo0X.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19]))),Xe=n.lazy(()=>G(()=>import("./index.tsx-o0iBdZOY.js"),__vite__mapDeps([20,1,2,3,4,5,8,9,10,11,12,18,6,7,13,14,15,16,17,19,21,22,23]))),Ye=n.lazy(()=>G(()=>import("./index.tsx-BB1mxAS-.js"),__vite__mapDeps([24,1,2,3,4,8,9,10,11,12,25,23])));function O(){return t.jsx(E,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100px",children:t.jsx(_e,{size:24})})}function Dt(){const l=te(),o=l.id||"",u=Se(),{t:r}=A(),[s,c]=$();ze(o,s?.roomRealtime);const[a,f]=n.useState({value:0,time:0}),d=q(fe)?.tiles,p=n.useCallback(D=>{f({value:D,time:Date.now()})},[]),{playerList:h,tile:S}=Ue(o,a,d),{roller:g,roomBgUrl:m}=Ve(o,d),[x,j]=Je(s,c);if(!d||!d.length||!Object.keys(s).length||L(o)&&!Q(s.gameMode))return t.jsxs(t.Fragment,{children:[t.jsx(V,{room:l.id,playerList:h}),t.jsx(ge,{open:!0})]});const{isVideo:e,url:i}=re(s,o,m),N=e?"video-adjust":"",{background:b,roomBackground:M}=s,T=!L(o)&&M!=="app"||b!=="color",C=t.jsx(n.Suspense,{fallback:t.jsx(O,{}),children:t.jsx(Ye,{playerList:h,isTransparent:T,gameBoard:d,settings:s})}),R=t.jsx("div",{className:"messages-container",children:t.jsxs(n.Suspense,{fallback:t.jsx(O,{}),children:[t.jsx(Xe,{room:o,isTransparent:T,currentGameBoardSize:d.length}),t.jsx(se,{room:o,isTransparent:T})]})});return t.jsxs(t.Fragment,{children:[t.jsx(V,{room:o,playerList:h}),t.jsx(We,{setRollValue:p,dice:g,isEndOfBoard:S?.index!==void 0&&S.index>=(d?.length??0)-1}),t.jsx(oe,{isVideo:e,url:i}),t.jsx(Ge,{}),u?t.jsx(n.Suspense,{fallback:t.jsx(O,{}),children:t.jsx(Qe,{tab1:C,tab2:R})}):t.jsxs(E,{className:`desktop-container ${N}`,children:[C,R]}),t.jsx(ne,{}),t.jsx(H,{type:x===r("updated")?"success":"error",open:!!x,close:j,children:x})]})}export{Dt as default};
