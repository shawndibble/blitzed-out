import{u as W,b as x,j as e,S as L,aL as _,I as K,a8 as N,aA as R,aw as k,aa as G,ar as A,a3 as $,t as b,az as a,aF as q,a4 as Y}from"./chunk-DCqCmTw7.js";import{C as M,A as H,a as Q,b as U}from"./chunk-Ddv6gvN9.js";import{C as O}from"./chunk-DsesnlQY.js";import{l as J,u as X,m as Z,n as ee,o as te}from"./chunk-YpQmZHCE.js";import{a9 as ne,K as se,aa as ie,o as le}from"./chunk-DyYP0jr7.js";import{T as oe}from"./chunk-Cpw0r6bE.js";import{u as ae}from"./chunk-rJHcTq4h.js";import{x as re,F as de,y as ce}from"./chunk-5SGEHjMG.js";import{u as ue}from"./chunk-BqV4rolb.js";import"../assets/index-CRbdjLFF.js";import"./chunk-BxyRzOKK.js";import"./chunk-DEqwrMjb.js";import"./chunk-BKkrGAF_.js";(function(){var i=typeof window!="undefined"?window:typeof global!="undefined"?global:typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:{};i.SENTRY_RELEASE={id:"b82d01bea29447e452b49ba3e85b9fac2f7942a4"}})();try{(function(){var i=typeof window!="undefined"?window:typeof global!="undefined"?global:typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:{},h=new i.Error().stack;h&&(i._sentryDebugIds=i._sentryDebugIds||{},i._sentryDebugIds[h]="d4e73436-f14b-4c6a-85e0-752b6c6ba253",i._sentryDebugIdIdentifier="sentry-dbid-d4e73436-f14b-4c6a-85e0-752b6c6ba253")})()}catch(i){}function fe({open:i,close:h,setAlert:u,board:l}){const{t:n}=W(),[f,y]=x.useState(""),[m,p]=x.useState(l.title||"");function w(s){try{return m.length?s.map((d,c)=>{const[g,...j]=d.split(`
`).filter(S=>S);if(g===void 0)throw u({message:n("importNoEmpty")});if(!/^\[.+\]$/.test(g))throw u({message:n("importInvalidTitle",{entry:c+1})});if(!j.length)throw u({message:n("importMissingDescription",{entry:c+1})});return{title:g==null?void 0:g.replace(/\[|\]/g,""),description:j.join(`
`)}}):(u({message:n("importTitleRequired")}),null)}catch(d){return null}}const C=async()=>{const s=f.split(/~+/).filter(c=>c),d=w(s);if(!d)return null;try{if(JSON.stringify(l.tiles)===JSON.stringify(d))return u({message:n("importNoChange")}),null}catch(c){return u({message:n("error"),type:"error"}),null}return J({...l,title:m,tiles:d}),u({message:n("saved"),type:"success"}),h(),null},r=()=>{var s;const d=(s=l==null?void 0:l.tiles)==null?void 0:s.map(c=>{if(!c)return"";const g=c.title||"",j=c.description||"";return`[${g}]
${j}`}).filter(Boolean);y((d==null?void 0:d.join(`
~~
`))||"")},D=s=>{p(s.target.value)},I=async s=>{if(!s.target.value.length)return u({message:n("importTitleRequired")}),null;J({...l,title:s.target.value})};return x.useEffect(()=>{i&&r()},[i]),x.useEffect(()=>{p(l.title||"")},[l.title]),e.jsxs(e.Fragment,{children:[e.jsx(L,{fullWidth:!0,label:n("title"),value:m,onChange:D,onBlur:I}),e.jsx(L,{sx:{mt:2},multiline:!0,fullWidth:!0,value:f,onChange:s=>y(s.target.value),InputProps:{endAdornment:e.jsxs("div",{style:{display:"flex",flexDirection:"column",position:"sticky",top:0},children:[e.jsx(_,{title:n("save"),children:e.jsx(K,{size:"small",onClick:C,"aria-label":n("save"),children:e.jsx(ne,{color:"success"})})}),e.jsx(O,{text:f}),e.jsx(O,{text:`${window.location.href}?importBoard=${l.id}`,copiedText:n("copiedLink"),icon:e.jsx(se,{}),tooltip:n("copyShareLink")})]}),sx:{alignItems:"flex-start"}}})]})}function we({open:i,close:h,isMobile:u}){var l;const n=ae(te),[f,y]=x.useState(null),[m,p]=x.useState(0),[w,C]=x.useState(0),r=re()[0],{user:D}=ue();if(!n)return null;const I=t=>{if(!t||!t.length)return null;const o=t[t.length-1];return o!=null&&o.description?o.description.match(/\d+%/g):null},s=t=>{y(t)};async function d({title:t,tiles:o}){const v=o.map(({title:V})=>`* ${V} 
`);v.pop(),v.shift();let B=`### ${a("activated")}: ${t}
`;B+=`---
`,B+=[...new Set(v)].join(" "),B+=`---
`;const T=I(o);T&&T.length===3&&(B+=`* ${a("finishSlider")} ${T[0]}  | ${T[1]} | ${T[2]}`);const E=await de({title:t,gameBoard:JSON.stringify(o),settings:JSON.stringify(r)});E!=null&&E.id&&await ce({room:(r==null?void 0:r.room)||"PUBLIC",user:D,text:B,type:"settings",gameBoardId:E.id,boardSize:o.length,gameMode:r==null?void 0:r.gameMode})}const c=async()=>{const t=await X({isActive:0})||0;C(t)},g=t=>{Z(t.id),d(t),y({message:a("boardEnabled"),type:"success"})},j=t=>{t!==0&&p(t)},z=()=>{typeof m=="number"&&ee(m),p(0)},S=t=>(o,v)=>{C(v?t:0)},F=t=>!t.tiles||t.tiles.length!==((r==null?void 0:r.roomTileCount)||40),P=t=>F(t)?a("boardWrongSize",{size:(r==null?void 0:r.roomTileCount)||40}):t.isActive?a("boardActive"):a("enableBoard");return e.jsxs(e.Fragment,{children:[e.jsxs(N,{fullScreen:u,open:i,onClose:h,PaperProps:{sx:{maxHeight:"100%",height:"100%"}},children:[e.jsxs(R,{children:[e.jsx(k,{i18nKey:"manageGameBoards"}),e.jsx(M,{close:h})]}),e.jsxs(G,{style:{overflowY:"scroll"},children:[e.jsxs(A,{sx:{mb:1},children:[e.jsx($,{variant:"outlined",onClick:c,endIcon:e.jsx(ie,{}),sx:{float:"right"},children:e.jsx(k,{i18nKey:"add"})}),e.jsx(b,{children:e.jsx(k,{i18nKey:"gameBoardDescription"})})]}),n.map(t=>{var o;return e.jsxs(H,{expanded:w===t.id,onChange:S(t.id||0),children:[e.jsxs(Q,{children:[e.jsxs(A,{children:[e.jsx(b,{variant:"body1",children:t.title}),e.jsx(b,{variant:"body2",children:a("tilesCount",{count:((o=t.tiles)==null?void 0:o.length)||0})})]}),e.jsxs(A,{style:{marginLeft:"auto"},justifyContent:"flex-end",children:[e.jsx(_,{title:P(t),children:e.jsx("div",{style:{display:"inline-block"},children:e.jsx(q,{checked:!!t.isActive,disabled:!!t.isActive||F(t),onChange:()=>g(t),size:"small"})})}),e.jsx(_,{title:a("delete"),children:e.jsx("span",{style:{display:"inline-block"},children:e.jsx(K,{onClick:()=>j(t.id||0),size:"small",component:"span",children:e.jsx(le,{color:"error"})})})})]})]}),e.jsx(U,{children:e.jsx(fe,{open:i,close:()=>S(t.id||0)(null,!1),setAlert:s,board:t})})]},t.id)})]})]}),e.jsx(oe,{open:!!(f!=null&&f.message),type:(f==null?void 0:f.type)||"error",close:()=>y(null),children:f==null?void 0:f.message}),e.jsxs(N,{open:!!m,onClose:()=>p(0),children:[e.jsxs(R,{children:[a("deleteBoard"),e.jsx(M,{close:()=>p(0)})]}),e.jsx(G,{children:e.jsx(b,{variant:"body1",children:a("confirmDeleteBoard",{title:(l=n.find(t=>t.id===m))==null?void 0:l.title})})}),e.jsxs(Y,{children:[e.jsx($,{onClick:()=>p(0),children:a("cancel")}),e.jsx($,{onClick:z,children:a("delete")})]})]})]})}export{we as default};
//# sourceMappingURL=index.tsx-D6k_po7G.js.map
