import{r as a,ad as N,au as w,j as e,am as u,Q as R,T as m,ar as B,ao as C,a1 as L}from"./chunk-DJZJtpVs.js";import{T as D}from"./chunk-9fkTg0gS.js";import{l as E}from"./chunk-Dla8VPvr.js";import{b as M}from"./chunk-D0qpN2Ak.js";import{p as O,u as z,R as F}from"./chunk-Jwof0_3l.js";import"./chunk-7OQk-BoX.js";import"./chunk-DEqUmdJg.js";import"../assets/index-Bfndo_nk.js";import"./chunk-Byla7VfE.js";import"./chunk-B4ipE-Yx.js";import"./chunk-DtF_b7C9.js";import"./chunk-B4PEA_xj.js";import"./chunk-yLOK5aTh.js";function W(s){const i=E(s,"room");let r=!1,t="";if(i){const{roomBackgroundURL:l}=JSON.parse(i.settings),n=O(l);n?.isVideo&&(r=n.isVideo),n?.url&&(t=n.url)}return["color","gray"].some(l=>t.includes(l))&&(t=""),{isVideo:r,url:t}}function I(){const[s,i]=a.useState(document.fullscreenElement!=null);a.useEffect(()=>{const t=()=>{i(document.fullscreenElement!=null)};return document.addEventListener("fullscreenchange",t),()=>{document.removeEventListener("fullscreenchange",t)}},[]);const r=a.useCallback(()=>{document.fullscreenElement==null?document.documentElement.requestFullscreen().catch(t=>{console.error("Error attempting to enable fullscreen:",t)}):document.exitFullscreen().catch(t=>{console.error("Error attempting to exit fullscreen:",t)})},[]);return{isFullscreen:s,toggleFullscreen:r}}const P="actions",U=s=>{const{text:i,displayName:r}=s;if(!r)return{};const t=i?.split(`
`),[l,n]=t?.slice(1)||[],x=l?.split(":")[1]?.trim(),o=n?.split(":")[1]?.trim();return{displayName:r,type:x,activity:o}};function te(){const{id:s}=N(),[i,r]=a.useState(""),[t,l]=a.useState(!1),[n,x]=a.useState(!1);try{console.log("=== CAST COMPONENT LOADED ==="),console.log("Room:",s),console.log("Window location:",window.location.href),console.log("User agent:",navigator.userAgent),console.log("Environment checks:",{isProduction:!0,hasConsole:typeof console<"u",hasAlert:typeof alert<"u",hasDocument:typeof document<"u",hasWindow:typeof window<"u",documentTitle:document.title,timestamp:new Date().toISOString()})}catch(c){typeof alert<"u"&&alert("Cast component loaded, room: "+s+" Error: "+c)}const{messages:o,isLoading:d}=M();console.log("=== HOOK RESULTS ==="),console.log("Messages loaded:",{messagesCount:o?.length||0,isLoading:d,firstMessage:o?.[0]||null,lastMessage:o?.[o.length-1]||null});const{isVideo:b,url:h}=W(o);console.log("Background info:",{isVideo:b,url:h||"none"});const g=E(o,P);console.log("Last action:",g||"none");const p=z(g);console.log("Next player:",p||"none");const{isFullscreen:j,toggleFullscreen:T}=I();if(console.log("Fullscreen status:",j),a.useEffect(()=>{const c=window.cast?.framework?.CastReceiverContext,y=navigator.userAgent,S=y.includes("CrKey")||y.includes("TV"),v=c||S||window.location.search.includes("chromecast");return console.log("Cast detection:",{isCastEnvironment:!!c,isChromecast:S,userAgent:y,isActuallyCasting:v,url:window.location.href}),v&&(document.body.classList.add("cast-receiver-mode"),x(!0),console.log("Cast receiver mode activated")),()=>{v&&document.body.classList.remove("cast-receiver-mode")}},[]),a.useEffect(()=>{if(d)return;const c=o[o.length-1];c?.type==="settings"&&(l(!0),r(`${c.displayName} ${w("changedSettings")}`))},[o,d]),console.log("=== RENDER STATE ==="),console.log("Cast render state:",{isLoading:d,messagesLength:o?.length||0,lastAction:!!g,room:s,isCastReceiver:n,url:window.location.href,windowDimensions:{width:window.innerWidth,height:window.innerHeight},bodyClasses:document.body.className,hasRoomBackground:!!h}),console.log("=== DOM DEBUG ==="),console.log("Document ready state:",document.readyState),console.log("Body background color:",getComputedStyle(document.body).backgroundColor),console.log("Cast container exists:",!!document.querySelector(".cast-container")),!g)return console.log("No lastAction found, showing fallback"),e.jsx("div",{style:{backgroundColor:"#000",color:"#fff",minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"24px",fontFamily:"Arial, sans-serif",textAlign:"center",padding:"20px"},children:e.jsxs("div",{children:[e.jsxs("div",{style:{fontSize:"48px",marginBottom:"20px"},children:["blitzedout.com/",s]}),e.jsx("div",{style:{fontSize:"24px"},children:d?"Loading...":"Waiting for game to start"}),e.jsxs("div",{style:{fontSize:"16px",marginTop:"20px",opacity:.7},children:["DEBUG: Cast fallback mode - Room: ",s," | Loading: ",d?"yes":"no"," | Messages: ",o?.length||0]}),e.jsxs("div",{style:{fontSize:"12px",marginTop:"10px",opacity:.5},children:["Time: ",new Date().toLocaleTimeString()," | UA: ",navigator.userAgent.substring(0,50),"..."]}),e.jsxs("div",{style:{fontSize:"12px",marginTop:"5px",opacity:.5},children:["Cast Receiver: ",n?"YES":"NO"," | Body Classes:"," ",document.body.className||"none"]})]})});const{displayName:k,type:A,activity:f}=U(g);return e.jsxs(u,{className:"flex-column",style:{backgroundColor:n?"#000":"transparent",color:"white",minHeight:"100vh"},children:[!!h&&e.jsx(F,{url:h,isVideo:b}),e.jsxs(u,{display:"flex",justifyContent:"space-between",sx:{mx:2,mt:2,mb:-2},children:[e.jsx(u,{flex:"1",children:!n&&!j&&e.jsx(R,{variant:"text",onClick:T,style:{color:"white"},children:w("fullscreen")})}),e.jsx(u,{textAlign:"center",flex:"1",children:!!p?.displayName&&e.jsx(m,{variant:"h4",style:{color:"white",textShadow:"2px 2px 4px rgba(0,0,0,0.8)"},children:e.jsx(B,{i18nKey:"nextPlayersTurn",values:{player:p.displayName}})})},p?.displayName),e.jsx(u,{flex:"1",textAlign:"right",className:"text-stroke",children:f&&e.jsxs(m,{variant:"h4",style:{color:"white",textShadow:"2px 2px 4px rgba(0,0,0,0.8)"},children:["blitzedout.com/",s]})})]}),e.jsx(C,{container:!0,spacing:0,direction:"column",alignItems:"center",justifyContent:"center",className:"cast-container",style:{minHeight:"calc(100vh - 5rem)"},children:e.jsx(C,{container:!0,justifyContent:"center",children:f?e.jsxs(C,{size:12,className:"action-box",style:{backgroundColor:"rgba(0,0,0,0.7)",padding:"2rem",borderRadius:"0.5rem",maxWidth:"80%",margin:"0 auto"},children:[e.jsx(m,{variant:"h3",style:{color:"white",textShadow:"2px 2px 4px rgba(0,0,0,0.8)"},children:`${A} ${w("for")} ${k}`}),e.jsx(u,{className:"divider",style:{marginTop:"-0.5rem",height:"0.5rem",backgroundColor:"white",border:"2px solid black"},children:e.jsx(L,{})}),e.jsx(m,{variant:"h1",style:{color:"white",textShadow:"2px 2px 4px rgba(0,0,0,0.8)",fontWeight:600},children:f})]}):e.jsx("div",{className:"action-box",style:{backgroundColor:"rgba(0,0,0,0.7)",padding:"2rem",borderRadius:"0.5rem",maxWidth:"80%",margin:"0 auto"},children:e.jsxs(m,{variant:"h1",style:{color:"white",textShadow:"2px 2px 4px rgba(0,0,0,0.8)",fontWeight:600},children:["blitzedout.com/",s]})})})},o.length),e.jsx(D,{open:!!t,close:()=>l(!1),hideCloseButton:!0,children:e.jsx(m,{variant:"h5",style:{color:"white"},children:i})})]})}export{te as default};
