import{a7 as v,ad as x,r as t,j as y}from"./chunk-D6lSgkQl.js";import{a as b}from"./chunk-CV1EtLM5.js";import{u as g}from"./chunk-D4N6bcQy.js";import"./chunk-CygiBK7d.js";import"../assets/index-v7n_qbub.js";import"./chunk-B37hsyTU.js";function E(n){if(!n||typeof n!="object")return!1;const e=n;return typeof e.displayName=="string"&&typeof e.uid=="string"&&(e.lastSeen instanceof Date||typeof e.lastSeen=="number"||typeof e.lastSeen=="string")}const C=v.createContext(void 0);function _(n){const{id:e}=x(),{onlineUsers:a,setUsers:l,setRoom:u,clearUsers:o,flushPendingUpdates:c}=g(),i=t.useRef(null),f=t.useRef(e),p=t.useCallback(d=>{if(d===null)o();else{const m={};Object.entries(d).forEach(([U,r])=>{if(E(r)){const S={...r,lastSeen:r.lastSeen instanceof Date?r.lastSeen:new Date(r.lastSeen)};m[U]=S}else console.warn(`Invalid user data for uid ${U}:`,r)}),l(m)}},[l,o]),s=t.useCallback(()=>{i.current&&(i.current(),i.current=null),c()},[c]);t.useEffect(()=>{if(f.current!==e&&(u(e||null),f.current=e),!e){s(),o();return}return s(),b(e,p),i.current=null,s},[e,u,o,p,s]),t.useEffect(()=>s,[s]);const R=t.useMemo(()=>({onlineUsers:a}),[a]);return y.jsx(C.Provider,{value:R,...n})}export{C as UserListContext,_ as UserListProvider};
