import{q as W,r as x,j as e,v as Q,t as A}from"./chunk-DDoLnHI0.js";import{C as O}from"./chunk-bqvoNmJe.js";import{C as R}from"./chunk-Ds_NjC-1.js";import{C as G,u as U,D as H,E as Y,m as _,s as b,F as X}from"../assets/index-BodytYbc.js";import{m as J,O as F,Q as q,b7 as Z,U as ee,x as L,y as M,z as P,B as I,h as z,b8 as te,T as D,S as se,R as ie,J as ne}from"./chunk-D59Sa5ya.js";import{T as re}from"./chunk-BDM5WtNj.js";import{A as oe,a as ae,b as le}from"./chunk-BFzXl2Wc.js";import{t as g}from"./chunk-Dk7I1tJi.js";import{u as ce}from"./chunk-BmcVylZL.js";import{u as de}from"./chunk-CXIw3Iqt.js";import"./chunk-CtIAsvv6.js";import"./chunk-CoPHbQIg.js";import"./chunk-CbUvEgHM.js";import"./chunk-COViFSNc.js";function ue({open:f,close:B,setAlert:o,board:n}){const{t:s}=W(),[d,u]=x.useState(""),[a,v]=x.useState(n.title||"");function C(i){try{return a.length?i.map((r,l)=>{const[p,...T]=r.split(`
`).filter(S=>S);if(p===void 0)throw o({message:s("importNoEmpty")});if(!/^\[.+\]$/.test(p))throw o({message:s("importInvalidTitle",{entry:l+1})});if(!T.length)throw o({message:s("importMissingDescription",{entry:l+1})});return{title:p?.replace(/\[|\]/g,""),description:T.join(`
`)}}):(o({message:s("importTitleRequired")}),null)}catch{return null}}const m=async()=>{const i=d.split(/~+/).filter(l=>l),r=C(i);if(!r)return null;try{if(JSON.stringify(n.tiles)===JSON.stringify(r))return o({message:s("importNoChange")}),null}catch{return o({message:s("error"),type:"error"}),null}return G({...n,title:a,tiles:r}),o({message:s("saved"),type:"success"}),B(),null},k=()=>{const i=n?.tiles?.map(r=>{if(!r)return"";const l=r.title||"",p=r.description||"";return`[${l}]
${p}`}).filter(Boolean);u(i?.join(`
~~
`)||"")},w=i=>{v(i.target.value)},E=async i=>{if(!i.target.value.length)return o({message:s("importTitleRequired")}),null;G({...n,title:i.target.value})};return x.useEffect(()=>{f&&k()},[f]),x.useEffect(()=>{v(n.title||"")},[n.title]),e.jsxs(e.Fragment,{children:[e.jsx(J,{fullWidth:!0,label:s("title"),value:a,onChange:w,onBlur:E}),e.jsx(J,{sx:{mt:2},multiline:!0,fullWidth:!0,value:d,onChange:i=>u(i.target.value),InputProps:{endAdornment:e.jsxs("div",{style:{display:"flex",flexDirection:"column",position:"sticky",top:0},children:[e.jsx(F,{title:s("save"),children:e.jsx(q,{size:"small",onClick:m,"aria-label":s("save"),children:e.jsx(Z,{color:"success"})})}),e.jsx(R,{text:d}),e.jsx(R,{text:`${window.location.href}?importBoard=${n.id}`,copiedText:s("copiedLink"),icon:e.jsx(ee,{}),tooltip:s("copyShareLink")})]}),sx:{alignItems:"flex-start"}}})]})}function ke({open:f,close:B,isMobile:o}){const n=Q(X),[s,d]=x.useState(null),[u,a]=x.useState(0),[v,C]=x.useState(0),m=ce()[0],{user:k}=de();if(!n)return null;const w=t=>{if(!t||!t.length)return null;const c=t[t.length-1];return c?.description?c.description.match(/\d+%/g):null},E=t=>{d(t)};async function i({title:t,tiles:c}){const h=c.map(({title:V})=>`* ${V} 
`);h.pop(),h.shift();let j=`### ${g("activated")}: ${t}
`;j+=`---
`,j+=[...new Set(h)].join(" "),j+=`---
`;const y=w(c);y&&y.length===3&&(j+=`* ${g("finishSlider")} ${y[0]}  | ${y[1]} | ${y[2]}`);const N=await _({title:t,gameBoard:JSON.stringify(c),settings:JSON.stringify(m)});N?.id&&await b({room:m?.room||"PUBLIC",user:k,text:j,type:"settings",gameBoardId:N.id,boardSize:c.length,gameMode:m?.gameMode})}const r=async()=>{const t=await U({isActive:0})||0;C(t)},l=t=>{H(t.id),i(t),d({message:g("boardEnabled"),type:"success"})},p=t=>{t!==0&&a(t)},T=()=>{typeof u=="number"&&Y(u),a(0)},$=t=>(c,h)=>{C(h?t:0)},S=t=>!t.tiles||t.tiles.length!==(m?.roomTileCount||40),K=t=>S(t)?g("boardWrongSize",{size:m?.roomTileCount||40}):t.isActive?g("boardActive"):g("enableBoard");return e.jsxs(e.Fragment,{children:[e.jsxs(L,{fullScreen:o,open:f,onClose:B,PaperProps:{sx:{maxHeight:"100%",height:"100%"}},children:[e.jsxs(M,{children:[e.jsx(A,{i18nKey:"manageGameBoards"}),e.jsx(O,{close:B})]}),e.jsxs(P,{style:{overflowY:"scroll"},children:[e.jsxs(I,{sx:{mb:1},children:[e.jsx(z,{variant:"outlined",onClick:r,endIcon:e.jsx(te,{}),sx:{float:"right"},children:e.jsx(A,{i18nKey:"add"})}),e.jsx(D,{children:e.jsx(A,{i18nKey:"gameBoardDescription"})})]}),n.map(t=>e.jsxs(oe,{expanded:v===t.id,onChange:$(t.id||0),children:[e.jsxs(ae,{children:[e.jsxs(I,{children:[e.jsx(D,{variant:"body1",children:t.title}),e.jsxs(D,{variant:"body2",children:[t.tiles?.length," tiles"]})]}),e.jsxs(I,{style:{marginLeft:"auto"},justifyContent:"flex-end",children:[e.jsx(F,{title:K(t),children:e.jsx("div",{style:{display:"inline-block"},children:e.jsx(se,{checked:!!t.isActive,disabled:!!t.isActive||S(t),onChange:()=>l(t),size:"small"})})}),e.jsx(F,{title:g("delete"),children:e.jsx("span",{style:{display:"inline-block"},children:e.jsx(q,{onClick:()=>p(t.id||0),size:"small",component:"span",children:e.jsx(ie,{color:"error"})})})})]})]}),e.jsx(le,{children:e.jsx(ue,{open:f,close:()=>$(t.id||0)(null,!1),setAlert:E,board:t})})]},t.id))]})]}),e.jsx(re,{open:!!s?.message,type:s?.type||"error",close:()=>d(null),children:s?.message}),e.jsxs(L,{open:!!u,onClose:()=>a(0),children:[e.jsxs(M,{children:["Delete Board",e.jsx(O,{close:()=>a(0)})]}),e.jsx(P,{children:e.jsxs(D,{variant:"body1",children:['Are you sure you want to delete "',n.find(t=>t.id===u)?.title,'"?']})}),e.jsxs(ne,{children:[e.jsx(z,{onClick:()=>a(0),children:"Cancel"}),e.jsx(z,{onClick:T,children:"Delete"})]})]})]})}export{ke as default};
