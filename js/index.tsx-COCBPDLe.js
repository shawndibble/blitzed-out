import{j as e,aa as p,T as j,ax as l,Q as b,r as f,aV as F,aH as W,U as P,y as T,x as V,ay as G,M as B,aW as Y,aX as U,aY as H,az as M,aE as z,aF as $,ab as X,ad as _,aZ as q,a_ as Q,a$ as Z,a1 as J,as as D,W as ee,aD as ne,Y as se}from"./chunk-C6Pi8TK2.js";import{C as te}from"./chunk-DT32YDKJ.js";import{u as ie}from"./chunk-GcFiVWk3.js";import{R as oe,Y as k,S as re,I as w,G as ce}from"./chunk-C7wxs7ys.js";import{b as ae,c as K,d as le,e as de}from"./chunk-D558-eaS.js";import{i as C,b as S}from"./chunk-C7PvMB7v.js";import{H as ue}from"./chunk-BhAE5QJ2.js";import{u as xe}from"./chunk-6l9AHZes.js";import"./chunk-gA50YDka.js";import"./chunk-BmWi31QJ.js";import"./chunk-Dfz0O4C-.js";import"../assets/index-CrMGNACz.js";import"./chunk-DwZ1iRu-.js";import"./chunk-BOGMcbnZ.js";import"./chunk-B4PEA_xj.js";import"./chunk-qOLLNyCc.js";import"./chunk-D2GT55zG.js";import"./chunk-D8DJqpIn.js";function v({children:n,justifyContent:s="space-evenly"}){return e.jsx(p,{sx:{mt:3,display:"flex",flexDirection:"row",justifyContent:s,alignItems:"center"},children:n})}function he({formData:n,setFormData:s,nextStep:o}){const i=ae();function t(){i(n.room),o(C(n.room)?2:1)}return e.jsxs(p,{sx:{m:1},children:[e.jsx(j,{variant:"h6",children:e.jsx(l,{i18nKey:"publicOrPrivate"})}),e.jsx(p,{sx:{margin:"0.5rem"},children:e.jsx(oe,{formData:n,setFormData:s})}),e.jsx(v,{children:e.jsx(b,{variant:"contained",onClick:t,children:e.jsx(l,{i18nKey:C(n.room)?"nextSkip":"next"})})})]})}function pe({formData:n,setFormData:s,nextStep:o,prevStep:i}){const[t,r]=f.useState(!S(n?.gameMode));return f.useEffect(()=>{r(!S(n?.gameMode))},[n?.gameMode]),e.jsxs(p,{sx:{minHeight:"200px",display:"flex",flexDirection:"column"},children:[e.jsx(j,{variant:"h6",children:e.jsx(l,{i18nKey:"playingWithPeople"})}),e.jsx(k,{trueCondition:!S(n?.gameMode),onChange:a=>s({...n,gameMode:a.target.checked?"local":"online",roomRealtime:!a.target.checked}),yesLabel:"yesInteracting"}),e.jsx(F,{in:t,timeout:500,sx:{mt:t?2:0},children:e.jsxs(p,{children:[e.jsx(j,{variant:"h6",children:e.jsx(l,{i18nKey:"yourRole"})}),e.jsx(p,{sx:{display:"flex",justifyContent:"center"},children:e.jsx(re,{value:n.role,onChange:a=>s({...n,role:a.target.value}),label:"mainRole",options:["dom","vers","sub"],defaultValue:"sub",fullWidth:!1})}),e.jsx(j,{variant:"h6",sx:{mt:1},children:e.jsx(l,{i18nKey:"areYouNaked"})}),e.jsx(j,{variant:"body2",sx:{mt:1},children:e.jsx(l,{i18nKey:"nakedDisclaimer"})}),e.jsx(k,{onChange:a=>s({...n,isNaked:a.target.checked}),trueCondition:n.isNaked,yesLabel:"yesNaked"})]})}),e.jsx(p,{sx:{flexGrow:1}}),e.jsxs(v,{children:[e.jsx(b,{onClick:i,children:e.jsx(l,{i18nKey:"previous"})}),e.jsx(b,{variant:"contained",onClick:o,children:e.jsx(l,{i18nKey:"next"})})]})]})}function I(){return e.jsxs(j,{variant:"h6",sx:{mt:2},children:[e.jsx(l,{i18nKey:"setIntensityLevel"}),e.jsx(W,{title:e.jsx(j,{variant:"body1",children:e.jsx(l,{i18nKey:"intensityTooltip"})}),arrow:!0,sx:{ml:1},children:e.jsx(ue,{sx:{ml:.5,fontSize:15}})})]})}const je=(n,s)=>{const{gameMode:o,isNaked:i}=n,t=S(o);return t&&["foreplay","sex"].includes(s.type)||!t&&i&&["solo","foreplay"].includes(s.type)||!t&&!i&&["solo","sex"].includes(s.type)},me=n=>{const s={...n},o=n.selectedActions||{},i={};return Object.entries(o).forEach(([t,r])=>{je(n,r)||(i[t]=r)}),s.selectedActions=i,s},R=(n,s,o)=>{const i=n.selectedActions||{};return Object.entries(i).map(([t,r])=>{const a=s.find(c=>c.value===t);return r.type!==o||!a?null:t}).filter(t=>!!t)},ge=(n,s,o)=>{const i={...n},t={...i.selectedActions};return Object.keys(t).forEach(r=>{t[r].type===s&&!o.includes(r)&&delete t[r]}),i.selectedActions=t,i},L=(n,s,o)=>{o(i=>{const t=ge(i,s,n),r={...t.selectedActions};return n.forEach(a=>{if(r[a])return;let c={type:s,level:1};s==="consumption"&&(c={...c,variation:t.isAppend?"appendMost":"standalone"}),r[a]=c}),{...t,selectedActions:r}})},O=(n,s,o,i,t,r=null)=>{const a=n?.target?.value;if(a===0)return t(c=>c.filter(d=>d!==s)),i(c=>{const d={...c.selectedActions};return delete d[s],{...c,selectedActions:d}});i(c=>{const d={...c.selectedActions};return d[s]={...d[s]||{},type:o,level:a,...!!r&&{variation:r}},{...c,selectedActions:d}})},fe=n=>!!(n&&Object.keys(n).some(s=>{const o=n[s];return(o?.level??0)>0&&o?.variation!=="appendMost"}));function E({onChange:n,values:s,options:o,label:i}){const t=f.useCallback(a=>o?.find(c=>c.value===a)?.label,[o]),r=f.useCallback(a=>e.jsx(p,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:a?.map(c=>e.jsx(P,{label:t(c)},c))}),[t]);return e.jsxs(T,{fullWidth:!0,children:[e.jsx(V,{id:`${i}-label`,children:i}),e.jsx(G,{labelId:`${i}-label`,id:`${i}`,multiple:!0,value:s,onChange:n,fullWidth:!0,input:e.jsx(H,{label:e.jsx(l,{i18nKey:"actionsLabel"})}),renderValue:r,children:o?.map(({label:a,value:c})=>e.jsxs(B,{value:c,children:[e.jsx(Y,{checked:s.includes(c)}),e.jsx(U,{primary:a})]},c))})]})}const ye=2;function be({formData:n,setFormData:s,options:o,actionsList:i}){const t="consumption",r=o(t),c=R(n,r,t)||[],d=u=>{const{value:h}=u.target,y=typeof h=="string"?h.split(","):h;y.length<=ye&&L(y,t,s)},x=(u,h)=>{const y=u.target.checked?"appendMost":"standalone",g=u.target.checked,m={...n.selectedActions};h.forEach(A=>{m[A]&&(m[A]={...m[A],variation:y})});const N={...n,isAppend:g,selectedActions:m};s(N)};return e.jsxs(e.Fragment,{children:[e.jsx(j,{variant:"h6",sx:{my:2},children:e.jsx(l,{i18nKey:"pickConsumptions"})}),e.jsx(E,{onChange:d,values:c,options:r,label:M("consumables")}),!!c.length&&e.jsxs(e.Fragment,{children:[e.jsx(I,{}),c.map(u=>e.jsx(w,{actionsFolder:i,settings:n,option:u,initValue:1,onChange:h=>O(h,u,t,s,()=>{},n.isAppend?"appendMost":"standalone")},u)),e.jsx(j,{variant:"h6",sx:{mt:2},children:e.jsx(l,{i18nKey:"standaloneOrCombine"})}),e.jsx(k,{trueCondition:n.isAppend,onChange:u=>x(u,c),yesLabel:"combineWithActions"})]})]})}const Se=4,Ce=n=>S(n?.gameMode)?"solo":n.isNaked?"sex":"foreplay";function ve({formData:n,setFormData:s,options:o,actionsList:i}){const t=Ce(n),r=o(t),c=R(n,r,t)||[],d=x=>{const{value:u}=x.target,h=typeof u=="string"?u.split(","):u;h.length<=Se&&L(h,t,s)};return e.jsxs(e.Fragment,{children:[e.jsx(j,{variant:"h6",sx:{my:2},children:e.jsx(l,{i18nKey:"pickActions"})}),e.jsx(E,{onChange:d,values:c,options:r,label:M("actionsLabel")}),c.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(I,{}),c.map(x=>e.jsx(w,{actionsFolder:i,settings:n,option:x,initValue:1,onChange:u=>O(u,x,t,s,()=>{})},x))]})]})}function Ae({formData:n,setFormData:s,nextStep:o,prevStep:i,actionsList:t}){function r(d){return Object.keys(t).filter(x=>t[x]?.type===d)}f.useEffect(()=>{const d=me(n);s(d)},[]);const a=d=>r(d).map(x=>({value:x,label:t[x]?.label})),c=!fe(n.selectedActions);return e.jsxs(p,{children:[e.jsx(j,{variant:"body1",sx:{my:2},children:e.jsx(l,{i18nKey:"actionsDisclaimer"})}),e.jsx(ve,{formData:n,setFormData:s,options:a,actionsList:t}),e.jsx(be,{formData:n,setFormData:s,options:a,actionsList:t}),e.jsxs(v,{children:[e.jsx(b,{onClick:()=>i(C(n.room)?2:1),children:e.jsx(l,{i18nKey:"previous"})}),e.jsx(b,{variant:"contained",disabled:c,onClick:o,children:e.jsx(l,{i18nKey:"next"})})]})]})}function ke({formData:n,setFormData:s,prevStep:o,actionsList:i,close:t}){const r=[100,100],a=[0,0],[c,d]=f.useState(K(n?.finishRange||[],a)),[x,u]=f.useState(!1),h=le();function y(m){s({...n,finishRange:m.target.checked?a:r}),d(m.target.checked)}f.useEffect(()=>{let m={...n,boardUpdated:!0};(!c||!K(n.finishRange||[],r))&&(m.finishRange=r),s(m)},[]);async function g(){u(!0);try{await h(n,i)}catch(m){console.error("Error submitting settings:",m)}finally{u(!1)}typeof t=="function"&&t()}return e.jsxs(p,{children:[e.jsx(j,{variant:"h6",sx:{my:2},children:e.jsx(l,{i18nKey:"WillYouOrgasm"})}),e.jsx(j,{variant:"body2",children:e.jsx(l,{i18nKey:"orgasmDisclaimer"})}),e.jsx(p,{sx:{display:"flex",justifyContent:"center",my:1},children:e.jsx(z,{control:e.jsx($,{checked:c,onChange:y}),label:e.jsx(l,{i18nKey:"yesOrgasm"})})}),e.jsxs(v,{children:[e.jsx(b,{onClick:o,disabled:x,children:e.jsx(l,{i18nKey:"previous"})}),e.jsx(b,{variant:"contained",onClick:g,disabled:x,startIcon:x?e.jsx(X,{size:20,color:"inherit"}):null,children:e.jsx(l,{i18nKey:"buildGame"})})]})]})}function Ke({close:n}){const{id:s}=_(),[o,i]=f.useState(1),t={room:s};C(s)&&(t.gameMode="online",t.roomRealtime=!0);const[r,a]=xe({gameMode:"online",roomRealtime:!0,actions:[],consumption:[],role:"sub",boardUpdated:!1,room:s||"PUBLIC"},t),c=f.useRef(!0),{actionsList:d}=de(r.gameMode);f.useEffect(()=>{if(c.current){if(c.current=!1,r.advancedSettings){h();return}if(typeof n=="function"){if(C(s)){i(3);return}if(r.gameMode==="online"){i(3);return}i(2)}}},[r,n,s]);const x=g=>{if(!Number.isInteger(g))return i(o+1);i(o+(g||1))},u=g=>{if(!Number.isInteger(g))return i(o-1);i(o-(g||1))},h=()=>i(0),y=()=>{switch(o){case 1:return e.jsx(he,{formData:r,setFormData:a,nextStep:x});case 2:return e.jsx(pe,{formData:r,setFormData:a,nextStep:x,prevStep:u});case 3:return e.jsx(Ae,{formData:r,setFormData:a,nextStep:x,prevStep:u,actionsList:d});case 4:return e.jsx(ke,{formData:r,setFormData:a,prevStep:u,actionsList:d,close:n});default:return null}};return o===0?e.jsx(ce,{closeDialog:n}):e.jsxs(p,{children:[e.jsx(p,{sx:{width:"100%",mt:2,mb:4},children:e.jsx(q,{activeStep:o-1,alternativeLabel:!0,children:[1,2,3,4].map(g=>e.jsx(Q,{children:e.jsx(Z,{})},g))})}),y(),e.jsx(J,{sx:{mt:3}}),e.jsx(b,{onClick:h,children:e.jsx(l,{i18nKey:"advancedSetup"})})]})}function ze({open:n,close:s}){const o=ie(),[i]=D();return i.get("importBoard")?null:e.jsxs(ee,{fullScreen:o,open:n,maxWidth:"md",children:[e.jsxs(ne,{children:[e.jsx(l,{i18nKey:"gameSettingsHeading"}),typeof s=="function"&&e.jsx(te,{close:s})]}),e.jsx(se,{children:e.jsx(Ke,{close:typeof s=="function"?s:void 0})})]})}export{ze as default};
