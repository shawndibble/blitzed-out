import{r as f,j as g,ak as B,E as O,m as P,am as T}from"./chunk-D6lSgkQl.js";import{c as L}from"./chunk-CygiBK7d.js";import{g as F}from"./chunk-B4PEA_xj.js";import{i as N}from"./chunk-Dd7iFXd-.js";import{l as U}from"./chunk-EL58PX5i.js";import{u as D}from"./chunk-BQ0gYaOf.js";const E=e=>e&&/\.(jpe?g|png|gif|webp|bmp|svg)(\?.*)?$/i.test(e)?"image":"video";function H({url:e}){const[t,n]=f.useState(E(e)),[o,r]=f.useState(e);if(f.useEffect(()=>{r(e),n(E(e))},[e]),!o)return null;const d=()=>{const i=o??e??"";let m=!1;try{const a=new URL(i);m=a.host==="imgur.com"||a.host==="i.imgur.com"}catch{m=!1}if(m){const a=i.match(/(?:i\.)?imgur\.com\/([a-zA-Z0-9]+)(?:\.[a-z]+)?/)?.[1];if(a){const p=`https://i.imgur.com/${a}.jpg`;r(p),n("image");return}}const c=`${i.replace(/\.(mp4|webm|ogg|mov)(\?.*)?$/i,"")}.jpg`;r(c),n("image")},u=()=>{const i=o??e??"";let m=!1;try{const s=new URL(i);m=s.host==="imgur.com"||s.host==="i.imgur.com"}catch{m=!1}if(m){const s=i.match(/(?:i\.)?imgur\.com\/([a-zA-Z0-9]+)(?:\.[a-z]+)?/)?.[1];if(s){const c=["jpg","png","gif","jpeg","webp"],a=o?.split(".").pop(),l=c.indexOf(a||"")+1;if(l<c.length){const h=c[l],k=`https://i.imgur.com/${s}.${h}`;r(k)}}}else{const s=["jpg","png","gif","jpeg","webp"],c=o?.split(".").pop(),p=s.indexOf(c||"")+1;if(p<s.length&&o){const l=s[p],k=`${o.replace(/\.[^.]+(\?.*)?$/,"")}.${l}`;r(k)}}};return t==="video"?g.jsx("video",{autoPlay:!0,loop:!0,muted:!0,playsInline:!0,src:o||void 0,className:"video-background",onError:d,preload:"auto",crossOrigin:"anonymous",controls:!0}):g.jsxs(g.Fragment,{children:[g.jsx("div",{className:"image-background",style:{backgroundImage:o?`url("${String(o).replace(/\\/g,"\\\\").replace(/"/g,'\\"')}")`:void 0,backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat",width:"100%",height:"100%",position:"absolute",top:0,left:0}}),g.jsx("img",{src:o||void 0,onError:u,style:{display:"none"},alt:""})]})}function C({images:e,className:t,zoomDuration:n=3e3,zoomScale:o=1.4}){const[r,d]=f.useState(0),[u,i]=f.useState(0),[m,s]=f.useState(new Set),[c,a]=f.useState(new Set),p=f.useRef(null),l=f.useRef(new Map);f.useEffect(()=>{if(e.length===0)return;const x=y=>new Promise(I=>{if(l.current.has(y)||c.has(y)){I();return}const v=new Image;v.onload=()=>{l.current.set(y,v),s($=>new Set($).add(y)),I()},v.onerror=()=>{a($=>new Set($).add(y)),I()},v.src=y});(async()=>{const y=Math.min(5,e.length),I=[];for(let v=0;v<y;v++){const $=(r+v)%e.length;I.push(x(e[$]))}await Promise.all(I)})()},[e,r,c]),f.useEffect(()=>{if(e.length===0||e.length===1)return;const x=()=>{p.current=window.setInterval(()=>{d(y=>(y+1)%e.length),i(y=>y+1)},n)},R=window.setTimeout(x,2e3);return()=>{window.clearTimeout(R),p.current&&(window.clearInterval(p.current),p.current=null)}},[e.length,n]),f.useEffect(()=>()=>{p.current&&(window.clearInterval(p.current),p.current=null)},[]);const h=e[r]||"",k=m.has(h)||l.current.has(h),b=c.has(h);return f.useEffect(()=>{if(b&&e.length>1){const x=(r+1)%e.length;d(x),i(R=>R+1)}},[b,r,e.length]),e.length===0?null:g.jsxs("div",{className:L("image-slideshow-container",t),"aria-hidden":!0,children:[g.jsx("div",{className:"image-slideshow-fallback"}),k&&!b&&g.jsx("div",{className:"image-slideshow-slide",style:{backgroundImage:`url(${h})`,animationDuration:`${n}ms`,"--zoom-scale":o}},u)]})}function j(e){return e.replace(/&amp;/g,"&")}const M=["r.jina.ai","api.allorigins.win/get?url=","corsproxy.io/?"],Z=(e,t=0)=>{const n=M[t];return n==="api.allorigins.win/get?url="?`https://${n}${encodeURIComponent(e)}`:n==="corsproxy.io/?"?`https://${n}${encodeURIComponent(e)}`:`https://${n}/http://${e.replace(/^https?:\/\//,"")}`};async function J(e,t,n){const o=new Set;let r=null;const d=[m=>`https://www.reddit.com/r/${e}/top.json?limit=100&t=year&raw_json=1${m?`&after=${m}`:""}`,m=>`https://www.reddit.com/r/${e}/hot.json?limit=100&raw_json=1${m?`&after=${m}`:""}`],u=async m=>{try{const s=await fetch(m,{signal:n,credentials:"omit",mode:"cors",headers:{"User-Agent":"BlitzedOut/1.0",Accept:"application/json, text/plain, */*","Accept-Language":"en-US,en;q=0.9"}});if(s.ok){const c=await s.text();try{return JSON.parse(c)}catch{const a=c.indexOf("{"),p=c.lastIndexOf("}");if(a!==-1&&p!==-1&&p>a)try{return JSON.parse(c.slice(a,p+1))}catch{return null}return null}}}catch(s){if(s instanceof DOMException&&s.name==="AbortError")throw s}for(let s=0;s<M.length;s++)try{const c=await fetch(Z(m,s),{signal:n,credentials:"omit",mode:"cors",headers:{"User-Agent":"BlitzedOut/1.0",Accept:"application/json, text/plain, */*"}});if(!c.ok)continue;const a=await c.text();let p;try{const l=JSON.parse(a);p=l.contents?JSON.parse(l.contents):l}catch{const l=a.indexOf("{"),h=a.lastIndexOf("}");if(l!==-1&&h!==-1&&h>l)try{p=JSON.parse(a.slice(l,h+1))}catch{continue}else continue}if(p)return p}catch(c){if(c instanceof DOMException&&c.name==="AbortError")throw c;continue}return null};let i=0;for(;o.size<t&&i<d.length;){r=null;for(let m=0;m<5&&o.size<t;m+=1){const s=d[i](r),c=await u(s);if(!c)break;const a=c?.data?.children??[];r=c?.data?.after??null;for(const p of a){const l=p?.data;if(!l)continue;const h=l.url_overridden_by_dest,k=l.post_hint;if(l.is_gallery&&l.media_metadata&&l.gallery_data){const x=l.gallery_data.items||[];for(const R of x){const y=l.media_metadata[R.media_id],I=y?.s?.u||y?.s?.gif||y?.s?.mp4;if(typeof I=="string"){const v=I.startsWith("http")?I:`https:${I}`;/\.(jpe?g|png|gif|webp)(\?.*)?$/i.test(v)&&o.add(j(v))}}continue}if(k==="image"&&typeof h=="string"&&/\.(jpe?g|png|gif|webp)(\?.*)?$/i.test(h)){o.add(j(h));continue}const b=l.preview?.images?.[0]?.source?.url;if(b){const x=b.startsWith("http")?b:`https:${b}`;o.add(j(x))}}if(!r)break}i+=1}return Array.from(o).slice(0,t)}async function W(e,t){const n=e.maxImages||150;return{images:await J(e.subreddit,n,t),source:`r/${e.subreddit}`}}function z(e){try{const t=new URL(e);return/(^|\.)reddit\.com$/i.test(t.hostname)&&/\/r\//i.test(t.pathname)}catch{return!1}}function K(e){try{return new URL(e).pathname.match(/\/r\/([^/]+)/i)?.[1]??null}catch{return null}}const V=3e5,A=new Map,S=new Map;async function q(e,t){const n=JSON.stringify(e),o=Date.now(),r=A.get(n);if(r&&o-r.fetchedAt<V)return r.result;const d=S.get(n);if(d)try{return await d}catch{}const u=W(e,t).then(i=>(A.set(n,{fetchedAt:Date.now(),result:i}),i)).finally(()=>{S.delete(n)});return S.set(n,u),u}function X(e){const{t}=B(),[n,o]=f.useState([]),[r,d]=f.useState(!1),[u,i]=f.useState(null),[m,s]=f.useState(null),c=f.useRef(null);return f.useEffect(()=>{if(c.current&&c.current.abort(),o([]),i(null),s(null),!e||!z(e)){d(!1);return}const a=K(e);if(!a){i(t("invalidRedditUrl")),d(!1);return}const p={subreddit:a,maxImages:150};d(!0);const l=new AbortController;c.current=l;const h=async(b=0)=>{try{const x=await q(p,l.signal);if(l.signal.aborted)return;o(x.images),s(x.source),i(null),d(!1)}catch{if(l.signal.aborted)return;if(b<2){const y=Math.pow(2,b)*1e3;setTimeout(()=>{l.signal.aborted||h(b+1)},y);return}i(t("redditBlocked")),o([]),s(null),d(!1)}},k=window.setTimeout(h,300);return()=>{l.abort(),window.clearTimeout(k)}},[e]),f.useEffect(()=>()=>{c.current&&c.current.abort()},[]),{images:n,isLoading:r,error:u,source:m}}function Y({url:e}){const{t}=B(),n=O(),{images:o,isLoading:r,error:d}=X(e);return r?g.jsxs("div",{className:"slideshow-container slideshow-loading","aria-hidden":!0,children:[g.jsx("div",{className:"image-slideshow-fallback"}),g.jsx("div",{className:"loading-message",children:t("loadingRedditImages")})]}):d||o.length===0?d?g.jsxs("div",{className:"slideshow-container slideshow-error","aria-hidden":!0,children:[g.jsx("div",{className:"image-slideshow-fallback"}),g.jsxs("div",{className:"error-message",style:{position:"absolute",bottom:"20px",right:"20px",background:P(n.palette.background.paper,.7),color:n.palette.text.primary,padding:"12px 16px",borderRadius:"8px",fontSize:"14px",maxWidth:"300px",zIndex:1e3},children:[g.jsx("strong",{children:t("redditBackgroundNote")}),g.jsx("br",{}),t("redditBlocked")]})]}):null:g.jsx(C,{images:o})}function Ie({url:e=null,isVideo:t=null}){const n=e&&/\.(mp4|webm|ogg|mov|gif)(\?.*)?$/i.test(e),o=e?z(e):!1,r=e==="color"||e==="gray"||e?.includes("/color")||e?.includes("/gray"),d=e&&!r&&(t||!t&&e),u=!t&&o&&e;return g.jsxs(T,{className:L("main-container",!d&&"default-background"),role:"presentation",sx:{backgroundImage:!t&&e&&!r&&!o?`url(${e})`:"none"},children:[t&&!o&&(n?g.jsx(H,{url:e}):g.jsx("iframe",{width:"100%",height:"100%",src:e||void 0,title:"video",allow:"autoplay; fullscreen; encrypted-media; picture-in-picture",sandbox:"allow-same-origin allow-scripts allow-presentation",style:{border:0}})),u?g.jsx(Y,{url:e}):null]})}function G(e){const t=/vimeo\.com\/(\d+)/,n=e.match(t);return`https://player.vimeo.com/video/${n?n[1]:""}?autoplay=1&loop=1&autostart=true`}function Q(e){const t=/(?:youtube\.com\/(?:[^/]+\/.+\/|(?:v|e(?:mbed)?)\/|[^#]*[?&]v=|youtu\.be\/)([^"&?/ ]{11})|^(?:[^"&?/ ]{11})$)/,n=e.match(t);return`https://www.youtube.com/embed/${n?n[1]:""}?autoplay=1&loop=1&autostart=true&mute=1&playsinline=1&controls=0&disablekb=1&fs=0&modestbranding=1&rel=0&iv_load_policy=3`}function ee(e){const t=/drive\.google\.com\/file\/d\/([^/]+)/,n=e.match(t);return`https://drive.google.com/file/d/${n?n[1]:""}/preview?loop=1`}function te(e){const t=/dropbox\.com\/s\/([^/]+)/,n=e.match(t);return`https://www.dropbox.com/s/${n?n[1]:""}?raw=1`}function ne(e){return`https://pornhub.com/embed/${new URL(e).searchParams.get("viewkey")||""}?autoplay=1&loop=1&autostart=true&playsinline=1`}function oe(e){const t=e.split("-");return`https://xhamster.com/xembed.php?video=${t[t.length-1]}?autoplay=1&loop=1&autostart=true&playsinline=1`}function re(e){const t=/media\.tenor\.com\/([a-zA-Z0-9_-]+)\/[^/]*\.(mp4|gif|webp)/;if(e.match(t))return e;const o=/tenor\.com\/view\/[^/]*-(\d+)/,r=e.match(o);return`https://tenor.com/embed/${r?r[1]:""}?autoplay=1`}function se(e){const t=/giphy\.com\/gifs\/[^/]*-([a-zA-Z0-9]+)/,n=e.match(t);return`https://media.giphy.com/media/${n?n[1]:""}/giphy.gif`}function ae(e){const t=/(?:gfycat\.com|redgifs\.com)\/(?:watch\/)?([a-zA-Z0-9]+)/,n=e.match(t),o=n?n[1]:"";return w(e,["redgifs.com"])?`https://files.redgifs.com/${o}.mp4`:`https://giant.gfycat.com/${o}.mp4`}function ie(e){const t=/redtube\.com\/(\d+)/,n=e.match(t);return`https://embed.redtube.com/?id=${n?n[1]:""}&autoplay=true&auto_play=1&playsinline=1&controls=1`}function ce(e){const t=/youporn\.com\/watch\/(\d+)/,n=e.match(t);return`https://www.youporn.com/embed/${n?n[1]:""}?autoplay=1&playsinline=1`}function de(e){const t=/tube8\.com\/[^/]+\/[^/]+\/(\d+)/,n=e.match(t);return`https://www.tube8.com/embed/${n?n[1]:""}?autoplay=1&playsinline=1`}function le(e){return`https://twitframe.com/show?url=${encodeURIComponent(e)}`}function ue(e){try{const r=new URL(e);if((r.host==="discordapp.net"||r.host.endsWith(".discordapp.net"))&&r.pathname.startsWith("/external/")&&(r.pathname.includes("/https/i.imgur.com/")||r.pathname.includes("/https/imgur.com/")))return e}catch(r){U.debug("URL parsing failed for Discord proxy check:",r)}let t="",n=!1;try{const r=new URL(e);n=r.host==="imgur.com"||r.host==="i.imgur.com"}catch(r){return U.debug("URL parsing failed for Imgur processing:",r),""}if(!n)return"";if(e.includes("/gallery/")){const r=e.match(/imgur\.com\/gallery\/[^#]*#([a-zA-Z0-9]+)/);if(r)t=r[1];else{const d=e.match(/#([a-zA-Z0-9]+)/);d&&(t=d[1])}}else{const r=/imgur\.com\/([a-zA-Z0-9]+)(?:\.(mp4|jpg|jpeg|png|gif|webp))?|images-ext-\d+\.discordapp\.net\/external\/[^/]+\/https\/i\.imgur\.com\/([a-zA-Z0-9]+)\.(mp4|jpg|jpeg|png|gif|webp)/,d=e.match(r);t=d?d[1]||d[3]:""}return`https://i.imgur.com/${t}.mp4`}function _(e){return/\.(mp4|webm|ogg|mov)(\?.*)?$/.test(e)}function me(e){return w(e,["media.discordapp.net","cdn.discordapp.com"])&&!_(e)}function w(e,t){try{const n=new URL(e);return t.some(o=>n.host===o||n.host.endsWith("."+o))}catch(n){return U.debug("URL parsing failed in isValidHost, rejecting for security:",n),!1}}function pe(e){let t=null,n=!0;if(!e)return{url:"",isVideo:!1};switch(!0){case w(e,["vimeo.com"]):t=G(e);break;case w(e,["youtube.com","youtu.be"]):t=Q(e);break;case w(e,["drive.google.com"]):t=ee(e);break;case w(e,["pornhub.com"]):t=ne(e);break;case w(e,["xhamster.com"]):t=oe(e);break;case w(e,["dropbox.com"]):t=te(e);break;case w(e,["imgur.com","i.imgur.com"]):t=ue(e);break;case w(e,["tenor.com","media.tenor.com"]):t=re(e),n=!0;break;case w(e,["giphy.com"]):t=se(e),n=!0;break;case w(e,["gfycat.com","redgifs.com"]):t=ae(e),n=!0;break;case w(e,["redtube.com"]):t=ie(e);break;case w(e,["youporn.com"]):t=ce(e);break;case w(e,["tube8.com"]):t=de(e);break;case w(e,["twitter.com","x.com"]):t=le(e),n=!1;break;case w(e,["thisvid.com"]):t=e;break;case w(e,["boyfriendtv.com"]):t=e;break;case me(e):t=e,n=!1;break;case _(e):t=e;break;default:t=F(e),n=!1;break}return{url:t,isVideo:n}}function ve(e,t){const{background:n,backgroundURL:o,roomBackground:r,roomBackgroundURL:d}=e,u=(s,c)=>{if(!s)return null;if(s==="custom")return c?d||null:o||null;if(s==="useAppBackground"){const a=n||"color";return a==="useRoomBackground"?"color":a==="custom"?o||null:a}if(s==="useRoomBackground"){if(N(t))return"color";const a=r||"useAppBackground";return a==="useAppBackground"?"color":a==="custom"?d||null:a}return s};let i=null;return!N(t)&&r&&r!=="useAppBackground"?i=u(r,!0):n?i=u(n,!1):i="color",i?i==="color"||i==="gray"?{url:i,isVideo:!1}:pe(i):{url:null,isVideo:!1}}function fe(e){return{uid:e.uid,displayName:e.displayName,isSelf:e.isSelf,isFinished:e.isFinished}}function ke(e){const[t,n]=f.useState(null),o=D(),r=f.useMemo(()=>o.map(u=>`${u.uid}-${u.displayName}-${u.isFinished}-${u.isSelf}`).join("|"),[o]),d=f.useMemo(()=>e?`${e.uid}-${e.displayName||""}`:null,[e]);return f.useEffect(()=>{if(!e){n(null);return}if(o.length<=1){n(null);return}const u=o.filter(a=>!a.isFinished);if(u.length<=1){n(null);return}let i=-1;i=u.findIndex(a=>a.uid===e.uid),i===-1&&(i=u.findIndex(a=>a.displayName===e.displayName)),i===-1&&(i=0);const m=(i+1)%u.length,s=u[m],c=fe(s);n(c)},[d,r]),t}export{Ie as R,ve as g,pe as p,ke as u};
