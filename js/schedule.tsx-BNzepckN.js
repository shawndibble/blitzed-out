import{a7 as f,r as s,j as _}from"./chunk-DzAIPjqH.js";import{h as b,i as S}from"./chunk-BmjRqaQ3.js";import{d as T}from"./chunk-SagsL35F.js";import{a as g}from"./chunk-BfMAFFX0.js";import"../assets/index-BHv73vX6.js";import"./chunk-D4nXmTaT.js";(function(){var t=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};t.SENTRY_RELEASE={id:"b0aec1b7336667c3da787da9b7139ec106644213"}})();try{(function(){var t=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},o=new t.Error().stack;o&&(t._sentryDebugIds=t._sentryDebugIds||{},t._sentryDebugIds[o]="379869fa-d995-44af-a4e7-eb40d935d9c5",t._sentryDebugIdIdentifier="sentry-dbid-379869fa-d995-44af-a4e7-eb40d935d9c5")})()}catch{}const p=300*1e3,C=100,w=g((t,o)=>({schedule:[],loading:!1,error:null,_cache:{upcomingSchedule:{data:[],timestamp:0,limit:0},roomSchedule:{}},_performanceMetrics:{lastUpdateTime:Date.now(),updateCount:0,cacheHitRate:0},_pendingUpdates:[],_batchTimeout:null,loadSchedule:e=>{const c=Date.now();t(a=>{const n=a._performanceMetrics.updateCount+1;return{schedule:e,loading:!1,error:null,_performanceMetrics:{lastUpdateTime:c,updateCount:n,cacheHitRate:a._performanceMetrics.cacheHitRate}}}),o().invalidateCache()},addScheduleItem:e=>{const c=o();t(n=>({_pendingUpdates:[...n._pendingUpdates,e]})),c._batchTimeout&&clearTimeout(c._batchTimeout);const a=setTimeout(()=>{o().flushPendingScheduleUpdates()},C);t(()=>({_batchTimeout:a}))},batchAddScheduleItems:e=>t(c=>{const a=[...c.schedule,...e],n=Date.now(),u=c._performanceMetrics.updateCount+1;return{schedule:a,_performanceMetrics:{lastUpdateTime:n,updateCount:u,cacheHitRate:c._performanceMetrics.cacheHitRate}}}),flushPendingScheduleUpdates:()=>{const e=o();e._pendingUpdates.length!==0&&(e._batchTimeout&&clearTimeout(e._batchTimeout),e.batchAddScheduleItems(e._pendingUpdates),t(()=>({_pendingUpdates:[],_batchTimeout:null})),e.invalidateCache())},removeScheduleItem:e=>{t(c=>({schedule:c.schedule.filter(a=>a.id!==e)})),o().invalidateCache()},clearSchedule:()=>{const e=o();e._batchTimeout&&clearTimeout(e._batchTimeout),t(()=>({schedule:[],loading:!1,error:null,_pendingUpdates:[],_batchTimeout:null})),o().invalidateCache()},invalidateCache:()=>t(()=>({_cache:{upcomingSchedule:{data:[],timestamp:0,limit:0},roomSchedule:{}}})),setLoading:e=>t(()=>({loading:e})),setError:e=>t(()=>({error:e,loading:!1})),getUpcomingSchedule:(e=10)=>{const c=o(),a=Date.now(),n=c._cache.upcomingSchedule;if(n.timestamp>0&&a-n.timestamp<p&&n.limit>=e){const r=c._performanceMetrics.updateCount+1,m=(c._performanceMetrics.cacheHitRate*(r-1)+1)/r;return t(h=>({_performanceMetrics:{...h._performanceMetrics,cacheHitRate:m}})),n.data.slice(0,e)}const i=T(),d=c.schedule.filter(r=>r.dateTime.isAfter(i)).sort((r,l)=>r.dateTime.valueOf()-l.dateTime.valueOf()).slice(0,Math.max(e,20));return t(r=>({_cache:{...r._cache,upcomingSchedule:{data:d,timestamp:a,limit:Math.max(e,20)}}})),d.slice(0,e)},getScheduleByRoom:e=>{const c=o(),a=Date.now(),n=c._cache.roomSchedule[e];if(n&&n.timestamp>0&&a-n.timestamp<p){const d=c._performanceMetrics.updateCount+1,l=(c._performanceMetrics.cacheHitRate*(d-1)+1)/d;return t(m=>({_performanceMetrics:{...m._performanceMetrics,cacheHitRate:l}})),n.data}const i=c.schedule.filter(d=>d.room===e);return t(d=>({_cache:{...d._cache,roomSchedule:{...d._cache.roomSchedule,[e]:{data:i,timestamp:a}}}})),i},getPerformanceMetrics:()=>o()._performanceMetrics})),M=f.createContext(void 0);function D(t){const{schedule:o,loadSchedule:e,flushPendingScheduleUpdates:c}=w(),a=s.useRef(null),n=s.useCallback(r=>{e(r)},[e]),u=s.useCallback(async(r,l,m)=>{try{const h=await b(r,l,m);return c(),h||void 0}catch(h){throw console.error("Error adding to schedule:",h),h}},[c]),i=s.useCallback(()=>{a.current&&(a.current(),a.current=null),c()},[c]);s.useEffect(()=>(i(),a.current=S(n),i),[n,i]),s.useEffect(()=>i,[i]);const d=s.useMemo(()=>({schedule:o,addToSchedule:u}),[o,u]);return _.jsx(M.Provider,{value:d,...t})}export{M as ScheduleContext,D as ScheduleProvider};
//# sourceMappingURL=schedule.tsx-BNzepckN.js.map
