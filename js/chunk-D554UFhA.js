import{r as p,az as x}from"./chunk-CMb_ATvh.js";import{U as C,o as S}from"../assets/index-D_jbYo8z.js";import{u as k}from"./chunk-L13tEn8b.js";import{u as L}from"./chunk-DOKcbaC-.js";function b(){const t=p.useContext(C);if(!t)throw new Error("UserListContext's value is undefined.");return t}function I(t){const s=S(t,"actions","DESC");return[...new Map(s.map(e=>[e.uid,e])).values()]}function R(t){if(!t||Object.keys(t).length===0)return!1;const e=Object.values(t);if(e.length===0)return!1;const n=e.sort((i,c)=>c.lastActive-i.lastActive)[0];return n&&Date.now()-n.lastActive<3e5}function T(t,s){if(!t||t.length===0||!s)return!1;const e=600*1e3,n=t.sort((i,c)=>c.timestamp.toMillis()-i.timestamp.toMillis()).find(i=>i.uid===s)?.timestamp.toMillis();return n?Date.now()-n<e:!1}function G(){const{user:t}=k(),{messages:s,isLoading:e}=L(),{onlineUsers:n}=b(),i=p.useCallback((d,u,y,M)=>{if(M||!d||!u)return[];const g=I(y);return Object.entries(d).filter(([o,a])=>{const l=o===u?.uid;return R(a)||T(y,o)||l}).map(([o,a])=>{if(!a||Object.keys(a).length===0)return{displayName:"Unknown",uid:o,isSelf:o===u?.uid,location:0,isFinished:!1};const l=Object.values(a),v=l.length>0?l.sort((r,N)=>N.lastActive-r.lastActive)[0]:{displayName:"Unknown"},{displayName:E="Unknown"}=v,f=g.find(r=>r.uid===o)?.text,h=/(?:#)[\d]*(?=:)/gs;let m=0;if(f&&f.match(h)){const r=f.match(h);r&&r[0]&&(m=Number(r[0].replace("#","")))}const A=m>0?m-1:m,w=!!f?.includes(x("finish"));return{displayName:E,uid:o,isSelf:o===u?.uid,location:A,isFinished:w}})},[]);return p.useMemo(()=>i(n,t,[...s],e),[i,n,t,s,e])}export{G as u};
