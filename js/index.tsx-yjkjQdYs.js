const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["js/index.tsx-DXjgNNtq.js","js/chunk-BoIRgPCP.js","js/chunk-BHSFqGHu.js","js/chunk-DXd3GHw1.js","js/chunk-Bp62TkGl.js","js/chunk-COV8wOLQ.js","js/chunk-B-GQsBHJ.js","js/chunk-Bci0zq1p.js","assets/index-iNPYMOsW.js","js/chunk-Bde8qXua.js","js/chunk-B2YZP62-.js","js/chunk-BaJvVaWg.js","js/chunk-BwXEZKED.js","js/chunk-_XImYCHd.js","js/chunk-D5QWNTV5.js","js/chunk-BnDmEeUs.js","js/chunk-JK3oC_qz.js","js/chunk-BuXVQPZW.js","js/chunk-B4PEA_xj.js","js/index.tsx-Bcb0bRNt.js","js/chunk-CNuExR48.js","js/chunk-elE9Uhv5.js","js/chunk-B2EJjyQp.js","js/index.tsx-CsNITus3.js","js/chunk-D030ifrn.js"])))=>i.map(i=>d[i]);
import{l as $,a as ee,s as te,b as se,p as ne,g as re,c as oe,u as ae,t as A,_ as F,d as ie}from"../assets/index-iNPYMOsW.js";import{j as t,e as k,A as le,P as ue,l as ce,m as me,n as de,M as fe,o as pe,p as ge,q as he,s as xe,B as L,t as je,S as be,T as J,i as O,v as K,I as Se,w as ye,x as Te,y as Re,C as Me}from"./chunk-BoIRgPCP.js";import Ce from"./index.tsx-BIQ16aIU.js";import Ne from"./index.tsx-B4OvBWN4.js";import{g as ve,R as De}from"./chunk-CTMvCc_m.js";import{T as H}from"./chunk-B-GQsBHJ.js";import{u as U}from"./chunk-BaJvVaWg.js";import{u as Q}from"./chunk-BuXVQPZW.js";import{u as Ae}from"./chunk-DgxemKef.js";import{r as n,m as Be,u as ke}from"./chunk-BHSFqGHu.js";import{T as W,u as w}from"./chunk-Bci0zq1p.js";import we from"./index.tsx-Dtbnqdvk.js";import{u as z}from"./chunk-B2YZP62-.js";import{a as Le}from"./chunk-D030ifrn.js";import{u as Ee}from"./chunk-C192y7Ui.js";import{u as Ie,s as Pe}from"./chunk-COV8wOLQ.js";import{i as Oe}from"./chunk-BnDmEeUs.js";import{u as Y}from"./chunk-_XImYCHd.js";import{i as E,a as X}from"./chunk-Bp62TkGl.js";import{u as _e}from"./chunk-D5QWNTV5.js";import{N as q}from"./chunk-BQaRRwfD.js";import{u as Ge}from"./chunk-CNuExR48.js";import"./chunk-Bde8qXua.js";import"./chunk-DXd3GHw1.js";import"./chunk-elE9Uhv5.js";import"./chunk-B4PEA_xj.js";import"./chunk-BwXEZKED.js";import"./chunk-JK3oC_qz.js";function $e(){const{messages:l}=Q(),[o,u]=n.useState(!1),r=$(l,"actions"),s=ee(l),c=Ae(r),{playerDialog:a,othersDialog:f}=U()[0];if(n.useEffect(()=>{!c||s!==r||u(!0)},[c,s,r]),!r||!c)return null;const d=c?.isSelf;return!f&&d||!a&&!d?t.jsx(H,{open:o,close:()=>u(!1),type:d?"error":"info",vertical:"top",horizontal:"center",disableAutoHide:!0,children:d?t.jsx(W,{i18nKey:"yourTurn"}):t.jsx(W,{i18nKey:"playersTurn",values:{player:c.displayName}})}):null}function Fe(l){const o=l.filter(s=>s).map(s=>s.split(": ")),u=[];o.forEach((s,c)=>{if(Number(s[1])===0)return;const a=Array(Number(s[1])).fill(c);u.push(...a)});const r=u[Math.floor(Math.random()*u.length)];return o.map(([s])=>s)[r]?.replace(/(\r\n|\n|\r)/gm,"")||""}function Ue(l,o,u){if(!l)return"";const r=l.split("%");return r.length<=1?Le(l,o||"",u||""):Fe(r)}function ze(l,o,u=[]){const{user:r}=z(),{t:s}=w(),c=Ee(),a=u.length,[f,d]=n.useState(u[0]||{}),p=a-1,h=n.useRef(0),y=n.useCallback((m,x,j,e)=>{if(!m){console.error("Tile not found at location:",j);return}let i="";const M=Ue(m.description||"",m.role||"",r?.displayName||"");x!==-1&&(i+=`${s("roll")}: ${x}
`),i+=`#${j+1}: ${m.title||s("unknownTile")}
`,i+=`${s("action")}: ${M}`,te({room:l,user:r,text:e?e+i:i,type:"actions"})},[l,r,s]),g=n.useCallback(m=>{if(m===-1)return{preMessage:`${s("restartingGame")}
`,newLocation:0};const x=c.find(e=>e.isSelf)?.location||0;if(x===p)return{preMessage:`${s("alreadyFinished")}
`,newLocation:m};const j=m+x;return j>=p?{newLocation:p}:{newLocation:j}},[s,c,p]);return n.useEffect(()=>{const m=Array.isArray(o.value)?o.value[0]:o.value,x=o.time;if(m===0||x<=h.current)return;h.current=x;const{preMessage:j,newLocation:e}=g(m);e>=0&&e<u.length&&u[e]?(d({...u[e],index:e}),y(u[e],m,e,j)):console.error(`Invalid location or missing tile: ${e}, gameBoard length: ${u.length}`)},[o,u,y,g]),{tile:f,playerList:c}}function Ve(l,o){const{user:{displayName:u}}=z(),[r,s]=n.useState(null),[c,a]=n.useState(u||"");n.useEffect(()=>{(r!==l||u!==c)&&(se({newRoom:l,oldRoom:r,newDisplayName:u||"",oldDisplayName:c,removeOnDisconnect:o||l?.toUpperCase()==="PUBLIC"}),s(l),a(u||""))},[l,u,r,c,o])}function Je(l,o){const{i18n:r,t:s}=w(),{user:c}=z(),[a,f]=U(),d=Y(()=>re(a?.gameMode)),{messages:p,isLoading:h}=Q(),[y,g]=n.useState("1d6"),[m,x]=n.useState(""),j=Ie(),e=n.useRef(!1),i=n.useCallback(async(b,N=null)=>{if(!e.current){e.current=!0;try{const{gameMode:T,newBoard:C}=await j(b),R={formData:{...a,...b},user:c,customTiles:d,actionsList:await Oe(r.resolvedLanguage,T||"online"),tiles:C,title:s("settingsGenerated")};N&&(R.reason=s("rebuiltBoard",{messageUser:N})),await Pe(R)}finally{setTimeout(()=>{e.current=!1},500)}}},[a,c,d,r.resolvedLanguage,s,j]),M=n.useCallback(async()=>{a?.room!==l&&(await f({...a,room:l}),await i({...a,roomUpdated:!0,room:l}))},[a,l,f,i]);return n.useEffect(()=>{if(!(h||!p.length))try{const b=$(p,"room");if(b){const N=JSON.parse(b.settings),{roomDice:T,roomBackgroundURL:C,roomTileCount:R}=N;let D="1d6";!E(l)&&T&&(D=T),g(D),x(C||"");const I=ne(b.timestamp),P=(I?Date.now()-I.getTime():1/0)<300*1e3;b.uid!==c?.uid&&R&&o?.length&&R!==o?.length&&P&&!e.current&&i(N,b.displayName)}}catch(b){console.error("Error processing room message:",b)}},[p,h,l,c,o,i]),n.useEffect(()=>{if(!h)try{const b=$(p,"room");if(b||!E(l)&&!b||E(l)&&!X(a?.gameMode||""))return;if(l!==a?.room&&o?.length&&!e.current){M();return}a?.roomBackgroundURL?.length&&x(a.roomBackgroundURL)}catch(b){console.error("Error in room change effect:",b)}},[l,a,o,p,h,M]),{roller:y,roomBgUrl:m}}function Ke(l,o){const[u,r]=n.useState(null),[s,c]=Be(),a=s.get("importBoard"),{t:f}=w(),d=n.useCallback(()=>{r(null)},[]),p=n.useCallback(g=>{try{const m=JSON.parse(g);return Array.isArray(m)?m:null}catch{return null}},[]),h=n.useCallback(g=>{try{return g?JSON.parse(g):{}}catch{return{}}},[]),y=n.useCallback(async()=>{if(c({}),!a)return;const g=await oe(a);if(!g?.gameBoard)return r(f("failedBoardImport"));const m=p(g.gameBoard);if(!m)return r(f("failedBoardImport"));const x=g?.title!==f("settingsGenerated")?g.title:f("importedBoard");ae({...g,title:x,tiles:m,isActive:1});const j=h(g?.settings);o({...l,...j}),u!==f("updated")&&r(f("updated"))},[a,p,h,l,o,f,u,c]);return n.useEffect(()=>{a&&y()},[a,y]),[u,d]}const We=({selectedRoll:l,handleMenuItemClick:o})=>{const[u,r]=n.useState(!1),s=n.useRef(null),c=()=>{r(d=>!d)},a=d=>{d.target instanceof Node&&s.current?.contains(d.target)||r(!1)},f=new Map;return f.set("restart",A("restart")).set("manual",A("manual")).set("30",A("auto30")).set("60",A("auto60")).set("90",A("auto90")).set("custom",A("setTimer")),t.jsxs(t.Fragment,{children:[t.jsx(k,{size:"small","aria-controls":u?"split-button-menu":void 0,"aria-expanded":u?"true":void 0,"aria-label":"select roll options","aria-haspopup":"menu",onClick:c,ref:s,children:t.jsx(le,{})}),t.jsx(ue,{sx:{zIndex:1},open:u,anchorEl:s.current,transition:!0,disablePortal:!0,placement:"top-end",children:({TransitionProps:d})=>t.jsx(ce,{...d,style:{transformOrigin:"right bottom"},children:t.jsx(me,{children:t.jsx(de,{onClickAway:a,children:t.jsx(fe,{id:"split-button-menu",autoFocusItem:!0,children:Array.from(f).map(([p,h])=>t.jsx(pe,{selected:p===l,onClick:()=>o(p),children:h},p))})})})})})]})},B=10,qe=({isOpen:l,onClose:o,onSubmit:u})=>{const{t:r}=w(),[s,c]=n.useState(30),[a,f]=n.useState(!1),[d,p]=n.useState(!1),[h,y]=n.useState(20),[g,m]=n.useState(60),x=()=>{if(d){let e=Number.parseInt(String(h),10),i=Number.parseInt(String(g),10);Number.isNaN(e)?(e=a?1:B,y(e)):!a&&e<B&&(e=B),Number.isNaN(i)||i<e?(i=e,m(i)):i===0&&(i=180,m(i)),a&&(e*=60,i*=60);const M=Math.floor(Math.random()*(i-e+1))+e;u(M,{isRange:!0,min:e,max:i})}else{let e=Number.parseInt(String(s),10);Number.isNaN(e)?(e=a?1:B,c(e)):a?e*=60:e<B&&(e=B),u(e,{isRange:!1})}o()},j=()=>{c(e=>{const i=Number.parseFloat(String(e));return Number.isNaN(i)||i<=0?e:a?(i*60).toString():(i/60).toString()}),y(e=>{const i=Number.parseFloat(String(e));return Number.isNaN(i)||i<=0?e:a?(i*60).toString():(i/60).toString()}),m(e=>{const i=Number.parseFloat(String(e));return Number.isNaN(i)||i<=0?e:a?(i*60).toString():(i/60).toString()}),f(e=>!e)};return t.jsxs(ge,{open:l,onClose:o,maxWidth:"xs",children:[t.jsx(he,{children:r("setTimer")}),t.jsxs(xe,{children:[t.jsx(L,{sx:{mb:2},children:t.jsx(je,{control:t.jsx(be,{checked:d,onChange:e=>p(e.target.checked)}),label:r("useRandomRange")})}),d?t.jsxs(L,{children:[t.jsx(J,{variant:"subtitle2",children:r("randomTimerRange")}),t.jsxs(L,{sx:{display:"flex",gap:2,my:2},children:[t.jsx(O,{label:r("minValue"),type:"number",value:h,onChange:e=>{const i=parseInt(e.target.value,10);y(i)},fullWidth:!0}),t.jsx(J,{variant:"body1",sx:{alignSelf:"center"},children:"-"}),t.jsx(O,{label:r("maxValue"),type:"number",value:g,onChange:e=>{const i=parseInt(e.target.value,10);m(Math.max(Number(h),i))},fullWidth:!0})]}),t.jsxs(k,{onClick:j,variant:"outlined",size:"small",children:[r(a?"minutes":"seconds"),t.jsx(K,{sx:{ml:1}})]})]}):t.jsx(O,{autoFocus:!0,type:"number",value:s,onChange:e=>c(e.target.value),sx:{width:"15rem"},slotProps:{input:{endAdornment:t.jsx(Se,{position:"end",children:t.jsxs(k,{onClick:j,variant:"text",children:[r(a?"minutes":"seconds"),t.jsx(K,{sx:{ml:1}})]})})}}})]}),t.jsxs(ye,{children:[t.jsx(k,{onClick:o,children:r("cancel")}),t.jsx(k,{onClick:x,children:r("set")})]})]})};function He(l){return/^-?\d+$/.test(String(l))}function _(l,o,u){let r=0;for(let s=0;s<Number(l);s+=1)r+=Math.floor(Math.random()*Number(o))+1;u(r)}const Qe=n.memo(function({setRollValue:o,dice:u,isEndOfBoard:r}){const{t:s}=w(),[c,a]=n.useState(!1),[f,d]=n.useState("manual"),[p,h]=n.useState(0),[y,g]=n.useState(s("roll")),{timeLeft:m,setTimeLeft:x,togglePause:j,isPaused:e}=Ge(p),[i,M]=n.useState(!1),[b,N]=n.useState({isRange:!1,min:30,max:120}),T=n.useCallback(S=>{o(S)},[o]),[C,R]=u.split("d"),D=()=>{if(f==="manual"){_(C,R,T),a(!0),setTimeout(()=>a(!1),4e3);return}e&&m===p&&_(C,R,T),j()},I=n.useCallback(S=>{if(S==="restart"){T(-1);return}if(d(String(S)),S==="custom"){M(!0);return}if(He(S)){e||j();const v=Number(S);h(v),x(v)}},[e,x,j,T]),V=()=>{M(!1)},P=(S,v={isRange:!1})=>{e||j(),h(S),x(S),N({...b,...v}),d("custom"),M(!1)};return n.useEffect(()=>{r&&j()},[r,j]),n.useEffect(()=>{if(c)g(s("wait"));else if(f==="manual")g(s("roll"));else if(e)g(`${s("play")} (${m})`);else if(m>0)g(`${s("pause")} (${m})`);else if(m===0&&!e&&f!=="manual"){_(C,R,T);let S;if(b.isRange){const{min:v,max:Z}=b;S=Math.floor(Math.random()*(Z-v+1))+v}else S=p;h(S),x(S),g(`${s("pause")} (${S})`)}},[c,f,m,e,p,b,s,C,R,T,x]),t.jsxs(t.Fragment,{children:[t.jsxs(Te,{variant:"contained",className:"dice-roller",children:[t.jsxs(k,{"aria-label":s("roll"),onClick:D,disabled:c,size:"large",children:[t.jsx(Re,{sx:{mr:1}}),y]}),t.jsx(We,{selectedRoll:f,handleMenuItemClick:I})]}),t.jsx(qe,{isOpen:i,onClose:V,onSubmit:P})]})}),Ye=n.lazy(()=>F(()=>import("./index.tsx-DXjgNNtq.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18]))),Xe=n.lazy(()=>F(()=>import("./index.tsx-Bcb0bRNt.js"),__vite__mapDeps([19,1,2,3,4,10,8,9,17,5,6,7,11,12,13,14,15,16,18,20,21,22]))),Ze=n.lazy(()=>F(()=>import("./index.tsx-CsNITus3.js"),__vite__mapDeps([23,1,2,3,10,8,9,24,22])));function G(){return t.jsx(L,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100px",children:t.jsx(Me,{size:24})})}function Dt(){const l=ke(),o=l.id||"",u=_e(),{t:r}=w(),[s,c]=U();Ve(o,s?.roomRealtime);const[a,f]=n.useState({value:0,time:0}),d=Y(ie)?.tiles,p=n.useCallback(D=>{f({value:D,time:Date.now()})},[]),{playerList:h,tile:y}=ze(o,a,d),{roller:g,roomBgUrl:m}=Je(o,d),[x,j]=Ke(s,c);if(!d||!d.length||!Object.keys(s).length||E(o)&&!X(s.gameMode))return t.jsxs(t.Fragment,{children:[t.jsx(q,{room:l.id,playerList:h}),t.jsx(we,{open:!0})]});const{isVideo:e,url:i}=ve(s,o,m),M=e?"video-adjust":"",{background:b,roomBackground:N}=s,T=!E(o)&&N!=="app"||b!=="color",C=t.jsx(n.Suspense,{fallback:t.jsx(G,{}),children:t.jsx(Ze,{playerList:h,isTransparent:T,gameBoard:d,settings:s})}),R=t.jsx("div",{className:"messages-container",children:t.jsxs(n.Suspense,{fallback:t.jsx(G,{}),children:[t.jsx(Xe,{room:o,isTransparent:T,currentGameBoardSize:d.length}),t.jsx(Ce,{room:o,isTransparent:T})]})});return t.jsxs(t.Fragment,{children:[t.jsx(q,{room:o,playerList:h}),t.jsx(Qe,{setRollValue:p,dice:g,isEndOfBoard:y?.index!==void 0&&y.index>=(d?.length??0)-1}),t.jsx(De,{isVideo:e,url:i}),t.jsx($e,{}),u?t.jsx(n.Suspense,{fallback:t.jsx(G,{}),children:t.jsx(Ye,{tab1:C,tab2:R})}):t.jsxs(L,{className:`desktop-container ${M}`,children:[C,R]}),t.jsx(Ne,{}),t.jsx(H,{type:x===r("updated")?"success":"error",open:!!x,close:j,children:x})]})}export{Dt as default};
