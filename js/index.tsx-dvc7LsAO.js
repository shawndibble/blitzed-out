const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["js/chunk-BIxsdEWy.js","js/chunk-BHSFqGHu.js"])))=>i.map(i=>d[i]);
import{j as s,a3 as K,a4 as U,F as I,B as A,T,D as G,e as N}from"./chunk-N4nyP3yz.js";import{r as f,a as v}from"./chunk-BHSFqGHu.js";import{C as F}from"./chunk-DLz9Y0sc.js";import{u as W,C as H,G as J,h as P}from"./chunk-CwHqZEwd.js";import{c as V,e as q}from"./chunk-Bp62TkGl.js";import{u as B,T as D}from"./chunk-D_9T5wBr.js";import{u as z}from"./chunk-IQBevIgc.js";import{_ as Q,l as X,p as Y}from"../assets/index-BER_zc5T.js";import{u as Z}from"./chunk-C27ee37V.js";import{u as ee}from"./chunk-DbLlg4nu.js";import{u as te}from"./chunk-DWPmPthG.js";import"./chunk-CadZxfdX.js";import"./chunk-DazuHQxB.js";import"./chunk-By-oDuIf.js";import"./chunk-BpB-XA3T.js";import"./chunk-CNgNUes7.js";import"./chunk-D6tD9Wwo.js";import"./chunk-CZROAdFX.js";import"./chunk-B4PEA_xj.js";import"./chunk-Bde8qXua.js";import"./chunk-PurwGftr.js";const se=e=>({position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",maxWidth:800,bgcolor:"background.paper",border:"2px solid #000",boxShadow:24,p:4,[e.breakpoints.down("sm")]:{width:"90%"}});function ne({open:e,text:n="",displayName:t="",handleClose:a,stopAutoClose:c=()=>null,nextPlayer:u=null,isMyMessage:l=!1}){const{t:r}=B(),[m,g]=f.useState(!1),C=n?.match(/#\d*:.*(?=\n)/gs),w=V(n)||"",x=q(n,r("seconds")),{timeLeft:b,togglePause:i}=W(20,!1),[M,S]=f.useState(!0),p=u?.displayName,h=f.useCallback(()=>{i(),c(),S(!1)},[i,c,S]),o=f.useCallback(()=>{h(),g(!0)},[h]),k=f.useCallback(()=>{g(!1)},[]);return s.jsxs("div",{children:[s.jsx(K,{"aria-labelledby":"transition-modal-title","aria-describedby":"transition-modal-description",open:e,onClose:a,slots:{backdrop:U},slotProps:{backdrop:{timeout:500}},children:s.jsx(I,{in:e,children:s.jsxs(A,{sx:se,children:[s.jsx(T,{id:"transition-modal-title",variant:"h6",component:"h2",children:`${C} ${r("for")} ${t}`}),s.jsx(F,{close:a}),s.jsx(T,{id:"transition-modal-description",variant:"h4",sx:{mt:2},children:w}),s.jsx("br",{}),s.jsx(T,{variant:"caption",children:M?s.jsx(D,{i18nKey:"autoCloseModal",values:{timeLeft:b}}):s.jsx(D,{i18nKey:"autoCloseStopped"})}),s.jsx("br",{}),x?.length&&s.jsxs(s.Fragment,{children:[s.jsx(D,{i18nKey:"timers"}),x.map(j=>s.jsx(H,{textString:j,preventParentClose:h},j))]}),!!u&&s.jsxs(A,{textAlign:"center",children:[s.jsx(G,{style:{margin:"1rem 0 0.5rem"}}),s.jsx(T,{variant:"body1",children:u.isSelf?s.jsx(D,{i18nKey:"yourTurn"}):s.jsx(D,{i18nKey:"nextPlayersTurn",values:{player:p}})})]}),!!l&&n.includes(r("finish"))&&s.jsxs(A,{textAlign:"center",children:[s.jsx(G,{style:{margin:"1rem 0 0.5rem"}}),s.jsx(N,{onClick:o,children:s.jsx(T,{children:r("playAgain")})})]})]})})}),s.jsx(J,{isOpen:m,close:k})]})}const oe="/audio/roll-dice-DysgIh_A.mp3",ae="/audio/message-CBVROrdp.mp3";function E(){return E=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var a in t)({}).hasOwnProperty.call(t,a)&&(e[a]=t[a])}return e},E.apply(null,arguments)}function re(e,n){if(e==null)return{};var t={};for(var a in e)if({}.hasOwnProperty.call(e,a)){if(n.indexOf(a)!==-1)continue;t[a]=e[a]}return t}function ie(e){f.useEffect(e,[])}var le=["id","volume","playbackRate","soundEnabled","interrupt","onload"];function L(e,n){var t={},a=t.volume,c=a===void 0?1:a,u=t.playbackRate,l=u===void 0?1:u,r=t.soundEnabled,m=r===void 0?!0:r,g=t.interrupt,C=g===void 0?!1:g,w=t.onload,x=re(t,le),b=v.useRef(null),i=v.useRef(!1),M=v.useState(null),S=M[0],p=M[1],h=v.useState(null),o=h[0],k=h[1],j=function(){typeof w=="function"&&w.call(this),i.current&&p(this.duration()*1e3),k(this)};ie(function(){return Q(()=>import("./chunk-BIxsdEWy.js").then(d=>d.h),__vite__mapDeps([0,1])).then(function(d){if(!i.current){var R;b.current=(R=d.Howl)!==null&&R!==void 0?R:d.default.Howl,i.current=!0,new b.current(E({src:Array.isArray(e)?e:[e],volume:c,rate:l,onload:j},x))}}),function(){i.current=!1}}),v.useEffect(function(){b.current&&o&&k(new b.current(E({src:Array.isArray(e)?e:[e],volume:c,onload:j},x)))},[JSON.stringify(e)]),v.useEffect(function(){o&&(o.volume(c),x.sprite||o.rate(l))},[o,c,l]);var _=v.useCallback(function(d){typeof d>"u"&&(d={}),!(!o||!m&&!d.forceSoundEnabled)&&(C&&o.stop(),d.playbackRate&&o.rate(d.playbackRate),o.play(d.id))},[o,m,C]),y=v.useCallback(function(d){o&&o.stop(d)},[o]),O=v.useCallback(function(d){o&&o.pause(d)},[o]),$=[_,{sound:o,stop:y,pause:O,duration:S}];return $}function ue(e,n){const t=new SpeechSynthesisUtterance;t.text=e,t.pitch=.5;const a=()=>{const c=window.speechSynthesis.getVoices(),u=["Google UK English Male","Microsoft David - English (United States)","Microsoft Mark - English (United States)","Microsoft George - English (United Kingdom)","Daniel"];let l=c.find(r=>r.name===X[n]?.voice);if(!l){for(const r of u){const m=c.find(g=>g.name===r);if(m){l=m;break}}l||(l=c.find(r=>r.name.toLowerCase().includes("male")||r.name.includes("David")||r.name.includes("Mark")||r.name.includes("George")||r.name.includes("Daniel"))),!l&&c.length>0&&(l=c[0])}l&&(t.voice=l,console.log(`Using voice: ${l.name}`)),window.speechSynthesis.speak(t)};window.speechSynthesis.getVoices().length===0?window.speechSynthesis.onvoiceschanged=a:a()}function ce(){const{i18n:e}=B(),{user:n}=Z(),{messages:t}=ee(),[a,c]=f.useState(!1),[u]=L(oe),[l]=L(ae),[r]=z(),{playerDialog:m,othersDialog:g,mySound:C,otherSound:w,chatSound:x,readRoll:b}=r||{},i=f.useMemo(()=>[...t].pop(),[t]),M=f.useCallback((y,O)=>{y&&ue(y,O)},[]),S=f.useMemo(()=>{if(!i?.timestamp)return!1;const y=Y(i.timestamp);return y?P(y).diff(P(),"seconds")>=-2:!1},[i]),p=f.useMemo(()=>i?.uid===n?.uid,[i,n]),h=!!(m&&p),o=!!(g&&!p),k=(p&&C||!p&&w)&&i?.type==="actions",j=p&&b&&i?.type==="actions",_=x&&i?.type==="chat";return f.useEffect(()=>{if(P.locale(e.resolvedLanguage),S&&i?.type==="actions"&&(h||o)&&c(i),S&&i){if(k&&u(),j){const y=V(i?.text);M(y,e.resolvedLanguage||"en")}_&&l()}},[e.resolvedLanguage,i,p,h,o,k,j,_,u,l,M,S]),{message:a,setMessage:c,isMyMessage:!!p}}const Re=()=>{const{t:e}=B(),{message:n,setMessage:t,isMyMessage:a}=ce(),c=te(n),u=f.useRef(void 0);f.useEffect(()=>(n&&(u.current=setTimeout(()=>t(!1),21e3)),()=>{u.current&&clearTimeout(u.current)}),[n,t]);const l=f.useCallback(()=>{u.current&&clearTimeout(u.current),t(!1)},[t]),r=f.useCallback(()=>{u.current&&clearTimeout(u.current)},[]);return!n||typeof n!="object"||!n.text||n.text.includes(e("start"))?null:s.jsx(ne,{text:n?.text,displayName:n?.displayName,open:!0,handleClose:l,stopAutoClose:r,nextPlayer:c,isMyMessage:a})};export{Re as default};
