import{r as a,ad as F,au as E,j as e,am as m,Q as O,T as h,ar as I,ao as w,a1 as M}from"./chunk-DJZJtpVs.js";import{T as z}from"./chunk-9fkTg0gS.js";import{l as k}from"./chunk-mkkeerH0.js";import{b as H}from"./chunk-BNJImA7q.js";import{p as W,u as q,R as G}from"./chunk-ImvTYgsz.js";import{l as P}from"./chunk-FrR1vd25.js";import{g as N,i as V,h as $,q as K,r as Y,x as J}from"./chunk-B4ipE-Yx.js";import"./chunk-7OQk-BoX.js";import"./chunk-DEqUmdJg.js";import"../assets/index-wRvwaIV1.js";import"./chunk-DtF_b7C9.js";import"./chunk-B4PEA_xj.js";import"./chunk-yLOK5aTh.js";function Q(o){const u=k(o,"room");let c=!1,t="";if(u){const{roomBackgroundURL:g}=JSON.parse(u.settings),i=W(g);i?.isVideo&&(c=i.isVideo),i?.url&&(t=i.url)}return["color","gray"].some(g=>t.includes(g))&&(t=""),{isVideo:c,url:t}}function _(){const[o,u]=a.useState(document.fullscreenElement!=null);a.useEffect(()=>{const t=()=>{u(document.fullscreenElement!=null)};return document.addEventListener("fullscreenchange",t),()=>{document.removeEventListener("fullscreenchange",t)}},[]);const c=a.useCallback(()=>{document.fullscreenElement==null?document.documentElement.requestFullscreen().catch(t=>{console.error("Error attempting to enable fullscreen:",t)}):document.exitFullscreen().catch(t=>{console.error("Error attempting to exit fullscreen:",t)})},[]);return{isFullscreen:o,toggleFullscreen:c}}const X="actions",Z=o=>{const{text:u,displayName:c}=o;if(!c)return{};const t=u?.split(`
`),[g,i]=t?.slice(1)||[],b=g?.split(":")[1]?.trim(),n=i?.split(":")[1]?.trim();return{displayName:c,type:b,activity:n}};function me(){const{id:o}=F(),[u,c]=a.useState(""),[t,g]=a.useState(!1),[i,b]=a.useState(!1);try{console.log("=== CAST COMPONENT LOADED ==="),console.log("Room:",o),console.log("Window location:",window.location.href),console.log("User agent:",navigator.userAgent),console.log("Environment checks:",{isProduction:!0,hasConsole:typeof console<"u",hasAlert:typeof alert<"u",hasDocument:typeof document<"u",hasWindow:typeof window<"u",documentTitle:document.title,timestamp:new Date().toISOString()})}catch(r){typeof alert<"u"&&alert("Cast component loaded, room: "+o+" Error: "+r)}const{messages:n,isLoading:d}=H();console.log("=== HOOK RESULTS ==="),console.log("Messages loaded:",{messagesCount:n?.length||0,isLoading:d,firstMessage:n?.[0]||null,lastMessage:n?.[n.length-1]||null}),console.log("=== FIREBASE DEBUG ===");const y=N();console.log("Firebase auth current user:",{uid:y.currentUser?.uid||"none",isAnonymous:y.currentUser?.isAnonymous||!1,displayName:y.currentUser?.displayName||"none",authReady:!!y.currentUser});const{isVideo:A,url:x}=Q(n);console.log("Background info:",{isVideo:A,url:x||"none"});const f=k(n,X);console.log("Last action:",f||"none");const C=q(f);console.log("Next player:",C||"none");const{isFullscreen:S,toggleFullscreen:R}=_();if(console.log("Fullscreen status:",S),a.useEffect(()=>{const r=N();console.log("=== AUTH CHECK FOR CAST ==="),console.log("Current user:",r.currentUser?.uid||"none"),console.log("Is anonymous:",r.currentUser?.isAnonymous||!1);const p=r.onAuthStateChanged(s=>{console.log("=== AUTH STATE CHANGED ==="),console.log("New user:",s?.uid||"none"),console.log("Is anonymous:",s?.isAnonymous||!1),console.log("Display name:",s?.displayName||"none")});return r.currentUser?console.log("User already authenticated, proceeding..."):(console.log("No user found, attempting anonymous login..."),P("Cast Viewer").then(async s=>{if(console.log("Anonymous login successful:",s?.uid||"failed"),console.log("User details:",{uid:s?.uid,isAnonymous:s?.isAnonymous,displayName:s?.displayName}),s&&o){console.log("=== DIRECT FIREBASE TEST ===");try{const l=V(),B=$(l,"chat-rooms",o,"messages"),L=K(B,Y(5)),T=await J(L);console.log("Direct Firebase query successful, docs found:",T.size),T.forEach(j=>{console.log("Message found:",j.id,j.data().type)})}catch(l){console.error("Direct Firebase query failed:",l),l instanceof Error&&console.error("Error message:",l.message),l&&typeof l=="object"&&"code"in l&&console.error("Error code:",l.code)}}}).catch(s=>{console.error("Anonymous login failed:",s),console.error("Error details:",s.code,s.message)})),()=>p()},[o]),a.useEffect(()=>{const r=window.cast?.framework?.CastReceiverContext,p=navigator.userAgent,s=p.includes("CrKey")||p.includes("TV"),l=r||s||window.location.search.includes("chromecast");return console.log("Cast detection:",{isCastEnvironment:!!r,isChromecast:s,userAgent:p,isActuallyCasting:l,url:window.location.href}),l&&(document.body.classList.add("cast-receiver-mode"),document.body.classList.remove("theme-light"),b(!0),console.log("Cast receiver mode activated, light theme removed")),()=>{l&&(document.body.classList.remove("cast-receiver-mode"),console.log("Cast receiver mode deactivated"))}},[]),a.useEffect(()=>{if(console.log("=== LOADING STATE MONITOR ==="),console.log("isLoading changed to:",d),d){console.log("Still loading, skipping effects...");return}console.log("Loading finished, checking messages...");const r=n[n.length-1];r?.type==="settings"&&(g(!0),c(`${r.displayName} ${E("changedSettings")}`))},[n,d]),a.useEffect(()=>{if(!d)return;const r=setTimeout(()=>{console.log("=== LOADING TIMEOUT ==="),console.log("Messages have been loading for 10 seconds, this might indicate an auth issue")},1e4);return()=>clearTimeout(r)},[d]),console.log("=== RENDER STATE ==="),console.log("Cast render state:",{isLoading:d,messagesLength:n?.length||0,lastAction:!!f,room:o,isCastReceiver:i,url:window.location.href,windowDimensions:{width:window.innerWidth,height:window.innerHeight},bodyClasses:document.body.className,hasRoomBackground:!!x}),console.log("=== DOM DEBUG ==="),console.log("Document ready state:",document.readyState),console.log("Body background color:",getComputedStyle(document.body).backgroundColor),console.log("Cast container exists:",!!document.querySelector(".cast-container")),!f)return console.log("No lastAction found, showing fallback"),e.jsx("div",{style:{backgroundColor:"#000",color:"#fff",minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"24px",fontFamily:"Arial, sans-serif",textAlign:"center",padding:"20px"},children:e.jsxs("div",{children:[e.jsxs("div",{style:{fontSize:"48px",marginBottom:"20px"},children:["blitzedout.com/",o]}),e.jsx("div",{style:{fontSize:"24px"},children:d?"Loading...":"Waiting for game to start"}),e.jsxs("div",{style:{fontSize:"16px",marginTop:"20px",opacity:.7},children:["DEBUG: Cast fallback mode - Room: ",o," | Loading: ",d?"yes":"no"," | Messages: ",n?.length||0]}),e.jsxs("div",{style:{fontSize:"12px",marginTop:"10px",opacity:.5},children:["Time: ",new Date().toLocaleTimeString()," | UA: ",navigator.userAgent.substring(0,50),"..."]}),e.jsxs("div",{style:{fontSize:"12px",marginTop:"5px",opacity:.5},children:["Cast Receiver: ",i?"YES":"NO"," | Body Classes:"," ",document.body.className||"none"]})]})});const{displayName:D,type:U,activity:v}=Z(f);return e.jsxs(m,{className:"flex-column",style:{backgroundColor:i?"#000":"transparent",color:"white",minHeight:"100vh"},children:[!!x&&e.jsx(G,{url:x,isVideo:A}),e.jsxs(m,{display:"flex",justifyContent:"space-between",sx:{mx:2,mt:2,mb:-2},children:[e.jsx(m,{flex:"1",children:!i&&!S&&e.jsx(O,{variant:"text",onClick:R,style:{color:"white"},children:E("fullscreen")})}),e.jsx(m,{textAlign:"center",flex:"1",children:!!C?.displayName&&e.jsx(h,{variant:"h4",style:{color:"white",textShadow:"2px 2px 4px rgba(0,0,0,0.8)"},children:e.jsx(I,{i18nKey:"nextPlayersTurn",values:{player:C.displayName}})})},C?.displayName),e.jsx(m,{flex:"1",textAlign:"right",className:"text-stroke",children:v&&e.jsxs(h,{variant:"h4",style:{color:"white",textShadow:"2px 2px 4px rgba(0,0,0,0.8)"},children:["blitzedout.com/",o]})})]}),e.jsx(w,{container:!0,spacing:0,direction:"column",alignItems:"center",justifyContent:"center",className:"cast-container",style:{minHeight:"calc(100vh - 5rem)"},children:e.jsx(w,{container:!0,justifyContent:"center",children:v?e.jsxs(w,{size:12,className:"action-box",style:{backgroundColor:"rgba(0,0,0,0.7)",padding:"2rem",borderRadius:"0.5rem",maxWidth:"80%",margin:"0 auto"},children:[e.jsx(h,{variant:"h3",style:{color:"white",textShadow:"2px 2px 4px rgba(0,0,0,0.8)"},children:`${U} ${E("for")} ${D}`}),e.jsx(m,{className:"divider",style:{marginTop:"-0.5rem",height:"0.5rem",backgroundColor:"white",border:"2px solid black"},children:e.jsx(M,{})}),e.jsx(h,{variant:"h1",style:{color:"white",textShadow:"2px 2px 4px rgba(0,0,0,0.8)",fontWeight:600},children:v})]}):e.jsx("div",{className:"action-box",style:{backgroundColor:"rgba(0,0,0,0.7)",padding:"2rem",borderRadius:"0.5rem",maxWidth:"80%",margin:"0 auto"},children:e.jsxs(h,{variant:"h1",style:{color:"white",textShadow:"2px 2px 4px rgba(0,0,0,0.8)",fontWeight:600},children:["blitzedout.com/",o]})})})},n.length),e.jsx(z,{open:!!t,close:()=>g(!1),hideCloseButton:!0,children:e.jsx(h,{variant:"h5",style:{color:"white"},children:u})})]})}export{me as default};
