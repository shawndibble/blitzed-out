const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["js/index.tsx-DoXCFIoV.js","js/chunk-BCLv-HyH.js","js/chunk-C5tDN2aE.js","js/theme.tsx-CsQH-REL.js","assets/index-qeaY0Vv6.js","js/chunk-B4ipE-Yx.js","js/chunk-BqpKB5_W.js","js/chunk-BFxMm27G.js","js/chunk-DeLoLJoz.js","js/chunk-CJL0syeT.js","js/chunk-zIc7ftTo.js","js/chunk-CMqF3Rb8.js","js/schedule.tsx-D02jJJGN.js"])))=>i.map(i=>d[i]);
var et=Object.defineProperty;var tt=(e,t,r)=>t in e?et(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var N=(e,t,r)=>tt(e,typeof t!="symbol"?t+"":t,r);import{_ as H,A as me}from"../assets/index-qeaY0Vv6.js";import{aa as re,r as A,j as C,a7 as rt}from"./chunk-BCLv-HyH.js";import{g as b,E as nt,l as st,s as Oe,a as ot,u as ye,c as at,G as it,b as ct,d as ut,e as lt,f as oe,h as B,i as Be,T as dt,j as mt,k as ft,m as z,n as Le,o as gt,q as V,w as K,p as ne,r as se,t as ke,v as Re,x as yt,y as ht,z as pt,A as wt,B as At,C as ae}from"./chunk-B4ipE-Yx.js";import{r as vt,D as bt,n as qe,a as St}from"./chunk-C5tDN2aE.js";class J extends Error{constructor(t,r,s){super(t),this.code=r,this.cause=s,this.name="AppError"}}class Q extends J{constructor(t,r,s){super(t,r,s),this.name="AuthError"}}function Fe(e){return e instanceof J}function he(e){return e instanceof Error}function O(e){return he(e)?e.message:typeof e=="string"?e:"An unknown error occurred"}function Et(e){if(Fe(e)||he(e)&&"code"in e)return e.code}function $(e,t="An unexpected error occurred"){return Fe(e)?e:he(e)?new J(e.message||t,void 0,e):typeof e=="string"?new J(e):new J(t)}const Te={"auth/user-not-found":"No account found with this email address","auth/wrong-password":"Incorrect password","auth/email-already-in-use":"An account with this email already exists","auth/weak-password":"Password is too weak","auth/invalid-email":"Invalid email address","auth/too-many-requests":"Too many login attempts. Please try again later","auth/network-request-failed":"Network error. Please check your connection","permission-denied":"You do not have permission to perform this action",unavailable:"Service is temporarily unavailable. Please try again"};function W(e){const t=Et(e);return t&&Te[t]?Te[t]:O(e)}var Tt=vt();const Ne={apiKey:"AIzaSyCKS7tWQRYRWHsawNfN42uAmISdUbJHJJw",authDomain:"blitzout-49b39.firebaseapp.com",projectId:"blitzout-49b39",storageBucket:"blitzout-49b39.appspot.com",messagingSenderId:"852428606926",appId:"1:852428606926:web:17444e6f8dbc2f95f0ef9f",measurementId:"G-93YN1YMTQ7"},Ce=Object.entries(Ne).filter(([e,t])=>!t).map(([e])=>e);Ce.length>0&&(console.error("Missing Firebase environment variables:",Ce),console.error("Please check your .env file and ensure all VITE_FIREBASE_* variables are set"));const Ct=gt(Ne),M=Be(Ct);async function Dt(e=""){try{const t=b();return await lt(t),t.currentUser?(await ye(t.currentUser,{displayName:e}),t.currentUser):null}catch(t){throw console.error("Anonymous login error:",t),new Q(W(t),"ANONYMOUS_LOGIN_FAILED",$(t))}}async function _t(e,t,r=""){try{const s=b(),n=await at(s,e,t);return await ye(n.user,{displayName:r}),n.user}catch(s){throw console.error("Registration error:",s),new Q(W(s),"REGISTRATION_FAILED",$(s))}}async function It(e,t){try{const r=b();return(await ut(r,e,t)).user}catch(r){throw console.error("Email login error:",r),new Q(W(r),"EMAIL_LOGIN_FAILED",$(r))}}async function Mt(){try{const e=b(),t=new it;return(await ct(e,t)).user}catch(e){throw console.error("Google login error:",e),new Q(W(e),"GOOGLE_LOGIN_FAILED",$(e))}}async function Pt(e){try{const t=b();return await ot(t,e),!0}catch(t){throw console.error("Password reset error:",t),new Q(W(t),"PASSWORD_RESET_FAILED",$(t))}}async function Gt(e,t){try{const s=b().currentUser;if(s?.isAnonymous){const n=nt.credential(e,t);return(await st(s,n)).user}else throw new Error("User is not anonymous or not logged in")}catch(r){throw console.error("Account conversion error:",r),new Q(W(r),"ACCOUNT_CONVERSION_FAILED",$(r))}}async function xt(){try{const e=b();return await Oe(e),!0}catch(e){throw console.error(e),e}}async function Ut(){try{const e=b();await Oe(e),["gameSettings","messages-storage","i18nextLng","blitzed-out-action-groups-migration","blitzed-out-background-migration","blitzed-out-migration-in-progress","blitzed-out-current-language-migration","blitzed-out-background-migration-in-progress","blitzed-out-migration-health"].forEach(n=>{try{localStorage.removeItem(n)}catch(o){console.warn(`Failed to remove localStorage key: ${n}`,o)}});const r=["gameSettings","messages-storage","blitzed-out-"];Object.keys(localStorage).forEach(n=>{if(r.some(o=>n.startsWith(o)))try{localStorage.removeItem(n)}catch(o){console.warn(`Failed to remove localStorage key: ${n}`,o)}});try{sessionStorage.clear()}catch(n){console.warn("Failed to clear sessionStorage:",n)}try{const{default:n}=await H(async()=>{const{default:o}=await Promise.resolve().then(()=>Ht);return{default:o}},void 0);await n.delete(),console.log("Successfully cleared IndexedDB")}catch(n){console.warn("Failed to clear IndexedDB:",n)}["i18next"].forEach(n=>{try{document.cookie=`${n}=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;`}catch(o){console.warn(`Failed to clear cookie: ${n}`,o)}}),console.log("Successfully wiped all app data")}catch(e){throw console.error("Error wiping app data:",e),e}}function xr(e,t,r={},s={}){if(!e)return;const{enableCache:n=!0,enableDebounce:o=!0}=s,a=e.toUpperCase(),c=we("userList",a),i=Date.now();if(n){const u=D.get(c);if(u&&Ae(u,c)){u.queryCount++,D.set(c,u),_(c,Date.now()-i,!0);const l=Object.keys(u.data).sort().join(","),w=r?Object.keys(r).sort().join(","):"";l!==w&&t(u.data);return}}const m=async()=>{let u=!1;try{await ie();const l=pt(),w=wt(l,"users");At(w,h=>{const S=Date.now(),d=S-i,E=h.val();if(!E){t({});return}const T={};Object.entries(E).forEach(([U,I])=>{I.room===a&&(T[U]={displayName:I.displayName,uid:U,lastSeen:I.lastSeen?new Date(I.lastSeen):new Date,isAnonymous:I.isAnonymous,joinedAt:I.joinedAt?new Date(I.joinedAt):new Date,room:I.room})});const y=T;if(n){pe();const U=X(c);D.set(c,{data:y,timestamp:S,queryCount:1,priority:U})}_(c,d,!1,u);const v=Object.keys(y).sort().join(","),x=r?Object.keys(r).sort().join(","):"";v!==x&&t(y)},h=>{u=!0,console.error("getUserList error:",h),_(c,Date.now()-i,!1,!0)})}catch(l){u=!0,console.error("getUserList connection error:",l),_(c,Date.now()-i,!1,!0)}finally{ce()}};o?ve(c,m):m()}async function Ot(e=""){try{const t=b();return t.currentUser?(await ye(t.currentUser,{displayName:e}),t.currentUser):null}catch(t){return console.error(t),null}}async function Ur(e,t){try{await oe(B(M,"custom-actions"),{grouping:e,customAction:t,ttl:new Date(Date.now()+5760*60*1e3)})}catch(r){console.error(r)}}async function Bt(e){const t=V(B(M,"game-boards"),K("checksum","==",e)),r=await yt(t);return r.size?r.docs[0]:null}async function Or({title:e,gameBoard:t,settings:r}){if(e)try{const s=Tt.sha256(t),n=await Bt(s);return n?(ft(n.ref,{ttl:new Date(Date.now()+720*60*60*1e3)}),n):await Lt({title:e,gameBoard:t,settings:r,checksum:s})}catch(s){console.error(s)}}async function Lt({title:e,gameBoard:t,settings:r,checksum:s}){try{return await oe(B(M,"game-boards"),{title:e,gameBoard:t,settings:r,checksum:s,ttl:new Date(Date.now()+720*60*60*1e3)})}catch(n){console.error(n);return}}async function Br(e){try{const t=z(M,"game-boards",e),r=await Le(t);return r.exists()?r.data():void 0}catch(t){console.error(t);return}}let De={};const D=new Map,j=new Map,_e=15e3,kt=5e3,Ie=150,Rt=50,je=50,qt=100,q={activeConnections:0,maxConnections:15,connectionQueue:[]},Me=new Map;function _(e,t,r,s=!1){const n=Me.get(e)||{queryCount:0,totalLatency:0,cacheHits:0,lastQueryTime:0,avgLatency:0,p95Latency:0,connectionPoolHits:0,networkErrors:0,latencyHistory:[]};if(n.queryCount++,n.totalLatency+=t,n.lastQueryTime=Date.now(),n.avgLatency=n.totalLatency/n.queryCount,n.latencyHistory.push(t),n.latencyHistory.length>20&&n.latencyHistory.shift(),n.latencyHistory.length>=5){const o=[...n.latencyHistory].sort((c,i)=>c-i),a=Math.floor(o.length*.95);n.p95Latency=o[a]}r&&n.cacheHits++,s&&n.networkErrors++,Me.set(e,n)}function X(e){return e.includes("messages")?"high":e.includes("userList")?"medium":"low"}function Ft(e){switch(e){case"high":return kt;case"medium":return _e;case"low":return _e*2}}function Nt(e){switch(e){case"high":return Rt;case"medium":return Ie;case"low":return Ie*2}}function pe(){if(D.size<=qt)return;const e=Array.from(D.entries());e.sort(([,r],[,s])=>{const n={low:0,medium:1,high:2},o=n[r.priority]-n[s.priority];if(o!==0)return o;const a=r.queryCount-s.queryCount;return a!==0?a:r.timestamp-s.timestamp});const t=Math.ceil(D.size*.2);for(let r=0;r<t;r++)D.delete(e[r][0])}function ie(){return new Promise(e=>{q.activeConnections<q.maxConnections?(q.activeConnections++,e()):q.connectionQueue.push(()=>{q.activeConnections++,e()})})}function ce(){if(q.activeConnections--,q.connectionQueue.length>0){const e=q.connectionQueue.shift();e&&e()}}function we(e,t,r){return`${e}:${t||"global"}:${r||""}`}function Ae(e,t){const r=X(t),s=Ft(r);return Date.now()-e.timestamp<s}function ve(e,t,...r){const s=X(e),n=Nt(s),o=j.get(e);o&&clearTimeout(o);const a=setTimeout(async()=>{try{await ie(),t(...r)}catch(c){console.error("Query execution error:",c)}finally{ce(),j.delete(e)}},n);j.set(e,a)}async function Lr({room:e,user:t,text:r="",type:s="chat",...n}){const o=["chat","actions","settings","room","media"];if(!o.includes(s)){let m="Invalid message type. Was expecting ";return m+=o.join(", "),m+=` but got ${s}`,console.error(m)}if(!t?.uid)return;const a={room:e,user:t.uid,text:r,type:s,...n};if(JSON.stringify(a)===JSON.stringify(De))return;De=a;const c=Date.now(),i=e?.toUpperCase()||"PUBLIC";try{return await oe(B(M,"chat-rooms",i,"messages"),{text:r.trim(),ttl:new Date(c+864e5),type:s,...n,uid:t.uid,displayName:t.displayName,timestamp:mt()})}catch(m){console.error("Failed to send message:",m);return}}async function kr(e,t){return ht(z(M,`/chat-rooms/${e.toUpperCase()}/messages/${t}`))}function Rr(e,t,r={}){if(!e)return;const s=b();if(!s.currentUser){let n,o;return n=s.onAuthStateChanged(a=>{a&&(o=Pe(e,t,r),n&&(n(),n=void 0))}),()=>{n&&n(),o&&o()}}return Pe(e,t,r)}function Pe(e,t,r={}){const{limitCount:s=je,startAfterDoc:n,enableCache:o=!0,enableDebounce:a=!0}=r,c=e.toUpperCase(),i=we("messages",c,`limit:${s}`),m=Date.now();if(o){const l=D.get(i);if(l&&Ae(l,i))return l.queryCount++,D.set(i,l),_(i,Date.now()-m,!0),t(l.data),()=>{}}const u=()=>{let l=!1,w;try{ie();const h=new Date;h.setHours(h.getHours()-3);let S=V(B(M,"chat-rooms",c,"messages"),K("timestamp",">",h),ne("timestamp","desc"),se(s));return n&&(S=V(B(M,"chat-rooms",c,"messages"),K("timestamp",">",h),ne("timestamp","desc"),ke(n),se(s))),w=Re(S,d=>{const E=Date.now(),T=E-m,y=d.docs.map(v=>({id:v.id,...v.data()}));if(o&&y.length>0){pe();const v=d.docs[d.docs.length-1],x=X(i);D.set(i,{data:y,timestamp:E,lastVisible:v,queryCount:1,priority:x})}_(i,T,!1,l),t(y)},d=>{l=!0,console.error("getMessages error:",d),_(i,Date.now()-m,!1,!0)}),w}catch(h){return l=!0,console.error("getMessages connection error:",h),_(i,Date.now()-m,!1,!0),()=>{}}finally{ce()}};if(a){let l;return ve(i,()=>{l=u()}),()=>{const w=j.get(i);w&&(clearTimeout(w),j.delete(i)),l&&l()}}return u()}function qr(e,t={}){const{limitCount:r=je,startAfterDoc:s,enableCache:n=!0,enableDebounce:o=!0}=t,a=we("schedule",null,`limit:${r}`),c=Date.now();if(n){const u=D.get(a);if(u&&Ae(u,a))return u.queryCount++,D.set(a,u),_(a,Date.now()-c,!0),e(u.data),()=>{}}const i=async()=>{let u=!1,l;try{await ie();const w=new Date;w.setMinutes(w.getMinutes()-5);let h=V(B(M,"schedule"),K("dateTime",">",w),ne("dateTime","asc"),se(r));return s&&(h=V(B(M,"schedule"),K("dateTime",">",w),ne("dateTime","asc"),ke(s),se(r))),l=Re(h,S=>{const d=Date.now(),E=d-c,T=S.docs.map(y=>({id:y.id,...y.data()}));if(n&&T.length>0){pe();const y=S.docs[S.docs.length-1],v=X(a);D.set(a,{data:T,timestamp:d,lastVisible:y,queryCount:1,priority:v})}_(a,E,!1,u),e(T)},S=>{u=!0,console.error("getSchedule error:",S),_(a,Date.now()-c,!1,!0)}),l||(()=>{})}catch(w){return u=!0,console.error("getSchedule connection error:",w),_(a,Date.now()-c,!1,!0),()=>{}}finally{ce()}};if(o){let u;return ve(a,async()=>{u=await i()}),()=>{const l=j.get(a);l&&(clearTimeout(l),j.delete(a)),u&&u()}}const m=i();return m instanceof Promise?()=>{}:m}async function Fr(e,t,r="PUBLIC"){try{return await oe(B(M,"schedule"),{dateTime:dt.fromDate(e),url:t,room:r})}catch(s){return console.error(s)}}function jt(e={tables:["customTiles","gameBoard"]}){const{tables:t}=e,r=new Set(t),s={timeouts:{},queue:new Set,scheduleSync(n){this.timeouts[n]&&clearTimeout(this.timeouts[n]),this.queue.add(n),this.timeouts[n]=setTimeout(()=>{this.processSyncQueue()},2e3)},processSyncQueue(){if(this.queue.size===0)return;const n=window;n.authContext?.user&&!n.authContext.user.isAnonymous&&n.authContext.syncData(),this.queue.clear(),Object.keys(this.timeouts).forEach(o=>{clearTimeout(this.timeouts[o]),delete this.timeouts[o]})}};return{stack:"dbcore",name:"syncMiddleware",create(n){return{...n,table(o){const a=n.table(o);return r.has(o)?{...a,mutate:async c=>{const i=await a.mutate(c);return["put","add","delete","deleteRange","update"].includes(c.type)&&s.scheduleSync(o),i}}:a}}}}}class zt extends bt{constructor(){super("blitzedOut");N(this,"customTiles");N(this,"gameBoard");N(this,"customGroups");N(this,"localPlayerSessions");N(this,"localPlayerMoves");N(this,"localPlayerStats");this.version(2).stores({customTiles:"++id, group, intensity, action, isEnabled, tags, gameMode, isCustom, locale",gameBoard:"++id, title, tiles, tags, gameMode, isActive"}),this.version(3).stores({customTiles:"++id, group, intensity, action, isEnabled, tags, gameMode, isCustom, locale",gameBoard:"++id, title, tiles, tags, gameMode, isActive",customGroups:"++id, name, label, locale, gameMode, isDefault, createdAt"}),this.version(4).stores({customTiles:"++id, group, intensity, action, isEnabled, tags, gameMode, isCustom, locale",gameBoard:"++id, title, tiles, tags, gameMode, isActive",customGroups:"++id, name, label, locale, gameMode, isDefault, createdAt, [name+locale+gameMode]"}).upgrade(async r=>{const s=await r.table("customGroups").toArray(),n=new Set;for(const o of s){const a=`${o.name}-${o.locale}-${o.gameMode}`;n.has(a)?await r.table("customGroups").delete(o.id):n.add(a)}}),this.version(5).stores({customTiles:"++id, group, intensity, action, isEnabled, tags, gameMode, isCustom, locale",gameBoard:"++id, title, tiles, tags, gameMode, isActive",customGroups:"++id, name, label, locale, gameMode, isDefault, createdAt, [name+locale+gameMode]",localPlayerSessions:"++id, sessionId, roomId, isActive, createdAt, updatedAt",localPlayerMoves:"++id, sessionId, playerId, timestamp, sequence",localPlayerStats:"++id, sessionId, playerId, lastActive"})}}const F=new zt;F.use(jt({tables:["customTiles","gameBoard","customGroups","localPlayerSessions","localPlayerMoves","localPlayerStats"]}));const Ht=Object.freeze(Object.defineProperty({__proto__:null,default:F},Symbol.toStringTag,{value:"Module"})),{customTiles:G}=F;G.hook("creating",function(e,t,r){t.locale===void 0&&(t.locale="en"),t.gameMode===void 0&&(t.gameMode="online"),t.isCustom===void 0&&(t.isCustom=1)});const Qt=async e=>{const t=e.map(r=>({...r,isEnabled:1}));return await G.bulkAdd(t)},ze=e=>{const t=["locale","gameMode","group","intensity","tag","isCustom","action"];let r=G.toCollection();return Object.entries(e).filter(([n])=>t.includes(n)).forEach(([n,o])=>{o==null||o===""||(n==="tag"?r=r.filter(a=>a.tags.includes(o)):r=r.filter(a=>a[n]===o))}),r},be=async(e={})=>{try{return await ze(e).toArray()}catch(t){return console.error("Error in getTiles:",t),[]}},$t=async e=>{const{page:t=1,limit:r=50}=e;try{const s=ze(e),n=await s.count(),o=(t-1)*r;return{items:await s.offset(o).limit(r).toArray(),total:n,page:t,limit:r,totalPages:Math.ceil(n/r)}}catch(s){return console.error("Error in getPaginatedTiles:",s),{items:[],total:0,page:t,limit:r,totalPages:0}}},He=(e="en",t="online")=>G.where("locale").equals(e).and(r=>r.gameMode===t),Wt=async(e="en",t="online",r=null)=>{let s=He(e,t);return r&&(s=s.and(o=>o.tags.some(a=>r.includes(a)))),(await s.toArray()).reduce((o,a)=>{const c=a.group;o[c]||(o[c]={count:0,intensities:{}}),o[c].count++;const i=Number(a.intensity);return o[c].intensities[i]||(o[c].intensities[i]=0),o[c].intensities[i]++,o},{})},Yt=(e=null)=>{const t=re.resolvedLanguage||re.language||"en";let r=G.where("locale").equals(t).and(s=>s.isEnabled===1);return e&&(r=r.and(s=>s.gameMode===e)),r.toArray()},Qe=async e=>await G.add({...e,isEnabled:1}),Jt=async(e,t)=>await G.update(e,t),Vt=async e=>{const t=await G.get(e);if(!t)throw new Error(`Custom tile with id ${e} not found`);return await G.update(e,{isEnabled:t.isEnabled?0:1})};async function $e(){try{return await F.customTiles.where("isCustom").equals(1).delete(),!0}catch(e){return console.error("Error deleting custom tiles:",e),!1}}const Kt=async e=>{await G.delete(e)},We=(e,t="en",r="online")=>He(t,r).and(s=>s.group===e),Xt=async(e,t="en",r="online")=>{try{return await We(e,t,r).count()}catch(s){return console.error("Error counting tiles by group:",s),0}},Zt=async(e,t="en",r="online")=>{try{return await We(e,t,r).delete()}catch(s){return console.error("Error deleting tiles by group:",s),0}},Nr=Object.freeze(Object.defineProperty({__proto__:null,addCustomTile:Qe,countTilesByGroup:Xt,deleteAllIsCustomTiles:$e,deleteCustomTile:Kt,deleteCustomTilesByGroup:Zt,getActiveTiles:Yt,getPaginatedTiles:$t,getTileCountsByGroup:Wt,getTiles:be,importCustomTiles:Qt,toggleCustomTile:Vt,updateCustomTile:Jt},Symbol.toStringTag,{value:"Module"})),{customGroups:k}=F;k.hook("creating",function(e,t,r){t.id||(t.id=qe()),t.locale===void 0&&(t.locale=re.resolvedLanguage||re.language||"en"),t.gameMode===void 0&&(t.gameMode="online"),t.isDefault===void 0&&(t.isDefault=!1);const s=new Date;t.createdAt||(t.createdAt=s),t.updatedAt=s});k.hook("updating",function(e,t,r,s){e.updatedAt=new Date});const er=e=>{const t=["locale","gameMode","name","isDefault"];let r=k.toCollection();return Object.entries(e).filter(([n])=>t.includes(n)).forEach(([n,o])=>{o==null||o===""||(r=r.filter(a=>a[n]===o))}),r},ue=async(e={})=>{try{return await er(e).toArray()}catch(t){return console.error("Error in getCustomGroups:",t),[]}},Se=async(e,t="en",r="online")=>{try{return await k.where("name").equals(e).and(s=>s.locale===t&&s.gameMode===r).first()}catch(s){console.error("Error in getCustomGroupByName:",s);return}},tr=async e=>{try{const t={...e,createdAt:new Date,updatedAt:new Date};return await k.add(t)}catch(t){console.error("Error in addCustomGroup:",t);return}},rr=async(e,t)=>{try{return await k.update(e,t)}catch(r){return console.error("Error in updateCustomGroup:",r),0}},Ye=async e=>{try{await k.delete(e)}catch(t){console.error("Error in deleteCustomGroup:",t)}},Je=async()=>{try{return await k.clear(),!0}catch(e){return console.error("Error deleting all custom groups:",e),!1}},Ve=async e=>{try{const t=new Date,r=e.map(s=>({name:s.name||"",label:s.label||"",intensities:s.intensities||[],id:s.id||qe(),locale:s.locale||"en",gameMode:s.gameMode||"online",isDefault:s.isDefault||!1,createdAt:s.createdAt||t,updatedAt:s.updatedAt||t}));return await k.bulkAdd(r)}catch(t){console.error("Error in importCustomGroups:",t);return}},nr=async(e,t="en",r="online")=>{try{return(await Se(e,t,r))?.intensities||[]}catch(s){return console.error("Error in getGroupIntensities:",s),[]}},sr=async(e,t="en",r="online",s)=>{try{const n=await Se(e,t,r);return!!(!n||s&&n.id===s)}catch(n){return console.error("Error in isGroupNameUnique:",n),!1}},Ke=async(e="en",t="online")=>{try{const r=await ue({locale:e,gameMode:t}),s=new Map;r.forEach(o=>{const a=s.get(o.name)||[];a.push(o),s.set(o.name,a)});let n=0;for(const[,o]of s)if(o.length>1){o.sort((a,c)=>{try{const i=a.createdAt instanceof Date?a.createdAt.getTime():new Date(a.createdAt).getTime(),m=c.createdAt instanceof Date?c.createdAt.getTime():new Date(c.createdAt).getTime();return i-m}catch(i){return console.warn("Date parsing failed in removeDuplicateGroups, using createdAt fallback:",i),a.createdAt.getTime()-c.createdAt.getTime()}});for(let a=1;a<o.length;a++)await Ye(o[a].id),n++}return n}catch(r){return console.error("Error in removeDuplicateGroups:",r),0}},or=async(e="en",t="online")=>{try{return await Ke(e,t),(await ue({locale:e,gameMode:t})).filter((n,o,a)=>a.findIndex(c=>c.name===n.name)===o)}catch(r){return console.error("❌ getAllAvailableGroups: Database error",{locale:e,gameMode:t,error:r}),[]}},jr=Object.freeze(Object.defineProperty({__proto__:null,addCustomGroup:tr,deleteAllCustomGroups:Je,deleteCustomGroup:Ye,getAllAvailableGroups:or,getCustomGroupByName:Se,getCustomGroups:ue,getGroupIntensities:nr,importCustomGroups:Ve,isGroupNameUnique:sr,removeDuplicateGroups:Ke,updateCustomGroup:rr},Symbol.toStringTag,{value:"Module"})),{gameBoard:L}=F,ar=()=>L.orderBy("title").toArray(),zr=async()=>L.where("isActive").equals(1)?.first(),ir=async e=>L.add(e),cr=async(e,t)=>L.update(e.id,{...e,...t}),ur=async e=>{const t={title:e.title===void 0?"":e.title,tiles:e.tiles||[],isActive:e.isActive===void 0?1:e.isActive,tags:e.tags||[],gameMode:e.gameMode||"online"};if(!t?.title?.length&&t?.tiles?.length)return;const r=await L.where("title").equals(t.title).first();return F.transaction("rw",F.gameBoard,async()=>(t.isActive&&await lr(),r?(await cr(r,e),r.id):await ir(t)))},Hr=async e=>{const r=(await L.toArray()).map(s=>({...s,isActive:s.id===e?1:0}));await L.bulkPut(r)},Qr=async e=>{await L.delete(e)},lr=async()=>{await L.where("isActive").equals(1).modify({isActive:0})};function dr(e,t){let r;try{r=e()}catch{return}return{getItem:n=>{var o;const a=i=>i===null?null:JSON.parse(i,void 0),c=(o=r.getItem(n))!=null?o:null;return c instanceof Promise?c.then(a):a(c)},setItem:(n,o)=>r.setItem(n,JSON.stringify(o,void 0)),removeItem:n=>r.removeItem(n)}}const fe=e=>t=>{try{const r=e(t);return r instanceof Promise?r:{then(s){return fe(s)(r)},catch(s){return this}}}catch(r){return{then(s){return this},catch(s){return fe(s)(r)}}}},mr=(e,t)=>(r,s,n)=>{let o={storage:dr(()=>localStorage),partialize:d=>d,version:0,merge:(d,E)=>({...E,...d}),...t},a=!1;const c=new Set,i=new Set;let m=o.storage;if(!m)return e((...d)=>{console.warn(`[zustand persist middleware] Unable to update item '${o.name}', the given storage is currently unavailable.`),r(...d)},s,n);const u=()=>{const d=o.partialize({...s()});return m.setItem(o.name,{state:d,version:o.version})},l=n.setState;n.setState=(d,E)=>{l(d,E),u()};const w=e((...d)=>{r(...d),u()},s,n);n.getInitialState=()=>w;let h;const S=()=>{var d,E;if(!m)return;a=!1,c.forEach(y=>{var v;return y((v=s())!=null?v:w)});const T=((E=o.onRehydrateStorage)==null?void 0:E.call(o,(d=s())!=null?d:w))||void 0;return fe(m.getItem.bind(m))(o.name).then(y=>{if(y)if(typeof y.version=="number"&&y.version!==o.version){if(o.migrate){const v=o.migrate(y.state,y.version);return v instanceof Promise?v.then(x=>[!0,x]):[!0,v]}console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,y.state];return[!1,void 0]}).then(y=>{var v;const[x,U]=y;if(h=o.merge(U,(v=s())!=null?v:w),r(h,!0),x)return u()}).then(()=>{T?.(h,void 0),h=s(),a=!0,i.forEach(y=>y(h))}).catch(y=>{T?.(void 0,y)})};return n.persist={setOptions:d=>{o={...o,...d},d.storage&&(m=d.storage)},clearStorage:()=>{m?.removeItem(o.name)},getOptions:()=>o,rehydrate:()=>S(),hasHydrated:()=>a,onHydrate:d=>(c.add(d),()=>{c.delete(d)}),onFinishHydration:d=>(i.add(d),()=>{i.delete(d)})},o.skipHydration||S(),h||w},fr=mr,Ge={locale:"en",gameMode:"online",boardUpdated:!1,room:"PUBLIC",background:"color",roomBackground:"useAppBackground",selectedActions:{},hasSeenRollButton:!1,themeMode:"system"},Z=St()(fr(e=>({settings:Ge,updateSettings:t=>e(r=>({settings:{...r.settings,...t}})),setLocale:t=>e(r=>({settings:{...r.settings,locale:t}})),resetSettings:()=>e({settings:Ge}),updateSelectedAction:(t,r)=>e(s=>{const n={...s.settings.selectedActions};return r===null?delete n[t]:n[t]=r,{settings:{...s.settings,selectedActions:n}}}),removeSelectedAction:t=>e(r=>{const s={...r.settings.selectedActions};return delete s[t],{settings:{...r.settings,selectedActions:s}}}),clearSelectedActions:()=>e(t=>({settings:{...t.settings,selectedActions:{}}})),getSelectedActionsByType:t=>{const{selectedActions:r={}}=Z.getState().settings;return Object.entries(r||{}).filter(([,n])=>n.type===t).reduce((n,[o,a])=>(n[o]=a,n),{})}}),{name:"gameSettings",partialize:e=>({settings:e.settings})})),$r=()=>{const{settings:e,updateSettings:t}=Z();return[e,t]},Wr=()=>{const{settings:e,updateSettings:t}=Z();return{settings:e,updateSettings:t}},Yr="None",Jr=3e4,xe=500,ee=Be();async function gr(){const t=b().currentUser;if(!t)return console.error("No user logged in"),!1;try{const r=await be({isCustom:1});return await ae(z(ee,"user-data",t.uid),{customTiles:r,lastUpdated:new Date},{merge:!0}),!0}catch(r){return console.error("Error syncing custom tiles:",r),!1}}async function yr(){const t=b().currentUser;if(!t)return console.error("No user logged in"),!1;try{const r=await ue();return await ae(z(ee,"user-data",t.uid),{customGroups:r,lastUpdated:new Date},{merge:!0}),!0}catch(r){return console.error("Error syncing custom groups:",r),!1}}async function hr(){const t=b().currentUser;if(!t)return console.error("No user logged in"),!1;try{const r=await ar();return r.length&&await ae(z(ee,"user-data",t.uid),{gameBoards:r,lastUpdated:new Date},{merge:!0}),!0}catch(r){return console.error("Error syncing game boards:",r),!1}}async function pr(){const t=b().currentUser;if(!t)return console.error("No user logged in"),!1;try{const{settings:r}=Z.getState(),{localPlayers:s,...n}=r;return await ae(z(ee,"user-data",t.uid),{settings:n,lastUpdated:new Date},{merge:!0}),!0}catch(r){return console.error("Error syncing settings:",r),!1}}async function de(){return await gr(),await yr(),await hr(),await pr(),!0}async function ge(){const t=b().currentUser;if(!t)return console.error("No user logged in"),!1;try{const r=z(ee,"user-data",t.uid),s=await Le(r);if(!s.exists())return!1;const n=s.data();if(n.customTiles!==void 0&&(await $e(),await new Promise(o=>setTimeout(o,xe)),n.customTiles&&n.customTiles.length>0))for(const o of n.customTiles)try{(await be({gameMode:o.gameMode,group:o.group,intensity:o.intensity,action:o.action})).length===0&&await Qe(o)}catch(a){console.error("Error importing custom tile:",o,a)}if(n.customGroups!==void 0&&(await Je(),await new Promise(o=>setTimeout(o,xe)),n.customGroups&&n.customGroups.length>0))try{await Ve(n.customGroups)}catch(o){console.error("Error importing custom groups:",o)}if(n.gameBoards&&n.gameBoards.length>0)for(const o of n.gameBoards)await ur({title:o.title,tiles:o.tiles,tags:o.tags||[],gameMode:o.gameMode||"online",isActive:o.isActive||0});if(n.settings)try{const{updateSettings:o}=Z.getState(),a=n.settings;o(a)}catch(o){console.error("Error importing settings:",o)}return!0}catch(r){return console.error("Error syncing data:",r),!1}}let te=null;function Ue(e=5){Y();const t=e*60*1e3;return te=window.setInterval(async()=>{const r=b();r.currentUser&&!r.currentUser.isAnonymous&&await ge()},t),!0}function Y(){return te?(window.clearInterval(te),te=null,!0):!1}const Xe=rt.createContext(void 0);function wr(e){const[t,r]=A.useState(null),[s,n]=A.useState(!1),[o,a]=A.useState(!0),[c,i]=A.useState(null),[m,u]=A.useState({syncing:!1,lastSync:null}),l=A.useRef(null),w=A.useRef(!1),h=A.useCallback(async g=>{if(l.current&&(clearTimeout(l.current),l.current=null),!t||t.isAnonymous)return!1;try{return u({syncing:!0,lastSync:m.lastSync}),await g(),u({syncing:!1,lastSync:new Date}),!0}catch(f){return console.error("Sync error:",f),f instanceof Error?i(f.message):i("An unknown error occurred"),u({syncing:!1,lastSync:m.lastSync}),!1}},[t,l,u,m.lastSync,i]);async function S(g=""){try{const f=await Dt(g);return r(f),f}catch(f){const p=O(f);throw i(p),f}}async function d(g,f){try{n(!0);const p=await It(g,f);return r(p),p}catch(p){const P=O(p);throw i(P),p}finally{n(!1)}}async function E(){try{n(!0);const g=await Mt();return r(g),g}catch(g){const f=O(g);throw i(f),g}finally{n(!1)}}async function T(g,f,p){try{n(!0);const P=await _t(g,f,p);return r(P),P}catch(P){const R=O(P);throw i(R),P}finally{n(!1)}}async function y(g){try{return await Pt(g),!0}catch(f){const p=O(f);throw i(p),f}}const v=A.useCallback(async(g,f)=>{try{n(!0);const p=await Gt(g,f);return r(p),await h(de),p}catch(p){throw p instanceof Error&&i(p.message),p}finally{n(!1)}},[n,r,h,i]);async function x(g=""){try{const f=await Ot(g);return r(f),f}catch(f){const p=O(f);throw i(p),f}}const U=A.useCallback(async()=>{try{if(t&&!t.isAnonymous){const g=h(de),f=new Promise(p=>setTimeout(p,5e3,!1));await Promise.race([g,f])}await xt(),r(null)}catch(g){const f=O(g);throw i(f),g}},[t,h,r,i]),I=A.useCallback(async()=>{try{await Ut(),r(null),window.location.reload()}catch(g){const f=O(g);throw i(f),g}},[r,i]),Ee=A.useCallback(async()=>h(de),[h]);A.useEffect(()=>{const f=b().onAuthStateChanged(p=>{if(r(p||null),w.current||(w.current=!0,a(!1)),p&&!p.isAnonymous){const P=()=>{l.current&&clearTimeout(l.current),l.current=setTimeout(()=>{u({syncing:!0,lastSync:null});let R;try{R=ge?ge():Promise.resolve(!1)}catch(le){console.warn("syncDataFromFirebase is not available:",le),R=Promise.resolve(!1)}(!R||typeof R.then!="function")&&(R=Promise.resolve(!1)),R.then(()=>{u({syncing:!1,lastSync:new Date}),Ue&&Ue()}).catch(le=>{console.error("Error syncing from Firebase:",le),u({syncing:!1,lastSync:null})}).finally(()=>{l.current=null})},1e3)};typeof window<"u"&&"requestIdleCallback"in window?window.requestIdleCallback(P,{timeout:5e3}):setTimeout(P,100)}else Y&&Y()});return window.authContext={user:null},()=>{f(),l.current&&clearTimeout(l.current),Y&&Y(),window.authContext=void 0}},[]),A.useEffect(()=>{const g=window;g.authContext&&(g.authContext.user=t)},[t]);const Ze=A.useMemo(()=>({user:t,loading:s,initializing:o,error:c,syncStatus:m,login:S,loginEmail:d,loginGoogle:E,register:T,updateUser:x,forgotPassword:y,convertToRegistered:v,logout:U,wipeAllData:I,syncData:Ee,isAnonymous:t?.isAnonymous||!1}),[t,s,o,c,m,v,U,I,Ee]);return C.jsx(Xe.Provider,{value:Ze,...e})}const Ar=A.lazy(()=>H(()=>import("./index.tsx-DoXCFIoV.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8]))),vr=A.lazy(()=>H(()=>import("./chunk-CJL0syeT.js").then(e=>e.i),__vite__mapDeps([9,4,1,2]))),br=A.lazy(()=>H(()=>import("./theme.tsx-CsQH-REL.js"),__vite__mapDeps([3,1,2,4,5])).then(e=>({default:e.ThemeProvider}))),Sr=A.lazy(()=>H(()=>import("./chunk-zIc7ftTo.js").then(e=>e.m),__vite__mapDeps([10,4,1,2,11])).then(e=>({default:e.MigrationProvider}))),Er=A.lazy(()=>H(()=>import("./schedule.tsx-D02jJJGN.js"),__vite__mapDeps([12,1,2,8,4,5])).then(e=>({default:e.ScheduleProvider})));function Tr({children:e}){return C.jsx(A.Suspense,{fallback:C.jsx(me,{}),children:C.jsx(Sr,{children:C.jsx(Er,{children:e})})})}function Cr(){const e=A.useContext(Xe);return!e||e.initializing?C.jsx(me,{}):C.jsx(A.Suspense,{fallback:C.jsx(me,{}),children:C.jsx(br,{children:C.jsx(Tr,{children:C.jsx(Ar,{children:C.jsx(vr,{})})})})})}function Dr(){return C.jsx(wr,{children:C.jsx(Cr,{})})}const Vr=Object.freeze(Object.defineProperty({__proto__:null,default:Dr},Symbol.toStringTag,{value:"Module"}));export{Xe as A,rr as B,Qe as C,Yr as D,Jt as E,Wr as F,Ur as G,nr as H,Xt as I,Zt as J,Ye as K,Wt as L,$t as M,Kt as N,Vt as O,kr as P,cr as Q,Hr as R,Qr as S,ar as T,Jr as U,Ht as V,Nr as W,jr as X,Vr as Y,xr as a,Z as b,Yt as c,Br as d,ur as e,zr as f,Rr as g,Fr as h,qr as i,Se as j,tr as k,Dt as l,Qt as m,It as n,_t as o,fr as p,Mt as q,Ke as r,Lr as s,sr as t,$r as u,Or as v,ue as w,be as x,or as y,F as z};
