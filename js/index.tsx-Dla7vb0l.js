import{ak as V,r as x,j as e,A as O,aE as z,I as W,W as F,ay as G,ar as I,Y as L,am as A,Q as R,T as k,au as r,aB as q,R as Y}from"./chunk-DJZJtpVs.js";import{C as M,A as H,b as U,c as _}from"./chunk-CdTIxCda.js";import{C as P}from"./chunk-Brk1q6wR.js";import{P as J,u as X,e as Z,Q as b,R as ee,w as te,s as se,S as ie}from"./chunk-C3TS7x_Z.js";import{a5 as ne,$ as re,a6 as oe,O as ae}from"./chunk-DEqUmdJg.js";import{T as le}from"./chunk-9fkTg0gS.js";import{u as ce}from"./chunk-7OQk-BoX.js";import{u as de}from"./chunk-DV63sLwq.js";import"../assets/index-BrcxnP-s.js";import"./schedule.tsx-ReirjS8L.js";import"./chunk-CGbfZ7mk.js";import"./chunk-B4ipE-Yx.js";import"./theme.tsx-CQwEcPke.js";import"./chunk-D0boZ4Gt.js";import"./chunk-DtF_b7C9.js";function ue({open:f,close:B,setAlert:a,board:n}){const{t:s}=V(),[u,m]=x.useState(""),[l,v]=x.useState(n.title||"");function T(i){try{return l.length?i.map((o,c)=>{const[g,...C]=o.split(`
`).filter(S=>S);if(g===void 0)throw a({message:s("importNoEmpty")});if(!/^\[.+\]$/.test(g))throw a({message:s("importInvalidTitle",{entry:c+1})});if(!C.length)throw a({message:s("importMissingDescription",{entry:c+1})});return{title:g?.replace(/\[|\]/g,""),description:C.join(`
`)}}):(a({message:s("importTitleRequired")}),null)}catch{return null}}const p=async()=>{const i=u.split(/~+/).filter(c=>c),o=T(i);if(!o)return null;try{if(JSON.stringify(n.tiles)===JSON.stringify(o))return a({message:s("importNoChange")}),null}catch{return a({message:s("error"),type:"error"}),null}return J({...n,title:l,tiles:o}),a({message:s("saved"),type:"success"}),B(),null},w=()=>{const i=n?.tiles?.map(o=>{if(!o)return"";const c=o.title||"",g=o.description||"";return`[${c}]
${g}`}).filter(Boolean);m(i?.join(`
~~
`)||"")},D=i=>{v(i.target.value)},$=async i=>{if(!i.target.value.length)return a({message:s("importTitleRequired")}),null;J({...n,title:i.target.value})};return x.useEffect(()=>{f&&w()},[f]),x.useEffect(()=>{v(n.title||"")},[n.title]),e.jsxs(e.Fragment,{children:[e.jsx(O,{fullWidth:!0,label:s("title"),value:l,onChange:D,onBlur:$}),e.jsx(O,{sx:{mt:2},multiline:!0,fullWidth:!0,value:u,onChange:i=>m(i.target.value),InputProps:{endAdornment:e.jsxs("div",{style:{display:"flex",flexDirection:"column",position:"sticky",top:0},children:[e.jsx(z,{title:s("save"),children:e.jsx(W,{size:"small",onClick:p,"aria-label":s("save"),children:e.jsx(ne,{color:"success"})})}),e.jsx(P,{text:u}),e.jsx(P,{text:`${window.location.href}?importBoard=${n.id}`,copiedText:s("copiedLink"),icon:e.jsx(re,{}),tooltip:s("copyShareLink")})]}),sx:{alignItems:"flex-start"}}})]})}function De({open:f,close:B,isMobile:a}){const n=ce(ie),[s,u]=x.useState(null),[m,l]=x.useState(0),[v,T]=x.useState(0),p=X()[0],{user:w}=de();if(!n)return null;const D=t=>{if(!t||!t.length)return null;const d=t[t.length-1];return d?.description?d.description.match(/\d+%/g):null},$=t=>{u(t)};async function i({title:t,tiles:d}){const h=d.map(({title:Q})=>`* ${Q} 
`);h.pop(),h.shift();let j=`### ${r("activated")}: ${t}
`;j+=`---
`,j+=[...new Set(h)].join(" "),j+=`---
`;const y=D(d);y&&y.length===3&&(j+=`* ${r("finishSlider")} ${y[0]}  | ${y[1]} | ${y[2]}`);const N=await te({title:t,gameBoard:JSON.stringify(d),settings:JSON.stringify(p)});N?.id&&await se({room:p?.room||"PUBLIC",user:w,text:j,type:"settings",gameBoardId:N.id,boardSize:d.length,gameMode:p?.gameMode})}const o=async()=>{const t=await Z({isActive:0})||0;T(t)},c=t=>{b(t.id),i(t),u({message:r("boardEnabled"),type:"success"})},g=t=>{t!==0&&l(t)},C=()=>{typeof m=="number"&&ee(m),l(0)},E=t=>(d,h)=>{T(h?t:0)},S=t=>!t.tiles||t.tiles.length!==(p?.roomTileCount||40),K=t=>S(t)?r("boardWrongSize",{size:p?.roomTileCount||40}):t.isActive?r("boardActive"):r("enableBoard");return e.jsxs(e.Fragment,{children:[e.jsxs(F,{fullScreen:a,open:f,onClose:B,PaperProps:{sx:{maxHeight:"100%",height:"100%"}},children:[e.jsxs(G,{children:[e.jsx(I,{i18nKey:"manageGameBoards"}),e.jsx(M,{close:B})]}),e.jsxs(L,{style:{overflowY:"scroll"},children:[e.jsxs(A,{sx:{mb:1},children:[e.jsx(R,{variant:"outlined",onClick:o,endIcon:e.jsx(oe,{}),sx:{float:"right"},children:e.jsx(I,{i18nKey:"add"})}),e.jsx(k,{children:e.jsx(I,{i18nKey:"gameBoardDescription"})})]}),n.map(t=>e.jsxs(H,{expanded:v===t.id,onChange:E(t.id||0),children:[e.jsxs(U,{children:[e.jsxs(A,{children:[e.jsx(k,{variant:"body1",children:t.title}),e.jsx(k,{variant:"body2",children:r("tilesCount",{count:t.tiles?.length||0})})]}),e.jsxs(A,{style:{marginLeft:"auto"},justifyContent:"flex-end",children:[e.jsx(z,{title:K(t),children:e.jsx("div",{style:{display:"inline-block"},children:e.jsx(q,{checked:!!t.isActive,disabled:!!t.isActive||S(t),onChange:()=>c(t),size:"small"})})}),e.jsx(z,{title:r("delete"),children:e.jsx("span",{style:{display:"inline-block"},children:e.jsx(W,{onClick:()=>g(t.id||0),size:"small",component:"span",children:e.jsx(ae,{color:"error"})})})})]})]}),e.jsx(_,{children:e.jsx(ue,{open:f,close:()=>E(t.id||0)(null,!1),setAlert:$,board:t})})]},t.id))]})]}),e.jsx(le,{open:!!s?.message,type:s?.type||"error",close:()=>u(null),children:s?.message}),e.jsxs(F,{open:!!m,onClose:()=>l(0),children:[e.jsxs(G,{children:[r("deleteBoard"),e.jsx(M,{close:()=>l(0)})]}),e.jsx(L,{children:e.jsx(k,{variant:"body1",children:r("confirmDeleteBoard",{title:n.find(t=>t.id===m)?.title})})}),e.jsxs(Y,{children:[e.jsx(R,{onClick:()=>l(0),children:r("cancel")}),e.jsx(R,{onClick:C,children:r("delete")})]})]})]})}export{De as default};
