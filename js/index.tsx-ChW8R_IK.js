import{q as A,r as i,j as e,t as y}from"./chunk-DDoLnHI0.js";import{C as V}from"./chunk-bqvoNmJe.js";import{u as P,C as U,G as L}from"./chunk-4GWdBvrH.js";import{c as E,e as I}from"./chunk-Bp62TkGl.js";import{a8 as R,a9 as $,F,B as T,T as M,D as G,h as N}from"./chunk-D59Sa5ya.js";import{u as q}from"./chunk-BmcVylZL.js";import{h as D}from"./chunk-CoPHbQIg.js";import{a2 as O}from"./chunk-CtIAsvv6.js";import{l as W,p as _}from"../assets/index-BodytYbc.js";import{u as z}from"./chunk-CXIw3Iqt.js";import{u as H}from"./chunk-CrCBoQmf.js";import{u as J}from"./chunk-jE3-WMs2.js";import"./chunk-BICGdz9x.js";import"./chunk-8ZYOspRI.js";import"./chunk-BDM5WtNj.js";import"./chunk-B0nG6Nel.js";import"./chunk-BFzXl2Wc.js";import"./chunk-Ds_NjC-1.js";import"./chunk-Dk7I1tJi.js";import"./chunk-B4PEA_xj.js";import"./chunk-CbUvEgHM.js";import"./chunk-COViFSNc.js";import"./chunk-dH9yT-e4.js";const Q=l=>({position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",maxWidth:800,bgcolor:"background.paper",border:"2px solid #000",boxShadow:24,p:4,[l.breakpoints.down("sm")]:{width:"90%"}});function X({open:l,text:s="",displayName:r="",handleClose:u,stopAutoClose:c=()=>null,nextPlayer:t=null,isMyMessage:n=!1}){const{t:o}=A(),[p,f]=i.useState(!1),v=s?.match(/#\d*:.*(?=\n)/gs),k=E(s)||"",j=I(s,o("seconds")),{timeLeft:w,togglePause:a}=P(20,!1),[S,g]=i.useState(!0),d=t?.displayName,h=i.useCallback(()=>{a(),c(),g(!1)},[a,c,g]),b=i.useCallback(()=>{h(),f(!0)},[h]),C=i.useCallback(()=>{f(!1)},[]);return e.jsxs("div",{children:[e.jsx(R,{"aria-labelledby":"transition-modal-title","aria-describedby":"transition-modal-description",open:l,onClose:u,slots:{backdrop:$},slotProps:{backdrop:{timeout:500}},children:e.jsx(F,{in:l,children:e.jsxs(T,{sx:Q,children:[e.jsx(M,{id:"transition-modal-title",variant:"h6",component:"h2",children:`${v} ${o("for")} ${r}`}),e.jsx(V,{close:u}),e.jsx(M,{id:"transition-modal-description",variant:"h4",sx:{mt:2},children:k}),e.jsx("br",{}),e.jsx(M,{variant:"caption",children:S?e.jsx(y,{i18nKey:"autoCloseModal",values:{timeLeft:w}}):e.jsx(y,{i18nKey:"autoCloseStopped"})}),e.jsx("br",{}),j?.length&&e.jsxs(e.Fragment,{children:[e.jsx(y,{i18nKey:"timers"}),j.map(x=>e.jsx(U,{textString:x,preventParentClose:h},x))]}),!!t&&e.jsxs(T,{textAlign:"center",children:[e.jsx(G,{style:{margin:"1rem 0 0.5rem"}}),e.jsx(M,{variant:"body1",children:t.isSelf?e.jsx(y,{i18nKey:"yourTurn"}):e.jsx(y,{i18nKey:"nextPlayersTurn",values:{player:d}})})]}),!!n&&s.includes(o("finish"))&&e.jsxs(T,{textAlign:"center",children:[e.jsx(G,{style:{margin:"1rem 0 0.5rem"}}),e.jsx(N,{onClick:b,children:e.jsx(M,{children:o("playAgain")})})]})]})})}),e.jsx(L,{isOpen:p,close:C})]})}const Y="/audio/roll-dice-DysgIh_A.mp3",Z="/audio/message-CBVROrdp.mp3";function ee(l,s){const r=new SpeechSynthesisUtterance;r.text=l,r.pitch=.5;const u=()=>{const c=window.speechSynthesis.getVoices(),t=["Google UK English Male","Microsoft David - English (United States)","Microsoft Mark - English (United States)","Microsoft George - English (United Kingdom)","Daniel"];let n=c.find(o=>o.name===W[s]?.voice);if(!n){for(const o of t){const p=c.find(f=>f.name===o);if(p){n=p;break}}n||(n=c.find(o=>o.name.toLowerCase().includes("male")||o.name.includes("David")||o.name.includes("Mark")||o.name.includes("George")||o.name.includes("Daniel"))),!n&&c.length>0&&(n=c[0])}n&&(r.voice=n,console.log(`Using voice: ${n.name}`)),window.speechSynthesis.speak(r)};window.speechSynthesis.getVoices().length===0?window.speechSynthesis.onvoiceschanged=u:u()}function se(){const{i18n:l}=A(),{user:s}=z(),{messages:r}=H(),[u,c]=i.useState(!1),[t]=O(Y),[n]=O(Z),[o]=q(),{playerDialog:p,othersDialog:f,mySound:v,otherSound:k,chatSound:j,readRoll:w}=o||{},a=i.useMemo(()=>[...r].pop(),[r]),S=i.useCallback((m,K)=>{m&&ee(m,K)},[]),g=i.useMemo(()=>{if(!a?.timestamp)return!1;const m=_(a.timestamp);return m?D(m).diff(D(),"seconds")>=-2:!1},[a]),d=i.useMemo(()=>a?.uid===s?.uid,[a,s]),h=!!(p&&d),b=!!(f&&!d),C=(d&&v||!d&&k)&&a?.type==="actions",x=d&&w&&a?.type==="actions",B=j&&a?.type==="chat";return i.useEffect(()=>{if(D.locale(l.resolvedLanguage),g&&a?.type==="actions"&&(h||b)&&c(a),g&&a){if(C&&t(),x){const m=E(a?.text);S(m,l.resolvedLanguage||"en")}B&&n()}},[l.resolvedLanguage,a,d,h,b,C,x,B,t,n,S,g]),{message:u,setMessage:c,isMyMessage:!!d}}const ke=()=>{const{t:l}=A(),{message:s,setMessage:r,isMyMessage:u}=se(),c=J(s),t=i.useRef(void 0);i.useEffect(()=>(s&&(t.current=setTimeout(()=>r(!1),21e3)),()=>{t.current&&clearTimeout(t.current)}),[s,r]);const n=i.useCallback(()=>{t.current&&clearTimeout(t.current),r(!1)},[r]),o=i.useCallback(()=>{t.current&&clearTimeout(t.current)},[]);return!s||typeof s!="object"||!s.text||s.text.includes(l("start"))?null:e.jsx(X,{text:s?.text,displayName:s?.displayName,open:!0,handleClose:n,stopAutoClose:o,nextPlayer:c,isMyMessage:u})};export{ke as default};
