const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["js/syncOrchestrator.ts-Dbll_Rdt.js","js/chunk-umrKGR02.js","js/chunk-pUwbgVPO.js","js/chunk-QOo_lCq2.js","js/chunk-CgmOw6Gp.js","js/chunk-C6MVR47l.js","assets/index-uzGmdD8v.js","assets/index-DKbdyQom.css"])))=>i.map(i=>d[i]);
!function(){try{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{}).SENTRY_RELEASE={id:"77cc1ee253fa935339410ea0e98fa16f3dd98efe"}}catch(t){}}();try{(e=(new(t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{}).Error).stack)&&(t._sentryDebugIds=t._sentryDebugIds||{},t._sentryDebugIds[e]="fa53fd83-2a54-4812-99e3-164a645d49fb",t._sentryDebugIdIdentifier="sentry-dbid-fa53fd83-2a54-4812-99e3-164a645d49fb")}catch(t){}var t,e;import{n,D as s,_ as a,v as r}from"./chunk-umrKGR02.js";import{a as i,b as c,d as o,u,e as d}from"../assets/index-uzGmdD8v.js";import{a as l,n as f,g as w,p as h,N as y}from"./chunk-CgmOw6Gp.js";import"./chunk-pUwbgVPO.js";import"./chunk-QOo_lCq2.js";import"./chunk-C6MVR47l.js";const g=w(),p=d;async function m(){try{const t=await i({}),e=new Map;t.forEach(t=>{const n=`${t.group_id}|${t.intensity}|${t.action}`;e.has(n)||e.set(n,[]),e.get(n).push(t)});for(const[,n]of e)if(n.length>1){n.sort((t,e)=>(t.id||0)-(e.id||0));const t=n[0],e=n.slice(1),s=e.some(t=>0===t.isEnabled);for(const n of e)n.id&&await o(n.id);s&&1===t.isEnabled&&await u(t.id,{isEnabled:0})}return!0}catch(t){return!1}}async function b(){try{const t=(await n({isDefault:!1})).map(t=>r(t.id));return await Promise.all(t),!0}catch(t){return!1}}async function E(){try{const t=(await i({isCustom:0,isEnabled:0})).filter(t=>t.id).map(t=>u(t.id,{isEnabled:1}));return await Promise.all(t),!0}catch(t){return!1}}async function D(t){try{const e=await i({isCustom:0}),n=new Map;e.forEach(t=>{const e=`${t.group_id}|${t.intensity}|${t.action}`;n.set(e,t.id)});const s=[];return t.forEach(t=>{const e=`${t.group_id}|${t.intensity}|${t.action}`,a=n.get(e);a&&s.push(u(a,{isEnabled:0}))}),await Promise.all(s),!0}catch(e){return!1}}async function _(){const t=l().currentUser;if(!t)return!1;try{const e=await i({isCustom:1}),n=await i({isCustom:0,isEnabled:0}),s=100;return n.length>s&&n.splice(s),await y(f(g,"user-data",t.uid),{customTiles:e,disabledDefaults:n,lastUpdated:new Date},{merge:!0}),!0}catch(e){return!1}}async function $(){const t=l().currentUser;if(!t)return!1;try{const e=await n({isDefault:!1});return await y(f(g,"user-data",t.uid),{customGroups:e,lastUpdated:new Date},{merge:!0}),!0}catch(e){return!1}}async function U(){const t=l().currentUser;if(!t)return!1;try{const e=await c();return!e.length||(await y(f(g,"user-data",t.uid),{gameBoards:e,lastUpdated:new Date},{merge:!0}),!0)}catch(e){return!1}}async function j(){const t=l().currentUser;if(!t)return!1;try{const{settings:e}=s.getState(),{localPlayers:n,...a}=e,r=Object.fromEntries(Object.entries(a).filter(([,t])=>void 0!==t));return await y(f(g,"user-data",t.uid),{settings:r,lastUpdated:new Date},{merge:!0}),!0}catch(e){return!1}}async function T(){return await _(),await $(),await U(),await j(),!0}async function I(){const t=l().currentUser;if(!t)return{success:!1,conflicts:["No user logged in"]};try{const e=f(g,"user-data",t.uid),s=await h(e),a=await i({isCustom:1}),r=await n({isDefault:!1}),c=[];if(!s.exists())return await T(),{success:!0};const o=s.data(),u=o.customTiles||[],d=o.customGroups||[];return a.length>0&&u.length>0&&c.push(`Custom tiles: Local has ${a.length}, Firebase has ${u.length}`),r.length>0&&d.length>0&&c.push(`Custom groups: Local has ${r.length}, Firebase has ${d.length}`),c.length>0?{success:!1,conflicts:c}:{success:await C()}}catch(e){return{success:!1,conflicts:["Sync failed due to error"]}}}async function C(t={}){const{SyncOrchestrator:e}=await a(async()=>{const{SyncOrchestrator:t}=await import("./syncOrchestrator.ts-Dbll_Rdt.js");return{SyncOrchestrator:t}},__vite__mapDeps([0,1,2,3,4,5,6,7]));return await e.syncFromFirebase(t)}let O=null;function S(t=5){k();const e=60*t*1e3;return O=window.setInterval(async()=>{const t=l();t.currentUser&&!t.currentUser.isAnonymous&&await C()},e),!0}function k(){return!!O&&(window.clearInterval(O),O=null,!0)}window.cleanupTiles=m;export{D as applyDisabledDefaults,m as cleanupDuplicateTiles,b as clearUserCustomGroups,p as deleteAllCustomTiles,I as intelligentSync,E as resetDisabledDefaults,S as startPeriodicSync,k as stopPeriodicSync,T as syncAllDataToFirebase,$ as syncCustomGroupsToFirebase,_ as syncCustomTilesToFirebase,C as syncDataFromFirebase,U as syncGameBoardsToFirebase,j as syncSettingsToFirebase};
//# sourceMappingURL=syncService.ts-CZF8nK-w.js.map
