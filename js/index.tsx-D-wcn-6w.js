import{r,ad as V,au as T,j as e,am as p,ao as v,T as l,Q as H,ar as M,a1 as U}from"./chunk-BCLv-HyH.js";import{T as W}from"./chunk-SJIi4_E6.js";import{l as L}from"./chunk-UgYn6M74.js";import{b as q}from"./chunk-6r4ubesh.js";import{p as O,u as D,R}from"./chunk-Dt5xUxBU.js";import{l as K}from"./chunk-CdYmDWt4.js";import{g as G}from"./chunk-B4ipE-Yx.js";import"./chunk-C5tDN2aE.js";import"./chunk-BqpKB5_W.js";import"../assets/index-FPnHeHSJ.js";import"./chunk-BBKbBimA.js";import"./chunk-B4PEA_xj.js";import"./chunk-yLOK5aTh.js";import"./chunk-BleRqfCK.js";import"./chunk-CrxJbRFx.js";function J(o){const m=L(o,"room");let a=!1,t="";if(m){const{roomBackgroundURL:u}=JSON.parse(m.settings),d=O(u);d?.isVideo&&(a=d.isVideo),d?.url&&(t=d.url)}return["color","gray"].some(u=>t.includes(u))&&(t=""),{isVideo:a,url:t}}function Q(){const[o,m]=r.useState(document.fullscreenElement!=null);r.useEffect(()=>{const t=()=>{m(document.fullscreenElement!=null)};return document.addEventListener("fullscreenchange",t),()=>{document.removeEventListener("fullscreenchange",t)}},[]);const a=r.useCallback(()=>{document.fullscreenElement==null?document.documentElement.requestFullscreen().catch(t=>{console.error("Error attempting to enable fullscreen:",t)}):document.exitFullscreen().catch(t=>{console.error("Error attempting to exit fullscreen:",t)})},[]);return{isFullscreen:o,toggleFullscreen:a}}const Y="actions",_=o=>{const{text:m,displayName:a}=o;if(!a)return{};const t=m?.split(`
`),[u,d]=t?.slice(1)||[],j=u?.split(":")[1]?.trim(),f=d?.split(":")[1]?.trim();return{displayName:a,type:j,activity:f}};function pe(){const{id:o}=V(),[m,a]=r.useState(""),[t,u]=r.useState(!1),[d,j]=r.useState(!1),[f,z]=r.useState(!1),{messages:g,isLoading:S}=q(),{isVideo:x,url:s}=J(g),C=L(g,Y),k=D(C),{isFullscreen:B,toggleFullscreen:F}=Q();r.useEffect(()=>{G().currentUser||K("Cast Viewer").catch(c=>{console.error("Anonymous login failed:",c)})},[o]),r.useEffect(()=>{if(!x||!s)return;const i=()=>{const b=document.querySelectorAll("video"),w=document.querySelectorAll("iframe");b.forEach(n=>{n.paused&&(n.muted=!0,n.play().catch(h=>{console.log("Video autoplay attempt failed:",h),z(!0)}))}),w.forEach(n=>{if(n.src)try{const h=new URL(n.src,window.location.origin),y=h.searchParams;let N=!1;y.get("autoplay")!=="1"&&(y.set("autoplay","1"),N=!0),y.get("mute")!=="1"&&(y.set("mute","1"),N=!0),N&&(h.search=y.toString(),n.src=h.toString())}catch{if(!n.src.includes("autoplay=1")){const h=n.src.includes("?")?"&":"?";n.src+=`${h}autoplay=1&mute=1`}}})},c=setTimeout(i,500),E=setTimeout(i,2e3);return()=>{clearTimeout(c),clearTimeout(E)}},[x,s,g.length]),r.useEffect(()=>{const i=window.cast?.framework?.CastReceiverContext,c=navigator.userAgent,E=c.includes("CrKey")||c.includes("TV"),b=window.self!==window.top,w=i||E||window.location.search.includes("chromecast")||window.location.search.includes("receiver");return w&&(document.body.classList.add("cast-receiver-mode"),document.body.classList.remove("theme-light"),j(!0)),b&&document.body.classList.add("in-iframe"),()=>{w&&document.body.classList.remove("cast-receiver-mode"),b&&document.body.classList.remove("in-iframe")}},[]),r.useEffect(()=>{if(S)return;const i=g[g.length-1];i?.type==="settings"&&(u(!0),a(`${i.displayName} ${T("changedSettings")}`))},[g,S]);const I=()=>{document.querySelectorAll("video").forEach(c=>{c.paused&&c.play().catch(console.error)}),z(!1)};if(!C)return e.jsxs(p,{className:"flex-column",style:{backgroundColor:"transparent",color:"white",minHeight:"100vh",backgroundImage:!x&&s?`url(${s})`:"none",backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat",position:"relative"},children:[!!s&&e.jsx(R,{url:s,isVideo:x}),f&&e.jsx(p,{onClick:I,style:{position:"absolute",top:0,left:0,right:0,bottom:"80px",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"rgba(0, 0, 0, 0.5)",color:"white",fontSize:"1.5rem",cursor:"pointer",zIndex:1e3},children:"Click to enable autoplay"}),e.jsx(v,{container:!0,spacing:0,direction:"column",alignItems:"center",justifyContent:"center",className:"cast-container",style:{minHeight:"100vh"},children:e.jsx(v,{container:!0,justifyContent:"center",children:e.jsxs("div",{className:"action-box responsive-cast-box",style:{backgroundColor:"rgba(0,0,0,0.7)",padding:"clamp(1rem, 4vw, 4rem)",borderRadius:"clamp(0.5rem, 1vw, 1rem)",textAlign:"center",width:"clamp(320px, 90vw, 1400px)",margin:"0 auto"},children:[e.jsxs(l,{variant:"h2",style:{color:"white",textShadow:"2px 2px 4px rgba(0,0,0,0.8)",marginBottom:"1rem",fontSize:"clamp(1.5rem, 6vw, 4rem)"},children:["blitzedout.com/",o]}),S?e.jsx(l,{variant:"h4",style:{color:"#90CAF9",textShadow:"1px 1px 2px rgba(0,0,0,0.8)",fontSize:"clamp(1rem, 4vw, 2.5rem)"},children:"Connecting to game..."}):e.jsx(l,{variant:"h4",style:{color:"#A5D6A7",textShadow:"1px 1px 2px rgba(0,0,0,0.8)",fontSize:"clamp(1rem, 4vw, 2.5rem)"},children:"Ready for game to start"})]})})})]});const{displayName:P,type:$,activity:A}=_(C);return e.jsxs(p,{className:"flex-column",onClick:f?I:void 0,style:{backgroundColor:"transparent",color:"white",minHeight:"100vh",backgroundImage:!x&&s?`url(${s})`:"none",backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat",cursor:f?"pointer":"default"},children:[!!s&&e.jsx(R,{url:s,isVideo:x}),e.jsxs(p,{display:"flex",justifyContent:"space-between",sx:{mx:2,mt:2,mb:-2},children:[e.jsx(p,{flex:"1",children:!d&&!B&&e.jsx(H,{variant:"text",onClick:F,style:{color:"white"},children:T("fullscreen")})}),e.jsx(p,{textAlign:"center",flex:"1",children:!!k?.displayName&&e.jsx(l,{variant:"h4",style:{color:"white",textShadow:"2px 2px 4px rgba(0,0,0,0.8)",fontSize:"clamp(1rem, 3vw, 2rem)"},children:e.jsx(M,{i18nKey:"nextPlayersTurn",values:{player:k.displayName}})})},k?.displayName),e.jsx(p,{flex:"1",textAlign:"right",className:"text-stroke",children:A&&e.jsxs(l,{variant:"h4",style:{color:"white",textShadow:"2px 2px 4px rgba(0,0,0,0.8)",fontSize:"clamp(0.8rem, 2.5vw, 1.5rem)"},children:["blitzedout.com/",o]})})]}),e.jsx(v,{container:!0,spacing:0,direction:"column",alignItems:"center",justifyContent:"center",className:"cast-container",style:{minHeight:"calc(100vh - 5rem)"},children:e.jsx(v,{container:!0,justifyContent:"center",children:A?e.jsxs(v,{size:12,className:"action-box responsive-cast-box",style:{backgroundColor:"rgba(0,0,0,0.7)",padding:"clamp(1rem, 4vw, 4rem)",borderRadius:"clamp(0.5rem, 1vw, 1rem)",maxWidth:"95vw",minWidth:"fit-content",margin:"0 auto"},children:[e.jsx(l,{variant:"h3",style:{color:"white",textShadow:"2px 2px 4px rgba(0,0,0,0.8)",fontSize:"clamp(1.2rem, 5vw, 3rem)"},children:`${$} ${T("for")} ${P}`}),e.jsx(p,{className:"divider",style:{marginTop:"-0.5rem",height:"0.5rem",backgroundColor:"white",border:"2px solid black"},children:e.jsx(U,{})}),e.jsx(l,{variant:"h1",style:{color:"white",textShadow:"2px 2px 4px rgba(0,0,0,0.8)",fontWeight:600,fontSize:"clamp(1.8rem, 8vw, 6rem)",lineHeight:1.2},children:A})]}):e.jsx("div",{className:"action-box responsive-cast-box",style:{backgroundColor:"rgba(0,0,0,0.7)",padding:"clamp(1rem, 4vw, 4rem)",borderRadius:"clamp(0.5rem, 1vw, 1rem)",maxWidth:"95vw",minWidth:"fit-content",margin:"0 auto"},children:e.jsxs(l,{variant:"h1",style:{color:"white",textShadow:"2px 2px 4px rgba(0,0,0,0.8)",fontWeight:600,fontSize:"clamp(1.8rem, 8vw, 6rem)",lineHeight:1.2},children:["blitzedout.com/",o]})})})},g.length),e.jsx(W,{open:!!t,close:()=>u(!1),hideCloseButton:!0,children:e.jsx(l,{variant:"h5",style:{color:"white"},children:m})})]})}export{pe as default};
