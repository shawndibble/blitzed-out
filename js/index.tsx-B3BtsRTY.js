import{b as c,aj as M,az as S,j as e,ar as x,at as N,t as h,a3 as P,aw as V,ae as z}from"./chunk-CVSdvP5Z.js";import{p as D,u as q,R as B}from"./chunk-DixsFoei.js";import{T as O}from"./chunk-84IffDWI.js";import{d as K}from"./chunk-BVO8KFPS.js";import{l as L}from"./chunk-BUoOus3c.js";import{k as Y}from"./chunk-B-cyqPC2.js";import{b as G}from"./chunk-guvQFVv-.js";import"./chunk-CNqt7FHs.js";import"./chunk-Pkb0UFv2.js";import"./chunk-9Rprt94M.js";import"./chunk-DkbZbhmS.js";import"./chunk-BO6dzI_Q.js";import"./chunk-_SwOSjSw.js";import"./chunk-E8HqAuJ1.js";import"../assets/index-CZH-e7F_.js";import"./chunk-AkXvan0D.js";(function(){var t=typeof window!="undefined"?window:typeof global!="undefined"?global:typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:{};t.SENTRY_RELEASE={id:"874067a760cfa9079dd7f585e4ceff298b0e879f"}})();try{(function(){var t=typeof window!="undefined"?window:typeof global!="undefined"?global:typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:{},o=new t.Error().stack;o&&(t._sentryDebugIds=t._sentryDebugIds||{},t._sentryDebugIds[o]="ccc29af7-ee67-4d3d-b259-f97112d3ec26",t._sentryDebugIdIdentifier="sentry-dbid-ccc29af7-ee67-4d3d-b259-f97112d3ec26")})()}catch(t){}function J(){const[t,o]=c.useState(document.fullscreenElement!=null);c.useEffect(()=>{const s=()=>{o(document.fullscreenElement!=null)};return document.addEventListener("fullscreenchange",s),()=>{document.removeEventListener("fullscreenchange",s)}},[]);const d=c.useCallback(()=>{document.fullscreenElement==null?document.documentElement.requestFullscreen().catch(s=>{console.error("Error attempting to enable fullscreen:",s)}):document.exitFullscreen().catch(s=>{console.error("Error attempting to exit fullscreen:",s)})},[]);return{isFullscreen:t,toggleFullscreen:d}}function H(t){const o=L(t,"room");let d=!1,s="";if(o){let n,i;try{const y=JSON.parse(o.settings||"{}");n=y.roomBackground,i=y.roomBackgroundURL}catch(y){}let m=null;n==="custom"&&i?m=i:n&&n!=="useAppBackground"?m=n:i&&(m=i);const l=D(m);d=!!l.isVideo,l.url&&(s=l.url)}return["color","gray"].some(n=>s.includes(n))&&(s=""),{isVideo:d,url:s}}const Q="actions",W=t=>{var o,d;const{text:s,displayName:n}=t;if(!n)return{};const i=s==null?void 0:s.split(`
`),[m,l]=(i==null?void 0:i.slice(1))||[],y=(o=m==null?void 0:m.split(":")[1])==null?void 0:o.trim(),f=(d=l==null?void 0:l.split(":")[1])==null?void 0:d.trim();return{displayName:n,type:y,activity:f}};function pe(){const{id:t}=M(),[o,d]=c.useState(""),[s,n]=c.useState(!1),[i,m]=c.useState(!1),[l,y]=c.useState(!1),{messages:f,isLoading:C}=G(),{isVideo:b,url:u}=H(f),E=L(f,Q),j=q(E),{isFullscreen:_,toggleFullscreen:F}=J();c.useEffect(()=>{K().currentUser||Y("Cast Viewer").catch(p=>{console.error("Anonymous login failed:",p)})},[t]),c.useEffect(()=>{if(!b||!u)return;const r=()=>{const w=document.querySelectorAll("video"),T=document.querySelectorAll("iframe");w.forEach(a=>{a.paused&&(a.muted=!0,a.play().catch(g=>{console.log("Video autoplay attempt failed:",g),y(!0)}))}),T.forEach(a=>{if(a.src)try{const g=new URL(a.src,window.location.origin),v=g.searchParams;let I=!1;v.get("autoplay")!=="1"&&(v.set("autoplay","1"),I=!0),v.get("mute")!=="1"&&(v.set("mute","1"),I=!0),I&&(g.search=v.toString(),a.src=g.toString())}catch(g){if(!a.src.includes("autoplay=1")){const v=a.src.includes("?")?"&":"?";a.src+=`${v}autoplay=1&mute=1`}}})},p=setTimeout(r,500),A=setTimeout(r,2e3);return()=>{clearTimeout(p),clearTimeout(A)}},[b,u,f.length]),c.useEffect(()=>{var r,p;const A=(p=(r=window.cast)==null?void 0:r.framework)==null?void 0:p.CastReceiverContext,w=navigator.userAgent,T=w.includes("CrKey")||w.includes("TV"),a=window.self!==window.top,g=A||T||window.location.search.includes("chromecast")||window.location.search.includes("receiver");return g&&(document.body.classList.add("cast-receiver-mode"),document.body.classList.remove("theme-light"),m(!0)),a&&document.body.classList.add("in-iframe"),()=>{g&&document.body.classList.remove("cast-receiver-mode"),a&&document.body.classList.remove("in-iframe")}},[]),c.useEffect(()=>{if(C)return;const r=f[f.length-1];(r==null?void 0:r.type)==="settings"&&(n(!0),d(`${r.displayName} ${S("changedSettings")}`))},[f,C]);const R=()=>{document.querySelectorAll("video").forEach(p=>{p.paused&&p.play().catch(console.error)}),y(!1)};if(!E)return e.jsxs(x,{className:"flex-column cast-main-container",style:{backgroundImage:!b&&u?`url(${u})`:"none"},children:[!!u&&e.jsx(B,{url:u,isVideo:b}),l&&e.jsx(x,{onClick:R,className:"user-interaction-overlay",children:"Click to enable autoplay"}),e.jsx(N,{container:!0,spacing:0,direction:"column",alignItems:"center",justifyContent:"center",className:"cast-container cast-grid-container",children:e.jsx(N,{container:!0,justifyContent:"center",children:e.jsxs("div",{className:"action-box-large responsive-cast-box",children:[e.jsxs(h,{variant:"h2",className:"cast-title",children:["blitzedout.com/",t]}),C?e.jsx(h,{variant:"h4",className:"cast-loading-text",children:"Connecting to game..."}):e.jsx(h,{variant:"h4",className:"cast-ready-text",children:"Ready for game to start"})]})})})]});const{displayName:$,type:U,activity:k}=W(E);return e.jsxs(x,{className:"flex-column cast-main-container",onClick:l?R:void 0,style:{backgroundImage:!b&&u?`url(${u})`:"none",cursor:l?"pointer":"default"},children:[!!u&&e.jsx(B,{url:u,isVideo:b}),e.jsxs(x,{display:"flex",justifyContent:"space-between",className:"cast-header-bar",children:[e.jsx(x,{flex:"1",children:!i&&!_&&e.jsx(P,{variant:"text",onClick:F,className:"cast-fullscreen-button",children:S("fullscreen")})}),e.jsx(x,{textAlign:"center",flex:"1",children:!!(j!=null&&j.displayName)&&e.jsx(h,{variant:"h4",className:"cast-next-player",children:e.jsx(V,{i18nKey:"nextPlayersTurn",values:{player:j.displayName}})})},j==null?void 0:j.displayName),e.jsx(x,{flex:"1",textAlign:"right",className:"text-stroke",children:k&&e.jsxs(h,{variant:"h4",className:"cast-room-url",children:["blitzedout.com/",t]})})]}),e.jsx(N,{container:!0,spacing:0,direction:"column",alignItems:"center",justifyContent:"center",className:"cast-container cast-grid-container-adjusted",children:e.jsx(N,{container:!0,justifyContent:"center",children:k?e.jsxs(N,{size:12,className:"action-box-responsive responsive-cast-box",children:[e.jsx(h,{variant:"h3",className:"cast-type-text",children:`${U} ${S("for")} ${$}`}),e.jsx(x,{className:"cast-divider",children:e.jsx(z,{})}),e.jsx(h,{variant:"h1",className:"cast-activity-text",children:k})]}):e.jsx("div",{className:"action-box-responsive responsive-cast-box",children:e.jsxs(h,{variant:"h1",className:"cast-room-main",children:["blitzedout.com/",t]})})})},f.length),e.jsx(O,{open:!!s,close:()=>n(!1),hideCloseButton:!0,children:e.jsx(h,{variant:"h5",className:"cast-alert-text",children:o})})]})}export{pe as default};
//# sourceMappingURL=index.tsx-B3BtsRTY.js.map
