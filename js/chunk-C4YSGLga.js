const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["js/index.tsx-B1UVMO2n.js","js/chunk-CtNZuTpO.js","js/chunk-Bnn2067E.js","js/theme.tsx-0ZfNJxLw.js","assets/index-C75Wf0CC.js","js/chunk-DXz8SlaL.js","js/chunk-4pml7VKE.js","js/chunk-BYF_9632.js","js/chunk-DN9j8ish.js","js/chunk-DIwrW4xf.js","js/chunk-CxWsNnbo.js","js/chunk-CLKKSinK.js","js/userList.tsx-CTHEJVVH.js","js/chunk-Cef9Yvr_.js","js/schedule.tsx-BXJbMtJh.js"])))=>i.map(i=>d[i]);
var Ye=Object.defineProperty;var Je=(e,t,r)=>t in e?Ye(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var ee=(e,t,r)=>Je(e,typeof t!="symbol"?t+"":t,r);import{A as de,_ as z}from"../assets/index-C75Wf0CC.js";import{aa as re,r as A,j as S,a7 as Ve}from"./chunk-CtNZuTpO.js";import{g as T,E as Ke,l as Xe,s as Ze,a as et,u as ge,c as tt,G as rt,b as nt,d as st,e as ot,f as oe,h as O,i as Ue,T as at,j as it,k as ct,m as j,n as xe,o as ut,r as lt,p as dt,q as mt,t as J,w as V,v as ne,x as se,y as Oe,z as Le,A as ft,B as gt,C as ae}from"./chunk-DXz8SlaL.js";import{r as yt,D as ht,n as Be,a as wt}from"./chunk-Bnn2067E.js";class Y extends Error{constructor(t,r,s){super(t),this.code=r,this.cause=s,this.name="AppError"}}class H extends Y{constructor(t,r,s){super(t,r,s),this.name="AuthError"}}function Re(e){return e instanceof Y}function ye(e){return e instanceof Error}function q(e){return ye(e)?e.message:typeof e=="string"?e:"An unknown error occurred"}function pt(e){if(Re(e)||ye(e)&&"code"in e)return e.code}function Q(e,t="An unexpected error occurred"){return Re(e)?e:ye(e)?new Y(e.message||t,void 0,e):typeof e=="string"?new Y(e):new Y(t)}const Ce={"auth/user-not-found":"No account found with this email address","auth/wrong-password":"Incorrect password","auth/email-already-in-use":"An account with this email already exists","auth/weak-password":"Password is too weak","auth/invalid-email":"Invalid email address","auth/too-many-requests":"Too many login attempts. Please try again later","auth/network-request-failed":"Network error. Please check your connection","permission-denied":"You do not have permission to perform this action",unavailable:"Service is temporarily unavailable. Please try again"};function $(e){const t=pt(e);return t&&Ce[t]?Ce[t]:q(e)}var At=yt();const qe={apiKey:"AIzaSyCKS7tWQRYRWHsawNfN42uAmISdUbJHJJw",authDomain:"blitzout-49b39.firebaseapp.com",projectId:"blitzout-49b39",storageBucket:"blitzout-49b39.appspot.com",messagingSenderId:"852428606926",appId:"1:852428606926:web:17444e6f8dbc2f95f0ef9f",measurementId:"G-93YN1YMTQ7"},Te=Object.entries(qe).filter(([e,t])=>!t).map(([e])=>e);Te.length>0&&(console.error("Missing Firebase environment variables:",Te),console.error("Please check your .env file and ensure all VITE_FIREBASE_* variables are set"));const vt=mt(qe),M=Ue(vt);async function Et(e=""){try{const t=T();return await ot(t),t.currentUser?(await ge(t.currentUser,{displayName:e}),t.currentUser):null}catch(t){throw console.error("Anonymous login error:",t),new H($(t),"ANONYMOUS_LOGIN_FAILED",Q(t))}}async function Ct(e,t,r=""){try{const s=T(),n=await tt(s,e,t);return await ge(n.user,{displayName:r}),n.user}catch(s){throw console.error("Registration error:",s),new H($(s),"REGISTRATION_FAILED",Q(s))}}async function Tt(e,t){try{const r=T();return(await st(r,e,t)).user}catch(r){throw console.error("Email login error:",r),new H($(r),"EMAIL_LOGIN_FAILED",Q(r))}}async function bt(){try{const e=T(),t=new rt;return(await nt(e,t)).user}catch(e){throw console.error("Google login error:",e),new H($(e),"GOOGLE_LOGIN_FAILED",Q(e))}}async function St(e){try{const t=T();return await et(t,e),!0}catch(t){throw console.error("Password reset error:",t),new H($(t),"PASSWORD_RESET_FAILED",Q(t))}}async function Dt(e,t){try{const s=T().currentUser;if(s?.isAnonymous){const n=Ke.credential(e,t);return(await Xe(s,n)).user}else throw new Error("User is not anonymous or not logged in")}catch(r){throw console.error("Account conversion error:",r),new H($(r),"ACCOUNT_CONVERSION_FAILED",Q(r))}}async function _t(){try{const e=T();return await Ze(e),!0}catch(e){throw console.error(e),e}}function Sr(e,t,r={},s={}){if(!e)return;const{enableCache:n=!0,enableDebounce:o=!0}=s,a=e.toUpperCase(),c=we("userList",a),i=Date.now();if(n){const u=D.get(c);if(u&&pe(u,c)){u.queryCount++,D.set(c,u),_(c,Date.now()-i,!0);const l=Object.keys(u.data).sort().join(","),p=r?Object.keys(r).sort().join(","):"";l!==p&&t(u.data);return}}const m=async()=>{let u=!1;try{await ie();const l=ut(),p=lt(l,"users");dt(p,h=>{const E=Date.now(),d=E-i,C=h.val();if(!C){t({});return}const b={};Object.entries(C).forEach(([x,I])=>{I.room===a&&(b[x]={displayName:I.displayName,uid:x,lastSeen:I.lastSeen?new Date(I.lastSeen):new Date,isAnonymous:I.isAnonymous,joinedAt:I.joinedAt?new Date(I.joinedAt):new Date,room:I.room})});const g=b;if(n){he();const x=K(c);D.set(c,{data:g,timestamp:E,queryCount:1,priority:x})}_(c,d,!1,u);const v=Object.keys(g).sort().join(","),U=r?Object.keys(r).sort().join(","):"";v!==U&&t(g)},h=>{u=!0,console.error("getUserList error:",h),_(c,Date.now()-i,!1,!0)})}catch(l){u=!0,console.error("getUserList connection error:",l),_(c,Date.now()-i,!1,!0)}finally{ce()}};o?Ae(c,m):m()}async function It(e=""){try{const t=T();return t.currentUser?(await ge(t.currentUser,{displayName:e}),t.currentUser):null}catch(t){return console.error(t),null}}async function Dr(e,t){try{await oe(O(M,"custom-actions"),{grouping:e,customAction:t,ttl:new Date(Date.now()+5760*60*1e3)})}catch(r){console.error(r)}}async function Mt(e){const t=J(O(M,"game-boards"),V("checksum","==",e)),r=await ft(t);return r.size?r.docs[0]:null}async function _r({title:e,gameBoard:t,settings:r}){if(e)try{const s=At.sha256(t),n=await Mt(s);return n?(ct(n.ref,{ttl:new Date(Date.now()+720*60*60*1e3)}),n):await Pt({title:e,gameBoard:t,settings:r,checksum:s})}catch(s){console.error(s)}}async function Pt({title:e,gameBoard:t,settings:r,checksum:s}){try{return await oe(O(M,"game-boards"),{title:e,gameBoard:t,settings:r,checksum:s,ttl:new Date(Date.now()+720*60*60*1e3)})}catch(n){console.error(n);return}}async function Ir(e){try{const t=j(M,"game-boards",e),r=await xe(t);return r.exists()?r.data():void 0}catch(t){console.error(t);return}}let be={};const D=new Map,k=new Map,Se=15e3,Gt=5e3,De=150,Ut=50,Ne=50,xt=100,N={activeConnections:0,maxConnections:15,connectionQueue:[]},_e=new Map;function _(e,t,r,s=!1){const n=_e.get(e)||{queryCount:0,totalLatency:0,cacheHits:0,lastQueryTime:0,avgLatency:0,p95Latency:0,connectionPoolHits:0,networkErrors:0,latencyHistory:[]};if(n.queryCount++,n.totalLatency+=t,n.lastQueryTime=Date.now(),n.avgLatency=n.totalLatency/n.queryCount,n.latencyHistory.push(t),n.latencyHistory.length>20&&n.latencyHistory.shift(),n.latencyHistory.length>=5){const o=[...n.latencyHistory].sort((c,i)=>c-i),a=Math.floor(o.length*.95);n.p95Latency=o[a]}r&&n.cacheHits++,s&&n.networkErrors++,_e.set(e,n)}function K(e){return e.includes("messages")?"high":e.includes("userList")?"medium":"low"}function Ot(e){switch(e){case"high":return Gt;case"medium":return Se;case"low":return Se*2}}function Lt(e){switch(e){case"high":return Ut;case"medium":return De;case"low":return De*2}}function he(){if(D.size<=xt)return;const e=Array.from(D.entries());e.sort(([,r],[,s])=>{const n={low:0,medium:1,high:2},o=n[r.priority]-n[s.priority];if(o!==0)return o;const a=r.queryCount-s.queryCount;return a!==0?a:r.timestamp-s.timestamp});const t=Math.ceil(D.size*.2);for(let r=0;r<t;r++)D.delete(e[r][0])}function ie(){return new Promise(e=>{N.activeConnections<N.maxConnections?(N.activeConnections++,e()):N.connectionQueue.push(()=>{N.activeConnections++,e()})})}function ce(){if(N.activeConnections--,N.connectionQueue.length>0){const e=N.connectionQueue.shift();e&&e()}}function we(e,t,r){return`${e}:${t||"global"}:${r||""}`}function pe(e,t){const r=K(t),s=Ot(r);return Date.now()-e.timestamp<s}function Ae(e,t,...r){const s=K(e),n=Lt(s),o=k.get(e);o&&clearTimeout(o);const a=setTimeout(async()=>{try{await ie(),t(...r)}catch(c){console.error("Query execution error:",c)}finally{ce(),k.delete(e)}},n);k.set(e,a)}async function Mr({room:e,user:t,text:r="",type:s="chat",...n}){const o=["chat","actions","settings","room","media"];if(!o.includes(s)){let m="Invalid message type. Was expecting ";return m+=o.join(", "),m+=` but got ${s}`,console.error(m)}if(!t?.uid)return;const a={room:e,user:t.uid,text:r,type:s,...n};if(JSON.stringify(a)===JSON.stringify(be))return;be=a;const c=Date.now(),i=e?.toUpperCase()||"PUBLIC";try{return await oe(O(M,"chat-rooms",i,"messages"),{text:r.trim(),ttl:new Date(c+864e5),type:s,...n,uid:t.uid,displayName:t.displayName,timestamp:it()})}catch(m){console.error("Failed to send message:",m);return}}async function Pr(e,t){return gt(j(M,`/chat-rooms/${e.toUpperCase()}/messages/${t}`))}function Gr(e,t,r={}){if(!e)return;const s=T();if(!s.currentUser){let n,o;return n=s.onAuthStateChanged(a=>{a&&(o=Ie(e,t,r),n&&(n(),n=void 0))}),()=>{n&&n(),o&&o()}}return Ie(e,t,r)}function Ie(e,t,r={}){const{limitCount:s=Ne,startAfterDoc:n,enableCache:o=!0,enableDebounce:a=!0}=r,c=e.toUpperCase(),i=we("messages",c,`limit:${s}`),m=Date.now();if(o){const l=D.get(i);if(l&&pe(l,i))return l.queryCount++,D.set(i,l),_(i,Date.now()-m,!0),t(l.data),()=>{}}const u=()=>{let l=!1,p;try{ie();const h=new Date;h.setHours(h.getHours()-3);let E=J(O(M,"chat-rooms",c,"messages"),V("timestamp",">",h),ne("timestamp","asc"),se(s));return n&&(E=J(O(M,"chat-rooms",c,"messages"),V("timestamp",">",h),ne("timestamp","asc"),Oe(n),se(s))),p=Le(E,d=>{const C=Date.now(),b=C-m,g=d.docs.map(v=>({id:v.id,...v.data()}));if(o&&g.length>0){he();const v=d.docs[d.docs.length-1],U=K(i);D.set(i,{data:g,timestamp:C,lastVisible:v,queryCount:1,priority:U})}_(i,b,!1,l),t(g)},d=>{l=!0,console.error("getMessages error:",d),_(i,Date.now()-m,!1,!0)}),p}catch(h){return l=!0,console.error("getMessages connection error:",h),_(i,Date.now()-m,!1,!0),()=>{}}finally{ce()}};if(a){let l;return Ae(i,()=>{l=u()}),()=>{const p=k.get(i);p&&(clearTimeout(p),k.delete(i)),l&&l()}}return u()}function Ur(e,t={}){const{limitCount:r=Ne,startAfterDoc:s,enableCache:n=!0,enableDebounce:o=!0}=t,a=we("schedule",null,`limit:${r}`),c=Date.now();if(n){const u=D.get(a);if(u&&pe(u,a))return u.queryCount++,D.set(a,u),_(a,Date.now()-c,!0),e(u.data),()=>{}}const i=async()=>{let u=!1,l;try{await ie();const p=new Date;p.setMinutes(p.getMinutes()-5);let h=J(O(M,"schedule"),V("dateTime",">",p),ne("dateTime","asc"),se(r));return s&&(h=J(O(M,"schedule"),V("dateTime",">",p),ne("dateTime","asc"),Oe(s),se(r))),l=Le(h,E=>{const d=Date.now(),C=d-c,b=E.docs.map(g=>({id:g.id,...g.data()}));if(n&&b.length>0){he();const g=E.docs[E.docs.length-1],v=K(a);D.set(a,{data:b,timestamp:d,lastVisible:g,queryCount:1,priority:v})}_(a,C,!1,u),e(b)},E=>{u=!0,console.error("getSchedule error:",E),_(a,Date.now()-c,!1,!0)}),l||(()=>{})}catch(p){return u=!0,console.error("getSchedule connection error:",p),_(a,Date.now()-c,!1,!0),()=>{}}finally{ce()}};if(o){let u;return Ae(a,async()=>{u=await i()}),()=>{const l=k.get(a);l&&(clearTimeout(l),k.delete(a)),u&&u()}}const m=i();return m instanceof Promise?()=>{}:m}async function xr(e,t,r="PUBLIC"){try{return await oe(O(M,"schedule"),{dateTime:at.fromDate(e),url:t,room:r})}catch(s){return console.error(s)}}function Bt(e={tables:["customTiles","gameBoard"]}){const{tables:t}=e,r=new Set(t),s={timeouts:{},queue:new Set,scheduleSync(n){this.timeouts[n]&&clearTimeout(this.timeouts[n]),this.queue.add(n),this.timeouts[n]=setTimeout(()=>{this.processSyncQueue()},2e3)},processSyncQueue(){if(this.queue.size===0)return;const n=window;n.authContext?.user&&!n.authContext.user.isAnonymous&&n.authContext.syncData(),this.queue.clear(),Object.keys(this.timeouts).forEach(o=>{clearTimeout(this.timeouts[o]),delete this.timeouts[o]})}};return{stack:"dbcore",name:"syncMiddleware",create(n){return{...n,table(o){const a=n.table(o);return r.has(o)?{...a,mutate:async c=>{const i=await a.mutate(c);return["put","add","delete","deleteRange","update"].includes(c.type)&&s.scheduleSync(o),i}}:a}}}}}class Rt extends ht{constructor(){super("blitzedOut");ee(this,"customTiles");ee(this,"gameBoard");ee(this,"customGroups");this.version(2).stores({customTiles:"++id, group, intensity, action, isEnabled, tags, gameMode, isCustom, locale",gameBoard:"++id, title, tiles, tags, gameMode, isActive"}),this.version(3).stores({customTiles:"++id, group, intensity, action, isEnabled, tags, gameMode, isCustom, locale",gameBoard:"++id, title, tiles, tags, gameMode, isActive",customGroups:"++id, name, label, locale, gameMode, isDefault, createdAt"}),this.version(4).stores({customTiles:"++id, group, intensity, action, isEnabled, tags, gameMode, isCustom, locale",gameBoard:"++id, title, tiles, tags, gameMode, isActive",customGroups:"++id, name, label, locale, gameMode, isDefault, createdAt, [name+locale+gameMode]"}).upgrade(async r=>{const s=await r.table("customGroups").toArray(),n=new Set;for(const o of s){const a=`${o.name}-${o.locale}-${o.gameMode}`;n.has(a)?await r.table("customGroups").delete(o.id):n.add(a)}})}}const F=new Rt;F.use(Bt({tables:["customTiles","gameBoard","customGroups"]}));const{customTiles:G}=F;G.hook("creating",function(e,t,r){t.locale===void 0&&(t.locale="en"),t.gameMode===void 0&&(t.gameMode="online"),t.isCustom===void 0&&(t.isCustom=1)});const qt=async e=>{const t=e.map(r=>({...r,isEnabled:1}));return await G.bulkAdd(t)},ke=e=>{const t=["locale","gameMode","group","intensity","tag","isCustom","action"];let r=G.toCollection();return Object.entries(e).filter(([n])=>t.includes(n)).forEach(([n,o])=>{o==null||o===""||(n==="tag"?r=r.filter(a=>a.tags.includes(o)):r=r.filter(a=>a[n]===o))}),r},ve=async(e={})=>{try{return await ke(e).toArray()}catch(t){return console.error("Error in getTiles:",t),[]}},Nt=async e=>{const{page:t=1,limit:r=50}=e;try{const s=ke(e),n=await s.count(),o=(t-1)*r;return{items:await s.offset(o).limit(r).toArray(),total:n,page:t,limit:r,totalPages:Math.ceil(n/r)}}catch(s){return console.error("Error in getPaginatedTiles:",s),{items:[],total:0,page:t,limit:r,totalPages:0}}},Fe=(e="en",t="online")=>G.where("locale").equals(e).and(r=>r.gameMode===t),kt=async(e="en",t="online",r=null)=>{let s=Fe(e,t);return r&&(s=s.and(o=>o.tags.some(a=>r.includes(a)))),(await s.toArray()).reduce((o,a)=>{const c=a.group;o[c]||(o[c]={count:0,intensities:{}}),o[c].count++;const i=Number(a.intensity);return o[c].intensities[i]||(o[c].intensities[i]=0),o[c].intensities[i]++,o},{})},Ft=(e=null)=>{const t=re.resolvedLanguage||re.language||"en";let r=G.where("locale").equals(t).and(s=>s.isEnabled===1);return e&&(r=r.and(s=>s.gameMode===e)),r.toArray()},je=async e=>await G.add({...e,isEnabled:1}),jt=async(e,t)=>await G.update(e,t),zt=async e=>{const t=await G.get(e);if(!t)throw new Error(`Custom tile with id ${e} not found`);return await G.update(e,{isEnabled:t.isEnabled?0:1})};async function ze(){try{return await F.customTiles.where("isCustom").equals(1).delete(),!0}catch(e){return console.error("Error deleting custom tiles:",e),!1}}const Ht=async e=>{await G.delete(e)},He=(e,t="en",r="online")=>Fe(t,r).and(s=>s.group===e),Qt=async(e,t="en",r="online")=>{try{return await He(e,t,r).count()}catch(s){return console.error("Error counting tiles by group:",s),0}},$t=async(e,t="en",r="online")=>{try{return await He(e,t,r).delete()}catch(s){return console.error("Error deleting tiles by group:",s),0}},Or=Object.freeze(Object.defineProperty({__proto__:null,addCustomTile:je,countTilesByGroup:Qt,deleteAllIsCustomTiles:ze,deleteCustomTile:Ht,deleteCustomTilesByGroup:$t,getActiveTiles:Ft,getPaginatedTiles:Nt,getTileCountsByGroup:kt,getTiles:ve,importCustomTiles:qt,toggleCustomTile:zt,updateCustomTile:jt},Symbol.toStringTag,{value:"Module"})),{customGroups:B}=F;B.hook("creating",function(e,t,r){t.id||(t.id=Be()),t.locale===void 0&&(t.locale=re.resolvedLanguage||re.language||"en"),t.gameMode===void 0&&(t.gameMode="online"),t.isDefault===void 0&&(t.isDefault=!1);const s=new Date;t.createdAt||(t.createdAt=s),t.updatedAt=s});B.hook("updating",function(e,t,r,s){e.updatedAt=new Date});const Wt=e=>{const t=["locale","gameMode","name","isDefault"];let r=B.toCollection();return Object.entries(e).filter(([n])=>t.includes(n)).forEach(([n,o])=>{o==null||o===""||(r=r.filter(a=>a[n]===o))}),r},Ee=async(e={})=>{try{return await Wt(e).toArray()}catch(t){return console.error("Error in getCustomGroups:",t),[]}},Qe=async(e,t="en",r="online")=>{try{return await B.where("name").equals(e).and(s=>s.locale===t&&s.gameMode===r).first()}catch(s){console.error("Error in getCustomGroupByName:",s);return}},Lr=async e=>{try{const t={...e,createdAt:new Date,updatedAt:new Date};return await B.add(t)}catch(t){console.error("Error in addCustomGroup:",t);return}},Br=async(e,t)=>{try{return await B.update(e,t)}catch(r){return console.error("Error in updateCustomGroup:",r),0}},Yt=async e=>{try{await B.delete(e)}catch(t){console.error("Error in deleteCustomGroup:",t)}},Jt=async()=>{try{return await B.clear(),!0}catch(e){return console.error("Error deleting all custom groups:",e),!1}},Vt=async e=>{try{const t=new Date,r=e.map(s=>({name:s.name||"",label:s.label||"",intensities:s.intensities||[],id:s.id||Be(),locale:s.locale||"en",gameMode:s.gameMode||"online",isDefault:s.isDefault||!1,createdAt:s.createdAt||t,updatedAt:s.updatedAt||t}));return await B.bulkAdd(r)}catch(t){console.error("Error in importCustomGroups:",t);return}},Rr=async(e,t="en",r="online")=>{try{return(await Qe(e,t,r))?.intensities||[]}catch(s){return console.error("Error in getGroupIntensities:",s),[]}},qr=async(e,t="en",r="online",s)=>{try{const n=await Qe(e,t,r);return!!(!n||s&&n.id===s)}catch(n){return console.error("Error in isGroupNameUnique:",n),!1}},Kt=async(e="en",t="online")=>{try{const r=await Ee({locale:e,gameMode:t}),s=new Map;r.forEach(o=>{const a=s.get(o.name)||[];a.push(o),s.set(o.name,a)});let n=0;for(const[,o]of s)if(o.length>1){o.sort((a,c)=>{try{const i=a.createdAt instanceof Date?a.createdAt.getTime():new Date(a.createdAt).getTime(),m=c.createdAt instanceof Date?c.createdAt.getTime():new Date(c.createdAt).getTime();return i-m}catch(i){return console.warn("Date parsing failed in removeDuplicateGroups, using createdAt fallback:",i),a.createdAt.getTime()-c.createdAt.getTime()}});for(let a=1;a<o.length;a++)await Yt(o[a].id),n++}return n}catch(r){return console.error("Error in removeDuplicateGroups:",r),0}},Nr=async(e="en",t="online")=>{try{return await Kt(e,t),(await Ee({locale:e,gameMode:t})).filter((n,o,a)=>a.findIndex(c=>c.name===n.name)===o)}catch(r){return console.error("❌ getAllAvailableGroups: Database error",{locale:e,gameMode:t,error:r}),[]}},{gameBoard:L}=F,Xt=()=>L.orderBy("title").toArray(),kr=async()=>L.where("isActive").equals(1)?.first(),Zt=async e=>L.add(e),er=async(e,t)=>L.update(e.id,{...e,...t}),tr=async e=>{const t={title:e.title===void 0?"":e.title,tiles:e.tiles||[],isActive:e.isActive===void 0?1:e.isActive,tags:e.tags||[],gameMode:e.gameMode||"online"};if(!t?.title?.length&&t?.tiles?.length)return;const r=await L.where("title").equals(t.title).first();return F.transaction("rw",F.gameBoard,async()=>(t.isActive&&await rr(),r?(await er(r,e),r.id):await Zt(t)))},Fr=async e=>{const r=(await L.toArray()).map(s=>({...s,isActive:s.id===e?1:0}));await L.bulkPut(r)},jr=async e=>{await L.delete(e)},rr=async()=>{await L.where("isActive").equals(1).modify({isActive:0})};function nr(e,t){let r;try{r=e()}catch{return}return{getItem:n=>{var o;const a=i=>i===null?null:JSON.parse(i,void 0),c=(o=r.getItem(n))!=null?o:null;return c instanceof Promise?c.then(a):a(c)},setItem:(n,o)=>r.setItem(n,JSON.stringify(o,void 0)),removeItem:n=>r.removeItem(n)}}const me=e=>t=>{try{const r=e(t);return r instanceof Promise?r:{then(s){return me(s)(r)},catch(s){return this}}}catch(r){return{then(s){return this},catch(s){return me(s)(r)}}}},sr=(e,t)=>(r,s,n)=>{let o={storage:nr(()=>localStorage),partialize:d=>d,version:0,merge:(d,C)=>({...C,...d}),...t},a=!1;const c=new Set,i=new Set;let m=o.storage;if(!m)return e((...d)=>{console.warn(`[zustand persist middleware] Unable to update item '${o.name}', the given storage is currently unavailable.`),r(...d)},s,n);const u=()=>{const d=o.partialize({...s()});return m.setItem(o.name,{state:d,version:o.version})},l=n.setState;n.setState=(d,C)=>{l(d,C),u()};const p=e((...d)=>{r(...d),u()},s,n);n.getInitialState=()=>p;let h;const E=()=>{var d,C;if(!m)return;a=!1,c.forEach(g=>{var v;return g((v=s())!=null?v:p)});const b=((C=o.onRehydrateStorage)==null?void 0:C.call(o,(d=s())!=null?d:p))||void 0;return me(m.getItem.bind(m))(o.name).then(g=>{if(g)if(typeof g.version=="number"&&g.version!==o.version){if(o.migrate){const v=o.migrate(g.state,g.version);return v instanceof Promise?v.then(U=>[!0,U]):[!0,v]}console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,g.state];return[!1,void 0]}).then(g=>{var v;const[U,x]=g;if(h=o.merge(x,(v=s())!=null?v:p),r(h,!0),U)return u()}).then(()=>{b?.(h,void 0),h=s(),a=!0,i.forEach(g=>g(h))}).catch(g=>{b?.(void 0,g)})};return n.persist={setOptions:d=>{o={...o,...d},d.storage&&(m=d.storage)},clearStorage:()=>{m?.removeItem(o.name)},getOptions:()=>o,rehydrate:()=>E(),hasHydrated:()=>a,onHydrate:d=>(c.add(d),()=>{c.delete(d)}),onFinishHydration:d=>(i.add(d),()=>{i.delete(d)})},o.skipHydration||E(),h||p},or=sr,Me={locale:"en",gameMode:"online",boardUpdated:!1,room:"PUBLIC",background:"color",selectedActions:{},hasSeenRollButton:!1,themeMode:"system"},X=wt()(or(e=>({settings:Me,updateSettings:t=>e(r=>({settings:{...r.settings,...t}})),setLocale:t=>e(r=>({settings:{...r.settings,locale:t}})),resetSettings:()=>e({settings:Me}),updateSelectedAction:(t,r)=>e(s=>{const n={...s.settings.selectedActions};return r===null?delete n[t]:n[t]=r,{settings:{...s.settings,selectedActions:n}}}),removeSelectedAction:t=>e(r=>{const s={...r.settings.selectedActions};return delete s[t],{settings:{...r.settings,selectedActions:s}}}),clearSelectedActions:()=>e(t=>({settings:{...t.settings,selectedActions:{}}})),getSelectedActionsByType:t=>{const{selectedActions:r={}}=X.getState().settings;return Object.entries(r||{}).filter(([,n])=>n.type===t).reduce((n,[o,a])=>(n[o]=a,n),{})}}),{name:"gameSettings",partialize:e=>({settings:e.settings})})),zr=()=>{const{settings:e,updateSettings:t}=X();return[e,t]},Hr=()=>{const{settings:e,updateSettings:t}=X();return{settings:e,updateSettings:t}},Qr="None",$r=3e4,Pe=500,Z=Ue();async function ar(){const t=T().currentUser;if(!t)return console.error("No user logged in"),!1;try{const r=await ve({isCustom:1});return await ae(j(Z,"user-data",t.uid),{customTiles:r,lastUpdated:new Date},{merge:!0}),!0}catch(r){return console.error("Error syncing custom tiles:",r),!1}}async function ir(){const t=T().currentUser;if(!t)return console.error("No user logged in"),!1;try{const r=await Ee();return await ae(j(Z,"user-data",t.uid),{customGroups:r,lastUpdated:new Date},{merge:!0}),!0}catch(r){return console.error("Error syncing custom groups:",r),!1}}async function cr(){const t=T().currentUser;if(!t)return console.error("No user logged in"),!1;try{const r=await Xt();return r.length&&await ae(j(Z,"user-data",t.uid),{gameBoards:r,lastUpdated:new Date},{merge:!0}),!0}catch(r){return console.error("Error syncing game boards:",r),!1}}async function ur(){const t=T().currentUser;if(!t)return console.error("No user logged in"),!1;try{const{settings:r}=X.getState();return await ae(j(Z,"user-data",t.uid),{settings:r,lastUpdated:new Date},{merge:!0}),!0}catch(r){return console.error("Error syncing settings:",r),!1}}async function le(){return await ar(),await ir(),await cr(),await ur(),!0}async function fe(){const t=T().currentUser;if(!t)return console.error("No user logged in"),!1;try{const r=j(Z,"user-data",t.uid),s=await xe(r);if(!s.exists())return!1;const n=s.data();if(n.customTiles!==void 0&&(await ze(),await new Promise(o=>setTimeout(o,Pe)),n.customTiles&&n.customTiles.length>0))for(const o of n.customTiles)try{(await ve({gameMode:o.gameMode,group:o.group,intensity:o.intensity,action:o.action})).length===0&&await je(o)}catch(a){console.error("Error importing custom tile:",o,a)}if(n.customGroups!==void 0&&(await Jt(),await new Promise(o=>setTimeout(o,Pe)),n.customGroups&&n.customGroups.length>0))try{await Vt(n.customGroups)}catch(o){console.error("Error importing custom groups:",o)}if(n.gameBoards&&n.gameBoards.length>0)for(const o of n.gameBoards)await tr({title:o.title,tiles:o.tiles,tags:o.tags||[],gameMode:o.gameMode||"online",isActive:o.isActive||0});if(n.settings)try{const{updateSettings:o}=X.getState(),a=n.settings;o(a)}catch(o){console.error("Error importing settings:",o)}return!0}catch(r){return console.error("Error syncing data:",r),!1}}let te=null;function Ge(e=5){W();const t=e*60*1e3;return te=window.setInterval(async()=>{const r=T();r.currentUser&&!r.currentUser.isAnonymous&&await fe()},t),!0}function W(){return te?(window.clearInterval(te),te=null,!0):!1}const $e=Ve.createContext(void 0);function lr(e){const[t,r]=A.useState(null),[s,n]=A.useState(!1),[o,a]=A.useState(!0),[c,i]=A.useState(null),[m,u]=A.useState({syncing:!1,lastSync:null}),l=A.useRef(null),p=A.useRef(!1),h=A.useCallback(async y=>{if(l.current&&(clearTimeout(l.current),l.current=null),!t||t.isAnonymous)return!1;try{return u({syncing:!0,lastSync:m.lastSync}),await y(),u({syncing:!1,lastSync:new Date}),!0}catch(f){return console.error("Sync error:",f),f instanceof Error?i(f.message):i("An unknown error occurred"),u({syncing:!1,lastSync:m.lastSync}),!1}},[t,l,u,m.lastSync,i]);async function E(y=""){try{const f=await Et(y);return r(f),f}catch(f){const w=q(f);throw i(w),f}}async function d(y,f){try{n(!0);const w=await Tt(y,f);return r(w),w}catch(w){const P=q(w);throw i(P),w}finally{n(!1)}}async function C(){try{n(!0);const y=await bt();return r(y),y}catch(y){const f=q(y);throw i(f),y}finally{n(!1)}}async function b(y,f,w){try{n(!0);const P=await Ct(y,f,w);return r(P),P}catch(P){const R=q(P);throw i(R),P}finally{n(!1)}}async function g(y){try{return await St(y),!0}catch(f){const w=q(f);throw i(w),f}}const v=A.useCallback(async(y,f)=>{try{n(!0);const w=await Dt(y,f);return r(w),await h(le),w}catch(w){throw w instanceof Error&&i(w.message),w}finally{n(!1)}},[n,r,h,i]);async function U(y=""){try{const f=await It(y);return r(f),f}catch(f){const w=q(f);throw i(w),f}}const x=A.useCallback(async()=>{try{if(t&&!t.isAnonymous){const y=h(le),f=new Promise(w=>setTimeout(w,5e3,!1));await Promise.race([y,f])}await _t(),r(null)}catch(y){const f=q(y);throw i(f),y}},[t,h,r,i]),I=A.useCallback(async()=>h(le),[h]);A.useEffect(()=>{const f=T().onAuthStateChanged(w=>{if(r(w||null),p.current||(p.current=!0,a(!1)),w&&!w.isAnonymous){const P=()=>{l.current&&clearTimeout(l.current),l.current=setTimeout(()=>{u({syncing:!0,lastSync:null});let R;try{R=fe?fe():Promise.resolve(!1)}catch(ue){console.warn("syncDataFromFirebase is not available:",ue),R=Promise.resolve(!1)}(!R||typeof R.then!="function")&&(R=Promise.resolve(!1)),R.then(()=>{u({syncing:!1,lastSync:new Date}),Ge&&Ge()}).catch(ue=>{console.error("Error syncing from Firebase:",ue),u({syncing:!1,lastSync:null})}).finally(()=>{l.current=null})},1e3)};typeof window<"u"&&"requestIdleCallback"in window?window.requestIdleCallback(P,{timeout:5e3}):setTimeout(P,100)}else W&&W()});return window.authContext={user:null},()=>{f(),l.current&&clearTimeout(l.current),W&&W(),window.authContext=void 0}},[]),A.useEffect(()=>{const y=window;y.authContext&&(y.authContext.user=t)},[t]);const We=A.useMemo(()=>({user:t,loading:s,initializing:o,error:c,syncStatus:m,login:E,loginEmail:d,loginGoogle:C,register:b,updateUser:U,forgotPassword:g,convertToRegistered:v,logout:x,syncData:I,isAnonymous:t?.isAnonymous||!1}),[t,s,o,c,m,v,x,I]);return S.jsx($e.Provider,{value:We,...e})}const dr=A.lazy(()=>z(()=>import("./index.tsx-B1UVMO2n.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8]))),mr=A.lazy(()=>z(()=>import("./chunk-DIwrW4xf.js").then(e=>e.i),__vite__mapDeps([9,4,1,2]))),fr=A.lazy(()=>z(()=>import("./theme.tsx-0ZfNJxLw.js"),__vite__mapDeps([3,1,2,4,5])).then(e=>({default:e.ThemeProvider}))),gr=A.lazy(()=>z(()=>import("./chunk-CxWsNnbo.js").then(e=>e.m),__vite__mapDeps([10,4,1,2,11])).then(e=>({default:e.MigrationProvider}))),yr=A.lazy(()=>z(()=>import("./userList.tsx-CTHEJVVH.js"),__vite__mapDeps([12,1,2,13,4,5])).then(e=>({default:e.UserListProvider}))),hr=A.lazy(()=>z(()=>import("./schedule.tsx-BXJbMtJh.js"),__vite__mapDeps([14,1,2,8,4,5])).then(e=>({default:e.ScheduleProvider})));function wr({children:e}){return S.jsx(A.Suspense,{fallback:S.jsx(de,{}),children:S.jsx(gr,{children:S.jsx(yr,{children:S.jsx(hr,{children:e})})})})}function pr(){const e=A.useContext($e);return!e||e.initializing?S.jsx(de,{}):S.jsx(A.Suspense,{fallback:S.jsx(de,{}),children:S.jsx(fr,{children:S.jsx(wr,{children:S.jsx(dr,{children:S.jsx(mr,{})})})})})}function Ar(){return S.jsx(lr,{children:S.jsx(pr,{})})}const Wr=Object.freeze(Object.defineProperty({__proto__:null,default:Ar},Symbol.toStringTag,{value:"Module"}));export{$e as A,jt as B,Hr as C,Qr as D,Dr as E,Rr as F,Qt as G,$t as H,Yt as I,kt as J,Nt as K,Ht as L,zt as M,Pr as N,er as O,Fr as P,jr as Q,Xt as R,Or as S,Wr as T,$r as U,Sr as a,Ft as b,Ir as c,tr as d,X as e,kr as f,Gr as g,xr as h,Ur as i,Qe as j,Lr as k,qt as l,Tt as m,Ct as n,bt as o,or as p,Ee as q,Kt as r,Mr as s,ve as t,zr as u,qr as v,_r as w,Nr as x,Br as y,je as z};
