import{b as u,j as h,u as F,W as J,D as K,ar as Y}from"./chunk-CVSdvP5Z.js";import{c as H}from"./chunk-CNqt7FHs.js";import{g as q}from"./chunk-Pkb0UFv2.js";import{i as X}from"./chunk-guvQFVv-.js";import{l as L}from"./chunk-9Rprt94M.js";import{u as G}from"./chunk-DkbZbhmS.js";(function(){var e=typeof window!="undefined"?window:typeof global!="undefined"?global:typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:{};e.SENTRY_RELEASE={id:"874067a760cfa9079dd7f585e4ceff298b0e879f"}})();try{(function(){var e=typeof window!="undefined"?window:typeof global!="undefined"?global:typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:{},n=new e.Error().stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="754c9738-ac66-49d1-a9ff-bdd5074144d6",e._sentryDebugIdIdentifier="sentry-dbid-754c9738-ac66-49d1-a9ff-bdd5074144d6")})()}catch(e){}function Q(e){let n="";for(const o of String(e)){const i=o.codePointAt(0);i>=0&&i<=31||i===127||i>=128&&i<=159||i===8232||i===8233||(n+=o)}return`url("${n.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}")`}const B=e=>e&&/\.(jpe?g|png|webp|bmp|svg|gif|avif|tiff?|heic|heif|jfif)(\?.*)?$/i.test(e)?"image":"video";function ee({url:e}){const[n,t]=u.useState(B(e)),[o,i]=u.useState(e);if(u.useEffect(()=>{i(e),t(B(e))},[e]),!o)return null;const a=()=>{var s,c;const d=(s=o!=null?o:e)!=null?s:"";let b=!1;try{const v=new URL(d);b=v.host==="imgur.com"||v.host==="i.imgur.com"}catch(v){b=!1}if(b){const v=(c=d.match(/(?:i\.)?imgur\.com\/([a-zA-Z0-9]+)(?:\.[a-z]+)?/))==null?void 0:c[1];if(v){const R=`https://i.imgur.com/${v}.jpg`;i(R),t("image");return}}const f=`${d.replace(/\.(mp4|webm|ogg|mov)(\?.*)?$/i,"")}.jpg`;i(f),t("image")},r=()=>{var s,c;const d=(s=o!=null?o:e)!=null?s:"";let b=!1;try{const l=new URL(d);b=l.host==="imgur.com"||l.host==="i.imgur.com"}catch(l){b=!1}if(b){const l=(c=d.match(/(?:i\.)?imgur\.com\/([a-zA-Z0-9]+)(?:\.[a-z]+)?/))==null?void 0:c[1];if(l){const f=["jpg","png","gif","jpeg","webp"],v=o==null?void 0:o.split(".").pop(),p=f.indexOf(v||"")+1;if(p<f.length){const U=f[p],$=`https://i.imgur.com/${l}.${U}`;i($)}}}else{const l=["jpg","png","gif","jpeg","webp"],f=o==null?void 0:o.split(".").pop(),R=l.indexOf(f||"")+1;if(R<l.length&&o){const p=l[R],$=`${o.replace(/\.[^.]+(\?.*)?$/,"")}.${p}`;i($)}}};return n==="video"?h.jsx("video",{autoPlay:!0,loop:!0,muted:!0,playsInline:!0,src:o||void 0,className:"video-background",onError:a,preload:"auto",crossOrigin:"anonymous",controls:!0}):h.jsxs(h.Fragment,{children:[h.jsx("div",{className:"image-background",style:{backgroundImage:o?Q(o):void 0,backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat",width:"100%",height:"100%",position:"absolute",top:0,left:0}}),h.jsx("img",{src:o||void 0,onError:r,style:{display:"none"},alt:""})]})}var te=(e,n,t)=>new Promise((o,i)=>{var a=c=>{try{s(t.next(c))}catch(d){i(d)}},r=c=>{try{s(t.throw(c))}catch(d){i(d)}},s=c=>c.done?o(c.value):Promise.resolve(c.value).then(a,r);s((t=t.apply(e,n)).next())});function ne({images:e,className:n,zoomDuration:t=3e3,zoomScale:o=1.4}){const{t:i}=F(),[a,r]=u.useState(0),[s,c]=u.useState(0),[d,b]=u.useState(new Set),[l,f]=u.useState(new Set),[v,R]=u.useState(!1),p=u.useRef(null),U=u.useRef(new Map);u.useEffect(()=>{R(!1),b(new Set),f(new Set),U.current.clear(),r(0),c(0)},[e]),u.useEffect(()=>{if(e.length===0)return;const w=y=>new Promise(I=>{if(U.current.has(y)||l.has(y)){I();return}const m=new Image;m.onload=()=>{U.current.set(y,m),b(j=>{const _=new Set(j).add(y);return!v&&y===e[0]&&R(!0),_}),I()},m.onerror=()=>{f(j=>new Set(j).add(y)),I()},m.src=y});te(null,null,function*(){const y=Math.min(5,e.length),I=[];for(let m=0;m<y;m++){const j=(a+m)%e.length;I.push(w(e[j]))}yield Promise.all(I)})},[e,a,l,v]),u.useEffect(()=>{if(e.length===0||e.length===1)return;const w=()=>{p.current=window.setInterval(()=>{r(y=>(y+1)%e.length),c(y=>y+1)},t)},g=window.setTimeout(w,2e3);return()=>{window.clearTimeout(g),p.current&&(window.clearInterval(p.current),p.current=null)}},[e.length,t]),u.useEffect(()=>()=>{p.current&&(window.clearInterval(p.current),p.current=null)},[]);const $=e[a]||"",S=d.has($)||U.current.has($),k=l.has($);return u.useEffect(()=>{if(k&&e.length>1&&!e.every(g=>l.has(g))){const g=(a+1)%e.length;r(g),c(y=>y+1)}},[k,a,e.length,e,l]),e.length===0?null:h.jsxs("div",{className:H("image-slideshow-container",n),"aria-hidden":!0,children:[h.jsx("div",{className:"image-slideshow-fallback"}),!v&&e.length>0&&h.jsx("div",{className:"loading-message",children:i("loadingImages")}),S&&!k&&h.jsx("div",{className:"image-slideshow-slide",style:{backgroundImage:`url(${$})`,animationDuration:`${t}ms`,"--zoom-scale":o}},s)]})}var T=(e,n,t)=>new Promise((o,i)=>{var a=c=>{try{s(t.next(c))}catch(d){i(d)}},r=c=>{try{s(t.throw(c))}catch(d){i(d)}},s=c=>c.done?o(c.value):Promise.resolve(c.value).then(a,r);s((t=t.apply(e,n)).next())});function M(e){return e.replace(/&amp;/g,"&")}const Z=["r.jina.ai","api.allorigins.win/get?url=","corsproxy.io/?"],oe=(e,n=0)=>{const t=Z[n];if(t==="api.allorigins.win/get?url=")return`https://${t}${encodeURIComponent(e)}`;if(t==="corsproxy.io/?")return`https://${t}${encodeURIComponent(e)}`;const o=e.replace(/^https?:\/\//,""),i=e.startsWith("https://")?"https":"http";return`https://${t}/${i}://${o}`};function re(e,n,t){return T(this,null,function*(){var o,i,a,r,s,c,d,b,l,f,v;const R=new Set;let p=null;const U=[k=>`https://www.reddit.com/r/${e}/top.json?limit=100&t=year&raw_json=1${k?`&after=${k}`:""}`,k=>`https://www.reddit.com/r/${e}/hot.json?limit=100&raw_json=1${k?`&after=${k}`:""}`],$=k=>T(null,null,function*(){try{const w=yield fetch(k,{signal:t,credentials:"omit",mode:"cors",headers:{"User-Agent":"BlitzedOut/1.0",Accept:"application/json, text/plain, */*","Accept-Language":"en-US,en;q=0.9"}});if(w.ok){const g=yield w.text();try{return JSON.parse(g)}catch(y){const I=g.indexOf("{"),m=g.lastIndexOf("}");if(I!==-1&&m!==-1&&m>I)try{return JSON.parse(g.slice(I,m+1))}catch(j){return null}return null}}}catch(w){if(w instanceof DOMException&&w.name==="AbortError")throw w}for(let w=0;w<Z.length;w++)try{const g=yield fetch(oe(k,w),{signal:t,credentials:"omit",mode:"cors",headers:{"User-Agent":"BlitzedOut/1.0",Accept:"application/json, text/plain, */*"}});if(!g.ok)continue;const y=yield g.text();let I;try{const m=JSON.parse(y);I=m.contents?JSON.parse(m.contents):m}catch(m){const j=y.indexOf("{"),_=y.lastIndexOf("}");if(j!==-1&&_!==-1&&_>j)try{I=JSON.parse(y.slice(j,_+1))}catch(N){continue}else continue}if(I)return I}catch(g){if(g instanceof DOMException&&g.name==="AbortError")throw g;continue}return null});let S=0;for(;R.size<n&&S<U.length;){p=null;for(let k=0;k<5&&R.size<n;k+=1){const w=U[S](p),g=yield $(w);if(!g)break;const y=(i=(o=g==null?void 0:g.data)==null?void 0:o.children)!=null?i:[];p=(r=(a=g==null?void 0:g.data)==null?void 0:a.after)!=null?r:null;for(const I of y){const m=I==null?void 0:I.data;if(!m)continue;const j=m.url_overridden_by_dest,_=m.post_hint;if(m.is_gallery&&m.media_metadata&&m.gallery_data){const A=m.gallery_data.items||[];for(const W of A){const E=m.media_metadata[W.media_id],P=((s=E==null?void 0:E.s)==null?void 0:s.u)||((c=E==null?void 0:E.s)==null?void 0:c.gif)||((d=E==null?void 0:E.s)==null?void 0:d.mp4);if(typeof P=="string"){const O=P.startsWith("http")?P:`https:${P}`;/\.(jpe?g|png|gif|webp)(\?.*)?$/i.test(O)&&R.add(M(O))}}continue}if(_==="image"&&typeof j=="string"&&/\.(jpe?g|png|gif|webp)(\?.*)?$/i.test(j)){R.add(M(j));continue}const N=(v=(f=(l=(b=m.preview)==null?void 0:b.images)==null?void 0:l[0])==null?void 0:f.source)==null?void 0:v.url;if(N){const A=N.startsWith("http")?N:`https:${N}`;R.add(M(A))}}if(!p)break}S+=1}return Array.from(R).slice(0,n)})}function ie(e,n){return T(this,null,function*(){const t=e.maxImages||150;return{images:yield re(e.subreddit,t,n),source:`r/${e.subreddit}`}})}function V(e){try{const n=new URL(e);return/(^|\.)reddit\.com$/i.test(n.hostname)&&/\/r\//i.test(n.pathname)}catch(n){return!1}}function se(e){var n;try{const o=new URL(e).pathname.match(/\/r\/([^/]+)/i);return(n=o==null?void 0:o[1])!=null?n:null}catch(t){return null}}const ae=3e5,C=new Map,z=new Map;function ce(e,n){return T(this,null,function*(){const t=JSON.stringify(e),o=Date.now(),i=C.get(t);if(i&&o-i.fetchedAt<ae)return i.result;const a=z.get(t);if(a)try{return yield a}catch(s){}const r=ie(e,n).then(s=>(C.set(t,{fetchedAt:Date.now(),result:s}),s)).finally(()=>{z.delete(t)});return z.set(t,r),r})}var le=(e,n,t)=>new Promise((o,i)=>{var a=c=>{try{s(t.next(c))}catch(d){i(d)}},r=c=>{try{s(t.throw(c))}catch(d){i(d)}},s=c=>c.done?o(c.value):Promise.resolve(c.value).then(a,r);s((t=t.apply(e,n)).next())});function de(e){const{t:n}=F(),[t,o]=u.useState([]),[i,a]=u.useState(!1),[r,s]=u.useState(null),[c,d]=u.useState(null),b=u.useRef(null),l=u.useRef(null),f=u.useRef(null);return u.useEffect(()=>{if(b.current&&b.current.abort(),l.current&&(clearTimeout(l.current),l.current=null),f.current&&(clearTimeout(f.current),f.current=null),o([]),s(null),d(null),!e||!V(e)){a(!1);return}const v=se(e);if(!v){s("invalidRedditUrl"),a(!1);return}const R={subreddit:v,maxImages:150};a(!0);const p=new AbortController;b.current=p;const U=($=0)=>le(null,null,function*(){try{const S=yield ce(R,p.signal);if(p.signal.aborted)return;o(S.images),d(S.source),s(null),a(!1)}catch(S){if(p.signal.aborted)return;if($<2){const w=Math.pow(2,$)*1e3;f.current=setTimeout(()=>{p.signal.aborted||U($+1)},w);return}s("redditBlocked"),o([]),d(null),a(!1)}});return l.current=setTimeout(U,300),()=>{p.abort(),l.current&&(clearTimeout(l.current),l.current=null),f.current&&(clearTimeout(f.current),f.current=null)}},[e]),u.useEffect(()=>()=>{b.current&&b.current.abort(),l.current&&(clearTimeout(l.current),l.current=null),f.current&&(clearTimeout(f.current),f.current=null)},[]),{images:t,isLoading:i,error:r?n(r):null,source:c}}function ue({url:e}){const{t:n}=F(),t=J(),{images:o,isLoading:i,error:a}=de(e);return i?h.jsxs("div",{className:"slideshow-container slideshow-loading","aria-hidden":!0,children:[h.jsx("div",{className:"image-slideshow-fallback"}),h.jsx("div",{className:"loading-message",children:n("loadingRedditImages")})]}):a?h.jsxs("div",{className:"slideshow-container slideshow-error","aria-hidden":!0,children:[h.jsx("div",{className:"image-slideshow-fallback"}),h.jsxs("div",{className:"error-message",style:{position:"absolute",bottom:"20px",right:"20px",background:K(t.palette.background.paper,.7),color:t.palette.text.primary,padding:"12px 16px",borderRadius:"8px",fontSize:"14px",maxWidth:"300px",zIndex:1e3},children:[h.jsx("strong",{children:n("redditBackgroundNote")}),h.jsx("br",{}),n("redditBlocked")]})]}):o.length===0?h.jsx("div",{className:"slideshow-container slideshow-empty","aria-hidden":!0,children:h.jsx("div",{className:"image-slideshow-fallback"})}):h.jsx(ne,{images:o})}function Me({url:e=null,isVideo:n=null}){const t=e&&/\.(mp4|webm|ogg|mov|gif)(\?.*)?$/i.test(e),o=e?V(e):!1,i=e==="color"||e==="gray"||(e==null?void 0:e.includes("/color"))||(e==null?void 0:e.includes("/gray")),a=e&&!i&&(n||!n&&e),r=!n&&o&&e;return h.jsxs(Y,{className:H("main-container",!a&&"default-background"),role:"presentation",sx:{backgroundImage:!n&&e&&!i&&!o?`url(${e})`:"none"},children:[n&&!o&&(t?h.jsx(ee,{url:e}):h.jsx("iframe",{src:e||void 0,title:"video",width:"100%",height:"100%",allow:"autoplay; fullscreen; encrypted-media; picture-in-picture",sandbox:"allow-same-origin allow-scripts allow-presentation",style:{border:"none"}})),r?h.jsx(ue,{url:e}):null]})}function me(e){const n=/vimeo\.com\/(\d+)/,t=e.match(n);return`https://player.vimeo.com/video/${t?t[1]:""}?autoplay=1&loop=1&autostart=true`}function fe(e){const n=/(?:youtube\.com\/(?:[^/]+\/.+\/|(?:v|e(?:mbed)?)\/|[^#]*[?&]v=|youtu\.be\/)([^"&?/ ]{11})|^(?:[^"&?/ ]{11})$)/,t=e.match(n);return`https://www.youtube.com/embed/${t?t[1]:""}?autoplay=1&loop=1&autostart=true&mute=1&playsinline=1&controls=0&disablekb=1&fs=0&modestbranding=1&rel=0&iv_load_policy=3`}function pe(e){const n=/drive\.google\.com\/file\/d\/([^/]+)/,t=e.match(n);return`https://drive.google.com/file/d/${t?t[1]:""}/preview?loop=1`}function ge(e){const n=/dropbox\.com\/s\/([^/]+)/,t=e.match(n);return`https://www.dropbox.com/s/${t?t[1]:""}?raw=1`}function he(e){return`https://pornhub.com/embed/${new URL(e).searchParams.get("viewkey")||""}?autoplay=1&loop=1&autostart=true&playsinline=1`}function ye(e){const n=e.split("-");return`https://xhamster.com/xembed.php?video=${n[n.length-1]}?autoplay=1&loop=1&autostart=true&playsinline=1`}function be(e){const n=/media1?\.tenor\.com\/(?:m\/)?([a-zA-Z0-9_-]+)\/[^/]*\.(mp4|gif|webp|webm)/,t=e.match(n);if(t){const a=t[2].toLowerCase();return{url:e,isVideo:["mp4","webm"].includes(a)}}const o=/tenor\.com\/view\/[^/]*-(\d+)/,i=e.match(o);return i?{url:`https://tenor.com/embed/${i[1]}`,isVideo:!0}:{url:e,isVideo:!1}}function ve(e){const n=/giphy\.com\/gifs\/[^/]*-([a-zA-Z0-9]+)/,t=e.match(n);return`https://media.giphy.com/media/${t?t[1]:""}/giphy.gif`}function we(e){return/\d+\.media\.tumblr\.com\/.*\.(gif|mp4|webm)(\?.*)?$/i.test(e),e}function xe(e){const n=/(?:gfycat\.com|redgifs\.com)\/(?:watch\/)?([a-zA-Z0-9]+)/,t=e.match(n),o=t?t[1]:"";return x(e,["redgifs.com"])?`https://files.redgifs.com/${o}.mp4`:`https://giant.gfycat.com/${o}.mp4`}function Ie(e){const n=/redtube\.com\/(\d+)/,t=e.match(n);return`https://embed.redtube.com/?id=${t?t[1]:""}&autoplay=true&auto_play=1&playsinline=1&controls=1`}function Re(e){const n=/youporn\.com\/watch\/(\d+)/,t=e.match(n);return`https://www.youporn.com/embed/${t?t[1]:""}?autoplay=1&playsinline=1`}function ke(e){const n=/tube8\.com\/[^/]+\/[^/]+\/(\d+)/,t=e.match(n);return`https://www.tube8.com/embed/${t?t[1]:""}?autoplay=1&playsinline=1`}function $e(e){return`https://twitframe.com/show?url=${encodeURIComponent(e)}`}function je(e){try{const r=new URL(e);if((r.host==="discordapp.net"||r.host.endsWith(".discordapp.net"))&&r.pathname.startsWith("/external/")&&(r.pathname.includes("/https/i.imgur.com/")||r.pathname.includes("/https/imgur.com/")))return e}catch(r){L.debug("URL parsing failed for Discord proxy check:",r)}try{const r=new URL(e);if(r.host==="i.imgur.com"&&(r.search||r.pathname.match(/\.[a-zA-Z0-9]+$/)))return e}catch(r){L.debug("URL parsing failed for direct link check:",r)}let n="",t=!1;try{const r=new URL(e);t=r.host==="imgur.com"||r.host==="i.imgur.com"}catch(r){return L.debug("URL parsing failed for Imgur processing:",r),""}if(!t)return"";if(e.includes("/gallery/")){const r=e.match(/imgur\.com\/gallery\/[^#]*#([a-zA-Z0-9]+)/);if(r)n=r[1];else{const s=e.match(/imgur\.com\/gallery\/.*-([a-zA-Z0-9]+)/);if(s)n=s[1];else return L.debug("Could not extract image ID from gallery URL, returning original:",e),e}}else{const r=/imgur\.com\/([a-zA-Z0-9]+)(?:\.(mp4|mov|avi|webm|mkv|flv|wmv|jpg|jpeg|png|gif|gifv|webp|bmp|tiff|svg))?|images-ext-\d+\.discordapp\.net\/external\/[^/]+\/https\/i\.imgur\.com\/([a-zA-Z0-9]+)\.(mp4|mov|avi|webm|mkv|flv|wmv|jpg|jpeg|png|gif|gifv|webp|bmp|tiff|svg)/,s=e.match(r);n=s?s[1]||s[3]:""}if(!n)return"";const o=e.match(/\.([a-zA-Z0-9]+)(?:\?.*)?$/);let i="jpg";if(o&&o[1]){let r=o[1].toLowerCase();const s={gifv:"mp4"};s[r]&&(r=s[r]),["jpg","jpeg","png","gif","webp","mp4","mov","avi","webm","mkv","flv","wmv","bmp","tiff","svg"].includes(r)&&(i=r)}return`https://i.imgur.com/${n}.${i}`}function D(e){return/\.(mp4|webm|ogg|mov)(\?.*)?$/.test(e)}function Ue(e){return x(e,["media.discordapp.net","cdn.discordapp.com"])&&!D(e)}function x(e,n){try{const t=new URL(e);return n.some(o=>t.host===o||t.host.endsWith("."+o))}catch(t){return L.debug("URL parsing failed in isValidHost, rejecting for security:",t),!1}}function Se(e){let n=null,t=!0;if(!e)return{url:"",isVideo:!1};switch(!0){case x(e,["vimeo.com"]):n=me(e);break;case x(e,["youtube.com","youtu.be"]):n=fe(e);break;case x(e,["drive.google.com"]):n=pe(e);break;case x(e,["pornhub.com"]):n=he(e);break;case x(e,["xhamster.com"]):n=ye(e);break;case x(e,["dropbox.com"]):n=ge(e);break;case x(e,["imgur.com","i.imgur.com"]):n=je(e);break;case x(e,["tenor.com"]):{const o=be(e);n=o.url,t=o.isVideo;break}case x(e,["giphy.com"]):n=ve(e),t=!0;break;case(x(e,["tumblr.com","media.tumblr.com"])||/\d+\.media\.tumblr\.com/.test(e)):n=we(e),t=n?D(n):!1;break;case x(e,["gfycat.com","redgifs.com"]):n=xe(e),t=!0;break;case x(e,["redtube.com"]):n=Ie(e);break;case x(e,["youporn.com"]):n=Re(e);break;case x(e,["tube8.com"]):n=ke(e);break;case x(e,["twitter.com","x.com"]):n=$e(e),t=!1;break;case x(e,["thisvid.com"]):n=e;break;case x(e,["boyfriendtv.com"]):n=e;break;case Ue(e):n=e,t=!1;break;case D(e):n=e;break;default:n=q(e),t=!1;break}return{url:n,isVideo:t}}function ze(e,n){const{background:t,backgroundURL:o,roomBackgroundURL:i}=e;let a=null;return t?t==="custom"?a=o||null:t==="useRoomBackground"?!X(n)&&i?a=i:a="color":a=t:a="color",a||(a="color"),a==="color"||a==="gray"?{url:a,isVideo:!1}:Se(a)}function _e(e){return{uid:e.uid,displayName:e.displayName,isSelf:e.isSelf,isFinished:e.isFinished}}function De(e){const[n,t]=u.useState(null),o=G(),i=u.useMemo(()=>o.map(r=>`${r.uid}-${r.displayName}-${r.isFinished}-${r.isSelf}`).join("|"),[o]),a=u.useMemo(()=>e?`${e.uid}-${e.displayName||""}`:null,[e]);return u.useEffect(()=>{if(!e){t(null);return}if(o.length<=1){t(null);return}const r=o.filter(l=>!l.isFinished);if(r.length<=1){t(null);return}let s=-1;s=r.findIndex(l=>l.uid===e.uid),s===-1&&(s=r.findIndex(l=>l.displayName===e.displayName)),s===-1&&(s=0);const c=(s+1)%r.length,d=r[c],b=_e(d);t(b)},[a,i]),n}export{Me as R,ze as g,Se as p,De as u};
//# sourceMappingURL=chunk-DixsFoei.js.map
