import{r as n,ad as P,au as I,j as e,am as g,ao as N,T as m,Q as V,ar as q,a1 as z}from"./chunk-DVu0ELID.js";import{p as O,u as K,R as L}from"./chunk-BU5Lbkq0.js";import{T as D}from"./chunk-DYk7asbE.js";import{g as G}from"./chunk-B37hsyTU.js";import{l as R}from"./chunk-CxOnQw37.js";import{l as J}from"./chunk-C4JUBbif.js";import{b as Q}from"./chunk-Bl2I3sq_.js";import"./chunk-Cv9LRx66.js";import"./chunk-NPenkmUw.js";import"./chunk-EL58PX5i.js";import"./chunk-gkT8UsGz.js";import"./chunk-DmVEMEf_.js";import"./chunk-CoCDAHy1.js";import"../assets/index-C2TnOMdU.js";import"./chunk-BCF63dVT.js";function Y(){const[a,f]=n.useState(document.fullscreenElement!=null);n.useEffect(()=>{const t=()=>{f(document.fullscreenElement!=null)};return document.addEventListener("fullscreenchange",t),()=>{document.removeEventListener("fullscreenchange",t)}},[]);const o=n.useCallback(()=>{document.fullscreenElement==null?document.documentElement.requestFullscreen().catch(t=>{console.error("Error attempting to enable fullscreen:",t)}):document.exitFullscreen().catch(t=>{console.error("Error attempting to exit fullscreen:",t)})},[]);return{isFullscreen:a,toggleFullscreen:o}}function _(a){const f=R(a,"room");let o=!1,t="";if(f){let s,i;try{const v=JSON.parse(f.settings||"{}");s=v.roomBackground,i=v.roomBackgroundURL}catch{}let p=null;s==="custom"&&i?p=i:s&&s!=="useAppBackground"?p=s:i&&(p=i);const l=O(p);o=!!l.isVideo,l.url&&(t=l.url)}return["color","gray"].some(s=>t.includes(s))&&(t=""),{isVideo:o,url:t}}const H="actions",W=a=>{const{text:f,displayName:o}=a;if(!o)return{};const t=f?.split(`
`),[s,i]=t?.slice(1)||[],p=s?.split(":")[1]?.trim(),l=i?.split(":")[1]?.trim();return{displayName:o,type:p,activity:l}};function fe(){const{id:a}=P(),[f,o]=n.useState(""),[t,s]=n.useState(!1),[i,p]=n.useState(!1),[l,v]=n.useState(!1),{messages:h,isLoading:E}=Q(),{isVideo:y,url:r}=_(h),k=R(h,H),A=K(k),{isFullscreen:F,toggleFullscreen:$}=Y();n.useEffect(()=>{G().currentUser||J("Cast Viewer").catch(d=>{console.error("Anonymous login failed:",d)})},[a]),n.useEffect(()=>{if(!y||!r)return;const u=()=>{const b=document.querySelectorAll("video"),C=document.querySelectorAll("iframe");b.forEach(c=>{c.paused&&(c.muted=!0,c.play().catch(x=>{console.log("Video autoplay attempt failed:",x),v(!0)}))}),C.forEach(c=>{if(c.src)try{const x=new URL(c.src,window.location.origin),j=x.searchParams;let T=!1;j.get("autoplay")!=="1"&&(j.set("autoplay","1"),T=!0),j.get("mute")!=="1"&&(j.set("mute","1"),T=!0),T&&(x.search=j.toString(),c.src=x.toString())}catch{if(!c.src.includes("autoplay=1")){const x=c.src.includes("?")?"&":"?";c.src+=`${x}autoplay=1&mute=1`}}})},d=setTimeout(u,500),S=setTimeout(u,2e3);return()=>{clearTimeout(d),clearTimeout(S)}},[y,r,h.length]),n.useEffect(()=>{const u=window.cast?.framework?.CastReceiverContext,d=navigator.userAgent,S=d.includes("CrKey")||d.includes("TV"),b=window.self!==window.top,C=u||S||window.location.search.includes("chromecast")||window.location.search.includes("receiver");return C&&(document.body.classList.add("cast-receiver-mode"),document.body.classList.remove("theme-light"),p(!0)),b&&document.body.classList.add("in-iframe"),()=>{C&&document.body.classList.remove("cast-receiver-mode"),b&&document.body.classList.remove("in-iframe")}},[]),n.useEffect(()=>{if(E)return;const u=h[h.length-1];u?.type==="settings"&&(s(!0),o(`${u.displayName} ${I("changedSettings")}`))},[h,E]);const B=()=>{document.querySelectorAll("video").forEach(d=>{d.paused&&d.play().catch(console.error)}),v(!1)};if(!k)return e.jsxs(g,{className:"flex-column cast-main-container",style:{backgroundImage:!y&&r?`url(${r})`:"none"},children:[!!r&&e.jsx(L,{url:r,isVideo:y}),l&&e.jsx(g,{onClick:B,className:"user-interaction-overlay",children:"Click to enable autoplay"}),e.jsx(N,{container:!0,spacing:0,direction:"column",alignItems:"center",justifyContent:"center",className:"cast-container cast-grid-container",children:e.jsx(N,{container:!0,justifyContent:"center",children:e.jsxs("div",{className:"action-box-large responsive-cast-box",children:[e.jsxs(m,{variant:"h2",className:"cast-title",children:["blitzedout.com/",a]}),E?e.jsx(m,{variant:"h4",className:"cast-loading-text",children:"Connecting to game..."}):e.jsx(m,{variant:"h4",className:"cast-ready-text",children:"Ready for game to start"})]})})})]});const{displayName:U,type:M,activity:w}=W(k);return e.jsxs(g,{className:"flex-column cast-main-container",onClick:l?B:void 0,style:{backgroundImage:!y&&r?`url(${r})`:"none",cursor:l?"pointer":"default"},children:[!!r&&e.jsx(L,{url:r,isVideo:y}),e.jsxs(g,{display:"flex",justifyContent:"space-between",className:"cast-header-bar",children:[e.jsx(g,{flex:"1",children:!i&&!F&&e.jsx(V,{variant:"text",onClick:$,className:"cast-fullscreen-button",children:I("fullscreen")})}),e.jsx(g,{textAlign:"center",flex:"1",children:!!A?.displayName&&e.jsx(m,{variant:"h4",className:"cast-next-player",children:e.jsx(q,{i18nKey:"nextPlayersTurn",values:{player:A.displayName}})})},A?.displayName),e.jsx(g,{flex:"1",textAlign:"right",className:"text-stroke",children:w&&e.jsxs(m,{variant:"h4",className:"cast-room-url",children:["blitzedout.com/",a]})})]}),e.jsx(N,{container:!0,spacing:0,direction:"column",alignItems:"center",justifyContent:"center",className:"cast-container cast-grid-container-adjusted",children:e.jsx(N,{container:!0,justifyContent:"center",children:w?e.jsxs(N,{size:12,className:"action-box-responsive responsive-cast-box",children:[e.jsx(m,{variant:"h3",className:"cast-type-text",children:`${M} ${I("for")} ${U}`}),e.jsx(g,{className:"cast-divider",children:e.jsx(z,{})}),e.jsx(m,{variant:"h1",className:"cast-activity-text",children:w})]}):e.jsx("div",{className:"action-box-responsive responsive-cast-box",children:e.jsxs(m,{variant:"h1",className:"cast-room-main",children:["blitzedout.com/",a]})})})},h.length),e.jsx(D,{open:!!t,close:()=>s(!1),hideCloseButton:!0,children:e.jsx(m,{variant:"h5",className:"cast-alert-text",children:f})})]})}export{fe as default};
