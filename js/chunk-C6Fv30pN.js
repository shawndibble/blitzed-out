import{r as f,j as h,am as T}from"./chunk-DX6P0x0s.js";import{c as B}from"./chunk-kXcKns83.js";import{g as M}from"./chunk-B4PEA_xj.js";import{i as S}from"./chunk-ClG1-VUV.js";import{l as U}from"./chunk-EL58PX5i.js";import{u as z}from"./chunk-CE037ghn.js";const E=e=>e&&/\.(jpe?g|png|gif|webp|bmp|svg)(\?.*)?$/i.test(e)?"image":"video";function O({url:e}){const[n,t]=f.useState(E(e)),[r,o]=f.useState(e);if(f.useEffect(()=>{o(e),t(E(e))},[e]),!r)return null;const u=()=>{const c=r??e??"";let m=!1;try{const i=new URL(c);m=i.host==="imgur.com"||i.host==="i.imgur.com"}catch{m=!1}if(m){const i=c.match(/(?:i\.)?imgur\.com\/([a-zA-Z0-9]+)(?:\.[a-z]+)?/)?.[1];if(i){const l=`https://i.imgur.com/${i}.jpg`;o(l),t("image");return}}const s=`${c.replace(/\.(mp4|webm|ogg|mov)(\?.*)?$/i,"")}.jpg`;o(s),t("image")},d=()=>{const c=r??e??"";let m=!1;try{const a=new URL(c);m=a.host==="imgur.com"||a.host==="i.imgur.com"}catch{m=!1}if(m){const a=c.match(/(?:i\.)?imgur\.com\/([a-zA-Z0-9]+)(?:\.[a-z]+)?/)?.[1];if(a){const s=["jpg","png","gif","jpeg","webp"],i=r?.split(".").pop(),p=s.indexOf(i||"")+1;if(p<s.length){const b=s[p],y=`https://i.imgur.com/${a}.${b}`;o(y)}}}else{const a=["jpg","png","gif","jpeg","webp"],s=r?.split(".").pop(),l=a.indexOf(s||"")+1;if(l<a.length&&r){const p=a[l],y=`${r.replace(/\.[^.]+(\?.*)?$/,"")}.${p}`;o(y)}}};return n==="video"?h.jsx("video",{autoPlay:!0,loop:!0,muted:!0,playsInline:!0,src:r||void 0,className:"video-background",onError:u,preload:"auto",crossOrigin:"anonymous",controls:!0}):h.jsxs(h.Fragment,{children:[h.jsx("div",{className:"image-background",style:{backgroundImage:r?`url("${String(r).replace(/"/g,'\\"')}")`:void 0,backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat",width:"100%",height:"100%",position:"absolute",top:0,left:0}}),h.jsx("img",{src:r||void 0,onError:d,style:{display:"none"},alt:""})]})}function P({images:e,className:n,zoomDuration:t=3e3,zoomScale:r=1.4}){const[o,u]=f.useState(0),[d,c]=f.useState(0),m=f.useRef(null);if(f.useEffect(()=>{if(e.length===0||e.length===1)return;const s=()=>{m.current=window.setInterval(()=>{u(l=>(l+1)%e.length),c(l=>l+1)},t)},i=window.setTimeout(s,1e3);return()=>{window.clearTimeout(i),m.current&&(window.clearInterval(m.current),m.current=null)}},[e.length,t]),f.useEffect(()=>()=>{m.current&&(window.clearInterval(m.current),m.current=null)},[]),e.length===0)return null;const a=e[o];return h.jsx("div",{className:B("image-slideshow-container",n),"aria-hidden":!0,children:h.jsx("div",{className:"image-slideshow-slide",style:{backgroundImage:`url(${a})`,animationDuration:`${t}ms`,"--zoom-scale":r}},d)})}function $(e){return e.replace(/&amp;/g,"&")}async function H(e,n,t){const r=new Set;let o=null;const u=[s=>`https://api.reddit.com/r/${e}/top.json?limit=100&t=year&raw_json=1${s?`&after=${s}`:""}`,s=>`https://api.reddit.com/r/${e}/hot.json?limit=100&raw_json=1${s?`&after=${s}`:""}`],d="r.jina.ai",c=s=>`https://${d}/http://${s.replace(/^https?:\/\//,"")}`,m=async s=>{try{const i=await fetch(s,{signal:t,credentials:"omit",mode:"cors"});if(i.ok){const l=await i.text();try{return JSON.parse(l)}catch{const p=l.indexOf("{"),b=l.lastIndexOf("}");if(p!==-1&&b!==-1&&b>p)try{return JSON.parse(l.slice(p,b+1))}catch{return null}return null}}}catch{}try{const i=await fetch(c(s),{signal:t,credentials:"omit",mode:"cors"});if(!i.ok)return null;const l=await i.text();try{return JSON.parse(l)}catch{const p=l.indexOf("{"),b=l.lastIndexOf("}");if(p!==-1&&b!==-1&&b>p)try{return JSON.parse(l.slice(p,b+1))}catch{return null}return null}}catch{return null}};let a=0;for(;r.size<n&&a<u.length;){o=null;for(let s=0;s<5&&r.size<n;s+=1){const i=u[a](o),l=await m(i);if(!l)break;const p=l?.data?.children??[];o=l?.data?.after??null;for(const b of p){const y=b?.data;if(!y)continue;const I=y.url_overridden_by_dest,A=y.post_hint;if(y.is_gallery&&y.media_metadata&&y.gallery_data){const v=y.gallery_data.items||[];for(const F of v){const k=y.media_metadata[F.media_id],x=k?.s?.u||k?.s?.gif||k?.s?.mp4;if(typeof x=="string"){const j=x.startsWith("http")?x:`https:${x}`;/\.(jpe?g|png|gif|webp)(\?.*)?$/i.test(j)&&r.add($(j))}}continue}if(A==="image"&&typeof I=="string"&&/\.(jpe?g|png|gif|webp)(\?.*)?$/i.test(I)){r.add($(I));continue}const w=y.preview?.images?.[0]?.source?.url;if(w){const v=w.startsWith("http")?w:`https:${w}`;r.add($(v))}}if(!o)break}a+=1}return Array.from(r).slice(0,n)}async function D(e,n){const t=e.maxImages||150;switch(e.type){case"reddit":{const r=Z(e.url);if(!r)throw new Error("Invalid Reddit URL");return{images:await H(r,t,n),source:`r/${r}`}}case"custom":return{images:[e.url],source:"Custom"};default:throw new Error(`Unsupported feed type: ${e.type}`)}}function _(e){return C(e)?"reddit":null}function C(e){try{const n=new URL(e);return/(^|\.)reddit\.com$/i.test(n.hostname)&&/\/r\//i.test(n.pathname)}catch{return!1}}function Z(e){try{return new URL(e).pathname.match(/\/r\/([^/]+)/i)?.[1]??null}catch{return null}}const J=3e5,L=new Map,R=new Map;async function K(e,n){const t=JSON.stringify(e),r=Date.now(),o=L.get(t);if(o&&r-o.fetchedAt<J)return o.result;const u=R.get(t);if(u)try{return await u}catch{}const d=D(e,n).then(c=>(L.set(t,{fetchedAt:Date.now(),result:c}),c)).finally(()=>{R.delete(t)});return R.set(t,d),d}function W(e){const[n,t]=f.useState([]),[r,o]=f.useState(!1),[u,d]=f.useState(null),[c,m]=f.useState(null),a=f.useRef(null);return f.useEffect(()=>{if(a.current&&a.current.abort(),t([]),d(null),m(null),!e){o(!1);return}o(!0);const s=new AbortController;a.current=s;const i=async()=>{try{const p=await K(e,s.signal);if(s.signal.aborted)return;t(p.images),m(p.source),d(null)}catch(p){if(s.signal.aborted)return;d(p instanceof Error?p.message:"Failed to load images"),t([]),m(null)}finally{s.signal.aborted||o(!1)}},l=window.setTimeout(i,300);return()=>{s.abort(),window.clearTimeout(l)}},[e]),f.useEffect(()=>()=>{a.current&&a.current.abort()},[]),{images:n,isLoading:r,error:u,source:c}}function V({url:e}){const n=f.useMemo(()=>{const u=_(e);return u?{type:u,url:e,maxImages:150}:null},[e]),{images:t,isLoading:r,error:o}=W(n);return r?h.jsx("div",{className:"slideshow-container slideshow-loading","aria-hidden":!0,children:h.jsx("div",{className:"loading-message",children:"Loading images..."})}):o||t.length===0?null:h.jsx(P,{images:t})}function be({url:e=null,isVideo:n=null}){const t=e&&/\.(mp4|webm|ogg|mov|gif)(\?.*)?$/i.test(e),o=!!(e?_(e):null),u=e==="color"||e==="gray"||e?.includes("/color")||e?.includes("/gray"),d=e&&!u&&(n||!n&&e);return h.jsxs(T,{className:B("main-container",!d&&"default-background"),role:"presentation",sx:{backgroundImage:!n&&e&&!u&&!o?`url(${e})`:"none"},children:[n&&!o&&(t?h.jsx(O,{url:e}):h.jsx("iframe",{width:"100%",height:"100%",src:e||void 0,title:"video",allow:"autoplay; fullscreen; encrypted-media; picture-in-picture",sandbox:"allow-same-origin allow-scripts allow-presentation",style:{border:0}})),!n&&o&&e?h.jsx(V,{url:e}):null]})}function X(e){const n=/vimeo\.com\/(\d+)/,t=e.match(n);return`https://player.vimeo.com/video/${t?t[1]:""}?autoplay=1&loop=1&autostart=true`}function Y(e){const n=/(?:youtube\.com\/(?:[^/]+\/.+\/|(?:v|e(?:mbed)?)\/|[^#]*[?&]v=|youtu\.be\/)([^"&?/ ]{11})|^(?:[^"&?/ ]{11})$)/,t=e.match(n);return`https://www.youtube.com/embed/${t?t[1]:""}?autoplay=1&loop=1&autostart=true&mute=1&playsinline=1&controls=0&disablekb=1&fs=0&modestbranding=1&rel=0&iv_load_policy=3`}function q(e){const n=/drive\.google\.com\/file\/d\/([^/]+)/,t=e.match(n);return`https://drive.google.com/file/d/${t?t[1]:""}/preview?loop=1`}function G(e){const n=/dropbox\.com\/s\/([^/]+)/,t=e.match(n);return`https://www.dropbox.com/s/${t?t[1]:""}?raw=1`}function Q(e){return`https://pornhub.com/embed/${new URL(e).searchParams.get("viewkey")||""}?autoplay=1&loop=1&autostart=true&playsinline=1`}function ee(e){const n=e.split("-");return`https://xhamster.com/xembed.php?video=${n[n.length-1]}?autoplay=1&loop=1&autostart=true&playsinline=1`}function te(e){const n=/media\.tenor\.com\/([a-zA-Z0-9_-]+)\/[^/]*\.(mp4|gif|webp)/;if(e.match(n))return e;const r=/tenor\.com\/view\/[^/]*-(\d+)/,o=e.match(r);return`https://tenor.com/embed/${o?o[1]:""}?autoplay=1`}function ne(e){const n=/giphy\.com\/gifs\/[^/]*-([a-zA-Z0-9]+)/,t=e.match(n);return`https://media.giphy.com/media/${t?t[1]:""}/giphy.gif`}function re(e){const n=/(?:gfycat\.com|redgifs\.com)\/(?:watch\/)?([a-zA-Z0-9]+)/,t=e.match(n),r=t?t[1]:"";return g(e,["redgifs.com"])?`https://files.redgifs.com/${r}.mp4`:`https://giant.gfycat.com/${r}.mp4`}function oe(e){const n=/redtube\.com\/(\d+)/,t=e.match(n);return`https://embed.redtube.com/?id=${t?t[1]:""}&autoplay=true&auto_play=1&playsinline=1&controls=1`}function se(e){const n=/youporn\.com\/watch\/(\d+)/,t=e.match(n);return`https://www.youporn.com/embed/${t?t[1]:""}?autoplay=1&playsinline=1`}function ie(e){const n=/tube8\.com\/[^/]+\/[^/]+\/(\d+)/,t=e.match(n);return`https://www.tube8.com/embed/${t?t[1]:""}?autoplay=1&playsinline=1`}function ce(e){return`https://twitframe.com/show?url=${encodeURIComponent(e)}`}function ae(e){try{const o=new URL(e);if((o.host==="discordapp.net"||o.host.endsWith(".discordapp.net"))&&o.pathname.startsWith("/external/")&&(o.pathname.includes("/https/i.imgur.com/")||o.pathname.includes("/https/imgur.com/")))return e}catch(o){U.debug("URL parsing failed for Discord proxy check:",o)}let n="",t=!1;try{const o=new URL(e);t=o.host==="imgur.com"||o.host==="i.imgur.com"}catch(o){return U.debug("URL parsing failed for Imgur processing:",o),""}if(!t)return"";if(e.includes("/gallery/")){const o=e.match(/imgur\.com\/gallery\/[^#]*#([a-zA-Z0-9]+)/);if(o)n=o[1];else{const u=e.match(/#([a-zA-Z0-9]+)/);u&&(n=u[1])}}else{const o=/imgur\.com\/([a-zA-Z0-9]+)(?:\.(mp4|jpg|jpeg|png|gif|webp))?|images-ext-\d+\.discordapp\.net\/external\/[^/]+\/https\/i\.imgur\.com\/([a-zA-Z0-9]+)\.(mp4|jpg|jpeg|png|gif|webp)/,u=e.match(o);n=u?u[1]||u[3]:""}return`https://i.imgur.com/${n}.mp4`}function N(e){return/\.(mp4|webm|ogg|mov)(\?.*)?$/.test(e)}function ue(e){return g(e,["media.discordapp.net","cdn.discordapp.com"])&&!N(e)}function g(e,n){try{const t=new URL(e);return n.some(r=>t.host===r||t.host.endsWith("."+r))}catch(t){return U.debug("URL parsing failed in isValidHost, rejecting for security:",t),!1}}function de(e){let n=null,t=!0;if(!e)return{url:"",isVideo:!1};switch(!0){case g(e,["vimeo.com"]):n=X(e);break;case g(e,["youtube.com","youtu.be"]):n=Y(e);break;case g(e,["drive.google.com"]):n=q(e);break;case g(e,["pornhub.com"]):n=Q(e);break;case g(e,["xhamster.com"]):n=ee(e);break;case g(e,["dropbox.com"]):n=G(e);break;case g(e,["imgur.com","i.imgur.com"]):n=ae(e);break;case g(e,["tenor.com","media.tenor.com"]):n=te(e),t=!0;break;case g(e,["giphy.com"]):n=ne(e),t=!0;break;case g(e,["gfycat.com","redgifs.com"]):n=re(e),t=!0;break;case g(e,["redtube.com"]):n=oe(e);break;case g(e,["youporn.com"]):n=se(e);break;case g(e,["tube8.com"]):n=ie(e);break;case g(e,["twitter.com","x.com"]):n=ce(e),t=!1;break;case g(e,["thisvid.com"]):n=e;break;case g(e,["boyfriendtv.com"]):n=e;break;case ue(e):n=e,t=!1;break;case N(e):n=e;break;default:n=M(e),t=!1;break}return{url:n,isVideo:t}}function we(e,n){const{background:t,backgroundURL:r,roomBackground:o,roomBackgroundURL:u}=e,d=(a,s)=>{if(!a)return null;if(a==="custom")return s?u||null:r||null;if(a==="useAppBackground"){const i=t||"color";return i==="useRoomBackground"?"color":i==="custom"?r||null:i}if(a==="useRoomBackground"){if(S(n))return"color";const i=o||"useAppBackground";return i==="useAppBackground"?"color":i==="custom"?u||null:i}return a};let c=null;return!S(n)&&o&&o!=="useAppBackground"?c=d(o,!0):t?c=d(t,!1):c="color",c?c==="color"||c==="gray"?{url:c,isVideo:!1}:de(c):{url:null,isVideo:!1}}function le(e){return{uid:e.uid,displayName:e.displayName,isSelf:e.isSelf,isFinished:e.isFinished}}function xe(e){const[n,t]=f.useState(null),r=z(),o=f.useMemo(()=>r.map(d=>`${d.uid}-${d.displayName}-${d.isFinished}-${d.isSelf}`).join("|"),[r]),u=f.useMemo(()=>e?`${e.uid}-${e.displayName||""}`:null,[e]);return f.useEffect(()=>{if(!e){t(null);return}if(r.length<=1){t(null);return}const d=r.filter(i=>!i.isFinished);if(d.length<=1){t(null);return}let c=-1;c=d.findIndex(i=>i.uid===e.uid),c===-1&&(c=d.findIndex(i=>i.displayName===e.displayName)),c===-1&&(c=0);const m=(c+1)%d.length,a=d[m],s=le(a);t(s)},[u,o]),n}export{be as R,we as g,de as p,xe as u};
