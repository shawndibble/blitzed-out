const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["js/userList.tsx-WW2hodBh.js","js/chunk-DEpGQMoM.js","js/chunk-Bb4N9MXk.js","js/chunk-C0b6J2Rd.js","js/chunk-BxyRzOKK.js","js/chunk-B9w7spwz.js","js/chunk-CoGo4D6A.js","js/index.tsx-yBpNJhJV.js","js/chunk-lEjw_34E.js","js/chunk-CZcF1WFm.js","assets/index-dNlpAFRr.js","js/chunk-DsiWUki8.js","js/chunk-BoJodteh.js","js/index.tsx-BkVRaNPT.js","js/index.tsx-CpDqH95I.js","js/chunk-_0lUQytc.js","js/chunk-Chz5q09A.js","js/chunk-Bmx5YEUT.js","js/chunk-GpkVa6vM.js","js/chunk-B2sPFThL.js","js/chunk-DvCTttl3.js","js/chunk-BYx9JuG3.js","js/chunk-DaPeuy_K.js","js/chunk-Cyj7neDD.js","js/chunk-Dr6SPH8a.js","js/chunk-CFN5SuUV.js","js/index.tsx-CkkwFdrA.js"])))=>i.map(i=>d[i]);
import{p as E,m as v,_ as l}from"./chunk-C0b6J2Rd.js";import{R as C,aj as j,b as c,j as o,ak as R,al as T,am as p,an as D,ao as A,ap as L}from"./chunk-DEpGQMoM.js";import{A as S}from"./chunk-CZcF1WFm.js";import{a as I}from"./chunk-Bb4N9MXk.js";import{A as m,l as d}from"../assets/index-dNlpAFRr.js";(function(){var e=typeof window!="undefined"?window:typeof global!="undefined"?global:typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:{};e.SENTRY_RELEASE={id:"b82d01bea29447e452b49ba3e85b9fac2f7942a4"}})();try{(function(){var e=typeof window!="undefined"?window:typeof global!="undefined"?global:typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:{},s=new e.Error().stack;s&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[s]="c524a9c0-2059-498c-b2a3-46bda3615542",e._sentryDebugIdIdentifier="sentry-dbid-c524a9c0-2059-498c-b2a3-46bda3615542")})()}catch(e){}function y(e){if(!e)return null;try{if(typeof e.toDate=="function")return e.toDate();if(typeof e=="string"){const s=new Date(e);if(isNaN(s.getTime()))throw new Error("Invalid serialized timestamp format");return s}else if(typeof e=="number"){const s=e<3250368e4?e*1e3:e,t=new Date(s);if(isNaN(t.getTime()))throw new Error("Invalid numeric timestamp format");return t}else if(typeof e=="object"&&e.seconds!==void 0){const s=e,t=new Date(s.seconds*1e3+(s.nanoseconds||0)/1e6);if(isNaN(t.getTime()))throw new Error("Invalid Firestore timestamp object format");return t}else{if(e instanceof Date)return e;throw console.warn("Unsupported timestamp format:",typeof e,e),new Error(`Unsupported timestamp format: ${typeof e}`)}}catch(s){return console.warn("Failed to parse timestamp:",s),null}}function h(e){return e.sort((s,t)=>{const r=y(s.timestamp),n=y(t.timestamp);return!r||!n?0:r.getTime()-n.getTime()})}function f(e){return JSON.parse(JSON.stringify(e)).reverse()}function P(e,s){return f(e).find(t=>t.type===s)}function N(e,s,t="ASC"){let r=f(e);return t==="DESC"&&(r=r.reverse()),r.filter(n=>n.type===s)}function K(e,s){return f(e).find(s)}function O(e){return f(e)[0]}const U={messages:[],loading:!0,error:null,room:null,paginationCursor:null},B=I()(E((e,s)=>({...U,loadMessages:t=>{const n=h(t);e({messages:n,loading:!1,error:null})},addMessage:t=>{const{messages:r}=s();if(r.find(i=>i.id===t.id))return;const a=[...r,t],u=h(a);e({messages:u})},updateMessage:(t,r)=>{const{messages:n}=s();let a=!1;const u=n.map(i=>{if(i.id===t){const g={...i,...r};if(Object.keys(r).some(w=>i[w]!==r[w]))return a=!0,g}return i});if(a){const i=h(u);e({messages:i})}},clearMessages:()=>{e({messages:[],loading:!1,error:null})},setLoading:t=>{const{loading:r}=s();r!==t&&e({loading:t})},setError:t=>{const{error:r}=s();r!==t&&e({error:t})},setRoom:t=>{const{room:r}=s();r!==t&&e({room:t})},setPaginationCursor:t=>{const{paginationCursor:r}=s();r!==t&&e({paginationCursor:t})},getMessagesByType:t=>{const{messages:r}=s(),n=[];for(let a=0;a<r.length;a++)r[a].type===t&&n.push(r[a]);return n},getLatestMessage:()=>{const{messages:t}=s();return O(t)},getLatestMessageByType:t=>{const{messages:r}=s();return P(r,t)},getFilteredMessages:t=>{const{messages:r}=s(),n=[];for(let a=0;a<r.length;a++)t(r[a])&&n.push(r[a]);return n},getOrderedMessagesByType:(t,r="ASC")=>{const{messages:n}=s();return N(n,t,r)}}),{name:"messages-storage",partialize:e=>({messages:e.messages,room:e.room,paginationCursor:e.paginationCursor}),onRehydrateStorage:()=>e=>{if(e){const s=new Date;s.setHours(s.getHours()-24);const t=e.messages.filter(r=>{try{const n=y(r.timestamp);if(!n)throw console.warn(`Failed to parse timestamp for message ${r.id}:`,typeof r.timestamp,r.timestamp),new Error(`Failed to parse timestamp for message ${r.id}`);return n>s}catch(n){return console.warn(`Failed to parse message timestamp for message ID ${r.id}:`,n.message),!0}});t.length!==e.messages.length&&e.loadMessages(t)}}})),F=C.createContext(void 0);function x(e){const{id:s}=j(),{messages:t,loading:r,loadMessages:n,setLoading:a,setRoom:u,clearMessages:i}=B();c.useEffect(()=>{if(a(!0),u(s||null),!s){i();return}return v(s,M=>{n(M)})},[s,n,a,u,i]);const g={messages:t,isLoading:r};return o.jsx(F.Provider,{value:g,...e})}const _=d(()=>l(()=>import("./userList.tsx-WW2hodBh.js"),__vite__mapDeps([0,1,2,3,4,5,6])).then(e=>({default:e.UserListProvider}))),k=d(()=>l(()=>import("./index.tsx-yBpNJhJV.js"),__vite__mapDeps([7,1,2,8,3,4,5,9,10,11,12,6,13]))),z=d(()=>l(()=>import("./index.tsx-CpDqH95I.js"),__vite__mapDeps([14,1,2,15,16,12,9,3,4,5,10,6,17,18,19,20]))),V=d(()=>l(()=>import("./chunk-BYx9JuG3.js").then(function(e){return e.i}),__vite__mapDeps([21,3,1,2,4,5,22,11,12,9,10,6,19,23,20,24,25,16,17,26,15,18])));function b({children:e}){const{id:s}=j(),t=A(),r=L();return c.useEffect(()=>{if(s&&s!==s.toUpperCase()){const n=r.pathname.replace(s,s.toUpperCase());t(n+r.search+r.hash,{replace:!0})}},[s,t,r]),o.jsx(o.Fragment,{children:e})}function $(){const e=c.useContext(S);if(c.useEffect(()=>(e&&(window.authContext=e),()=>{window.authContext=null}),[e]),!e||e.initializing)return o.jsx(m,{});const s=e.user?o.jsx(V,{}):o.jsx(k,{});return o.jsxs(T,{children:[o.jsx(p,{path:"/",element:o.jsx(D,{replace:!0,to:"/PUBLIC"})}),o.jsx(p,{path:"/:id/cast",element:o.jsx(b,{children:o.jsx(c.Suspense,{fallback:o.jsx(m,{}),children:o.jsx(_,{children:o.jsx(x,{children:o.jsx(z,{})})})})})}),o.jsx(p,{path:"/:id",element:o.jsx(b,{children:o.jsx(c.Suspense,{fallback:o.jsx(m,{}),children:o.jsx(_,{children:o.jsx(x,{children:s})})})})})]})}function H(){return o.jsx(R,{children:o.jsx($,{})})}const Q=Object.freeze({__proto__:null,default:H});export{F as M,K as a,Q as i,P as l,N as o,y as p};
//# sourceMappingURL=chunk-DfnjTLcn.js.map
