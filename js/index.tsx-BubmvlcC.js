const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["js/index.tsx-DfeU3N-t.js","js/chunk-Vuzv59E5.js","js/chunk-CfN-ANIX.js","js/chunk-CuMUTfgR.js","js/chunk-Bp62TkGl.js","js/chunk-DQ5s95rP.js","js/chunk-CwKBHVCv.js","assets/index-NXMOp5SB.js","js/chunk-Bde8qXua.js","js/chunk-Cx3PWYtd.js","js/chunk-DwDV8mEA.js","js/chunk-BgYdbRXR.js","js/chunk-DOYo4UL0.js","js/chunk-6JIRnTv3.js","js/chunk-D0hPV1-j.js","js/chunk-C3rktb3S.js","js/chunk-DXy1pfJx.js","js/chunk-B4PEA_xj.js","js/index.tsx-xUTycLdi.js","js/chunk-D2uAZ6cE.js","js/chunk-DRmAB0Tz.js","js/chunk-CdqjB6VB.js","js/index.tsx-DRdJTTR2.js","js/chunk-C-jP-jn5.js"])))=>i.map(i=>d[i]);
import{l as F,a as ee,u as w,s as te,b as se,p as ne,g as re,c as oe,d as ae,t as k,_ as U,f as ie}from"../assets/index-NXMOp5SB.js";import{j as t,i as L,A as le,P as ue,m as ce,n as me,o as de,p as fe,M as pe,q as ge,s as he,t as xe,B as E,v as be,w as je,T as J,h as _,x as K,y as Se,z as ye,E as Re,H as Te,C as Ce}from"./chunk-Vuzv59E5.js";import Me from"./index.tsx-BEslo-n3.js";import Ne from"./index.tsx-vlyesCuJ.js";import{g as ve,R as De}from"./chunk-Gcf1ipdU.js";import{T as Q}from"./chunk-CwKBHVCv.js";import{u as z}from"./chunk-DwDV8mEA.js";import{u as Y}from"./chunk-DXy1pfJx.js";import{u as Be}from"./chunk-BohQZKjk.js";import{r as n,m as ke,u as Ae}from"./chunk-CfN-ANIX.js";import{T as W}from"./chunk-C3rktb3S.js";import Le from"./index.tsx-DUWm3NP2.js";import{u as V}from"./chunk-Cx3PWYtd.js";import{a as we}from"./chunk-C-jP-jn5.js";import{u as Ee}from"./chunk-PTntF1Bg.js";import{u as Ie,s as Pe}from"./chunk-DQ5s95rP.js";import{i as Oe}from"./chunk-BgYdbRXR.js";import{u as X}from"./chunk-DOYo4UL0.js";import{i as I,a as Z}from"./chunk-Bp62TkGl.js";import{u as _e}from"./chunk-6JIRnTv3.js";import{N as q}from"./chunk-y6TAERsj.js";import{u as Ge}from"./chunk-D2uAZ6cE.js";import"./chunk-Bde8qXua.js";import"./chunk-CuMUTfgR.js";import"./chunk-DRmAB0Tz.js";import"./chunk-B4PEA_xj.js";import"./chunk-D0hPV1-j.js";function $e(){const{messages:i}=Y(),[o,l]=n.useState(!1),r=F(i,"actions"),s=ee(i),c=Be(r),{playerDialog:a,othersDialog:f}=z()[0];if(n.useEffect(()=>{!c||s!==r||l(!0)},[c,s,r]),!r||!c)return null;const d=c?.isSelf;return!f&&d||!a&&!d?t.jsx(Q,{open:o,close:()=>l(!1),type:d?"error":"info",vertical:"top",horizontal:"center",disableAutoHide:!0,children:d?t.jsx(W,{i18nKey:"yourTurn"}):t.jsx(W,{i18nKey:"playersTurn",values:{player:c.displayName}})}):null}function Fe(i){const o=i.filter(s=>s).map(s=>s.split(": ")),l=[];o.forEach((s,c)=>{if(Number(s[1])===0)return;const a=Array(Number(s[1])).fill(c);l.push(...a)});const r=l[Math.floor(Math.random()*l.length)];return o.map(([s])=>s)[r]?.replace(/(\r\n|\n|\r)/gm,"")||""}function Ue(i,o,l){if(!i)return"";const r=i.split("%");return r.length<=1?we(i,o||"",l||""):Fe(r)}function ze(i,o,l=[]){const{user:r}=V(),{t:s}=w(),c=Ee(),a=l.length,[f,d]=n.useState(l[0]||{}),p=a-1,b=n.useRef(0),y=n.useCallback((m,h,j,e)=>{if(!m){console.error("Tile not found at location:",j);return}let u="";const T=Ue(m.description||"",m.role||"",r?.displayName||"");h!==-1&&(u+=`${s("roll")}: ${h}
`),u+=`#${j+1}: ${m.title||s("unknownTile")}
`,u+=`${s("action")}: ${T}`,te({room:i,user:r,text:e?e+u:u,type:"actions"})},[i,r,s]),g=n.useCallback(m=>{if(m===-1)return{preMessage:`${s("restartingGame")}
`,newLocation:0};const h=c.find(e=>e.isSelf)?.location||0;if(h===p)return{preMessage:`${s("alreadyFinished")}
`,newLocation:m};const j=m+h;return j>=p?{newLocation:p}:{newLocation:j}},[s,c,p]);return n.useEffect(()=>{const m=Array.isArray(o.value)?o.value[0]:o.value,h=o.time;if(m===0||h<=b.current)return;b.current=h;const{preMessage:j,newLocation:e}=g(m);e>=0&&e<l.length&&l[e]?(d({...l[e],index:e}),y(l[e],m,e,j)):console.error(`Invalid location or missing tile: ${e}, gameBoard length: ${l.length}`)},[o,l,y,g]),{tile:f,playerList:c}}function Ve(i,o){const{user:{displayName:l}}=V(),[r,s]=n.useState(null),[c,a]=n.useState(l||"");n.useEffect(()=>{(r!==i||l!==c)&&(se({newRoom:i,oldRoom:r,newDisplayName:l||"",oldDisplayName:c,removeOnDisconnect:o||i?.toUpperCase()==="PUBLIC"}),s(i),a(l||""))},[i,l,r,c,o])}function He(i,o){const l=n.useRef(void 0);return n.useCallback((...r)=>{l.current&&clearTimeout(l.current),l.current=setTimeout(()=>i(...r),o)},[i,o])}function Je(i,o){const{i18n:r,t:s}=w(),{user:c}=V(),[a,f]=z(),d=X(()=>re(a?.gameMode)),{messages:p,isLoading:b}=Y(),[y,g]=n.useState("1d6"),[m,h]=n.useState(""),j=Ie(),e=n.useRef(!1),u=n.useRef(!0),T=n.useCallback(async(x,R=null)=>{if(!e.current){e.current=!0;try{const{gameMode:C,newBoard:M}=await j(x),N={formData:{...a,...x},user:c,customTiles:d,actionsList:await Oe(r.resolvedLanguage,C||"online"),tiles:M,title:s("settingsGenerated")};R&&(N.reason=s("rebuiltBoard",{messageUser:R})),await Pe(N)}finally{setTimeout(()=>{e.current=!1},500)}}},[a,c,d,r.resolvedLanguage,s,j]),D=n.useCallback(async()=>{a?.room!==i&&(await f({...a,room:i}),await T({...a,roomUpdated:!0,room:i}))},[a,i,f,T]),B=He(D,200);return n.useEffect(()=>{if(!(b||!p.length))try{const x=F(p,"room");if(x){const R=JSON.parse(x.settings),{roomDice:C,roomBackgroundURL:M,roomTileCount:N}=R;let P="1d6";!I(i)&&C&&(P=C),g(P),h(M||"");const O=ne(x.timestamp),v=(O?Date.now()-O.getTime():1/0)<300*1e3;x.uid!==c?.uid&&N&&o?.length&&N!==o?.length&&v&&!e.current&&T(R,x.displayName)}}catch(x){console.error("Error processing room message:",x)}},[p,b,i,c,o,T]),n.useEffect(()=>{if(!b)try{const x=F(p,"room");if(x||!I(i)&&!x||I(i)&&!Z(a?.gameMode||""))return;if(u.current){u.current=!1,a?.roomBackgroundURL?.length&&h(a.roomBackgroundURL);return}const R=i!==a?.room,C=a&&typeof a.room<"u",M=o?.length,N=!e.current;if(C&&R&&M&&N){B();return}a?.roomBackgroundURL?.length&&h(a.roomBackgroundURL)}catch(x){console.error("Error in room change effect:",x)}},[i,a,o,p,b,B]),{roller:y,roomBgUrl:m}}function Ke(i,o){const[l,r]=n.useState(null),[s,c]=ke(),a=s.get("importBoard"),{t:f}=w(),d=n.useCallback(()=>{r(null)},[]),p=n.useCallback(g=>{try{const m=JSON.parse(g);return Array.isArray(m)?m:null}catch{return null}},[]),b=n.useCallback(g=>{try{return g?JSON.parse(g):{}}catch{return{}}},[]),y=n.useCallback(async()=>{if(c({}),!a)return;const g=await oe(a);if(!g?.gameBoard)return r(f("failedBoardImport"));const m=p(g.gameBoard);if(!m)return r(f("failedBoardImport"));const h=g?.title!==f("settingsGenerated")?g.title:f("importedBoard");ae({...g,title:h,tiles:m,isActive:1});const j=b(g?.settings);o({...i,...j}),l!==f("updated")&&r(f("updated"))},[a,p,b,i,o,f,l,c]);return n.useEffect(()=>{a&&y()},[a,y]),[l,d]}const We=({selectedRoll:i,handleMenuItemClick:o})=>{const[l,r]=n.useState(!1),s=n.useRef(null),c=()=>{r(d=>!d)},a=d=>{d.target instanceof Node&&s.current?.contains(d.target)||r(!1)},f=new Map;return f.set("restart",k("restart")).set("manual",k("manual")).set("30",k("auto30")).set("60",k("auto60")).set("90",k("auto90")).set("custom",k("setTimer")),t.jsxs(t.Fragment,{children:[t.jsx(L,{size:"small","aria-controls":l?"split-button-menu":void 0,"aria-expanded":l?"true":void 0,"aria-label":"select roll options","aria-haspopup":"menu",onClick:c,ref:s,children:t.jsx(le,{})}),t.jsx(ue,{sx:{zIndex:1},open:l,anchorEl:s.current,transition:!0,disablePortal:!0,placement:"top-end",children:({TransitionProps:d})=>t.jsx(ce,{...d,style:{transformOrigin:"right bottom"},children:t.jsx(me,{children:t.jsx(de,{onClickAway:a,children:t.jsx(fe,{id:"split-button-menu",autoFocusItem:!0,children:Array.from(f).map(([p,b])=>t.jsx(pe,{selected:p===i,onClick:()=>o(p),children:b},p))})})})})})]})},A=10,qe=({isOpen:i,onClose:o,onSubmit:l})=>{const{t:r}=w(),[s,c]=n.useState(30),[a,f]=n.useState(!1),[d,p]=n.useState(!1),[b,y]=n.useState(20),[g,m]=n.useState(60),h=()=>{if(d){let e=Number.parseInt(String(b),10),u=Number.parseInt(String(g),10);Number.isNaN(e)?(e=a?1:A,y(e)):!a&&e<A&&(e=A),Number.isNaN(u)||u<e?(u=e,m(u)):u===0&&(u=180,m(u)),a&&(e*=60,u*=60);const T=Math.floor(Math.random()*(u-e+1))+e;l(T,{isRange:!0,min:e,max:u})}else{let e=Number.parseInt(String(s),10);Number.isNaN(e)?(e=a?1:A,c(e)):a?e*=60:e<A&&(e=A),l(e,{isRange:!1})}o()},j=()=>{c(e=>{const u=Number.parseFloat(String(e));return Number.isNaN(u)||u<=0?e:a?(u*60).toString():(u/60).toString()}),y(e=>{const u=Number.parseFloat(String(e));return Number.isNaN(u)||u<=0?e:a?(u*60).toString():(u/60).toString()}),m(e=>{const u=Number.parseFloat(String(e));return Number.isNaN(u)||u<=0?e:a?(u*60).toString():(u/60).toString()}),f(e=>!e)};return t.jsxs(ge,{open:i,onClose:o,maxWidth:"xs",children:[t.jsx(he,{children:r("setTimer")}),t.jsxs(xe,{children:[t.jsx(E,{sx:{mb:2},children:t.jsx(be,{control:t.jsx(je,{checked:d,onChange:e=>p(e.target.checked)}),label:r("useRandomRange")})}),d?t.jsxs(E,{children:[t.jsx(J,{variant:"subtitle2",children:r("randomTimerRange")}),t.jsxs(E,{sx:{display:"flex",gap:2,my:2},children:[t.jsx(_,{label:r("minValue"),type:"number",value:b,onChange:e=>{const u=parseInt(e.target.value,10);y(u)},fullWidth:!0}),t.jsx(J,{variant:"body1",sx:{alignSelf:"center"},children:"-"}),t.jsx(_,{label:r("maxValue"),type:"number",value:g,onChange:e=>{const u=parseInt(e.target.value,10);m(Math.max(Number(b),u))},fullWidth:!0})]}),t.jsxs(L,{onClick:j,variant:"outlined",size:"small",children:[r(a?"minutes":"seconds"),t.jsx(K,{sx:{ml:1}})]})]}):t.jsx(_,{autoFocus:!0,type:"number",value:s,onChange:e=>c(e.target.value),sx:{width:"15rem"},slotProps:{input:{endAdornment:t.jsx(Se,{position:"end",children:t.jsxs(L,{onClick:j,variant:"text",children:[r(a?"minutes":"seconds"),t.jsx(K,{sx:{ml:1}})]})})}}})]}),t.jsxs(ye,{children:[t.jsx(L,{onClick:o,children:r("cancel")}),t.jsx(L,{onClick:h,children:r("set")})]})]})};function Qe(i){return/^-?\d+$/.test(String(i))}function G(i,o,l){let r=0;for(let s=0;s<Number(i);s+=1)r+=Math.floor(Math.random()*Number(o))+1;l(r)}const Ye=n.memo(function({setRollValue:o,dice:l,isEndOfBoard:r}){const{t:s}=w(),[c,a]=n.useState(!1),[f,d]=n.useState("manual"),[p,b]=n.useState(0),[y,g]=n.useState(s("roll")),{timeLeft:m,setTimeLeft:h,togglePause:j,isPaused:e}=Ge(p),[u,T]=n.useState(!1),[D,B]=n.useState({isRange:!1,min:30,max:120}),x=n.useCallback(S=>{o(S)},[o]),[R,C]=l.split("d"),M=()=>{if(f==="manual"){G(R,C,x),a(!0),setTimeout(()=>a(!1),4e3);return}e&&m===p&&G(R,C,x),j()},N=n.useCallback(S=>{if(S==="restart"){x(-1);return}if(d(String(S)),S==="custom"){T(!0);return}if(Qe(S)){e||j();const v=Number(S);b(v),h(v)}},[e,h,j,x]),P=()=>{T(!1)},O=(S,v={isRange:!1})=>{e||j(),b(S),h(S),B({...D,...v}),d("custom"),T(!1)};return n.useEffect(()=>{r&&j()},[r,j]),n.useEffect(()=>{if(c)g(s("wait"));else if(f==="manual")g(s("roll"));else if(e)g(`${s("play")} (${m})`);else if(m>0)g(`${s("pause")} (${m})`);else if(m===0&&!e&&f!=="manual"){G(R,C,x);let S;if(D.isRange){const{min:v,max:H}=D;S=Math.floor(Math.random()*(H-v+1))+v}else S=p;b(S),h(S),g(`${s("pause")} (${S})`)}},[c,f,m,e,p,D,s,R,C,x,h]),t.jsxs(t.Fragment,{children:[t.jsxs(Re,{variant:"contained",className:"dice-roller",children:[t.jsxs(L,{"aria-label":s("roll"),onClick:M,disabled:c,size:"large",children:[t.jsx(Te,{sx:{mr:1}}),y]}),t.jsx(We,{selectedRoll:f,handleMenuItemClick:N})]}),t.jsx(qe,{isOpen:u,onClose:P,onSubmit:O})]})}),Xe=n.lazy(()=>U(()=>import("./index.tsx-DfeU3N-t.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17]))),Ze=n.lazy(()=>U(()=>import("./index.tsx-xUTycLdi.js"),__vite__mapDeps([18,1,2,3,4,9,7,8,16,5,6,10,11,12,13,14,15,17,19,20,21]))),et=n.lazy(()=>U(()=>import("./index.tsx-DRdJTTR2.js"),__vite__mapDeps([22,1,2,3,9,7,8,23,21])));function $(){return t.jsx(E,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100px",children:t.jsx(Ce,{size:24})})}function Dt(){const i=Ae(),o=i.id||"",l=_e(),{t:r}=w(),[s,c]=z();Ve(o,s?.roomRealtime);const[a,f]=n.useState({value:0,time:0}),d=X(ie)?.tiles,p=n.useCallback(M=>{f({value:M,time:Date.now()})},[]),{playerList:b,tile:y}=ze(o,a,d),{roller:g,roomBgUrl:m}=Je(o,d),[h,j]=Ke(s,c);if(!d||!d.length||!Object.keys(s).length||I(o)&&!Z(s.gameMode))return t.jsxs(t.Fragment,{children:[t.jsx(q,{room:i.id,playerList:b}),t.jsx(Le,{open:!0})]});const{isVideo:e,url:u}=ve(s,o,m),T=e?"video-adjust":"",{background:D,roomBackground:B}=s,x=!I(o)&&B!=="app"||D!=="color",R=t.jsx(n.Suspense,{fallback:t.jsx($,{}),children:t.jsx(et,{playerList:b,isTransparent:x,gameBoard:d,settings:s})}),C=t.jsx("div",{className:"messages-container",children:t.jsxs(n.Suspense,{fallback:t.jsx($,{}),children:[t.jsx(Ze,{room:o,isTransparent:x,currentGameBoardSize:d.length}),t.jsx(Me,{room:o,isTransparent:x})]})});return t.jsxs(t.Fragment,{children:[t.jsx(q,{room:o,playerList:b}),t.jsx(Ye,{setRollValue:p,dice:g,isEndOfBoard:y?.index!==void 0&&y.index>=(d?.length??0)-1}),t.jsx(De,{isVideo:e,url:u}),t.jsx($e,{}),l?t.jsx(n.Suspense,{fallback:t.jsx($,{}),children:t.jsx(Xe,{tab1:R,tab2:C})}):t.jsxs(E,{className:`desktop-container ${T}`,children:[R,C]}),t.jsx(Ne,{}),t.jsx(Q,{type:h===r("updated")?"success":"error",open:!!h,close:j,children:h})]})}export{Dt as default};
