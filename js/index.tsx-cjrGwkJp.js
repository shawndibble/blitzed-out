import{u as W,r as x,j as e,S as N,aL as _,I as J,a8 as R,aA as F,aw as k,aa as G,ar as A,a3 as $,t as w,az as a,aF as q,a4 as Y}from"./chunk-gLqOAnAo.js";import{C as K,A as H,a as Q,b as U}from"./chunk-CoT3YRZL.js";import{C as M}from"./chunk-fFmCiWfE.js";import{l as O,u as X,m as Z,n as ee,o as te}from"./chunk-C9KfLBvM.js";import{a9 as ne,K as se,aa as ie,o as le}from"./chunk-DFT8axIh.js";import{T as oe}from"./chunk-BpLDF4zL.js";import{u as ae}from"./chunk-D9KXFDlS.js";import{B as re,K as de,C as ce}from"./chunk-Ce3NdNab.js";import{u as ue}from"./chunk-DfmEhtRA.js";import"../assets/index-40AaoPFR.js";import"./chunk-DF6sfhGu.js";import"./chunk-BOQuZLLs.js";import"./chunk-Cxiyhgvx.js";(function(){var i=typeof window!="undefined"?window:typeof global!="undefined"?global:typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:{};i.SENTRY_RELEASE={id:"ba7d3cfce23f41097f343c1a83f9f2db3c72f794"}})();try{(function(){var i=typeof window!="undefined"?window:typeof global!="undefined"?global:typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:{},h=new i.Error().stack;h&&(i._sentryDebugIds=i._sentryDebugIds||{},i._sentryDebugIds[h]="c4be6d84-49ea-4b4e-a6d4-084a6886f5fa",i._sentryDebugIdIdentifier="sentry-dbid-c4be6d84-49ea-4b4e-a6d4-084a6886f5fa")})()}catch(i){}function fe({open:i,close:h,setAlert:u,board:l}){const{t:n}=W(),[f,y]=x.useState(""),[m,p]=x.useState(l.title||"");function D(s){try{return m.length?s.map((d,c)=>{const[g,...j]=d.split(`
`).filter(S=>S);if(g===void 0)throw u({message:n("importNoEmpty")});if(!/^\[.+\]$/.test(g))throw u({message:n("importInvalidTitle",{entry:c+1})});if(!j.length)throw u({message:n("importMissingDescription",{entry:c+1})});return{title:g==null?void 0:g.replace(/\[|\]/g,""),description:j.join(`
`)}}):(u({message:n("importTitleRequired")}),null)}catch(d){return null}}const C=async()=>{const s=f.split(/~+/).filter(c=>c),d=D(s);if(!d)return null;try{if(JSON.stringify(l.tiles)===JSON.stringify(d))return u({message:n("importNoChange")}),null}catch(c){return u({message:n("error"),type:"error"}),null}return O({...l,title:m,tiles:d}),u({message:n("saved"),type:"success"}),h(),null},r=()=>{var s;const d=(s=l==null?void 0:l.tiles)==null?void 0:s.map(c=>{if(!c)return"";const g=c.title||"",j=c.description||"";return`[${g}]
${j}`}).filter(Boolean);y((d==null?void 0:d.join(`
~~
`))||"")},I=s=>{p(s.target.value)},b=async s=>{if(!s.target.value.length)return u({message:n("importTitleRequired")}),null;O({...l,title:s.target.value})};return x.useEffect(()=>{i&&r()},[i]),x.useEffect(()=>{p(l.title||"")},[l.title]),e.jsxs(e.Fragment,{children:[e.jsx(N,{fullWidth:!0,label:n("title"),value:m,onChange:I,onBlur:b}),e.jsx(N,{sx:{mt:2},multiline:!0,fullWidth:!0,value:f,onChange:s=>y(s.target.value),InputProps:{endAdornment:e.jsxs("div",{style:{display:"flex",flexDirection:"column",position:"sticky",top:0},children:[e.jsx(_,{title:n("save"),children:e.jsx(J,{size:"small",onClick:C,"aria-label":n("save"),children:e.jsx(ne,{color:"success"})})}),e.jsx(M,{text:f}),e.jsx(M,{text:`${window.location.href}?importBoard=${l.id}`,copiedText:n("copiedLink"),icon:e.jsx(se,{}),tooltip:n("copyShareLink")})]}),sx:{alignItems:"flex-start"}}})]})}function De({open:i,close:h,isMobile:u}){var l;const n=ae(te),[f,y]=x.useState(null),[m,p]=x.useState(0),[D,C]=x.useState(0),r=re()[0],{user:I}=ue();if(!n)return null;const b=t=>{if(!t||!t.length)return null;const o=t[t.length-1];return o!=null&&o.description?o.description.match(/\d+%/g):null},s=t=>{y(t)};async function d({title:t,tiles:o}){const v=o.map(({title:V})=>`* ${V} 
`);v.pop(),v.shift();let B=`### ${a("activated")}: ${t}
`;B+=`---
`,B+=[...new Set(v)].join(" "),B+=`---
`;const T=b(o);T&&T.length===3&&(B+=`* ${a("finishSlider")} ${T[0]}  | ${T[1]} | ${T[2]}`);const E=await de({title:t,gameBoard:JSON.stringify(o),settings:JSON.stringify(r)});E!=null&&E.id&&await ce({room:(r==null?void 0:r.room)||"PUBLIC",user:I,text:B,type:"settings",gameBoardId:E.id,boardSize:o.length,gameMode:r==null?void 0:r.gameMode})}const c=async()=>{const t=await X({isActive:0})||0;C(t)},g=t=>{Z(t.id),d(t),y({message:a("boardEnabled"),type:"success"})},j=t=>{t!==0&&p(t)},z=()=>{typeof m=="number"&&ee(m),p(0)},S=t=>(o,v)=>{C(v?t:0)},L=t=>!t.tiles||t.tiles.length!==((r==null?void 0:r.roomTileCount)||40),P=t=>L(t)?a("boardWrongSize",{size:(r==null?void 0:r.roomTileCount)||40}):t.isActive?a("boardActive"):a("enableBoard");return e.jsxs(e.Fragment,{children:[e.jsxs(R,{fullScreen:u,open:i,onClose:h,PaperProps:{sx:{maxHeight:"100%",height:"100%"}},children:[e.jsxs(F,{children:[e.jsx(k,{i18nKey:"manageGameBoards"}),e.jsx(K,{close:h})]}),e.jsxs(G,{style:{overflowY:"scroll"},children:[e.jsxs(A,{sx:{mb:1},children:[e.jsx($,{variant:"outlined",onClick:c,endIcon:e.jsx(ie,{}),sx:{float:"right"},children:e.jsx(k,{i18nKey:"add"})}),e.jsx(w,{children:e.jsx(k,{i18nKey:"gameBoardDescription"})})]}),n.map(t=>{var o;return e.jsxs(H,{expanded:D===t.id,onChange:S(t.id||0),children:[e.jsxs(Q,{children:[e.jsxs(A,{children:[e.jsx(w,{variant:"body1",children:t.title}),e.jsx(w,{variant:"body2",children:a("tilesCount",{count:((o=t.tiles)==null?void 0:o.length)||0})})]}),e.jsxs(A,{style:{marginLeft:"auto"},justifyContent:"flex-end",children:[e.jsx(_,{title:P(t),children:e.jsx("div",{style:{display:"inline-block"},children:e.jsx(q,{checked:!!t.isActive,disabled:!!t.isActive||L(t),onChange:()=>g(t),size:"small"})})}),e.jsx(_,{title:a("delete"),children:e.jsx("span",{style:{display:"inline-block"},children:e.jsx(J,{onClick:()=>j(t.id||0),size:"small",component:"span",children:e.jsx(le,{color:"error"})})})})]})]}),e.jsx(U,{children:e.jsx(fe,{open:i,close:()=>S(t.id||0)(null,!1),setAlert:s,board:t})})]},t.id)})]})]}),e.jsx(oe,{open:!!(f!=null&&f.message),type:(f==null?void 0:f.type)||"error",close:()=>y(null),children:f==null?void 0:f.message}),e.jsxs(R,{open:!!m,onClose:()=>p(0),children:[e.jsxs(F,{children:[a("deleteBoard"),e.jsx(K,{close:()=>p(0)})]}),e.jsx(G,{children:e.jsx(w,{variant:"body1",children:a("confirmDeleteBoard",{title:(l=n.find(t=>t.id===m))==null?void 0:l.title})})}),e.jsxs(Y,{children:[e.jsx($,{onClick:()=>p(0),children:a("cancel")}),e.jsx($,{onClick:z,children:a("delete")})]})]})]})}export{De as default};
//# sourceMappingURL=index.tsx-cjrGwkJp.js.map
