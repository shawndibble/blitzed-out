{"version":3,"file":"index.tsx-Bi7nBfs_.js","sources":["../../src/views/UnauthenticatedApp/index.tsx"],"sourcesContent":["import './styles.css';\n\nimport AuthDialog, { AuthView } from '@/components/auth/AuthDialog';\nimport {\n  Box,\n  Button,\n  Card,\n  CardContent,\n  CircularProgress,\n  Container,\n  Divider,\n  FormControl,\n  Grid,\n  MenuItem,\n  Select,\n  SelectChangeEvent,\n  TextField,\n  Typography,\n} from '@mui/material';\nimport { Language, Login, PersonAdd } from '@mui/icons-material';\nimport { Trans, useTranslation } from 'react-i18next';\nimport { useCallback, useMemo, useState } from 'react';\nimport { useParams, useSearchParams } from 'react-router-dom';\n\nimport GameGuide from '@/views/GameGuide';\nimport Navigation from '@/views/Navigation';\nimport { languages } from '@/services/i18nHelpers';\nimport useAuth from '@/context/hooks/useAuth';\nimport usePlayerList from '@/hooks/usePlayerList';\nimport { useSettings } from '@/stores/settingsStore';\nimport { reportFirefoxMobileAuthError } from '@/utils/firefoxMobileReporting';\n\nexport default function UnauthenticatedApp() {\n  const { i18n, t } = useTranslation();\n  const { login, user, error: authError } = useAuth();\n  const [authDialogOpen, setAuthDialogOpen] = useState(false);\n  const [authDialogView, setAuthDialogView] = useState<AuthView>('login');\n  const [languageLoading, setLanguageLoading] = useState(false);\n  const [loginLoading, setLoginLoading] = useState(false);\n  const [loginError, setLoginError] = useState<string | null>(null);\n\n  const handleOpenLogin = () => {\n    setAuthDialogView('login');\n    setAuthDialogOpen(true);\n  };\n\n  const handleOpenRegister = () => {\n    setAuthDialogView('register');\n    setAuthDialogOpen(true);\n  };\n\n  const params = useParams();\n  const [queryParams] = useSearchParams();\n  const hasImport = !!queryParams.get('importBoard');\n  const room = params.id ?? 'PUBLIC';\n  const playerList = usePlayerList();\n  const [displayName, setDisplayName] = useState(user?.displayName || '');\n\n  const [settings, updateSettings] = useSettings();\n\n  // Memoize handlers to prevent unnecessary re-renders\n  const handleSubmit = useCallback(\n    async (event: React.FormEvent<HTMLFormElement> | React.KeyboardEvent<HTMLDivElement> | React.MouseEvent<HTMLButtonElement>) => {\n      event.preventDefault();\n\n      try {\n        setLoginLoading(true);\n        setLoginError(null);\n\n        // Update settings first, then login\n        await updateSettings({ ...settings, displayName, room });\n        await login(displayName);\n      } catch (error) {\n        const errorMessage = error instanceof Error ? error.message : 'Unknown error occurred';\n        \n        // Report to Sentry for Firefox mobile users with detailed context\n        reportFirefoxMobileAuthError('unauthenticated_app_submit', error as Error, {\n          authentication: {\n            step: 'unauthenticated_app_submit',\n            displayName,\n            room\n          }\n        });\n        \n        setLoginError(errorMessage);\n        \n        // Provide specific Firefox mobile guidance\n        if (navigator.userAgent.toLowerCase().includes('firefox')) {\n          setLoginError(`${errorMessage}. If you're using Firefox mobile, try refreshing the page or temporarily disabling uBlock Origin.`);\n        }\n      } finally {\n        setLoginLoading(false);\n      }\n    },\n    [displayName, login, room, settings, updateSettings]\n  );\n\n  const onEnterKey = useCallback(\n    async (event: React.KeyboardEvent<HTMLDivElement>) => {\n      if (event.key === 'Enter') {\n        await handleSubmit(event);\n      }\n    },\n    [handleSubmit]\n  );\n\n  // Memoize language selection to prevent re-rendering\n  const currentLanguage = i18n.resolvedLanguage || 'en';\n\n  const handleLanguageChange = useCallback(\n    async (event: SelectChangeEvent<string>): Promise<void> => {\n      const newLanguage = event.target.value;\n      setLanguageLoading(true);\n\n      try {\n        // Language change will automatically trigger migration via MigrationContext\n        await i18n.changeLanguage(newLanguage);\n      } catch (error) {\n        console.error('Error changing language:', error);\n        // Still attempt to change language even if migration fails\n        await i18n.changeLanguage(newLanguage);\n      } finally {\n        setLanguageLoading(false);\n      }\n    },\n    [i18n]\n  );\n\n  const languageMenuItems = useMemo(\n    () =>\n      Object.entries(languages).map(([key, obj]) => (\n        <MenuItem value={key} key={key}>\n          {obj.label}\n        </MenuItem>\n      )),\n    []\n  );\n\n  return (\n    <>\n      <Navigation room={room} playerList={playerList} />\n      <Box className=\"unauthenticated-container gradient-background-vibrant\">\n        <Container maxWidth=\"lg\" sx={{ pt: 8 }}>\n          <Grid container spacing={4} justifyContent=\"center\" alignItems=\"stretch\">\n            {/* Main Setup Card */}\n            <Grid size={{ xs: 12, md: 6, lg: 4 }}>\n              <Card className=\"unauthenticated-card main-setup-card\">\n                <CardContent>\n                  <h2 className=\"setup\">\n                    <Trans i18nKey=\"setup\" />\n                  </h2>\n                  <Typography className=\"setup-subtitle\" variant=\"body1\">\n                    <Trans i18nKey=\"setupSubtitle\" />\n                  </Typography>\n                  <Box\n                    component=\"form\"\n                    method=\"post\"\n                    onSubmit={handleSubmit}\n                    className=\"settings-box\"\n                  >\n                    <TextField\n                      fullWidth\n                      id=\"displayName\"\n                      label={t('displayName')}\n                      value={displayName}\n                      onChange={(event) => setDisplayName(event.target.value)}\n                      required\n                      autoFocus\n                      onKeyDown={(event) => onEnterKey(event)}\n                      margin=\"normal\"\n                    />\n\n                    {/* Error Display */}\n                    {(loginError || authError) && (\n                      <Box\n                        sx={{\n                          mt: 2,\n                          p: 2,\n                          borderRadius: 1,\n                          backgroundColor: 'error.main',\n                          color: 'error.contrastText',\n                        }}\n                      >\n                        <Typography variant=\"body2\">\n                          <strong>Error:</strong> {loginError || authError}\n                        </Typography>\n                        {navigator.userAgent.toLowerCase().includes('firefox') && (\n                          <Button\n                            size=\"small\"\n                            variant=\"text\"\n                            sx={{ mt: 1, color: 'inherit' }}\n                            onClick={() => {\n                              const diagnostics = {\n                                userAgent: navigator.userAgent,\n                                url: window.location.href,\n                                timestamp: new Date().toISOString(),\n                                cookiesEnabled: navigator.cookieEnabled,\n                                localStorageAvailable: typeof(Storage) !== \"undefined\",\n                                error: loginError || authError\n                              };\n                              navigator.clipboard?.writeText(JSON.stringify(diagnostics, null, 2));\n                              alert('Debug info copied to clipboard. Please share this with support.');\n                            }}\n                          >\n                            Copy Debug Info\n                          </Button>\n                        )}\n                      </Box>\n                    )}\n\n                    <Button\n                      variant=\"contained\"\n                      type=\"submit\"\n                      fullWidth\n                      className=\"jump-in-button\"\n                      size=\"large\"\n                      disabled={loginLoading}\n                      startIcon={loginLoading ? <CircularProgress size={20} /> : <PersonAdd />}\n                      sx={{ \n                        mt: 2, \n                        py: 1.25, \n                        fontSize: '1.1rem', \n                        fontWeight: 600,\n                        // Firefox mobile touch handling\n                        touchAction: 'manipulation',\n                        // Ensure button is clickable on all browsers\n                        cursor: loginLoading ? 'default' : 'pointer',\n                        // Prevent double-tap zoom on mobile\n                        userSelect: 'none',\n                        // Firefox-specific button styles\n                        '&:focus': {\n                          outline: '2px solid',\n                          outlineColor: 'primary.main',\n                          outlineOffset: '2px'\n                        }\n                      }}\n                      onClick={async (e) => {\n                        // Explicit click handler for better Firefox mobile support\n                        await handleSubmit(e);\n                      }}\n                      // Firefox mobile sometimes needs explicit pointer handling\n                      onPointerDown={() => {\n                        // Ensure button responsiveness on Firefox mobile\n                      }}\n                    >\n                      {loginLoading ? \n                        'Loading...' : \n                        (hasImport ? <Trans i18nKey=\"import\" /> : <Trans i18nKey=\"anonymousLogin\" />)\n                      }\n                    </Button>\n                    <Divider sx={{ my: 3 }}>\n                      <Typography\n                        variant=\"body2\"\n                        color=\"text.secondary\"\n                        sx={{ fontSize: '0.9rem' }}\n                      >\n                        <Trans i18nKey=\"or\" />\n                      </Typography>\n                    </Divider>\n                    <Box className=\"auth-button-container\">\n                      <Button\n                        variant=\"outlined\"\n                        startIcon={<Login />}\n                        onClick={handleOpenLogin}\n                        size=\"medium\"\n                      >\n                        <Trans i18nKey=\"signIn\" />\n                      </Button>\n                      <Button variant=\"outlined\" onClick={handleOpenRegister} size=\"medium\">\n                        <Trans i18nKey=\"createAccount\" />\n                      </Button>\n                    </Box>\n                  </Box>\n                </CardContent>\n              </Card>\n            </Grid>\n\n            {/* Secondary Content Area for Desktop */}\n            <Grid size={{ md: 12, lg: 8 }}>\n              {/* Game Guide */}\n              <Card className=\"unauthenticated-card\">\n                <CardContent>\n                  <GameGuide />\n                </CardContent>\n              </Card>\n            </Grid>\n          </Grid>\n        </Container>\n\n        {/* Footer Language Selector */}\n        <Box className=\"footer-language-container\">\n          <Box className=\"footer-language-selector\">\n            <Language sx={{ fontSize: '1rem', color: 'rgba(255, 255, 255, 0.5)' }} />\n            <FormControl size=\"small\" sx={{ minWidth: 120 }}>\n              <Select\n                value={currentLanguage}\n                disabled={languageLoading}\n                onChange={handleLanguageChange}\n                size=\"small\"\n                variant=\"standard\"\n                sx={{\n                  color: 'rgba(255, 255, 255, 0.7)',\n                  fontSize: '0.875rem',\n                  '& .MuiSelect-icon': {\n                    color: 'rgba(255, 255, 255, 0.5)',\n                  },\n                  '&:before': {\n                    borderBottomColor: 'rgba(255, 255, 255, 0.3)',\n                  },\n                  '&:hover:before': {\n                    borderBottomColor: 'rgba(255, 255, 255, 0.5)',\n                  },\n                }}\n                endAdornment={languageLoading && <CircularProgress size={14} />}\n              >\n                {languageMenuItems}\n              </Select>\n            </FormControl>\n          </Box>\n        </Box>\n      </Box>\n\n      <AuthDialog\n        open={authDialogOpen}\n        close={() => setAuthDialogOpen(false)}\n        initialView={authDialogView}\n      />\n    </>\n  );\n}\n"],"names":["UnauthenticatedApp","_a","i18n","t","useTranslation","login","user","authError","useAuth","authDialogOpen","setAuthDialogOpen","useState","authDialogView","setAuthDialogView","languageLoading","setLanguageLoading","loginLoading","setLoginLoading","loginError","setLoginError","handleOpenLogin","handleOpenRegister","params","useParams","queryParams","useSearchParams","hasImport","room","playerList","usePlayerList","displayName","setDisplayName","settings","updateSettings","useSettings","handleSubmit","useCallback","event","error","errorMessage","reportFirefoxMobileAuthError","onEnterKey","currentLanguage","handleLanguageChange","newLanguage","languageMenuItems","useMemo","languages","key","obj","MenuItem","jsxs","Fragment","jsx","Navigation","Box","Container","Grid","Card","CardContent","Trans","Typography","TextField","Button","diagnostics","CircularProgress","PersonAdd","e","Divider","Login","GameGuide","Language","FormControl","Select","AuthDialog"],"mappings":"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"}