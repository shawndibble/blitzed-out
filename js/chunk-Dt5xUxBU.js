import{g as v}from"./chunk-B4PEA_xj.js";import{i as y}from"./chunk-6r4ubesh.js";import{l as h}from"./chunk-yLOK5aTh.js";import{r as l,j as g,am as x}from"./chunk-BCLv-HyH.js";import{u as k}from"./chunk-BleRqfCK.js";import{c as w}from"./chunk-C5tDN2aE.js";function I(e){const t=/vimeo\.com\/(\d+)/,o=e.match(t);return`https://player.vimeo.com/video/${o?o[1]:""}?autoplay=1&loop=1&autostart=true`}function $(e){const t=/(?:youtube\.com\/(?:[^/]+\/.+\/|(?:v|e(?:mbed)?)\/|[^#]*[?&]v=|youtu\.be\/)([^"&?/ ]{11})|^(?:[^"&?/ ]{11})$)/,o=e.match(t);return`https://www.youtube.com/embed/${o?o[1]:""}?autoplay=1&loop=1&autostart=true&mute=1&playsinline=1&controls=0&disablekb=1&fs=0&modestbranding=1&rel=0&iv_load_policy=3`}function R(e){const t=/drive\.google\.com\/file\/d\/([^/]+)/,o=e.match(t);return`https://drive.google.com/file/d/${o?o[1]:""}/preview?loop=1`}function U(e){const t=/dropbox\.com\/s\/([^/]+)/,o=e.match(t);return`https://www.dropbox.com/s/${o?o[1]:""}?raw=1`}function B(e){return`https://pornhub.com/embed/${new URL(e).searchParams.get("viewkey")||""}?autoplay=1&loop=1&autostart=true&playsinline=1`}function j(e){const t=e.split("-");return`https://xhamster.com/xembed.php?video=${t[t.length-1]}?autoplay=1&loop=1&autostart=true&playsinline=1`}function A(e){const t=/media\.tenor\.com\/([a-zA-Z0-9_-]+)\/[^/]*\.(mp4|gif|webp)/;if(e.match(t))return e;const n=/tenor\.com\/view\/[^/]*-(\d+)/,r=e.match(n);return`https://tenor.com/embed/${r?r[1]:""}?autoplay=1`}function L(e){const t=/giphy\.com\/gifs\/[^/]*-([a-zA-Z0-9]+)/,o=e.match(t);return`https://media.giphy.com/media/${o?o[1]:""}/giphy.gif`}function M(e){const t=/(?:gfycat\.com|redgifs\.com)\/(?:watch\/)?([a-zA-Z0-9]+)/,o=e.match(t),n=o?o[1]:"";return s(e,["redgifs.com"])?`https://files.redgifs.com/${n}.mp4`:`https://giant.gfycat.com/${n}.mp4`}function P(e){const t=/redtube\.com\/(\d+)/,o=e.match(t);return`https://embed.redtube.com/?id=${o?o[1]:""}&autoplay=true&auto_play=1&playsinline=1&controls=1`}function z(e){const t=/youporn\.com\/watch\/(\d+)/,o=e.match(t);return`https://www.youporn.com/embed/${o?o[1]:""}?autoplay=1&playsinline=1`}function N(e){const t=/tube8\.com\/[^/]+\/[^/]+\/(\d+)/,o=e.match(t);return`https://www.tube8.com/embed/${o?o[1]:""}?autoplay=1&playsinline=1`}function F(e){return`https://twitframe.com/show?url=${encodeURIComponent(e)}`}function S(e){try{const r=new URL(e);if((r.host==="discordapp.net"||r.host.endsWith(".discordapp.net"))&&r.pathname.startsWith("/external/")&&(r.pathname.includes("/https/i.imgur.com/")||r.pathname.includes("/https/imgur.com/")))return e}catch(r){h.debug("URL parsing failed for Discord proxy check:",r)}let t="",o=!1;try{const r=new URL(e);o=r.host==="imgur.com"||r.host==="i.imgur.com"}catch(r){return h.debug("URL parsing failed for Imgur processing:",r),""}if(!o)return"";if(e.includes("/gallery/")){const r=e.match(/imgur\.com\/gallery\/[^#]*#([a-zA-Z0-9]+)/);if(r)t=r[1];else{const m=e.match(/#([a-zA-Z0-9]+)/);m&&(t=m[1])}}else{const r=/imgur\.com\/([a-zA-Z0-9]+)(?:\.(mp4|jpg|jpeg|png|gif|webp))?|images-ext-\d+\.discordapp\.net\/external\/[^/]+\/https\/i\.imgur\.com\/([a-zA-Z0-9]+)\.(mp4|jpg|jpeg|png|gif|webp)/,m=e.match(r);t=m?m[1]||m[3]:""}return`https://i.imgur.com/${t}.mp4`}function b(e){return/\.(mp4|webm|ogg|mov)(\?.*)?$/.test(e)}function Z(e){return s(e,["media.discordapp.net","cdn.discordapp.com"])&&!b(e)}function s(e,t){try{const o=new URL(e);return t.some(n=>o.host===n||o.host.endsWith("."+n))}catch(o){return h.debug("URL parsing failed in isValidHost, rejecting for security:",o),!1}}function E(e){let t=null,o=!0;if(!e)return{url:"",isVideo:!1};switch(!0){case s(e,["vimeo.com"]):t=I(e);break;case s(e,["youtube.com","youtu.be"]):t=$(e);break;case s(e,["drive.google.com"]):t=R(e);break;case s(e,["pornhub.com"]):t=B(e);break;case s(e,["xhamster.com"]):t=j(e);break;case s(e,["dropbox.com"]):t=U(e);break;case s(e,["imgur.com","i.imgur.com"]):t=S(e);break;case s(e,["tenor.com","media.tenor.com"]):t=A(e),o=!0;break;case s(e,["giphy.com"]):t=L(e),o=!0;break;case s(e,["gfycat.com","redgifs.com"]):t=M(e),o=!0;break;case s(e,["redtube.com"]):t=P(e);break;case s(e,["youporn.com"]):t=z(e);break;case s(e,["tube8.com"]):t=N(e);break;case s(e,["twitter.com","x.com"]):t=F(e),o=!1;break;case s(e,["thisvid.com"]):t=e;break;case s(e,["boyfriendtv.com"]):t=e;break;case Z(e):t=e,o=!1;break;case b(e):t=e;break;default:t=v(e),o=!1;break}return{url:t,isVideo:o}}function O(e,t){const{background:o,backgroundURL:n,roomBackground:r,roomBackgroundURL:m}=e,a=(d,u)=>{if(!d)return null;if(d==="custom")return u?m||null:n||null;if(d==="useAppBackground"){const i=o||"color";return i==="useRoomBackground"?"color":i==="custom"?n||null:i}if(d==="useRoomBackground"){if(y(t))return"color";const i=r||"useAppBackground";return i==="useAppBackground"?"color":i==="custom"?m||null:i}return d};let c=null;return!y(t)&&r&&r!=="useAppBackground"?c=a(r,!0):o?c=a(o,!1):c="color",c?c==="color"||c==="gray"?{url:c,isVideo:!1}:E(c):{url:null,isVideo:!1}}function H(e){return{uid:e.uid,displayName:e.displayName,isSelf:e.isSelf,isFinished:e.isFinished}}function q(e){const[t,o]=l.useState(null),n=k(),r=l.useMemo(()=>n.map(a=>`${a.uid}-${a.displayName}-${a.isFinished}-${a.isSelf}`).join("|"),[n]),m=l.useMemo(()=>e?`${e.uid}-${e.displayName||""}`:null,[e]);return l.useEffect(()=>{if(!e){o(null);return}if(n.length<=1){o(null);return}const a=n.filter(i=>!i.isFinished);if(a.length<=1){o(null);return}let c=-1;c=a.findIndex(i=>i.uid===e.uid),c===-1&&(c=a.findIndex(i=>i.displayName===e.displayName)),c===-1&&(c=0);const p=(c+1)%a.length,d=a[p],u=H(d);o(u)},[m,r]),t}function D({url:e}){const[t,o]=l.useState("video"),[n,r]=l.useState(e);if(l.useEffect(()=>{r(e),o("video")},[e]),!e)return null;const m=()=>{let c=!1;try{const u=new URL(e);c=u.host==="imgur.com"||u.host==="i.imgur.com"}catch{c=!1}if(c){const u=e.match(/imgur\.com\/([a-zA-Z0-9]+)/)?.[1];if(u){const i=`https://i.imgur.com/${u}.jpg`;r(i),o("image");return}}const d=`${e.replace(/\.(mp4|webm|ogg|mov)(\?.*)?$/i,"")}.jpg`;r(d),o("image")},a=()=>{let c=!1;try{const p=new URL(e);c=p.host==="imgur.com"||p.host==="i.imgur.com"}catch{c=!1}if(c){const p=e.match(/imgur\.com\/([a-zA-Z0-9]+)/)?.[1];if(p){const d=["png","gif","jpeg","webp"],u=n?.split(".").pop(),i=d.find(f=>f!==u);if(i){const f=`https://i.imgur.com/${p}.${i}`;r(f)}}}else{const p=["png","gif","jpeg","webp"],d=n?.split(".").pop(),u=p.find(i=>i!==d);if(u&&n){const f=`${n.replace(/\.[^.]+(\?.*)?$/,"")}.${u}`;r(f)}}};return t==="video"?g.jsx("video",{autoPlay:!0,loop:!0,muted:!0,playsInline:!0,src:n||void 0,className:"video-background",onError:m,preload:"auto",crossOrigin:"anonymous",controls:!0}):g.jsxs(g.Fragment,{children:[g.jsx("div",{className:"image-background",style:{backgroundImage:`url(${n})`,backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat",width:"100%",height:"100%",position:"absolute",top:0,left:0}}),g.jsx("img",{src:n||void 0,onError:a,style:{display:"none"},alt:""})]})}function G({url:e=null,isVideo:t=null}){const o=e&&/\.(mp4|webm|ogg|mov|gif)(\?.*)?$/i.test(e),n=e==="color"||e==="gray"||e?.includes("/color")||e?.includes("/gray"),r=e&&!n&&(t||!t&&e);return g.jsx(x,{className:w("main-container",!r&&"default-background"),role:"presentation",sx:{backgroundImage:!t&&e&&!n?`url(${e})`:"none"},children:t&&(o?g.jsx(D,{url:e}):g.jsx("iframe",{width:"100%",height:"100%",src:e||void 0,title:"video",allow:"autoplay; fullscreen; encrypted-media; picture-in-picture",sandbox:"allow-same-origin allow-scripts allow-presentation",style:{border:0}}))})}export{G as R,O as g,E as p,q as u};
