import{u as R,b as d,j as e,au as J,s as Be,ar as x,aS as ve,t as p,a6 as N,I as re,aT as pe,M as I,aU as ye,aV as ue,av as Z,Q as O,O as _,ax as W,aW as Me,aL as G,a8 as Ne,aA as Oe,aa as _e,S as ne,aP as D,a4 as We,a3 as B,aw as g,aX as Ue,aY as Fe,W as Se,aZ as $e,aE as le,az as xe,aF as ee,ay as Ge,ae as X,a_ as Ye,at as z,aI as He,aK as Je,aJ as Ze,a$ as me,aj as Qe,ac as Xe,ab as ie}from"./chunk-DCqCmTw7.js";import{n as De,M as en,E as Ce,o as nn,V as sn,d as ge,p as fe,q as we,b as je,r as ln,H as F,s as Pe,t as tn,u as an,T as rn,W as on}from"./chunk-DyYP0jr7.js";import{l as cn}from"./chunk-Ddv6gvN9.js";import{x as ke}from"./chunk-5SGEHjMG.js";import{i as U,d as te,u as dn,f as oe}from"./chunk-BqV4rolb.js";import{a as un,u as hn}from"./chunk-B47UJojq.js";import{u as xn,C as mn}from"./chunk-CJ-p-rHL.js";import{b as gn}from"./chunk-rJHcTq4h.js";import{T as pn}from"./chunk-Cpw0r6bE.js";import{a as yn,b as fn}from"./chunk-CY6JpaOE.js";(function(){var n=typeof window!="undefined"?window:typeof global!="undefined"?global:typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:{};n.SENTRY_RELEASE={id:"b82d01bea29447e452b49ba3e85b9fac2f7942a4"}})();try{(function(){var n=typeof window!="undefined"?window:typeof global!="undefined"?global:typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:{},s=new n.Error().stack;s&&(n._sentryDebugIds=n._sentryDebugIds||{},n._sentryDebugIds[s]="7d52980c-353b-40a3-86bb-42081669d6fa",n._sentryDebugIdIdentifier="sentry-dbid-7d52980c-353b-40a3-86bb-42081669d6fa")})()}catch(n){}const Te=[{id:"tritone",name:"Tri-tone",frequency:1318,type:"sine",duration:400,category:"classic",frequencies:[1318,1568,1175]},{id:"rebound",name:"Rebound",frequency:800,type:"triangle",duration:350,category:"classic"},{id:"chime",name:"Chime",frequency:1e3,type:"sine",duration:500,category:"classic",frequencies:[1e3,1200,1400]},{id:"boop",name:"Boop",frequency:600,type:"sine",duration:150,category:"classic"},{id:"breeze",name:"Breeze",frequency:400,type:"triangle",duration:600,category:"classic",frequencies:[400,500,600,500]},{id:"pong",name:"Pong",frequency:1100,type:"square",duration:200,category:"classic"},{id:"glass",name:"Glass",frequency:1800,type:"sine",duration:300,category:"classic",frequencies:[1800,1600,1400]},{id:"funk",name:"Funk",frequency:220,type:"sawtooth",duration:400,category:"classic"}],Ae=[{id:"c4",name:"C Note",frequency:261.63,type:"sine",duration:300,category:"musical"},{id:"d4",name:"D Note",frequency:293.66,type:"sine",duration:300,category:"musical"},{id:"e4",name:"E Note",frequency:329.63,type:"sine",duration:300,category:"musical"},{id:"f4",name:"F Note",frequency:349.23,type:"sine",duration:300,category:"musical"},{id:"g4",name:"G Note",frequency:392,type:"sine",duration:300,category:"musical"},{id:"ascending",name:"Ascending",frequency:261.63,type:"triangle",duration:800,category:"musical",frequencies:[261.63,293.66,329.63,349.23]},{id:"descending",name:"Descending",frequency:523.25,type:"triangle",duration:800,category:"musical",frequencies:[523.25,466.16,415.3,369.99]},{id:"chord",name:"Major Chord",frequency:261.63,type:"sine",duration:600,category:"musical",frequencies:[261.63,329.63,392]},{id:"arpeggio",name:"Arpeggio",frequency:261.63,type:"triangle",duration:1e3,category:"musical",frequencies:[261.63,329.63,392,523.25]}],Ie=[{id:"bell",name:"Bell",frequency:800,type:"sine",duration:200,category:"notification"},{id:"ding",name:"Ding",frequency:1200,type:"square",duration:150,category:"notification"},{id:"chirp",name:"Chirp",frequency:1500,type:"sine",duration:80,category:"notification"},{id:"beep",name:"Beep",frequency:600,type:"sine",duration:100,category:"notification"},{id:"tick",name:"Tick",frequency:2e3,type:"square",duration:50,category:"notification"},{id:"ping",name:"Ping",frequency:1800,type:"triangle",duration:120,category:"notification"},{id:"bubble",name:"Bubble",frequency:800,type:"sine",duration:200,category:"notification",frequencies:[800,1200]},{id:"pop",name:"Pop",frequency:1e3,type:"square",duration:80,category:"notification"}],Le=[{id:"buzz",name:"Buzz",frequency:400,type:"sawtooth",duration:250,category:"game"},{id:"whoosh",name:"Whoosh",frequency:200,type:"sawtooth",duration:500,category:"game",frequencies:[200,150,100]},{id:"bloop",name:"Bloop",frequency:300,type:"sine",duration:400,category:"game",frequencies:[300,400,350]},{id:"zap",name:"Zap",frequency:1500,type:"square",duration:120,category:"game",frequencies:[1500,1e3,500]},{id:"bounce",name:"Bounce",frequency:500,type:"triangle",duration:300,category:"game",frequencies:[500,700,600,800]},{id:"powerup",name:"Power Up",frequency:440,type:"square",duration:600,category:"game",frequencies:[440,523,659,784]},{id:"coin",name:"Coin",frequency:1046,type:"square",duration:300,category:"game",frequencies:[1046,1318]},{id:"fanfare",name:"Fanfare",frequency:523,type:"triangle",duration:1200,category:"game",frequencies:[523,659,784,1046]}],jn=[{id:"classic",name:"Classic System Alerts",sounds:Te},{id:"musical",name:"Musical Notes & Melodies",sounds:Ae},{id:"notification",name:"Notification Alerts",sounds:Ie},{id:"game",name:"Game & Action Sounds",sounds:Le}],he=[...Te,...Ae,...Ie,...Le];async function bn(n){try{if(!n||!n.frequency||!n.type||!n.duration)return!1;const s=window.AudioContext||window.webkitAudioContext;if(!s)return!1;const l=new s;if(n.frequencies&&n.frequencies.length>1)return vn(l,n);const t=l.createOscillator(),i=l.createGain();return t.connect(i),i.connect(l.destination),t.frequency.value=n.frequency,t.type=n.type,i.gain.setValueAtTime?(i.gain.setValueAtTime(.3,l.currentTime),i.gain.exponentialRampToValueAtTime(.01,l.currentTime+n.duration/1e3)):i.gain.value=.3,t.start(),t.stop(l.currentTime+n.duration/1e3),setTimeout(()=>{l.close()},n.duration+100),!0}catch(s){return console.warn("Sound playback failed:",s),!1}}async function vn(n,s){try{const l=s.frequencies,t=s.duration/l.length,i=n.createGain();return i.connect(n.destination),i.gain.setValueAtTime?i.gain.setValueAtTime(.3,n.currentTime):i.gain.value=.3,l.forEach((a,r)=>{const o=n.createOscillator(),c=n.createGain();o.connect(c),c.connect(i),o.frequency.value=a,o.type=s.type;const m=n.currentTime+r*t/1e3,u=m+t/1e3;c.gain.setValueAtTime?(c.gain.setValueAtTime(1,m),c.gain.exponentialRampToValueAtTime(.01,u)):c.gain.value=1,o.start(m),o.stop(u)}),setTimeout(()=>{n.close()},s.duration+100),!0}catch(l){return console.warn("Melody playback failed:",l),!1}}function se(){return he[Math.floor(Math.random()*he.length)]}function Sn(n){return n&&he.find(s=>s.id===n)||null}const Cn=Be(Z)(`
  &:last-child {
    padding-bottom: 8px;
  }
`);function wn({player:n,index:s,isActive:l,canEdit:t=!0,canDelete:i=!0,onEdit:a,onDelete:r,onRoleChange:o}){const{t:c}=R(),[m,u]=d.useState(null),[h,b]=d.useState(null),j=v=>{u(v.currentTarget)},f=()=>{u(null)},T=v=>{v.stopPropagation(),b(v.currentTarget)},w=()=>{b(null)},S=()=>{f(),a==null||a(n)},k=()=>{f(),r==null||r(n.id)},C=v=>{w(),o==null||o(n.id,v)},A=v=>v.split(" ").map(P=>P.charAt(0)).join("").toUpperCase().slice(0,2)||"P",y=v=>{switch(v){case"dom":return"primary";case"sub":return"secondary";case"vers":return"default";default:return"default"}};return e.jsxs(J,{sx:{border:l?"2px solid":"1px solid",borderColor:l?"primary.main":"divider",bgcolor:l?"action.selected":"background.paper",transition:"all 0.2s ease-in-out","&:hover":{borderColor:"primary.main",elevation:2}},children:[e.jsx(Cn,{children:e.jsxs(x,{sx:{display:"flex",alignItems:"flex-start",gap:2},children:[e.jsx(ve,{sx:{bgcolor:l?"primary.main":"grey.500",marginTop:.5,width:24,height:24,fontWeight:"bold"},children:A(n.name)}),e.jsx(x,{sx:{flexGrow:1,minWidth:0},children:e.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[e.jsx(p,{variant:"h6",component:"h3",sx:{fontWeight:l?600:500,color:l?"primary.main":"text.primary",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",flexGrow:1},children:n.name||c("localPlayers.defaultPlayerName",{number:s+1})}),e.jsx(N,{label:c(`roles.${n.role}`),size:"small",variant:"outlined",color:y(n.role),onClick:t?T:void 0,sx:{cursor:t?"pointer":"default","&:hover":t?{bgcolor:"action.hover"}:{}}}),l&&e.jsx(N,{label:c("localPlayers.currentPlayer"),size:"small",color:"primary",icon:e.jsx(De,{})})]})}),(t||i)&&e.jsx(re,{size:"small",onClick:j,"aria-label":c("localPlayers.playerActions",{name:n.name}),children:e.jsx(en,{})})]})}),e.jsxs(pe,{anchorEl:m,open:!!m,onClose:f,transformOrigin:{horizontal:"right",vertical:"top"},anchorOrigin:{horizontal:"right",vertical:"bottom"},children:[t&&e.jsxs(I,{onClick:S,children:[e.jsx(ye,{children:e.jsx(Ce,{fontSize:"small"})}),e.jsx(ue,{children:c("localPlayers.editPlayer")})]}),i&&e.jsxs(I,{onClick:k,sx:{color:"error.main"},children:[e.jsx(ye,{children:e.jsx(nn,{fontSize:"small",sx:{color:"error.main"}})}),e.jsx(ue,{children:c("localPlayers.deletePlayer")})]})]}),e.jsx(pe,{anchorEl:h,open:!!h,onClose:w,transformOrigin:{horizontal:"left",vertical:"top"},anchorOrigin:{horizontal:"left",vertical:"bottom"},children:["dom","sub","vers"].map(v=>e.jsx(I,{onClick:()=>C(v),selected:n.role===v,children:e.jsx(N,{label:c(`roles.${v}`),size:"small",variant:n.role===v?"filled":"outlined",color:y(v)})},v))})]})}function Pn({selectedSoundId:n,onSoundChange:s,label:l="Turn Sound"}){const t=async()=>{if(!n)return;const a=Sn(n);if(a)try{await bn(a)||console.error("Failed to play sound")}catch(r){console.error("Failed to play sound:",r)}},i=a=>{s(a.target.value)};return e.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:1,py:1},children:[e.jsxs(O,{fullWidth:!0,size:"small",children:[e.jsx(_,{id:"sound-select-label",children:l}),e.jsxs(W,{labelId:"sound-select-label",value:n||"",label:l,onChange:i,children:[e.jsx(I,{value:"",children:e.jsxs(x,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(sn,{fontSize:"small"}),"No sound"]})}),jn.map(a=>[e.jsx(Me,{sx:{fontWeight:"bold"},children:a.name},`header-${a.id}`),...a.sounds.map(r=>e.jsx(I,{value:r.id,sx:{pl:3},children:r.name},r.id))])]})]}),e.jsx(G,{title:"Play sample",children:e.jsx(re,{onClick:t,color:"primary",disabled:!n,size:"small",children:e.jsx(ge,{})})})]})}function kn({open:n,player:s,existingPlayers:l,onSubmit:t,onCancel:i}){const{t:a}=R(),[r,o]=d.useState({name:"",role:"vers",sound:se().id}),[c,m]=d.useState({}),[u,h]=d.useState(!1);d.useEffect(()=>{o(s?{name:s.name,role:s.role,sound:s.sound||se().id}:{name:"",role:"vers",sound:se().id}),m({})},[s,n]);const b=d.useCallback(()=>{const y={},v=r.name.trim();return v?v.length<2?y.name=a("localPlayers.form.errors.nameTooShort"):v.length>20?y.name=a("localPlayers.form.errors.nameTooLong"):l.some(q=>q.id!==(s==null?void 0:s.id)&&q.name.toLowerCase()===v.toLowerCase())&&(y.name=a("localPlayers.form.errors.nameDuplicate")):y.name=a("localPlayers.form.errors.nameRequired"),(!r.role||!["dom","sub","vers"].includes(r.role))&&(y.role=a("localPlayers.form.errors.roleRequired")),m(y),Object.keys(y).length===0},[r,l,s,a]),j=d.useCallback(y=>{const v=y.target.value;o(P=>({...P,name:v})),c.name&&m(P=>({...P,name:void 0}))},[c.name]),f=d.useCallback(y=>{const v=y.target.value;o(P=>({...P,role:v})),c.role&&m(P=>({...P,role:void 0}))},[c.role]),T=d.useCallback(y=>{o(v=>({...v,sound:y}))},[]),w=d.useCallback(async()=>{if(b()){h(!0);try{const y={name:r.name.trim(),role:r.role,sound:r.sound};await t(y)}catch(y){console.error("Error submitting player form:",y)}finally{h(!1)}}},[r,b,t]),S=d.useCallback(()=>{o({name:"",role:"vers",sound:se().id}),m({}),i()},[i]),k=d.useCallback(y=>y.split(" ").map(v=>v.charAt(0)).join("").toUpperCase().slice(0,2)||"P",[]),C=y=>{switch(y){case"dom":return"primary";case"sub":return"secondary";case"vers":return"default";default:return"default"}},A=!!s;return e.jsxs(Ne,{open:n,onClose:S,maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{borderRadius:2}},children:[e.jsx(Oe,{children:a(A?"localPlayers.form.editPlayerTitle":"localPlayers.form.addPlayerTitle")}),e.jsxs(_e,{children:[e.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:2,mb:3,p:2,bgcolor:"action.hover",borderRadius:1},children:[e.jsx(ve,{sx:{bgcolor:"primary.main",width:56,height:56,fontSize:"1.5rem",fontWeight:"bold"},children:k(r.name||"P")}),e.jsxs(x,{sx:{direction:"row"},children:[e.jsx(p,{variant:"h6",children:r.name||a("localPlayers.form.previewName")}),e.jsx(x,{sx:{display:"flex",alignItems:"center",gap:1,mt:.5},children:e.jsx(N,{label:a(`roles.${r.role}`),size:"small",color:C(r.role),variant:"outlined"})})]})]}),e.jsxs(x,{sx:{display:"flex",flexDirection:"column",gap:3},children:[e.jsx(ne,{label:a("localPlayers.form.nameLabel"),value:r.name,onChange:j,error:!!c.name,helperText:c.name||a("localPlayers.form.nameHelper"),placeholder:a("localPlayers.form.namePlaceholder"),fullWidth:!0,autoFocus:!A,inputProps:{maxLength:20}}),e.jsxs(O,{fullWidth:!0,error:!!c.role,children:[e.jsx(_,{children:a("localPlayers.form.roleLabel")}),e.jsxs(W,{value:r.role,onChange:f,label:a("localPlayers.form.roleLabel"),children:[e.jsx(I,{value:"dom",children:e.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(N,{label:a("roles.dom"),size:"small",color:"primary",variant:"outlined"}),e.jsx(p,{variant:"body2",color:"text.secondary",children:a("localPlayers.form.roleDescriptions.dom")})]})}),e.jsx(I,{value:"sub",children:e.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(N,{label:a("roles.sub"),size:"small",color:"secondary",variant:"outlined"}),e.jsx(p,{variant:"body2",color:"text.secondary",children:a("localPlayers.form.roleDescriptions.sub")})]})}),e.jsx(I,{value:"vers",children:e.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(N,{label:a("roles.vers"),size:"small",color:"default",variant:"outlined"}),e.jsx(p,{variant:"body2",color:"text.secondary",children:a("localPlayers.form.roleDescriptions.vers")})]})})]}),c.role&&e.jsx(p,{variant:"caption",color:"error",sx:{mt:1,ml:1.5},children:c.role})]}),e.jsx(Pn,{selectedSoundId:r.sound,onSoundChange:T,label:a("localPlayers.form.soundLabel","Turn Sound")}),e.jsx(D,{severity:"info",sx:{mt:1},children:e.jsx(p,{variant:"body2",children:a("localPlayers.form.helpText")})})]})]}),e.jsxs(We,{sx:{p:3,pt:1},children:[e.jsx(B,{onClick:S,disabled:u,children:a("cancel")}),e.jsx(B,{onClick:w,variant:"contained",disabled:u||!r.name.trim(),children:a(u?"localPlayers.form.saving":A?"localPlayers.form.saveChanges":"localPlayers.form.addPlayer")})]})]})}function Tn({roomId:n,isPrivateRoom:s,onComplete:l,onCancel:t,initialPlayers:i=[],initialSettings:a}){const{t:r}=R();console.debug("Setting up local players for room:",n);const[o,c]=d.useState(i),[m,u]=d.useState(!1),[h,b]=d.useState(null),[j,f]=d.useState(!1),[T,w]=d.useState(!1),[S,k]=d.useState(null),[C]=d.useState(a||{showTurnTransitions:!0,enableTurnSounds:!0,showPlayerAvatars:!0}),A=d.useCallback(()=>{const L=o.length>=2&&o.length<=4,E=o.every(Q=>Q.name.trim().length>0),H=new Set(o.map(Q=>Q.name.toLowerCase())).size===o.length,M=L&&E&&H;return u(M),o.length<2?b(r("localPlayers.errors.minimumPlayers")):o.length>4?b(r("localPlayers.errors.maximumPlayers")):b(E?H?null:r("localPlayers.errors.duplicateNames"):r("localPlayers.errors.emptyNames")),M},[o,r]);d.useEffect(()=>{i.length>0&&c(i)},[]),d.useEffect(()=>{A()},[A]);const y=d.useCallback(()=>`local_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,[]),v=d.useCallback(()=>r("localPlayers.defaultPlayerName",{number:o.length+1}),[o.length,r]),P=d.useCallback(()=>{o.length>=4||(k(null),w(!0))},[o.length]),q=d.useCallback(L=>{c(E=>E.filter(M=>M.id!==L).map((M,Q)=>({...M,order:Q,isActive:Q===0})))},[]),V=d.useCallback((L,E)=>{c(H=>H.map(M=>M.id===L?{...M,...E}:M))},[]),K=d.useCallback((L,E)=>{V(L,{role:E})},[V]),Y=d.useCallback(L=>{k(L),w(!0)},[]),Ke=d.useCallback(async L=>{if(S)V(S.id,L);else{const E={id:y(),name:L.name||v(),role:L.role||"vers",order:o.length,isActive:o.length===0,deviceId:"current_device",location:0,isFinished:!1,sound:L.sound};c(H=>[...H,E])}w(!1),k(null)},[S,V,y,v,o.length]),Ee=d.useCallback(()=>{w(!1),k(null)},[]),Ve=d.useCallback(async()=>{if(A()){f(!0),b(null);try{await l(o,C)}catch(L){b(L instanceof Error?L.message:r("localPlayers.errors.sessionCreation"))}finally{f(!1)}}},[o,C,A,l,r]),ze=d.useCallback(()=>{t()},[t]);return s?e.jsxs(J,{children:[e.jsx(Ue,{title:e.jsx(p,{variant:"h5",component:"h2",children:e.jsx(g,{i18nKey:"localPlayers.setupTitle"})}),subheader:e.jsx(p,{variant:"body2",color:"text.secondary",children:e.jsx(g,{i18nKey:"localPlayers.setupSubtitle"})})}),e.jsxs(Z,{children:[h&&e.jsx(D,{severity:"error",sx:{mb:2},children:h}),e.jsxs(x,{sx:{mb:3},children:[e.jsxs(x,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsx(p,{variant:"h6",children:e.jsx(g,{i18nKey:"localPlayers.playersTitle"})}),e.jsx(p,{variant:"body2",color:"text.secondary",children:r("localPlayers.playersCount",{count:o.length})})]}),o.length===0?e.jsxs(x,{sx:{textAlign:"center",py:4,border:"2px dashed",borderColor:"divider",borderRadius:1,bgcolor:"action.hover"},children:[e.jsx(p,{variant:"body1",color:"text.secondary",gutterBottom:!0,children:e.jsx(g,{i18nKey:"localPlayers.noPlayersYet"})}),e.jsx(B,{variant:"contained",startIcon:e.jsx(fe,{}),onClick:P,children:e.jsx(g,{i18nKey:"localPlayers.addFirstPlayer"})})]}):e.jsxs(e.Fragment,{children:[e.jsx(x,{sx:{display:"flex",flexDirection:"column",gap:2},children:o.map((L,E)=>e.jsx(wn,{player:L,index:E,isActive:L.isActive,canEdit:!0,canDelete:o.length>1,onEdit:Y,onDelete:q,onRoleChange:K},L.id))}),o.length<4&&e.jsx(x,{sx:{display:"flex",justifyContent:"center",mt:2},children:e.jsx(Fe,{size:"small",color:"primary",onClick:P,"aria-label":"Add player",children:e.jsx(fe,{})})})]})]}),e.jsxs(x,{sx:{display:"flex",gap:2,justifyContent:"flex-end"},children:[e.jsx(B,{variant:"outlined",onClick:ze,disabled:j,children:e.jsx(g,{i18nKey:"cancel"})}),e.jsx(B,{variant:"contained",onClick:Ve,disabled:!m||j,children:j?e.jsx(g,{i18nKey:"localPlayers.creatingSession"}):e.jsx(g,{i18nKey:"localPlayers.startSession"})})]})]}),e.jsx(kn,{open:T,player:S,existingPlayers:o,onSubmit:Ke,onCancel:Ee})]}):e.jsx(J,{children:e.jsx(Z,{children:e.jsx(D,{severity:"warning",children:e.jsx(p,{children:e.jsx(g,{i18nKey:"localPlayers.privateRoomRequired"})})})})})}function An({actionName:n,actionLabel:s,selectedLevels:l,availableLevels:t,intensityNames:i={},onChange:a,disabled:r=!1,showValueGlow:o=!1}){const{t:c}=R(),m=Se(),u=`${n}-intensity-label`,h=o&&l.length>0,b=h?{boxShadow:`0 0 8px ${m.palette.primary.main}`}:{},j=h?{backgroundColor:"var(--color-surface)",borderRadius:"8px",padding:"0 8px"}:{},f=S=>{const C=S.target.value.filter(A=>!isNaN(A)).sort((A,y)=>A-y);a(C)},T=S=>{S.stopPropagation(),a([])},w=S=>S.length===0?c("none"):S.map(k=>i[k]||`${c("level")} ${k}`).join(", ");return t.length===0?e.jsx(e.Fragment,{}):e.jsxs(O,{margin:"normal",fullWidth:!0,disabled:r,children:[e.jsx(_,{id:u,sx:j,children:s}),e.jsx(W,{labelId:u,id:n,label:s,multiple:!0,value:l,onChange:f,renderValue:w,sx:b,endAdornment:l.length>0&&e.jsx(re,{size:"small",onClick:T,sx:{position:"absolute",right:24,top:"50%",transform:"translateY(-50%)",zIndex:1,"&:hover":{backgroundColor:"rgba(0, 0, 0, 0.04)"}},children:e.jsx(we,{fontSize:"small"})}),children:t.map(S=>e.jsxs(I,{value:S,children:[e.jsx($e,{checked:l.includes(S)}),e.jsx(ue,{primary:i[S]||`${c("level")} ${S}`})]},S))})]})}function In({trueCondition:n,onChange:s,yesLabel:l,noLabel:t=null,sx:i={}}){const a=t!=null?t:l;return e.jsx(x,{sx:{display:"flex",justifyContent:"center",my:1,...i},children:e.jsx(le,{control:e.jsx(ee,{checked:n||!1,onChange:s}),label:xe(n?l:a)})})}function Ln(n,s=!1,l=!1){if(s)return n;const t={...n};return l||delete t.useRoomBackground,t}function qn(n){return n?"roomBackground":"background"}function Rn(n){return n?"roomBackgroundURL":"backgroundURL"}function Kn({formData:n,setFormData:s,backgrounds:l,isRoom:t=!1,isPrivateRoom:i=!1}){const{t:a}=R(),r=qn(t),o=Rn(t),c=d.useMemo(()=>Ln(l,t,i),[l,t,i]),m=n==null?void 0:n[r],[u,h]=d.useState(m||""),b=()=>[e.jsx(I,{value:"",children:a(i?"useRoomBackground":"customTiles.color")},"empty"),...Object.entries(c).map(([w,S])=>e.jsx(I,{value:w,children:S},w))],j=T=>{const w=T.target.value,S={...n,[r]:w};if(w!=="custom"){const k={...S,[o]:""};t&&(k.roomUpdated=!0),s(k),h(w);return}t&&(S.roomUpdated=!0),s(S),h(w)};d.useEffect(()=>{const T=m&&c[m]?m:"";u!==T&&h(T)},[u,m,c]);const f=T=>{const w={...n,[r]:"custom",[o]:T.target.value};t&&(w.roomUpdated=!0),s(w)};return e.jsxs(e.Fragment,{children:[e.jsxs(O,{fullWidth:!0,margin:"normal",children:[e.jsx(_,{id:"background-label",children:a("background")}),e.jsx(W,{labelId:"background-label",id:"background",label:a("background"),value:u,onChange:j,displayEmpty:!0,children:b()})]}),u==="custom"&&e.jsx(ne,{sx:{mt:2},label:a("url"),value:(n==null?void 0:n[o])||"",fullWidth:!0,onChange:f,helperText:e.jsxs(e.Fragment,{children:[a("supportedSites"),e.jsx("br",{}),a("requiresEmbeddedUrl")]})})]})}var En=Object.defineProperty,Vn=(n,s,l)=>s in n?En(n,s,{enumerable:!0,configurable:!0,writable:!0,value:l}):n[s]=l,zn=(n,s,l)=>Vn(n,s+"",l);class Bn{constructor(){zn(this,"voiceLoadPromise")}async waitForVoices(){return this.voiceLoadPromise?this.voiceLoadPromise:(this.voiceLoadPromise=new Promise(s=>{let l=window.speechSynthesis.getVoices();if(l.length>0){s(l);return}const t=()=>{l=window.speechSynthesis.getVoices(),l.length>0&&(window.speechSynthesis.removeEventListener("voiceschanged",t),s(l))};window.speechSynthesis.addEventListener("voiceschanged",t),setTimeout(()=>{window.speechSynthesis.removeEventListener("voiceschanged",t),s(window.speechSynthesis.getVoices())},3e3)}),this.voiceLoadPromise)}async getAvailableVoicesAsync(){return(await this.waitForVoices()).map(l=>({name:l.name,displayName:`${l.name} (${l.lang})`}))}async getPreferredVoiceAsync(){const s=await this.getAvailableVoicesAsync();return s.length>0?s[0].name:null}async speak(s,l,t=0){return new Promise((i,a)=>{if(!("speechSynthesis"in window)){a(new Error("Speech synthesis not supported"));return}const r=new SpeechSynthesisUtterance(s);if(r.pitch=t,l){const c=window.speechSynthesis.getVoices().find(m=>m.name===l);c&&(r.voice=c)}r.onend=()=>i(),r.onerror=o=>a(new Error(`Speech failed: ${o.error}`)),window.speechSynthesis.speak(r)})}stop(){var s;(s=window.speechSynthesis)!=null&&s.speaking&&window.speechSynthesis.cancel()}isAvailable(){return"speechSynthesis"in window}}const ae=new Bn,Mn=()=>{const[n,s]=d.useState(!1),[l,t]=d.useState(!1),[i,a]=d.useState(null),r=d.useCallback(()=>{ae.stop(),s(!1),t(!1)},[]),o=d.useCallback(async(c,m={})=>{try{t(!0),a(null),r(),s(!0),await ae.speak(c,m.voice,m.pitch),t(!1),s(!1)}catch(u){const h=u instanceof Error?u.message:"TTS failed";a(h),s(!1),t(!1),console.error("TTS Error:",u)}},[r]);return d.useEffect(()=>()=>{r()},[r]),{speak:o,stop:r,isPlaying:n,error:i,isLoading:l}};function Nn({formData:n,setFormData:s,onVoiceChange:l}){const{t}=R(),[i,a]=d.useState([]),[r,o]=d.useState(!0),{speak:c}=Mn(),m=n.voicePreference||"",u=d.useCallback(f=>{const T={...n,voicePreference:f};s(T),l==null||l(f)},[n,s,l]);d.useEffect(()=>{let f=!0;return(async()=>{try{if(f){o(!0);const w=await ae.getAvailableVoicesAsync();if(f){const S=w.filter(k=>k.displayName.includes("Google")||k.name.includes("Google"));if(a(S),!m&&S.length>0){const k=await ae.getPreferredVoiceAsync();k&&S.some(C=>C.name===k)&&f?u(k):f&&u(S[0].name)}o(!1)}}}catch(w){console.error("Failed to load voices:",w),f&&o(!1)}})(),()=>{f=!1}},[m,u]);const h=f=>{u(f.target.value)},b=async()=>{const f=m||(i.length>0?i[0].name:"");if(!f)return;const T=t("tts.sampleText","Take a drink and enjoy the game.");try{await c(T,{voice:f,pitch:-2})}catch(w){console.error("Failed to play sample:",w)}},j=f=>f.displayName.replace(/^Google\s+/i,"");return r?e.jsx(x,{sx:{py:1},children:e.jsx(p,{variant:"body2",color:"text.secondary",children:t("loadingVoices","Loading voices...")})}):i.length===0?e.jsx(x,{sx:{py:1},children:e.jsx(p,{variant:"body2",color:"text.secondary",children:t("noVoicesAvailable","No voices available for this language")})}):e.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:1,py:1},children:[e.jsxs(O,{fullWidth:!0,size:"small",children:[e.jsx(_,{id:"voice-select-label",children:t("voiceSelection","Voice")}),e.jsx(W,{labelId:"voice-select-label",value:m,label:t("voiceSelection","Voice"),onChange:h,children:i.map(f=>e.jsx(I,{value:f.name,children:j(f)},f.name))})]}),e.jsx(G,{title:t("playSample","Play sample"),children:e.jsx(re,{onClick:b,color:"primary",disabled:!m,size:"small",children:e.jsx(ge,{})})})]})}function On({boardUpdated:n}){const{i18n:s}=R(),[l,t]=d.useState(s.resolvedLanguage||"en"),[i,a]=d.useState(!1);async function r(c){a(!0),t(c);try{await s.changeLanguage(c),n()}catch(m){console.error("Error changing language:",m),await s.changeLanguage(c),n()}finally{a(!1)}}const o=Object.entries(cn).map(([c,m])=>e.jsx(I,{value:c,children:m.label},c));return e.jsx(x,{sx:{minWidth:120,mt:1,mb:2},children:e.jsxs(O,{fullWidth:!0,children:[e.jsxs(_,{id:"language-label",sx:{display:"flex",alignItems:"center"},children:[e.jsx(je,{sx:{mr:1}}),e.jsx(g,{i18nKey:"language"})]}),e.jsx(W,{labelId:"language-label",id:"language-select",value:l,disabled:i,label:e.jsxs(e.Fragment,{children:[e.jsx(je,{}),e.jsx(g,{i18nKey:"language"})]}),onChange:c=>r(c.target.value),endAdornment:i&&e.jsx(Ge,{size:20}),MenuProps:{disableScrollLock:!0,BackdropProps:{invisible:!0},PaperProps:{style:{backdropFilter:"none",WebkitBackdropFilter:"none"}}},children:o})]})})}function $({field:n,formData:s,handleSwitch:l}){return e.jsx(In,{trueCondition:s[n],onChange:t=>l(t,n),yesLabel:n,sx:{justifyContent:"left"}})}function _n({formData:n,setFormData:s,boardUpdated:l}){const[t,i]=ke(),a=!!(n.room&&!U(n.room)),{t:r}=R(),o={useRoomBackground:r("useRoomBackground"),color:r("color"),gray:r("gray"),"metronome.gif":r("hypnoDick"),"pink-spiral.gif":r("pinkSpiral"),custom:r("customURL")};function c(u,h){s({...n,[h]:u.target.checked}),i({...t,[h]:u.target.checked})}function m(u){i({...t,voicePreference:u})}return e.jsxs(e.Fragment,{children:[e.jsx(On,{boardUpdated:l}),e.jsx(p,{variant:"h5",children:e.jsx(g,{i18nKey:"dialog"})}),e.jsx($,{field:"playerDialog",formData:n,handleSwitch:c}),e.jsx($,{field:"othersDialog",formData:n,handleSwitch:c}),e.jsx(X,{}),e.jsx(p,{variant:"h5",sx:{mt:2},children:e.jsx(g,{i18nKey:"sounds"})}),e.jsx($,{field:"mySound",formData:n,handleSwitch:c}),e.jsx($,{field:"otherSound",formData:n,handleSwitch:c}),e.jsx($,{field:"chatSound",formData:n,handleSwitch:c}),e.jsx($,{field:"readRoll",formData:n,handleSwitch:c}),n.readRoll&&e.jsx(Nn,{formData:n,setFormData:s,onVoiceChange:m}),e.jsx(X,{}),e.jsx(p,{variant:"h5",sx:{mt:2,textTransform:"capitalize"},children:e.jsx(g,{i18nKey:"misc"})}),e.jsx($,{field:"hideBoardActions",formData:n,handleSwitch:c}),e.jsx($,{field:"advancedSettings",formData:n,handleSwitch:c}),e.jsx(Kn,{formData:n,setFormData:s,backgrounds:o,isPrivateRoom:a}),e.jsx(X,{})]})}function Wn({formData:n,setFormData:s}){const l=(i,a)=>{s({...n,finishRange:a,boardUpdated:!0})},t=(n==null?void 0:n.finishRange)||[30,70];return e.jsxs(x,{children:[e.jsx(X,{}),e.jsx(p,{id:"finish-slider",sx:{my:1},children:e.jsx(g,{i18nKey:"finishSlider"})}),e.jsx(Ye,{"aria-labelledby":"finish-slider",value:t,onChange:l,valueLabelDisplay:"off"}),e.jsxs(x,{display:"flex",flexDirection:"column",justifyContent:"space-between",textAlign:"center",children:[e.jsxs(p,{whiteSpace:"nowrap",children:[e.jsx(g,{i18nKey:"noCum"})," ",t[0],"%"]}),e.jsxs(p,{whiteSpace:"nowrap",children:[e.jsx(g,{i18nKey:"ruined"})," ",t[1]-t[0],"%"]}),e.jsxs(p,{whiteSpace:"nowrap",children:[e.jsx(g,{i18nKey:"cum"})," ",100-t[1],"%"]})]}),e.jsx(X,{sx:{my:1}})]})}function be({children:n}){return e.jsx(z,{size:{xs:12,md:5},children:n})}function ce({children:n,title:s,subtitle:l,defaultExpanded:t=!1,hasSelectedOptions:i=!1,...a}){const r=Se();return e.jsxs(He,{defaultExpanded:t,...a,sx:{backgroundColor:"inherit",backgroundImage:"none",boxShadow:"none"},children:[e.jsx(Je,{expandIcon:e.jsx(ln,{}),sx:{px:0},children:e.jsxs(x,{sx:{display:"flex",alignItems:"center",width:"100%"},children:[e.jsxs(p,{variant:"h6",sx:{display:"flex",alignItems:"center",gap:1,minWidth:"fit-content"},children:[s,":",i&&e.jsx(x,{sx:{width:8,height:8,borderRadius:"50%",backgroundColor:r.palette.primary.main,flexShrink:0}})]}),e.jsx(p,{sx:{pt:.5,ml:2,flex:1},children:l})]})}),e.jsx(Ze,{sx:{px:0},children:e.jsx(z,{container:!0,columnSpacing:2,justifyContent:"space-evenly",className:"columned-grid",children:n})})]})}const qe=d.forwardRef(({value:n,onChange:s,label:l,options:t,defaultValue:i=null,sx:a,helpIcon:r=!1,fullWidth:o=!0,...c},m)=>{const u=d.useMemo(()=>t.map(h=>typeof h=="string"?e.jsx(I,{value:h,children:xe(h)},h):e.jsx(I,{value:h.value,children:h.label},h.value)),[t]);return e.jsxs(O,{fullWidth:o,margin:"normal",sx:a,...c,ref:m,children:[e.jsxs(_,{id:`${l}Label`,children:[e.jsx(g,{i18nKey:l}),!!r&&e.jsx(F,{sx:{ml:1,fontSize:16}})]}),e.jsx(W,{labelId:`${l}Label`,id:l,label:e.jsxs(e.Fragment,{children:[e.jsx(g,{i18nKey:l}),!!r&&e.jsx(F,{sx:{ml:1,fontSize:16}})]}),value:n||i||"",onChange:s,children:u})]})});function Un({option:n,settings:s,setSettings:l,actionsFolder:t,type:i,showVariation:a=!1,showRole:r=!1}){var o,c,m,u,h,b;const{t:j}=R(),f=`${n}label`,T=(o=t[n])==null?void 0:o.label;function w(y,v,P){var q,V,K;const Y=(q=s.selectedActions)==null?void 0:q[v];l({...s,selectedActions:{...s.selectedActions,[v]:{...Y,type:i,levels:(V=Y==null?void 0:Y.levels)!=null?V:[],[P]:(K=y==null?void 0:y.target)==null?void 0:K.value}},boardUpdated:!0})}function S(y,v){var P;const q=(P=s.selectedActions)==null?void 0:P[v];l({...s,selectedActions:{...s.selectedActions,[v]:{...q,type:i,levels:y}},boardUpdated:!0})}let k=12;(a||r)&&(k=6);let C=["dom","vers","sub"];(c=t[n])!=null&&c.dom&&(C=[{label:t[n].dom,value:"dom"},{label:j("vers"),value:"vers"},{label:t[n].sub,value:"sub"}]);const A=()=>{var y,v;const P=t[n],q=P!=null&&P.intensities?Object.keys(P.intensities).map(Number).filter(K=>K>0).sort((K,Y)=>K-Y):[1,2,3,4],V=((v=(y=s.selectedActions)==null?void 0:y[n])==null?void 0:v.levels)||[];return e.jsx(An,{actionName:n,actionLabel:(P==null?void 0:P.label)||n,selectedLevels:V,availableLevels:q,intensityNames:(P==null?void 0:P.intensities)||{},onChange:K=>S(K,n),showValueGlow:!0})};return e.jsxs(z,{container:!0,justifyContent:"center",children:[e.jsx(z,{size:k,children:A()}),!!r&&e.jsx(z,{size:6,children:e.jsx(qe,{sx:{ml:1},value:(u=(m=s.selectedActions)==null?void 0:m[n])==null?void 0:u.role,onChange:y=>w(y,n,"role"),label:`${j("role")}: ${T}`,options:C,defaultValue:s.role||"sub"})}),!!a&&e.jsx(z,{size:6,children:e.jsx(G,{placement:"top",title:e.jsxs(g,{i18nKey:"variationTooltip",children:[e.jsx(p,{variant:"subtitle2",children:"Standalone = Its own tile. "}),e.jsx(p,{variant:"subtitle2",children:"Append Some = 50% chance."}),e.jsx(p,{variant:"subtitle2",children:"Append Most = 90% chance."})]}),arrow:!0,children:e.jsxs(O,{fullWidth:!0,margin:"normal",sx:{ml:1},children:[e.jsxs(_,{id:`${f}Variation`,children:[`${T} ${j("variation")}`,e.jsx(F,{sx:{ml:1,fontSize:16}})]}),e.jsxs(W,{labelId:`${f}Variation`,id:`${n}Variation`,label:e.jsxs(e.Fragment,{children:[T," ",j("variation"),e.jsx(F,{sx:{ml:1,fontSize:16}})]}),value:((b=(h=s.selectedActions)==null?void 0:h[n])==null?void 0:b.variation)||"standalone",onChange:y=>w(y,n,"variation"),children:[e.jsx(I,{value:"standalone",children:e.jsx(g,{i18nKey:"standalone"})}),e.jsx(I,{value:"appendSome",children:e.jsx(g,{i18nKey:"appendSome"})}),e.jsx(I,{value:"appendMost",children:e.jsx(g,{i18nKey:"appendMost"})})]})]})})})]},n)}function Fn({formData:n,setFormData:s}){return e.jsxs(me,{direction:"row",spacing:1,alignItems:"center",justifyContent:"center",sx:{mt:1},children:[e.jsx(p,{children:e.jsx(g,{i18nKey:"solo"})}),e.jsx(G,{title:e.jsx(p,{variant:"subtitle2",children:e.jsx(g,{i18nKey:"soloTooltip"})}),arrow:!0,children:e.jsx(F,{sx:{fontSize:15}})}),e.jsx(ee,{id:"gameMode",checked:!te(n.gameMode),onChange:l=>s({...n,gameMode:l.target.checked?"local":"online",boardUpdated:!0}),inputProps:{"aria-label":"Game Type"}}),e.jsx(p,{children:e.jsx(g,{i18nKey:"local"})}),e.jsx(G,{title:e.jsx(p,{variant:"subtitle2",children:e.jsx(g,{i18nKey:"localTooltip"})}),arrow:!0,children:e.jsx(F,{sx:{fontSize:15}})})]})}function $n({formData:n}){const[s,l]=d.useState(!1);return d.useEffect(()=>{const t=Object.values(n).filter(a=>typeof a=="object"&&(a==null?void 0:a.type)==="consumption"&&(a==null?void 0:a.levels)&&a.levels.length>0).length,i=Object.values(n).filter(a=>typeof a=="object"&&(a==null?void 0:a.levels)&&a.levels.length>0).length;l(t>1&&t>=i-t)},[n]),s?e.jsx(D,{severity:"warning",children:e.jsx(g,{i18nKey:"consumptionWarning"})}):null}function Gn({formData:n,setFormData:s,actionsList:l}){const{t}=R(),{hasLocalPlayers:i}=un(),a=!te(n.gameMode),r=!i();function o(u){return Object.keys(l).filter(h=>{var b;return((b=l[h])==null?void 0:b.type)===u}).some(h=>{var b;const j=(b=n.selectedActions)==null?void 0:b[h];return(j==null?void 0:j.levels)&&j.levels.length>0})}function c(u,h={}){return Object.keys(l).filter(b=>{var j;return((j=l[b])==null?void 0:j.type)===u}).map(b=>e.jsx(be,{children:e.jsx(Un,{option:b,settings:n,setSettings:s,actionsFolder:l,type:u,...h})},b))}const m=u=>{const h=JSON.parse(JSON.stringify(n));return Object.keys(h).forEach(b=>{h.role=u,b.includes("role")&&(h[b]=u)}),h};return e.jsxs(e.Fragment,{children:[e.jsx(Fn,{formData:n,setFormData:s}),U(n==null?void 0:n.room)&&!te(n.gameMode)&&e.jsx(z,{container:!0,alignContent:"center",justifyContent:"space-evenly",children:e.jsx(z,{sx:{py:3},children:e.jsx(p,{variant:"h5",children:e.jsx(g,{i18nKey:"privateRequired"})})})}),a?e.jsxs(e.Fragment,{children:[e.jsx(z,{container:!0,columnSpacing:2,justifyContent:"space-evenly",children:r&&e.jsx(be,{children:e.jsx(qe,{value:n.role,onChange:u=>s({...m(u.target.value),boardUpdated:!0}),label:"mainRole",options:["dom","vers","sub"],defaultValue:"sub"})})}),e.jsx(ce,{title:t("consumption"),subtitle:t("consumptionSubtitle"),hasSelectedOptions:o("consumption"),children:c("consumption",{showVariation:!0})}),e.jsx(ce,{title:t("foreplay"),subtitle:t("foreplaySubtitle"),hasSelectedOptions:o("foreplay"),children:c("foreplay",{showRole:r})}),e.jsx(ce,{title:t("sex"),subtitle:t("sexSubtitle"),hasSelectedOptions:o("sex"),children:c("sex",{showRole:r})})]}):e.jsxs(e.Fragment,{children:[e.jsx(z,{container:!0,columnSpacing:2,justifyContent:"space-evenly",children:c("consumption",{showVariation:!0})}),e.jsx(X,{}),e.jsx(z,{container:!0,columnSpacing:2,justifyContent:"center",children:c("solo")})]}),e.jsx(Wn,{setFormData:s,formData:n}),e.jsx($n,{formData:n})]})}function Yn({formData:n,setFormData:s}){const{t:l}=R(),t=i=>{const a=i.target.value.trim();s({...n,roomBackgroundURL:a,roomUpdated:!0})};return e.jsx(ne,{sx:{mt:2},label:l("roomBackgroundURL"),value:(n==null?void 0:n.roomBackgroundURL)||"",fullWidth:!0,onChange:t,helperText:l("supportedSites"),placeholder:l("roomBackgroundPlaceholder"),type:"url",inputMode:"url",autoComplete:"off",spellCheck:!1,autoCapitalize:"none"})}function Hn({formData:n,setFormData:s}){const{t:l}=R(),t={"1d4":2.5,"1d6":3.5,"2d4":5},i=n!=null&&n.roomTileCount?Math.floor(n.roomTileCount/t[n.roomDice||"1d6"]):16,a=Array.from({length:7},(r,o)=>(o+2)*10).map(r=>e.jsx(I,{value:r,children:r},r));return e.jsxs(x,{children:[e.jsx(p,{variant:"subtitle1",sx:{mb:2,fontWeight:"medium"},children:e.jsx(g,{i18nKey:"gameSpeed"})}),e.jsxs(x,{sx:{display:"flex",gap:2,alignItems:"flex-end",flexWrap:"wrap"},children:[e.jsxs(O,{sx:{minWidth:120,flex:1},children:[e.jsx(_,{id:"diceRole-label",children:e.jsx(g,{i18nKey:"roomDice"})}),e.jsxs(W,{labelId:"diceRole-label",id:"diceRole-select",value:(n==null?void 0:n.roomDice)||"1d4",label:l("roomDice"),onChange:r=>s({...n,roomDice:r.target.value,roomUpdated:!0}),children:[e.jsx(I,{value:"1d4",children:"1d4"}),e.jsx(I,{value:"1d6",children:"1d6"}),e.jsx(I,{value:"2d4",children:"2d4"})]})]}),e.jsxs(O,{sx:{minWidth:120,flex:1},children:[e.jsx(_,{id:"tile-count-label",children:e.jsx(g,{i18nKey:"roomTileCount"})}),e.jsx(W,{labelId:"tile-count-label",id:"tile-count-select",value:String((n==null?void 0:n.roomTileCount)||40),label:l("roomTileCount"),onChange:r=>s({...n,roomTileCount:Number(r.target.value),roomUpdated:!0}),children:a})]}),e.jsxs(x,{sx:{display:"flex",flexDirection:"column",alignItems:"center",minWidth:120},children:[e.jsx(p,{variant:"body2",color:"text.secondary",sx:{mb:1},children:e.jsx(g,{i18nKey:"averageRolls"})}),e.jsx(N,{label:i,color:"primary",variant:"outlined",sx:{minWidth:50,fontWeight:"bold"}})]})]})]})}function Jn({formData:n,setFormData:s}){const l=d.useCallback(()=>{s({...n,roomRealtime:!n.roomRealtime,roomUpdated:!0})},[n,s]);return e.jsxs(x,{children:[e.jsx(p,{variant:"subtitle1",sx:{mb:2,fontWeight:"medium"},children:e.jsx(g,{i18nKey:"playerListOptions"})}),e.jsx(x,{sx:{display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsxs(me,{direction:"row",spacing:2,alignItems:"center",children:[e.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(p,{variant:"body2",color:"text.secondary",children:e.jsx(g,{i18nKey:"realtime"})}),e.jsx(G,{title:e.jsx(p,{variant:"subtitle2",children:e.jsx(g,{i18nKey:"realtimeTooltip"})}),arrow:!0,children:e.jsx(F,{sx:{fontSize:16,color:"text.secondary"}})})]}),e.jsx(le,{control:e.jsx(ee,{checked:!!n.roomRealtime,onChange:l,inputProps:{"aria-label":xe("playerList")}}),label:"",sx:{margin:0}}),e.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(p,{variant:"body2",color:"text.secondary",children:e.jsx(g,{i18nKey:"delayed"})}),e.jsx(G,{title:e.jsx(p,{variant:"subtitle2",children:e.jsx(g,{i18nKey:"delayedTooltip"})}),arrow:!0,children:e.jsx(F,{sx:{fontSize:16,color:"text.secondary"}})})]})]})})]})}function Zn({formData:n,setFormData:s}){var l;const{id:t}=Qe(),{t:i}=R(),a=u=>{let h;u.target.checked&&U(t)?h=gn("123456789ABCDEFGHJKLMNPQRSTUVWXYZ",5)():t&&u.target.checked&&!U(t)?h=t:h="PUBLIC",s({...n,room:h.toUpperCase(),gameMode:U(h)?"online":n.gameMode})},r=d.useCallback(u=>{s({...n,room:u.currentTarget.value,boardUpdated:!0})},[n,s]),o=d.useCallback(u=>{u.key==="Enter"&&s({...n,room:u.currentTarget.value,boardUpdated:!0})},[n,s]),c=d.useCallback(u=>{const h=u.target.value.toUpperCase();u.target.value=h},[]),m=!U(n.room);return e.jsxs(e.Fragment,{children:[e.jsxs(me,{direction:"row",spacing:1,alignItems:"center",justifyContent:"center",sx:{width:"100%"},children:[e.jsx(p,{children:e.jsx(g,{i18nKey:"public"})}),e.jsx(ee,{id:"showPrivate",checked:m,onChange:a,slotProps:{input:{"aria-label":i("room")}}}),e.jsx(p,{children:e.jsx(g,{i18nKey:"private"})}),e.jsx(G,{title:e.jsx(p,{variant:"subtitle2",children:e.jsx(g,{i18nKey:"privateOptions"})}),arrow:!0,children:e.jsx(F,{sx:{fontSize:15}})})]}),m&&e.jsx(ne,{fullWidth:!0,id:"privateRoom",label:i("privateRoom"),defaultValue:(l=n.room)==null?void 0:l.toUpperCase(),margin:"normal",onBlur:r,onKeyDown:o,onChange:c,inputProps:{style:{textTransform:"uppercase"}}})]})}function Qn({roomId:n="PRIVATE",isPrivateRoom:s=!0}){const{t:l}=R(),{localPlayers:t,hasLocalPlayers:i,session:a,sessionSettings:r,clearLocalSession:o,updateSettings:c,createLocalSession:m}=hn(),[u,h]=d.useState(!1),[b,j]=d.useState(null),f=d.useCallback(()=>{h(!0),j(null)},[]),T=d.useCallback(()=>{h(!1),j(null)},[]),w=d.useCallback(async(C,A)=>{try{await m(n,C,A),h(!1),j(null)}catch(y){j(y instanceof Error?y.message:"Failed to save local player configuration")}},[n,m]),S=d.useCallback(async()=>{try{await o(),j(null)}catch(C){j(C instanceof Error?C.message:"Failed to clear local session")}},[o]),k=d.useCallback(async(C,A)=>{if(r)try{const y={...r,[C]:A};await c(y),j(null)}catch(y){j(y instanceof Error?y.message:"Failed to update settings")}},[r,c]);return u?e.jsxs(x,{children:[b&&e.jsx(D,{severity:"error",sx:{mb:2},children:b}),e.jsx(Tn,{roomId:n,isPrivateRoom:s,onComplete:w,onCancel:T,initialPlayers:t,initialSettings:r})]}):e.jsxs(x,{children:[b&&e.jsx(D,{severity:"error",sx:{mb:2},children:b}),i?e.jsxs(x,{children:[e.jsxs(x,{sx:{mb:3},children:[e.jsx(x,{sx:{display:"flex",flexDirection:"column",gap:1,mb:2},children:t.map(C=>e.jsxs(x,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",p:1,borderRadius:1,bgcolor:C.isActive?"primary.50":"background.default",border:C.isActive?"1px solid":"1px solid transparent",borderColor:C.isActive?"primary.main":"transparent"},children:[e.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsxs(p,{variant:"body2",color:"text.secondary",children:["#",C.order+1]}),e.jsx(p,{variant:"body1",fontWeight:C.isActive?"bold":"normal",children:C.name}),e.jsx(N,{label:l(`roles.${C.role}`),size:"small",variant:"outlined"})]}),C.isActive&&e.jsx(N,{label:l("localPlayerSettings.players.currentTurn"),color:"primary",size:"small"})]},C.id))}),e.jsxs(x,{sx:{display:"flex",gap:1},children:[e.jsx(B,{variant:"outlined",startIcon:e.jsx(Ce,{}),onClick:f,size:"small",children:e.jsx(g,{i18nKey:"localPlayerSettings.session.editButton"})}),e.jsx(B,{variant:"outlined",color:"error",startIcon:e.jsx(we,{}),onClick:S,size:"small",children:e.jsx(g,{i18nKey:"localPlayerSettings.session.clearButton"})})]})]}),(a==null?void 0:a.settings)&&e.jsxs(x,{sx:{mt:3,p:2,borderRadius:1,bgcolor:"action.hover"},children:[e.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[e.jsx(tn,{sx:{color:"text.secondary"}}),e.jsx(p,{variant:"subtitle1",component:"h4",children:e.jsx(g,{i18nKey:"localPlayerSettings.settings.title"})})]}),e.jsxs(x,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsx(le,{control:e.jsx(ee,{checked:a.settings.showTurnTransitions,onChange:C=>k("showTurnTransitions",C.target.checked)}),label:l("localPlayerSettings.settings.showTurnTransitions")}),e.jsx(le,{control:e.jsx(ee,{checked:a.settings.enableTurnSounds,onChange:C=>k("enableTurnSounds",C.target.checked)}),label:l("localPlayerSettings.settings.playTurnSounds")})]})]})]}):e.jsxs(x,{sx:{textAlign:"center",py:2},children:[e.jsx(Pe,{sx:{fontSize:48,color:"text.secondary",mb:2}}),e.jsx(p,{variant:"body1",color:"text.secondary",paragraph:!0,children:e.jsx(g,{i18nKey:"localPlayerSettings.noPlayers.description"})}),e.jsx(B,{variant:"contained",startIcon:e.jsx(ge,{}),onClick:f,size:"large",children:e.jsx(g,{i18nKey:"localPlayerSettings.noPlayers.setupButton"})})]})]})}function Xn({formData:n,setFormData:s}){const{t:l}=R();return e.jsxs(x,{sx:{p:2},children:[e.jsx(J,{variant:"outlined",sx:{mb:3},children:e.jsxs(Z,{children:[e.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[e.jsx(an,{sx:{color:"primary.main"}}),e.jsx(p,{variant:"h6",component:"h3",children:l("roomType")})]}),e.jsx(Zn,{formData:n,setFormData:s})]})}),!U(n.room)&&e.jsxs(e.Fragment,{children:[e.jsx(J,{variant:"outlined",sx:{mb:3},children:e.jsxs(Z,{children:[e.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[e.jsx(Pe,{sx:{color:"primary.main"}}),e.jsx(p,{variant:"h6",component:"h3",children:l("localPlayerSettings.title")})]}),e.jsx(Qn,{roomId:n.room,isPrivateRoom:!U(n.room)})]})}),e.jsx(J,{variant:"outlined",sx:{mb:3},children:e.jsxs(Z,{children:[e.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[e.jsx(rn,{sx:{color:"primary.main"}}),e.jsx(p,{variant:"h6",component:"h3",children:l("gameConfiguration")})]}),e.jsx(x,{sx:{mb:3},children:e.jsx(Hn,{formData:n,setFormData:s})}),e.jsx(x,{sx:{p:2,borderRadius:1,bgcolor:"action.hover"},children:e.jsx(Jn,{formData:n,setFormData:s})})]})}),e.jsx(J,{variant:"outlined",sx:{mb:3},children:e.jsxs(Z,{children:[e.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[e.jsx(on,{sx:{color:"primary.main"}}),e.jsx(p,{variant:"h6",component:"h3",children:l("visualSettings")})]}),e.jsx(Yn,{formData:n,setFormData:s})]})})]})]})}function de({children:n,value:s,index:l,style:t,...i}){return e.jsx("div",{role:"tabpanel",hidden:s!==l,id:`simple-tabpanel-${l}`,"aria-labelledby":`simple-tab-${l}`,...i,children:s===l&&e.jsx(x,{sx:{p:3,...t},children:n})})}const Re=({levels:n})=>!!(n!=null&&n.length)&&n.some(s=>s>0);function Dn(n){return Object.values(n).some(Re)}function es(n,s){const l=n.selectedActions||{};return Object.entries(l).reduce((t,[i,a])=>{var r;if(i in s){const o=(r=a==null?void 0:a.variation)!=null&&r.startsWith("append")?"withAppend":"withoutAppend";t[o][i]=a}return t},{withAppend:{},withoutAppend:{}})}function ns(n){return Object.keys(n).length>0&&Object.values(n).some(Re)}function ss(n,s){const{withAppend:l,withoutAppend:t}=es(n,s);return Dn(t)?U(n.room)&&!te(n.gameMode)?"privateRequired":null:ns(l)?"appendWithAction":"pickSomething"}function ls({closeDialog:n,initialTab:s=0,onOpenSetupWizard:l}){const{user:t}=dn(),{t:i}=R(),[a,r]=ke(),[o,c]=d.useState(s),[m,u]=d.useState(null),[h,b]=d.useState(!1),[j,f]=xn(),T=yn(),{isLoading:w,actionsList:S}=fn(j==null?void 0:j.gameMode),k=(P,q)=>{c(q)},C=()=>r({...a,boardUpdated:!0}),A=d.useCallback(async P=>{P.preventDefault();const{displayName:q,...V}=j,K=ss(V,S);return K?(u(i(K)),null):(await T(j,S),typeof n=="function"&&n(),null)},[j,S,i,u,T,n]),y=d.useCallback(P=>{f(q=>({...q,displayName:P.target.value}))},[f]),v=d.useCallback(P=>{P.key==="Enter"&&(f(q=>({...q,displayName:P.target.value})),A(P))},[A,f]);return!j.room||w?e.jsxs(x,{children:[e.jsxs(p,{variant:"h2",children:[e.jsx(g,{i18nKey:"loading"}),"..."]}),e.jsx(p,{variant:"body1",children:e.jsx(g,{i18nKey:"clearStorage"})})]}):e.jsxs(x,{component:"form",method:"post",onSubmit:A,className:"settings-box",children:[e.jsx(ne,{fullWidth:!0,id:"displayName",label:i("displayName"),defaultValue:(t==null?void 0:t.displayName)||j.displayName||"",required:!0,autoFocus:!0,onBlur:y,onKeyDown:v,margin:"normal"}),e.jsx(x,{sx:{borderBottom:1,borderColor:"divider"},children:e.jsxs(Xe,{value:o,onChange:k,"aria-label":i("gameSettings"),centered:!0,children:[e.jsx(ie,{label:i("gameboard"),...oe(0)}),e.jsx(ie,{label:i("room"),...oe(1)}),e.jsx(ie,{label:i("application"),...oe(2)})]})}),e.jsx(de,{value:o,index:0,style:{p:0},children:e.jsx(Gn,{formData:j,setFormData:f,actionsList:S})}),e.jsx(de,{value:o,index:1,style:{p:0,pt:1},children:e.jsx(Xn,{formData:j,setFormData:f})}),e.jsx(de,{value:o,index:2,style:{p:0,pt:1},children:e.jsx(_n,{formData:j,setFormData:f,boardUpdated:C})}),e.jsxs("div",{className:"flex-buttons",children:[e.jsxs("div",{className:"left-buttons",children:[l&&e.jsx(B,{variant:"outlined",type:"button",onClick:l,children:e.jsx(g,{i18nKey:"setupWizard"})}),o===0&&e.jsx(B,{variant:"outlined",type:"button",onClick:()=>b(!0),children:e.jsx(g,{i18nKey:"customTilesLabel",children:"Game Tiles"})})]}),e.jsx(B,{variant:"contained",type:"submit",children:e.jsx(g,{i18nKey:"update"})})]}),h&&e.jsx(mn,{open:h,setOpen:b,boardUpdated:C,actionsList:S}),e.jsx(pn,{open:!!m,close:()=>u(null),children:m})]})}const ms=Object.freeze({__proto__:null,default:ls});export{ls as G,Tn as L,An as M,de as T,In as Y,Sn as g,ms as i,bn as p,ae as t};
//# sourceMappingURL=chunk-D4HAf_Fz.js.map
