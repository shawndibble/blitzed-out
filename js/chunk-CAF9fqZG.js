var Ne=Object.defineProperty;var Oe=(n,t,s)=>t in n?Ne(n,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):n[t]=s;var ge=(n,t,s)=>Oe(n,typeof t!="symbol"?t+"":t,s);import{ak as L,r as d,j as e,ap as _,s as We,am as x,a$ as ve,T as g,U as B,I as ae,aM as ye,M as q,aN as pe,aO as de,aq as Y,z as M,y as N,as as O,b0 as Ue,aG as $,W as Fe,av as $e,Y as Ge,A as re,aR as Z,R as _e,Q as V,ar as m,aP as Ye,b1 as He,E as Se,b2 as Je,az as ne,au as he,aA as X,at as Qe,a1 as Q,b3 as Ze,ao as z,aD as Xe,aF as De,aE as en,aQ as xe,ad as nn,$ as sn,Z as le}from"./chunk-D6lSgkQl.js";import{z as tn,o as an,B as Ce,F as rn,H as ln,d as me,r as je,J as Pe,b as fe,K as on,N as W,O as we,t as cn,Q as dn,T as un,W as hn}from"./chunk-CM1AJoxz.js";import{l as xn}from"./chunk-BtqLIqNe.js";import{u as ke}from"./chunk-C_oFcKuT.js";import{d as se,i as F,u as mn,f as ie}from"./chunk-Dg2M8K1O.js";import{a as gn,u as yn}from"./chunk-DII0TLDP.js";import{u as pn,C as jn}from"./chunk-CPjbtVGL.js";import{d as fn}from"./chunk-CygiBK7d.js";import{T as bn}from"./chunk-f7_oMwUp.js";import{a as vn,b as Sn}from"./chunk-DRy_r6vV.js";const Te=[{id:"tritone",name:"Tri-tone",frequency:1318,type:"sine",duration:400,category:"classic",frequencies:[1318,1568,1175]},{id:"rebound",name:"Rebound",frequency:800,type:"triangle",duration:350,category:"classic"},{id:"chime",name:"Chime",frequency:1e3,type:"sine",duration:500,category:"classic",frequencies:[1e3,1200,1400]},{id:"boop",name:"Boop",frequency:600,type:"sine",duration:150,category:"classic"},{id:"breeze",name:"Breeze",frequency:400,type:"triangle",duration:600,category:"classic",frequencies:[400,500,600,500]},{id:"pong",name:"Pong",frequency:1100,type:"square",duration:200,category:"classic"},{id:"glass",name:"Glass",frequency:1800,type:"sine",duration:300,category:"classic",frequencies:[1800,1600,1400]},{id:"funk",name:"Funk",frequency:220,type:"sawtooth",duration:400,category:"classic"}],Ae=[{id:"c4",name:"C Note",frequency:261.63,type:"sine",duration:300,category:"musical"},{id:"d4",name:"D Note",frequency:293.66,type:"sine",duration:300,category:"musical"},{id:"e4",name:"E Note",frequency:329.63,type:"sine",duration:300,category:"musical"},{id:"f4",name:"F Note",frequency:349.23,type:"sine",duration:300,category:"musical"},{id:"g4",name:"G Note",frequency:392,type:"sine",duration:300,category:"musical"},{id:"ascending",name:"Ascending",frequency:261.63,type:"triangle",duration:800,category:"musical",frequencies:[261.63,293.66,329.63,349.23]},{id:"descending",name:"Descending",frequency:523.25,type:"triangle",duration:800,category:"musical",frequencies:[523.25,466.16,415.3,369.99]},{id:"chord",name:"Major Chord",frequency:261.63,type:"sine",duration:600,category:"musical",frequencies:[261.63,329.63,392]},{id:"arpeggio",name:"Arpeggio",frequency:261.63,type:"triangle",duration:1e3,category:"musical",frequencies:[261.63,329.63,392,523.25]}],Ie=[{id:"bell",name:"Bell",frequency:800,type:"sine",duration:200,category:"notification"},{id:"ding",name:"Ding",frequency:1200,type:"square",duration:150,category:"notification"},{id:"chirp",name:"Chirp",frequency:1500,type:"sine",duration:80,category:"notification"},{id:"beep",name:"Beep",frequency:600,type:"sine",duration:100,category:"notification"},{id:"tick",name:"Tick",frequency:2e3,type:"square",duration:50,category:"notification"},{id:"ping",name:"Ping",frequency:1800,type:"triangle",duration:120,category:"notification"},{id:"bubble",name:"Bubble",frequency:800,type:"sine",duration:200,category:"notification",frequencies:[800,1200]},{id:"pop",name:"Pop",frequency:1e3,type:"square",duration:80,category:"notification"}],qe=[{id:"buzz",name:"Buzz",frequency:400,type:"sawtooth",duration:250,category:"game"},{id:"whoosh",name:"Whoosh",frequency:200,type:"sawtooth",duration:500,category:"game",frequencies:[200,150,100]},{id:"bloop",name:"Bloop",frequency:300,type:"sine",duration:400,category:"game",frequencies:[300,400,350]},{id:"zap",name:"Zap",frequency:1500,type:"square",duration:120,category:"game",frequencies:[1500,1e3,500]},{id:"bounce",name:"Bounce",frequency:500,type:"triangle",duration:300,category:"game",frequencies:[500,700,600,800]},{id:"powerup",name:"Power Up",frequency:440,type:"square",duration:600,category:"game",frequencies:[440,523,659,784]},{id:"coin",name:"Coin",frequency:1046,type:"square",duration:300,category:"game",frequencies:[1046,1318]},{id:"fanfare",name:"Fanfare",frequency:523,type:"triangle",duration:1200,category:"game",frequencies:[523,659,784,1046]}],Cn=[{id:"classic",name:"Classic System Alerts",sounds:Te},{id:"musical",name:"Musical Notes & Melodies",sounds:Ae},{id:"notification",name:"Notification Alerts",sounds:Ie},{id:"game",name:"Game & Action Sounds",sounds:qe}],ue=[...Te,...Ae,...Ie,...qe];async function Pn(n){try{if(!n||!n.frequency||!n.type||!n.duration)return!1;const t=window.AudioContext||window.webkitAudioContext;if(!t)return!1;const s=new t;if(n.frequencies&&n.frequencies.length>1)return wn(s,n);const r=s.createOscillator(),o=s.createGain();return r.connect(o),o.connect(s.destination),r.frequency.value=n.frequency,r.type=n.type,o.gain.setValueAtTime?(o.gain.setValueAtTime(.3,s.currentTime),o.gain.exponentialRampToValueAtTime(.01,s.currentTime+n.duration/1e3)):o.gain.value=.3,r.start(),r.stop(s.currentTime+n.duration/1e3),setTimeout(()=>{s.close()},n.duration+100),!0}catch(t){return console.warn("Sound playback failed:",t),!1}}async function wn(n,t){try{const s=t.frequencies,r=t.duration/s.length,o=n.createGain();return o.connect(n.destination),o.gain.setValueAtTime?o.gain.setValueAtTime(.3,n.currentTime):o.gain.value=.3,s.forEach((a,l)=>{const i=n.createOscillator(),c=n.createGain();i.connect(c),c.connect(o),i.frequency.value=a,i.type=t.type;const u=n.currentTime+l*r/1e3,h=u+r/1e3;c.gain.setValueAtTime?(c.gain.setValueAtTime(1,u),c.gain.exponentialRampToValueAtTime(.01,h)):c.gain.value=1,i.start(u),i.stop(h)}),setTimeout(()=>{n.close()},t.duration+100),!0}catch(s){return console.warn("Melody playback failed:",s),!1}}function ee(){return ue[Math.floor(Math.random()*ue.length)]}function kn(n){return n&&ue.find(t=>t.id===n)||null}const Tn=We(Y)(`
  &:last-child {
    padding-bottom: 8px;
  }
`);function An({player:n,index:t,isActive:s,canEdit:r=!0,canDelete:o=!0,onEdit:a,onDelete:l,onRoleChange:i}){const{t:c}=L(),[u,h]=d.useState(null),[y,j]=d.useState(null),S=P=>{h(P.currentTarget)},p=()=>{h(null)},v=P=>{P.stopPropagation(),j(P.currentTarget)},C=()=>{j(null)},f=()=>{p(),a?.(n)},k=()=>{p(),l?.(n.id)},w=P=>{C(),i?.(n.id,P)},T=P=>P.split(" ").map(A=>A.charAt(0)).join("").toUpperCase().slice(0,2)||"P",b=P=>{switch(P){case"dom":return"primary";case"sub":return"secondary";case"vers":return"default";default:return"default"}};return e.jsxs(_,{sx:{border:s?"2px solid":"1px solid",borderColor:s?"primary.main":"divider",bgcolor:s?"action.selected":"background.paper",transition:"all 0.2s ease-in-out","&:hover":{borderColor:"primary.main",elevation:2}},children:[e.jsx(Tn,{children:e.jsxs(x,{sx:{display:"flex",alignItems:"flex-start",gap:2},children:[e.jsx(ve,{sx:{bgcolor:s?"primary.main":"grey.500",marginTop:.5,width:24,height:24,fontWeight:"bold"},children:T(n.name)}),e.jsx(x,{sx:{flexGrow:1,minWidth:0},children:e.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[e.jsx(g,{variant:"h6",component:"h3",sx:{fontWeight:s?600:500,color:s?"primary.main":"text.primary",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",flexGrow:1},children:n.name||c("localPlayers.defaultPlayerName",{number:t+1})}),e.jsx(B,{label:c(`roles.${n.role}`),size:"small",variant:"outlined",color:b(n.role),onClick:r?v:void 0,sx:{cursor:r?"pointer":"default","&:hover":r?{bgcolor:"action.hover"}:{}}}),s&&e.jsx(B,{label:c("localPlayers.currentPlayer"),size:"small",color:"primary",icon:e.jsx(tn,{})})]})}),(r||o)&&e.jsx(ae,{size:"small",onClick:S,"aria-label":c("localPlayers.playerActions",{name:n.name}),children:e.jsx(an,{})})]})}),e.jsxs(ye,{anchorEl:u,open:!!u,onClose:p,transformOrigin:{horizontal:"right",vertical:"top"},anchorOrigin:{horizontal:"right",vertical:"bottom"},children:[r&&e.jsxs(q,{onClick:f,children:[e.jsx(pe,{children:e.jsx(Ce,{fontSize:"small"})}),e.jsx(de,{children:c("localPlayers.editPlayer")})]}),o&&e.jsxs(q,{onClick:k,sx:{color:"error.main"},children:[e.jsx(pe,{children:e.jsx(rn,{fontSize:"small",sx:{color:"error.main"}})}),e.jsx(de,{children:c("localPlayers.deletePlayer")})]})]}),e.jsx(ye,{anchorEl:y,open:!!y,onClose:C,transformOrigin:{horizontal:"left",vertical:"top"},anchorOrigin:{horizontal:"left",vertical:"bottom"},children:["dom","sub","vers"].map(P=>e.jsx(q,{onClick:()=>w(P),selected:n.role===P,children:e.jsx(B,{label:c(`roles.${P}`),size:"small",variant:n.role===P?"filled":"outlined",color:b(P)})},P))})]})}function In({selectedSoundId:n,onSoundChange:t,label:s="Turn Sound"}){const r=async()=>{if(!n)return;const a=kn(n);if(a)try{await Pn(a)||console.error("Failed to play sound")}catch(l){console.error("Failed to play sound:",l)}},o=a=>{t(a.target.value)};return e.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:1,py:1},children:[e.jsxs(M,{fullWidth:!0,size:"small",children:[e.jsx(N,{id:"sound-select-label",children:s}),e.jsxs(O,{labelId:"sound-select-label",value:n||"",label:s,onChange:o,children:[e.jsx(q,{value:"",children:e.jsxs(x,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(ln,{fontSize:"small"}),"No sound"]})}),Cn.map(a=>[e.jsx(Ue,{sx:{fontWeight:"bold"},children:a.name},`header-${a.id}`),...a.sounds.map(l=>e.jsx(q,{value:l.id,sx:{pl:3},children:l.name},l.id))])]})]}),e.jsx($,{title:"Play sample",children:e.jsx(ae,{onClick:r,color:"primary",disabled:!n,size:"small",children:e.jsx(me,{})})})]})}function qn({open:n,player:t,existingPlayers:s,onSubmit:r,onCancel:o}){const{t:a}=L(),[l,i]=d.useState({name:"",role:"vers",sound:ee().id}),[c,u]=d.useState({}),[h,y]=d.useState(!1);d.useEffect(()=>{i(t?{name:t.name,role:t.role,sound:t.sound||ee().id}:{name:"",role:"vers",sound:ee().id}),u({})},[t,n]);const j=d.useCallback(()=>{const b={},P=l.name.trim();return P?P.length<2?b.name=a("localPlayers.form.errors.nameTooShort"):P.length>20?b.name=a("localPlayers.form.errors.nameTooLong"):s.some(K=>K.id!==t?.id&&K.name.toLowerCase()===P.toLowerCase())&&(b.name=a("localPlayers.form.errors.nameDuplicate")):b.name=a("localPlayers.form.errors.nameRequired"),(!l.role||!["dom","sub","vers"].includes(l.role))&&(b.role=a("localPlayers.form.errors.roleRequired")),u(b),Object.keys(b).length===0},[l,s,t,a]),S=d.useCallback(b=>{const P=b.target.value;i(A=>({...A,name:P})),c.name&&u(A=>({...A,name:void 0}))},[c.name]),p=d.useCallback(b=>{const P=b.target.value;i(A=>({...A,role:P})),c.role&&u(A=>({...A,role:void 0}))},[c.role]),v=d.useCallback(b=>{i(P=>({...P,sound:b}))},[]),C=d.useCallback(async()=>{if(j()){y(!0);try{const b={name:l.name.trim(),role:l.role,sound:l.sound};await r(b)}catch(b){console.error("Error submitting player form:",b)}finally{y(!1)}}},[l,j,r]),f=d.useCallback(()=>{i({name:"",role:"vers",sound:ee().id}),u({}),o()},[o]),k=d.useCallback(b=>b.split(" ").map(P=>P.charAt(0)).join("").toUpperCase().slice(0,2)||"P",[]),w=b=>{switch(b){case"dom":return"primary";case"sub":return"secondary";case"vers":return"default";default:return"default"}},T=!!t;return e.jsxs(Fe,{open:n,onClose:f,maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{borderRadius:2}},children:[e.jsx($e,{children:a(T?"localPlayers.form.editPlayerTitle":"localPlayers.form.addPlayerTitle")}),e.jsxs(Ge,{children:[e.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:2,mb:3,p:2,bgcolor:"action.hover",borderRadius:1},children:[e.jsx(ve,{sx:{bgcolor:"primary.main",width:56,height:56,fontSize:"1.5rem",fontWeight:"bold"},children:k(l.name||"P")}),e.jsxs(x,{sx:{direction:"row"},children:[e.jsx(g,{variant:"h6",children:l.name||a("localPlayers.form.previewName")}),e.jsx(x,{sx:{display:"flex",alignItems:"center",gap:1,mt:.5},children:e.jsx(B,{label:a(`roles.${l.role}`),size:"small",color:w(l.role),variant:"outlined"})})]})]}),e.jsxs(x,{sx:{display:"flex",flexDirection:"column",gap:3},children:[e.jsx(re,{label:a("localPlayers.form.nameLabel"),value:l.name,onChange:S,error:!!c.name,helperText:c.name||a("localPlayers.form.nameHelper"),placeholder:a("localPlayers.form.namePlaceholder"),fullWidth:!0,autoFocus:!T,inputProps:{maxLength:20}}),e.jsxs(M,{fullWidth:!0,error:!!c.role,children:[e.jsx(N,{children:a("localPlayers.form.roleLabel")}),e.jsxs(O,{value:l.role,onChange:p,label:a("localPlayers.form.roleLabel"),children:[e.jsx(q,{value:"dom",children:e.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(B,{label:a("roles.dom"),size:"small",color:"primary",variant:"outlined"}),e.jsx(g,{variant:"body2",color:"text.secondary",children:a("localPlayers.form.roleDescriptions.dom")})]})}),e.jsx(q,{value:"sub",children:e.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(B,{label:a("roles.sub"),size:"small",color:"secondary",variant:"outlined"}),e.jsx(g,{variant:"body2",color:"text.secondary",children:a("localPlayers.form.roleDescriptions.sub")})]})}),e.jsx(q,{value:"vers",children:e.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(B,{label:a("roles.vers"),size:"small",color:"default",variant:"outlined"}),e.jsx(g,{variant:"body2",color:"text.secondary",children:a("localPlayers.form.roleDescriptions.vers")})]})})]}),c.role&&e.jsx(g,{variant:"caption",color:"error",sx:{mt:1,ml:1.5},children:c.role})]}),e.jsx(In,{selectedSoundId:l.sound,onSoundChange:v,label:a("localPlayers.form.soundLabel","Turn Sound")}),e.jsx(Z,{severity:"info",sx:{mt:1},children:e.jsx(g,{variant:"body2",children:a("localPlayers.form.helpText")})})]})]}),e.jsxs(_e,{sx:{p:3,pt:1},children:[e.jsx(V,{onClick:f,disabled:h,children:a("cancel")}),e.jsx(V,{onClick:C,variant:"contained",disabled:h||!l.name.trim(),children:a(h?"localPlayers.form.saving":T?"localPlayers.form.saveChanges":"localPlayers.form.addPlayer")})]})]})}function Ln({roomId:n,isPrivateRoom:t,onComplete:s,onCancel:r,initialPlayers:o=[],initialSettings:a}){const{t:l}=L();console.debug("Setting up local players for room:",n);const[i,c]=d.useState(o),[u,h]=d.useState(!1),[y,j]=d.useState(null),[S,p]=d.useState(!1),[v,C]=d.useState(!1),[f,k]=d.useState(null),[w]=d.useState(a||{showTurnTransitions:!0,enableTurnSounds:!0,showPlayerAvatars:!0}),T=d.useCallback(()=>{const I=i.length>=2&&i.length<=4,R=i.every(J=>J.name.trim().length>0),G=new Set(i.map(J=>J.name.toLowerCase())).size===i.length,E=I&&R&&G;return h(E),i.length<2?j(l("localPlayers.errors.minimumPlayers")):i.length>4?j(l("localPlayers.errors.maximumPlayers")):j(R?G?null:l("localPlayers.errors.duplicateNames"):l("localPlayers.errors.emptyNames")),E},[i,l]);d.useEffect(()=>{o.length>0&&c(o)},[]),d.useEffect(()=>{T()},[T]);const b=d.useCallback(()=>`local_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,[]),P=d.useCallback(()=>l("localPlayers.defaultPlayerName",{number:i.length+1}),[i.length,l]),A=d.useCallback(()=>{i.length>=4||(k(null),C(!0))},[i.length]),K=d.useCallback(I=>{c(R=>R.filter(E=>E.id!==I).map((E,J)=>({...E,order:J,isActive:J===0})))},[]),H=d.useCallback((I,R)=>{c(G=>G.map(E=>E.id===I?{...E,...R}:E))},[]),D=d.useCallback((I,R)=>{H(I,{role:R})},[H]),ze=d.useCallback(I=>{k(I),C(!0)},[]),Ve=d.useCallback(async I=>{if(f)H(f.id,I);else{const R={id:b(),name:I.name||P(),role:I.role||"vers",order:i.length,isActive:i.length===0,deviceId:"current_device",location:0,isFinished:!1,sound:I.sound};c(G=>[...G,R])}C(!1),k(null)},[f,H,b,P,i.length]),Ee=d.useCallback(()=>{C(!1),k(null)},[]),Be=d.useCallback(async()=>{if(T()){p(!0),j(null);try{await s(i,w)}catch(I){j(I instanceof Error?I.message:l("localPlayers.errors.sessionCreation"))}finally{p(!1)}}},[i,w,T,s,l]),Me=d.useCallback(()=>{r()},[r]);return t?e.jsxs(_,{children:[e.jsx(Ye,{title:e.jsx(g,{variant:"h5",component:"h2",children:e.jsx(m,{i18nKey:"localPlayers.setupTitle"})}),subheader:e.jsx(g,{variant:"body2",color:"text.secondary",children:e.jsx(m,{i18nKey:"localPlayers.setupSubtitle"})})}),e.jsxs(Y,{children:[y&&e.jsx(Z,{severity:"error",sx:{mb:2},children:y}),e.jsxs(x,{sx:{mb:3},children:[e.jsxs(x,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsx(g,{variant:"h6",children:e.jsx(m,{i18nKey:"localPlayers.playersTitle"})}),e.jsx(g,{variant:"body2",color:"text.secondary",children:l("localPlayers.playersCount",{count:i.length})})]}),i.length===0?e.jsxs(x,{sx:{textAlign:"center",py:4,border:"2px dashed",borderColor:"divider",borderRadius:1,bgcolor:"action.hover"},children:[e.jsx(g,{variant:"body1",color:"text.secondary",gutterBottom:!0,children:e.jsx(m,{i18nKey:"localPlayers.noPlayersYet"})}),e.jsx(V,{variant:"contained",startIcon:e.jsx(je,{}),onClick:A,children:e.jsx(m,{i18nKey:"localPlayers.addFirstPlayer"})})]}):e.jsxs(e.Fragment,{children:[e.jsx(x,{sx:{display:"flex",flexDirection:"column",gap:2},children:i.map((I,R)=>e.jsx(An,{player:I,index:R,isActive:I.isActive,canEdit:!0,canDelete:i.length>1,onEdit:ze,onDelete:K,onRoleChange:D},I.id))}),i.length<4&&e.jsx(x,{sx:{display:"flex",justifyContent:"center",mt:2},children:e.jsx(He,{size:"small",color:"primary",onClick:A,"aria-label":"Add player",children:e.jsx(je,{})})})]})]}),e.jsxs(x,{sx:{display:"flex",gap:2,justifyContent:"flex-end"},children:[e.jsx(V,{variant:"outlined",onClick:Me,disabled:S,children:e.jsx(m,{i18nKey:"cancel"})}),e.jsx(V,{variant:"contained",onClick:Be,disabled:!u||S,children:S?e.jsx(m,{i18nKey:"localPlayers.creatingSession"}):e.jsx(m,{i18nKey:"localPlayers.startSession"})})]})]}),e.jsx(qn,{open:v,player:f,existingPlayers:i,onSubmit:Ve,onCancel:Ee})]}):e.jsx(_,{children:e.jsx(Y,{children:e.jsx(Z,{severity:"warning",children:e.jsx(g,{children:e.jsx(m,{i18nKey:"localPlayers.privateRoomRequired"})})})})})}function Rn({actionName:n,actionLabel:t,selectedLevels:s,availableLevels:r,intensityNames:o={},onChange:a,disabled:l=!1,showValueGlow:i=!1}){const{t:c}=L(),u=Se(),h=`${n}-intensity-label`,y=i&&s.length>0,j=y?{boxShadow:`0 0 8px ${u.palette.primary.main}`}:{},S=y?{backgroundColor:"var(--color-surface)",borderRadius:"8px",padding:"0 8px"}:{},p=f=>{const w=f.target.value.filter(T=>!isNaN(T)).sort((T,b)=>T-b);a(w)},v=f=>{f.stopPropagation(),a([])},C=f=>f.length===0?c("none"):f.map(k=>o[k]||`${c("level")} ${k}`).join(", ");return r.length===0?e.jsx(e.Fragment,{}):e.jsxs(M,{margin:"normal",fullWidth:!0,disabled:l,children:[e.jsx(N,{id:h,sx:S,children:t}),e.jsx(O,{labelId:h,id:n,label:t,multiple:!0,value:s,onChange:p,renderValue:C,sx:j,endAdornment:s.length>0&&e.jsx(ae,{size:"small",onClick:v,sx:{position:"absolute",right:24,top:"50%",transform:"translateY(-50%)",zIndex:1,"&:hover":{backgroundColor:"rgba(0, 0, 0, 0.04)"}},children:e.jsx(Pe,{fontSize:"small"})}),children:r.map(f=>e.jsxs(q,{value:f,children:[e.jsx(Je,{checked:s.includes(f)}),e.jsx(de,{primary:o[f]||`${c("level")} ${f}`})]},f))})]})}function Kn({trueCondition:n,onChange:t,yesLabel:s,noLabel:r=null,sx:o={}}){const a=r??s;return e.jsx(x,{sx:{display:"flex",justifyContent:"center",my:1,...o},children:e.jsx(ne,{control:e.jsx(X,{checked:n||!1,onChange:t}),label:he(n?s:a)})})}function Le({formData:n,setFormData:t,backgrounds:s,isRoom:r=!1}){const{t:o}=L(),a=r?"roomBackground":"background",l=r?"roomBackgroundURL":"backgroundURL",c=r?"useAppBackground":"color",u=n?.[a]||c,[h,y]=d.useState(u);d.useEffect(()=>{n?.[a]||t({...n,[a]:c})},[n,a,c,t]);const j=()=>Object.entries(s).map(([v,C])=>e.jsx(q,{value:v,children:C},v)),S=v=>{t({...n,[a]:v.target.value}),y(v.target.value)};d.useEffect(()=>{h!==u&&y(u)},[h,u]);const p=v=>{const C={...n,[a]:"custom",[l]:v.target.value};r&&(C.roomUpdated=!0),t(C)};return e.jsxs(e.Fragment,{children:[e.jsxs(M,{fullWidth:!0,margin:"normal",children:[e.jsx(N,{id:"background-label",children:o("background")}),e.jsx(O,{labelId:"background-label",id:"background",label:o("background"),value:h,onChange:S,children:j()})]}),h==="custom"&&e.jsx(re,{sx:{mt:2},label:o("url"),value:n?.[l]||"",fullWidth:!0,onChange:p,helperText:e.jsxs(e.Fragment,{children:[o("supportedSites"),e.jsx("br",{}),o("requiresEmbeddedUrl")]})})]})}class zn{constructor(){ge(this,"voiceLoadPromise")}async waitForVoices(){return this.voiceLoadPromise?this.voiceLoadPromise:(this.voiceLoadPromise=new Promise(t=>{let s=window.speechSynthesis.getVoices();if(s.length>0){t(s);return}const r=()=>{s=window.speechSynthesis.getVoices(),s.length>0&&(window.speechSynthesis.removeEventListener("voiceschanged",r),t(s))};window.speechSynthesis.addEventListener("voiceschanged",r),setTimeout(()=>{window.speechSynthesis.removeEventListener("voiceschanged",r),t(window.speechSynthesis.getVoices())},3e3)}),this.voiceLoadPromise)}async getAvailableVoicesAsync(){return(await this.waitForVoices()).map(s=>({name:s.name,displayName:`${s.name} (${s.lang})`}))}async getPreferredVoiceAsync(){const t=await this.getAvailableVoicesAsync();return t.length>0?t[0].name:null}async speak(t,s,r=0){return new Promise((o,a)=>{if(!("speechSynthesis"in window)){a(new Error("Speech synthesis not supported"));return}const l=new SpeechSynthesisUtterance(t);if(l.pitch=r,s){const c=window.speechSynthesis.getVoices().find(u=>u.name===s);c&&(l.voice=c)}l.onend=()=>o(),l.onerror=i=>a(new Error(`Speech failed: ${i.error}`)),window.speechSynthesis.speak(l)})}stop(){window.speechSynthesis?.speaking&&window.speechSynthesis.cancel()}isAvailable(){return"speechSynthesis"in window}}const te=new zn,Vn=()=>{const[n,t]=d.useState(!1),[s,r]=d.useState(!1),[o,a]=d.useState(null),l=d.useCallback(()=>{te.stop(),t(!1),r(!1)},[]),i=d.useCallback(async(c,u={})=>{try{r(!0),a(null),l(),t(!0),await te.speak(c,u.voice,u.pitch),r(!1),t(!1)}catch(h){const y=h instanceof Error?h.message:"TTS failed";a(y),t(!1),r(!1),console.error("TTS Error:",h)}},[l]);return d.useEffect(()=>()=>{l()},[l]),{speak:i,stop:l,isPlaying:n,error:o,isLoading:s}};function En({formData:n,setFormData:t,onVoiceChange:s}){const{t:r}=L(),[o,a]=d.useState([]),[l,i]=d.useState(!0),{speak:c}=Vn(),u=n.voicePreference||"",h=d.useCallback(p=>{const v={...n,voicePreference:p};t(v),s?.(p)},[n,t,s]);d.useEffect(()=>{let p=!0;return(async()=>{try{if(p){i(!0);const C=await te.getAvailableVoicesAsync();if(p){if(a(C),!u&&C.length>0){const f=await te.getPreferredVoiceAsync();f&&p&&h(f)}i(!1)}}}catch(C){console.error("Failed to load voices:",C),p&&i(!1)}})(),()=>{p=!1}},[u,h]);const y=p=>{h(p.target.value)},j=async()=>{const p=u||(o.length>0?o[0].name:"");if(!p)return;const v=r("tts.sampleText","Take a drink and enjoy the game.");try{await c(v,{voice:p,pitch:-2})}catch(C){console.error("Failed to play sample:",C)}},S=p=>p.displayName;return l?e.jsx(x,{sx:{py:1},children:e.jsx(g,{variant:"body2",color:"text.secondary",children:r("loadingVoices","Loading voices...")})}):o.length===0?e.jsx(x,{sx:{py:1},children:e.jsx(g,{variant:"body2",color:"text.secondary",children:r("noVoicesAvailable","No voices available for this language")})}):e.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:1,py:1},children:[e.jsxs(M,{fullWidth:!0,size:"small",children:[e.jsx(N,{id:"voice-select-label",children:r("voiceSelection","Voice")}),e.jsx(O,{labelId:"voice-select-label",value:u,label:r("voiceSelection","Voice"),onChange:y,children:o.map(p=>e.jsx(q,{value:p.name,children:S(p)},p.name))})]}),e.jsx($,{title:r("playSample","Play sample"),children:e.jsx(ae,{onClick:j,color:"primary",disabled:!u,size:"small",children:e.jsx(me,{})})})]})}function Bn({boardUpdated:n}){const{i18n:t}=L(),[s,r]=d.useState(t.resolvedLanguage||"en"),[o,a]=d.useState(!1);async function l(c){a(!0),r(c);try{await t.changeLanguage(c),n()}catch(u){console.error("Error changing language:",u),await t.changeLanguage(c),n()}finally{a(!1)}}const i=Object.entries(xn).map(([c,u])=>e.jsx(q,{value:c,children:u.label},c));return e.jsx(x,{sx:{minWidth:120,mt:1,mb:2},children:e.jsxs(M,{fullWidth:!0,children:[e.jsxs(N,{id:"language-label",sx:{display:"flex",alignItems:"center"},children:[e.jsx(fe,{sx:{mr:1}}),e.jsx(m,{i18nKey:"language"})]}),e.jsx(O,{labelId:"language-label",id:"language-select",value:s,disabled:o,label:e.jsxs(e.Fragment,{children:[e.jsx(fe,{}),e.jsx(m,{i18nKey:"language"})]}),onChange:c=>l(c.target.value),endAdornment:o&&e.jsx(Qe,{size:20}),MenuProps:{disableScrollLock:!0,BackdropProps:{invisible:!0},PaperProps:{style:{backdropFilter:"none",WebkitBackdropFilter:"none"}}},children:i})]})})}function U({field:n,formData:t,handleSwitch:s}){return e.jsx(Kn,{trueCondition:t[n],onChange:r=>s(r,n),yesLabel:n,sx:{justifyContent:"left"}})}function Mn({formData:n,setFormData:t,boardUpdated:s}){const[r,o]=ke(),{t:a}=L(),l={useRoomBackground:a("useRoomBackground"),color:a("color"),gray:a("gray"),"metronome.gif":a("hypnoDick"),"pink-spiral.gif":a("pinkSpiral"),custom:a("customURL")};function i(u,h){t({...n,[h]:u.target.checked}),o({...r,[h]:u.target.checked})}function c(u){o({...r,voicePreference:u})}return e.jsxs(e.Fragment,{children:[e.jsx(Bn,{boardUpdated:s}),e.jsx(g,{variant:"h5",children:e.jsx(m,{i18nKey:"dialog"})}),e.jsx(U,{field:"playerDialog",formData:n,handleSwitch:i}),e.jsx(U,{field:"othersDialog",formData:n,handleSwitch:i}),e.jsx(Q,{}),e.jsx(g,{variant:"h5",sx:{mt:2},children:e.jsx(m,{i18nKey:"sounds"})}),e.jsx(U,{field:"mySound",formData:n,handleSwitch:i}),e.jsx(U,{field:"otherSound",formData:n,handleSwitch:i}),e.jsx(U,{field:"chatSound",formData:n,handleSwitch:i}),e.jsx(U,{field:"readRoll",formData:n,handleSwitch:i}),n.readRoll&&e.jsx(En,{formData:n,setFormData:t,onVoiceChange:c}),e.jsx(Q,{}),e.jsx(g,{variant:"h5",sx:{mt:2,textTransform:"capitalize"},children:e.jsx(m,{i18nKey:"misc"})}),e.jsx(U,{field:"hideBoardActions",formData:n,handleSwitch:i}),e.jsx(U,{field:"advancedSettings",formData:n,handleSwitch:i}),e.jsx(Le,{formData:n,setFormData:t,backgrounds:l}),e.jsx(Q,{})]})}function Nn({formData:n,setFormData:t}){const s=(o,a)=>{t({...n,finishRange:a,boardUpdated:!0})},r=n?.finishRange||[30,70];return e.jsxs(x,{children:[e.jsx(Q,{}),e.jsx(g,{id:"finish-slider",sx:{my:1},children:e.jsx(m,{i18nKey:"finishSlider"})}),e.jsx(Ze,{"aria-labelledby":"finish-slider",value:r,onChange:s,valueLabelDisplay:"off"}),e.jsxs(x,{display:"flex",flexDirection:"column",justifyContent:"space-between",textAlign:"center",children:[e.jsxs(g,{whiteSpace:"nowrap",children:[e.jsx(m,{i18nKey:"noCum"})," ",r[0],"%"]}),e.jsxs(g,{whiteSpace:"nowrap",children:[e.jsx(m,{i18nKey:"ruined"})," ",r[1]-r[0],"%"]}),e.jsxs(g,{whiteSpace:"nowrap",children:[e.jsx(m,{i18nKey:"cum"})," ",100-r[1],"%"]})]}),e.jsx(Q,{sx:{my:1}})]})}function be({children:n}){return e.jsx(z,{size:{xs:12,md:5},children:n})}function oe({children:n,title:t,subtitle:s,defaultExpanded:r=!1,hasSelectedOptions:o=!1,...a}){const l=Se();return e.jsxs(Xe,{defaultExpanded:r,...a,sx:{backgroundColor:"inherit",backgroundImage:"none",boxShadow:"none"},children:[e.jsx(De,{expandIcon:e.jsx(on,{}),sx:{px:0},children:e.jsxs(x,{sx:{display:"flex",alignItems:"center",width:"100%"},children:[e.jsxs(g,{variant:"h6",sx:{display:"flex",alignItems:"center",gap:1,minWidth:"fit-content"},children:[t,":",o&&e.jsx(x,{sx:{width:8,height:8,borderRadius:"50%",backgroundColor:l.palette.primary.main,flexShrink:0}})]}),e.jsx(g,{sx:{pt:.5,ml:2,flex:1},children:s})]})}),e.jsx(en,{sx:{px:0},children:e.jsx(z,{container:!0,columnSpacing:2,justifyContent:"space-evenly",className:"columned-grid",children:n})})]})}const Re=d.forwardRef(({value:n,onChange:t,label:s,options:r,defaultValue:o=null,sx:a,helpIcon:l=!1,fullWidth:i=!0,...c},u)=>{const h=d.useMemo(()=>r.map(y=>typeof y=="string"?e.jsx(q,{value:y,children:he(y)},y):e.jsx(q,{value:y.value,children:y.label},y.value)),[r]);return e.jsxs(M,{fullWidth:i,margin:"normal",sx:a,...c,ref:u,children:[e.jsxs(N,{id:`${s}Label`,children:[e.jsx(m,{i18nKey:s}),!!l&&e.jsx(W,{sx:{ml:1,fontSize:16}})]}),e.jsx(O,{labelId:`${s}Label`,id:s,label:e.jsxs(e.Fragment,{children:[e.jsx(m,{i18nKey:s}),!!l&&e.jsx(W,{sx:{ml:1,fontSize:16}})]}),value:n||o||"",onChange:t,children:h})]})});function On({option:n,settings:t,setSettings:s,actionsFolder:r,type:o,showVariation:a=!1,showRole:l=!1}){const{t:i}=L(),c=`${n}label`,u=r[n]?.label;function h(v,C,f){const k=t.selectedActions?.[C];s({...t,selectedActions:{...t.selectedActions,[C]:{...k,type:o,levels:k?.levels??[],[f]:v?.target?.value}},boardUpdated:!0})}function y(v,C){const f=t.selectedActions?.[C];s({...t,selectedActions:{...t.selectedActions,[C]:{...f,type:o,levels:v}},boardUpdated:!0})}let j=12;(a||l)&&(j=6);let S=["dom","vers","sub"];r[n]?.dom&&(S=[{label:r[n].dom,value:"dom"},{label:i("vers"),value:"vers"},{label:r[n].sub,value:"sub"}]);const p=()=>{const v=r[n],C=v?.intensities?Object.keys(v.intensities).map(Number).filter(k=>k>0).sort((k,w)=>k-w):[1,2,3,4],f=t.selectedActions?.[n]?.levels||[];return e.jsx(Rn,{actionName:n,actionLabel:v?.label||n,selectedLevels:f,availableLevels:C,intensityNames:v?.intensities||{},onChange:k=>y(k,n),showValueGlow:!0})};return e.jsxs(z,{container:!0,justifyContent:"center",children:[e.jsx(z,{size:j,children:p()}),!!l&&e.jsx(z,{size:6,children:e.jsx(Re,{sx:{ml:1},value:t.selectedActions?.[n]?.role,onChange:v=>h(v,n,"role"),label:`${i("role")}: ${u}`,options:S,defaultValue:t.role||"sub"})}),!!a&&e.jsx(z,{size:6,children:e.jsx($,{placement:"top",title:e.jsxs(m,{i18nKey:"variationTooltip",children:[e.jsx(g,{variant:"subtitle2",children:"Standalone = Its own tile. "}),e.jsx(g,{variant:"subtitle2",children:"Append Some = 50% chance."}),e.jsx(g,{variant:"subtitle2",children:"Append Most = 90% chance."})]}),arrow:!0,children:e.jsxs(M,{fullWidth:!0,margin:"normal",sx:{ml:1},children:[e.jsxs(N,{id:`${c}Variation`,children:[`${u} ${i("variation")}`,e.jsx(W,{sx:{ml:1,fontSize:16}})]}),e.jsxs(O,{labelId:`${c}Variation`,id:`${n}Variation`,label:e.jsxs(e.Fragment,{children:[u," ",i("variation"),e.jsx(W,{sx:{ml:1,fontSize:16}})]}),value:t.selectedActions?.[n]?.variation||"standalone",onChange:v=>h(v,n,"variation"),children:[e.jsx(q,{value:"standalone",children:e.jsx(m,{i18nKey:"standalone"})}),e.jsx(q,{value:"appendSome",children:e.jsx(m,{i18nKey:"appendSome"})}),e.jsx(q,{value:"appendMost",children:e.jsx(m,{i18nKey:"appendMost"})})]})]})})})]},n)}function Wn({formData:n,setFormData:t}){return e.jsxs(xe,{direction:"row",spacing:1,alignItems:"center",justifyContent:"center",sx:{mt:1},children:[e.jsx(g,{children:e.jsx(m,{i18nKey:"solo"})}),e.jsx($,{title:e.jsx(g,{variant:"subtitle2",children:e.jsx(m,{i18nKey:"soloTooltip"})}),arrow:!0,children:e.jsx(W,{sx:{fontSize:15}})}),e.jsx(X,{id:"gameMode",checked:!se(n.gameMode),onChange:s=>t({...n,gameMode:s.target.checked?"local":"online",boardUpdated:!0}),inputProps:{"aria-label":"Game Type"}}),e.jsx(g,{children:e.jsx(m,{i18nKey:"local"})}),e.jsx($,{title:e.jsx(g,{variant:"subtitle2",children:e.jsx(m,{i18nKey:"localTooltip"})}),arrow:!0,children:e.jsx(W,{sx:{fontSize:15}})})]})}function Un({formData:n}){const[t,s]=d.useState(!1);return d.useEffect(()=>{const r=Object.values(n).filter(a=>typeof a=="object"&&a?.type==="consumption"&&a?.levels&&a.levels.length>0).length,o=Object.values(n).filter(a=>typeof a=="object"&&a?.levels&&a.levels.length>0).length;s(r>1&&r>=o-r)},[n]),t?e.jsx(Z,{severity:"warning",children:e.jsx(m,{i18nKey:"consumptionWarning"})}):null}function Fn({formData:n,setFormData:t,actionsList:s}){const{t:r}=L(),{hasLocalPlayers:o}=gn(),a=!se(n.gameMode),l=!o();function i(h){return Object.keys(s).filter(y=>s[y]?.type===h).some(y=>{const j=n.selectedActions?.[y];return j?.levels&&j.levels.length>0})}function c(h,y={}){return Object.keys(s).filter(j=>s[j]?.type===h).map(j=>e.jsx(be,{children:e.jsx(On,{option:j,settings:n,setSettings:t,actionsFolder:s,type:h,...y})},j))}const u=h=>{const y=JSON.parse(JSON.stringify(n));return Object.keys(y).forEach(j=>{y.role=h,j.includes("role")&&(y[j]=h)}),y};return e.jsxs(e.Fragment,{children:[e.jsx(Wn,{formData:n,setFormData:t}),F(n?.room)&&!se(n.gameMode)&&e.jsx(z,{container:!0,alignContent:"center",justifyContent:"space-evenly",children:e.jsx(z,{sx:{py:3},children:e.jsx(g,{variant:"h5",children:e.jsx(m,{i18nKey:"privateRequired"})})})}),a?e.jsxs(e.Fragment,{children:[e.jsx(z,{container:!0,columnSpacing:2,justifyContent:"space-evenly",children:l&&e.jsx(be,{children:e.jsx(Re,{value:n.role,onChange:h=>t({...u(h.target.value),boardUpdated:!0}),label:"mainRole",options:["dom","vers","sub"],defaultValue:"sub"})})}),e.jsx(oe,{title:r("consumption"),subtitle:r("consumptionSubtitle"),hasSelectedOptions:i("consumption"),children:c("consumption",{showVariation:!0})}),e.jsx(oe,{title:r("foreplay"),subtitle:r("foreplaySubtitle"),hasSelectedOptions:i("foreplay"),children:c("foreplay",{showRole:l})}),e.jsx(oe,{title:r("sex"),subtitle:r("sexSubtitle"),hasSelectedOptions:i("sex"),children:c("sex",{showRole:l})})]}):e.jsxs(e.Fragment,{children:[e.jsx(z,{container:!0,columnSpacing:2,justifyContent:"space-evenly",children:c("consumption",{showVariation:!0})}),e.jsx(Q,{}),e.jsx(z,{container:!0,columnSpacing:2,justifyContent:"center",children:c("solo")})]}),e.jsx(Nn,{setFormData:t,formData:n}),e.jsx(Un,{formData:n})]})}function $n({formData:n,setFormData:t}){const{t:s}=L(),r={"1d4":2.5,"1d6":3.5,"2d4":5},o=n?.roomTileCount?Math.floor(n.roomTileCount/r[n.roomDice||"1d6"]):16,a=Array.from({length:7},(l,i)=>(i+2)*10).map(l=>e.jsx(q,{value:l,children:l},l));return e.jsxs(x,{children:[e.jsx(g,{variant:"subtitle1",sx:{mb:2,fontWeight:"medium"},children:e.jsx(m,{i18nKey:"gameSpeed"})}),e.jsxs(x,{sx:{display:"flex",gap:2,alignItems:"flex-end",flexWrap:"wrap"},children:[e.jsxs(M,{sx:{minWidth:120,flex:1},children:[e.jsx(N,{id:"diceRole-label",children:e.jsx(m,{i18nKey:"roomDice"})}),e.jsxs(O,{labelId:"diceRole-label",id:"diceRole-select",value:n?.roomDice||"1d4",label:s("roomDice"),onChange:l=>t({...n,roomDice:l.target.value,roomUpdated:!0}),children:[e.jsx(q,{value:"1d4",children:"1d4"}),e.jsx(q,{value:"1d6",children:"1d6"}),e.jsx(q,{value:"2d4",children:"2d4"})]})]}),e.jsxs(M,{sx:{minWidth:120,flex:1},children:[e.jsx(N,{id:"tile-count-label",children:e.jsx(m,{i18nKey:"roomTileCount"})}),e.jsx(O,{labelId:"tile-count-label",id:"tile-count-select",value:String(n?.roomTileCount||40),label:s("roomTileCount"),onChange:l=>t({...n,roomTileCount:Number(l.target.value),roomUpdated:!0}),children:a})]}),e.jsxs(x,{sx:{display:"flex",flexDirection:"column",alignItems:"center",minWidth:120},children:[e.jsx(g,{variant:"body2",color:"text.secondary",sx:{mb:1},children:e.jsx(m,{i18nKey:"averageRolls"})}),e.jsx(B,{label:o,color:"primary",variant:"outlined",sx:{minWidth:50,fontWeight:"bold"}})]})]})]})}function Gn({formData:n,setFormData:t}){const s=d.useCallback(()=>{t({...n,roomRealtime:!n.roomRealtime,roomUpdated:!0})},[n,t]);return e.jsxs(x,{children:[e.jsx(g,{variant:"subtitle1",sx:{mb:2,fontWeight:"medium"},children:e.jsx(m,{i18nKey:"playerListOptions"})}),e.jsx(x,{sx:{display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsxs(xe,{direction:"row",spacing:2,alignItems:"center",children:[e.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(g,{variant:"body2",color:"text.secondary",children:e.jsx(m,{i18nKey:"realtime"})}),e.jsx($,{title:e.jsx(g,{variant:"subtitle2",children:e.jsx(m,{i18nKey:"realtimeTooltip"})}),arrow:!0,children:e.jsx(W,{sx:{fontSize:16,color:"text.secondary"}})})]}),e.jsx(ne,{control:e.jsx(X,{checked:!!n.roomRealtime,onChange:s,inputProps:{"aria-label":he("playerList")}}),label:"",sx:{margin:0}}),e.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(g,{variant:"body2",color:"text.secondary",children:e.jsx(m,{i18nKey:"delayed"})}),e.jsx($,{title:e.jsx(g,{variant:"subtitle2",children:e.jsx(m,{i18nKey:"delayedTooltip"})}),arrow:!0,children:e.jsx(W,{sx:{fontSize:16,color:"text.secondary"}})})]})]})})]})}function _n({formData:n,setFormData:t}){const{id:s}=nn(),{t:r}=L(),o=u=>{let h;u.target.checked&&F(s)?h=fn("123456789ABCDEFGHJKLMNPQRSTUVWXYZ",5)():s&&u.target.checked&&!F(s)?h=s:h="PUBLIC",t({...n,room:h.toUpperCase(),gameMode:F(h)?"online":n.gameMode})},a=d.useCallback(u=>{t({...n,room:u.currentTarget.value,boardUpdated:!0})},[n,t]),l=d.useCallback(u=>{u.key==="Enter"&&t({...n,room:u.currentTarget.value,boardUpdated:!0})},[n,t]),i=d.useCallback(u=>{const h=u.target.value.toUpperCase();u.target.value=h},[]),c=!F(n.room);return e.jsxs(e.Fragment,{children:[e.jsxs(xe,{direction:"row",spacing:1,alignItems:"center",justifyContent:"center",sx:{width:"100%"},children:[e.jsx(g,{children:e.jsx(m,{i18nKey:"public"})}),e.jsx(X,{id:"showPrivate",checked:c,onChange:o,slotProps:{input:{"aria-label":r("room")}}}),e.jsx(g,{children:e.jsx(m,{i18nKey:"private"})}),e.jsx($,{title:e.jsx(g,{variant:"subtitle2",children:e.jsx(m,{i18nKey:"privateOptions"})}),arrow:!0,children:e.jsx(W,{sx:{fontSize:15}})})]}),c&&e.jsx(re,{fullWidth:!0,id:"privateRoom",label:r("privateRoom"),defaultValue:n.room?.toUpperCase(),margin:"normal",onBlur:a,onKeyDown:l,onChange:i,inputProps:{style:{textTransform:"uppercase"}}})]})}function Yn({roomId:n="PRIVATE",isPrivateRoom:t=!0}){const{t:s}=L(),{localPlayers:r,hasLocalPlayers:o,session:a,sessionSettings:l,clearLocalSession:i,updateSettings:c,createLocalSession:u}=yn(),[h,y]=d.useState(!1),[j,S]=d.useState(null),p=d.useCallback(()=>{y(!0),S(null)},[]),v=d.useCallback(()=>{y(!1),S(null)},[]),C=d.useCallback(async(w,T)=>{try{await u(n,w,T),y(!1),S(null)}catch(b){S(b instanceof Error?b.message:"Failed to save local player configuration")}},[n,u]),f=d.useCallback(async()=>{try{await i(),S(null)}catch(w){S(w instanceof Error?w.message:"Failed to clear local session")}},[i]),k=d.useCallback(async(w,T)=>{if(l)try{const b={...l,[w]:T};await c(b),S(null)}catch(b){S(b instanceof Error?b.message:"Failed to update settings")}},[l,c]);return h?e.jsxs(x,{children:[j&&e.jsx(Z,{severity:"error",sx:{mb:2},children:j}),e.jsx(Ln,{roomId:n,isPrivateRoom:t,onComplete:C,onCancel:v,initialPlayers:r,initialSettings:l})]}):e.jsxs(x,{children:[j&&e.jsx(Z,{severity:"error",sx:{mb:2},children:j}),o?e.jsxs(x,{children:[e.jsxs(x,{sx:{mb:3},children:[e.jsx(x,{sx:{display:"flex",flexDirection:"column",gap:1,mb:2},children:r.map(w=>e.jsxs(x,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",p:1,borderRadius:1,bgcolor:w.isActive?"primary.50":"background.default",border:w.isActive?"1px solid":"1px solid transparent",borderColor:w.isActive?"primary.main":"transparent"},children:[e.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsxs(g,{variant:"body2",color:"text.secondary",children:["#",w.order+1]}),e.jsx(g,{variant:"body1",fontWeight:w.isActive?"bold":"normal",children:w.name}),e.jsx(B,{label:s(`roles.${w.role}`),size:"small",variant:"outlined"})]}),w.isActive&&e.jsx(B,{label:s("localPlayerSettings.players.currentTurn"),color:"primary",size:"small"})]},w.id))}),e.jsxs(x,{sx:{display:"flex",gap:1},children:[e.jsx(V,{variant:"outlined",startIcon:e.jsx(Ce,{}),onClick:p,size:"small",children:e.jsx(m,{i18nKey:"localPlayerSettings.session.editButton"})}),e.jsx(V,{variant:"outlined",color:"error",startIcon:e.jsx(Pe,{}),onClick:f,size:"small",children:e.jsx(m,{i18nKey:"localPlayerSettings.session.clearButton"})})]})]}),a?.settings&&e.jsxs(x,{sx:{mt:3,p:2,borderRadius:1,bgcolor:"action.hover"},children:[e.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[e.jsx(cn,{sx:{color:"text.secondary"}}),e.jsx(g,{variant:"subtitle1",component:"h4",children:e.jsx(m,{i18nKey:"localPlayerSettings.settings.title"})})]}),e.jsxs(x,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsx(ne,{control:e.jsx(X,{checked:a.settings.showTurnTransitions,onChange:w=>k("showTurnTransitions",w.target.checked)}),label:s("localPlayerSettings.settings.showTurnTransitions")}),e.jsx(ne,{control:e.jsx(X,{checked:a.settings.enableTurnSounds,onChange:w=>k("enableTurnSounds",w.target.checked)}),label:s("localPlayerSettings.settings.playTurnSounds")})]})]})]}):e.jsxs(x,{sx:{textAlign:"center",py:2},children:[e.jsx(we,{sx:{fontSize:48,color:"text.secondary",mb:2}}),e.jsx(g,{variant:"body1",color:"text.secondary",paragraph:!0,children:e.jsx(m,{i18nKey:"localPlayerSettings.noPlayers.description"})}),e.jsx(V,{variant:"contained",startIcon:e.jsx(me,{}),onClick:p,size:"large",children:e.jsx(m,{i18nKey:"localPlayerSettings.noPlayers.setupButton"})})]})]})}function Hn({formData:n,setFormData:t}){const{t:s}=L(),r={useAppBackground:s("useAppBackground"),color:s("color"),gray:s("gray"),"metronome.gif":s("hypnoDick"),"pink-spiral.gif":s("pinkSpiral"),custom:s("customURL")};return e.jsxs(x,{sx:{p:2},children:[e.jsx(_,{variant:"outlined",sx:{mb:3},children:e.jsxs(Y,{children:[e.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[e.jsx(dn,{sx:{color:"primary.main"}}),e.jsx(g,{variant:"h6",component:"h3",children:s("roomType")})]}),e.jsx(_n,{formData:n,setFormData:t})]})}),!F(n.room)&&e.jsxs(e.Fragment,{children:[e.jsx(_,{variant:"outlined",sx:{mb:3},children:e.jsxs(Y,{children:[e.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[e.jsx(we,{sx:{color:"primary.main"}}),e.jsx(g,{variant:"h6",component:"h3",children:s("localPlayerSettings.title")})]}),e.jsx(Yn,{roomId:n.room,isPrivateRoom:!F(n.room)})]})}),e.jsx(_,{variant:"outlined",sx:{mb:3},children:e.jsxs(Y,{children:[e.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[e.jsx(un,{sx:{color:"primary.main"}}),e.jsx(g,{variant:"h6",component:"h3",children:s("gameConfiguration")})]}),e.jsx(x,{sx:{mb:3},children:e.jsx($n,{formData:n,setFormData:t})}),e.jsx(x,{sx:{p:2,borderRadius:1,bgcolor:"action.hover"},children:e.jsx(Gn,{formData:n,setFormData:t})})]})}),e.jsx(_,{variant:"outlined",sx:{mb:3},children:e.jsxs(Y,{children:[e.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[e.jsx(hn,{sx:{color:"primary.main"}}),e.jsx(g,{variant:"h6",component:"h3",children:s("visualSettings")})]}),e.jsx(Le,{formData:n,setFormData:t,backgrounds:r,isRoom:!0})]})})]})]})}function ce({children:n,value:t,index:s,style:r,...o}){return e.jsx("div",{role:"tabpanel",hidden:t!==s,id:`simple-tabpanel-${s}`,"aria-labelledby":`simple-tab-${s}`,...o,children:t===s&&e.jsx(x,{sx:{p:3,...r},children:n})})}const Ke=({levels:n})=>!!n?.length&&n.some(t=>t>0);function Jn(n){return Object.values(n).some(Ke)}function Qn(n,t){const s=n.selectedActions||{};return Object.entries(s).reduce((r,[o,a])=>{if(o in t){const l=a?.variation?.startsWith("append")?"withAppend":"withoutAppend";r[l][o]=a}return r},{withAppend:{},withoutAppend:{}})}function Zn(n){return Object.keys(n).length>0&&Object.values(n).some(Ke)}function Xn(n,t){const{withAppend:s,withoutAppend:r}=Qn(n,t);return Jn(r)?F(n.room)&&!se(n.gameMode)?"privateRequired":null:Zn(s)?"appendWithAction":"pickSomething"}function Dn({closeDialog:n,initialTab:t=0,onOpenSetupWizard:s}){const{user:r}=mn(),{t:o}=L(),[a,l]=ke(),[i,c]=d.useState(t),[u,h]=d.useState(null),[y,j]=d.useState(!1),[S,p]=pn(),v=vn(),{isLoading:C,actionsList:f}=Sn(S?.gameMode),k=(A,K)=>{c(K)},w=()=>l({...a,boardUpdated:!0}),T=d.useCallback(async A=>{A.preventDefault();const{displayName:K,...H}=S,D=Xn(H,f);return D?(h(o(D)),null):(await v(S,f),typeof n=="function"&&n(),null)},[S,f,o,h,v,n]),b=d.useCallback(A=>{p(K=>({...K,displayName:A.target.value}))},[p]),P=d.useCallback(A=>{A.key==="Enter"&&(p(K=>({...K,displayName:A.target.value})),T(A))},[T,p]);return!S.room||C?e.jsxs(x,{children:[e.jsxs(g,{variant:"h2",children:[e.jsx(m,{i18nKey:"loading"}),"..."]}),e.jsx(g,{variant:"body1",children:e.jsx(m,{i18nKey:"clearStorage"})})]}):e.jsxs(x,{component:"form",method:"post",onSubmit:T,className:"settings-box",children:[e.jsx(re,{fullWidth:!0,id:"displayName",label:o("displayName"),defaultValue:r?.displayName||S.displayName||"",required:!0,autoFocus:!0,onBlur:b,onKeyDown:P,margin:"normal"}),e.jsx(x,{sx:{borderBottom:1,borderColor:"divider"},children:e.jsxs(sn,{value:i,onChange:k,"aria-label":o("gameSettings"),centered:!0,children:[e.jsx(le,{label:o("gameboard"),...ie(0)}),e.jsx(le,{label:o("room"),...ie(1)}),e.jsx(le,{label:o("application"),...ie(2)})]})}),e.jsx(ce,{value:i,index:0,style:{p:0},children:e.jsx(Fn,{formData:S,setFormData:p,actionsList:f})}),e.jsx(ce,{value:i,index:1,style:{p:0,pt:1},children:e.jsx(Hn,{formData:S,setFormData:p})}),e.jsx(ce,{value:i,index:2,style:{p:0,pt:1},children:e.jsx(Mn,{formData:S,setFormData:p,boardUpdated:w})}),e.jsxs("div",{className:"flex-buttons",children:[e.jsxs("div",{className:"left-buttons",children:[s&&e.jsx(V,{variant:"outlined",type:"button",onClick:s,children:e.jsx(m,{i18nKey:"setupWizard"})}),i===0&&e.jsx(V,{variant:"outlined",type:"button",onClick:()=>j(!0),children:e.jsx(m,{i18nKey:"customTilesLabel",children:"Game Tiles"})})]}),e.jsx(V,{variant:"contained",type:"submit",children:e.jsx(m,{i18nKey:"update"})})]}),y&&e.jsx(jn,{open:y,setOpen:j,boardUpdated:w,actionsList:f}),e.jsx(bn,{open:!!u,close:()=>h(null),children:u})]})}const us=Object.freeze(Object.defineProperty({__proto__:null,default:Dn},Symbol.toStringTag,{value:"Module"}));export{Dn as G,Ln as L,Rn as M,ce as T,Kn as Y,kn as g,us as i,Pn as p,te as t};
