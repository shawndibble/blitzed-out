const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["js/userList.tsx-DlUmKFMN.js","js/chunk-CVSdvP5Z.js","js/chunk-CNqt7FHs.js","js/chunk-B-cyqPC2.js","js/chunk-BVO8KFPS.js","js/chunk-_SwOSjSw.js","js/chunk-AkXvan0D.js","js/index.tsx-Udj355hm.js","js/chunk-D8j2avet.js","js/chunk-E8HqAuJ1.js","assets/index-CZH-e7F_.js","js/chunk-BeueL4UK.js","js/chunk-guvQFVv-.js","js/index.tsx-D58wvM67.js","js/index.tsx-B3BtsRTY.js","js/chunk-DixsFoei.js","js/chunk-Pkb0UFv2.js","js/chunk-9Rprt94M.js","js/chunk-DkbZbhmS.js","js/chunk-BO6dzI_Q.js","js/chunk-84IffDWI.js","js/chunk-5m6QozhO.js","js/chunk-DLsc9B5u.js","js/chunk-C9iFBQh5.js","js/chunk-BmM2eEZX.js","js/chunk-U-BuBlCh.js","js/index.tsx-DP4s5rYR.js"])))=>i.map(i=>d[i]);
import{p as C,m as D,_ as c}from"./chunk-B-cyqPC2.js";import{R as T,aj as O,b as u,j as n,ak as R,al as S,am as p,an as I,ao as A,ap as L}from"./chunk-CVSdvP5Z.js";import{A as N}from"./chunk-E8HqAuJ1.js";import{a as $}from"./chunk-CNqt7FHs.js";import{A as g}from"../assets/index-CZH-e7F_.js";(function(){var e=typeof window!="undefined"?window:typeof global!="undefined"?global:typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:{};e.SENTRY_RELEASE={id:"874067a760cfa9079dd7f585e4ceff298b0e879f"}})();try{(function(){var e=typeof window!="undefined"?window:typeof global!="undefined"?global:typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:{},s=new e.Error().stack;s&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[s]="d1d97bf0-dd9e-4972-a7c8-3a631a326a95",e._sentryDebugIdIdentifier="sentry-dbid-d1d97bf0-dd9e-4972-a7c8-3a631a326a95")})()}catch(e){}function y(e){if(!e)return null;try{if(typeof e.toDate=="function")return e.toDate();if(typeof e=="string"){const s=new Date(e);if(isNaN(s.getTime()))throw new Error("Invalid serialized timestamp format");return s}else if(typeof e=="number"){const s=e<3250368e4?e*1e3:e,r=new Date(s);if(isNaN(r.getTime()))throw new Error("Invalid numeric timestamp format");return r}else if(typeof e=="object"&&e.seconds!==void 0){const s=e,r=new Date(s.seconds*1e3+(s.nanoseconds||0)/1e6);if(isNaN(r.getTime()))throw new Error("Invalid Firestore timestamp object format");return r}else{if(e instanceof Date)return e;throw console.warn("Unsupported timestamp format:",typeof e,e),new Error(`Unsupported timestamp format: ${typeof e}`)}}catch(s){return console.warn("Failed to parse timestamp:",s),null}}function m(e){return e.sort((s,r)=>{const t=y(s.timestamp),o=y(r.timestamp);return!t||!o?0:t.getTime()-o.getTime()})}function d(e){return JSON.parse(JSON.stringify(e)).reverse()}function U(e,s){return d(e).find(r=>r.type===s)}function z(e,s,r="ASC"){let t=d(e);return r==="DESC"&&(t=t.reverse()),t.filter(o=>o.type===s)}function ce(e,s){return d(e).find(s)}function B(e){return d(e)[0]}var F=Object.defineProperty,V=Object.defineProperties,H=Object.getOwnPropertyDescriptors,v=Object.getOwnPropertySymbols,J=Object.prototype.hasOwnProperty,k=Object.prototype.propertyIsEnumerable,M=(e,s,r)=>s in e?F(e,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[s]=r,_=(e,s)=>{for(var r in s||(s={}))J.call(s,r)&&M(e,r,s[r]);if(v)for(var r of v(s))k.call(s,r)&&M(e,r,s[r]);return e},Y=(e,s)=>V(e,H(s));const q={messages:[],loading:!0,error:null,room:null,paginationCursor:null},G=$()(C((e,s)=>Y(_({},q),{loadMessages:r=>{const o=m(r);e({messages:o,loading:!1,error:null})},addMessage:r=>{const{messages:t}=s();if(t.find(i=>i.id===r.id))return;const a=[...t,r],l=m(a);e({messages:l})},updateMessage:(r,t)=>{const{messages:o}=s();let a=!1;const l=o.map(i=>{if(i.id===r){const f=_(_({},i),t);if(Object.keys(t).some(w=>i[w]!==t[w]))return a=!0,f}return i});if(a){const i=m(l);e({messages:i})}},clearMessages:()=>{e({messages:[],loading:!1,error:null})},setLoading:r=>{const{loading:t}=s();t!==r&&e({loading:r})},setError:r=>{const{error:t}=s();t!==r&&e({error:r})},setRoom:r=>{const{room:t}=s();t!==r&&e({room:r})},setPaginationCursor:r=>{const{paginationCursor:t}=s();t!==r&&e({paginationCursor:r})},getMessagesByType:r=>{const{messages:t}=s(),o=[];for(let a=0;a<t.length;a++)t[a].type===r&&o.push(t[a]);return o},getLatestMessage:()=>{const{messages:r}=s();return B(r)},getLatestMessageByType:r=>{const{messages:t}=s();return U(t,r)},getFilteredMessages:r=>{const{messages:t}=s(),o=[];for(let a=0;a<t.length;a++)r(t[a])&&o.push(t[a]);return o},getOrderedMessagesByType:(r,t="ASC")=>{const{messages:o}=s();return z(o,r,t)}}),{name:"messages-storage",partialize:e=>({messages:e.messages,room:e.room,paginationCursor:e.paginationCursor}),onRehydrateStorage:()=>e=>{if(e){const s=new Date;s.setHours(s.getHours()-24);const r=e.messages.filter(t=>{try{const o=y(t.timestamp);if(!o)throw console.warn(`Failed to parse timestamp for message ${t.id}:`,typeof t.timestamp,t.timestamp),new Error(`Failed to parse timestamp for message ${t.id}`);return o>s}catch(o){return console.warn(`Failed to parse message timestamp for message ID ${t.id}:`,o.message),!0}});r.length!==e.messages.length&&e.loadMessages(r)}}}));var K=Object.defineProperty,j=Object.getOwnPropertySymbols,Q=Object.prototype.hasOwnProperty,W=Object.prototype.propertyIsEnumerable,x=(e,s,r)=>s in e?K(e,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[s]=r,X=(e,s)=>{for(var r in s||(s={}))Q.call(s,r)&&x(e,r,s[r]);if(j)for(var r of j(s))W.call(s,r)&&x(e,r,s[r]);return e};const Z=T.createContext(void 0);function b(e){const{id:s}=O(),{messages:r,loading:t,loadMessages:o,setLoading:a,setRoom:l,clearMessages:i}=G();u.useEffect(()=>{if(a(!0),l(s||null),!s){i();return}return D(s,h=>{o(h)})},[s,o,a,l,i]);const f={messages:r,isLoading:t};return n.jsx(Z.Provider,X({value:f},e))}const P=u.lazy(()=>c(()=>import("./userList.tsx-DlUmKFMN.js"),__vite__mapDeps([0,1,2,3,4,5,6])).then(e=>({default:e.UserListProvider}))),ee=u.lazy(()=>c(()=>import("./index.tsx-Udj355hm.js"),__vite__mapDeps([7,1,2,8,3,4,5,9,10,11,12,6,13]))),se=u.lazy(()=>c(()=>import("./index.tsx-B3BtsRTY.js"),__vite__mapDeps([14,1,2,15,16,12,9,3,4,5,10,6,17,18,19,20]))),re=u.lazy(()=>c(()=>import("./chunk-5m6QozhO.js").then(function(e){return e.i}),__vite__mapDeps([21,3,1,2,4,5,22,11,12,9,10,6,19,23,20,24,25,16,17,26,15,18])));function E({children:e}){const{id:s}=O(),r=A(),t=L();return u.useEffect(()=>{if(s&&s!==s.toUpperCase()){const o=t.pathname.replace(s,s.toUpperCase());r(o+t.search+t.hash,{replace:!0})}},[s,r,t]),n.jsx(n.Fragment,{children:e})}function te(){const e=u.useContext(N);if(u.useEffect(()=>(e&&(window.authContext=e),()=>{window.authContext=null}),[e]),!e||e.initializing)return n.jsx(g,{});const s=e.user?n.jsx(re,{}):n.jsx(ee,{});return n.jsxs(S,{children:[n.jsx(p,{path:"/",element:n.jsx(I,{replace:!0,to:"/PUBLIC"})}),n.jsx(p,{path:"/:id/cast",element:n.jsx(E,{children:n.jsx(u.Suspense,{fallback:n.jsx(g,{}),children:n.jsx(P,{children:n.jsx(b,{children:n.jsx(se,{})})})})})}),n.jsx(p,{path:"/:id",element:n.jsx(E,{children:n.jsx(u.Suspense,{fallback:n.jsx(g,{}),children:n.jsx(P,{children:n.jsx(b,{children:s})})})})})]})}function oe(){return n.jsx(R,{children:n.jsx(te,{})})}const de=Object.freeze({__proto__:null,default:oe});export{Z as M,ce as a,de as i,U as l,z as o,y as p};
//# sourceMappingURL=chunk-BUoOus3c.js.map
