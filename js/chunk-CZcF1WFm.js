const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["js/chunk-C0b6J2Rd.js","js/chunk-DEpGQMoM.js","js/chunk-Bb4N9MXk.js","js/chunk-BxyRzOKK.js","js/chunk-B9w7spwz.js","js/chunk-DfnjTLcn.js","assets/index-dNlpAFRr.js"])))=>i.map(i=>d[i]);
import{d as _,g as ne,u as z,a as oe,i as ae,c as ie,l as ce,b as p,w as le,r as ue,e as de,f as fe,h as ge,j as ye,k as me,_ as W}from"./chunk-C0b6J2Rd.js";import{i as q,b as u,j as T,R as we}from"./chunk-DEpGQMoM.js";import{A as j}from"../assets/index-dNlpAFRr.js";import{g as A,C as B,t as S,i as he,v as pe}from"./chunk-BxyRzOKK.js";(function(){var e=typeof window!="undefined"?window:typeof global!="undefined"?global:typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:{};e.SENTRY_RELEASE={id:"b82d01bea29447e452b49ba3e85b9fac2f7942a4"}})();try{(function(){var e=typeof window!="undefined"?window:typeof global!="undefined"?global:typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:{},t=new e.Error().stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="dcc19452-0bca-44ed-9ffd-60f1d72be6c0",e._sentryDebugIdIdentifier="sentry-dbid-dcc19452-0bca-44ed-9ffd-60f1d72be6c0")})()}catch(e){}const{customTiles:y}=_;y.hook("creating",function(e,t,r){t.locale===void 0&&(t.locale="en"),t.gameMode===void 0&&(t.gameMode="online"),t.isCustom===void 0&&(t.isCustom=1)});const Te=async e=>{const t=e.map(r=>({...r,isEnabled:1}));return await y.bulkAdd(t)},Q=e=>{const t=["locale","gameMode","group","intensity","tag","isCustom","action"];let r=y.toCollection();return Object.entries(e).filter(([n])=>t.includes(n)).forEach(([n,s])=>{s==null||s===""||(n==="tag"?r=r.filter(d=>d.tags.includes(s)):r=r.filter(d=>d[n]===s))}),r},U=async(e={})=>{try{return await Q(e).toArray()}catch(t){return console.error("Error in getTiles:",t),[]}},be=async e=>{const{page:t=1,limit:r=50}=e;try{const o=Q(e),n=await o.count(),s=(t-1)*r;return{items:await o.offset(s).limit(r).toArray(),total:n,page:t,limit:r,totalPages:Math.ceil(n/r)}}catch(o){return console.error("Error in getPaginatedTiles:",o),{items:[],total:0,page:t,limit:r,totalPages:0}}},Y=(e="en",t="online")=>y.where("locale").equals(e).and(r=>r.gameMode===t),Ae=async(e="en",t="online",r=null)=>{let o=Y(e,t);return r&&(o=o.and(s=>s.tags.some(d=>r.includes(d)))),(await o.toArray()).reduce((s,d)=>{const m=d.group;s[m]||(s[m]={count:0,intensities:{}}),s[m].count++;const l=Number(d.intensity);return s[m].intensities[l]||(s[m].intensities[l]=0),s[m].intensities[l]++,s},{})},ve=(e=null)=>{const t=q.resolvedLanguage||q.language||"en";let r=y.where("locale").equals(t).and(o=>o.isEnabled===1);return e&&(r=r.and(o=>o.gameMode===e)),r.toArray()},$=async e=>await y.add({...e,isEnabled:1}),Ce=async(e,t)=>await y.update(e,t),Ee=async e=>{const t=await y.get(e);if(!t)throw new Error(`Custom tile with id ${e} not found`);return await y.update(e,{isEnabled:t.isEnabled?0:1})};async function V(){try{return await _.customTiles.where("isCustom").equals(1).delete(),!0}catch(e){return console.error("Error deleting custom tiles:",e),!1}}const _e=async e=>{await y.delete(e)},H=(e,t="en",r="online")=>Y(t,r).and(o=>o.group===e),Se=async(e,t="en",r="online")=>{try{return await H(e,t,r).count()}catch(o){return console.error("Error counting tiles by group:",o),0}},De=async(e,t="en",r="online")=>{try{return await H(e,t,r).delete()}catch(o){return console.error("Error deleting tiles by group:",o),0}},Ye=Object.freeze({__proto__:null,addCustomTile:$,countTilesByGroup:Se,deleteAllIsCustomTiles:V,deleteCustomTile:_e,deleteCustomTilesByGroup:De,getActiveTiles:ve,getPaginatedTiles:be,getTileCountsByGroup:Ae,getTiles:U,importCustomTiles:Te,toggleCustomTile:Ee,updateCustomTile:Ce}),{gameBoard:w}=_,Pe=()=>w.orderBy("title").toArray(),$e=async()=>{var e;return(e=w.where("isActive").equals(1))==null?void 0:e.first()},Be=async e=>w.add(e),Ie=async(e,t)=>w.update(e.id,{...e,...t}),xe=async e=>{var t,r;const o={title:e.title===void 0?"":e.title,tiles:e.tiles||[],isActive:e.isActive===void 0?1:e.isActive,tags:e.tags||[],gameMode:e.gameMode||"online"};if(!((t=o==null?void 0:o.title)!=null&&t.length)&&((r=o==null?void 0:o.tiles)!=null&&r.length))return;const n=await w.where("title").equals(o.title).first();return _.transaction("rw",_.gameBoard,async()=>(o.isActive&&await Me(),n?(await Ie(n,e),n.id):await Be(o)))},Ve=async e=>{const r=(await w.toArray()).map(o=>({...o,isActive:o.id===e?1:0}));await w.bulkPut(r)},He=async e=>{await w.delete(e)},Me=async()=>{await w.where("isActive").equals(1).modify({isActive:0})},Ke="None",Je=3e4,L=500,D=he();async function Ue(){const t=A().currentUser;if(!t)return console.error("No user logged in"),!1;try{const r=await U({isCustom:1});return await B(S(D,"user-data",t.uid),{customTiles:r,lastUpdated:new Date},{merge:!0}),!0}catch(r){return console.error("Error syncing custom tiles:",r),!1}}async function Ge(){const t=A().currentUser;if(!t)return console.error("No user logged in"),!1;try{const r=await ne();return await B(S(D,"user-data",t.uid),{customGroups:r,lastUpdated:new Date},{merge:!0}),!0}catch(r){return console.error("Error syncing custom groups:",r),!1}}async function Fe(){const t=A().currentUser;if(!t)return console.error("No user logged in"),!1;try{const r=await Pe();return r.length&&await B(S(D,"user-data",t.uid),{gameBoards:r,lastUpdated:new Date},{merge:!0}),!0}catch(r){return console.error("Error syncing game boards:",r),!1}}async function ke(){const t=A().currentUser;if(!t)return console.error("No user logged in"),!1;try{const{settings:r}=z.getState(),{localPlayers:o,...n}=r;return await B(S(D,"user-data",t.uid),{settings:n,lastUpdated:new Date},{merge:!0}),!0}catch(r){return console.error("Error syncing settings:",r),!1}}async function x(){return await Ue(),await Ge(),await Fe(),await ke(),!0}async function M(){const t=A().currentUser;if(!t)return console.error("No user logged in"),!1;try{const r=S(D,"user-data",t.uid),o=await pe(r);if(!o.exists())return!1;const n=o.data();if(n.customTiles!==void 0&&(await V(),await new Promise(s=>setTimeout(s,L)),n.customTiles&&n.customTiles.length>0))for(const s of n.customTiles)try{(await U({gameMode:s.gameMode,group:s.group,intensity:s.intensity,action:s.action})).length===0&&await $(s)}catch(d){console.error("Error importing custom tile:",s,d)}if(n.customGroups!==void 0&&(await oe(),await new Promise(s=>setTimeout(s,L)),n.customGroups&&n.customGroups.length>0))try{await ae(n.customGroups)}catch(s){console.error("Error importing custom groups:",s)}if(n.gameBoards&&n.gameBoards.length>0)for(const s of n.gameBoards)await xe({title:s.title,tiles:s.tiles,tags:s.tags||[],gameMode:s.gameMode||"online",isActive:s.isActive||0});if(n.settings)try{const{updateSettings:s}=z.getState(),d=n.settings;s(d)}catch(s){console.error("Error importing settings:",s)}return!0}catch(r){return console.error("Error syncing data:",r),!1}}let P=null;function O(e=5){E();const t=e*60*1e3;return P=window.setInterval(async()=>{const r=A();r.currentUser&&!r.currentUser.isAnonymous&&await M()},t),!0}function E(){return P?(window.clearInterval(P),P=null,!0):!1}const K=we.createContext(void 0);function Ne(e){const[t,r]=u.useState(null),[o,n]=u.useState(!1),[s,d]=u.useState(!0),[m,l]=u.useState(null),[C,b]=u.useState({syncing:!1,lastSync:null}),f=u.useRef(null),G=u.useRef(!1),v=u.useCallback(async i=>{if(f.current&&(clearTimeout(f.current),f.current=null),!t||t.isAnonymous)return!1;try{return b({syncing:!0,lastSync:C.lastSync}),await i(),b({syncing:!1,lastSync:new Date}),!0}catch(a){return console.error("Sync error:",a),a instanceof Error?l(a.message):l("An unknown error occurred"),b({syncing:!1,lastSync:C.lastSync}),!1}},[t,f,b,C.lastSync,l]);async function J(i=""){try{const a=await me(i);return r(a),a}catch(a){const c=p(a);throw l(c),a}}async function X(i,a){try{n(!0);const c=await ye(i,a);return r(c),c}catch(c){const g=p(c);throw l(g),c}finally{n(!1)}}async function Z(){try{n(!0);const i=await ge();return r(i),i}catch(i){const a=p(i);throw l(a),i}finally{n(!1)}}async function ee(i,a,c){try{n(!0);const g=await fe(i,a,c);return r(g),g}catch(g){const h=p(g);throw l(h),g}finally{n(!1)}}async function te(i){try{return await ue(i),!0}catch(a){const c=p(a);throw l(c),a}}const F=u.useCallback(async(i,a)=>{try{n(!0);const c=await ie(i,a);return r(c),await v(x),c}catch(c){throw c instanceof Error&&l(c.message),c}finally{n(!1)}},[n,r,v,l]);async function re(i=""){try{const a=await de(i);return r(a),a}catch(a){const c=p(a);throw l(c),a}}const k=u.useCallback(async()=>{try{if(t&&!t.isAnonymous){const i=v(x),a=new Promise(c=>setTimeout(c,5e3,!1));await Promise.race([i,a])}await ce(),r(null)}catch(i){const a=p(i);throw l(a),i}},[t,v,r,l]),N=u.useCallback(async()=>{try{await le(),r(null),window.location.reload()}catch(i){const a=p(i);throw l(a),i}},[r,l]),R=u.useCallback(async()=>v(x),[v]);u.useEffect(()=>{const a=A().onAuthStateChanged(c=>{if(r(c||null),G.current||(G.current=!0,d(!1)),c&&!c.isAnonymous){const g=()=>{f.current&&clearTimeout(f.current),f.current=setTimeout(()=>{b({syncing:!0,lastSync:null});let h;try{h=M?M():Promise.resolve(!1)}catch(I){console.warn("syncDataFromFirebase is not available:",I),h=Promise.resolve(!1)}(!h||typeof h.then!="function")&&(h=Promise.resolve(!1)),h.then(()=>{b({syncing:!1,lastSync:new Date}),O&&O()}).catch(I=>{console.error("Error syncing from Firebase:",I),b({syncing:!1,lastSync:null})}).finally(()=>{f.current=null})},1e3)};typeof window!="undefined"&&"requestIdleCallback"in window?window.requestIdleCallback(g,{timeout:5e3}):setTimeout(g,100)}else E&&E()});return window.authContext={user:null},()=>{typeof a=="function"&&a(),f.current&&clearTimeout(f.current),E&&E(),window.authContext=void 0}},[]),u.useEffect(()=>{const i=window;i.authContext&&(i.authContext.user=t)},[t]);const se=u.useMemo(()=>({user:t,loading:o,initializing:s,error:m,syncStatus:C,login:J,loginEmail:X,loginGoogle:Z,register:ee,updateUser:re,forgotPassword:te,convertToRegistered:F,logout:k,wipeAllData:N,syncData:R,isAnonymous:(t==null?void 0:t.isAnonymous)||!1}),[t,o,s,m,C,F,k,N,R]);return T.jsx(K.Provider,{value:se,...e})}const Re=u.lazy(()=>W(()=>import("./chunk-C0b6J2Rd.js").then(function(e){return e.T}),__vite__mapDeps([0,1,2,3,4]))),qe=u.lazy(()=>W(()=>import("./chunk-DfnjTLcn.js").then(function(e){return e.i}),__vite__mapDeps([5,0,1,2,3,4,6])));function je(){const e=u.useContext(K);return!e||e.initializing?T.jsx(j,{}):T.jsx(u.Suspense,{fallback:T.jsx(j,{}),children:T.jsx(Re,{children:T.jsx(qe,{})})})}function Le(){return T.jsx(Ne,{children:T.jsx(je,{})})}const Xe=Object.freeze({__proto__:null,default:Le});export{K as A,Ke as D,Je as U,$e as a,U as b,$ as c,Ce as d,Se as e,De as f,ve as g,Ae as h,Te as i,be as j,_e as k,Ie as l,Ve as m,He as n,Pe as o,Ye as p,Xe as q,Ee as t,xe as u};
//# sourceMappingURL=chunk-CZcF1WFm.js.map
