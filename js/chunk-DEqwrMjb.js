const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["js/userList.tsx-zasqzma4.js","js/chunk-DCqCmTw7.js","js/chunk-rJHcTq4h.js","js/chunk-5SGEHjMG.js","js/chunk-BxyRzOKK.js","js/chunk-DyYP0jr7.js","js/chunk-BKkrGAF_.js","js/index.tsx-Bo49F5-U.js","js/chunk-D9KJ0g3I.js","js/chunk-YpQmZHCE.js","assets/index-CRbdjLFF.js","js/chunk-Ddv6gvN9.js","js/chunk-BqV4rolb.js","js/index.tsx-Dd0_kjfE.js","js/index.tsx-Prvined_.js","js/chunk-UxByTxDv.js","js/chunk-Chz5q09A.js","js/chunk-Bmx5YEUT.js","js/chunk-CDkIGNty.js","js/chunk-B47UJojq.js","js/chunk-Cpw0r6bE.js","js/chunk-C37eCpQN.js","js/chunk-D4HAf_Fz.js","js/chunk-CJ-p-rHL.js","js/chunk-DsesnlQY.js","js/chunk-CY6JpaOE.js","js/index.tsx-B-2pevI9.js"])))=>i.map(i=>d[i]);
import{p as b,m as E,_ as c}from"./chunk-5SGEHjMG.js";import{R as v,aj as j,b as u,j as o,ak as C,al as T,am as g,an as R,ao as D,ap as A}from"./chunk-DCqCmTw7.js";import{A as L}from"./chunk-YpQmZHCE.js";import{a as S}from"./chunk-rJHcTq4h.js";import{A as p}from"../assets/index-CRbdjLFF.js";(function(){var e=typeof window!="undefined"?window:typeof global!="undefined"?global:typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:{};e.SENTRY_RELEASE={id:"b82d01bea29447e452b49ba3e85b9fac2f7942a4"}})();try{(function(){var e=typeof window!="undefined"?window:typeof global!="undefined"?global:typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:{},s=new e.Error().stack;s&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[s]="5623543e-9ef4-4ff2-892c-11a26877e727",e._sentryDebugIdIdentifier="sentry-dbid-5623543e-9ef4-4ff2-892c-11a26877e727")})()}catch(e){}function h(e){if(!e)return null;try{if(typeof e.toDate=="function")return e.toDate();if(typeof e=="string"){const s=new Date(e);if(isNaN(s.getTime()))throw new Error("Invalid serialized timestamp format");return s}else if(typeof e=="number"){const s=e<3250368e4?e*1e3:e,t=new Date(s);if(isNaN(t.getTime()))throw new Error("Invalid numeric timestamp format");return t}else if(typeof e=="object"&&e.seconds!==void 0){const s=e,t=new Date(s.seconds*1e3+(s.nanoseconds||0)/1e6);if(isNaN(t.getTime()))throw new Error("Invalid Firestore timestamp object format");return t}else{if(e instanceof Date)return e;throw console.warn("Unsupported timestamp format:",typeof e,e),new Error(`Unsupported timestamp format: ${typeof e}`)}}catch(s){return console.warn("Failed to parse timestamp:",s),null}}function m(e){return e.sort((s,t)=>{const r=h(s.timestamp),n=h(t.timestamp);return!r||!n?0:r.getTime()-n.getTime()})}function d(e){return JSON.parse(JSON.stringify(e)).reverse()}function I(e,s){return d(e).find(t=>t.type===s)}function P(e,s,t="ASC"){let r=d(e);return t==="DESC"&&(r=r.reverse()),r.filter(n=>n.type===s)}function K(e,s){return d(e).find(s)}function N(e){return d(e)[0]}const O={messages:[],loading:!0,error:null,room:null,paginationCursor:null},U=S()(b((e,s)=>({...O,loadMessages:t=>{const n=m(t);e({messages:n,loading:!1,error:null})},addMessage:t=>{const{messages:r}=s();if(r.find(i=>i.id===t.id))return;const a=[...r,t],l=m(a);e({messages:l})},updateMessage:(t,r)=>{const{messages:n}=s();let a=!1;const l=n.map(i=>{if(i.id===t){const f={...i,...r};if(Object.keys(r).some(M=>i[M]!==r[M]))return a=!0,f}return i});if(a){const i=m(l);e({messages:i})}},clearMessages:()=>{e({messages:[],loading:!1,error:null})},setLoading:t=>{const{loading:r}=s();r!==t&&e({loading:t})},setError:t=>{const{error:r}=s();r!==t&&e({error:t})},setRoom:t=>{const{room:r}=s();r!==t&&e({room:t})},setPaginationCursor:t=>{const{paginationCursor:r}=s();r!==t&&e({paginationCursor:t})},getMessagesByType:t=>{const{messages:r}=s(),n=[];for(let a=0;a<r.length;a++)r[a].type===t&&n.push(r[a]);return n},getLatestMessage:()=>{const{messages:t}=s();return N(t)},getLatestMessageByType:t=>{const{messages:r}=s();return I(r,t)},getFilteredMessages:t=>{const{messages:r}=s(),n=[];for(let a=0;a<r.length;a++)t(r[a])&&n.push(r[a]);return n},getOrderedMessagesByType:(t,r="ASC")=>{const{messages:n}=s();return P(n,t,r)}}),{name:"messages-storage",partialize:e=>({messages:e.messages,room:e.room,paginationCursor:e.paginationCursor}),onRehydrateStorage:()=>e=>{if(e){const s=new Date;s.setHours(s.getHours()-24);const t=e.messages.filter(r=>{try{const n=h(r.timestamp);if(!n)throw console.warn(`Failed to parse timestamp for message ${r.id}:`,typeof r.timestamp,r.timestamp),new Error(`Failed to parse timestamp for message ${r.id}`);return n>s}catch(n){return console.warn(`Failed to parse message timestamp for message ID ${r.id}:`,n.message),!0}});t.length!==e.messages.length&&e.loadMessages(t)}}})),z=v.createContext(void 0);function w(e){const{id:s}=j(),{messages:t,loading:r,loadMessages:n,setLoading:a,setRoom:l,clearMessages:i}=U();u.useEffect(()=>{if(a(!0),l(s||null),!s){i();return}return E(s,y=>{n(y)})},[s,n,a,l,i]);const f={messages:t,isLoading:r};return o.jsx(z.Provider,{value:f,...e})}const x=u.lazy(()=>c(()=>import("./userList.tsx-zasqzma4.js"),__vite__mapDeps([0,1,2,3,4,5,6])).then(e=>({default:e.UserListProvider}))),B=u.lazy(()=>c(()=>import("./index.tsx-Bo49F5-U.js"),__vite__mapDeps([7,1,2,8,3,4,5,9,10,11,12,6,13]))),F=u.lazy(()=>c(()=>import("./index.tsx-Prvined_.js"),__vite__mapDeps([14,1,2,15,16,12,9,3,4,5,10,6,17,18,19,20]))),k=u.lazy(()=>c(()=>import("./chunk-C37eCpQN.js").then(function(e){return e.i}),__vite__mapDeps([21,3,1,2,4,5,22,11,12,9,10,6,19,23,20,24,25,16,17,26,15,18])));function _({children:e}){const{id:s}=j(),t=D(),r=A();return u.useEffect(()=>{if(s&&s!==s.toUpperCase()){const n=r.pathname.replace(s,s.toUpperCase());t(n+r.search+r.hash,{replace:!0})}},[s,t,r]),o.jsx(o.Fragment,{children:e})}function V(){const e=u.useContext(L);if(u.useEffect(()=>(e&&(window.authContext=e),()=>{window.authContext=null}),[e]),!e||e.initializing)return o.jsx(p,{});const s=e.user?o.jsx(k,{}):o.jsx(B,{});return o.jsxs(T,{children:[o.jsx(g,{path:"/",element:o.jsx(R,{replace:!0,to:"/PUBLIC"})}),o.jsx(g,{path:"/:id/cast",element:o.jsx(_,{children:o.jsx(u.Suspense,{fallback:o.jsx(p,{}),children:o.jsx(x,{children:o.jsx(w,{children:o.jsx(F,{})})})})})}),o.jsx(g,{path:"/:id",element:o.jsx(_,{children:o.jsx(u.Suspense,{fallback:o.jsx(p,{}),children:o.jsx(x,{children:o.jsx(w,{children:s})})})})})]})}function $(){return o.jsx(C,{children:o.jsx(V,{})})}const Q=Object.freeze({__proto__:null,default:$});export{z as M,K as a,Q as i,I as l,P as o,h as p};
//# sourceMappingURL=chunk-DEqwrMjb.js.map
