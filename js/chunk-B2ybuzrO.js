import{i as y}from"./chunk-CTov3vEJ.js";import{g as v}from"./chunk-B4PEA_xj.js";import{l as h}from"./chunk-yLOK5aTh.js";import{r as p,j as l,am as x}from"./chunk-BCLv-HyH.js";import{u as w}from"./chunk-D8Vmrdi9.js";import{c as k}from"./chunk-C5tDN2aE.js";function I(e){const t=/vimeo\.com\/(\d+)/,o=e.match(t);return`https://player.vimeo.com/video/${o?o[1]:""}?autoplay=1&loop=1&autostart=true`}function $(e){const t=/(?:youtube\.com\/(?:[^/]+\/.+\/|(?:v|e(?:mbed)?)\/|[^#]*[?&]v=|youtu\.be\/)([^"&?/ ]{11})|^(?:[^"&?/ ]{11})$)/,o=e.match(t);return`https://www.youtube.com/embed/${o?o[1]:""}?autoplay=1&loop=1&autostart=true&mute=1&playsinline=1&controls=0&disablekb=1&fs=0&modestbranding=1&rel=0&iv_load_policy=3`}function R(e){const t=/drive\.google\.com\/file\/d\/([^/]+)/,o=e.match(t);return`https://drive.google.com/file/d/${o?o[1]:""}/preview?loop=1`}function U(e){const t=/dropbox\.com\/s\/([^/]+)/,o=e.match(t);return`https://www.dropbox.com/s/${o?o[1]:""}?raw=1`}function B(e){return`https://pornhub.com/embed/${new URL(e).searchParams.get("viewkey")||""}?autoplay=1&loop=1&autostart=true&playsinline=1`}function j(e){const t=e.split("-");return`https://xhamster.com/xembed.php?video=${t[t.length-1]}?autoplay=1&loop=1&autostart=true`}function A(e){const t=/media\.tenor\.com\/([a-zA-Z0-9_-]+)\/[^/]*\.(mp4|gif|webp)/;if(e.match(t))return e;const n=/tenor\.com\/view\/[^/]*-(\d+)/,r=e.match(n);return`https://tenor.com/embed/${r?r[1]:""}?autoplay=1`}function L(e){const t=/giphy\.com\/gifs\/[^/]*-([a-zA-Z0-9]+)/,o=e.match(t);return`https://media.giphy.com/media/${o?o[1]:""}/giphy.gif`}function M(e){const t=/(?:gfycat\.com|redgifs\.com)\/(?:watch\/)?([a-zA-Z0-9]+)/,o=e.match(t),n=o?o[1]:"";return e.includes("redgifs.com")?`https://files.redgifs.com/${n}.mp4`:`https://giant.gfycat.com/${n}.mp4`}function P(e){const t=/redtube\.com\/(\d+)/,o=e.match(t);return`https://embed.redtube.com/?id=${o?o[1]:""}&autoplay=1&playsinline=1`}function z(e){const t=/youporn\.com\/watch\/(\d+)/,o=e.match(t);return`https://www.youporn.com/embed/${o?o[1]:""}?autoplay=1&playsinline=1`}function N(e){const t=/tube8\.com\/[^/]+\/[^/]+\/(\d+)/,o=e.match(t);return`https://www.tube8.com/embed/${o?o[1]:""}?autoplay=1&playsinline=1`}function F(e){try{const r=new URL(e);if((r.host==="discordapp.net"||r.host.endsWith(".discordapp.net"))&&r.pathname.startsWith("/external/")&&(r.pathname.includes("/https/i.imgur.com/")||r.pathname.includes("/https/imgur.com/")))return e}catch(r){h.debug("URL parsing failed for Discord proxy check:",r)}let t="",o=!1;try{const r=new URL(e);o=r.host==="imgur.com"||r.host==="i.imgur.com"}catch(r){return h.debug("URL parsing failed for Imgur processing:",r),""}if(!o)return"";if(e.includes("/gallery/")){const r=e.match(/imgur\.com\/gallery\/[^#]*#([a-zA-Z0-9]+)/);if(r)t=r[1];else{const s=e.match(/#([a-zA-Z0-9]+)/);s&&(t=s[1])}}else{const r=/imgur\.com\/([a-zA-Z0-9]+)(?:\.(mp4|jpg|jpeg|png|gif|webp))?|images-ext-\d+\.discordapp\.net\/external\/[^/]+\/https\/i\.imgur\.com\/([a-zA-Z0-9]+)\.(mp4|jpg|jpeg|png|gif|webp)/,s=e.match(r);t=s?s[1]||s[3]:""}return`https://i.imgur.com/${t}.mp4`}function b(e){return/\.(mp4|webm|ogg|mov)(\?.*)?$/.test(e)}function S(e){return g(e,["media.discordapp.net","cdn.discordapp.com"])&&!b(e)}function g(e,t){try{const o=new URL(e);return t.some(n=>o.host===n||o.host.endsWith("."+n))}catch(o){return h.debug("URL parsing failed in urlContainsAny, using fallback:",o),t.some(n=>e.includes(n))}}function Z(e){let t=null,o=!0;if(!e)return{url:"",isVideo:!1};switch(!0){case e.includes("vimeo.com"):t=I(e);break;case g(e,["youtube.com","youtu.be"]):t=$(e);break;case e.includes("drive.google.com"):t=R(e);break;case e.includes("pornhub.com"):t=B(e);break;case e.includes("xhamster.com"):t=j(e);break;case e.includes("dropbox.com"):t=U(e);break;case g(e,["imgur.com","i.imgur.com"]):t=F(e);break;case g(e,["tenor.com","media.tenor.com"]):t=A(e),o=!0;break;case e.includes("giphy.com"):t=L(e),o=!0;break;case g(e,["gfycat.com","redgifs.com"]):t=M(e),o=!0;break;case e.includes("redtube.com"):t=P(e);break;case e.includes("youporn.com"):t=z(e);break;case e.includes("tube8.com"):t=N(e);break;case g(e,["twitter.com","x.com"]):t=e,o=!1;break;case e.includes("thisvid.com"):t=e;break;case e.includes("boyfriendtv.com"):t=e;break;case S(e):t=e,o=!1;break;case b(e):t=e;break;default:t=v(e),o=!1;break}return{url:t,isVideo:o}}function O(e,t){const{background:o,backgroundURL:n,roomBackground:r,roomBackgroundURL:s}=e,a=(d,u)=>{if(!d)return null;if(d==="custom")return u?s||null:n||null;if(d==="useAppBackground"){const i=o||"color";return i==="useRoomBackground"?"color":i==="custom"?n||null:i}if(d==="useRoomBackground"){if(y(t))return"color";const i=r||"useAppBackground";return i==="useAppBackground"?"color":i==="custom"?s||null:i}return d};let c=null;return!y(t)&&r&&r!=="useAppBackground"?c=a(r,!0):o?c=a(o,!1):c="color",c?c==="color"||c==="gray"?{url:c,isVideo:!1}:Z(c):{url:null,isVideo:!1}}function E(e){return{uid:e.uid,displayName:e.displayName,isSelf:e.isSelf,isFinished:e.isFinished}}function V(e){const[t,o]=p.useState(null),n=w(),r=p.useMemo(()=>n.map(a=>`${a.uid}-${a.displayName}-${a.isFinished}-${a.isSelf}`).join("|"),[n]),s=p.useMemo(()=>e?`${e.uid}-${e.displayName||""}`:null,[e]);return p.useEffect(()=>{if(!e){o(null);return}if(n.length<=1){o(null);return}const a=n.filter(i=>!i.isFinished);if(a.length<=1){o(null);return}let c=-1;c=a.findIndex(i=>i.uid===e.uid),c===-1&&(c=a.findIndex(i=>i.displayName===e.displayName)),c===-1&&(c=0);const m=(c+1)%a.length,d=a[m],u=E(d);o(u)},[s,r]),t}function C({url:e}){const[t,o]=p.useState("video"),[n,r]=p.useState(e);if(p.useEffect(()=>{r(e),o("video")},[e]),!e)return null;const s=()=>{let c=!1;try{const u=new URL(e);c=u.host==="imgur.com"||u.host==="i.imgur.com"}catch{c=!1}if(c){const u=e.match(/imgur\.com\/([a-zA-Z0-9]+)/)?.[1];if(u){const i=`https://i.imgur.com/${u}.jpg`;r(i),o("image");return}}const d=`${e.replace(/\.(mp4|webm|ogg|mov)(\?.*)?$/i,"")}.jpg`;r(d),o("image")},a=()=>{let c=!1;try{const m=new URL(e);c=m.host==="imgur.com"||m.host==="i.imgur.com"}catch{c=!1}if(c){const m=e.match(/imgur\.com\/([a-zA-Z0-9]+)/)?.[1];if(m){const d=["png","gif","jpeg","webp"],u=n?.split(".").pop(),i=d.find(f=>f!==u);if(i){const f=`https://i.imgur.com/${m}.${i}`;r(f)}}}else{const m=["png","gif","jpeg","webp"],d=n?.split(".").pop(),u=m.find(i=>i!==d);if(u&&n){const f=`${n.replace(/\.[^.]+(\?.*)?$/,"")}.${u}`;r(f)}}};return t==="video"?l.jsx("video",{autoPlay:!0,loop:!0,muted:!0,playsInline:!0,src:n||void 0,className:"video-background",onError:s,preload:"auto",crossOrigin:"anonymous",controls:!1}):l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"image-background",style:{backgroundImage:`url(${n})`,backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat",width:"100%",height:"100%",position:"absolute",top:0,left:0}}),l.jsx("img",{src:n||void 0,onError:a,style:{display:"none"},alt:""})]})}function q({url:e=null,isVideo:t=null}){const o=typeof window<"u"&&(window.location.search.includes("receiver=true")||window.location.search.includes("chromecast=true")||navigator.userAgent.includes("CrKey")||navigator.userAgent.includes("TV")),n=e&&/\.(mp4|webm|ogg|mov|gif)(\?.*)?$/i.test(e),r=e==="color"||e==="gray"||e?.includes("/color")||e?.includes("/gray"),s=e&&!r&&(t||!t&&e);return l.jsx(x,{className:k("main-container",!s&&"default-background"),role:"presentation",sx:{backgroundImage:!t&&e&&!r?`url(${e})`:"none"},children:t&&(n||o?l.jsx(C,{url:e}):l.jsx("iframe",{width:"100%",height:"100%",src:e||void 0,title:"video",allow:"autoplay; fullscreen; encrypted-media; picture-in-picture",sandbox:"allow-same-origin allow-scripts allow-presentation",style:{border:0}}))})}export{q as R,O as g,Z as p,V as u};
