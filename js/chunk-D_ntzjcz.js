import{ak as A,r,j as e,am as v,aS as S,A as p,Q as h,at as C,ar as c,T as k,a1 as D,au as L,W as F,ay as K,Y as T}from"./chunk-BCLv-HyH.js";import{n as G,o as q,q as R,A as I}from"./chunk-CdYmDWt4.js";import{G as N}from"./chunk-BqpKB5_W.js";import{u as B,C as z}from"./chunk-Bzty42SC.js";function V({onSuccess:a,onSwitchToRegister:o,onSwitchToForgotPassword:l,isLinking:t=!1}){const{t:s}=A(),[i,n]=r.useState(""),[u,m]=r.useState(""),[y,f]=r.useState(""),[x,j]=r.useState(!1),w=async g=>{g.preventDefault(),f(""),j(!0);try{await G(i,u),a&&a()}catch(b){console.error("Login error:",b),f(b.message||"Failed to sign in")}finally{j(!1)}};return e.jsxs(v,{component:"form",onSubmit:w,sx:{mt:1},children:[y&&e.jsx(S,{severity:"error",sx:{mb:2},children:y}),e.jsx(p,{margin:"normal",required:!0,fullWidth:!0,id:"email",label:s("email"),name:"email",autoComplete:"email",autoFocus:!0,value:i,onChange:g=>n(g.target.value)}),e.jsx(p,{margin:"normal",required:!0,fullWidth:!0,name:"password",label:s("password"),type:"password",id:"password",autoComplete:"current-password",value:u,onChange:g=>m(g.target.value)}),e.jsx(h,{type:"submit",fullWidth:!0,variant:"contained",sx:{mt:3,mb:2},disabled:x,children:x?e.jsx(C,{size:24}):t?e.jsx(c,{i18nKey:"linkAccount",children:"Link Account"}):e.jsx(c,{i18nKey:"signIn"})}),e.jsxs(k,{align:"center",children:[e.jsx(h,{onClick:o,variant:"text",children:e.jsx(c,{i18nKey:"needAccount"})})," | ",e.jsx(h,{onClick:l,variant:"text",children:e.jsx(c,{i18nKey:"forgotPassword"})})]})]})}function H({onSuccess:a,onSwitchToLogin:o,isAnonymous:l=!1}){const{t}=A(),[s,i]=r.useState(""),[n,u]=r.useState(""),[m,y]=r.useState(""),[f,x]=r.useState(""),[j,w]=r.useState(""),[g,b]=r.useState(!1),E=async d=>{if(d.preventDefault(),w(""),m!==f){w(t("passwordsDoNotMatch")||"Passwords do not match");return}b(!0);try{await q(n?.trim(),m,s?.trim()),a&&a()}catch(W){console.error("Registration error:",W),w(W.message||"Failed to create account")}finally{b(!1)}};return e.jsxs(v,{component:"form",onSubmit:E,sx:{mt:1},children:[j&&e.jsx(S,{severity:"error",sx:{mb:2},children:j}),e.jsx(p,{margin:"normal",required:!0,fullWidth:!0,id:"displayName",label:t("displayName"),name:"displayName",autoComplete:"name",autoFocus:!0,value:s,onChange:d=>i(d.target.value)}),e.jsx(p,{margin:"normal",required:!0,fullWidth:!0,id:"email",label:t("email"),name:"email",autoComplete:"email",value:n,onChange:d=>u(d.target.value)}),e.jsx(p,{margin:"normal",required:!0,fullWidth:!0,name:"password",label:t("password"),type:"password",id:"password",autoComplete:"new-password",value:m,onChange:d=>y(d.target.value)}),e.jsx(p,{margin:"normal",required:!0,fullWidth:!0,name:"confirmPassword",label:t("confirmPassword"),type:"password",id:"confirmPassword",autoComplete:"new-password",value:f,onChange:d=>x(d.target.value)}),e.jsx(h,{type:"submit",fullWidth:!0,variant:"contained",sx:{mt:3,mb:2},disabled:g,children:g?e.jsx(C,{size:24}):l?e.jsx(c,{i18nKey:"linkAccount"}):e.jsx(c,{i18nKey:"createAccount"})}),e.jsx(k,{align:"center",children:e.jsx(h,{onClick:o,variant:"text",children:e.jsx(c,{i18nKey:"alreadyHaveAccount"})})})]})}function M({onSuccess:a,isLinking:o=!1}){const[l,t]=r.useState(""),[s,i]=r.useState(!1),n=async()=>{t(""),i(!0);try{await R(),a&&a()}catch(u){t(u.message||"Failed to sign in with Google")}finally{i(!1)}};return e.jsxs(v,{sx:{mt:2,mb:2},children:[l&&e.jsx(S,{severity:"error",sx:{mb:2},children:l}),e.jsx(D,{sx:{mb:2},children:e.jsx(k,{variant:"body2",color:"text.secondary",children:e.jsx(c,{i18nKey:"or",children:"OR"})})}),e.jsx(h,{fullWidth:!0,variant:"outlined",startIcon:e.jsx(N,{}),onClick:n,disabled:s,sx:{mb:1},"aria-busy":s,"aria-live":"polite",children:s?e.jsx(C,{size:24}):o?L("linkWithGoogle","Link with Google"):L("signInWithGoogle","Sign in with Google")})]})}function P(){const a=r.useContext(I);if(a===void 0)throw new Error("useAuth must be used within an AuthProvider");return a}function O({children:a,open:o,close:l=null,isMobile:t=null,title:s=null,isLoading:i=!1}){const n=B(),u=t!==null?t:n;return i?null:e.jsxs(F,{fullScreen:u,open:o,maxWidth:"md",children:[e.jsxs(K,{children:[s,typeof l=="function"&&e.jsx(z,{close:l})]}),e.jsx(T,{children:a})]})}function Q({onToggleForm:a}){const[o,l]=r.useState(""),[t,s]=r.useState(""),[i,n]=r.useState(!1),[u,m]=r.useState(!1),{forgotPassword:y}=P(),f=async x=>{x.preventDefault(),s(""),n(!1),m(!0);try{await y(o),n(!0)}catch(j){s(j.message||"Failed to send reset email")}finally{m(!1)}};return e.jsxs(v,{component:"form",onSubmit:f,sx:{mt:1},children:[t&&e.jsx(S,{severity:"error",sx:{mb:2},children:t}),i&&e.jsx(S,{severity:"success",sx:{mb:2},children:e.jsx(c,{i18nKey:"resetEmailSent"})}),e.jsx(p,{margin:"normal",required:!0,fullWidth:!0,id:"email",label:e.jsx(c,{i18nKey:"email"}),name:"email",autoComplete:"email",autoFocus:!0,value:o,onChange:x=>l(x.target.value)}),e.jsx(h,{type:"submit",fullWidth:!0,variant:"contained",sx:{mt:3,mb:2},disabled:u,children:u?e.jsx(C,{size:24}):e.jsx(c,{i18nKey:"sendResetLink"})}),e.jsx(v,{sx:{textAlign:"center"},children:e.jsx(h,{variant:"text",onClick:()=>a("login"),children:e.jsx(c,{i18nKey:"backToLogin"})})})]})}function Z({open:a,close:o,initialView:l="login"}){const[t,s]=r.useState(l),{isAnonymous:i}=P(),{t:n}=A(),u=()=>{switch(t){case"login":return n(i?"linkAccount":"signIn");case"register":return n("createAccount");case"reset":return n("resetPassword");default:return n("Authentication")}};return e.jsxs(O,{title:u(),open:a,close:o,children:[t==="login"&&e.jsxs(e.Fragment,{children:[e.jsx(V,{onSwitchToRegister:()=>s("register"),onSwitchToForgotPassword:()=>s("reset"),onSuccess:o,isLinking:i}),e.jsx(M,{onSuccess:o,isLinking:i})]}),t==="reset"&&e.jsx(Q,{onToggleForm:s}),t==="register"&&e.jsx(H,{onSwitchToLogin:()=>s("login"),onSuccess:o,isAnonymous:i})]})}export{Z as A,O as D,P as u};
