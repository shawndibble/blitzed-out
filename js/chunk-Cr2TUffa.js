import{r as p,j as f,ak as M,E as C,m as T,am as D}from"./chunk-D6lSgkQl.js";import{c as _}from"./chunk-CygiBK7d.js";import{g as H}from"./chunk-CVpt392z.js";import{i as Z}from"./chunk-DOmGopoI.js";import{l as N}from"./chunk-EL58PX5i.js";import{u as V}from"./chunk-DcI6LrIM.js";function J(e){return`url("${Array.from(String(e)).filter(o=>{const s=o.codePointAt(0);return s===void 0?!1:!(s>=0&&s<=31||s===127||s>=128&&s<=159||s===8232||s===8233)}).join("").replace(/\\/g,"\\\\").replace(/"/g,'\\"')}")`}const z=e=>e&&/\.(jpe?g|png|webp|bmp|svg|gif)(\?.*)?$/i.test(e)?"image":"video";function W({url:e}){const[n,t]=p.useState(z(e)),[o,s]=p.useState(e);if(p.useEffect(()=>{s(e),t(z(e))},[e]),!o)return null;const i=()=>{const a=o??e??"";let m=!1;try{const d=new URL(a);m=d.host==="imgur.com"||d.host==="i.imgur.com"}catch{m=!1}if(m){const d=a.match(/(?:i\.)?imgur\.com\/([a-zA-Z0-9]+)(?:\.[a-z]+)?/)?.[1];if(d){const g=`https://i.imgur.com/${d}.jpg`;s(g),t("image");return}}const c=`${a.replace(/\.(mp4|webm|ogg|mov)(\?.*)?$/i,"")}.jpg`;s(c),t("image")},r=()=>{const a=o??e??"";let m=!1;try{const u=new URL(a);m=u.host==="imgur.com"||u.host==="i.imgur.com"}catch{m=!1}if(m){const u=a.match(/(?:i\.)?imgur\.com\/([a-zA-Z0-9]+)(?:\.[a-z]+)?/)?.[1];if(u){const c=["jpg","png","gif","jpeg","webp"],d=o?.split(".").pop(),l=c.indexOf(d||"")+1;if(l<c.length){const w=c[l],b=`https://i.imgur.com/${u}.${w}`;s(b)}}}else{const u=["jpg","png","gif","jpeg","webp"],c=o?.split(".").pop(),g=u.indexOf(c||"")+1;if(g<u.length&&o){const l=u[g],b=`${o.replace(/\.[^.]+(\?.*)?$/,"")}.${l}`;s(b)}}};return n==="video"?f.jsx("video",{autoPlay:!0,loop:!0,muted:!0,playsInline:!0,src:o||void 0,className:"video-background",onError:i,preload:"auto",crossOrigin:"anonymous",controls:!0}):f.jsxs(f.Fragment,{children:[f.jsx("div",{className:"image-background",style:{backgroundImage:o?J(o):void 0,backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat",width:"100%",height:"100%",position:"absolute",top:0,left:0}}),f.jsx("img",{src:o||void 0,onError:r,style:{display:"none"},alt:""})]})}function K({images:e,className:n,zoomDuration:t=3e3,zoomScale:o=1.4}){const{t:s}=M(),[i,r]=p.useState(0),[a,m]=p.useState(0),[u,c]=p.useState(new Set),[d,g]=p.useState(new Set),[l,w]=p.useState(!1),b=p.useRef(null),x=p.useRef(new Map);p.useEffect(()=>{w(!1),c(new Set),g(new Set),x.current.clear(),r(0),m(0)},[e]),p.useEffect(()=>{if(e.length===0)return;const v=y=>new Promise(j=>{if(x.current.has(y)||d.has(y)){j();return}const $=new Image;$.onload=()=>{x.current.set(y,$),c(S=>{const B=new Set(S).add(y);return!l&&y===e[0]&&w(!0),B}),j()},$.onerror=()=>{g(S=>new Set(S).add(y)),j()},$.src=y});(async()=>{const y=Math.min(5,e.length),j=[];for(let $=0;$<y;$++){const S=(i+$)%e.length;j.push(v(e[S]))}await Promise.all(j)})()},[e,i,d,l]),p.useEffect(()=>{if(e.length===0||e.length===1)return;const v=()=>{b.current=window.setInterval(()=>{r(y=>(y+1)%e.length),m(y=>y+1)},t)},R=window.setTimeout(v,2e3);return()=>{window.clearTimeout(R),b.current&&(window.clearInterval(b.current),b.current=null)}},[e.length,t]),p.useEffect(()=>()=>{b.current&&(window.clearInterval(b.current),b.current=null)},[]);const I=e[i]||"",U=u.has(I)||x.current.has(I),k=d.has(I);return p.useEffect(()=>{if(k&&e.length>1&&!e.every(R=>d.has(R))){const R=(i+1)%e.length;r(R),m(y=>y+1)}},[k,i,e.length,e,d]),e.length===0?null:f.jsxs("div",{className:_("image-slideshow-container",n),"aria-hidden":!0,children:[f.jsx("div",{className:"image-slideshow-fallback"}),!l&&e.length>0&&f.jsx("div",{className:"loading-message",children:s("loadingImages")}),U&&!k&&f.jsx("div",{className:"image-slideshow-slide",style:{backgroundImage:`url(${I})`,animationDuration:`${t}ms`,"--zoom-scale":o}},a)]})}function E(e){return e.replace(/&amp;/g,"&")}const F=["r.jina.ai","api.allorigins.win/get?url=","corsproxy.io/?"],q=(e,n=0)=>{const t=F[n];if(t==="api.allorigins.win/get?url=")return`https://${t}${encodeURIComponent(e)}`;if(t==="corsproxy.io/?")return`https://${t}${encodeURIComponent(e)}`;const o=e.replace(/^https?:\/\//,""),s=e.startsWith("https://")?"https":"http";return`https://${t}/${s}://${o}`};async function X(e,n,t){const o=new Set;let s=null;const i=[m=>`https://www.reddit.com/r/${e}/top.json?limit=100&t=year&raw_json=1${m?`&after=${m}`:""}`,m=>`https://www.reddit.com/r/${e}/hot.json?limit=100&raw_json=1${m?`&after=${m}`:""}`],r=async m=>{try{const u=await fetch(m,{signal:t,credentials:"omit",mode:"cors",headers:{"User-Agent":"BlitzedOut/1.0",Accept:"application/json, text/plain, */*","Accept-Language":"en-US,en;q=0.9"}});if(u.ok){const c=await u.text();try{return JSON.parse(c)}catch{const d=c.indexOf("{"),g=c.lastIndexOf("}");if(d!==-1&&g!==-1&&g>d)try{return JSON.parse(c.slice(d,g+1))}catch{return null}return null}}}catch(u){if(u instanceof DOMException&&u.name==="AbortError")throw u}for(let u=0;u<F.length;u++)try{const c=await fetch(q(m,u),{signal:t,credentials:"omit",mode:"cors",headers:{"User-Agent":"BlitzedOut/1.0",Accept:"application/json, text/plain, */*"}});if(!c.ok)continue;const d=await c.text();let g;try{const l=JSON.parse(d);g=l.contents?JSON.parse(l.contents):l}catch{const l=d.indexOf("{"),w=d.lastIndexOf("}");if(l!==-1&&w!==-1&&w>l)try{g=JSON.parse(d.slice(l,w+1))}catch{continue}else continue}if(g)return g}catch(c){if(c instanceof DOMException&&c.name==="AbortError")throw c;continue}return null};let a=0;for(;o.size<n&&a<i.length;){s=null;for(let m=0;m<5&&o.size<n;m+=1){const u=i[a](s),c=await r(u);if(!c)break;const d=c?.data?.children??[];s=c?.data?.after??null;for(const g of d){const l=g?.data;if(!l)continue;const w=l.url_overridden_by_dest,b=l.post_hint;if(l.is_gallery&&l.media_metadata&&l.gallery_data){const I=l.gallery_data.items||[];for(const U of I){const k=l.media_metadata[U.media_id],v=k?.s?.u||k?.s?.gif||k?.s?.mp4;if(typeof v=="string"){const R=v.startsWith("http")?v:`https:${v}`;/\.(jpe?g|png|gif|webp)(\?.*)?$/i.test(R)&&o.add(E(R))}}continue}if(b==="image"&&typeof w=="string"&&/\.(jpe?g|png|gif|webp)(\?.*)?$/i.test(w)){o.add(E(w));continue}const x=l.preview?.images?.[0]?.source?.url;if(x){const I=x.startsWith("http")?x:`https:${x}`;o.add(E(I))}}if(!s)break}a+=1}return Array.from(o).slice(0,n)}async function Y(e,n){const t=e.maxImages||150;return{images:await X(e.subreddit,t,n),source:`r/${e.subreddit}`}}function O(e){try{const n=new URL(e);return/(^|\.)reddit\.com$/i.test(n.hostname)&&/\/r\//i.test(n.pathname)}catch{return!1}}function G(e){try{return new URL(e).pathname.match(/\/r\/([^/]+)/i)?.[1]??null}catch{return null}}const Q=3e5,P=new Map,L=new Map;async function ee(e,n){const t=JSON.stringify(e),o=Date.now(),s=P.get(t);if(s&&o-s.fetchedAt<Q)return s.result;const i=L.get(t);if(i)try{return await i}catch{}const r=Y(e,n).then(a=>(P.set(t,{fetchedAt:Date.now(),result:a}),a)).finally(()=>{L.delete(t)});return L.set(t,r),r}function te(e){const{t:n}=M(),[t,o]=p.useState([]),[s,i]=p.useState(!1),[r,a]=p.useState(null),[m,u]=p.useState(null),c=p.useRef(null);return p.useEffect(()=>{if(c.current&&c.current.abort(),o([]),a(null),u(null),!e||!O(e)){i(!1);return}const d=G(e);if(!d){a("invalidRedditUrl"),i(!1);return}const g={subreddit:d,maxImages:150};i(!0);const l=new AbortController;c.current=l;const w=async(x=0)=>{try{const I=await ee(g,l.signal);if(l.signal.aborted)return;o(I.images),u(I.source),a(null),i(!1)}catch{if(l.signal.aborted)return;if(x<2){const U=Math.pow(2,x)*1e3;setTimeout(()=>{l.signal.aborted||w(x+1)},U);return}a("redditBlocked"),o([]),u(null),i(!1)}},b=window.setTimeout(w,300);return()=>{l.abort(),window.clearTimeout(b)}},[e]),p.useEffect(()=>()=>{c.current&&c.current.abort()},[]),{images:t,isLoading:s,error:r?n(r):null,source:m}}function ne({url:e}){const{t:n}=M(),t=C(),{images:o,isLoading:s,error:i}=te(e);return s?f.jsxs("div",{className:"slideshow-container slideshow-loading","aria-hidden":!0,children:[f.jsx("div",{className:"image-slideshow-fallback"}),f.jsx("div",{className:"loading-message",children:n("loadingRedditImages")})]}):i?f.jsxs("div",{className:"slideshow-container slideshow-error","aria-hidden":!0,children:[f.jsx("div",{className:"image-slideshow-fallback"}),f.jsxs("div",{className:"error-message",style:{position:"absolute",bottom:"20px",right:"20px",background:T(t.palette.background.paper,.7),color:t.palette.text.primary,padding:"12px 16px",borderRadius:"8px",fontSize:"14px",maxWidth:"300px",zIndex:1e3},children:[f.jsx("strong",{children:n("redditBackgroundNote")}),f.jsx("br",{}),n("redditBlocked")]})]}):o.length===0?f.jsx("div",{className:"slideshow-container slideshow-empty","aria-hidden":!0,children:f.jsx("div",{className:"image-slideshow-fallback"})}):f.jsx(K,{images:o})}function Ue({url:e=null,isVideo:n=null}){const t=e&&/\.(mp4|webm|ogg|mov|gif)(\?.*)?$/i.test(e),o=e?O(e):!1,s=e==="color"||e==="gray"||e?.includes("/color")||e?.includes("/gray"),i=e&&!s&&(n||!n&&e),r=!n&&o&&e;return f.jsxs(D,{className:_("main-container",!i&&"default-background"),role:"presentation",sx:{backgroundImage:!n&&e&&!s&&!o?`url(${e})`:"none"},children:[n&&!o&&(t?f.jsx(W,{url:e}):f.jsx("iframe",{src:e||void 0,title:"video",allow:"autoplay; fullscreen; encrypted-media; picture-in-picture",sandbox:"allow-same-origin allow-scripts allow-presentation"})),r?f.jsx(ne,{url:e}):null]})}function oe(e){const n=/vimeo\.com\/(\d+)/,t=e.match(n);return`https://player.vimeo.com/video/${t?t[1]:""}?autoplay=1&loop=1&autostart=true`}function re(e){const n=/(?:youtube\.com\/(?:[^/]+\/.+\/|(?:v|e(?:mbed)?)\/|[^#]*[?&]v=|youtu\.be\/)([^"&?/ ]{11})|^(?:[^"&?/ ]{11})$)/,t=e.match(n);return`https://www.youtube.com/embed/${t?t[1]:""}?autoplay=1&loop=1&autostart=true&mute=1&playsinline=1&controls=0&disablekb=1&fs=0&modestbranding=1&rel=0&iv_load_policy=3`}function se(e){const n=/drive\.google\.com\/file\/d\/([^/]+)/,t=e.match(n);return`https://drive.google.com/file/d/${t?t[1]:""}/preview?loop=1`}function ie(e){const n=/dropbox\.com\/s\/([^/]+)/,t=e.match(n);return`https://www.dropbox.com/s/${t?t[1]:""}?raw=1`}function ae(e){return`https://pornhub.com/embed/${new URL(e).searchParams.get("viewkey")||""}?autoplay=1&loop=1&autostart=true&playsinline=1`}function ce(e){const n=e.split("-");return`https://xhamster.com/xembed.php?video=${n[n.length-1]}?autoplay=1&loop=1&autostart=true&playsinline=1`}function de(e){const n=/media1?\.tenor\.com\/(?:m\/)?([a-zA-Z0-9_-]+)\/[^/]*\.(mp4|gif|webp|webm)/,t=e.match(n);if(t){const i=t[2].toLowerCase();return{url:e,isVideo:["mp4","webm"].includes(i)}}const o=/tenor\.com\/view\/[^/]*-(\d+)/,s=e.match(o);return s?{url:`https://tenor.com/embed/${s[1]}`,isVideo:!0}:{url:e,isVideo:!1}}function le(e){const n=/giphy\.com\/gifs\/[^/]*-([a-zA-Z0-9]+)/,t=e.match(n);return`https://media.giphy.com/media/${t?t[1]:""}/giphy.gif`}function ue(e){return/\d+\.media\.tumblr\.com\/.*\.(gif|mp4|webm)(\?.*)?$/i.test(e),e}function me(e){const n=/(?:gfycat\.com|redgifs\.com)\/(?:watch\/)?([a-zA-Z0-9]+)/,t=e.match(n),o=t?t[1]:"";return h(e,["redgifs.com"])?`https://files.redgifs.com/${o}.mp4`:`https://giant.gfycat.com/${o}.mp4`}function pe(e){const n=/redtube\.com\/(\d+)/,t=e.match(n);return`https://embed.redtube.com/?id=${t?t[1]:""}&autoplay=true&auto_play=1&playsinline=1&controls=1`}function fe(e){const n=/youporn\.com\/watch\/(\d+)/,t=e.match(n);return`https://www.youporn.com/embed/${t?t[1]:""}?autoplay=1&playsinline=1`}function ge(e){const n=/tube8\.com\/[^/]+\/[^/]+\/(\d+)/,t=e.match(n);return`https://www.tube8.com/embed/${t?t[1]:""}?autoplay=1&playsinline=1`}function he(e){return`https://twitframe.com/show?url=${encodeURIComponent(e)}`}function we(e){try{const r=new URL(e);if((r.host==="discordapp.net"||r.host.endsWith(".discordapp.net"))&&r.pathname.startsWith("/external/")&&(r.pathname.includes("/https/i.imgur.com/")||r.pathname.includes("/https/imgur.com/")))return e}catch(r){N.debug("URL parsing failed for Discord proxy check:",r)}let n="",t=!1;try{const r=new URL(e);t=r.host==="imgur.com"||r.host==="i.imgur.com"}catch(r){return N.debug("URL parsing failed for Imgur processing:",r),""}if(!t)return"";if(e.includes("/gallery/")){const r=e.match(/imgur\.com\/gallery\/[^#]*#([a-zA-Z0-9]+)/);if(r)n=r[1];else{const a=e.match(/imgur\.com\/gallery\/.*-([a-zA-Z0-9]+)/);if(a)n=a[1];else return N.debug("Could not extract image ID from gallery URL, returning original:",e),e}}else{const r=/imgur\.com\/([a-zA-Z0-9]+)(?:\.(mp4|jpg|jpeg|png|gif|webp))?|images-ext-\d+\.discordapp\.net\/external\/[^/]+\/https\/i\.imgur\.com\/([a-zA-Z0-9]+)\.(mp4|jpg|jpeg|png|gif|webp)/,a=e.match(r);n=a?a[1]||a[3]:""}if(!n)return"";const o=e.match(/\.([a-zA-Z0-9]+)(?:\?.*)?$/);let s="jpg";if(o&&o[1]){const r=o[1].toLowerCase();["jpg","jpeg","png","gif","webp","mp4"].includes(r)&&(s=r)}return`https://i.imgur.com/${n}.${s}`}function A(e){return/\.(mp4|webm|ogg|mov)(\?.*)?$/.test(e)}function be(e){return h(e,["media.discordapp.net","cdn.discordapp.com"])&&!A(e)}function h(e,n){try{const t=new URL(e);return n.some(o=>t.host===o||t.host.endsWith("."+o))}catch(t){return N.debug("URL parsing failed in isValidHost, rejecting for security:",t),!1}}function ye(e){let n=null,t=!0;if(!e)return{url:"",isVideo:!1};switch(!0){case h(e,["vimeo.com"]):n=oe(e);break;case h(e,["youtube.com","youtu.be"]):n=re(e);break;case h(e,["drive.google.com"]):n=se(e);break;case h(e,["pornhub.com"]):n=ae(e);break;case h(e,["xhamster.com"]):n=ce(e);break;case h(e,["dropbox.com"]):n=ie(e);break;case h(e,["imgur.com","i.imgur.com"]):n=we(e);break;case h(e,["tenor.com"]):{const o=de(e);n=o.url,t=o.isVideo;break}case h(e,["giphy.com"]):n=le(e),t=!0;break;case(h(e,["tumblr.com","media.tumblr.com"])||/\d+\.media\.tumblr\.com/.test(e)):n=ue(e),t=n?A(n):!1;break;case h(e,["gfycat.com","redgifs.com"]):n=me(e),t=!0;break;case h(e,["redtube.com"]):n=pe(e);break;case h(e,["youporn.com"]):n=fe(e);break;case h(e,["tube8.com"]):n=ge(e);break;case h(e,["twitter.com","x.com"]):n=he(e),t=!1;break;case h(e,["thisvid.com"]):n=e;break;case h(e,["boyfriendtv.com"]):n=e;break;case be(e):n=e,t=!1;break;case A(e):n=e;break;default:n=H(e),t=!1;break}return{url:n,isVideo:t}}function Se(e,n){const{background:t,backgroundURL:o,roomBackgroundURL:s}=e;let i=null;return t?t==="custom"?i=o||null:t==="useRoomBackground"?!Z(n)&&s?i=s:i="color":i=t:i="color",i||(i="color"),i==="color"||i==="gray"?{url:i,isVideo:!1}:ye(i)}function xe(e){return{uid:e.uid,displayName:e.displayName,isSelf:e.isSelf,isFinished:e.isFinished}}function Ne(e){const[n,t]=p.useState(null),o=V(),s=p.useMemo(()=>o.map(r=>`${r.uid}-${r.displayName}-${r.isFinished}-${r.isSelf}`).join("|"),[o]),i=p.useMemo(()=>e?`${e.uid}-${e.displayName||""}`:null,[e]);return p.useEffect(()=>{if(!e){t(null);return}if(o.length<=1){t(null);return}const r=o.filter(d=>!d.isFinished);if(r.length<=1){t(null);return}let a=-1;a=r.findIndex(d=>d.uid===e.uid),a===-1&&(a=r.findIndex(d=>d.displayName===e.displayName)),a===-1&&(a=0);const m=(a+1)%r.length,u=r[m],c=xe(u);t(c)},[i,s]),n}export{Ue as R,Se as g,ye as p,Ne as u};
