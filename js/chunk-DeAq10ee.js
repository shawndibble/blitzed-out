const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["js/chunk-WQbaio3l.js","js/chunk-Br5bPOQU.js","js/chunk-DOZZTrKq.js","js/chunk--wdVmNJq.js","js/chunk-lKy0gUf9.js","js/chunk-C7vH9BKy.js","js/chunk-BxlihR_n.js","js/chunk-Tjtm3Awc.js","js/chunk-Dk7I1tJi.js","js/chunk-COViFSNc.js"])))=>i.map(i=>d[i]);
import{r as i,j as e,u as V,R as nt,a as A,T as j,b as ge,c as Le,d as we,M as rt,L as at}from"./chunk-Br5bPOQU.js";import{F as Pe,B as k,C as ee,T as E,u as De,a as ot,b as te,I as z,c as it,d as lt,s as pe,A as Oe,e as Ne,f as ct,g as $e,h as q,i as N,j as O,D as R,G as Re,k as Be,l as Z,m as ce,n as X,P as ut,S as dt,o as ft,p as Ce,q as mt,r as gt,M as Ue,t as _e,v as ue,w as ht,x as xt,y as pt,z as yt,E as B,H as U,J as _,K as P,L as jt,N as ze,O as he,Q as bt,R as St,U as wt,V as Ct,W as vt,X as G,Y as kt,Z as Tt,_ as It,$ as At,a0 as ve,a1 as J,a2 as Et,a3 as Mt,a4 as re,a5 as ke,a6 as Lt,a7 as Pt,a8 as Y,a9 as Dt,aa as Ot,ab as Nt,ac as $t}from"./chunk--wdVmNJq.js";import{t as F,i as Q}from"./chunk-Dk7I1tJi.js";import{c as Rt,s as me,l as Bt,a as Ut,b as _t,d as Te,r as zt,u as Ft,e as Fe,f as Ke,g as Ge,h as Kt,i as Gt,j as Wt,k as qt,m as Vt,n as xe,o as H,p as ye,q as We,t as Ht,v as Jt,w as qe,x as Yt,y as Qt,z as Zt}from"./chunk-BxlihR_n.js";import{C as Xt,a as es,u as Ie,r as ts,b as ss}from"./chunk-C7vH9BKy.js";import{c as ns,h as le,a as rs}from"./chunk-lKy0gUf9.js";import{G as as,a as os,s as is,C as ls}from"./chunk-WQbaio3l.js";import{g as cs}from"./chunk-Tjtm3Awc.js";const us="modulepreload",ds=function(t){return"/"+t},Ae={},fs=function(s,n,a){let r=Promise.resolve();if(n&&n.length>0){let d=function(u){return Promise.all(u.map(m=>Promise.resolve(m).then(f=>({status:"fulfilled",value:f}),f=>({status:"rejected",reason:f}))))};document.getElementsByTagName("link");const l=document.querySelector("meta[property=csp-nonce]"),c=l?.nonce||l?.getAttribute("nonce");r=d(n.map(u=>{if(u=ds(u),u in Ae)return;Ae[u]=!0;const m=u.endsWith(".css"),f=m?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${u}"]${f}`))return;const g=document.createElement("link");if(g.rel=m?"stylesheet":us,m||(g.as="script"),g.crossOrigin="",g.href=u,c&&g.setAttribute("nonce",c),document.head.appendChild(g),m)return new Promise((x,h)=>{g.addEventListener("load",x),g.addEventListener("error",()=>h(new Error(`Unable to preload CSS for ${u}`)))})}))}function o(l){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=l,window.dispatchEvent(c),!c.defaultPrevented)throw l}return r.then(l=>{for(const c of l||[])c.status==="rejected"&&o(c.reason);return s().catch(o)})},je=i.createContext(void 0);function pn(t){const[s,n]=i.useState(null),[a,r]=i.useState(!1),[o,l]=i.useState(!0),[c,d]=i.useState(null),[u,m]=i.useState({syncing:!1,lastSync:null}),f=i.useRef(null),g=i.useRef(!1),x=i.useCallback(async b=>{if(f.current&&(clearTimeout(f.current),f.current=null),!s||s.isAnonymous)return!1;try{return m({syncing:!0,lastSync:u.lastSync}),await b(),m({syncing:!1,lastSync:new Date}),!0}catch(C){return console.error("Sync error:",C),C instanceof Error?d(C.message):d("An unknown error occurred"),m({syncing:!1,lastSync:u.lastSync}),!1}},[s,f,m,u.lastSync,d]);async function h(b=""){try{const C=await Kt(b);return n(C),C}catch(C){throw d(C.message),C}}async function y(b,C){try{r(!0);const I=await Ge(b,C);return n(I),I}catch(I){throw I instanceof Error&&d(I.message),I}finally{r(!1)}}async function S(){try{r(!0);const b=await Ke();return n(b),b}catch(b){throw b instanceof Error&&d(b.message),b}finally{r(!1)}}async function p(b,C,I){try{r(!0);const $=await Fe(b,C,I);return n($),$}catch($){throw $ instanceof Error&&d($.message),$}finally{r(!1)}}async function v(b){try{return await zt(b),!0}catch(C){throw C instanceof Error&&d(C.message),C}}const M=i.useCallback(async(b,C)=>{try{r(!0);const I=await Rt(b,C);return n(I),await x(me),I}catch(I){throw I instanceof Error&&d(I.message),I}finally{r(!1)}},[r,n,x,d]);async function D(b=""){try{const C=await Ft(b);return n(C),C}catch(C){throw C instanceof Error&&d(C.message),C}}const w=i.useCallback(async()=>{try{if(s&&!s.isAnonymous){const b=x(me),C=new Promise(I=>setTimeout(I,5e3,!1));await Promise.race([b,C])}await Bt(),n(null)}catch(b){throw b instanceof Error&&d(b.message),b}},[s,x,n,d]),T=i.useCallback(async()=>x(me),[x]);i.useEffect(()=>{const C=cs().onAuthStateChanged(I=>{if(n(I||null),g.current||(g.current=!0,l(!1)),I&&!I.isAnonymous){const $=()=>{f.current&&clearTimeout(f.current),f.current=setTimeout(()=>{m({syncing:!0,lastSync:null}),Ut().then(()=>{m({syncing:!1,lastSync:new Date}),_t()}).catch(st=>{console.error("Error syncing from Firebase:",st),m({syncing:!1,lastSync:null})}).finally(()=>{f.current=null})},1e3)};typeof window<"u"&&"requestIdleCallback"in window?window.requestIdleCallback($,{timeout:5e3}):setTimeout($,100)}else Te()});return window.authContext={user:null},()=>{C(),f.current&&clearTimeout(f.current),Te(),window.authContext=void 0}},[]),i.useEffect(()=>{window.authContext&&(window.authContext.user=s)},[s]);const L=i.useMemo(()=>({user:s,loading:a,initializing:o,error:c,syncStatus:u,login:h,loginEmail:y,loginGoogle:S,register:p,updateUser:D,forgotPassword:v,convertToRegistered:M,logout:w,syncData:T,isAnonymous:s?.isAnonymous||!1}),[s,a,o,c,u,M,w,T]);return e.jsx(je.Provider,{value:L,...t})}function yn(t){return t.sort((s,n)=>s.timestamp.toDate().getTime()-n.timestamp.toDate().getTime())}function de(t){return JSON.parse(JSON.stringify(t)).reverse()}function be(t,s){return de(t).find(n=>n.type===s)}function ms(t,s,n="ASC"){let a=de(t);return n==="DESC"&&(a=a.reverse()),a.filter(r=>r.type===s)}function gs(t,s){return de(t).find(s)}function hs(t){return de(t)[0]}function xs(t){if(!t)return null;try{if(typeof t.toDate=="function")return t.toDate();if(typeof t=="string"){const s=new Date(t);if(isNaN(s.getTime()))throw new Error("Invalid serialized timestamp format");return s}else if(typeof t=="number"){const s=t<3250368e4?t*1e3:t,n=new Date(s);if(isNaN(n.getTime()))throw new Error("Invalid numeric timestamp format");return n}else if(typeof t=="object"&&t.seconds!==void 0){const s=t,n=new Date(s.seconds*1e3+(s.nanoseconds||0)/1e6);if(isNaN(n.getTime()))throw new Error("Invalid Firestore timestamp object format");return n}else{if(t instanceof Date)return t;throw console.warn("Unsupported timestamp format:",typeof t,t),new Error(`Unsupported timestamp format: ${typeof t}`)}}catch(s){return console.warn("Failed to parse timestamp:",s),null}}const Ve=i.createContext(void 0);function jn(t){const{id:s}=V(),{messages:n,loading:a,loadMessages:r,setLoading:o,setRoom:l,clearMessages:c}=Gt();i.useEffect(()=>{if(o(!0),l(s||null),!s){c();return}return Wt(s,u=>{r(u)})},[s,r,o,l,c]);const d={messages:n,isLoading:a};return e.jsx(Ve.Provider,{value:d,...t})}const He=i.createContext(void 0);function bn(t){const{id:s}=V(),{onlineUsers:n,setUsers:a,setRoom:r,clearUsers:o,flushPendingUpdates:l}=qt(),c=i.useRef(null),d=i.useRef(s),u=i.useCallback(g=>{g===null?o():a(g)},[a,o]),m=i.useCallback(()=>{c.current&&(c.current(),c.current=null),l()},[l]);i.useEffect(()=>{if(d.current!==s&&(r(s||null),d.current=s),!s){m(),o();return}return m(),Vt(s,u),c.current=null,m},[s,r,o,u,m]),i.useEffect(()=>m,[m]);const f=i.useMemo(()=>({onlineUsers:n}),[n]);return e.jsx(He.Provider,{value:f,...t})}function Sn(){return e.jsx(Pe,{in:!0,timeout:300,children:e.jsxs(k,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100vh",width:"100vw",backgroundColor:"#0f172a",color:"#f8fafc",position:"fixed",top:0,left:0,zIndex:9999},children:[e.jsx(ee,{size:60,thickness:4,sx:{color:"#4f46e5",mb:3}}),e.jsx(E,{variant:"h6",sx:{opacity:.8,fontWeight:400,letterSpacing:"0.02em"},children:"Loading..."})]})})}function se(){const t=i.useContext(je);if(t===void 0)throw new Error("useAuth must be used within an AuthProvider");return t}function fe(t="sm"){const s=De();return ot(s.breakpoints.down(t))}function ne(){const t=nt.useContext(Ve);if(!t)throw new Error("MessagesContext's value is undefined.");return t}function ps(){const t=i.useContext(He);if(!t)throw new Error("UserListContext's value is undefined.");return t}function ys(t){const s=ms(t,"actions","DESC");return[...new Map(s.map(n=>[n.uid,n])).values()]}function js(t){if(!t||Object.keys(t).length===0)return!1;const n=Object.values(t);if(n.length===0)return!1;const a=n.sort((r,o)=>o.lastActive-r.lastActive)[0];return a&&Date.now()-a.lastActive<3e5}function bs(t,s){if(!t||t.length===0||!s)return!1;const n=600*1e3,a=t.sort((r,o)=>o.timestamp.toMillis()-r.timestamp.toMillis()).find(r=>r.uid===s)?.timestamp.toMillis();return a?Date.now()-a<n:!1}function Ss(){const{user:t}=se(),{messages:s,isLoading:n}=ne(),{onlineUsers:a}=ps(),r=i.useCallback((l,c,d,u)=>{if(u||!l||!c)return[];const m=ys(d);return Object.entries(l).filter(([f,g])=>{const x=f===c?.uid;return js(g)||bs(d,f)||x}).map(([f,g])=>{if(!g||Object.keys(g).length===0)return{displayName:"Unknown",uid:f,isSelf:f===c?.uid,location:0,isFinished:!1};const x=Object.values(g),h=x.length>0?x.sort((w,T)=>T.lastActive-w.lastActive)[0]:{displayName:"Unknown"},{displayName:y="Unknown"}=h,S=m.find(w=>w.uid===f)?.text,p=/(?:#)[\d]*(?=:)/gs;let v=0;if(S&&S.match(p)){const w=S.match(p);w&&w[0]&&(v=Number(w[0].replace("#","")))}const M=v>0?v-1:v,D=!!S?.includes(F("finish"));return{displayName:y,uid:f,isSelf:f===c?.uid,location:M,isFinished:D}})},[]);return i.useMemo(()=>r(a,t,[...s],n),[r,a,t,s,n])}window.__castApiInitialized=window.__castApiInitialized||!1;function wn(){const[t,s]=i.useState(!1),[n,a]=i.useState(null),{id:r}=V(),o=i.useRef(null),[l,c]=i.useState(!1),d=i.useCallback(m=>{try{const f=`${window.location.origin}/${r}/cast`;console.log("Sending cast message with URL:",f),m.sendMessage("urn:x-cast:com.blitzedout.app",{type:"LOAD",url:f})}catch(f){console.error("Error sending cast message:",f)}},[r]);i.useEffect(()=>{const m=()=>{try{if(!window?.cast?.framework)return;if(window.__castApiInitialized){c(!0),f();return}window.cast.framework.CastContext.getInstance().setOptions({receiverApplicationId:"1227B8DE",autoJoinPolicy:window.chrome?.cast?.AutoJoinPolicy?.ORIGIN_SCOPED}),window.__castApiInitialized=!0,c(!0),f()}catch(g){console.error("Error initializing Cast API:",g)}},f=()=>{try{const g=window.cast?.framework?.CastContext.getInstance();if(!g)return;const x=g.getCurrentSession();if(x&&(s(!0),a(x),r&&d(x)),!window?.cast?.framework)return;g.addEventListener(window.cast.framework.CastContextEventType.SESSION_STATE_CHANGED,h=>{const y=g.getCurrentSession();switch(h.sessionState){case window.cast?.framework?.SessionState.SESSION_STARTED:case window.cast?.framework?.SessionState.SESSION_RESUMED:s(!0),a(y),y&&r&&d(y);break;case window.cast?.framework?.SessionState.SESSION_ENDED:s(!1),a(null);break;default:break}})}catch(g){console.error("Error setting up session listener:",g)}};if(window.chrome&&window.chrome.cast&&window.cast)m();else if(window.__onGCastApiAvailable=function(g){g&&m()},!document.querySelector('script[src*="cast_sender.js"]')){const g=document.createElement("script");g.src="https://www.gstatic.com/cv/js/sender/v1/cast_sender.js?loadCastFramework=1",document.head.appendChild(g)}return()=>{}},[r,d]);const u=()=>{if(l)if(t)n&&n.endSession(!0);else try{const m=window.cast?.framework?.CastContext.getInstance();m&&m.requestSession().then(()=>console.log("Cast session requested successfully"),f=>console.error("Error requesting cast session:",f))}catch(m){console.error("Error requesting cast session:",m)}};return i.useEffect(()=>{t&&n&&r&&d(n)},[r,t,n,d]),l?e.jsx(te,{title:t?F("stopCasting"):F("startCasting"),children:e.jsx(z,{ref:o,onClick:u,color:t?"primary":"default",children:t?e.jsx(it,{}):e.jsx(lt,{})})}):null}function ws(t){const s=t?.replace(/([A-Z])/g," $1").trim();return s?s.charAt(0).toUpperCase()+s.slice(1):""}function ae(t){return{id:`simple-tab-${t}`,"aria-controls":`simple-tabpanel-${t}`}}function Je(t){const s=t?.split(/\r?\n/)||[];return s[s.length-1]?.split(":")[1]}function Ye(t,s){const n=new RegExp(`\\d+\\s${s}`,"g");return t.match(n)?.filter((a,r,o)=>o.indexOf(a)===r)}function W(t){return t?.toUpperCase()==="PUBLIC"}function Cs(t){return t==="online"}const Cn=pe(t=>e.jsx(Oe,{disableGutters:!0,elevation:0,square:!0,...t}))(({theme:t})=>({border:`1px solid ${t.palette.divider}`,"&:not(:last-child)":{borderBottom:0},"&:before":{display:"none"}})),vn=pe(t=>e.jsx(Ne,{expandIcon:e.jsx(ct,{sx:{fontSize:"0.9rem"}}),...t}))(({theme:t})=>({backgroundColor:t.palette.mode==="dark"?"rgba(255, 255, 255, .05)":"rgba(0, 0, 0, .03)",flexDirection:"row-reverse","& .MuiAccordionSummary-expandIconWrapper.Mui-expanded":{transform:"rotate(90deg)"},"& .MuiAccordionSummary-content":{marginLeft:t.spacing(1)}})),kn=pe($e)(({theme:t})=>({padding:t.spacing(2),borderTop:"1px solid rgba(0, 0, 0, .125)"}));function vs({onSuccess:t,onSwitchToRegister:s,onSwitchToForgotPassword:n,isLinking:a=!1}){const{t:r}=A(),[o,l]=i.useState(""),[c,d]=i.useState(""),[u,m]=i.useState(""),[f,g]=i.useState(!1),x=async h=>{h.preventDefault(),m(""),g(!0);try{await Ge(o,c),t&&t()}catch(y){console.error("Login error:",y),m(y.message||"Failed to sign in")}finally{g(!1)}};return e.jsxs(k,{component:"form",onSubmit:x,sx:{mt:1},children:[u&&e.jsx(q,{severity:"error",sx:{mb:2},children:u}),e.jsx(N,{margin:"normal",required:!0,fullWidth:!0,id:"email",label:r("email"),name:"email",autoComplete:"email",autoFocus:!0,value:o,onChange:h=>l(h.target.value)}),e.jsx(N,{margin:"normal",required:!0,fullWidth:!0,name:"password",label:r("password"),type:"password",id:"password",autoComplete:"current-password",value:c,onChange:h=>d(h.target.value)}),e.jsx(O,{type:"submit",fullWidth:!0,variant:"contained",sx:{mt:3,mb:2},disabled:f,children:f?e.jsx(ee,{size:24}):a?e.jsx(j,{i18nKey:"linkAccount",children:"Link Account"}):e.jsx(j,{i18nKey:"signIn"})}),e.jsxs(E,{align:"center",children:[e.jsx(O,{onClick:s,variant:"text",children:e.jsx(j,{i18nKey:"needAccount"})})," | ",e.jsx(O,{onClick:n,variant:"text",children:e.jsx(j,{i18nKey:"forgotPassword"})})]})]})}function ks({onSuccess:t,onSwitchToLogin:s,isAnonymous:n=!1}){const{t:a}=A(),[r,o]=i.useState(""),[l,c]=i.useState(""),[d,u]=i.useState(""),[m,f]=i.useState(""),[g,x]=i.useState(""),[h,y]=i.useState(!1),S=async p=>{if(p.preventDefault(),x(""),d!==m){x(a("passwordsDoNotMatch")||"Passwords do not match");return}y(!0);try{await Fe(l?.trim(),d,r?.trim()),t&&t()}catch(v){console.error("Registration error:",v),x(v.message||"Failed to create account")}finally{y(!1)}};return e.jsxs(k,{component:"form",onSubmit:S,sx:{mt:1},children:[g&&e.jsx(q,{severity:"error",sx:{mb:2},children:g}),e.jsx(N,{margin:"normal",required:!0,fullWidth:!0,id:"displayName",label:a("displayName"),name:"displayName",autoComplete:"name",autoFocus:!0,value:r,onChange:p=>o(p.target.value)}),e.jsx(N,{margin:"normal",required:!0,fullWidth:!0,id:"email",label:a("email"),name:"email",autoComplete:"email",value:l,onChange:p=>c(p.target.value)}),e.jsx(N,{margin:"normal",required:!0,fullWidth:!0,name:"password",label:a("password"),type:"password",id:"password",autoComplete:"new-password",value:d,onChange:p=>u(p.target.value)}),e.jsx(N,{margin:"normal",required:!0,fullWidth:!0,name:"confirmPassword",label:a("confirmPassword"),type:"password",id:"confirmPassword",autoComplete:"new-password",value:m,onChange:p=>f(p.target.value)}),e.jsx(O,{type:"submit",fullWidth:!0,variant:"contained",sx:{mt:3,mb:2},disabled:h,children:h?e.jsx(ee,{size:24}):n?e.jsx(j,{i18nKey:"linkAccount"}):e.jsx(j,{i18nKey:"createAccount"})}),e.jsx(E,{align:"center",children:e.jsx(O,{onClick:s,variant:"text",children:e.jsx(j,{i18nKey:"alreadyHaveAccount"})})})]})}function Ts({onSuccess:t,isLinking:s=!1}){const[n,a]=i.useState(""),[r,o]=i.useState(!1),l=async()=>{a(""),o(!0);try{await Ke(),t&&t()}catch(c){a(c.message||"Failed to sign in with Google")}finally{o(!1)}};return e.jsxs(k,{sx:{mt:2,mb:2},children:[n&&e.jsx(q,{severity:"error",sx:{mb:2},children:n}),e.jsx(R,{sx:{mb:2},children:e.jsx(E,{variant:"body2",color:"text.secondary",children:e.jsx(j,{i18nKey:"or",children:"OR"})})}),e.jsx(O,{fullWidth:!0,variant:"outlined",startIcon:e.jsx(Re,{}),onClick:l,disabled:r,sx:{mb:1},"aria-busy":r,"aria-live":"polite",children:r?e.jsx(ee,{size:24}):s?F("linkWithGoogle","Link with Google"):F("signInWithGoogle","Sign in with Google")})]})}function Qe(){const t=i.useContext(je);if(t===void 0)throw new Error("useAuth must be used within an AuthProvider");return t}function K({close:t}){return e.jsx(z,{"aria-label":"close",onClick:t,sx:{position:"absolute",right:8,top:8},children:e.jsx(Be,{})})}function Is({children:t,open:s,close:n=null,isMobile:a=null,title:r=null,isLoading:o=!1}){const l=fe(),c=a!==null?a:l;return o?null:e.jsxs(Z,{fullScreen:c,open:s,maxWidth:"md",children:[e.jsxs(ce,{children:[r,typeof n=="function"&&e.jsx(K,{close:n})]}),e.jsx(X,{children:t})]})}function As({onToggleForm:t}){const[s,n]=i.useState(""),[a,r]=i.useState(""),[o,l]=i.useState(!1),[c,d]=i.useState(!1),{forgotPassword:u}=Qe(),m=async f=>{f.preventDefault(),r(""),l(!1),d(!0);try{await u(s),l(!0)}catch(g){r(g.message||"Failed to send reset email")}finally{d(!1)}};return e.jsxs(k,{component:"form",onSubmit:m,sx:{mt:1},children:[a&&e.jsx(q,{severity:"error",sx:{mb:2},children:a}),o&&e.jsx(q,{severity:"success",sx:{mb:2},children:e.jsx(j,{i18nKey:"resetEmailSent"})}),e.jsx(N,{margin:"normal",required:!0,fullWidth:!0,id:"email",label:e.jsx(j,{i18nKey:"email"}),name:"email",autoComplete:"email",autoFocus:!0,value:s,onChange:f=>n(f.target.value)}),e.jsx(O,{type:"submit",fullWidth:!0,variant:"contained",sx:{mt:3,mb:2},disabled:c,children:c?e.jsx(ee,{size:24}):e.jsx(j,{i18nKey:"sendResetLink"})}),e.jsx(k,{sx:{textAlign:"center"},children:e.jsx(O,{variant:"text",onClick:()=>t("login"),children:e.jsx(j,{i18nKey:"backToLogin"})})})]})}function Tn({open:t,close:s,initialView:n="login"}){const[a,r]=i.useState(n),{isAnonymous:o}=Qe(),{t:l}=A(),c=()=>{switch(a){case"login":return l(o?"linkAccount":"signIn");case"register":return l("createAccount");case"reset":return l("resetPassword");default:return l("Authentication")}};return e.jsxs(Is,{title:c(),open:t,close:s,children:[a==="login"&&e.jsxs(e.Fragment,{children:[e.jsx(vs,{onSwitchToRegister:()=>r("register"),onSwitchToForgotPassword:()=>r("reset"),onSuccess:s,isLinking:o}),e.jsx(Ts,{onSuccess:s,isLinking:o})]}),a==="reset"&&e.jsx(As,{onToggleForm:r}),a==="register"&&e.jsx(ks,{onSwitchToLogin:()=>r("login"),onSuccess:s,isAnonymous:o})]})}function Se({children:t,open:s,close:n,type:a="error",hideCloseButton:r=!1,vertical:o="bottom",horizontal:l="center",disableAutoHide:c=!1}){const{t:d}=A(),u=(f,g)=>{g!=="clickaway"&&n()},m=!r&&e.jsx(z,{size:"small","aria-label":d("close"),color:"inherit",onClick:u,children:e.jsx(Be,{fontSize:"small"})});return e.jsx(ut,{children:e.jsx(dt,{open:s,autoHideDuration:c?6e4:4e3,onClose:u,action:m,anchorOrigin:{vertical:o,horizontal:l},TransitionComponent:ft,children:e.jsx(q,{onClose:r?void 0:u,severity:a,sx:{width:"100%"},children:t})})})}function Es(t,s){const n=t.findIndex(r=>r.uid===s);if(n===-1||t.length===0)return null;const a=n+1>=t.length?0:n+1;return t[a]}function Ze(t){const[s,n]=i.useState(null),a=Ss();return i.useEffect(()=>{if(!t)return;if(a.length<=1){n(null);return}const r=a.filter(l=>!l.isFinished),o=Es(r,t.uid);n(o)},[t,a]),s}function In({url:t=null,isVideo:s=null}){const n=t&&/\.(mp4|webm|ogg|mov)(\?.*)?$/i.test(t);return e.jsx(k,{className:"main-container",role:"presentation",sx:{backgroundImage:!s&&t?`url(${t})`:"none"},children:s&&(n?e.jsx("video",{autoPlay:!0,loop:!0,muted:!0,playsInline:!0,src:t||void 0,className:"video-background"}):e.jsx("iframe",{width:"100%",height:"100%",src:t||void 0,title:"video",allowFullScreen:!0,allow:"autoplay",style:{border:0}}))})}const Ms=t=>{const s=t.length-22;return 4*Math.ceil(s/3)*.5624896334383812/1e6};function Ls({room:t,isTransparent:s}){const{user:n}=se(),[a,r]=i.useState(""),[o,l]=i.useState(""),{t:c}=A(),d=f=>{r(f.target.value)},u=f=>{f.preventDefault(),xe({room:t,user:n,text:a,type:"chat"}),r("")},m=async()=>{let f="";try{f=await Xt.getPhoto({quality:90,allowEditing:!0,resultType:es.Base64})}catch{return""}return f.base64String&&Ms(f.base64String)>5?l("File too large! Max size is 5MB. If you need to send a larger file, please use a link from another site."):xe({room:t,user:n,type:"media",image:f})};return e.jsxs(e.Fragment,{children:[e.jsx("form",{onSubmit:u,className:`message-input-container ${s?"transparent":""}`,children:e.jsx(N,{multiline:!0,placeholder:c("messageInput"),fullWidth:!0,value:a,onChange:d,onKeyDown:f=>{f.key==="Enter"&&!f.shiftKey&&(f.preventDefault(),u(f))},required:!0,inputProps:{minLength:1},InputProps:{startAdornment:e.jsx(Ce,{position:"start",children:e.jsx(z,{type:"button",color:"primary",onClick:m,children:e.jsx(gt,{})})}),endAdornment:e.jsx(Ce,{position:"end",children:e.jsx(z,{type:"submit",color:"primary",disabled:a.length<1,children:e.jsx(mt,{})})})},helperText:e.jsx(j,{i18nKey:"markdown"})})}),e.jsx(Se,{open:!!o,close:()=>l(""),children:o})]})}const An=Object.freeze(Object.defineProperty({__proto__:null,default:Ls},Symbol.toStringTag,{value:"Module"}));function Xe(t,s=!0){const[n,a]=i.useState(t),[r,o]=i.useState(s),l=i.useCallback(()=>o(c=>!c),[]);return i.useEffect(()=>{if(n===-1&&a(0),n<=0||r)return;const c=setInterval(()=>{a(d=>d-1)},1e3);return()=>clearInterval(c)},[n,r]),{timeLeft:n,setTimeLeft:a,togglePause:l,isPaused:r}}const Ps=()=>({position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:180,bgcolor:"background.paper",border:"2px solid #000",boxShadow:24,p:2,textAlign:"right"});function et({textString:t,preventParentClose:s,noPadding:n=!1}){const[a,r]=i.useState(!1),[o,l]=t.split(" "),{timeLeft:c,setTimeLeft:d,togglePause:u,isPaused:m}=Xe(parseInt(o),!0);i.useEffect(()=>u(),[u]);const f=()=>{s(),r(!0),d(parseInt(o)),m&&u()},g=i.useRef(void 0);i.useEffect(()=>(a&&(g.current=setTimeout(()=>r(!1),parseInt(o)*1e3)),()=>{g.current&&clearTimeout(g.current)}),[a,o]);const x=()=>{g.current&&clearTimeout(g.current),r(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(O,{onClick:f,sx:{p:n?0:1},color:"secondary",children:t}),e.jsx(Ue,{open:a,onClose:x,slots:{backdrop:_e},slotProps:{backdrop:{timeout:500}},children:e.jsxs(k,{sx:Ps,children:[e.jsx(K,{close:x}),e.jsx(E,{variant:"h2",sx:{display:"inline-block"},children:c}),e.jsx(E,{sx:{ml:2,display:"inline-block"},children:l})]})})]})}function oe({children:t,title:s,onClick:n,disabled:a}){return e.jsx(ue,{size:{xs:12,sm:6},container:!0,children:e.jsx(ht,{sx:{width:"100%"},children:e.jsx(xt,{sx:{height:"100%",display:"inline-flex",alignItems:"flex-start",justifyContent:"flex-start"},onClick:n,disabled:a,children:e.jsxs(pt,{sx:{width:"100%",color:a?"gray":"white"},children:[e.jsx(E,{variant:"h5",children:s}),e.jsx(R,{sx:{mb:2}}),t]})})})})}function Ds(){const t=ge(qe),[s,n]=H(),{i18n:a}=A(),r=i.useCallback(async o=>{const l=o?.roomUpdate||o?.boardUpdated?o:{...s,...o};let{gameMode:c,boardUpdated:d}=l;const{roomTileCount:u=40,finishRange:m,room:f}=l,g=W(f||"");if(!o||!m)return{gameMode:c};g&&!Cs(c||"")&&(c="online",d=!0);const x=await ye(a.resolvedLanguage,c||"online"),h=g?40:u||40,y=await We(c||"online"),S=Ht(l,x,y,h);return(o?.boardUpdated||d||t?.tiles?.length!==S.length)&&(await n(l),await Jt({title:t?.title||"",tiles:S})),{settingsBoardUpdated:d,gameMode:c,newBoard:S}},[t,a.resolvedLanguage,s,n]);return i.useCallback(o=>r(o),[r])}function Os(){const{t}=A(),{id:s}=V(),{user:n}=se();return i.useCallback(async()=>{const r=`${t("restartingGame")}
#1: ${t("start")}
${t("action")}: ${t("start")}`;await xe({room:s,user:n,text:r,type:"actions"})},[s,n,t])}function En({children:t,value:s,index:n,style:a,...r}){return e.jsx("div",{role:"tabpanel",hidden:s!==n,id:`simple-tabpanel-${n}`,"aria-labelledby":`simple-tab-${n}`,...r,children:s===n&&e.jsx(k,{sx:{p:3,...a},children:t})})}function Ee({text:t,copiedText:s=null,icon:n=null,tooltip:a=null}){const{t:r}=A(),[o,l]=i.useState(!1),c=s||r("copied"),d=n||e.jsx(yt,{}),u=()=>{navigator.clipboard.writeText(t),l(!0)},m=()=>l(!1);return e.jsxs(e.Fragment,{children:[e.jsx(te,{title:a||r("copyToClipboard"),children:e.jsx(z,{onClick:u,children:d})}),e.jsx(Se,{open:o,close:m,type:"success",children:c})]})}function ie(t){return[...Object.entries(t).flatMap(([n,{label:a,actions:r}])=>r?Object.keys(r).filter(l=>l!=="None").map((l,c)=>({group:ws(n),groupLabel:a,value:n,intensity:Number(c+1),translatedIntensity:l,label:`${a} - ${l}`})):[]),{group:Q.t("misc"),groupLabel:Q.t("misc"),value:"misc",intensity:1,translatedIntensity:Q.t("all"),label:`${Q.t("misc")} - ${Q.t("all")}`}]}function Mn({gameMode:t,groupFilter:s,intensityFilter:n,groups:a,mappedGroups:r,onGameModeChange:o,onGroupChange:l,onIntensityChange:c,hideAll:d=!1,sx:u={}}){const{t:m}=A(),[f,g]=i.useState([]),x=d?1:"all";i.useEffect(()=>{if(a){const p=Object.keys(a);g(p)}},[a,t]);function h(p){const v=p.target.value;l(v),c(x)}if(!f?.length)return null;const y=f.length===0||f.includes(s)?s:"",S=n==="all"?"all":n;return e.jsxs(k,{sx:{display:"flex",flexWrap:"wrap",gap:2,...u},children:[e.jsxs(B,{sx:{width:125,flexShrink:0},children:[e.jsx(U,{id:"game-mode-filter-label",children:e.jsx(j,{i18nKey:"customTiles.gameMode"})}),e.jsxs(_,{labelId:"game-mode-filter-label",id:"game-mode-filter",value:t,label:m("customTiles.gameMode","Game Mode"),onChange:p=>{o(p.target.value)},slotProps:{input:{"aria-label":m("customTiles.gameMode","Game Mode")}},children:[e.jsx(P,{value:"online",children:e.jsx(j,{i18nKey:"online"})}),e.jsx(P,{value:"local",children:e.jsx(j,{i18nKey:"local"})})]})]}),e.jsxs(B,{sx:{minWidth:150,flex:1},children:[e.jsx(U,{id:"group-filter-label",children:e.jsx(j,{i18nKey:"group"})}),e.jsx(_,{labelId:"group-filter-label",id:"group-filter",value:y,label:m("group"),onChange:h,slotProps:{input:{"aria-label":m("group")}},children:f.map(p=>e.jsxs(P,{value:p,children:[r?.[t]&&Array.isArray(ie(r[t]))&&ie(r[t]).find(v=>v.value===p)?.groupLabel||p,!d&&a[p]&&` (${a[p].count})`]},p))})]}),e.jsxs(B,{sx:{minWidth:200,flex:1},disabled:!y,children:[e.jsx(U,{id:"intensity-filter-label",children:e.jsx(j,{i18nKey:"customTiles.intensityLevel",children:"Intensity Level"})}),e.jsxs(_,{labelId:"intensity-filter-label",id:"intensity-filter",value:S,label:m("customTiles.intensityLevel","Intensity Level"),onChange:p=>c(p.target.value),slotProps:{input:{"aria-label":m("customTiles.intensityLevel","Intensity Level")}},children:[!d&&e.jsx(P,{value:"all",children:e.jsx(j,{i18nKey:"all",children:"All"})},"all"),y&&a&&a[y]&&Object.entries(a[y].intensities||{}).sort(([p],[v])=>Number(p)-Number(v)).map(([p,v])=>e.jsxs(P,{value:Number(p),children:[r?.[t]&&Array.isArray(ie(r[t]))?ie(r[t]).find(M=>M.value===y&&M.intensity===Number(p))?.translatedIntensity||`Level ${p}`:`Level ${p}`,!d&&v!==void 0?` (${v})`:""]},p))]})]})]})}function Ln({formData:t,setFormData:s,backgrounds:n,isRoom:a=!1}){const{t:r}=A(),o=a?"roomBackground":"background",l=a?"roomBackgroundURL":"backgroundURL",[c,d]=i.useState(t?.[o]||Object.keys(n)[0]),u=()=>Object.entries(n).map(([g,x])=>e.jsx(P,{value:g,children:x},g)),m=g=>{s({...t,[o]:g.target.value}),d(g.target.value)};i.useEffect(()=>{c!==t?.[o]&&d(t?.[o]||"")},[t,c,o]);const f=g=>{const x={...t,[o]:"custom",[l]:g.target.value};a&&(x.roomUpdated=!0),s(x)};return e.jsxs(e.Fragment,{children:[e.jsxs(B,{fullWidth:!0,margin:"normal",children:[e.jsx(U,{id:"background-label",children:r("background")}),e.jsx(_,{labelId:"background-label",id:"background",label:r("background"),value:c||"",onChange:m,children:u()})]}),c==="custom"&&e.jsx(N,{sx:{mt:2},label:r("url"),value:t?.[l]||"",fullWidth:!0,onChange:f,helperText:e.jsxs(e.Fragment,{children:[r("supportedSites"),e.jsx("br",{}),r("requiresEmbeddedUrl")]})})]})}function Pn({trueCondition:t,onChange:s,yesLabel:n,noLabel:a=null,sx:r={}}){const o=a??n;return e.jsx(k,{sx:{display:"flex",justifyContent:"center",my:1,...r},children:e.jsx(jt,{control:e.jsx(ze,{checked:t||!1,onChange:s}),label:F(t?n:o)})})}function Dn({children:t}){return e.jsx(ue,{size:{xs:12,md:5},children:t})}const On=i.forwardRef(({value:t,onChange:s,label:n,options:a,defaultValue:r=null,sx:o,helpIcon:l=!1,fullWidth:c=!0,...d},u)=>{const m=a.map(f=>typeof f=="string"?e.jsx(P,{value:f,children:F(f)},f):e.jsx(P,{value:f.value,children:f.label},f.value));return e.jsxs(B,{fullWidth:c,margin:"normal",sx:o,...d,ref:u,children:[e.jsxs(U,{id:`${n}Label`,children:[e.jsx(j,{i18nKey:n}),!!l&&e.jsx(he,{sx:{ml:1,fontSize:16}})]}),e.jsx(_,{labelId:`${n}Label`,id:n,label:e.jsxs(e.Fragment,{children:[e.jsx(j,{i18nKey:n}),!!l&&e.jsx(he,{sx:{ml:1,fontSize:16}})]}),value:t||r||"",onChange:s,children:m})]})});function Nn({children:t,title:s,subtitle:n,defaultExpanded:a=!1,...r}){return e.jsxs(Oe,{defaultExpanded:a,...r,sx:{backgroundColor:"inherit",backgroundImage:"none",boxShadow:"none"},children:[e.jsxs(Ne,{expandIcon:e.jsx(bt,{}),sx:{px:0},children:[e.jsxs(E,{variant:"h6",sx:{width:"33%"},children:[s,":"]}),e.jsx(E,{sx:{pt:.5},children:n})]}),e.jsx($e,{sx:{px:0},children:e.jsx(ue,{container:!0,columnSpacing:2,justifyContent:"space-evenly",className:"columned-grid",children:t})})]})}function Ns(){const[t,s]=i.useState(!1);return i.useEffect(()=>{const n=window.matchMedia("(pointer: fine)");s(n.matches);const a=r=>{s(r.matches)};return n.addEventListener("change",a),()=>{n.removeEventListener("change",a)}},[]),t}function $n({actionsFolder:t,settings:s,option:n,onChange:a,initValue:r=0}){const o=`${n}label`,l=t[n]?.label,c=Ns(),[d,u]=i.useState(s[n]?.level||0),m=h=>{const y={...h,target:{...h.target,value:Number(h.target.value)}};a(y)},f=h=>{u(h)},g=h=>d>0&&h===0?!1:s.difficulty==="accelerated"?d<=2?d===h:d===h||d-1===h:d>=h;function x(h){return Object.keys(t[h]?.actions||{}).map((y,S)=>e.jsxs(P,{value:S,onMouseOver:()=>f(S),children:[!!c&&e.jsx("span",{className:"menu-item-icon",children:g(S)?e.jsx(St,{}):e.jsx(wt,{})}),y]},`${h}-${y}`))}return e.jsxs(B,{margin:"normal",fullWidth:!0,children:[e.jsx(U,{id:o,children:l}),e.jsx(_,{labelId:o,id:n,label:l,value:s[n]?.level||r,onChange:m,onOpen:()=>u(s[n]?.level||r),onClose:()=>u(s[n]?.level||r),children:x(n)})]})}function Rn({formData:t,setFormData:s}){const{id:n}=V(),{t:a}=A(),r=u=>{let m;u.target.checked&&W(n)?m=ns("123456789ABCDEFGHJKLMNPQRSTUVWXYZ",5)():n&&u.target.checked&&!W(n)?m=n:m="PUBLIC",s({...t,room:m.toUpperCase(),gameMode:W(m)?"online":t.gameMode})},o=i.useCallback(u=>{s({...t,room:u.currentTarget.value,boardUpdated:!0})},[t,s]),l=i.useCallback(u=>{u.key==="Enter"&&s({...t,room:u.currentTarget.value,boardUpdated:!0})},[t,s]),c=i.useCallback(u=>{const m=u.target.value.toUpperCase();u.target.value=m},[]),d=!W(t.room);return e.jsxs(e.Fragment,{children:[e.jsxs(Ct,{direction:"row",spacing:1,alignItems:"center",justifyContent:"center",sx:{width:"100%"},children:[e.jsx(E,{children:e.jsx(j,{i18nKey:"public"})}),e.jsx(ze,{id:"showPrivate",checked:d,onChange:r,slotProps:{input:{"aria-label":a("room")}}}),e.jsx(E,{children:e.jsx(j,{i18nKey:"private"})}),e.jsx(te,{title:e.jsx(E,{variant:"subtitle2",children:e.jsx(j,{i18nKey:"privateOptions"})}),arrow:!0,children:e.jsx(he,{sx:{fontSize:15}})})]}),d&&e.jsx(N,{fullWidth:!0,id:"privateRoom",label:"Private Room",defaultValue:t.room?.toUpperCase(),margin:"normal",onBlur:o,onKeyDown:l,onChange:c,inputProps:{style:{textTransform:"uppercase"}}})]})}function $s(t={},s={}){const[n]=H(),[a,r]=i.useState({...t,...n||{},...s}),{messages:o}=ne(),[l,c]=i.useState(!1);return i.useEffect(()=>{const d=be(o,"room");if(d?.settings)try{const u=JSON.parse(d.settings);r(m=>{if(!l)return c(!0),{...m,...u};if(Object.keys(m).some(g=>{const x=m[g];return x?.type&&["solo","foreplay","sex","consumption"].includes(x.type)})){const g=Object.keys(u).reduce((x,h)=>{const y=u[h];return(!y?.type||!["solo","foreplay","sex","consumption"].includes(y.type))&&(x[h]=y),x},{});return{...m,...g}}return{...m,...u}})}catch(u){console.error("Error parsing message settings:",u)}else l||c(!0)},[o,l]),[a,r]}function Rs(t){const{i18n:s}=A(),[n,a]=i.useState({}),[r,o]=i.useState(!0),l=i.useCallback(async()=>{if(t){o(!0);try{const c=await ye(s.resolvedLanguage,t);a(c)}catch(c){console.error("Error importing actions:",c),a({})}finally{o(!1)}}},[t,s.resolvedLanguage]);return i.useEffect(()=>{l()},[l]),{actionsList:n,isLoading:r}}function tt({isOpen:t=!1,close:s}){const{t:n}=A(),[a,r]=i.useState(!1),o=Os(),l=fe(),c=Ds(),[d,u]=H(),m=i.useCallback(()=>{o(),s()},[o,s]),f=i.useCallback(async()=>{await c({...d,boardUpdated:!0}),o(),s()},[c,d,o,s]),g=i.useCallback(async()=>{const y={...d,boardUpdated:!0,difficulty:"accelerated"};await c(y),u(y),o(),s()},[c,d,u,o,s]),x=i.useCallback(()=>{r(!0),s()},[s]),h=i.useCallback(()=>{r(!1),o()},[o]);return e.jsxs(e.Fragment,{children:[e.jsx(Z,{open:t,onClose:s,fullScreen:l,"aria-labelledby":"modal-game-over",children:e.jsxs(X,{children:[e.jsx(E,{variant:"h4",textAlign:"center",sx:{mb:2,px:2},children:e.jsx(j,{i18nKey:"gameOverPlayAgain"})}),e.jsx(K,{close:s}),e.jsxs(ue,{container:!0,spacing:2,alignItems:"stretch",children:[e.jsx(oe,{title:n("sameBoard"),onClick:m,children:e.jsx(j,{i18nKey:"sameBoardDescription"})}),e.jsx(oe,{title:n("rebuildBoard"),onClick:f,children:e.jsx(j,{i18nKey:"rebuildBoardDescription"})}),e.jsx(oe,{title:n("finalDifficulty"),onClick:g,disabled:d.difficulty==="accelerated",children:e.jsx(j,{i18nKey:"finalDifficultyDescription"})}),e.jsx(oe,{title:n("changeSettings"),onClick:x,children:e.jsx(j,{i18nKey:"changeSettingsDescription"})})]})]})}),!!a&&e.jsxs(Z,{fullScreen:l,open:a,maxWidth:"md",children:[e.jsxs(ce,{children:[e.jsx(j,{i18nKey:"gameSettings"}),e.jsx(K,{close:h})]}),e.jsx(X,{children:e.jsx(as,{closeDialog:h})})]})]})}const Bs=t=>({position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",maxWidth:800,bgcolor:"background.paper",border:"2px solid #000",boxShadow:24,p:4,[t.breakpoints.down("sm")]:{width:"90%"}});function Us({open:t,text:s="",displayName:n="",handleClose:a,stopAutoClose:r=()=>null,nextPlayer:o=null,isMyMessage:l=!1}){const{t:c}=A(),[d,u]=i.useState(!1),m=s?.match(/#\d*:.*(?=\n)/gs),f=Je(s)||"",g=Ye(s,c("seconds")),{timeLeft:x,togglePause:h}=Xe(20,!1),[y,S]=i.useState(!0),p=o?.displayName,v=i.useCallback(()=>{h(),r(),S(!1)},[h,r,S]),M=i.useCallback(()=>{v(),u(!0)},[v]),D=i.useCallback(()=>{u(!1)},[]);return e.jsxs("div",{children:[e.jsx(Ue,{"aria-labelledby":"transition-modal-title","aria-describedby":"transition-modal-description",open:t,onClose:a,slots:{backdrop:_e},slotProps:{backdrop:{timeout:500}},children:e.jsx(Pe,{in:t,children:e.jsxs(k,{sx:Bs,children:[e.jsx(E,{id:"transition-modal-title",variant:"h6",component:"h2",children:`${m} ${c("for")} ${n}`}),e.jsx(K,{close:a}),e.jsx(E,{id:"transition-modal-description",variant:"h4",sx:{mt:2},children:f}),e.jsx("br",{}),e.jsx(E,{variant:"caption",children:y?e.jsx(j,{i18nKey:"autoCloseModal",values:{timeLeft:x}}):e.jsx(j,{i18nKey:"autoCloseStopped"})}),e.jsx("br",{}),g?.length&&e.jsxs(e.Fragment,{children:[e.jsx(j,{i18nKey:"timers"}),g.map(w=>e.jsx(et,{textString:w,preventParentClose:v},w))]}),!!o&&e.jsxs(k,{textAlign:"center",children:[e.jsx(R,{style:{margin:"1rem 0 0.5rem"}}),e.jsx(E,{variant:"body1",children:o.isSelf?e.jsx(j,{i18nKey:"yourTurn"}):e.jsx(j,{i18nKey:"nextPlayersTurn",values:{player:p}})})]}),!!l&&s.includes(c("finish"))&&e.jsxs(k,{textAlign:"center",children:[e.jsx(R,{style:{margin:"1rem 0 0.5rem"}}),e.jsx(O,{onClick:M,children:e.jsx(E,{children:c("playAgain")})})]})]})})}),e.jsx(tt,{isOpen:d,close:D})]})}const _s="/audio/roll-dice-DysgIh_A.mp3",zs="/audio/message-CBVROrdp.mp3";function Fs(){const{i18n:t}=A(),{user:s}=se(),{messages:n}=ne(),[a,r]=i.useState(!1),[o]=Ie(_s),[l]=Ie(zs),[c]=H(),{playerDialog:d,othersDialog:u,mySound:m,otherSound:f,chatSound:g,readRoll:x}=c||{},h=i.useMemo(()=>[...n].pop(),[n]),y=i.useCallback((L,b)=>{L&&Yt(L,b)},[]),S=i.useMemo(()=>{if(!h?.timestamp)return!1;const L=xs(h.timestamp);return L?le(L).diff(le(),"seconds")>=-2:!1},[h]),p=i.useMemo(()=>h?.uid===s?.uid,[h,s]),v=!!(d&&p),M=!!(u&&!p),D=(p&&m||!p&&f)&&h?.type==="actions",w=p&&x&&h?.type==="actions",T=g&&h?.type==="chat";return i.useEffect(()=>{if(le.locale(t.resolvedLanguage),S&&h?.type==="actions"&&(v||M)&&r(h),S&&h){if(D&&o(),w){const L=Je(h?.text);y(L,t.resolvedLanguage||"en")}T&&l()}},[t.resolvedLanguage,h,p,v,M,D,w,T,o,l,y,S]),{message:a,setMessage:r,isMyMessage:!!p}}const Ks=()=>{const{t}=A(),{message:s,setMessage:n,isMyMessage:a}=Fs(),r=Ze(s),o=i.useRef(void 0);i.useEffect(()=>(s&&(o.current=setTimeout(()=>n(!1),21e3)),()=>{o.current&&clearTimeout(o.current)}),[s,n]);const l=i.useCallback(()=>{o.current&&clearTimeout(o.current),n(!1)},[n]),c=i.useCallback(()=>{o.current&&clearTimeout(o.current)},[]);return!s||typeof s!="object"||!s.text||s.text.includes(t("start"))?null:e.jsx(Us,{text:s?.text,displayName:s?.displayName,open:!0,handleClose:l,stopAutoClose:c,nextPlayer:r,isMyMessage:a})},Bn=Object.freeze(Object.defineProperty({__proto__:null,default:Ks},Symbol.toStringTag,{value:"Module"}));function Un(){const{messages:t}=ne(),[s,n]=i.useState(!1),a=be(t,"actions"),r=hs(t),o=Ze(a),{playerDialog:l,othersDialog:c}=H()[0];if(i.useEffect(()=>{!o||r!==a||n(!0)},[o,r,a]),!a||!o)return null;const d=o?.isSelf;return!c&&d||!l&&!d?e.jsx(Se,{open:s,close:()=>n(!1),type:d?"error":"info",vertical:"top",horizontal:"center",disableAutoHide:!0,children:d?e.jsx(j,{i18nKey:"yourTurn"}):e.jsx(j,{i18nKey:"playersTurn",values:{player:o.displayName}})}):null}function _n({children:t,justifyContent:s="space-evenly"}){return e.jsx(k,{sx:{mt:3,display:"flex",flexDirection:"row",justifyContent:s,alignItems:"center"},children:t})}function zn({onChange:t,values:s,options:n,label:a}){function r(o){return n?.find(l=>l.value===o)?.label}return e.jsxs(B,{fullWidth:!0,children:[e.jsx(U,{id:`${a}-label`,children:a}),e.jsx(_,{labelId:`${a}-label`,id:`${a}`,multiple:!0,value:s,onChange:t,fullWidth:!0,input:e.jsx(Tt,{label:e.jsx(j,{i18nKey:"actionsLabel"})}),renderValue:o=>e.jsx(k,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:o?.map(l=>e.jsx(kt,{label:r(l)},l))}),children:n?.map(({label:o,value:l})=>e.jsxs(P,{value:l,children:[e.jsx(vt,{checked:s.includes(l)}),e.jsx(G,{primary:o})]},l))})]})}function Gs({open:t,close:s}){const n=fe(),[a]=Le();return a.get("importBoard")?null:e.jsxs(Z,{fullScreen:n,open:t,maxWidth:"md",children:[e.jsxs(ce,{children:[e.jsx(j,{i18nKey:"gameSettings"}),typeof s=="function"&&e.jsx(K,{close:s})]}),e.jsx(X,{children:e.jsx(os,{close:typeof s=="function"?s:void 0})})]})}const Fn=Object.freeze(Object.defineProperty({__proto__:null,default:Gs},Symbol.toStringTag,{value:"Module"}));function Ws(t,s,n,a){if(!t&&s===40)return!0;if(!n)return!1;const{roomTileCount:r}=n;return s!==r?!1:s===a}function qs(t,s,n){const{id:a}=V(),[r,o]=i.useState(!1),{i18n:l}=A(),[c]=H(),d=ge(()=>We(c?.gameMode)),u=ge(qe),m=i.useCallback(async()=>{if(!c||n||r||!u?.tiles?.length||a===void 0)return;const f=!W(a||""),g={...c,room:a},x=be(s,"room");f&&!x&&await is(g,t),o(!0);const h=Ws(f,u.tiles.length,x,c.roomTileCount);if(!gs(s,S=>S.type==="settings"&&S.uid===t.uid)&&h){const S=await ye(l.resolvedLanguage,c.gameMode);await Qt({formData:g,user:t,customTiles:d,actionsList:S,tiles:u.tiles,title:u.title})}},[u,d,l.resolvedLanguage,n,s,a,c,r,t]);i.useEffect(()=>{m()},[m])}function Vs({room:t,id:s}){return e.jsx(te,{title:e.jsx(j,{i18nKey:"delete"}),children:e.jsx(z,{onClick:()=>Zt(t,s),"aria-label":"delete",color:"error",size:"small",sx:{p:0,ml:1},children:e.jsx(It,{fontSize:"inherit"})})})}function Hs(t,s,n){const a=t.charAt(0)==="#"?t.substring(1,7):t,r=parseInt(a.substring(0,2),16),o=parseInt(a.substring(2,4),16),l=parseInt(a.substring(4,6),16);return r*.299+o*.587+l*.114>186?n:s}function Js(t){let s=0,n;for(n=0;n<t.length;n+=1)s=t.charCodeAt(n)+((s<<5)-s);let a="#";for(n=0;n<3;n+=1){const r=s>>n*8&255;a+=`00${r.toString(16)}`.slice(-2)}return a}function Ys(t,s,n){const a=Js(s),r=n==="small"?18:24;return{sx:{bgcolor:a,width:r,height:r,fontSize:n==="small"?10:12,color:Hs(a,"#FFFFFF","#000000")},children:`${t?.split(" ")[0]?.[0]||""}${t?.split(" ")?.[1]?.[0]??""}`}}function Qs({uid:t,displayName:s,size:n}){const a=i.useMemo(()=>Ys(s,t,n),[s,t,n]);return e.jsx(te,{title:s,children:e.jsx(At,{...a,className:"player-online"})})}const Zs=i.memo(Qs);function Xs({text:t}){const{t:s}=A();return i.useMemo(()=>{const a=Ye(t,s("seconds"));let r=t;return a?.forEach(o=>{o&&(r=we(r,o,(l,c)=>e.jsx(et,{textString:o,preventParentClose:()=>null,noPadding:!0},l+c)))}),we(r,`
`,(o,l)=>e.jsx("br",{},`br${l}`))},[t,s])}const en=i.memo(Xs),Me=6e4;function tn({message:t,isOwnMessage:s,isTransparent:n,currentGameBoardSize:a=40,room:r}){const{t:o}=A(),[l,c]=i.useState(!1),d=i.useCallback(()=>{c(!1)},[]),{id:u,displayName:m,text:f,uid:g,timestamp:x,type:h}=t;let y,S,p;if(h==="settings"||h==="room"){const T=t;y=T.boardSize,S=T.gameBoardId}h==="media"&&(p=t.image);const v=h==="settings"&&y===a,M=i.useMemo(()=>{const T=x?.toDate();if(!T)return"";const L=new Date(Math.floor(T.getTime()/Me)*Me);let b=le(L).fromNow();return b==="in a few seconds"&&(b="a few seconds ago"),b},[x]),D=i.useMemo(()=>h!=="media"||!p?!1:p,[h,p]),w=i.useMemo(()=>h==="actions"||!f||f.trim()===""?null:e.jsx(rt,{remarkPlugins:[ts,ss],children:f}),[f,h]);return e.jsxs("li",{className:rs("message",s&&"own-message",n&&"transparent"),"data-testid":`message-${u}`,children:[e.jsxs("div",{className:"message-header",children:[e.jsxs("div",{className:"sender",children:[e.jsx(Zs,{uid:g,displayName:m,size:"small"}),m]}),e.jsxs("div",{className:"timestamp",children:[M,!!s&&["media","chat"].includes(h)&&u&&e.jsx(Vs,{room:r,id:u})]})]}),e.jsx(R,{sx:{mb:1}}),e.jsxs("div",{className:"message-message",children:[h==="actions"?e.jsx(en,{text:f}):w,!!D&&e.jsx("img",{src:D,alt:"uploaded by user"}),h==="settings"&&e.jsxs(e.Fragment,{children:[e.jsx(R,{sx:{my:.5}}),v?e.jsxs(k,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[e.jsx(at,{to:`?importBoard=${S}`,children:e.jsx(j,{i18nKey:"importBoard"})}),e.jsx(Ee,{text:`${window.location.href}?importBoard=${S}`,copiedText:o("copiedLink"),icon:e.jsx(ve,{})})]}):e.jsx(j,{i18nKey:"incompatibleBoard"})]}),h==="room"&&e.jsxs(k,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[e.jsxs(E,{variant:"subtitle1",children:[o("room"),": ",e.jsx("a",{href:window.location.href,children:r})]}),e.jsx(Ee,{text:window.location.href,copiedText:o("copiedLink"),icon:e.jsx(ve,{})})]}),f.includes(o("finish"))&&s&&e.jsxs(k,{textAlign:"center",children:[e.jsx(R,{sx:{mt:1}}),e.jsx(O,{onClick:()=>c(!0),children:e.jsx(E,{children:o("playAgain")})}),e.jsx(tt,{isOpen:l,close:d})]})]})]})}function sn({count:t=3}){return e.jsx(e.Fragment,{children:Array.from({length:t},(s,n)=>e.jsxs("li",{style:{padding:"16px",listStyle:"none"},children:[e.jsxs(k,{display:"flex",alignItems:"center",gap:1,mb:1,children:[e.jsx(J,{variant:"circular",width:32,height:32}),e.jsx(J,{variant:"text",width:120,height:20}),e.jsx(k,{flexGrow:1}),e.jsx(J,{variant:"text",width:80,height:16})]}),e.jsx(R,{sx:{mb:1}}),e.jsxs(k,{ml:5,children:[e.jsx(J,{variant:"text",width:"90%",height:20}),e.jsx(J,{variant:"text",width:"70%",height:20})]})]},`skeleton-${n}`))})}function nn({room:t,isTransparent:s,currentGameBoardSize:n=40}){const a=i.useRef(null),{user:r}=se(),{messages:o,isLoading:l}=ne();qs(r,o,l);const[c,d]=i.useState(0),{t:u}=A(),m=i.useMemo(()=>o.filter(g=>c===1?["settings","room"].includes(g.type):c===2?["chat","media"].includes(g.type):c===3?g.type==="actions":!0),[o,c]);i.useLayoutEffect(()=>{a.current&&(a.current.scrollTop=a.current.scrollHeight)},[m.length]);const f=i.useCallback((g,x)=>{d(x)},[]);return e.jsxs("div",{className:"message-list-container",children:[e.jsx(Et,{position:"sticky",children:e.jsxs(Mt,{variant:"fullWidth",value:c,onChange:f,"aria-label":"chat filter",className:"message-tabs",children:[e.jsx(re,{label:u("all"),...ae("all")}),e.jsx(re,{label:u("setting"),...ae("settings")}),e.jsx(re,{label:u("chat"),...ae("chat")}),e.jsx(re,{label:u("actions"),...ae("actions")})]})}),e.jsx("div",{className:"message-list-scroll",ref:a,children:e.jsx("div",{className:"message-list-scroll-content",children:e.jsx("ul",{className:"message-list",children:l&&m.length===0?e.jsx(sn,{count:5}):m.map(g=>{const x=g.uid===r.uid;return e.jsx(tn,{message:g,isOwnMessage:x,isTransparent:s,currentGameBoardSize:n,room:t},g.id)})})})})]})}const Kn=Object.freeze(Object.defineProperty({__proto__:null,default:nn},Symbol.toStringTag,{value:"Module"}));function Gn({title:t,date:s,url:n,description:a="",location:r="",baseUrl:o="https://blitzedout.com/PUBLIC",downloadIcs:l,buttonSx:c={}}){const d=De(),{t:u}=A(),[m,f]=i.useState(null),g=!!m,x=w=>{f(w.currentTarget)},h=()=>{f(null)},y=()=>t||u("calendar.gameTitle"),S=()=>{l(y(),s,n,p()),h()},p=()=>{let w=`${y()}`;return o&&(w+=`
${o}`),n&&(w+=`

${u("calendar.videoLink")}: ${n}`),a&&(w+=`

${a}`),w},v=()=>{const w=s.toISOString().replace(/-|:|\.\d+/g,""),T=new Date(s.getTime()+3600*1e3).toISOString().replace(/-|:|\.\d+/g,""),L="https://calendar.google.com/calendar/render",b=new URLSearchParams({action:"TEMPLATE",text:y(),dates:`${w}/${T}`,details:p()});return(r||n)&&b.append("location",r||n||""),`${L}?${b.toString()}`},M=()=>{const w="https://outlook.live.com/calendar/0/deeplink/compose",T=new URLSearchParams({path:"/calendar/action/compose",rru:"addevent",subject:y(),startdt:s.toISOString(),enddt:new Date(s.getTime()+36e5).toISOString(),body:p()});return(r||n)&&T.append("location",r||n||""),`${w}?${T.toString()}`},D=()=>{const w=Math.floor(s.getTime()/1e3),T=Math.floor((s.getTime()+3600*1e3)/1e3),L="https://calendar.yahoo.com/",b=new URLSearchParams({v:"60",title:y(),st:w.toString(),et:T.toString(),desc:p()});return(r||n)&&b.append("in_loc",r||n||""),`${L}?${b.toString()}`};return e.jsxs(e.Fragment,{children:[e.jsx(O,{variant:"outlined",size:"small",startIcon:e.jsx(Lt,{fontSize:"small"}),onClick:x,"aria-controls":g?"calendar-menu":void 0,"aria-haspopup":"true","aria-expanded":g?"true":void 0,sx:{borderColor:ke(d.palette.secondary.main,.3),color:d.palette.secondary.main,"&:hover":{borderColor:d.palette.secondary.main,backgroundColor:ke(d.palette.secondary.main,.05)},...c},children:u("calendar.addToCalendar")}),e.jsxs(Pt,{id:"calendar-menu",anchorEl:m,open:g,onClose:h,MenuListProps:{"aria-labelledby":"calendar-button",dense:!0},children:[e.jsxs(P,{onClick:S,children:[e.jsx(Y,{children:e.jsx(Dt,{fontSize:"small"})}),e.jsx(G,{children:u("calendar.downloadIcs")})]}),e.jsxs(P,{component:"a",href:v(),target:"_blank",rel:"noopener noreferrer",onClick:h,children:[e.jsx(Y,{children:e.jsx(Re,{fontSize:"small"})}),e.jsx(G,{children:u("calendar.googleCalendar")})]}),e.jsxs(P,{component:"a",href:M(),target:"_blank",rel:"noopener noreferrer",onClick:h,children:[e.jsx(Y,{children:e.jsx(Ot,{fontSize:"small"})}),e.jsx(G,{children:u("calendar.outlookCalendar")})]}),e.jsxs(P,{component:"a",href:D(),target:"_blank",rel:"noopener noreferrer",onClick:h,children:[e.jsx(Y,{children:e.jsx(Nt,{fontSize:"small"})}),e.jsx(G,{children:u("calendar.yahooCalendar")})]}),e.jsxs(P,{onClick:S,children:[e.jsx(Y,{children:e.jsx($t,{fontSize:"small"})}),e.jsx(G,{children:u("calendar.appleCalendar")})]})]})]})}const rn=(t,s,n,a)=>{const r=new Date(s.getTime()+36e5),o=u=>u.toISOString().replace(/-|:|\.\d+/g,"").slice(0,15)+"Z",l=o(s),c=o(r);let d=["BEGIN:VCALENDAR","VERSION:2.0","CALSCALE:GREGORIAN","METHOD:PUBLISH","BEGIN:VEVENT",`DTSTART:${l}`,`DTEND:${c}`,`SUMMARY:${t}`,`DESCRIPTION:${a?.replace(/\n/g,"\\n")||t}`,"STATUS:CONFIRMED"];return n&&d.push(`URL:${n}`),d=d.concat(["END:VEVENT","END:VCALENDAR"]),d.join(`\r
`)},Wn=(t,s,n,a)=>{const r=rn(t,s,n,a),o=new Blob([r],{type:"text/calendar;charset=utf-8"}),l=document.createElement("a");l.href=URL.createObjectURL(o),l.download=`blitzed-out-game-${s.toISOString().split("T")[0]}.ics`,document.body.appendChild(l),l.click(),document.body.removeChild(l)},an=i.lazy(()=>fs(()=>import("./chunk-WQbaio3l.js").then(t=>t.d),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9])));function on({open:t,close:s,isMobile:n=!1}){const a=fe(),r=n||a,[o]=Le();return o.get("importBoard")?null:e.jsxs(Z,{fullScreen:r,open:t,maxWidth:"md",children:[e.jsxs(ce,{children:[e.jsx(j,{i18nKey:"gameSettings"}),typeof s=="function"&&e.jsx(K,{close:s})]}),e.jsx(X,{children:e.jsx(i.Suspense,{fallback:e.jsx("div",{children:"Loading..."}),children:e.jsx(an,{closeDialog:typeof s=="function"?s:void 0,initialTab:2})})})]})}const qn=Object.freeze(Object.defineProperty({__proto__:null,default:on},Symbol.toStringTag,{value:"Module"}));function ln({open:t,close:s=null}){const[n]=$s(),{isLoading:a,actionsList:r}=Rs(n?.gameMode);return a?null:e.jsx(ls,{setOpen:s||(()=>{}),boardUpdated:()=>null,actionsList:r,open:t})}const Vn=Object.freeze(Object.defineProperty({__proto__:null,default:ln},Symbol.toStringTag,{value:"Module"}));export{An as $,Cn as A,Ln as B,wn as C,Xe as D,Gs as E,Ls as F,Dn as G,Un as H,$n as I,Zs as J,Gn as K,Wn as L,zn as M,K as N,Qe as O,Ks as P,Is as Q,In as R,On as S,Se as T,je as U,Sn as V,bn as W,jn as X,Pn as Y,pn as Z,fs as _,hs as a,Bn as a0,Fn as a1,Kn as a2,qn as a3,Vn as a4,Cs as b,vn as c,kn as d,se as e,Ss as f,Tn as g,ne as h,W as i,Ze as j,ie as k,be as l,Ee as m,yn as n,ms as o,xs as p,Mn as q,Nn as r,Rn as s,Ds as t,fe as u,$s as v,Rs as w,ae as x,En as y,_n as z};
