{"version":3,"file":"getUniqueImportRecords.ts-BzBeMeWk.js","sources":["../../src/views/CustomTileDialog/ImportExport/getUniqueImportRecords.ts"],"sourcesContent":["import groupActionsFolder from '@/helpers/actionsFolder';\nimport { CustomTile, GetUniqueImportRecordsResult, AllGameModeActions } from '@/types/customTiles';\n\n/**\n * Validates the group match within each entry.\n * @param {string} entry - The entry to validate.\n * @throws Will throw an error if the entry does not contain exactly two brackets.\n */\nfunction validateGroupMatch(entry: string): void {\n  const groupMatch = entry.match(/\\[|\\]/g)?.length;\n  if (groupMatch !== 2) {\n    throw new Error('ctSeparatorError');\n  }\n}\n\n/**\n * Compares two arrays of tags to determine if they are equal.\n * @param {Array} tags1 - The first array of tags.\n * @param {Array} tags2 - The second array of tags.\n * @returns {boolean} - True if the arrays contain the same tags, false otherwise.\n */\nfunction areTagsEqual(tags1: string[] | undefined, tags2: string[] | undefined): boolean {\n  const sortedTags1 = tags1?.sort() || [];\n  const sortedTags2 = tags2?.sort() || [];\n  return JSON.stringify(sortedTags1) === JSON.stringify(sortedTags2);\n}\n\n/**\n * Parses and transforms a single tile entry into a structured object.\n * @param {string} tile - The tile entry to parse.\n * @param {Object} mappedGroups - The object of mapped groups by game mode.\n * @returns {Object} - The parsed tile as an object.\n * @throws Will throw an error if the tile cannot be parsed correctly.\n */\nfunction parseTile(tile: string, mappedGroups: AllGameModeActions): CustomTile {\n  const lines = tile.split('\\n').filter(Boolean);\n  const preGrouping = lines[0];\n  const action = lines[1];\n\n  // Extract tags if present\n  const tagLine = lines.find((line) => line.startsWith('Tags:'));\n  const tags = tagLine?.replace('Tags:', '')?.trim()?.split(', ')?.filter(Boolean) || [];\n\n  // Extract game mode if present\n  const gameModeLine = lines.find((line) => line.startsWith('GameMode:'));\n  const gameMode = gameModeLine?.replace('GameMode:', '')?.trim() || 'online';\n\n  const withoutBrackets = preGrouping.replace(/\\[|\\]/g, '');\n  const [group, intensity] = withoutBrackets.split(' - ');\n\n  // Get the appropriate groups for this game mode\n  const gameModeGroups = groupActionsFolder(\n    mappedGroups[gameMode as keyof AllGameModeActions] || {}\n  );\n\n  const appGroup = gameModeGroups.find(\n    (mapped) => mapped.translatedIntensity === intensity && mapped.group === group\n  );\n\n  if (!appGroup) {\n    throw new Error('ctGroupError');\n  }\n  if (!action) {\n    throw new Error('ctActionError');\n  }\n\n  return {\n    group: appGroup.value,\n    intensity: appGroup.intensity,\n    action,\n    tags,\n    gameMode,\n    isCustom: 1,\n  };\n}\n\n/**\n * Processes import data to identify new unique records and existing records with changed tags.\n * @param {string} importData - The import data to process.\n * @param {Array} customTiles - The array of existing custom tiles.\n * @param {Object} mappedGroups - The object of mapped groups by game mode.\n * @returns {Object} - An object containing new unique records and existing records with changed tags.\n */\nexport default function getUniqueImportRecords(\n  importData: string,\n  customTiles: CustomTile[],\n  mappedGroups: AllGameModeActions\n): GetUniqueImportRecordsResult {\n  const preArray = importData?.split('---') || [];\n  preArray.forEach(validateGroupMatch);\n\n  const result = preArray.map((tile) => parseTile(tile, mappedGroups)).filter(Boolean);\n\n  const newUniqueRecords: CustomTile[] = [];\n  const changedTagRecords: CustomTile[] = [];\n\n  result.forEach((entry) => {\n    const existingRecord = customTiles.find(\n      (existing) =>\n        existing.group === entry.group &&\n        existing.intensity === entry.intensity &&\n        existing.action === entry.action &&\n        existing.gameMode === entry.gameMode\n    );\n\n    if (!existingRecord) {\n      newUniqueRecords.push(entry);\n    } else if (existingRecord && !areTagsEqual(existingRecord.tags, entry.tags)) {\n      changedTagRecords.push({ ...existingRecord, tags: entry.tags });\n    }\n  });\n\n  return { newUniqueRecords, changedTagRecords };\n}\n"],"names":["validateGroupMatch","entry","_a","areTagsEqual","tags1","tags2","sortedTags1","sortedTags2","parseTile","tile","mappedGroups","_b","_c","_d","lines","preGrouping","action","tagLine","line","tags","gameModeLine","gameMode","withoutBrackets","group","intensity","appGroup","groupActionsFolder","mapped","getUniqueImportRecords","importData","customTiles","preArray","result","newUniqueRecords","changedTagRecords","existingRecord","existing"],"mappings":"kyBAQA,SAASA,EAAmBC,EAAqB,CARjD,IAAAC,EAUE,KADmBA,EAAAD,EAAM,MAAM,QAAQ,IAApB,KAAA,OAAAC,EAAuB,UACvB,EACjB,MAAM,IAAI,MAAM,kBAAkB,CAEtC,CAQA,SAASC,EAAaC,EAA6BC,EAAsC,CACvF,MAAMC,GAAcF,GAAA,KAAA,OAAAA,EAAO,KAAA,IAAU,CAAA,EAC/BG,GAAcF,GAAA,KAAA,OAAAA,EAAO,KAAA,IAAU,CAAA,EACrC,OAAO,KAAK,UAAUC,CAAW,IAAM,KAAK,UAAUC,CAAW,CACnE,CASA,SAASC,EAAUC,EAAcC,EAA8C,CAlC/E,IAAAR,EAAAS,EAAAC,EAAAC,EAmCE,MAAMC,EAAQL,EAAK,MAAM;AAAA,CAAI,EAAE,OAAO,OAAO,EACvCM,EAAcD,EAAM,CAAC,EACrBE,EAASF,EAAM,CAAC,EAGhBG,EAAUH,EAAM,KAAMI,GAASA,EAAK,WAAW,OAAO,CAAC,EACvDC,IAAOP,GAAAD,GAAAT,EAAAe,GAAA,KAAA,OAAAA,EAAS,QAAQ,QAAS,EAAA,IAA1B,KAAA,OAAAf,EAA+B,KAAA,IAA/B,KAAA,OAAAS,EAAuC,MAAM,IAAA,IAA7C,KAAA,OAAAC,EAAoD,OAAO,WAAY,CAAA,EAG9EQ,EAAeN,EAAM,KAAMI,GAASA,EAAK,WAAW,WAAW,CAAC,EAChEG,IAAWR,EAAAO,GAAA,KAAA,OAAAA,EAAc,QAAQ,YAAa,EAAA,IAAnC,cAAwC,KAAA,IAAU,SAE7DE,EAAkBP,EAAY,QAAQ,SAAU,EAAE,EAClD,CAACQ,EAAOC,CAAS,EAAIF,EAAgB,MAAM,KAAK,EAOhDG,EAJiBC,EACrBhB,EAAaW,CAAoC,GAAK,CAAA,CAAC,EAGzB,KAC7BM,GAAWA,EAAO,sBAAwBH,GAAaG,EAAO,QAAUJ,CAAA,EAG3E,GAAI,CAACE,EACH,MAAM,IAAI,MAAM,cAAc,EAEhC,GAAI,CAACT,EACH,MAAM,IAAI,MAAM,eAAe,EAGjC,MAAO,CACL,MAAOS,EAAS,MAChB,UAAWA,EAAS,UACpB,OAAAT,EACA,KAAAG,EACA,SAAAE,EACA,SAAU,CAAA,CAEd,CASA,SAAwBO,EACtBC,EACAC,EACApB,EAC8B,CAC9B,MAAMqB,GAAWF,GAAA,KAAA,OAAAA,EAAY,MAAM,KAAA,IAAU,CAAA,EAC7CE,EAAS,QAAQ/B,CAAkB,EAEnC,MAAMgC,EAASD,EAAS,IAAKtB,GAASD,EAAUC,EAAMC,CAAY,CAAC,EAAE,OAAO,OAAO,EAE7EuB,EAAiC,CAAA,EACjCC,EAAkC,CAAA,EAExC,OAAAF,EAAO,QAAS/B,GAAU,CACxB,MAAMkC,EAAiBL,EAAY,KAChCM,GACCA,EAAS,QAAUnC,EAAM,OACzBmC,EAAS,YAAcnC,EAAM,WAC7BmC,EAAS,SAAWnC,EAAM,QAC1BmC,EAAS,WAAanC,EAAM,QAAA,EAG3BkC,EAEMA,GAAkB,CAAChC,EAAagC,EAAe,KAAMlC,EAAM,IAAI,GACxEiC,EAAkB,KAAK,CAAE,GAAGC,EAAgB,KAAMlC,EAAM,KAAM,EAF9DgC,EAAiB,KAAKhC,CAAK,CAI/B,CAAC,EAEM,CAAE,iBAAAgC,EAAkB,kBAAAC,CAAA,CAC7B"}