import{r as g,j as h,ak as E,am as M}from"./chunk-D6lSgkQl.js";import{c as L}from"./chunk-CygiBK7d.js";import{g as O}from"./chunk-B4PEA_xj.js";import{i as B}from"./chunk-9w4Z_Sqz.js";import{l as U}from"./chunk-EL58PX5i.js";import{u as T}from"./chunk-Bho6dbO1.js";const A=e=>e&&/\.(jpe?g|png|gif|webp|bmp|svg)(\?.*)?$/i.test(e)?"image":"video";function P({url:e}){const[n,t]=g.useState(A(e)),[o,r]=g.useState(e);if(g.useEffect(()=>{r(e),t(A(e))},[e]),!o)return null;const m=()=>{const a=o??e??"";let c=!1;try{const i=new URL(a);c=i.host==="imgur.com"||i.host==="i.imgur.com"}catch{c=!1}if(c){const i=a.match(/(?:i\.)?imgur\.com\/([a-zA-Z0-9]+)(?:\.[a-z]+)?/)?.[1];if(i){const l=`https://i.imgur.com/${i}.jpg`;r(l),t("image");return}}const d=`${a.replace(/\.(mp4|webm|ogg|mov)(\?.*)?$/i,"")}.jpg`;r(d),t("image")},u=()=>{const a=o??e??"";let c=!1;try{const s=new URL(a);c=s.host==="imgur.com"||s.host==="i.imgur.com"}catch{c=!1}if(c){const s=a.match(/(?:i\.)?imgur\.com\/([a-zA-Z0-9]+)(?:\.[a-z]+)?/)?.[1];if(s){const d=["jpg","png","gif","jpeg","webp"],i=o?.split(".").pop(),p=d.indexOf(i||"")+1;if(p<d.length){const y=d[p],b=`https://i.imgur.com/${s}.${y}`;r(b)}}}else{const s=["jpg","png","gif","jpeg","webp"],d=o?.split(".").pop(),l=s.indexOf(d||"")+1;if(l<s.length&&o){const p=s[l],b=`${o.replace(/\.[^.]+(\?.*)?$/,"")}.${p}`;r(b)}}};return n==="video"?h.jsx("video",{autoPlay:!0,loop:!0,muted:!0,playsInline:!0,src:o||void 0,className:"video-background",onError:m,preload:"auto",crossOrigin:"anonymous",controls:!0}):h.jsxs(h.Fragment,{children:[h.jsx("div",{className:"image-background",style:{backgroundImage:o?`url("${String(o).replace(/\\/g,"\\\\").replace(/"/g,'\\"')}")`:void 0,backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat",width:"100%",height:"100%",position:"absolute",top:0,left:0}}),h.jsx("img",{src:o||void 0,onError:u,style:{display:"none"},alt:""})]})}function F({images:e,className:n,zoomDuration:t=3e3,zoomScale:o=1.4}){const[r,m]=g.useState(0),[u,a]=g.useState(0),c=g.useRef(null);if(g.useEffect(()=>{if(e.length===0||e.length===1)return;const d=()=>{c.current=window.setInterval(()=>{m(l=>(l+1)%e.length),a(l=>l+1)},t)},i=window.setTimeout(d,1e3);return()=>{window.clearTimeout(i),c.current&&(window.clearInterval(c.current),c.current=null)}},[e.length,t]),g.useEffect(()=>()=>{c.current&&(window.clearInterval(c.current),c.current=null)},[]),e.length===0)return null;const s=e[r];return h.jsx("div",{className:L("image-slideshow-container",n),"aria-hidden":!0,children:h.jsx("div",{className:"image-slideshow-slide",style:{backgroundImage:`url(${s})`,animationDuration:`${t}ms`,"--zoom-scale":o}},u)})}function $(e){return e.replace(/&amp;/g,"&")}const R=["r.jina.ai","api.allorigins.win/get?url=","corsproxy.io/?"],D=(e,n=0)=>{const t=R[n];return t==="api.allorigins.win/get?url="?`https://${t}${encodeURIComponent(e)}`:t==="corsproxy.io/?"?`https://${t}${encodeURIComponent(e)}`:`https://${t}/http://${e.replace(/^https?:\/\//,"")}`};async function H(e,n,t){const o=new Set;let r=null;const m=[c=>`https://www.reddit.com/r/${e}/top.json?limit=100&t=year&raw_json=1${c?`&after=${c}`:""}`,c=>`https://www.reddit.com/r/${e}/hot.json?limit=100&raw_json=1${c?`&after=${c}`:""}`],u=async c=>{try{const s=await fetch(c,{signal:t,credentials:"omit",mode:"cors",headers:{"User-Agent":"BlitzedOut/1.0 (by /u/your_username)",Accept:"application/json, text/plain, */*","Accept-Language":"en-US,en;q=0.9"}});if(s.ok){const d=await s.text();try{return JSON.parse(d)}catch{const i=d.indexOf("{"),l=d.lastIndexOf("}");if(i!==-1&&l!==-1&&l>i)try{return JSON.parse(d.slice(i,l+1))}catch{return null}return null}}}catch(s){console.warn("Direct Reddit fetch failed:",s)}for(let s=0;s<R.length;s++)try{const d=await fetch(D(c,s),{signal:t,credentials:"omit",mode:"cors",headers:{"User-Agent":"BlitzedOut/1.0 (by /u/your_username)",Accept:"application/json, text/plain, */*"}});if(!d.ok)continue;const i=await d.text();let l;try{const p=JSON.parse(i);l=p.contents?JSON.parse(p.contents):p}catch{const p=i.indexOf("{"),y=i.lastIndexOf("}");if(p!==-1&&y!==-1&&y>p)try{l=JSON.parse(i.slice(p,y+1))}catch{continue}else continue}if(l)return console.log(`Successfully fetched Reddit data using proxy service: ${R[s]}`),l}catch(d){console.warn(`Proxy service ${R[s]} failed:`,d);continue}return null};let a=0;for(;o.size<n&&a<m.length;){r=null;for(let c=0;c<5&&o.size<n;c+=1){const s=m[a](r),d=await u(s);if(!d)break;const i=d?.data?.children??[];r=d?.data?.after??null;for(const l of i){const p=l?.data;if(!p)continue;const y=p.url_overridden_by_dest,b=p.post_hint;if(p.is_gallery&&p.media_metadata&&p.gallery_data){const x=p.gallery_data.items||[];for(const v of x){const k=p.media_metadata[v.media_id],I=k?.s?.u||k?.s?.gif||k?.s?.mp4;if(typeof I=="string"){const S=I.startsWith("http")?I:`https:${I}`;/\.(jpe?g|png|gif|webp)(\?.*)?$/i.test(S)&&o.add($(S))}}continue}if(b==="image"&&typeof y=="string"&&/\.(jpe?g|png|gif|webp)(\?.*)?$/i.test(y)){o.add($(y));continue}const w=p.preview?.images?.[0]?.source?.url;if(w){const x=w.startsWith("http")?w:`https:${w}`;o.add($(x))}}if(!r)break}a+=1}return Array.from(o).slice(0,n)}async function Z(e,n){const t=e.maxImages||150;return{images:await H(e.subreddit,t,n),source:`r/${e.subreddit}`}}function _(e){try{const n=new URL(e);return/(^|\.)reddit\.com$/i.test(n.hostname)&&/\/r\//i.test(n.pathname)}catch{return!1}}function J(e){try{return new URL(e).pathname.match(/\/r\/([^/]+)/i)?.[1]??null}catch{return null}}const W=3e5,N=new Map,j=new Map;async function C(e,n){const t=JSON.stringify(e),o=Date.now(),r=N.get(t);if(r&&o-r.fetchedAt<W)return r.result;const m=j.get(t);if(m)try{return await m}catch{}const u=Z(e,n).then(a=>(N.set(t,{fetchedAt:Date.now(),result:a}),a)).finally(()=>{j.delete(t)});return j.set(t,u),u}function K(e){const[n,t]=g.useState([]),[o,r]=g.useState(!1),[m,u]=g.useState(null),[a,c]=g.useState(null),s=g.useRef(null);return g.useEffect(()=>{if(s.current&&s.current.abort(),t([]),u(null),c(null),!e||!_(e)){r(!1);return}const d=J(e);if(!d){u("Invalid Reddit URL format"),r(!1);return}const i={subreddit:d,maxImages:150};r(!0);const l=new AbortController;s.current=l;const p=async(b=0)=>{try{const w=await C(i,l.signal);if(l.signal.aborted)return;t(w.images),c(w.source),u(null)}catch(w){if(l.signal.aborted)return;if(b<2){const v=Math.pow(2,b)*1e3;console.warn(`Reddit fetch attempt ${b+1} failed, retrying in ${v}ms:`,w),setTimeout(()=>{l.signal.aborted||p(b+1)},v);return}u("Reddit blocked by browser security. Try disabling Enhanced Tracking Protection."),t([]),c(null)}finally{!l.signal.aborted&&b===0&&r(!1)}},y=window.setTimeout(p,300);return()=>{l.abort(),window.clearTimeout(y)}},[e]),g.useEffect(()=>()=>{s.current&&s.current.abort()},[]),{images:n,isLoading:o,error:m,source:a}}function V({url:e}){const{t:n}=E(),{images:t,isLoading:o,error:r}=K(e);return o?h.jsx("div",{className:"slideshow-container slideshow-loading","aria-hidden":!0,children:h.jsx("div",{className:"loading-message",children:n("loadingRedditImages")})}):r||t.length===0?r?h.jsx("div",{className:"slideshow-container slideshow-error","aria-hidden":!0,children:h.jsxs("div",{className:"error-message",style:{position:"absolute",bottom:"20px",right:"20px",background:"rgba(0,0,0,0.7)",color:"white",padding:"12px 16px",borderRadius:"8px",fontSize:"14px",maxWidth:"300px",zIndex:1e3},children:[h.jsx("strong",{children:n("redditBackgroundNote")}),h.jsx("br",{}),n("redditBlocked")]})}):null:h.jsx(F,{images:t})}function be({url:e=null,isVideo:n=null}){const t=e&&/\.(mp4|webm|ogg|mov|gif)(\?.*)?$/i.test(e),o=e?_(e):!1,r=e==="color"||e==="gray"||e?.includes("/color")||e?.includes("/gray"),m=e&&!r&&(n||!n&&e),u=!n&&o&&e;return h.jsxs(M,{className:L("main-container",!m&&"default-background"),role:"presentation",sx:{backgroundImage:!n&&e&&!r&&!o?`url(${e})`:"none"},children:[n&&!o&&(t?h.jsx(P,{url:e}):h.jsx("iframe",{width:"100%",height:"100%",src:e||void 0,title:"video",allow:"autoplay; fullscreen; encrypted-media; picture-in-picture",sandbox:"allow-same-origin allow-scripts allow-presentation",style:{border:0}})),u?h.jsx(V,{url:e}):null]})}function q(e){const n=/vimeo\.com\/(\d+)/,t=e.match(n);return`https://player.vimeo.com/video/${t?t[1]:""}?autoplay=1&loop=1&autostart=true`}function X(e){const n=/(?:youtube\.com\/(?:[^/]+\/.+\/|(?:v|e(?:mbed)?)\/|[^#]*[?&]v=|youtu\.be\/)([^"&?/ ]{11})|^(?:[^"&?/ ]{11})$)/,t=e.match(n);return`https://www.youtube.com/embed/${t?t[1]:""}?autoplay=1&loop=1&autostart=true&mute=1&playsinline=1&controls=0&disablekb=1&fs=0&modestbranding=1&rel=0&iv_load_policy=3`}function Y(e){const n=/drive\.google\.com\/file\/d\/([^/]+)/,t=e.match(n);return`https://drive.google.com/file/d/${t?t[1]:""}/preview?loop=1`}function G(e){const n=/dropbox\.com\/s\/([^/]+)/,t=e.match(n);return`https://www.dropbox.com/s/${t?t[1]:""}?raw=1`}function Q(e){return`https://pornhub.com/embed/${new URL(e).searchParams.get("viewkey")||""}?autoplay=1&loop=1&autostart=true&playsinline=1`}function ee(e){const n=e.split("-");return`https://xhamster.com/xembed.php?video=${n[n.length-1]}?autoplay=1&loop=1&autostart=true&playsinline=1`}function te(e){const n=/media\.tenor\.com\/([a-zA-Z0-9_-]+)\/[^/]*\.(mp4|gif|webp)/;if(e.match(n))return e;const o=/tenor\.com\/view\/[^/]*-(\d+)/,r=e.match(o);return`https://tenor.com/embed/${r?r[1]:""}?autoplay=1`}function ne(e){const n=/giphy\.com\/gifs\/[^/]*-([a-zA-Z0-9]+)/,t=e.match(n);return`https://media.giphy.com/media/${t?t[1]:""}/giphy.gif`}function oe(e){const n=/(?:gfycat\.com|redgifs\.com)\/(?:watch\/)?([a-zA-Z0-9]+)/,t=e.match(n),o=t?t[1]:"";return f(e,["redgifs.com"])?`https://files.redgifs.com/${o}.mp4`:`https://giant.gfycat.com/${o}.mp4`}function re(e){const n=/redtube\.com\/(\d+)/,t=e.match(n);return`https://embed.redtube.com/?id=${t?t[1]:""}&autoplay=true&auto_play=1&playsinline=1&controls=1`}function se(e){const n=/youporn\.com\/watch\/(\d+)/,t=e.match(n);return`https://www.youporn.com/embed/${t?t[1]:""}?autoplay=1&playsinline=1`}function ie(e){const n=/tube8\.com\/[^/]+\/[^/]+\/(\d+)/,t=e.match(n);return`https://www.tube8.com/embed/${t?t[1]:""}?autoplay=1&playsinline=1`}function ce(e){return`https://twitframe.com/show?url=${encodeURIComponent(e)}`}function ae(e){try{const r=new URL(e);if((r.host==="discordapp.net"||r.host.endsWith(".discordapp.net"))&&r.pathname.startsWith("/external/")&&(r.pathname.includes("/https/i.imgur.com/")||r.pathname.includes("/https/imgur.com/")))return e}catch(r){U.debug("URL parsing failed for Discord proxy check:",r)}let n="",t=!1;try{const r=new URL(e);t=r.host==="imgur.com"||r.host==="i.imgur.com"}catch(r){return U.debug("URL parsing failed for Imgur processing:",r),""}if(!t)return"";if(e.includes("/gallery/")){const r=e.match(/imgur\.com\/gallery\/[^#]*#([a-zA-Z0-9]+)/);if(r)n=r[1];else{const m=e.match(/#([a-zA-Z0-9]+)/);m&&(n=m[1])}}else{const r=/imgur\.com\/([a-zA-Z0-9]+)(?:\.(mp4|jpg|jpeg|png|gif|webp))?|images-ext-\d+\.discordapp\.net\/external\/[^/]+\/https\/i\.imgur\.com\/([a-zA-Z0-9]+)\.(mp4|jpg|jpeg|png|gif|webp)/,m=e.match(r);n=m?m[1]||m[3]:""}return`https://i.imgur.com/${n}.mp4`}function z(e){return/\.(mp4|webm|ogg|mov)(\?.*)?$/.test(e)}function de(e){return f(e,["media.discordapp.net","cdn.discordapp.com"])&&!z(e)}function f(e,n){try{const t=new URL(e);return n.some(o=>t.host===o||t.host.endsWith("."+o))}catch(t){return U.debug("URL parsing failed in isValidHost, rejecting for security:",t),!1}}function ue(e){let n=null,t=!0;if(!e)return{url:"",isVideo:!1};switch(!0){case f(e,["vimeo.com"]):n=q(e);break;case f(e,["youtube.com","youtu.be"]):n=X(e);break;case f(e,["drive.google.com"]):n=Y(e);break;case f(e,["pornhub.com"]):n=Q(e);break;case f(e,["xhamster.com"]):n=ee(e);break;case f(e,["dropbox.com"]):n=G(e);break;case f(e,["imgur.com","i.imgur.com"]):n=ae(e);break;case f(e,["tenor.com","media.tenor.com"]):n=te(e),t=!0;break;case f(e,["giphy.com"]):n=ne(e),t=!0;break;case f(e,["gfycat.com","redgifs.com"]):n=oe(e),t=!0;break;case f(e,["redtube.com"]):n=re(e);break;case f(e,["youporn.com"]):n=se(e);break;case f(e,["tube8.com"]):n=ie(e);break;case f(e,["twitter.com","x.com"]):n=ce(e),t=!1;break;case f(e,["thisvid.com"]):n=e;break;case f(e,["boyfriendtv.com"]):n=e;break;case de(e):n=e,t=!1;break;case z(e):n=e;break;default:n=O(e),t=!1;break}return{url:n,isVideo:t}}function we(e,n){const{background:t,backgroundURL:o,roomBackground:r,roomBackgroundURL:m}=e,u=(s,d)=>{if(!s)return null;if(s==="custom")return d?m||null:o||null;if(s==="useAppBackground"){const i=t||"color";return i==="useRoomBackground"?"color":i==="custom"?o||null:i}if(s==="useRoomBackground"){if(B(n))return"color";const i=r||"useAppBackground";return i==="useAppBackground"?"color":i==="custom"?m||null:i}return s};let a=null;return!B(n)&&r&&r!=="useAppBackground"?a=u(r,!0):t?a=u(t,!1):a="color",a?a==="color"||a==="gray"?{url:a,isVideo:!1}:ue(a):{url:null,isVideo:!1}}function le(e){return{uid:e.uid,displayName:e.displayName,isSelf:e.isSelf,isFinished:e.isFinished}}function xe(e){const[n,t]=g.useState(null),o=T(),r=g.useMemo(()=>o.map(u=>`${u.uid}-${u.displayName}-${u.isFinished}-${u.isSelf}`).join("|"),[o]),m=g.useMemo(()=>e?`${e.uid}-${e.displayName||""}`:null,[e]);return g.useEffect(()=>{if(!e){t(null);return}if(o.length<=1){t(null);return}const u=o.filter(i=>!i.isFinished);if(u.length<=1){t(null);return}let a=-1;a=u.findIndex(i=>i.uid===e.uid),a===-1&&(a=u.findIndex(i=>i.displayName===e.displayName)),a===-1&&(a=0);const c=(a+1)%u.length,s=u[c],d=le(s);t(d)},[m,r]),n}export{be as R,we as g,ue as p,xe as u};
