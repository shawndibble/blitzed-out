var Me=Object.defineProperty;var Ne=(n,s,t)=>s in n?Me(n,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[s]=t;var ge=(n,s,t)=>Ne(n,typeof s!="symbol"?s+"":s,t);import{ak as q,r as d,j as e,ap as _,s as Oe,am as x,aX as ve,T as g,U as B,I as le,aM as ye,M as I,aN as pe,aO as de,aq as Y,z as M,y as N,as as O,aY as Ue,aG as $,W as We,av as Fe,Y as $e,A as D,aU as Q,R as Ge,Q as z,ar as m,aP as _e,aZ as Ye,E as Se,a_ as He,az as se,au as he,aA as X,at as Ze,a1 as J,a$ as Je,ao as K,aD as Qe,aF as Xe,aE as De,aQ as xe,ad as en,$ as nn,Z as re}from"./chunk-DzAIPjqH.js";import{t as sn,o as tn,u as Ce,v as an,w as ln,d as me,r as fe,x as we,b as je,y as rn,H as W,z as Pe,B as on,F as cn,T as dn,W as un}from"./chunk-DzzEA-5n.js";import{l as hn}from"./chunk-ePhi2-8W.js";import{u as ke}from"./chunk-BmjRqaQ3.js";import{i as U,d as te,u as xn,f as ie}from"./chunk-ETJJgZWW.js";import{a as mn,u as gn}from"./chunk-QSmzoUvq.js";import{u as yn,C as pn}from"./chunk-Byb5sHui.js";import{d as fn}from"./chunk-BfMAFFX0.js";import{T as jn}from"./chunk-B9Y_S9Mk.js";import{a as bn,b as vn}from"./chunk-CMNMDYKn.js";(function(){var n=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};n.SENTRY_RELEASE={id:"b0aec1b7336667c3da787da9b7139ec106644213"}})();try{(function(){var n=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},s=new n.Error().stack;s&&(n._sentryDebugIds=n._sentryDebugIds||{},n._sentryDebugIds[s]="5d2f6394-fd34-45b4-ad20-2addf0291979",n._sentryDebugIdIdentifier="sentry-dbid-5d2f6394-fd34-45b4-ad20-2addf0291979")})()}catch{}const Te=[{id:"tritone",name:"Tri-tone",frequency:1318,type:"sine",duration:400,category:"classic",frequencies:[1318,1568,1175]},{id:"rebound",name:"Rebound",frequency:800,type:"triangle",duration:350,category:"classic"},{id:"chime",name:"Chime",frequency:1e3,type:"sine",duration:500,category:"classic",frequencies:[1e3,1200,1400]},{id:"boop",name:"Boop",frequency:600,type:"sine",duration:150,category:"classic"},{id:"breeze",name:"Breeze",frequency:400,type:"triangle",duration:600,category:"classic",frequencies:[400,500,600,500]},{id:"pong",name:"Pong",frequency:1100,type:"square",duration:200,category:"classic"},{id:"glass",name:"Glass",frequency:1800,type:"sine",duration:300,category:"classic",frequencies:[1800,1600,1400]},{id:"funk",name:"Funk",frequency:220,type:"sawtooth",duration:400,category:"classic"}],Ae=[{id:"c4",name:"C Note",frequency:261.63,type:"sine",duration:300,category:"musical"},{id:"d4",name:"D Note",frequency:293.66,type:"sine",duration:300,category:"musical"},{id:"e4",name:"E Note",frequency:329.63,type:"sine",duration:300,category:"musical"},{id:"f4",name:"F Note",frequency:349.23,type:"sine",duration:300,category:"musical"},{id:"g4",name:"G Note",frequency:392,type:"sine",duration:300,category:"musical"},{id:"ascending",name:"Ascending",frequency:261.63,type:"triangle",duration:800,category:"musical",frequencies:[261.63,293.66,329.63,349.23]},{id:"descending",name:"Descending",frequency:523.25,type:"triangle",duration:800,category:"musical",frequencies:[523.25,466.16,415.3,369.99]},{id:"chord",name:"Major Chord",frequency:261.63,type:"sine",duration:600,category:"musical",frequencies:[261.63,329.63,392]},{id:"arpeggio",name:"Arpeggio",frequency:261.63,type:"triangle",duration:1e3,category:"musical",frequencies:[261.63,329.63,392,523.25]}],Ie=[{id:"bell",name:"Bell",frequency:800,type:"sine",duration:200,category:"notification"},{id:"ding",name:"Ding",frequency:1200,type:"square",duration:150,category:"notification"},{id:"chirp",name:"Chirp",frequency:1500,type:"sine",duration:80,category:"notification"},{id:"beep",name:"Beep",frequency:600,type:"sine",duration:100,category:"notification"},{id:"tick",name:"Tick",frequency:2e3,type:"square",duration:50,category:"notification"},{id:"ping",name:"Ping",frequency:1800,type:"triangle",duration:120,category:"notification"},{id:"bubble",name:"Bubble",frequency:800,type:"sine",duration:200,category:"notification",frequencies:[800,1200]},{id:"pop",name:"Pop",frequency:1e3,type:"square",duration:80,category:"notification"}],Le=[{id:"buzz",name:"Buzz",frequency:400,type:"sawtooth",duration:250,category:"game"},{id:"whoosh",name:"Whoosh",frequency:200,type:"sawtooth",duration:500,category:"game",frequencies:[200,150,100]},{id:"bloop",name:"Bloop",frequency:300,type:"sine",duration:400,category:"game",frequencies:[300,400,350]},{id:"zap",name:"Zap",frequency:1500,type:"square",duration:120,category:"game",frequencies:[1500,1e3,500]},{id:"bounce",name:"Bounce",frequency:500,type:"triangle",duration:300,category:"game",frequencies:[500,700,600,800]},{id:"powerup",name:"Power Up",frequency:440,type:"square",duration:600,category:"game",frequencies:[440,523,659,784]},{id:"coin",name:"Coin",frequency:1046,type:"square",duration:300,category:"game",frequencies:[1046,1318]},{id:"fanfare",name:"Fanfare",frequency:523,type:"triangle",duration:1200,category:"game",frequencies:[523,659,784,1046]}],Sn=[{id:"classic",name:"Classic System Alerts",sounds:Te},{id:"musical",name:"Musical Notes & Melodies",sounds:Ae},{id:"notification",name:"Notification Alerts",sounds:Ie},{id:"game",name:"Game & Action Sounds",sounds:Le}],ue=[...Te,...Ae,...Ie,...Le];async function Cn(n){try{if(!n||!n.frequency||!n.type||!n.duration)return!1;const s=window.AudioContext||window.webkitAudioContext;if(!s)return!1;const t=new s;if(n.frequencies&&n.frequencies.length>1)return wn(t,n);const a=t.createOscillator(),i=t.createGain();return a.connect(i),i.connect(t.destination),a.frequency.value=n.frequency,a.type=n.type,i.gain.setValueAtTime?(i.gain.setValueAtTime(.3,t.currentTime),i.gain.exponentialRampToValueAtTime(.01,t.currentTime+n.duration/1e3)):i.gain.value=.3,a.start(),a.stop(t.currentTime+n.duration/1e3),setTimeout(()=>{t.close()},n.duration+100),!0}catch(s){return console.warn("Sound playback failed:",s),!1}}async function wn(n,s){try{const t=s.frequencies,a=s.duration/t.length,i=n.createGain();return i.connect(n.destination),i.gain.setValueAtTime?i.gain.setValueAtTime(.3,n.currentTime):i.gain.value=.3,t.forEach((l,r)=>{const o=n.createOscillator(),c=n.createGain();o.connect(c),c.connect(i),o.frequency.value=l,o.type=s.type;const u=n.currentTime+r*a/1e3,h=u+a/1e3;c.gain.setValueAtTime?(c.gain.setValueAtTime(1,u),c.gain.exponentialRampToValueAtTime(.01,h)):c.gain.value=1,o.start(u),o.stop(h)}),setTimeout(()=>{n.close()},s.duration+100),!0}catch(t){return console.warn("Melody playback failed:",t),!1}}function ne(){return ue[Math.floor(Math.random()*ue.length)]}function Pn(n){return n&&ue.find(s=>s.id===n)||null}const kn=Oe(Y)(`
  &:last-child {
    padding-bottom: 8px;
  }
`);function Tn({player:n,index:s,isActive:t,canEdit:a=!0,canDelete:i=!0,onEdit:l,onDelete:r,onRoleChange:o}){const{t:c}=q(),[u,h]=d.useState(null),[y,j]=d.useState(null),P=k=>{h(k.currentTarget)},f=()=>{h(null)},S=k=>{k.stopPropagation(),j(k.currentTarget)},b=()=>{j(null)},p=()=>{f(),l?.(n)},C=()=>{f(),r?.(n.id)},w=k=>{b(),o?.(n.id,k)},T=k=>k.split(" ").map(A=>A.charAt(0)).join("").toUpperCase().slice(0,2)||"P",v=k=>{switch(k){case"dom":return"primary";case"sub":return"secondary";case"vers":return"default";default:return"default"}};return e.jsxs(_,{sx:{border:t?"2px solid":"1px solid",borderColor:t?"primary.main":"divider",bgcolor:t?"action.selected":"background.paper",transition:"all 0.2s ease-in-out","&:hover":{borderColor:"primary.main",elevation:2}},children:[e.jsx(kn,{children:e.jsxs(x,{sx:{display:"flex",alignItems:"flex-start",gap:2},children:[e.jsx(ve,{sx:{bgcolor:t?"primary.main":"grey.500",marginTop:.5,width:24,height:24,fontWeight:"bold"},children:T(n.name)}),e.jsx(x,{sx:{flexGrow:1,minWidth:0},children:e.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[e.jsx(g,{variant:"h6",component:"h3",sx:{fontWeight:t?600:500,color:t?"primary.main":"text.primary",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",flexGrow:1},children:n.name||c("localPlayers.defaultPlayerName",{number:s+1})}),e.jsx(B,{label:c(`roles.${n.role}`),size:"small",variant:"outlined",color:v(n.role),onClick:a?S:void 0,sx:{cursor:a?"pointer":"default","&:hover":a?{bgcolor:"action.hover"}:{}}}),t&&e.jsx(B,{label:c("localPlayers.currentPlayer"),size:"small",color:"primary",icon:e.jsx(sn,{})})]})}),(a||i)&&e.jsx(le,{size:"small",onClick:P,"aria-label":c("localPlayers.playerActions",{name:n.name}),children:e.jsx(tn,{})})]})}),e.jsxs(ye,{anchorEl:u,open:!!u,onClose:f,transformOrigin:{horizontal:"right",vertical:"top"},anchorOrigin:{horizontal:"right",vertical:"bottom"},children:[a&&e.jsxs(I,{onClick:p,children:[e.jsx(pe,{children:e.jsx(Ce,{fontSize:"small"})}),e.jsx(de,{children:c("localPlayers.editPlayer")})]}),i&&e.jsxs(I,{onClick:C,sx:{color:"error.main"},children:[e.jsx(pe,{children:e.jsx(an,{fontSize:"small",sx:{color:"error.main"}})}),e.jsx(de,{children:c("localPlayers.deletePlayer")})]})]}),e.jsx(ye,{anchorEl:y,open:!!y,onClose:b,transformOrigin:{horizontal:"left",vertical:"top"},anchorOrigin:{horizontal:"left",vertical:"bottom"},children:["dom","sub","vers"].map(k=>e.jsx(I,{onClick:()=>w(k),selected:n.role===k,children:e.jsx(B,{label:c(`roles.${k}`),size:"small",variant:n.role===k?"filled":"outlined",color:v(k)})},k))})]})}function An({selectedSoundId:n,onSoundChange:s,label:t="Turn Sound"}){const a=async()=>{if(!n)return;const l=Pn(n);if(l)try{await Cn(l)||console.error("Failed to play sound")}catch(r){console.error("Failed to play sound:",r)}},i=l=>{s(l.target.value)};return e.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:1,py:1},children:[e.jsxs(M,{fullWidth:!0,size:"small",children:[e.jsx(N,{id:"sound-select-label",children:t}),e.jsxs(O,{labelId:"sound-select-label",value:n||"",label:t,onChange:i,children:[e.jsx(I,{value:"",children:e.jsxs(x,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(ln,{fontSize:"small"}),"No sound"]})}),Sn.map(l=>[e.jsx(Ue,{sx:{fontWeight:"bold"},children:l.name},`header-${l.id}`),...l.sounds.map(r=>e.jsx(I,{value:r.id,sx:{pl:3},children:r.name},r.id))])]})]}),e.jsx($,{title:"Play sample",children:e.jsx(le,{onClick:a,color:"primary",disabled:!n,size:"small",children:e.jsx(me,{})})})]})}function In({open:n,player:s,existingPlayers:t,onSubmit:a,onCancel:i}){const{t:l}=q(),[r,o]=d.useState({name:"",role:"vers",sound:ne().id}),[c,u]=d.useState({}),[h,y]=d.useState(!1);d.useEffect(()=>{o(s?{name:s.name,role:s.role,sound:s.sound||ne().id}:{name:"",role:"vers",sound:ne().id}),u({})},[s,n]);const j=d.useCallback(()=>{const v={},k=r.name.trim();return k?k.length<2?v.name=l("localPlayers.form.errors.nameTooShort"):k.length>20?v.name=l("localPlayers.form.errors.nameTooLong"):t.some(E=>E.id!==s?.id&&E.name.toLowerCase()===k.toLowerCase())&&(v.name=l("localPlayers.form.errors.nameDuplicate")):v.name=l("localPlayers.form.errors.nameRequired"),(!r.role||!["dom","sub","vers"].includes(r.role))&&(v.role=l("localPlayers.form.errors.roleRequired")),u(v),Object.keys(v).length===0},[r,t,s,l]),P=d.useCallback(v=>{const k=v.target.value;o(A=>({...A,name:k})),c.name&&u(A=>({...A,name:void 0}))},[c.name]),f=d.useCallback(v=>{const k=v.target.value;o(A=>({...A,role:k})),c.role&&u(A=>({...A,role:void 0}))},[c.role]),S=d.useCallback(v=>{o(k=>({...k,sound:v}))},[]),b=d.useCallback(async()=>{if(j()){y(!0);try{const v={name:r.name.trim(),role:r.role,sound:r.sound};await a(v)}catch(v){console.error("Error submitting player form:",v)}finally{y(!1)}}},[r,j,a]),p=d.useCallback(()=>{o({name:"",role:"vers",sound:ne().id}),u({}),i()},[i]),C=d.useCallback(v=>v.split(" ").map(k=>k.charAt(0)).join("").toUpperCase().slice(0,2)||"P",[]),w=v=>{switch(v){case"dom":return"primary";case"sub":return"secondary";case"vers":return"default";default:return"default"}},T=!!s;return e.jsxs(We,{open:n,onClose:p,maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{borderRadius:2}},children:[e.jsx(Fe,{children:l(T?"localPlayers.form.editPlayerTitle":"localPlayers.form.addPlayerTitle")}),e.jsxs($e,{children:[e.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:2,mb:3,p:2,bgcolor:"action.hover",borderRadius:1},children:[e.jsx(ve,{sx:{bgcolor:"primary.main",width:56,height:56,fontSize:"1.5rem",fontWeight:"bold"},children:C(r.name||"P")}),e.jsxs(x,{sx:{direction:"row"},children:[e.jsx(g,{variant:"h6",children:r.name||l("localPlayers.form.previewName")}),e.jsx(x,{sx:{display:"flex",alignItems:"center",gap:1,mt:.5},children:e.jsx(B,{label:l(`roles.${r.role}`),size:"small",color:w(r.role),variant:"outlined"})})]})]}),e.jsxs(x,{sx:{display:"flex",flexDirection:"column",gap:3},children:[e.jsx(D,{label:l("localPlayers.form.nameLabel"),value:r.name,onChange:P,error:!!c.name,helperText:c.name||l("localPlayers.form.nameHelper"),placeholder:l("localPlayers.form.namePlaceholder"),fullWidth:!0,autoFocus:!T,inputProps:{maxLength:20}}),e.jsxs(M,{fullWidth:!0,error:!!c.role,children:[e.jsx(N,{children:l("localPlayers.form.roleLabel")}),e.jsxs(O,{value:r.role,onChange:f,label:l("localPlayers.form.roleLabel"),children:[e.jsx(I,{value:"dom",children:e.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(B,{label:l("roles.dom"),size:"small",color:"primary",variant:"outlined"}),e.jsx(g,{variant:"body2",color:"text.secondary",children:l("localPlayers.form.roleDescriptions.dom")})]})}),e.jsx(I,{value:"sub",children:e.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(B,{label:l("roles.sub"),size:"small",color:"secondary",variant:"outlined"}),e.jsx(g,{variant:"body2",color:"text.secondary",children:l("localPlayers.form.roleDescriptions.sub")})]})}),e.jsx(I,{value:"vers",children:e.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(B,{label:l("roles.vers"),size:"small",color:"default",variant:"outlined"}),e.jsx(g,{variant:"body2",color:"text.secondary",children:l("localPlayers.form.roleDescriptions.vers")})]})})]}),c.role&&e.jsx(g,{variant:"caption",color:"error",sx:{mt:1,ml:1.5},children:c.role})]}),e.jsx(An,{selectedSoundId:r.sound,onSoundChange:S,label:l("localPlayers.form.soundLabel","Turn Sound")}),e.jsx(Q,{severity:"info",sx:{mt:1},children:e.jsx(g,{variant:"body2",children:l("localPlayers.form.helpText")})})]})]}),e.jsxs(Ge,{sx:{p:3,pt:1},children:[e.jsx(z,{onClick:p,disabled:h,children:l("cancel")}),e.jsx(z,{onClick:b,variant:"contained",disabled:h||!r.name.trim(),children:l(h?"localPlayers.form.saving":T?"localPlayers.form.saveChanges":"localPlayers.form.addPlayer")})]})]})}function Ln({roomId:n,isPrivateRoom:s,onComplete:t,onCancel:a,initialPlayers:i=[],initialSettings:l}){const{t:r}=q();console.debug("Setting up local players for room:",n);const[o,c]=d.useState(i),[u,h]=d.useState(!1),[y,j]=d.useState(null),[P,f]=d.useState(!1),[S,b]=d.useState(!1),[p,C]=d.useState(null),[w]=d.useState(l||{showTurnTransitions:!0,enableTurnSounds:!0,showPlayerAvatars:!0}),T=d.useCallback(()=>{const L=o.length>=2&&o.length<=4,R=o.every(Z=>Z.name.trim().length>0),G=new Set(o.map(Z=>Z.name.toLowerCase())).size===o.length,V=L&&R&&G;return h(V),o.length<2?j(r("localPlayers.errors.minimumPlayers")):o.length>4?j(r("localPlayers.errors.maximumPlayers")):j(R?G?null:r("localPlayers.errors.duplicateNames"):r("localPlayers.errors.emptyNames")),V},[o,r]);d.useEffect(()=>{i.length>0&&c(i)},[]),d.useEffect(()=>{T()},[T]);const v=d.useCallback(()=>`local_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,[]),k=d.useCallback(()=>r("localPlayers.defaultPlayerName",{number:o.length+1}),[o.length,r]),A=d.useCallback(()=>{o.length>=4||(C(null),b(!0))},[o.length]),E=d.useCallback(L=>{c(R=>R.filter(V=>V.id!==L).map((V,Z)=>({...V,order:Z,isActive:Z===0})))},[]),H=d.useCallback((L,R)=>{c(G=>G.map(V=>V.id===L?{...V,...R}:V))},[]),ee=d.useCallback((L,R)=>{H(L,{role:R})},[H]),Ee=d.useCallback(L=>{C(L),b(!0)},[]),Ke=d.useCallback(async L=>{if(p)H(p.id,L);else{const R={id:v(),name:L.name||k(),role:L.role||"vers",order:o.length,isActive:o.length===0,deviceId:"current_device",location:0,isFinished:!1,sound:L.sound};c(G=>[...G,R])}b(!1),C(null)},[p,H,v,k,o.length]),ze=d.useCallback(()=>{b(!1),C(null)},[]),Ve=d.useCallback(async()=>{if(T()){f(!0),j(null);try{await t(o,w)}catch(L){j(L instanceof Error?L.message:r("localPlayers.errors.sessionCreation"))}finally{f(!1)}}},[o,w,T,t,r]),Be=d.useCallback(()=>{a()},[a]);return s?e.jsxs(_,{children:[e.jsx(_e,{title:e.jsx(g,{variant:"h5",component:"h2",children:e.jsx(m,{i18nKey:"localPlayers.setupTitle"})}),subheader:e.jsx(g,{variant:"body2",color:"text.secondary",children:e.jsx(m,{i18nKey:"localPlayers.setupSubtitle"})})}),e.jsxs(Y,{children:[y&&e.jsx(Q,{severity:"error",sx:{mb:2},children:y}),e.jsxs(x,{sx:{mb:3},children:[e.jsxs(x,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsx(g,{variant:"h6",children:e.jsx(m,{i18nKey:"localPlayers.playersTitle"})}),e.jsx(g,{variant:"body2",color:"text.secondary",children:r("localPlayers.playersCount",{count:o.length})})]}),o.length===0?e.jsxs(x,{sx:{textAlign:"center",py:4,border:"2px dashed",borderColor:"divider",borderRadius:1,bgcolor:"action.hover"},children:[e.jsx(g,{variant:"body1",color:"text.secondary",gutterBottom:!0,children:e.jsx(m,{i18nKey:"localPlayers.noPlayersYet"})}),e.jsx(z,{variant:"contained",startIcon:e.jsx(fe,{}),onClick:A,children:e.jsx(m,{i18nKey:"localPlayers.addFirstPlayer"})})]}):e.jsxs(e.Fragment,{children:[e.jsx(x,{sx:{display:"flex",flexDirection:"column",gap:2},children:o.map((L,R)=>e.jsx(Tn,{player:L,index:R,isActive:L.isActive,canEdit:!0,canDelete:o.length>1,onEdit:Ee,onDelete:E,onRoleChange:ee},L.id))}),o.length<4&&e.jsx(x,{sx:{display:"flex",justifyContent:"center",mt:2},children:e.jsx(Ye,{size:"small",color:"primary",onClick:A,"aria-label":"Add player",children:e.jsx(fe,{})})})]})]}),e.jsxs(x,{sx:{display:"flex",gap:2,justifyContent:"flex-end"},children:[e.jsx(z,{variant:"outlined",onClick:Be,disabled:P,children:e.jsx(m,{i18nKey:"cancel"})}),e.jsx(z,{variant:"contained",onClick:Ve,disabled:!u||P,children:P?e.jsx(m,{i18nKey:"localPlayers.creatingSession"}):e.jsx(m,{i18nKey:"localPlayers.startSession"})})]})]}),e.jsx(In,{open:S,player:p,existingPlayers:o,onSubmit:Ke,onCancel:ze})]}):e.jsx(_,{children:e.jsx(Y,{children:e.jsx(Q,{severity:"warning",children:e.jsx(g,{children:e.jsx(m,{i18nKey:"localPlayers.privateRoomRequired"})})})})})}function qn({actionName:n,actionLabel:s,selectedLevels:t,availableLevels:a,intensityNames:i={},onChange:l,disabled:r=!1,showValueGlow:o=!1}){const{t:c}=q(),u=Se(),h=`${n}-intensity-label`,y=o&&t.length>0,j=y?{boxShadow:`0 0 8px ${u.palette.primary.main}`}:{},P=y?{backgroundColor:"var(--color-surface)",borderRadius:"8px",padding:"0 8px"}:{},f=p=>{const w=p.target.value.filter(T=>!isNaN(T)).sort((T,v)=>T-v);l(w)},S=p=>{p.stopPropagation(),l([])},b=p=>p.length===0?c("none"):p.map(C=>i[C]||`${c("level")} ${C}`).join(", ");return a.length===0?e.jsx(e.Fragment,{}):e.jsxs(M,{margin:"normal",fullWidth:!0,disabled:r,children:[e.jsx(N,{id:h,sx:P,children:s}),e.jsx(O,{labelId:h,id:n,label:s,multiple:!0,value:t,onChange:f,renderValue:b,sx:j,endAdornment:t.length>0&&e.jsx(le,{size:"small",onClick:S,sx:{position:"absolute",right:24,top:"50%",transform:"translateY(-50%)",zIndex:1,"&:hover":{backgroundColor:"rgba(0, 0, 0, 0.04)"}},children:e.jsx(we,{fontSize:"small"})}),children:a.map(p=>e.jsxs(I,{value:p,children:[e.jsx(He,{checked:t.includes(p)}),e.jsx(de,{primary:i[p]||`${c("level")} ${p}`})]},p))})]})}function Rn({trueCondition:n,onChange:s,yesLabel:t,noLabel:a=null,sx:i={}}){const l=a??t;return e.jsx(x,{sx:{display:"flex",justifyContent:"center",my:1,...i},children:e.jsx(se,{control:e.jsx(X,{checked:n||!1,onChange:s}),label:he(n?t:l)})})}function En(n,s=!1,t=!1){if(s)return n;const a={...n};return t||delete a.useRoomBackground,a}function Kn(n){return n?"roomBackground":"background"}function zn(n){return n?"roomBackgroundURL":"backgroundURL"}function Vn({formData:n,setFormData:s,backgrounds:t,isRoom:a=!1,isPrivateRoom:i=!1}){const{t:l}=q(),r=Kn(a),o=zn(a),c=d.useMemo(()=>En(t,a,i),[t,a,i]),u=n?.[r],[h,y]=d.useState(u||""),j=()=>[e.jsx(I,{value:"",children:l(i?"useRoomBackground":"customTiles.color")},"empty"),...Object.entries(c).map(([b,p])=>e.jsx(I,{value:b,children:p},b))],P=S=>{const b=S.target.value,p={...n,[r]:b};if(b!=="custom"){const C={...p,[o]:""};a&&(C.roomUpdated=!0),s(C),y(b);return}a&&(p.roomUpdated=!0),s(p),y(b)};d.useEffect(()=>{const S=u&&c[u]?u:"";h!==S&&y(S)},[h,u,c]);const f=S=>{const b={...n,[r]:"custom",[o]:S.target.value};a&&(b.roomUpdated=!0),s(b)};return e.jsxs(e.Fragment,{children:[e.jsxs(M,{fullWidth:!0,margin:"normal",children:[e.jsx(N,{id:"background-label",children:l("background")}),e.jsx(O,{labelId:"background-label",id:"background",label:l("background"),value:h,onChange:P,displayEmpty:!0,children:j()})]}),h==="custom"&&e.jsx(D,{sx:{mt:2},label:l("url"),value:n?.[o]||"",fullWidth:!0,onChange:f,helperText:e.jsxs(e.Fragment,{children:[l("supportedSites"),e.jsx("br",{}),l("requiresEmbeddedUrl")]})})]})}class Bn{constructor(){ge(this,"voiceLoadPromise")}async waitForVoices(){return this.voiceLoadPromise?this.voiceLoadPromise:(this.voiceLoadPromise=new Promise(s=>{let t=window.speechSynthesis.getVoices();if(t.length>0){s(t);return}const a=()=>{t=window.speechSynthesis.getVoices(),t.length>0&&(window.speechSynthesis.removeEventListener("voiceschanged",a),s(t))};window.speechSynthesis.addEventListener("voiceschanged",a),setTimeout(()=>{window.speechSynthesis.removeEventListener("voiceschanged",a),s(window.speechSynthesis.getVoices())},3e3)}),this.voiceLoadPromise)}async getAvailableVoicesAsync(){return(await this.waitForVoices()).map(t=>({name:t.name,displayName:`${t.name} (${t.lang})`}))}async getPreferredVoiceAsync(){const s=await this.getAvailableVoicesAsync();return s.length>0?s[0].name:null}async speak(s,t,a=0){return new Promise((i,l)=>{if(!("speechSynthesis"in window)){l(new Error("Speech synthesis not supported"));return}const r=new SpeechSynthesisUtterance(s);if(r.pitch=a,t){const c=window.speechSynthesis.getVoices().find(u=>u.name===t);c&&(r.voice=c)}r.onend=()=>i(),r.onerror=o=>l(new Error(`Speech failed: ${o.error}`)),window.speechSynthesis.speak(r)})}stop(){window.speechSynthesis?.speaking&&window.speechSynthesis.cancel()}isAvailable(){return"speechSynthesis"in window}}const ae=new Bn,Mn=()=>{const[n,s]=d.useState(!1),[t,a]=d.useState(!1),[i,l]=d.useState(null),r=d.useCallback(()=>{ae.stop(),s(!1),a(!1)},[]),o=d.useCallback(async(c,u={})=>{try{a(!0),l(null),r(),s(!0),await ae.speak(c,u.voice,u.pitch),a(!1),s(!1)}catch(h){const y=h instanceof Error?h.message:"TTS failed";l(y),s(!1),a(!1),console.error("TTS Error:",h)}},[r]);return d.useEffect(()=>()=>{r()},[r]),{speak:o,stop:r,isPlaying:n,error:i,isLoading:t}};function Nn({formData:n,setFormData:s,onVoiceChange:t}){const{t:a}=q(),[i,l]=d.useState([]),[r,o]=d.useState(!0),{speak:c}=Mn(),u=n.voicePreference||"",h=d.useCallback(f=>{const S={...n,voicePreference:f};s(S),t?.(f)},[n,s,t]);d.useEffect(()=>{let f=!0;return(async()=>{try{if(f){o(!0);const b=await ae.getAvailableVoicesAsync();if(f){const p=b.filter(C=>C.displayName.includes("Google")||C.name.includes("Google"));if(l(p),!u&&p.length>0){const C=await ae.getPreferredVoiceAsync();C&&p.some(w=>w.name===C)&&f?h(C):f&&h(p[0].name)}o(!1)}}}catch(b){console.error("Failed to load voices:",b),f&&o(!1)}})(),()=>{f=!1}},[u,h]);const y=f=>{h(f.target.value)},j=async()=>{const f=u||(i.length>0?i[0].name:"");if(!f)return;const S=a("tts.sampleText","Take a drink and enjoy the game.");try{await c(S,{voice:f,pitch:-2})}catch(b){console.error("Failed to play sample:",b)}},P=f=>f.displayName.replace(/^Google\s+/i,"");return r?e.jsx(x,{sx:{py:1},children:e.jsx(g,{variant:"body2",color:"text.secondary",children:a("loadingVoices","Loading voices...")})}):i.length===0?e.jsx(x,{sx:{py:1},children:e.jsx(g,{variant:"body2",color:"text.secondary",children:a("noVoicesAvailable","No voices available for this language")})}):e.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:1,py:1},children:[e.jsxs(M,{fullWidth:!0,size:"small",children:[e.jsx(N,{id:"voice-select-label",children:a("voiceSelection","Voice")}),e.jsx(O,{labelId:"voice-select-label",value:u,label:a("voiceSelection","Voice"),onChange:y,children:i.map(f=>e.jsx(I,{value:f.name,children:P(f)},f.name))})]}),e.jsx($,{title:a("playSample","Play sample"),children:e.jsx(le,{onClick:j,color:"primary",disabled:!u,size:"small",children:e.jsx(me,{})})})]})}function On({boardUpdated:n}){const{i18n:s}=q(),[t,a]=d.useState(s.resolvedLanguage||"en"),[i,l]=d.useState(!1);async function r(c){l(!0),a(c);try{await s.changeLanguage(c),n()}catch(u){console.error("Error changing language:",u),await s.changeLanguage(c),n()}finally{l(!1)}}const o=Object.entries(hn).map(([c,u])=>e.jsx(I,{value:c,children:u.label},c));return e.jsx(x,{sx:{minWidth:120,mt:1,mb:2},children:e.jsxs(M,{fullWidth:!0,children:[e.jsxs(N,{id:"language-label",sx:{display:"flex",alignItems:"center"},children:[e.jsx(je,{sx:{mr:1}}),e.jsx(m,{i18nKey:"language"})]}),e.jsx(O,{labelId:"language-label",id:"language-select",value:t,disabled:i,label:e.jsxs(e.Fragment,{children:[e.jsx(je,{}),e.jsx(m,{i18nKey:"language"})]}),onChange:c=>r(c.target.value),endAdornment:i&&e.jsx(Ze,{size:20}),MenuProps:{disableScrollLock:!0,BackdropProps:{invisible:!0},PaperProps:{style:{backdropFilter:"none",WebkitBackdropFilter:"none"}}},children:o})]})})}function F({field:n,formData:s,handleSwitch:t}){return e.jsx(Rn,{trueCondition:s[n],onChange:a=>t(a,n),yesLabel:n,sx:{justifyContent:"left"}})}function Un({formData:n,setFormData:s,boardUpdated:t}){const[a,i]=ke(),l=!!(n.room&&!U(n.room)),{t:r}=q(),o={useRoomBackground:r("useRoomBackground"),color:r("color"),gray:r("gray"),"metronome.gif":r("hypnoDick"),"pink-spiral.gif":r("pinkSpiral"),custom:r("customURL")};function c(h,y){s({...n,[y]:h.target.checked}),i({...a,[y]:h.target.checked})}function u(h){i({...a,voicePreference:h})}return e.jsxs(e.Fragment,{children:[e.jsx(On,{boardUpdated:t}),e.jsx(g,{variant:"h5",children:e.jsx(m,{i18nKey:"dialog"})}),e.jsx(F,{field:"playerDialog",formData:n,handleSwitch:c}),e.jsx(F,{field:"othersDialog",formData:n,handleSwitch:c}),e.jsx(J,{}),e.jsx(g,{variant:"h5",sx:{mt:2},children:e.jsx(m,{i18nKey:"sounds"})}),e.jsx(F,{field:"mySound",formData:n,handleSwitch:c}),e.jsx(F,{field:"otherSound",formData:n,handleSwitch:c}),e.jsx(F,{field:"chatSound",formData:n,handleSwitch:c}),e.jsx(F,{field:"readRoll",formData:n,handleSwitch:c}),n.readRoll&&e.jsx(Nn,{formData:n,setFormData:s,onVoiceChange:u}),e.jsx(J,{}),e.jsx(g,{variant:"h5",sx:{mt:2,textTransform:"capitalize"},children:e.jsx(m,{i18nKey:"misc"})}),e.jsx(F,{field:"hideBoardActions",formData:n,handleSwitch:c}),e.jsx(F,{field:"advancedSettings",formData:n,handleSwitch:c}),e.jsx(Vn,{formData:n,setFormData:s,backgrounds:o,isPrivateRoom:l}),e.jsx(J,{})]})}function Wn({formData:n,setFormData:s}){const t=(i,l)=>{s({...n,finishRange:l,boardUpdated:!0})},a=n?.finishRange||[30,70];return e.jsxs(x,{children:[e.jsx(J,{}),e.jsx(g,{id:"finish-slider",sx:{my:1},children:e.jsx(m,{i18nKey:"finishSlider"})}),e.jsx(Je,{"aria-labelledby":"finish-slider",value:a,onChange:t,valueLabelDisplay:"off"}),e.jsxs(x,{display:"flex",flexDirection:"column",justifyContent:"space-between",textAlign:"center",children:[e.jsxs(g,{whiteSpace:"nowrap",children:[e.jsx(m,{i18nKey:"noCum"})," ",a[0],"%"]}),e.jsxs(g,{whiteSpace:"nowrap",children:[e.jsx(m,{i18nKey:"ruined"})," ",a[1]-a[0],"%"]}),e.jsxs(g,{whiteSpace:"nowrap",children:[e.jsx(m,{i18nKey:"cum"})," ",100-a[1],"%"]})]}),e.jsx(J,{sx:{my:1}})]})}function be({children:n}){return e.jsx(K,{size:{xs:12,md:5},children:n})}function oe({children:n,title:s,subtitle:t,defaultExpanded:a=!1,hasSelectedOptions:i=!1,...l}){const r=Se();return e.jsxs(Qe,{defaultExpanded:a,...l,sx:{backgroundColor:"inherit",backgroundImage:"none",boxShadow:"none"},children:[e.jsx(Xe,{expandIcon:e.jsx(rn,{}),sx:{px:0},children:e.jsxs(x,{sx:{display:"flex",alignItems:"center",width:"100%"},children:[e.jsxs(g,{variant:"h6",sx:{display:"flex",alignItems:"center",gap:1,minWidth:"fit-content"},children:[s,":",i&&e.jsx(x,{sx:{width:8,height:8,borderRadius:"50%",backgroundColor:r.palette.primary.main,flexShrink:0}})]}),e.jsx(g,{sx:{pt:.5,ml:2,flex:1},children:t})]})}),e.jsx(De,{sx:{px:0},children:e.jsx(K,{container:!0,columnSpacing:2,justifyContent:"space-evenly",className:"columned-grid",children:n})})]})}const qe=d.forwardRef(({value:n,onChange:s,label:t,options:a,defaultValue:i=null,sx:l,helpIcon:r=!1,fullWidth:o=!0,...c},u)=>{const h=d.useMemo(()=>a.map(y=>typeof y=="string"?e.jsx(I,{value:y,children:he(y)},y):e.jsx(I,{value:y.value,children:y.label},y.value)),[a]);return e.jsxs(M,{fullWidth:o,margin:"normal",sx:l,...c,ref:u,children:[e.jsxs(N,{id:`${t}Label`,children:[e.jsx(m,{i18nKey:t}),!!r&&e.jsx(W,{sx:{ml:1,fontSize:16}})]}),e.jsx(O,{labelId:`${t}Label`,id:t,label:e.jsxs(e.Fragment,{children:[e.jsx(m,{i18nKey:t}),!!r&&e.jsx(W,{sx:{ml:1,fontSize:16}})]}),value:n||i||"",onChange:s,children:h})]})});function Fn({option:n,settings:s,setSettings:t,actionsFolder:a,type:i,showVariation:l=!1,showRole:r=!1}){const{t:o}=q(),c=`${n}label`,u=a[n]?.label;function h(S,b,p){const C=s.selectedActions?.[b];t({...s,selectedActions:{...s.selectedActions,[b]:{...C,type:i,levels:C?.levels??[],[p]:S?.target?.value}},boardUpdated:!0})}function y(S,b){const p=s.selectedActions?.[b];t({...s,selectedActions:{...s.selectedActions,[b]:{...p,type:i,levels:S}},boardUpdated:!0})}let j=12;(l||r)&&(j=6);let P=["dom","vers","sub"];a[n]?.dom&&(P=[{label:a[n].dom,value:"dom"},{label:o("vers"),value:"vers"},{label:a[n].sub,value:"sub"}]);const f=()=>{const S=a[n],b=S?.intensities?Object.keys(S.intensities).map(Number).filter(C=>C>0).sort((C,w)=>C-w):[1,2,3,4],p=s.selectedActions?.[n]?.levels||[];return e.jsx(qn,{actionName:n,actionLabel:S?.label||n,selectedLevels:p,availableLevels:b,intensityNames:S?.intensities||{},onChange:C=>y(C,n),showValueGlow:!0})};return e.jsxs(K,{container:!0,justifyContent:"center",children:[e.jsx(K,{size:j,children:f()}),!!r&&e.jsx(K,{size:6,children:e.jsx(qe,{sx:{ml:1},value:s.selectedActions?.[n]?.role,onChange:S=>h(S,n,"role"),label:`${o("role")}: ${u}`,options:P,defaultValue:s.role||"sub"})}),!!l&&e.jsx(K,{size:6,children:e.jsx($,{placement:"top",title:e.jsxs(m,{i18nKey:"variationTooltip",children:[e.jsx(g,{variant:"subtitle2",children:"Standalone = Its own tile. "}),e.jsx(g,{variant:"subtitle2",children:"Append Some = 50% chance."}),e.jsx(g,{variant:"subtitle2",children:"Append Most = 90% chance."})]}),arrow:!0,children:e.jsxs(M,{fullWidth:!0,margin:"normal",sx:{ml:1},children:[e.jsxs(N,{id:`${c}Variation`,children:[`${u} ${o("variation")}`,e.jsx(W,{sx:{ml:1,fontSize:16}})]}),e.jsxs(O,{labelId:`${c}Variation`,id:`${n}Variation`,label:e.jsxs(e.Fragment,{children:[u," ",o("variation"),e.jsx(W,{sx:{ml:1,fontSize:16}})]}),value:s.selectedActions?.[n]?.variation||"standalone",onChange:S=>h(S,n,"variation"),children:[e.jsx(I,{value:"standalone",children:e.jsx(m,{i18nKey:"standalone"})}),e.jsx(I,{value:"appendSome",children:e.jsx(m,{i18nKey:"appendSome"})}),e.jsx(I,{value:"appendMost",children:e.jsx(m,{i18nKey:"appendMost"})})]})]})})})]},n)}function $n({formData:n,setFormData:s}){return e.jsxs(xe,{direction:"row",spacing:1,alignItems:"center",justifyContent:"center",sx:{mt:1},children:[e.jsx(g,{children:e.jsx(m,{i18nKey:"solo"})}),e.jsx($,{title:e.jsx(g,{variant:"subtitle2",children:e.jsx(m,{i18nKey:"soloTooltip"})}),arrow:!0,children:e.jsx(W,{sx:{fontSize:15}})}),e.jsx(X,{id:"gameMode",checked:!te(n.gameMode),onChange:t=>s({...n,gameMode:t.target.checked?"local":"online",boardUpdated:!0}),inputProps:{"aria-label":"Game Type"}}),e.jsx(g,{children:e.jsx(m,{i18nKey:"local"})}),e.jsx($,{title:e.jsx(g,{variant:"subtitle2",children:e.jsx(m,{i18nKey:"localTooltip"})}),arrow:!0,children:e.jsx(W,{sx:{fontSize:15}})})]})}function Gn({formData:n}){const[s,t]=d.useState(!1);return d.useEffect(()=>{const a=Object.values(n).filter(l=>typeof l=="object"&&l?.type==="consumption"&&l?.levels&&l.levels.length>0).length,i=Object.values(n).filter(l=>typeof l=="object"&&l?.levels&&l.levels.length>0).length;t(a>1&&a>=i-a)},[n]),s?e.jsx(Q,{severity:"warning",children:e.jsx(m,{i18nKey:"consumptionWarning"})}):null}function _n({formData:n,setFormData:s,actionsList:t}){const{t:a}=q(),{hasLocalPlayers:i}=mn(),l=!te(n.gameMode),r=!i();function o(h){return Object.keys(t).filter(y=>t[y]?.type===h).some(y=>{const j=n.selectedActions?.[y];return j?.levels&&j.levels.length>0})}function c(h,y={}){return Object.keys(t).filter(j=>t[j]?.type===h).map(j=>e.jsx(be,{children:e.jsx(Fn,{option:j,settings:n,setSettings:s,actionsFolder:t,type:h,...y})},j))}const u=h=>{const y=JSON.parse(JSON.stringify(n));return Object.keys(y).forEach(j=>{y.role=h,j.includes("role")&&(y[j]=h)}),y};return e.jsxs(e.Fragment,{children:[e.jsx($n,{formData:n,setFormData:s}),U(n?.room)&&!te(n.gameMode)&&e.jsx(K,{container:!0,alignContent:"center",justifyContent:"space-evenly",children:e.jsx(K,{sx:{py:3},children:e.jsx(g,{variant:"h5",children:e.jsx(m,{i18nKey:"privateRequired"})})})}),l?e.jsxs(e.Fragment,{children:[e.jsx(K,{container:!0,columnSpacing:2,justifyContent:"space-evenly",children:r&&e.jsx(be,{children:e.jsx(qe,{value:n.role,onChange:h=>s({...u(h.target.value),boardUpdated:!0}),label:"mainRole",options:["dom","vers","sub"],defaultValue:"sub"})})}),e.jsx(oe,{title:a("consumption"),subtitle:a("consumptionSubtitle"),hasSelectedOptions:o("consumption"),children:c("consumption",{showVariation:!0})}),e.jsx(oe,{title:a("foreplay"),subtitle:a("foreplaySubtitle"),hasSelectedOptions:o("foreplay"),children:c("foreplay",{showRole:r})}),e.jsx(oe,{title:a("sex"),subtitle:a("sexSubtitle"),hasSelectedOptions:o("sex"),children:c("sex",{showRole:r})})]}):e.jsxs(e.Fragment,{children:[e.jsx(K,{container:!0,columnSpacing:2,justifyContent:"space-evenly",children:c("consumption",{showVariation:!0})}),e.jsx(J,{}),e.jsx(K,{container:!0,columnSpacing:2,justifyContent:"center",children:c("solo")})]}),e.jsx(Wn,{setFormData:s,formData:n}),e.jsx(Gn,{formData:n})]})}function Yn({formData:n,setFormData:s}){const{t}=q(),a=i=>{const l=i.target.value.trim();s({...n,roomBackgroundURL:l,roomUpdated:!0})};return e.jsx(D,{sx:{mt:2},label:t("roomBackgroundURL"),value:n?.roomBackgroundURL||"",fullWidth:!0,onChange:a,helperText:t("supportedSites"),placeholder:t("roomBackgroundPlaceholder"),type:"url",inputMode:"url",autoComplete:"off",spellCheck:!1,autoCapitalize:"none"})}function Hn({formData:n,setFormData:s}){const{t}=q(),a={"1d4":2.5,"1d6":3.5,"2d4":5},i=n?.roomTileCount?Math.floor(n.roomTileCount/a[n.roomDice||"1d6"]):16,l=Array.from({length:7},(r,o)=>(o+2)*10).map(r=>e.jsx(I,{value:r,children:r},r));return e.jsxs(x,{children:[e.jsx(g,{variant:"subtitle1",sx:{mb:2,fontWeight:"medium"},children:e.jsx(m,{i18nKey:"gameSpeed"})}),e.jsxs(x,{sx:{display:"flex",gap:2,alignItems:"flex-end",flexWrap:"wrap"},children:[e.jsxs(M,{sx:{minWidth:120,flex:1},children:[e.jsx(N,{id:"diceRole-label",children:e.jsx(m,{i18nKey:"roomDice"})}),e.jsxs(O,{labelId:"diceRole-label",id:"diceRole-select",value:n?.roomDice||"1d4",label:t("roomDice"),onChange:r=>s({...n,roomDice:r.target.value,roomUpdated:!0}),children:[e.jsx(I,{value:"1d4",children:"1d4"}),e.jsx(I,{value:"1d6",children:"1d6"}),e.jsx(I,{value:"2d4",children:"2d4"})]})]}),e.jsxs(M,{sx:{minWidth:120,flex:1},children:[e.jsx(N,{id:"tile-count-label",children:e.jsx(m,{i18nKey:"roomTileCount"})}),e.jsx(O,{labelId:"tile-count-label",id:"tile-count-select",value:String(n?.roomTileCount||40),label:t("roomTileCount"),onChange:r=>s({...n,roomTileCount:Number(r.target.value),roomUpdated:!0}),children:l})]}),e.jsxs(x,{sx:{display:"flex",flexDirection:"column",alignItems:"center",minWidth:120},children:[e.jsx(g,{variant:"body2",color:"text.secondary",sx:{mb:1},children:e.jsx(m,{i18nKey:"averageRolls"})}),e.jsx(B,{label:i,color:"primary",variant:"outlined",sx:{minWidth:50,fontWeight:"bold"}})]})]})]})}function Zn({formData:n,setFormData:s}){const t=d.useCallback(()=>{s({...n,roomRealtime:!n.roomRealtime,roomUpdated:!0})},[n,s]);return e.jsxs(x,{children:[e.jsx(g,{variant:"subtitle1",sx:{mb:2,fontWeight:"medium"},children:e.jsx(m,{i18nKey:"playerListOptions"})}),e.jsx(x,{sx:{display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsxs(xe,{direction:"row",spacing:2,alignItems:"center",children:[e.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(g,{variant:"body2",color:"text.secondary",children:e.jsx(m,{i18nKey:"realtime"})}),e.jsx($,{title:e.jsx(g,{variant:"subtitle2",children:e.jsx(m,{i18nKey:"realtimeTooltip"})}),arrow:!0,children:e.jsx(W,{sx:{fontSize:16,color:"text.secondary"}})})]}),e.jsx(se,{control:e.jsx(X,{checked:!!n.roomRealtime,onChange:t,inputProps:{"aria-label":he("playerList")}}),label:"",sx:{margin:0}}),e.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(g,{variant:"body2",color:"text.secondary",children:e.jsx(m,{i18nKey:"delayed"})}),e.jsx($,{title:e.jsx(g,{variant:"subtitle2",children:e.jsx(m,{i18nKey:"delayedTooltip"})}),arrow:!0,children:e.jsx(W,{sx:{fontSize:16,color:"text.secondary"}})})]})]})})]})}function Jn({formData:n,setFormData:s}){const{id:t}=en(),{t:a}=q(),i=u=>{let h;u.target.checked&&U(t)?h=fn("123456789ABCDEFGHJKLMNPQRSTUVWXYZ",5)():t&&u.target.checked&&!U(t)?h=t:h="PUBLIC",s({...n,room:h.toUpperCase(),gameMode:U(h)?"online":n.gameMode})},l=d.useCallback(u=>{s({...n,room:u.currentTarget.value,boardUpdated:!0})},[n,s]),r=d.useCallback(u=>{u.key==="Enter"&&s({...n,room:u.currentTarget.value,boardUpdated:!0})},[n,s]),o=d.useCallback(u=>{const h=u.target.value.toUpperCase();u.target.value=h},[]),c=!U(n.room);return e.jsxs(e.Fragment,{children:[e.jsxs(xe,{direction:"row",spacing:1,alignItems:"center",justifyContent:"center",sx:{width:"100%"},children:[e.jsx(g,{children:e.jsx(m,{i18nKey:"public"})}),e.jsx(X,{id:"showPrivate",checked:c,onChange:i,slotProps:{input:{"aria-label":a("room")}}}),e.jsx(g,{children:e.jsx(m,{i18nKey:"private"})}),e.jsx($,{title:e.jsx(g,{variant:"subtitle2",children:e.jsx(m,{i18nKey:"privateOptions"})}),arrow:!0,children:e.jsx(W,{sx:{fontSize:15}})})]}),c&&e.jsx(D,{fullWidth:!0,id:"privateRoom",label:a("privateRoom"),defaultValue:n.room?.toUpperCase(),margin:"normal",onBlur:l,onKeyDown:r,onChange:o,inputProps:{style:{textTransform:"uppercase"}}})]})}function Qn({roomId:n="PRIVATE",isPrivateRoom:s=!0}){const{t}=q(),{localPlayers:a,hasLocalPlayers:i,session:l,sessionSettings:r,clearLocalSession:o,updateSettings:c,createLocalSession:u}=gn(),[h,y]=d.useState(!1),[j,P]=d.useState(null),f=d.useCallback(()=>{y(!0),P(null)},[]),S=d.useCallback(()=>{y(!1),P(null)},[]),b=d.useCallback(async(w,T)=>{try{await u(n,w,T),y(!1),P(null)}catch(v){P(v instanceof Error?v.message:"Failed to save local player configuration")}},[n,u]),p=d.useCallback(async()=>{try{await o(),P(null)}catch(w){P(w instanceof Error?w.message:"Failed to clear local session")}},[o]),C=d.useCallback(async(w,T)=>{if(r)try{const v={...r,[w]:T};await c(v),P(null)}catch(v){P(v instanceof Error?v.message:"Failed to update settings")}},[r,c]);return h?e.jsxs(x,{children:[j&&e.jsx(Q,{severity:"error",sx:{mb:2},children:j}),e.jsx(Ln,{roomId:n,isPrivateRoom:s,onComplete:b,onCancel:S,initialPlayers:a,initialSettings:r})]}):e.jsxs(x,{children:[j&&e.jsx(Q,{severity:"error",sx:{mb:2},children:j}),i?e.jsxs(x,{children:[e.jsxs(x,{sx:{mb:3},children:[e.jsx(x,{sx:{display:"flex",flexDirection:"column",gap:1,mb:2},children:a.map(w=>e.jsxs(x,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",p:1,borderRadius:1,bgcolor:w.isActive?"primary.50":"background.default",border:w.isActive?"1px solid":"1px solid transparent",borderColor:w.isActive?"primary.main":"transparent"},children:[e.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsxs(g,{variant:"body2",color:"text.secondary",children:["#",w.order+1]}),e.jsx(g,{variant:"body1",fontWeight:w.isActive?"bold":"normal",children:w.name}),e.jsx(B,{label:t(`roles.${w.role}`),size:"small",variant:"outlined"})]}),w.isActive&&e.jsx(B,{label:t("localPlayerSettings.players.currentTurn"),color:"primary",size:"small"})]},w.id))}),e.jsxs(x,{sx:{display:"flex",gap:1},children:[e.jsx(z,{variant:"outlined",startIcon:e.jsx(Ce,{}),onClick:f,size:"small",children:e.jsx(m,{i18nKey:"localPlayerSettings.session.editButton"})}),e.jsx(z,{variant:"outlined",color:"error",startIcon:e.jsx(we,{}),onClick:p,size:"small",children:e.jsx(m,{i18nKey:"localPlayerSettings.session.clearButton"})})]})]}),l?.settings&&e.jsxs(x,{sx:{mt:3,p:2,borderRadius:1,bgcolor:"action.hover"},children:[e.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[e.jsx(on,{sx:{color:"text.secondary"}}),e.jsx(g,{variant:"subtitle1",component:"h4",children:e.jsx(m,{i18nKey:"localPlayerSettings.settings.title"})})]}),e.jsxs(x,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsx(se,{control:e.jsx(X,{checked:l.settings.showTurnTransitions,onChange:w=>C("showTurnTransitions",w.target.checked)}),label:t("localPlayerSettings.settings.showTurnTransitions")}),e.jsx(se,{control:e.jsx(X,{checked:l.settings.enableTurnSounds,onChange:w=>C("enableTurnSounds",w.target.checked)}),label:t("localPlayerSettings.settings.playTurnSounds")})]})]})]}):e.jsxs(x,{sx:{textAlign:"center",py:2},children:[e.jsx(Pe,{sx:{fontSize:48,color:"text.secondary",mb:2}}),e.jsx(g,{variant:"body1",color:"text.secondary",paragraph:!0,children:e.jsx(m,{i18nKey:"localPlayerSettings.noPlayers.description"})}),e.jsx(z,{variant:"contained",startIcon:e.jsx(me,{}),onClick:f,size:"large",children:e.jsx(m,{i18nKey:"localPlayerSettings.noPlayers.setupButton"})})]})]})}function Xn({formData:n,setFormData:s}){const{t}=q();return e.jsxs(x,{sx:{p:2},children:[e.jsx(_,{variant:"outlined",sx:{mb:3},children:e.jsxs(Y,{children:[e.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[e.jsx(cn,{sx:{color:"primary.main"}}),e.jsx(g,{variant:"h6",component:"h3",children:t("roomType")})]}),e.jsx(Jn,{formData:n,setFormData:s})]})}),!U(n.room)&&e.jsxs(e.Fragment,{children:[e.jsx(_,{variant:"outlined",sx:{mb:3},children:e.jsxs(Y,{children:[e.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[e.jsx(Pe,{sx:{color:"primary.main"}}),e.jsx(g,{variant:"h6",component:"h3",children:t("localPlayerSettings.title")})]}),e.jsx(Qn,{roomId:n.room,isPrivateRoom:!U(n.room)})]})}),e.jsx(_,{variant:"outlined",sx:{mb:3},children:e.jsxs(Y,{children:[e.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[e.jsx(dn,{sx:{color:"primary.main"}}),e.jsx(g,{variant:"h6",component:"h3",children:t("gameConfiguration")})]}),e.jsx(x,{sx:{mb:3},children:e.jsx(Hn,{formData:n,setFormData:s})}),e.jsx(x,{sx:{p:2,borderRadius:1,bgcolor:"action.hover"},children:e.jsx(Zn,{formData:n,setFormData:s})})]})}),e.jsx(_,{variant:"outlined",sx:{mb:3},children:e.jsxs(Y,{children:[e.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[e.jsx(un,{sx:{color:"primary.main"}}),e.jsx(g,{variant:"h6",component:"h3",children:t("visualSettings")})]}),e.jsx(Yn,{formData:n,setFormData:s})]})})]})]})}function ce({children:n,value:s,index:t,style:a,...i}){return e.jsx("div",{role:"tabpanel",hidden:s!==t,id:`simple-tabpanel-${t}`,"aria-labelledby":`simple-tab-${t}`,...i,children:s===t&&e.jsx(x,{sx:{p:3,...a},children:n})})}const Re=({levels:n})=>!!n?.length&&n.some(s=>s>0);function Dn(n){return Object.values(n).some(Re)}function es(n,s){const t=n.selectedActions||{};return Object.entries(t).reduce((a,[i,l])=>{if(i in s){const r=l?.variation?.startsWith("append")?"withAppend":"withoutAppend";a[r][i]=l}return a},{withAppend:{},withoutAppend:{}})}function ns(n){return Object.keys(n).length>0&&Object.values(n).some(Re)}function ss(n,s){const{withAppend:t,withoutAppend:a}=es(n,s);return Dn(a)?U(n.room)&&!te(n.gameMode)?"privateRequired":null:ns(t)?"appendWithAction":"pickSomething"}function ts({closeDialog:n,initialTab:s=0,onOpenSetupWizard:t}){const{user:a}=xn(),{t:i}=q(),[l,r]=ke(),[o,c]=d.useState(s),[u,h]=d.useState(null),[y,j]=d.useState(!1),[P,f]=yn(),S=bn(),{isLoading:b,actionsList:p}=vn(P?.gameMode),C=(A,E)=>{c(E)},w=()=>r({...l,boardUpdated:!0}),T=d.useCallback(async A=>{A.preventDefault();const{displayName:E,...H}=P,ee=ss(H,p);return ee?(h(i(ee)),null):(await S(P,p),typeof n=="function"&&n(),null)},[P,p,i,h,S,n]),v=d.useCallback(A=>{f(E=>({...E,displayName:A.target.value}))},[f]),k=d.useCallback(A=>{A.key==="Enter"&&(f(E=>({...E,displayName:A.target.value})),T(A))},[T,f]);return!P.room||b?e.jsxs(x,{children:[e.jsxs(g,{variant:"h2",children:[e.jsx(m,{i18nKey:"loading"}),"..."]}),e.jsx(g,{variant:"body1",children:e.jsx(m,{i18nKey:"clearStorage"})})]}):e.jsxs(x,{component:"form",method:"post",onSubmit:T,className:"settings-box",children:[e.jsx(D,{fullWidth:!0,id:"displayName",label:i("displayName"),defaultValue:a?.displayName||P.displayName||"",required:!0,autoFocus:!0,onBlur:v,onKeyDown:k,margin:"normal"}),e.jsx(x,{sx:{borderBottom:1,borderColor:"divider"},children:e.jsxs(nn,{value:o,onChange:C,"aria-label":i("gameSettings"),centered:!0,children:[e.jsx(re,{label:i("gameboard"),...ie(0)}),e.jsx(re,{label:i("room"),...ie(1)}),e.jsx(re,{label:i("application"),...ie(2)})]})}),e.jsx(ce,{value:o,index:0,style:{p:0},children:e.jsx(_n,{formData:P,setFormData:f,actionsList:p})}),e.jsx(ce,{value:o,index:1,style:{p:0,pt:1},children:e.jsx(Xn,{formData:P,setFormData:f})}),e.jsx(ce,{value:o,index:2,style:{p:0,pt:1},children:e.jsx(Un,{formData:P,setFormData:f,boardUpdated:w})}),e.jsxs("div",{className:"flex-buttons",children:[e.jsxs("div",{className:"left-buttons",children:[t&&e.jsx(z,{variant:"outlined",type:"button",onClick:t,children:e.jsx(m,{i18nKey:"setupWizard"})}),o===0&&e.jsx(z,{variant:"outlined",type:"button",onClick:()=>j(!0),children:e.jsx(m,{i18nKey:"customTilesLabel",children:"Game Tiles"})})]}),e.jsx(z,{variant:"contained",type:"submit",children:e.jsx(m,{i18nKey:"update"})})]}),y&&e.jsx(pn,{open:y,setOpen:j,boardUpdated:w,actionsList:p}),e.jsx(jn,{open:!!u,close:()=>h(null),children:u})]})}const gs=Object.freeze(Object.defineProperty({__proto__:null,default:ts},Symbol.toStringTag,{value:"Module"}));export{ts as G,Ln as L,qn as M,ce as T,Rn as Y,Pn as g,gs as i,Cn as p,ae as t};
//# sourceMappingURL=chunk-Rgv-yxJU.js.map
