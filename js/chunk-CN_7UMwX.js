import{r as f,j as g,ak as M,E as B,m as C,am as D}from"./chunk-D6lSgkQl.js";import{c as P}from"./chunk-CygiBK7d.js";import{g as H}from"./chunk-NPenkmUw.js";import{i as Z}from"./chunk-Dbr53D1p.js";import{l as N}from"./chunk-EL58PX5i.js";import{u as V}from"./chunk-nCrkYniA.js";function J(e){let t="";for(const r of String(e)){const s=r.codePointAt(0);s>=0&&s<=31||s===127||s>=128&&s<=159||s===8232||s===8233||(t+=r)}return`url("${t.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}")`}const z=e=>e&&/\.(jpe?g|png|webp|bmp|svg|gif|avif|tiff?|heic|heif|jfif)(\?.*)?$/i.test(e)?"image":"video";function W({url:e}){const[t,n]=f.useState(z(e)),[r,s]=f.useState(e);if(f.useEffect(()=>{s(e),n(z(e))},[e]),!r)return null;const a=()=>{const c=r??e??"";let p=!1;try{const i=new URL(c);p=i.host==="imgur.com"||i.host==="i.imgur.com"}catch{p=!1}if(p){const i=c.match(/(?:i\.)?imgur\.com\/([a-zA-Z0-9]+)(?:\.[a-z]+)?/)?.[1];if(i){const u=`https://i.imgur.com/${i}.jpg`;s(u),n("image");return}}const d=`${c.replace(/\.(mp4|webm|ogg|mov)(\?.*)?$/i,"")}.jpg`;s(d),n("image")},o=()=>{const c=r??e??"";let p=!1;try{const l=new URL(c);p=l.host==="imgur.com"||l.host==="i.imgur.com"}catch{p=!1}if(p){const l=c.match(/(?:i\.)?imgur\.com\/([a-zA-Z0-9]+)(?:\.[a-z]+)?/)?.[1];if(l){const d=["jpg","png","gif","jpeg","webp"],i=r?.split(".").pop(),m=d.indexOf(i||"")+1;if(m<d.length){const w=d[m],h=`https://i.imgur.com/${l}.${w}`;s(h)}}}else{const l=["jpg","png","gif","jpeg","webp"],d=r?.split(".").pop(),u=l.indexOf(d||"")+1;if(u<l.length&&r){const m=l[u],h=`${r.replace(/\.[^.]+(\?.*)?$/,"")}.${m}`;s(h)}}};return t==="video"?g.jsx("video",{autoPlay:!0,loop:!0,muted:!0,playsInline:!0,src:r||void 0,className:"video-background",onError:a,preload:"auto",crossOrigin:"anonymous",controls:!0}):g.jsxs(g.Fragment,{children:[g.jsx("div",{className:"image-background",style:{backgroundImage:r?J(r):void 0,backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat",width:"100%",height:"100%",position:"absolute",top:0,left:0}}),g.jsx("img",{src:r||void 0,onError:o,style:{display:"none"},alt:""})]})}function K({images:e,className:t,zoomDuration:n=3e3,zoomScale:r=1.4}){const{t:s}=M(),[a,o]=f.useState(0),[c,p]=f.useState(0),[l,d]=f.useState(new Set),[i,u]=f.useState(new Set),[m,w]=f.useState(!1),h=f.useRef(null),x=f.useRef(new Map);f.useEffect(()=>{w(!1),d(new Set),u(new Set),x.current.clear(),o(0),p(0)},[e]),f.useEffect(()=>{if(e.length===0)return;const R=y=>new Promise(U=>{if(x.current.has(y)||i.has(y)){U();return}const $=new Image;$.onload=()=>{x.current.set(y,$),d(S=>{const O=new Set(S).add(y);return!m&&y===e[0]&&w(!0),O}),U()},$.onerror=()=>{u(S=>new Set(S).add(y)),U()},$.src=y});(async()=>{const y=Math.min(5,e.length),U=[];for(let $=0;$<y;$++){const S=(a+$)%e.length;U.push(R(e[S]))}await Promise.all(U)})()},[e,a,i,m]),f.useEffect(()=>{if(e.length===0||e.length===1)return;const R=()=>{h.current=window.setInterval(()=>{o(y=>(y+1)%e.length),p(y=>y+1)},n)},k=window.setTimeout(R,2e3);return()=>{window.clearTimeout(k),h.current&&(window.clearInterval(h.current),h.current=null)}},[e.length,n]),f.useEffect(()=>()=>{h.current&&(window.clearInterval(h.current),h.current=null)},[]);const v=e[a]||"",j=l.has(v)||x.current.has(v),I=i.has(v);return f.useEffect(()=>{if(I&&e.length>1&&!e.every(k=>i.has(k))){const k=(a+1)%e.length;o(k),p(y=>y+1)}},[I,a,e.length,e,i]),e.length===0?null:g.jsxs("div",{className:P("image-slideshow-container",t),"aria-hidden":!0,children:[g.jsx("div",{className:"image-slideshow-fallback"}),!m&&e.length>0&&g.jsx("div",{className:"loading-message",children:s("loadingImages")}),j&&!I&&g.jsx("div",{className:"image-slideshow-slide",style:{backgroundImage:`url(${v})`,animationDuration:`${n}ms`,"--zoom-scale":r}},c)]})}function E(e){return e.replace(/&amp;/g,"&")}const _=["r.jina.ai","api.allorigins.win/get?url=","corsproxy.io/?"],q=(e,t=0)=>{const n=_[t];if(n==="api.allorigins.win/get?url=")return`https://${n}${encodeURIComponent(e)}`;if(n==="corsproxy.io/?")return`https://${n}${encodeURIComponent(e)}`;const r=e.replace(/^https?:\/\//,""),s=e.startsWith("https://")?"https":"http";return`https://${n}/${s}://${r}`};async function X(e,t,n){const r=new Set;let s=null;const a=[p=>`https://www.reddit.com/r/${e}/top.json?limit=100&t=year&raw_json=1${p?`&after=${p}`:""}`,p=>`https://www.reddit.com/r/${e}/hot.json?limit=100&raw_json=1${p?`&after=${p}`:""}`],o=async p=>{try{const l=await fetch(p,{signal:n,credentials:"omit",mode:"cors",headers:{"User-Agent":"BlitzedOut/1.0",Accept:"application/json, text/plain, */*","Accept-Language":"en-US,en;q=0.9"}});if(l.ok){const d=await l.text();try{return JSON.parse(d)}catch{const i=d.indexOf("{"),u=d.lastIndexOf("}");if(i!==-1&&u!==-1&&u>i)try{return JSON.parse(d.slice(i,u+1))}catch{return null}return null}}}catch(l){if(l instanceof DOMException&&l.name==="AbortError")throw l}for(let l=0;l<_.length;l++)try{const d=await fetch(q(p,l),{signal:n,credentials:"omit",mode:"cors",headers:{"User-Agent":"BlitzedOut/1.0",Accept:"application/json, text/plain, */*"}});if(!d.ok)continue;const i=await d.text();let u;try{const m=JSON.parse(i);u=m.contents?JSON.parse(m.contents):m}catch{const m=i.indexOf("{"),w=i.lastIndexOf("}");if(m!==-1&&w!==-1&&w>m)try{u=JSON.parse(i.slice(m,w+1))}catch{continue}else continue}if(u)return u}catch(d){if(d instanceof DOMException&&d.name==="AbortError")throw d;continue}return null};let c=0;for(;r.size<t&&c<a.length;){s=null;for(let p=0;p<5&&r.size<t;p+=1){const l=a[c](s),d=await o(l);if(!d)break;const i=d?.data?.children??[];s=d?.data?.after??null;for(const u of i){const m=u?.data;if(!m)continue;const w=m.url_overridden_by_dest,h=m.post_hint;if(m.is_gallery&&m.media_metadata&&m.gallery_data){const v=m.gallery_data.items||[];for(const j of v){const I=m.media_metadata[j.media_id],R=I?.s?.u||I?.s?.gif||I?.s?.mp4;if(typeof R=="string"){const k=R.startsWith("http")?R:`https:${R}`;/\.(jpe?g|png|gif|webp)(\?.*)?$/i.test(k)&&r.add(E(k))}}continue}if(h==="image"&&typeof w=="string"&&/\.(jpe?g|png|gif|webp)(\?.*)?$/i.test(w)){r.add(E(w));continue}const x=m.preview?.images?.[0]?.source?.url;if(x){const v=x.startsWith("http")?x:`https:${x}`;r.add(E(v))}}if(!s)break}c+=1}return Array.from(r).slice(0,t)}async function Y(e,t){const n=e.maxImages||150;return{images:await X(e.subreddit,n,t),source:`r/${e.subreddit}`}}function F(e){try{const t=new URL(e);return/(^|\.)reddit\.com$/i.test(t.hostname)&&/\/r\//i.test(t.pathname)}catch{return!1}}function G(e){try{return new URL(e).pathname.match(/\/r\/([^/]+)/i)?.[1]??null}catch{return null}}const Q=3e5,T=new Map,L=new Map;async function ee(e,t){const n=JSON.stringify(e),r=Date.now(),s=T.get(n);if(s&&r-s.fetchedAt<Q)return s.result;const a=L.get(n);if(a)try{return await a}catch{}const o=Y(e,t).then(c=>(T.set(n,{fetchedAt:Date.now(),result:c}),c)).finally(()=>{L.delete(n)});return L.set(n,o),o}function te(e){const{t}=M(),[n,r]=f.useState([]),[s,a]=f.useState(!1),[o,c]=f.useState(null),[p,l]=f.useState(null),d=f.useRef(null),i=f.useRef(null),u=f.useRef(null);return f.useEffect(()=>{if(d.current&&d.current.abort(),i.current&&(clearTimeout(i.current),i.current=null),u.current&&(clearTimeout(u.current),u.current=null),r([]),c(null),l(null),!e||!F(e)){a(!1);return}const m=G(e);if(!m){c("invalidRedditUrl"),a(!1);return}const w={subreddit:m,maxImages:150};a(!0);const h=new AbortController;d.current=h;const x=async(v=0)=>{try{const j=await ee(w,h.signal);if(h.signal.aborted)return;r(j.images),l(j.source),c(null),a(!1)}catch{if(h.signal.aborted)return;if(v<2){const I=Math.pow(2,v)*1e3;u.current=setTimeout(()=>{h.signal.aborted||x(v+1)},I);return}c("redditBlocked"),r([]),l(null),a(!1)}};return i.current=setTimeout(x,300),()=>{h.abort(),i.current&&(clearTimeout(i.current),i.current=null),u.current&&(clearTimeout(u.current),u.current=null)}},[e]),f.useEffect(()=>()=>{d.current&&d.current.abort(),i.current&&(clearTimeout(i.current),i.current=null),u.current&&(clearTimeout(u.current),u.current=null)},[]),{images:n,isLoading:s,error:o?t(o):null,source:p}}function ne({url:e}){const{t}=M(),n=B(),{images:r,isLoading:s,error:a}=te(e);return s?g.jsxs("div",{className:"slideshow-container slideshow-loading","aria-hidden":!0,children:[g.jsx("div",{className:"image-slideshow-fallback"}),g.jsx("div",{className:"loading-message",children:t("loadingRedditImages")})]}):a?g.jsxs("div",{className:"slideshow-container slideshow-error","aria-hidden":!0,children:[g.jsx("div",{className:"image-slideshow-fallback"}),g.jsxs("div",{className:"error-message",style:{position:"absolute",bottom:"20px",right:"20px",background:C(n.palette.background.paper,.7),color:n.palette.text.primary,padding:"12px 16px",borderRadius:"8px",fontSize:"14px",maxWidth:"300px",zIndex:1e3},children:[g.jsx("strong",{children:t("redditBackgroundNote")}),g.jsx("br",{}),t("redditBlocked")]})]}):r.length===0?g.jsx("div",{className:"slideshow-container slideshow-empty","aria-hidden":!0,children:g.jsx("div",{className:"image-slideshow-fallback"})}):g.jsx(K,{images:r})}function Ue({url:e=null,isVideo:t=null}){const n=e&&/\.(mp4|webm|ogg|mov|gif)(\?.*)?$/i.test(e),r=e?F(e):!1,s=e==="color"||e==="gray"||e?.includes("/color")||e?.includes("/gray"),a=e&&!s&&(t||!t&&e),o=!t&&r&&e;return g.jsxs(D,{className:P("main-container",!a&&"default-background"),role:"presentation",sx:{backgroundImage:!t&&e&&!s&&!r?`url(${e})`:"none"},children:[t&&!r&&(n?g.jsx(W,{url:e}):g.jsx("iframe",{src:e||void 0,title:"video",width:"100%",height:"100%",allow:"autoplay; fullscreen; encrypted-media; picture-in-picture",sandbox:"allow-same-origin allow-scripts allow-presentation",style:{border:"none"}})),o?g.jsx(ne,{url:e}):null]})}function re(e){const t=/vimeo\.com\/(\d+)/,n=e.match(t);return`https://player.vimeo.com/video/${n?n[1]:""}?autoplay=1&loop=1&autostart=true`}function oe(e){const t=/(?:youtube\.com\/(?:[^/]+\/.+\/|(?:v|e(?:mbed)?)\/|[^#]*[?&]v=|youtu\.be\/)([^"&?/ ]{11})|^(?:[^"&?/ ]{11})$)/,n=e.match(t);return`https://www.youtube.com/embed/${n?n[1]:""}?autoplay=1&loop=1&autostart=true&mute=1&playsinline=1&controls=0&disablekb=1&fs=0&modestbranding=1&rel=0&iv_load_policy=3`}function se(e){const t=/drive\.google\.com\/file\/d\/([^/]+)/,n=e.match(t);return`https://drive.google.com/file/d/${n?n[1]:""}/preview?loop=1`}function ie(e){const t=/dropbox\.com\/s\/([^/]+)/,n=e.match(t);return`https://www.dropbox.com/s/${n?n[1]:""}?raw=1`}function ae(e){return`https://pornhub.com/embed/${new URL(e).searchParams.get("viewkey")||""}?autoplay=1&loop=1&autostart=true&playsinline=1`}function ce(e){const t=e.split("-");return`https://xhamster.com/xembed.php?video=${t[t.length-1]}?autoplay=1&loop=1&autostart=true&playsinline=1`}function de(e){const t=/media1?\.tenor\.com\/(?:m\/)?([a-zA-Z0-9_-]+)\/[^/]*\.(mp4|gif|webp|webm)/,n=e.match(t);if(n){const a=n[2].toLowerCase();return{url:e,isVideo:["mp4","webm"].includes(a)}}const r=/tenor\.com\/view\/[^/]*-(\d+)/,s=e.match(r);return s?{url:`https://tenor.com/embed/${s[1]}`,isVideo:!0}:{url:e,isVideo:!1}}function le(e){const t=/giphy\.com\/gifs\/[^/]*-([a-zA-Z0-9]+)/,n=e.match(t);return`https://media.giphy.com/media/${n?n[1]:""}/giphy.gif`}function ue(e){return/\d+\.media\.tumblr\.com\/.*\.(gif|mp4|webm)(\?.*)?$/i.test(e),e}function me(e){const t=/(?:gfycat\.com|redgifs\.com)\/(?:watch\/)?([a-zA-Z0-9]+)/,n=e.match(t),r=n?n[1]:"";return b(e,["redgifs.com"])?`https://files.redgifs.com/${r}.mp4`:`https://giant.gfycat.com/${r}.mp4`}function fe(e){const t=/redtube\.com\/(\d+)/,n=e.match(t);return`https://embed.redtube.com/?id=${n?n[1]:""}&autoplay=true&auto_play=1&playsinline=1&controls=1`}function pe(e){const t=/youporn\.com\/watch\/(\d+)/,n=e.match(t);return`https://www.youporn.com/embed/${n?n[1]:""}?autoplay=1&playsinline=1`}function ge(e){const t=/tube8\.com\/[^/]+\/[^/]+\/(\d+)/,n=e.match(t);return`https://www.tube8.com/embed/${n?n[1]:""}?autoplay=1&playsinline=1`}function he(e){return`https://twitframe.com/show?url=${encodeURIComponent(e)}`}function be(e){try{const o=new URL(e);if((o.host==="discordapp.net"||o.host.endsWith(".discordapp.net"))&&o.pathname.startsWith("/external/")&&(o.pathname.includes("/https/i.imgur.com/")||o.pathname.includes("/https/imgur.com/")))return e}catch(o){N.debug("URL parsing failed for Discord proxy check:",o)}try{const o=new URL(e);if(o.host==="i.imgur.com"&&(o.search||o.pathname.match(/\.[a-zA-Z0-9]+$/)))return e}catch(o){N.debug("URL parsing failed for direct link check:",o)}let t="",n=!1;try{const o=new URL(e);n=o.host==="imgur.com"||o.host==="i.imgur.com"}catch(o){return N.debug("URL parsing failed for Imgur processing:",o),""}if(!n)return"";if(e.includes("/gallery/")){const o=e.match(/imgur\.com\/gallery\/[^#]*#([a-zA-Z0-9]+)/);if(o)t=o[1];else{const c=e.match(/imgur\.com\/gallery\/.*-([a-zA-Z0-9]+)/);if(c)t=c[1];else return N.debug("Could not extract image ID from gallery URL, returning original:",e),e}}else{const o=/imgur\.com\/([a-zA-Z0-9]+)(?:\.(mp4|mov|avi|webm|mkv|flv|wmv|jpg|jpeg|png|gif|gifv|webp|bmp|tiff|svg))?|images-ext-\d+\.discordapp\.net\/external\/[^/]+\/https\/i\.imgur\.com\/([a-zA-Z0-9]+)\.(mp4|mov|avi|webm|mkv|flv|wmv|jpg|jpeg|png|gif|gifv|webp|bmp|tiff|svg)/,c=e.match(o);t=c?c[1]||c[3]:""}if(!t)return"";const r=e.match(/\.([a-zA-Z0-9]+)(?:\?.*)?$/);let s="jpg";if(r&&r[1]){let o=r[1].toLowerCase();const c={gifv:"mp4"};c[o]&&(o=c[o]),["jpg","jpeg","png","gif","webp","mp4","mov","avi","webm","mkv","flv","wmv","bmp","tiff","svg"].includes(o)&&(s=o)}return`https://i.imgur.com/${t}.${s}`}function A(e){return/\.(mp4|webm|ogg|mov)(\?.*)?$/.test(e)}function we(e){return b(e,["media.discordapp.net","cdn.discordapp.com"])&&!A(e)}function b(e,t){try{const n=new URL(e);return t.some(r=>n.host===r||n.host.endsWith("."+r))}catch(n){return N.debug("URL parsing failed in isValidHost, rejecting for security:",n),!1}}function ye(e){let t=null,n=!0;if(!e)return{url:"",isVideo:!1};switch(!0){case b(e,["vimeo.com"]):t=re(e);break;case b(e,["youtube.com","youtu.be"]):t=oe(e);break;case b(e,["drive.google.com"]):t=se(e);break;case b(e,["pornhub.com"]):t=ae(e);break;case b(e,["xhamster.com"]):t=ce(e);break;case b(e,["dropbox.com"]):t=ie(e);break;case b(e,["imgur.com","i.imgur.com"]):t=be(e);break;case b(e,["tenor.com"]):{const r=de(e);t=r.url,n=r.isVideo;break}case b(e,["giphy.com"]):t=le(e),n=!0;break;case(b(e,["tumblr.com","media.tumblr.com"])||/\d+\.media\.tumblr\.com/.test(e)):t=ue(e),n=t?A(t):!1;break;case b(e,["gfycat.com","redgifs.com"]):t=me(e),n=!0;break;case b(e,["redtube.com"]):t=fe(e);break;case b(e,["youporn.com"]):t=pe(e);break;case b(e,["tube8.com"]):t=ge(e);break;case b(e,["twitter.com","x.com"]):t=he(e),n=!1;break;case b(e,["thisvid.com"]):t=e;break;case b(e,["boyfriendtv.com"]):t=e;break;case we(e):t=e,n=!1;break;case A(e):t=e;break;default:t=H(e),n=!1;break}return{url:t,isVideo:n}}function Se(e,t){const{background:n,backgroundURL:r,roomBackgroundURL:s}=e;let a=null;return n?n==="custom"?a=r||null:n==="useRoomBackground"?!Z(t)&&s?a=s:a="color":a=n:a="color",a||(a="color"),a==="color"||a==="gray"?{url:a,isVideo:!1}:ye(a)}function xe(e){return{uid:e.uid,displayName:e.displayName,isSelf:e.isSelf,isFinished:e.isFinished}}function Ne(e){const[t,n]=f.useState(null),r=V(),s=f.useMemo(()=>r.map(o=>`${o.uid}-${o.displayName}-${o.isFinished}-${o.isSelf}`).join("|"),[r]),a=f.useMemo(()=>e?`${e.uid}-${e.displayName||""}`:null,[e]);return f.useEffect(()=>{if(!e){n(null);return}if(r.length<=1){n(null);return}const o=r.filter(i=>!i.isFinished);if(o.length<=1){n(null);return}let c=-1;c=o.findIndex(i=>i.uid===e.uid),c===-1&&(c=o.findIndex(i=>i.displayName===e.displayName)),c===-1&&(c=0);const p=(c+1)%o.length,l=o[p],d=xe(l);n(d)},[a,s]),t}export{Ue as R,Se as g,ye as p,Ne as u};
