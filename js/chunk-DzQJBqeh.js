import{r as f,j as g,ak as z,am as M}from"./chunk-D6lSgkQl.js";import{c as L}from"./chunk-CygiBK7d.js";import{g as O}from"./chunk-B4PEA_xj.js";import{i as B}from"./chunk-FMb2pEqD.js";import{l as N}from"./chunk-EL58PX5i.js";import{u as T}from"./chunk-DL9gWoVC.js";const A=e=>e&&/\.(jpe?g|png|gif|webp|bmp|svg)(\?.*)?$/i.test(e)?"image":"video";function F({url:e}){const[n,t]=f.useState(A(e)),[r,o]=f.useState(e);if(f.useEffect(()=>{o(e),t(A(e))},[e]),!r)return null;const p=()=>{const a=r??e??"";let m=!1;try{const i=new URL(a);m=i.host==="imgur.com"||i.host==="i.imgur.com"}catch{m=!1}if(m){const i=a.match(/(?:i\.)?imgur\.com\/([a-zA-Z0-9]+)(?:\.[a-z]+)?/)?.[1];if(i){const d=`https://i.imgur.com/${i}.jpg`;o(d),t("image");return}}const c=`${a.replace(/\.(mp4|webm|ogg|mov)(\?.*)?$/i,"")}.jpg`;o(c),t("image")},l=()=>{const a=r??e??"";let m=!1;try{const s=new URL(a);m=s.host==="imgur.com"||s.host==="i.imgur.com"}catch{m=!1}if(m){const s=a.match(/(?:i\.)?imgur\.com\/([a-zA-Z0-9]+)(?:\.[a-z]+)?/)?.[1];if(s){const c=["jpg","png","gif","jpeg","webp"],i=r?.split(".").pop(),u=c.indexOf(i||"")+1;if(u<c.length){const y=c[u],b=`https://i.imgur.com/${s}.${y}`;o(b)}}}else{const s=["jpg","png","gif","jpeg","webp"],c=r?.split(".").pop(),d=s.indexOf(c||"")+1;if(d<s.length&&r){const u=s[d],b=`${r.replace(/\.[^.]+(\?.*)?$/,"")}.${u}`;o(b)}}};return n==="video"?g.jsx("video",{autoPlay:!0,loop:!0,muted:!0,playsInline:!0,src:r||void 0,className:"video-background",onError:p,preload:"auto",crossOrigin:"anonymous",controls:!0}):g.jsxs(g.Fragment,{children:[g.jsx("div",{className:"image-background",style:{backgroundImage:r?`url("${String(r).replace(/\\/g,"\\\\").replace(/"/g,'\\"')}")`:void 0,backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat",width:"100%",height:"100%",position:"absolute",top:0,left:0}}),g.jsx("img",{src:r||void 0,onError:l,style:{display:"none"},alt:""})]})}function D({images:e,className:n,zoomDuration:t=3e3,zoomScale:r=1.4}){const[o,p]=f.useState(0),[l,a]=f.useState(0),[m,s]=f.useState(new Set),[c,i]=f.useState(new Set),d=f.useRef(null),u=f.useRef(new Map);f.useEffect(()=>{if(e.length===0)return;const R=w=>new Promise(I=>{if(u.current.has(w)||c.has(w)){I();return}const v=new Image;v.onload=()=>{u.current.set(w,v),s($=>new Set($).add(w)),I()},v.onerror=()=>{i($=>new Set($).add(w)),I()},v.src=w});(async()=>{const w=Math.min(5,e.length),I=[];for(let v=0;v<w;v++){const $=(o+v)%e.length;I.push(R(e[$]))}await Promise.all(I)})()},[e,o,c]),f.useEffect(()=>{if(e.length===0||e.length===1)return;const R=()=>{d.current=window.setInterval(()=>{p(w=>(w+1)%e.length),a(w=>w+1)},t)},k=window.setTimeout(R,2e3);return()=>{window.clearTimeout(k),d.current&&(window.clearInterval(d.current),d.current=null)}},[e.length,t]),f.useEffect(()=>()=>{d.current&&(window.clearInterval(d.current),d.current=null)},[]);const y=e[o]||"",b=m.has(y)||u.current.has(y),x=c.has(y);return f.useEffect(()=>{if(x&&e.length>1){const R=(o+1)%e.length;p(R),a(k=>k+1)}},[x,o,e.length]),e.length===0?null:g.jsxs("div",{className:L("image-slideshow-container",n),"aria-hidden":!0,children:[g.jsx("div",{className:"image-slideshow-fallback"}),b&&!x&&g.jsx("div",{className:"image-slideshow-slide",style:{backgroundImage:`url(${y})`,animationDuration:`${t}ms`,"--zoom-scale":r}},l)]})}function S(e){return e.replace(/&amp;/g,"&")}const j=["r.jina.ai","api.allorigins.win/get?url=","corsproxy.io/?"],H=(e,n=0)=>{const t=j[n];return t==="api.allorigins.win/get?url="?`https://${t}${encodeURIComponent(e)}`:t==="corsproxy.io/?"?`https://${t}${encodeURIComponent(e)}`:`https://${t}/http://${e.replace(/^https?:\/\//,"")}`};async function Z(e,n,t){const r=new Set;let o=null;const p=[m=>`https://www.reddit.com/r/${e}/top.json?limit=100&t=year&raw_json=1${m?`&after=${m}`:""}`,m=>`https://www.reddit.com/r/${e}/hot.json?limit=100&raw_json=1${m?`&after=${m}`:""}`],l=async m=>{try{const s=await fetch(m,{signal:t,credentials:"omit",mode:"cors",headers:{"User-Agent":"BlitzedOut/1.0",Accept:"application/json, text/plain, */*","Accept-Language":"en-US,en;q=0.9"}});if(s.ok){const c=await s.text();try{return JSON.parse(c)}catch{const i=c.indexOf("{"),d=c.lastIndexOf("}");if(i!==-1&&d!==-1&&d>i)try{return JSON.parse(c.slice(i,d+1))}catch{return null}return null}}}catch(s){console.warn("Direct Reddit fetch failed:",s)}for(let s=0;s<j.length;s++)try{const c=await fetch(H(m,s),{signal:t,credentials:"omit",mode:"cors",headers:{"User-Agent":"BlitzedOut/1.0 (by /u/your_username)",Accept:"application/json, text/plain, */*"}});if(!c.ok)continue;const i=await c.text();let d;try{const u=JSON.parse(i);d=u.contents?JSON.parse(u.contents):u}catch{const u=i.indexOf("{"),y=i.lastIndexOf("}");if(u!==-1&&y!==-1&&y>u)try{d=JSON.parse(i.slice(u,y+1))}catch{continue}else continue}if(d)return console.log(`Successfully fetched Reddit data using proxy service: ${j[s]}`),d}catch(c){console.warn(`Proxy service ${j[s]} failed:`,c);continue}return null};let a=0;for(;r.size<n&&a<p.length;){o=null;for(let m=0;m<5&&r.size<n;m+=1){const s=p[a](o),c=await l(s);if(!c)break;const i=c?.data?.children??[];o=c?.data?.after??null;for(const d of i){const u=d?.data;if(!u)continue;const y=u.url_overridden_by_dest,b=u.post_hint;if(u.is_gallery&&u.media_metadata&&u.gallery_data){const R=u.gallery_data.items||[];for(const k of R){const w=u.media_metadata[k.media_id],I=w?.s?.u||w?.s?.gif||w?.s?.mp4;if(typeof I=="string"){const v=I.startsWith("http")?I:`https:${I}`;/\.(jpe?g|png|gif|webp)(\?.*)?$/i.test(v)&&r.add(S(v))}}continue}if(b==="image"&&typeof y=="string"&&/\.(jpe?g|png|gif|webp)(\?.*)?$/i.test(y)){r.add(S(y));continue}const x=u.preview?.images?.[0]?.source?.url;if(x){const R=x.startsWith("http")?x:`https:${x}`;r.add(S(R))}}if(!o)break}a+=1}return Array.from(r).slice(0,n)}async function C(e,n){const t=e.maxImages||150;return{images:await Z(e.subreddit,t,n),source:`r/${e.subreddit}`}}function P(e){try{const n=new URL(e);return/(^|\.)reddit\.com$/i.test(n.hostname)&&/\/r\//i.test(n.pathname)}catch{return!1}}function J(e){try{return new URL(e).pathname.match(/\/r\/([^/]+)/i)?.[1]??null}catch{return null}}const W=3e5,E=new Map,U=new Map;async function K(e,n){const t=JSON.stringify(e),r=Date.now(),o=E.get(t);if(o&&r-o.fetchedAt<W)return o.result;const p=U.get(t);if(p)try{return await p}catch{}const l=C(e,n).then(a=>(E.set(t,{fetchedAt:Date.now(),result:a}),a)).finally(()=>{U.delete(t)});return U.set(t,l),l}function V(e){const[n,t]=f.useState([]),[r,o]=f.useState(!1),[p,l]=f.useState(null),[a,m]=f.useState(null),s=f.useRef(null);return f.useEffect(()=>{if(s.current&&s.current.abort(),t([]),l(null),m(null),!e||!P(e)){o(!1);return}const c=J(e);if(!c){l("Invalid Reddit URL format"),o(!1);return}const i={subreddit:c,maxImages:150};o(!0);const d=new AbortController;s.current=d;const u=async(b=0)=>{try{const x=await K(i,d.signal);if(d.signal.aborted)return;t(x.images),m(x.source),l(null)}catch(x){if(d.signal.aborted)return;if(b<2){const k=Math.pow(2,b)*1e3;console.warn(`Reddit fetch attempt ${b+1} failed, retrying in ${k}ms:`,x),setTimeout(()=>{d.signal.aborted||u(b+1)},k);return}l("Reddit blocked by browser security. Try disabling Enhanced Tracking Protection."),t([]),m(null)}finally{!d.signal.aborted&&b===0&&o(!1)}},y=window.setTimeout(u,300);return()=>{d.abort(),window.clearTimeout(y)}},[e]),f.useEffect(()=>()=>{s.current&&s.current.abort()},[]),{images:n,isLoading:r,error:p,source:a}}function q({url:e}){const{t:n}=z(),{images:t,isLoading:r,error:o}=V(e);return r?g.jsxs("div",{className:"slideshow-container slideshow-loading","aria-hidden":!0,children:[g.jsx("div",{className:"image-slideshow-fallback"}),g.jsx("div",{className:"loading-message",children:n("loadingRedditImages")})]}):o||t.length===0?o?g.jsxs("div",{className:"slideshow-container slideshow-error","aria-hidden":!0,children:[g.jsx("div",{className:"image-slideshow-fallback"}),g.jsxs("div",{className:"error-message",style:{position:"absolute",bottom:"20px",right:"20px",background:"rgba(0,0,0,0.7)",color:"white",padding:"12px 16px",borderRadius:"8px",fontSize:"14px",maxWidth:"300px",zIndex:1e3},children:[g.jsx("strong",{children:n("redditBackgroundNote")}),g.jsx("br",{}),n("redditBlocked")]})]}):null:g.jsx(D,{images:t})}function be({url:e=null,isVideo:n=null}){const t=e&&/\.(mp4|webm|ogg|mov|gif)(\?.*)?$/i.test(e),r=e?P(e):!1,o=e==="color"||e==="gray"||e?.includes("/color")||e?.includes("/gray"),p=e&&!o&&(n||!n&&e),l=!n&&r&&e;return g.jsxs(M,{className:L("main-container",!p&&"default-background"),role:"presentation",sx:{backgroundImage:!n&&e&&!o&&!r?`url(${e})`:"none"},children:[n&&!r&&(t?g.jsx(F,{url:e}):g.jsx("iframe",{width:"100%",height:"100%",src:e||void 0,title:"video",allow:"autoplay; fullscreen; encrypted-media; picture-in-picture",sandbox:"allow-same-origin allow-scripts allow-presentation",style:{border:0}})),l?g.jsx(q,{url:e}):null]})}function X(e){const n=/vimeo\.com\/(\d+)/,t=e.match(n);return`https://player.vimeo.com/video/${t?t[1]:""}?autoplay=1&loop=1&autostart=true`}function Y(e){const n=/(?:youtube\.com\/(?:[^/]+\/.+\/|(?:v|e(?:mbed)?)\/|[^#]*[?&]v=|youtu\.be\/)([^"&?/ ]{11})|^(?:[^"&?/ ]{11})$)/,t=e.match(n);return`https://www.youtube.com/embed/${t?t[1]:""}?autoplay=1&loop=1&autostart=true&mute=1&playsinline=1&controls=0&disablekb=1&fs=0&modestbranding=1&rel=0&iv_load_policy=3`}function G(e){const n=/drive\.google\.com\/file\/d\/([^/]+)/,t=e.match(n);return`https://drive.google.com/file/d/${t?t[1]:""}/preview?loop=1`}function Q(e){const n=/dropbox\.com\/s\/([^/]+)/,t=e.match(n);return`https://www.dropbox.com/s/${t?t[1]:""}?raw=1`}function ee(e){return`https://pornhub.com/embed/${new URL(e).searchParams.get("viewkey")||""}?autoplay=1&loop=1&autostart=true&playsinline=1`}function te(e){const n=e.split("-");return`https://xhamster.com/xembed.php?video=${n[n.length-1]}?autoplay=1&loop=1&autostart=true&playsinline=1`}function ne(e){const n=/media\.tenor\.com\/([a-zA-Z0-9_-]+)\/[^/]*\.(mp4|gif|webp)/;if(e.match(n))return e;const r=/tenor\.com\/view\/[^/]*-(\d+)/,o=e.match(r);return`https://tenor.com/embed/${o?o[1]:""}?autoplay=1`}function oe(e){const n=/giphy\.com\/gifs\/[^/]*-([a-zA-Z0-9]+)/,t=e.match(n);return`https://media.giphy.com/media/${t?t[1]:""}/giphy.gif`}function re(e){const n=/(?:gfycat\.com|redgifs\.com)\/(?:watch\/)?([a-zA-Z0-9]+)/,t=e.match(n),r=t?t[1]:"";return h(e,["redgifs.com"])?`https://files.redgifs.com/${r}.mp4`:`https://giant.gfycat.com/${r}.mp4`}function se(e){const n=/redtube\.com\/(\d+)/,t=e.match(n);return`https://embed.redtube.com/?id=${t?t[1]:""}&autoplay=true&auto_play=1&playsinline=1&controls=1`}function ie(e){const n=/youporn\.com\/watch\/(\d+)/,t=e.match(n);return`https://www.youporn.com/embed/${t?t[1]:""}?autoplay=1&playsinline=1`}function ae(e){const n=/tube8\.com\/[^/]+\/[^/]+\/(\d+)/,t=e.match(n);return`https://www.tube8.com/embed/${t?t[1]:""}?autoplay=1&playsinline=1`}function ce(e){return`https://twitframe.com/show?url=${encodeURIComponent(e)}`}function de(e){try{const o=new URL(e);if((o.host==="discordapp.net"||o.host.endsWith(".discordapp.net"))&&o.pathname.startsWith("/external/")&&(o.pathname.includes("/https/i.imgur.com/")||o.pathname.includes("/https/imgur.com/")))return e}catch(o){N.debug("URL parsing failed for Discord proxy check:",o)}let n="",t=!1;try{const o=new URL(e);t=o.host==="imgur.com"||o.host==="i.imgur.com"}catch(o){return N.debug("URL parsing failed for Imgur processing:",o),""}if(!t)return"";if(e.includes("/gallery/")){const o=e.match(/imgur\.com\/gallery\/[^#]*#([a-zA-Z0-9]+)/);if(o)n=o[1];else{const p=e.match(/#([a-zA-Z0-9]+)/);p&&(n=p[1])}}else{const o=/imgur\.com\/([a-zA-Z0-9]+)(?:\.(mp4|jpg|jpeg|png|gif|webp))?|images-ext-\d+\.discordapp\.net\/external\/[^/]+\/https\/i\.imgur\.com\/([a-zA-Z0-9]+)\.(mp4|jpg|jpeg|png|gif|webp)/,p=e.match(o);n=p?p[1]||p[3]:""}return`https://i.imgur.com/${n}.mp4`}function _(e){return/\.(mp4|webm|ogg|mov)(\?.*)?$/.test(e)}function le(e){return h(e,["media.discordapp.net","cdn.discordapp.com"])&&!_(e)}function h(e,n){try{const t=new URL(e);return n.some(r=>t.host===r||t.host.endsWith("."+r))}catch(t){return N.debug("URL parsing failed in isValidHost, rejecting for security:",t),!1}}function ue(e){let n=null,t=!0;if(!e)return{url:"",isVideo:!1};switch(!0){case h(e,["vimeo.com"]):n=X(e);break;case h(e,["youtube.com","youtu.be"]):n=Y(e);break;case h(e,["drive.google.com"]):n=G(e);break;case h(e,["pornhub.com"]):n=ee(e);break;case h(e,["xhamster.com"]):n=te(e);break;case h(e,["dropbox.com"]):n=Q(e);break;case h(e,["imgur.com","i.imgur.com"]):n=de(e);break;case h(e,["tenor.com","media.tenor.com"]):n=ne(e),t=!0;break;case h(e,["giphy.com"]):n=oe(e),t=!0;break;case h(e,["gfycat.com","redgifs.com"]):n=re(e),t=!0;break;case h(e,["redtube.com"]):n=se(e);break;case h(e,["youporn.com"]):n=ie(e);break;case h(e,["tube8.com"]):n=ae(e);break;case h(e,["twitter.com","x.com"]):n=ce(e),t=!1;break;case h(e,["thisvid.com"]):n=e;break;case h(e,["boyfriendtv.com"]):n=e;break;case le(e):n=e,t=!1;break;case _(e):n=e;break;default:n=O(e),t=!1;break}return{url:n,isVideo:t}}function xe(e,n){const{background:t,backgroundURL:r,roomBackground:o,roomBackgroundURL:p}=e,l=(s,c)=>{if(!s)return null;if(s==="custom")return c?p||null:r||null;if(s==="useAppBackground"){const i=t||"color";return i==="useRoomBackground"?"color":i==="custom"?r||null:i}if(s==="useRoomBackground"){if(B(n))return"color";const i=o||"useAppBackground";return i==="useAppBackground"?"color":i==="custom"?p||null:i}return s};let a=null;return!B(n)&&o&&o!=="useAppBackground"?a=l(o,!0):t?a=l(t,!1):a="color",a?a==="color"||a==="gray"?{url:a,isVideo:!1}:ue(a):{url:null,isVideo:!1}}function me(e){return{uid:e.uid,displayName:e.displayName,isSelf:e.isSelf,isFinished:e.isFinished}}function Ie(e){const[n,t]=f.useState(null),r=T(),o=f.useMemo(()=>r.map(l=>`${l.uid}-${l.displayName}-${l.isFinished}-${l.isSelf}`).join("|"),[r]),p=f.useMemo(()=>e?`${e.uid}-${e.displayName||""}`:null,[e]);return f.useEffect(()=>{if(!e){t(null);return}if(r.length<=1){t(null);return}const l=r.filter(i=>!i.isFinished);if(l.length<=1){t(null);return}let a=-1;a=l.findIndex(i=>i.uid===e.uid),a===-1&&(a=l.findIndex(i=>i.displayName===e.displayName)),a===-1&&(a=0);const m=(a+1)%l.length,s=l[m],c=me(s);t(c)},[p,o]),n}export{be as R,xe as g,ue as p,Ie as u};
