import{v as X,q as w,r as f,j as e,t as x,u as D,m as je}from"./chunk-DDoLnHI0.js";import{B as T,ap as O,aq as M,ar as K,m as ee,w as S,o as ie,E as me,S as z,T as m,D as U,G as C,ao as R,ag as fe,ah as be,az as ye,aj as ve,aA as Se,aB as Ce,aC as we,O as I,aD as ne,ad as ke,X as Te,Y as _,h as re}from"./chunk-D59Sa5ya.js";import{T as Be}from"./chunk-BDM5WtNj.js";import{i as k,a as P,b as J}from"./chunk-Bp62TkGl.js";import{u as ae}from"./chunk-CXIw3Iqt.js";import{u as V}from"./chunk-BmcVylZL.js";import{u as Ue,a as Re,C as $e}from"./chunk-B0nG6Nel.js";import{i as Oe,g as ce,u as de,e as ue,l as Ae,m as Le,s as he}from"../assets/index-BodytYbc.js";import{i as W,t as te}from"./chunk-Dk7I1tJi.js";import{g as Me}from"./chunk-CoPHbQIg.js";import{a as Ke,i as Ie}from"./chunk-B4PEA_xj.js";import{u as Ne}from"./chunk-CrCBoQmf.js";function Pe(n){for(let t=n.length-1;t>0;t-=1){const s=Math.floor(Math.random()*(t+1));[n[t],n[s]]=[n[s],n[t]]}return n}function oe(n){n.length>1&&n.push(n.shift())}function Pn(n,t){return n?.length!==t?.length?!1:n.every((s,i)=>s===t[i])}const{t:L}=W;function Ee(n,t){return n.filter(s=>t==="vers"?s.includes("{sub}")&&s.includes("{dom}")||s.includes("{player}"):!s.match(/{(dom|sub)}/)||s.includes(`{${t}}`))}function Ge(n,t,s){const i=n[t]?.role??n.role??"sub";return Object.keys(s).reduce((r,l,a)=>(a>0&&a<=n[t]?.level&&(r[l]=Pe(Ee(s[l],i))),r),{})}function We(n,t){return Object.entries(n).filter(([s])=>t[s]?.level>0).map(([s,i])=>({label:i.label,actions:Ge(t,s,i?.actions),key:s,standalone:!1,role:t[s]?.role??t.role??"sub"}))}function ze(n,t){return t.length&&(t.some(({group:s})=>s==="misc")&&n.push({label:L("misc"),actions:{All:[]},key:"misc",standalone:!1}),t.forEach(({group:s,intensity:i,action:o})=>{const r=n.find(l=>l.key===s);if(r&&Object.keys(r.actions).length>=i){const l=Object.values(r.actions)[i-1];if(l){const a=Math.floor(Math.random()*(l.length+1));l.splice(a,0,o)}}})),n}function Ve(n){return Object.entries(n).reduce((t,[s,i])=>(i?.variation&&(t[s]=i),t),{})}function qe(n,t){const s=[],i=[...t];return Object.entries(n).forEach(([o,{level:r,variation:l}])=>{if(r<=0)return;const a=t.findIndex(c=>c.key===o);if(a===-1)return;if(l==="standalone"){i[a]&&(i[a].standalone=!0);return}const d=l==="appendSome"?.4:.9;s.push({...t[a],frequency:d}),i.splice(a,1)}),{appendList:s,listWithoutAppend:i}}function Fe(n,t,s,i){if([void 0,"normal"].includes(i)){const o=n/t;return Math.floor(s/o)}return t>=3&&Math.random()>=.6?t-2:t-1}function le(n,t,s,i){if(!n.length)return{title:"",description:""};oe(n);const{actions:o,label:r,standalone:l,frequency:a,role:d}=n[0],c=Math.random();if(a&&a<=c)return{title:"",description:""};const p=Object.keys(o),g=Object.values(o);let h=Fe(t,p.length,s,i?.difficulty);return g[h]||(h=Math.max(0,h-1)),g[h]&&g[h].length>0?(oe(g[h]),{title:r,description:g[h][0],standalone:l,role:d}):{title:"",description:""}}function _e(n,t,s){const i=Ve(t),{listWithoutAppend:o,appendList:r}=qe(i,n),l=[];for(let a=1;a<=s;a+=1){const{title:d,description:c,standalone:p,role:g}=le(o,s,a,t);let h="";if(!p&&r.length&&c){const{description:u}=le(r,s,a,t);u?h=`${u.trim().replace(/([^.,!?])$/,"$1.")} ${c}`:h=c}else h=c||"";l.push({title:d,description:h.trim(),role:g})}return l}function Je(n,t){const s={title:L("start"),description:L("start")},{finishRange:i=[33,66]}=t,o=`${L("noCum")} ${i[0]}%\r
${L("ruined")} ${i[1]-i[0]}%\r
${L("cum")} ${100-i[1]}%`,r={title:L("finish"),description:o};return[s,...n,r]}function He(n,t,s=[],i=40){const o=We(t,n);!o.length&&!s.length&&(localStorage.clear(),window.location.reload());const r=ze(o,s),l=_e(r,n,i-2);return Je(l,n)}function Ye(){const n=X(ue),[t,s]=V(),{i18n:i}=w(),o=f.useCallback(async r=>{const l=r?.roomUpdate||r?.boardUpdated?r:{...t,...r};let{gameMode:a,boardUpdated:d}=l;const{roomTileCount:c=40,finishRange:p,room:g}=l,h=k(g||"");if(!r||!p)return{gameMode:a};h&&!P(a||"")&&(a="online",d=!0);const u=await Oe(i.resolvedLanguage,a||"online"),j=h?40:c||40,b=await ce(a||"online"),y=He(l,u,b,j);return(r?.boardUpdated||d||n?.tiles?.length!==y.length)&&(await s(l),await de({title:n?.title||"",tiles:y})),{settingsBoardUpdated:d,gameMode:a,newBoard:y}},[n,i.resolvedLanguage,t,s]);return f.useCallback(r=>o(r),[o])}function H({children:n,value:t,index:s,style:i,...o}){return e.jsx("div",{role:"tabpanel",hidden:t!==s,id:`simple-tabpanel-${s}`,"aria-labelledby":`simple-tab-${s}`,...o,children:t===s&&e.jsx(T,{sx:{p:3,...i},children:n})})}function xe({formData:n,setFormData:t,backgrounds:s,isRoom:i=!1}){const{t:o}=w(),r=i?"roomBackground":"background",l=i?"roomBackgroundURL":"backgroundURL",[a,d]=f.useState(n?.[r]||Object.keys(s)[0]),c=()=>Object.entries(s).map(([h,u])=>e.jsx(S,{value:h,children:u},h)),p=h=>{t({...n,[r]:h.target.value}),d(h.target.value)};f.useEffect(()=>{a!==n?.[r]&&d(n?.[r]||"")},[n,a,r]);const g=h=>{const u={...n,[r]:"custom",[l]:h.target.value};i&&(u.roomUpdated=!0),t(u)};return e.jsxs(e.Fragment,{children:[e.jsxs(O,{fullWidth:!0,margin:"normal",children:[e.jsx(M,{id:"background-label",children:o("background")}),e.jsx(K,{labelId:"background-label",id:"background",label:o("background"),value:a||"",onChange:p,children:c()})]}),a==="custom"&&e.jsx(ee,{sx:{mt:2},label:o("url"),value:n?.[l]||"",fullWidth:!0,onChange:g,helperText:e.jsxs(e.Fragment,{children:[o("supportedSites"),e.jsx("br",{}),o("requiresEmbeddedUrl")]})})]})}function Qe({boardUpdated:n}){const{i18n:t}=w(),[s,i]=f.useState(t.resolvedLanguage||"en");function o(l){i(l),t.changeLanguage(l),n()}const r=Object.entries(Ae).map(([l,a])=>e.jsx(S,{value:l,children:a.label},l));return e.jsx(T,{sx:{minWidth:120,mt:1,mb:2},children:e.jsxs(O,{fullWidth:!0,children:[e.jsxs(M,{id:"language-label",sx:{display:"flex",alignItems:"center"},children:[e.jsx(ie,{sx:{mr:1}}),e.jsx(x,{i18nKey:"language"})]}),e.jsx(K,{labelId:"language-label",id:"language-select",value:s,label:e.jsxs(e.Fragment,{children:[e.jsx(ie,{}),e.jsx(x,{i18nKey:"language"})]}),onChange:l=>o(l.target.value),children:r})]})})}function Xe({trueCondition:n,onChange:t,yesLabel:s,noLabel:i=null,sx:o={}}){const r=i??s;return e.jsx(T,{sx:{display:"flex",justifyContent:"center",my:1,...o},children:e.jsx(me,{control:e.jsx(z,{checked:n||!1,onChange:t}),label:te(n?s:r)})})}function $({field:n,formData:t,handleSwitch:s}){return e.jsx(Xe,{trueCondition:t[n],onChange:i=>s(i,n),yesLabel:`${n}Enable`,sx:{justifyContent:"left"}})}function Ze({formData:n,setFormData:t,boardUpdated:s}){const[i,o]=V(),{t:r}=w(),l={color:r("color"),gray:r("gray"),"metronome.gif":r("hypnoDick"),"pink-spiral.gif":r("pinkSpiral"),custom:r("customURL")};function a(d,c){t({...n,[c]:d.target.checked}),o({...i,[c]:d.target.checked})}return e.jsxs(e.Fragment,{children:[e.jsx(Qe,{boardUpdated:s}),e.jsx(m,{variant:"h5",children:e.jsx(x,{i18nKey:"dialog"})}),e.jsx($,{field:"playerDialog",formData:n,handleSwitch:a}),e.jsx($,{field:"othersDialog",formData:n,handleSwitch:a}),e.jsx(U,{}),e.jsx(m,{variant:"h5",sx:{mt:2},children:e.jsx(x,{i18nKey:"sounds"})}),e.jsx($,{field:"mySound",formData:n,handleSwitch:a}),e.jsx($,{field:"otherSound",formData:n,handleSwitch:a}),e.jsx($,{field:"chatSound",formData:n,handleSwitch:a}),e.jsx($,{field:"readRoll",formData:n,handleSwitch:a}),e.jsx(U,{}),e.jsx(m,{variant:"h5",sx:{mt:2,textTransform:"capitalize"},children:e.jsx(x,{i18nKey:"misc"})}),e.jsx($,{field:"hideBoardActions",formData:n,handleSwitch:a}),e.jsx($,{field:"advancedSettings",formData:n,handleSwitch:a}),e.jsx(xe,{formData:n,setFormData:t,backgrounds:l}),e.jsx(U,{})]})}function Y({children:n}){return e.jsx(C,{size:{xs:12,md:5},children:n})}const Z=f.forwardRef(({value:n,onChange:t,label:s,options:i,defaultValue:o=null,sx:r,helpIcon:l=!1,fullWidth:a=!0,...d},c)=>{const p=i.map(g=>typeof g=="string"?e.jsx(S,{value:g,children:te(g)},g):e.jsx(S,{value:g.value,children:g.label},g.value));return e.jsxs(O,{fullWidth:a,margin:"normal",sx:r,...d,ref:c,children:[e.jsxs(M,{id:`${s}Label`,children:[e.jsx(x,{i18nKey:s}),!!l&&e.jsx(R,{sx:{ml:1,fontSize:16}})]}),e.jsx(K,{labelId:`${s}Label`,id:s,label:e.jsxs(e.Fragment,{children:[e.jsx(x,{i18nKey:s}),!!l&&e.jsx(R,{sx:{ml:1,fontSize:16}})]}),value:n||o||"",onChange:t,children:p})]})});function Q({children:n,title:t,subtitle:s,defaultExpanded:i=!1,...o}){return e.jsxs(fe,{defaultExpanded:i,...o,sx:{backgroundColor:"inherit",backgroundImage:"none",boxShadow:"none"},children:[e.jsxs(be,{expandIcon:e.jsx(ye,{}),sx:{px:0},children:[e.jsxs(m,{variant:"h6",sx:{width:"33%"},children:[t,":"]}),e.jsx(m,{sx:{pt:.5},children:s})]}),e.jsx(ve,{sx:{px:0},children:e.jsx(C,{container:!0,columnSpacing:2,justifyContent:"space-evenly",className:"columned-grid",children:n})})]})}function De({formData:n,setFormData:t}){const s=(o,r)=>{t({...n,finishRange:r,boardUpdated:!0})},i=n?.finishRange||[30,70];return e.jsxs(T,{children:[e.jsx(U,{}),e.jsx(m,{id:"finish-slider",sx:{my:1},children:e.jsx(x,{i18nKey:"finishSlider"})}),e.jsx(Se,{"aria-labelledby":"finish-slider",value:i,onChange:s,valueLabelDisplay:"off"}),e.jsxs(T,{display:"flex",flexDirection:"column",justifyContent:"space-between",textAlign:"center",children:[e.jsxs(m,{whiteSpace:"nowrap",children:[e.jsx(x,{i18nKey:"noCum"})," ",i[0],"%"]}),e.jsxs(m,{whiteSpace:"nowrap",children:[e.jsx(x,{i18nKey:"ruined"})," ",i[1]-i[0],"%"]}),e.jsxs(m,{whiteSpace:"nowrap",children:[e.jsx(x,{i18nKey:"cum"})," ",100-i[1],"%"]})]}),e.jsx(U,{sx:{my:1}})]})}function en(){const[n,t]=f.useState(!1);return f.useEffect(()=>{const s=window.matchMedia("(pointer: fine)");t(s.matches);const i=o=>{t(o.matches)};return s.addEventListener("change",i),()=>{s.removeEventListener("change",i)}},[]),n}function nn({actionsFolder:n,settings:t,option:s,onChange:i,initValue:o=0}){const r=`${s}label`,l=n[s]?.label,a=en(),[d,c]=f.useState(t[s]?.level||0),p=j=>{const b={...j,target:{...j.target,value:Number(j.target.value)}};i(b)},g=j=>{c(j)},h=j=>d>0&&j===0?!1:t.difficulty==="accelerated"?d<=2?d===j:d===j||d-1===j:d>=j;function u(j){return Object.keys(n[j]?.actions||{}).map((b,y)=>e.jsxs(S,{value:y,onMouseOver:()=>g(y),children:[!!a&&e.jsx("span",{className:"menu-item-icon",children:h(y)?e.jsx(Ce,{}):e.jsx(we,{})}),b]},`${j}-${b}`))}return e.jsxs(O,{margin:"normal",fullWidth:!0,children:[e.jsx(M,{id:r,children:l}),e.jsx(K,{labelId:r,id:s,label:l,value:t[s]?.level||o,onChange:p,onOpen:()=>c(t[s]?.level||o),onClose:()=>c(t[s]?.level||o),children:u(s)})]})}function tn({option:n,settings:t,setSettings:s,actionsFolder:i,type:o,showVariation:r=!1,showRole:l=!1}){const{t:a}=w(),d=`${n}label`,c=i[n]?.label;function p(u,j,b){s({...t,[j]:{...t[j],type:o,[b]:u?.target?.value},boardUpdated:!0})}let g=12;(r||l)&&(g=6);let h=["dom","vers","sub"];return i[n]?.dom&&(h=[{label:i[n].dom,value:"dom"},{label:a("vers"),value:"vers"},{label:i[n].sub,value:"sub"}]),e.jsxs(C,{container:!0,justifyContent:"center",children:[e.jsx(C,{size:g,children:e.jsx(nn,{actionsFolder:i,settings:t,option:n,onChange:u=>p(u,n,"level")})}),!!l&&e.jsx(C,{size:6,children:e.jsx(Z,{sx:{ml:1},value:t[n]?.role,onChange:u=>p(u,n,"role"),label:`${a("role")}: ${c}`,options:h,defaultValue:t.role||"sub"})}),!!r&&e.jsx(C,{size:6,children:e.jsx(I,{placement:"top",title:e.jsxs(x,{i18nKey:"variationTooltip",children:[e.jsx(m,{variant:"subtitle2",children:"Standalone = Its own tile. "}),e.jsx(m,{variant:"subtitle2",children:"Append Some = 50% chance."}),e.jsx(m,{variant:"subtitle2",children:"Append Most = 90% chance."})]}),arrow:!0,children:e.jsxs(O,{fullWidth:!0,margin:"normal",sx:{ml:1},children:[e.jsxs(M,{id:`${d}Variation`,children:[`${c} ${a("variation")}`,e.jsx(R,{sx:{ml:1,fontSize:16}})]}),e.jsxs(K,{labelId:`${d}Variation`,id:`${n}Variation`,label:e.jsxs(e.Fragment,{children:[c," ",a("variation"),e.jsx(R,{sx:{ml:1,fontSize:16}})]}),value:t[n]?.variation||"standalone",onChange:u=>p(u,n,"variation"),children:[e.jsx(S,{value:"standalone",children:e.jsx(x,{i18nKey:"standalone"})}),e.jsx(S,{value:"appendSome",children:e.jsx(x,{i18nKey:"appendSome"})}),e.jsx(S,{value:"appendMost",children:e.jsx(x,{i18nKey:"appendMost"})})]})]})})})]},n)}function sn({formData:n,setFormData:t}){return e.jsxs(ne,{direction:"row",spacing:1,alignItems:"center",justifyContent:"center",sx:{mt:1},children:[e.jsx(m,{children:e.jsx(x,{i18nKey:"solo"})}),e.jsx(I,{title:e.jsx(m,{variant:"subtitle2",children:e.jsx(x,{i18nKey:"soloTooltip"})}),arrow:!0,children:e.jsx(R,{sx:{fontSize:15}})}),e.jsx(z,{id:"gameMode",checked:!P(n.gameMode),onChange:s=>t({...n,gameMode:s.target.checked?"local":"online",boardUpdated:!0}),inputProps:{"aria-label":"Game Type"}}),e.jsx(m,{children:e.jsx(x,{i18nKey:"local"})}),e.jsx(I,{title:e.jsx(m,{variant:"subtitle2",children:e.jsx(x,{i18nKey:"localTooltip"})}),arrow:!0,children:e.jsx(R,{sx:{fontSize:15}})})]})}function rn({formData:n}){const[t,s]=f.useState(!1);return f.useEffect(()=>{const i=Object.values(n).filter(r=>typeof r=="object"&&r?.type==="consumption"&&r?.level>0).length,o=Object.values(n).filter(r=>typeof r=="object"&&r?.level>0).length;s(i>1&&i>=o-i)},[n]),t?e.jsx(ke,{severity:"warning",children:e.jsx(x,{i18nKey:"consumptionWarning"})}):null}function on({formData:n,setFormData:t,actionsList:s}){const{t:i}=w(),o=!k(n?.room)&&!P(n.gameMode);function r(a,d={}){return Object.keys(s).filter(c=>s[c]?.type===a).map(c=>e.jsx(Y,{children:e.jsx(tn,{option:c,settings:n,setSettings:t,actionsFolder:s,type:a,...d})},c))}const l=a=>{const d=JSON.parse(JSON.stringify(n));return Object.keys(d).forEach(c=>{d.role=a,c.includes("role")&&(d[c]=a)}),d};return e.jsxs(e.Fragment,{children:[e.jsx(sn,{formData:n,setFormData:t}),k(n?.room)&&!P(n.gameMode)&&e.jsx(C,{container:!0,alignContent:"center",justifyContent:"space-evenly",children:e.jsx(C,{sx:{py:3},children:e.jsx(m,{variant:"h5",children:e.jsx(x,{i18nKey:"privateRequired"})})})}),e.jsxs(C,{container:!0,columnSpacing:2,justifyContent:"space-evenly",children:[e.jsx(Y,{children:e.jsx(I,{placement:"top",title:e.jsx(x,{i18nKey:"difficultyTooltip",children:e.jsxs(m,{variant:"body2",children:["Normal = Slow ramp up. ",e.jsx("br",{}),e.jsx("br",{}),"Accelerated = Straight to max level + the level prior to it."]})}),arrow:!0,children:e.jsx(Z,{value:n.difficulty,onChange:a=>t({...n,difficulty:a.target.value,boardUpdated:!0}),label:"difficulty",options:["normal","accelerated"],defaultValue:"normal",helpIcon:!0})})}),o&&e.jsx(Y,{children:e.jsx(Z,{value:n.role,onChange:a=>t({...l(a.target.value),boardUpdated:!0}),label:"mainRole",options:["dom","vers","sub"],defaultValue:"sub"})})]}),o?e.jsxs(e.Fragment,{children:[e.jsx(Q,{title:i("consumption"),subtitle:i("consumptionSubtitle"),children:r("consumption",{showVariation:!0})}),e.jsx(Q,{title:i("foreplay"),subtitle:i("foreplaySubtitle"),children:r("foreplay",{showRole:o})}),e.jsx(Q,{title:i("sex"),subtitle:i("sexSubtitle"),children:r("sex",{showRole:o})})]}):e.jsxs(e.Fragment,{children:[e.jsx(C,{container:!0,columnSpacing:2,justifyContent:"space-evenly",children:r("consumption",{showVariation:!0})}),e.jsx(U,{}),e.jsx(C,{container:!0,columnSpacing:2,justifyContent:"center",children:r("solo")})]}),e.jsx(De,{setFormData:t,formData:n}),e.jsx(rn,{formData:n})]})}function ln({formData:n,setFormData:t}){const{t:s}=w(),i={"1d4":2.5,"1d6":3.5,"2d4":5},o=n?.roomTileCount?Math.floor(n.roomTileCount/i[n.roomDice||"1d6"]):16,r=Array.from({length:7},(l,a)=>(a+2)*10).map(l=>e.jsx(S,{value:l,children:l},l));return e.jsxs(e.Fragment,{children:[e.jsx(m,{children:e.jsx(x,{i18nKey:"gameSpeed"})}),e.jsxs(T,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[e.jsxs(O,{sx:{m:1},fullWidth:!0,children:[e.jsx(M,{id:"diceRole-label",children:e.jsx(x,{i18nKey:"roomDice"})}),e.jsxs(K,{labelId:"diceRole-label",id:"diceRole-select",value:n?.roomDice||"1d4",label:s("roomDice"),onChange:l=>t({...n,roomDice:l.target.value,roomUpdated:!0}),children:[e.jsx(S,{value:"1d4",children:"1d4"}),e.jsx(S,{value:"1d6",children:"1d6"}),e.jsx(S,{value:"2d4",children:"2d4"})]})]}),e.jsxs(O,{sx:{m:1},fullWidth:!0,children:[e.jsx(M,{id:"tile-count-label",children:e.jsx(x,{i18nKey:"roomTileCount"})}),e.jsx(K,{labelId:"tile-count-label",id:"tile-count-select",value:String(n?.roomTileCount||40),label:s("roomTileCount"),onChange:l=>t({...n,roomTileCount:Number(l.target.value),roomUpdated:!0}),children:r})]}),e.jsx(O,{fullWidth:!0,children:e.jsxs(m,{children:[e.jsx(x,{i18nKey:"averageRolls"}),o]})})]})]})}function an({formData:n,setFormData:t}){const s=f.useCallback(()=>{t({...n,roomRealtime:!n.roomRealtime,roomUpdated:!0})},[n,t]);return e.jsxs(e.Fragment,{children:[e.jsx(m,{children:e.jsx(x,{i18nKey:"playerListOptions"})}),e.jsxs(ne,{direction:"row",spacing:1,alignItems:"center",justifyContent:"center",sx:{width:"100%"},children:[e.jsx(m,{children:e.jsx(x,{i18nKey:"realtime"})}),e.jsx(I,{title:e.jsx(m,{variant:"subtitle2",children:e.jsx(x,{i18nKey:"realtimeTooltip"})}),arrow:!0,children:e.jsx(R,{sx:{fontSize:15}})}),e.jsx(z,{id:"showPrivate",checked:!!n.roomRealtime,onChange:s,inputProps:{"aria-label":te("playerList")}}),e.jsx(m,{children:e.jsx(x,{i18nKey:"delayed"})}),e.jsx(I,{title:e.jsx(m,{variant:"subtitle2",children:e.jsx(x,{i18nKey:"delayedTooltip"})}),arrow:!0,children:e.jsx(R,{sx:{fontSize:15}})})]})]})}function cn({formData:n,setFormData:t}){const{id:s}=D(),{t:i}=w(),o=c=>{let p;c.target.checked&&k(s)?p=Me("123456789ABCDEFGHJKLMNPQRSTUVWXYZ",5)():s&&c.target.checked&&!k(s)?p=s:p="PUBLIC",t({...n,room:p.toUpperCase(),gameMode:k(p)?"online":n.gameMode})},r=f.useCallback(c=>{t({...n,room:c.currentTarget.value,boardUpdated:!0})},[n,t]),l=f.useCallback(c=>{c.key==="Enter"&&t({...n,room:c.currentTarget.value,boardUpdated:!0})},[n,t]),a=f.useCallback(c=>{const p=c.target.value.toUpperCase();c.target.value=p},[]),d=!k(n.room);return e.jsxs(e.Fragment,{children:[e.jsxs(ne,{direction:"row",spacing:1,alignItems:"center",justifyContent:"center",sx:{width:"100%"},children:[e.jsx(m,{children:e.jsx(x,{i18nKey:"public"})}),e.jsx(z,{id:"showPrivate",checked:d,onChange:o,slotProps:{input:{"aria-label":i("room")}}}),e.jsx(m,{children:e.jsx(x,{i18nKey:"private"})}),e.jsx(I,{title:e.jsx(m,{variant:"subtitle2",children:e.jsx(x,{i18nKey:"privateOptions"})}),arrow:!0,children:e.jsx(R,{sx:{fontSize:15}})})]}),d&&e.jsx(ee,{fullWidth:!0,id:"privateRoom",label:"Private Room",defaultValue:n.room?.toUpperCase(),margin:"normal",onBlur:r,onKeyDown:l,onChange:a,inputProps:{style:{textTransform:"uppercase"}}})]})}function dn({formData:n,setFormData:t}){const{t:s}=w(),i={app:s("appBackground"),custom:s("customURL")};return e.jsxs(T,{sx:{margin:"0.5rem"},children:[e.jsx(cn,{formData:n,setFormData:t}),!k(n.room)&&e.jsxs(e.Fragment,{children:[e.jsx(U,{sx:{my:1}}),e.jsx(ln,{formData:n,setFormData:t}),e.jsx(U,{sx:{my:1}}),e.jsx(an,{formData:n,setFormData:t}),e.jsx(U,{sx:{my:1}}),e.jsx(xe,{formData:n,setFormData:t,backgrounds:i,isRoom:!0})]})]})}function un(n){return Object.values(n).some(({level:t})=>t>0)}function hn(n,t){return Object.entries(n).reduce((s,[i,o])=>(i in t&&(o?.variation?.startsWith("append")?s.withAppend[i]=o:s.withoutAppend[i]=o),s),{withAppend:{},withoutAppend:{}})}function xn(n){return Object.keys(n).length>0&&Object.values(n).some(({level:t})=>t>0)}function pn(n,t){const{withAppend:s,withoutAppend:i}=hn(n,t);return un(i)?k(n.room)&&!P(n.gameMode)?"privateRequired":null:xn(s)?"appendWithAction":"pickSomething"}function gn(n,t,s){const i=Object.entries(s).filter(([r])=>n[r]).reduce((r,[l,a])=>(r[l]=Object.keys(a.actions).slice(1,n[l]+1),r),{});return(t?.filter(r=>{if(r.group==="misc")return!0;const l=i[r.group];return l&&l.length>=Number(r.intensity)})||[]).length}function jn(n,t,s,i){const{t:o}=W;let r=`### ${W.t("gameSettings")}\r
`;if(i&&(r+=`##### ${i}\r
`),r+=`--- \r
`,Object.entries(s).forEach(([c,p])=>{if(!n[c])return;const{role:g,variation:h,level:u}=n[c],j=g||n.role||"sub";if(u>0){const b=Object.keys(p?.actions||{});if(r+=`* ${p?.label}: ${b[u]||""}`,h&&(r+=` (${o(h)})`),!P(n.gameMode)&&!h){const y=p[j]??o(j);r+=` (${y})`}r+=`\r
`}}),r.endsWith(`--- \r
`))return"";const{finishRange:l,difficulty:a}=n;r+=`--- \r
`,r+=`* ${o("difficulty")}: ${o(a??"normal")} \r
`,l&&(r+=`* ${o("finishSlider")} ${l[0]}%  | ${l[1]-l[0]}% | ${100-l[1]}%`);const d=gn(n,t,s);return d&&(r+=`* ${o("customTilesLabel")}: ${d} \r
`),r}function mn(n){const t={};return Object.entries(n).forEach(([s,i])=>{!["displayName","background","boardUpdated","chatSound","mySound","otherSound","othersDialog","playerDialog","readRoll","hideBoardActions","advancedSettings"].includes(s)&&!s.startsWith("room")&&(t[s]=i)}),t}async function fn({title:n,formData:t,user:s,actionsList:i,tiles:o,customTiles:r=[],reason:l=""}){const a=JSON.stringify(mn(t)),d=await Le({title:n,gameBoard:JSON.stringify(o),settings:a}),c=jn(t,r,i,l);if(!(!d?.id||c===""))return he({room:t?.room||"PUBLIC",user:s,text:c,type:"settings",gameBoardId:d.id,boardSize:o.length,gameMode:t.gameMode})}function bn(n){const{t}=W;let s=`### ${t("roomSettings")}\r
`;return Object.entries(n).forEach(([i,o])=>{if(i!=="room"){if(i==="roomBackgroundURL"&&o!==""){s+=`* ${t(i)}: [${Ke(o)}:link:](${o})\r
`;return}if(i==="roomRealtime"){s+=`* ${t("playerList")}: ${t(o?"delayed":"realtime")}\r
`;return}o!==""&&(s+=`* ${t(i)}: ${o}\r
`)}}),s}function yn(n){const t={};return Object.entries(n).forEach(([s,i])=>{s.startsWith("room")&&!["roomUpdated","roomBackground"].some(o=>o===s)&&(t[s]=i)}),t}async function vn(n,t,s){let i=n;return t!==void 0&&t.length>0&&(i=await s(t)),i}function Sn(n,t){const s=yn(n);return he({room:n.room,user:t,text:bn(s),type:"room",settings:JSON.stringify(s)})}function pe(){const{id:n}=D(),t=je();return s=>{if(n!==void 0&&n?.toUpperCase()!==s?.toUpperCase()){const i=s?.replace(/^\/+/,"")||"PUBLIC";t(`/${i}`)}}}function Cn(n){(!n.roomBackgroundURL||!Ie(n.roomBackgroundURL))&&(n.roomBackground="app")}function wn(){const{user:n,updateUser:t}=ae(),{id:s}=D(),{t:i}=w(),o=Ye(),[r,l]=V(),a=X(()=>ce(r?.gameMode)),d=X(ue),c=pe(),{messages:p}=Ne(),g=f.useCallback(u=>{const j=s?.toUpperCase()!==u.room.toUpperCase(),b=!!(u.room&&!k(u.room)),y=b&&u.roomTileCount!==r?.roomTileCount;return{roomChanged:j,isPrivateRoom:b,privateBoardSizeChanged:y}},[s,r?.roomTileCount]),h=f.useCallback(async(u,j)=>{const{displayName:b}=u,y=await vn(n,b,t);Cn(u);const{settingsBoardUpdated:A,gameMode:G,newBoard:N=[]}=await o(u),{roomChanged:E,isPrivateRoom:q,privateBoardSizeChanged:F}=g(u);if(!y)return;q&&(u.roomUpdated||!p.find(v=>v.type==="room"))&&await Sn(u,y),d?.tiles!==N&&await de({title:i("settingsGenerated"),tiles:N,isActive:1,gameMode:G}),(A||E||F)&&!p.some(v=>v.type==="settings"&&v.uid===y.uid&&Date.now()-(v.timestamp?.toMillis()||0)<5e3)&&await fn({formData:u,user:y,customTiles:a,actionsList:j,title:"Settings Generated Board",tiles:N}),l({...u,boardUpdated:!1,roomUpdated:!1,gameMode:G}),c(u.room)},[n,t,o,g,p,d,i,a,l,c]);return f.useCallback((u,j)=>h(u,j),[h])}function kn({closeDialog:n,initialTab:t=0}){const{user:s}=ae(),{t:i}=w(),[o,r]=V(),[l,a]=f.useState(t),[d,c]=f.useState(null),[p,g]=f.useState(!1),[h,u]=Ue(),j=pe(),b=wn(),{isLoading:y,actionsList:A}=Re(h?.gameMode),G=(B,v)=>{a(v),j(h.room)},N=()=>r({...o,boardUpdated:!0}),E=f.useCallback(async B=>{B.preventDefault();const{displayName:v,...ge}=h,se=pn(ge,A);return se?(c(i(se)),null):(b(h,A),typeof n=="function"&&n(),null)},[h,A,i,c,b,n]),q=f.useCallback(B=>{u(v=>({...v,displayName:B.target.value}))},[u]),F=f.useCallback(B=>{B.key==="Enter"&&(u(v=>({...v,displayName:B.target.value})),E(B))},[E,u]);return!h.room||y?e.jsxs(T,{children:[e.jsxs(m,{variant:"h2",children:[e.jsx(x,{i18nKey:"loading"}),"..."]}),e.jsx(m,{variant:"body1",children:e.jsx(x,{i18nKey:"clearStorage"})})]}):e.jsxs(T,{component:"form",method:"post",onSubmit:E,className:"settings-box",children:[e.jsx(ee,{fullWidth:!0,id:"displayName",label:i("displayName"),defaultValue:s?.displayName||h.displayName||"",required:!0,autoFocus:!0,onBlur:q,onKeyDown:F,margin:"normal"}),e.jsx(T,{sx:{borderBottom:1,borderColor:"divider"},children:e.jsxs(Te,{value:l,onChange:G,"aria-label":"Game Settings",centered:!0,children:[e.jsx(_,{label:i("gameboard"),...J(0)}),e.jsx(_,{label:i("room"),...J(1)}),e.jsx(_,{label:i("application"),...J(2)})]})}),e.jsx(H,{value:l,index:0,style:{p:0},children:e.jsx(on,{formData:h,setFormData:u,actionsList:A})}),e.jsx(H,{value:l,index:1,style:{p:0,pt:1},children:e.jsx(dn,{formData:h,setFormData:u})}),e.jsx(H,{value:l,index:2,style:{p:0,pt:1},children:e.jsx(Ze,{formData:h,setFormData:u,boardUpdated:N})}),e.jsxs("div",{className:"flex-buttons",children:[e.jsx(re,{variant:"outlined",type:"button",onClick:()=>g(!0),children:e.jsx(x,{i18nKey:"customTilesLabel",children:"Game Tiles"})}),e.jsx(re,{variant:"contained",type:"submit",children:e.jsx(x,{i18nKey:"update"})})]}),p&&e.jsx($e,{open:p,setOpen:g,boardUpdated:N,actionsList:A}),e.jsx(Be,{open:!!d,close:()=>c(null),children:d})]})}const En=Object.freeze(Object.defineProperty({__proto__:null,default:kn},Symbol.toStringTag,{value:"Module"}));export{kn as G,nn as I,cn as R,Z as S,H as T,Xe as Y,Sn as a,pe as b,Pn as c,wn as d,En as i,fn as s,Ye as u};
