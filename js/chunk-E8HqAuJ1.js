const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["js/chunk-B-cyqPC2.js","js/chunk-CVSdvP5Z.js","js/chunk-CNqt7FHs.js","js/chunk-BVO8KFPS.js","js/chunk-_SwOSjSw.js","js/chunk-BUoOus3c.js","assets/index-CZH-e7F_.js"])))=>i.map(i=>d[i]);
import{d as D,a as ve,i as _e,u as te,g as we,w as Pe,b as P,l as be,c as Te,r as Ae,e as Ee,f as Oe,h as Ce,j as Se,k as De,_ as re}from"./chunk-B-cyqPC2.js";import{i as z,b as y,j as b,R as Ie}from"./chunk-CVSdvP5Z.js";import{A as V}from"../assets/index-CZH-e7F_.js";import{g as Be,d as E,f as I,h as je,C as x}from"./chunk-BVO8KFPS.js";(function(){var t=typeof window!="undefined"?window:typeof global!="undefined"?global:typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:{};t.SENTRY_RELEASE={id:"874067a760cfa9079dd7f585e4ceff298b0e879f"}})();try{(function(){var t=typeof window!="undefined"?window:typeof global!="undefined"?global:typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:{},r=new t.Error().stack;r&&(t._sentryDebugIds=t._sentryDebugIds||{},t._sentryDebugIds[r]="23c22864-18f3-4679-b836-60c4039f1974",t._sentryDebugIdIdentifier="sentry-dbid-23c22864-18f3-4679-b836-60c4039f1974")})()}catch(t){}var xe=Object.defineProperty,$e=Object.defineProperties,Me=Object.getOwnPropertyDescriptors,W=Object.getOwnPropertySymbols,Ue=Object.prototype.hasOwnProperty,Ge=Object.prototype.propertyIsEnumerable,Q=(t,r,e)=>r in t?xe(t,r,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[r]=e,ne=(t,r)=>{for(var e in r||(r={}))Ue.call(r,e)&&Q(t,e,r[e]);if(W)for(var e of W(r))Ge.call(r,e)&&Q(t,e,r[e]);return t},oe=(t,r)=>$e(t,Me(r)),m=(t,r,e)=>new Promise((n,l)=>{var o=s=>{try{c(e.next(s))}catch(f){l(f)}},d=s=>{try{c(e.throw(s))}catch(f){l(f)}},c=s=>s.done?n(s.value):Promise.resolve(s.value).then(o,d);c((e=e.apply(t,r)).next())});const{customTiles:v}=D;v.hook("creating",function(t,r,e){r.locale===void 0&&(r.locale="en"),r.gameMode===void 0&&(r.gameMode="online"),r.isCustom===void 0&&(r.isCustom=1)});const Fe=t=>m(null,null,function*(){const r=t.map(e=>oe(ne({},e),{isEnabled:1}));return yield v.bulkAdd(r)}),se=t=>{const r=["locale","gameMode","group","intensity","tag","isCustom","action"];let e=v.toCollection();return Object.entries(t).filter(([l])=>r.includes(l)).forEach(([l,o])=>{o==null||o===""||(l==="tag"?e=e.filter(d=>d.tags.includes(o)):e=e.filter(d=>d[l]===o))}),e},F=(...t)=>m(null,[...t],function*(r={}){try{return yield se(r).toArray()}catch(e){return console.error("Error in getTiles:",e),[]}}),Ne=t=>m(null,null,function*(){const{page:r=1,limit:e=50}=t;try{const n=se(t),l=yield n.count(),o=(r-1)*e;return{items:yield n.offset(o).limit(e).toArray(),total:l,page:r,limit:e,totalPages:Math.ceil(l/e)}}catch(n){return console.error("Error in getPaginatedTiles:",n),{items:[],total:0,page:r,limit:e,totalPages:0}}}),le=(t="en",r="online")=>v.where("locale").equals(t).and(e=>e.gameMode===r),Re=(t="en",r="online",e=null)=>m(null,null,function*(){let n=le(t,r);return e&&(n=n.and(o=>o.tags.some(d=>e.includes(d)))),(yield n.toArray()).reduce((o,d)=>{const c=d.group;o[c]||(o[c]={count:0,intensities:{}}),o[c].count++;const s=Number(d.intensity);return o[c].intensities[s]||(o[c].intensities[s]=0),o[c].intensities[s]++,o},{})}),qe=(t=null)=>{const r=z.resolvedLanguage||z.language||"en";let e=v.where("locale").equals(r).and(n=>n.isEnabled===1);return t&&(e=e.and(n=>n.gameMode===t)),e.toArray()},ie=t=>m(null,null,function*(){return yield v.add(oe(ne({},t),{isEnabled:1}))}),ke=(t,r)=>m(null,null,function*(){return yield v.update(t,r)}),Le=t=>m(null,null,function*(){const r=yield v.get(t);if(!r)throw new Error(`Custom tile with id ${t} not found`);return yield v.update(t,{isEnabled:r.isEnabled?0:1})});function ue(){return m(this,null,function*(){try{return yield D.customTiles.where("isCustom").equals(1).delete(),!0}catch(t){return console.error("Error deleting custom tiles:",t),!1}})}const ze=t=>m(null,null,function*(){yield v.delete(t)}),ae=(t,r="en",e="online")=>le(r,e).and(n=>n.group===t),Ve=(t,r="en",e="online")=>m(null,null,function*(){try{return yield ae(t,r,e).count()}catch(n){return console.error("Error counting tiles by group:",n),0}}),We=(t,r="en",e="online")=>m(null,null,function*(){try{return yield ae(t,r,e).delete()}catch(n){return console.error("Error deleting tiles by group:",n),0}}),At=Object.freeze({__proto__:null,addCustomTile:ie,countTilesByGroup:Ve,deleteAllIsCustomTiles:ue,deleteCustomTile:ze,deleteCustomTilesByGroup:We,getActiveTiles:qe,getPaginatedTiles:Ne,getTileCountsByGroup:Re,getTiles:F,importCustomTiles:Fe,toggleCustomTile:Le,updateCustomTile:ke});var Qe=Object.defineProperty,Ye=Object.defineProperties,He=Object.getOwnPropertyDescriptors,Y=Object.getOwnPropertySymbols,Ke=Object.prototype.hasOwnProperty,Je=Object.prototype.propertyIsEnumerable,H=(t,r,e)=>r in t?Qe(t,r,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[r]=e,U=(t,r)=>{for(var e in r||(r={}))Ke.call(r,e)&&H(t,e,r[e]);if(Y)for(var e of Y(r))Je.call(r,e)&&H(t,e,r[e]);return t},Xe=(t,r)=>Ye(t,He(r)),T=(t,r,e)=>new Promise((n,l)=>{var o=s=>{try{c(e.next(s))}catch(f){l(f)}},d=s=>{try{c(e.throw(s))}catch(f){l(f)}},c=s=>s.done?n(s.value):Promise.resolve(s.value).then(o,d);c((e=e.apply(t,r)).next())});const{gameBoard:_}=D,Ze=()=>_.orderBy("title").toArray(),Et=()=>T(null,null,function*(){var t;return(t=_.where("isActive").equals(1))==null?void 0:t.first()}),et=t=>T(null,null,function*(){return _.add(t)}),tt=(t,r)=>T(null,null,function*(){return _.update(t.id,U(U({},t),r))}),rt=t=>T(null,null,function*(){var r,e;const n={title:t.title===void 0?"":t.title,tiles:t.tiles||[],isActive:t.isActive===void 0?1:t.isActive,tags:t.tags||[],gameMode:t.gameMode||"online"};if(!((r=n==null?void 0:n.title)!=null&&r.length)&&((e=n==null?void 0:n.tiles)!=null&&e.length))return;const l=yield _.where("title").equals(n.title).first();return D.transaction("rw",D.gameBoard,()=>T(null,null,function*(){return n.isActive&&(yield nt()),l?(yield tt(l,t),l.id):yield et(n)}))}),Ot=t=>T(null,null,function*(){const e=(yield _.toArray()).map(n=>Xe(U({},n),{isActive:n.id===t?1:0}));yield _.bulkPut(e)}),Ct=t=>T(null,null,function*(){yield _.delete(t)}),nt=()=>T(null,null,function*(){yield _.where("isActive").equals(1).modify({isActive:0})}),St="None",Dt=3e4,K=500;var J=Object.getOwnPropertySymbols,ot=Object.prototype.hasOwnProperty,st=Object.prototype.propertyIsEnumerable,lt=(t,r)=>{var e={};for(var n in t)ot.call(t,n)&&r.indexOf(n)<0&&(e[n]=t[n]);if(t!=null&&J)for(var n of J(t))r.indexOf(n)<0&&st.call(t,n)&&(e[n]=t[n]);return e},O=(t,r,e)=>new Promise((n,l)=>{var o=s=>{try{c(e.next(s))}catch(f){l(f)}},d=s=>{try{c(e.throw(s))}catch(f){l(f)}},c=s=>s.done?n(s.value):Promise.resolve(s.value).then(o,d);c((e=e.apply(t,r)).next())});const B=Be();function it(){return O(this,null,function*(){const r=E().currentUser;if(!r)return console.error("No user logged in"),!1;try{const e=yield F({isCustom:1});return yield x(I(B,"user-data",r.uid),{customTiles:e,lastUpdated:new Date},{merge:!0}),!0}catch(e){return console.error("Error syncing custom tiles:",e),!1}})}function ut(){return O(this,null,function*(){const r=E().currentUser;if(!r)return console.error("No user logged in"),!1;try{const e=yield we();return yield x(I(B,"user-data",r.uid),{customGroups:e,lastUpdated:new Date},{merge:!0}),!0}catch(e){return console.error("Error syncing custom groups:",e),!1}})}function at(){return O(this,null,function*(){const r=E().currentUser;if(!r)return console.error("No user logged in"),!1;try{const e=yield Ze();return e.length&&(yield x(I(B,"user-data",r.uid),{gameBoards:e,lastUpdated:new Date},{merge:!0})),!0}catch(e){return console.error("Error syncing game boards:",e),!1}})}function ct(){return O(this,null,function*(){const r=E().currentUser;if(!r)return console.error("No user logged in"),!1;try{const{settings:e}=te.getState(),n=e,{localPlayers:l}=n,o=lt(n,["localPlayers"]);return yield x(I(B,"user-data",r.uid),{settings:o,lastUpdated:new Date},{merge:!0}),!0}catch(e){return console.error("Error syncing settings:",e),!1}})}function M(){return O(this,null,function*(){return yield it(),yield ut(),yield at(),yield ct(),!0})}function G(){return O(this,null,function*(){const r=E().currentUser;if(!r)return console.error("No user logged in"),!1;try{const e=I(B,"user-data",r.uid),n=yield je(e);if(!n.exists())return!1;const l=n.data();if(l.customTiles!==void 0&&(yield ue(),yield new Promise(o=>setTimeout(o,K)),l.customTiles&&l.customTiles.length>0))for(const o of l.customTiles)try{(yield F({gameMode:o.gameMode,group:o.group,intensity:o.intensity,action:o.action})).length===0&&(yield ie(o))}catch(d){console.error("Error importing custom tile:",o,d)}if(l.customGroups!==void 0&&(yield ve(),yield new Promise(o=>setTimeout(o,K)),l.customGroups&&l.customGroups.length>0))try{yield _e(l.customGroups)}catch(o){console.error("Error importing custom groups:",o)}if(l.gameBoards&&l.gameBoards.length>0)for(const o of l.gameBoards)yield rt({title:o.title,tiles:o.tiles,tags:o.tags||[],gameMode:o.gameMode||"online",isActive:o.isActive||0});if(l.settings)try{const{updateSettings:o}=te.getState(),d=l.settings;o(d)}catch(o){console.error("Error importing settings:",o)}return!0}catch(e){return console.error("Error syncing data:",e),!1}})}let j=null;function X(t=5){S();const r=t*60*1e3;return j=window.setInterval(()=>O(null,null,function*(){const e=E();e.currentUser&&!e.currentUser.isAnonymous&&(yield G())}),r),!0}function S(){return j?(window.clearInterval(j),j=null,!0):!1}var dt=Object.defineProperty,Z=Object.getOwnPropertySymbols,ft=Object.prototype.hasOwnProperty,yt=Object.prototype.propertyIsEnumerable,ee=(t,r,e)=>r in t?dt(t,r,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[r]=e,gt=(t,r)=>{for(var e in r||(r={}))ft.call(r,e)&&ee(t,e,r[e]);if(Z)for(var e of Z(r))yt.call(r,e)&&ee(t,e,r[e]);return t},g=(t,r,e)=>new Promise((n,l)=>{var o=s=>{try{c(e.next(s))}catch(f){l(f)}},d=s=>{try{c(e.throw(s))}catch(f){l(f)}},c=s=>s.done?n(s.value):Promise.resolve(s.value).then(o,d);c((e=e.apply(t,r)).next())});const ce=Ie.createContext(void 0);function mt(t){const[r,e]=y.useState(null),[n,l]=y.useState(!1),[o,d]=y.useState(!0),[c,s]=y.useState(null),[f,A]=y.useState({syncing:!1,lastSync:null}),p=y.useRef(null),N=y.useRef(!1),C=y.useCallback(u=>g(null,null,function*(){if(p.current&&(clearTimeout(p.current),p.current=null),!r||r.isAnonymous)return!1;try{return A({syncing:!0,lastSync:f.lastSync}),yield u(),A({syncing:!1,lastSync:new Date}),!0}catch(i){return console.error("Sync error:",i),i instanceof Error?s(i.message):s("An unknown error occurred"),A({syncing:!1,lastSync:f.lastSync}),!1}}),[r,p,A,f.lastSync,s]);function de(u=""){return g(this,null,function*(){try{const i=yield De(u);return e(i),i}catch(i){const a=P(i);throw s(a),i}})}function fe(u,i){return g(this,null,function*(){try{l(!0);const a=yield Se(u,i);return e(a),a}catch(a){const h=P(a);throw s(h),a}finally{l(!1)}})}function ye(){return g(this,null,function*(){try{l(!0);const u=yield Ce();return e(u),u}catch(u){const i=P(u);throw s(i),u}finally{l(!1)}})}function ge(u,i,a){return g(this,null,function*(){try{l(!0);const h=yield Oe(u,i,a);return e(h),h}catch(h){const w=P(h);throw s(w),h}finally{l(!1)}})}function me(u){return g(this,null,function*(){try{return yield Ae(u),!0}catch(i){const a=P(i);throw s(a),i}})}const R=y.useCallback((u,i)=>g(null,null,function*(){try{l(!0);const a=yield Te(u,i);return e(a),yield C(M),a}catch(a){throw a instanceof Error&&s(a.message),a}finally{l(!1)}}),[l,e,C,s]);function pe(u=""){return g(this,null,function*(){try{const i=yield Ee(u);return e(i),i}catch(i){const a=P(i);throw s(a),i}})}const q=y.useCallback(()=>g(null,null,function*(){try{if(r&&!r.isAnonymous){const u=C(M),i=new Promise(a=>setTimeout(a,5e3,!1));yield Promise.race([u,i])}yield be(),e(null)}catch(u){const i=P(u);throw s(i),u}}),[r,C,e,s]),k=y.useCallback(()=>g(null,null,function*(){try{yield Pe(),e(null),window.location.reload()}catch(u){const i=P(u);throw s(i),u}}),[e,s]),L=y.useCallback(()=>g(null,null,function*(){return C(M)}),[C]);y.useEffect(()=>{const i=E().onAuthStateChanged(a=>{if(e(a||null),N.current||(N.current=!0,d(!1)),a&&!a.isAnonymous){const h=()=>{p.current&&clearTimeout(p.current),p.current=setTimeout(()=>{A({syncing:!0,lastSync:null});let w;try{w=G?G():Promise.resolve(!1)}catch($){console.warn("syncDataFromFirebase is not available:",$),w=Promise.resolve(!1)}(!w||typeof w.then!="function")&&(w=Promise.resolve(!1)),w.then(()=>{A({syncing:!1,lastSync:new Date}),X&&X()}).catch($=>{console.error("Error syncing from Firebase:",$),A({syncing:!1,lastSync:null})}).finally(()=>{p.current=null})},1e3)};typeof window!="undefined"&&"requestIdleCallback"in window?window.requestIdleCallback(h,{timeout:5e3}):setTimeout(h,100)}else S&&S()});return window.authContext={user:null},()=>{typeof i=="function"&&i(),p.current&&clearTimeout(p.current),S&&S(),window.authContext=void 0}},[]),y.useEffect(()=>{const u=window;u.authContext&&(u.authContext.user=r)},[r]);const he=y.useMemo(()=>({user:r,loading:n,initializing:o,error:c,syncStatus:f,login:de,loginEmail:fe,loginGoogle:ye,register:ge,updateUser:pe,forgotPassword:me,convertToRegistered:R,logout:q,wipeAllData:k,syncData:L,isAnonymous:(r==null?void 0:r.isAnonymous)||!1}),[r,n,o,c,f,R,q,k,L]);return b.jsx(ce.Provider,gt({value:he},t))}const pt=y.lazy(()=>re(()=>import("./chunk-B-cyqPC2.js").then(function(t){return t.R}),__vite__mapDeps([0,1,2,3,4]))),ht=y.lazy(()=>re(()=>import("./chunk-BUoOus3c.js").then(function(t){return t.i}),__vite__mapDeps([5,0,1,2,3,4,6])));function vt(){const t=y.useContext(ce);return!t||t.initializing?b.jsx(V,{}):b.jsx(y.Suspense,{fallback:b.jsx(V,{}),children:b.jsx(pt,{children:b.jsx(ht,{})})})}function _t(){return b.jsx(mt,{children:b.jsx(vt,{})})}const It=Object.freeze({__proto__:null,default:_t});export{ce as A,St as D,Dt as U,Et as a,F as b,ie as c,ke as d,Ve as e,We as f,qe as g,Re as h,Fe as i,Ne as j,ze as k,tt as l,Ot as m,Ct as n,Ze as o,At as p,It as q,Le as t,rt as u};
//# sourceMappingURL=chunk-E8HqAuJ1.js.map
