const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-iNPYMOsW.js","js/chunk-BoIRgPCP.js","js/chunk-BHSFqGHu.js","js/chunk-DXd3GHw1.js","js/chunk-Bde8qXua.js","js/getUniqueImportRecords.ts-BnrZI-dg.js","js/chunk-_XImYCHd.js","js/chunk-B-GQsBHJ.js","js/chunk-Bci0zq1p.js","js/chunk-D5QWNTV5.js","js/chunk-BnDmEeUs.js","js/chunk-JK3oC_qz.js","js/chunk-Bp62TkGl.js","js/chunk-BaJvVaWg.js","js/chunk-BuXVQPZW.js"])))=>i.map(i=>d[i]);
import{j as e,T as j,B as A,al as B,am as K,an as H,o as k,i as se,a8 as Fe,e as Z,C as _e,ak as ye,p as be,q as je,O as Ze,Q as Ne,s as ve,aA as et,aB as tt,ap as st,aC as nt,E as ae,aD as Re,H as Te,D as Ue,aE as it,w as $e,aF as rt,g as at,aG as ot,S as lt,aH as ct,F as ut,aI as dt,af as mt,G as he}from"./chunk-BoIRgPCP.js";import{r as c,a as pt}from"./chunk-BHSFqGHu.js";import{C as ht,u as gt}from"./chunk-_XImYCHd.js";import{F as We,i as oe,E as ce,G as xt,B as ft,_ as re,I as qe,J as ze,w as pe,K as yt,L as bt,N as jt,O as vt,P as Tt,Q as Ct,R as It,T as Gt,V as Me,W as wt,X as Et,Y as Lt,C as At,l as St,Z as _t}from"../assets/index-iNPYMOsW.js";import{u as ke}from"./chunk-D5QWNTV5.js";import{T as Dt}from"./chunk-B-GQsBHJ.js";import{i as ge}from"./chunk-BnDmEeUs.js";import{A as ue,a as de,b as me}from"./chunk-JK3oC_qz.js";import{d as Nt}from"./chunk-Bp62TkGl.js";import{a as De,u as $t}from"./chunk-BaJvVaWg.js";import{u as ee,T as R}from"./chunk-Bci0zq1p.js";import{n as xe}from"./chunk-DXd3GHw1.js";import{u as Mt}from"./chunk-BuXVQPZW.js";function Be(n){return[...Object.entries(n).flatMap(([i,{label:a,actions:r}])=>r?Object.keys(r).filter(l=>l!==We).map((l,t)=>({group:Nt(i),groupLabel:a,value:i,intensity:Number(t+1),translatedIntensity:l,label:`${a} - ${l}`})):[]),{group:oe.t("misc"),groupLabel:oe.t("misc"),value:"misc",intensity:1,translatedIntensity:oe.t("all"),label:`${oe.t("misc")} - ${oe.t("all")}`}]}const Ce=50,Ie=100,Ge=50,we=1,Ee=10,Le=1,Ae=10,Ke=["none","all","default","undefined","null"],kt=["solo","foreplay","sex","consumption"],Pt=(n,u="en",i="online",a)=>{const r=[],m=[];if(!n||n.trim().length===0)return r.push("Group name is required"),{isValid:!1,errors:r,warnings:m};const l=n.trim();return l.length>Ce&&r.push(`Group name must be ${Ce} characters or less`),Ke.includes(l.toLowerCase())&&r.push(`"${l}" is a reserved name and cannot be used`),/^[a-zA-Z0-9_-]+$/.test(l)||r.push("Group name can only contain letters, numbers, hyphens, and underscores"),/^[a-zA-Z]/.test(l)||r.push("Group name must start with a letter"),{isValid:r.length===0,errors:r,warnings:m}},He=n=>{const u=[],i=[];return!n||n.trim().length===0?(u.push("Group label is required"),{isValid:!1,errors:u,warnings:i}):(n.trim().length>Ie&&u.push(`Group label must be ${Ie} characters or less`),{isValid:u.length===0,errors:u,warnings:i})},Vt=n=>{const u=[],i=[];if(!n||n.length===0)return u.push("At least one intensity level is required"),{isValid:!1,errors:u,warnings:i};n.length<Le&&u.push(`At least ${Le} intensity level is required`),n.length>Ae&&u.push(`Maximum ${Ae} intensity levels allowed`);const a=new Set,r=new Set;for(let t=0;t<n.length;t++){const h=n[t];if((!h.id||h.id.trim().length===0)&&u.push(`Intensity level ${t+1} is missing an ID`),!h.label||h.label.trim().length===0)u.push(`Intensity level ${t+1} is missing a label`);else{const x=h.label.trim();x.length>Ge&&u.push(`Intensity level ${t+1} label must be ${Ge} characters or less`),r.has(x.toLowerCase())?u.push(`Intensity label "${x}" is used multiple times`):r.add(x.toLowerCase())}typeof h.value!="number"||!Number.isInteger(h.value)?u.push(`Intensity level ${t+1} must have a valid integer value`):((h.value<we||h.value>Ee)&&u.push(`Intensity level ${t+1} value must be between ${we} and ${Ee}`),a.has(h.value)?u.push(`Intensity value ${h.value} is used multiple times`):a.add(h.value))}const m=Array.from(a).sort((t,h)=>t-h);let l=m[0];for(const t of m){if(t!==l){i.push("Intensity values are not sequential. Consider using values like 1, 2, 3, 4 for better user experience");break}l++}return{isValid:u.length===0,errors:u,warnings:i}},Xe=async(n,u)=>{const i=[],a=[],r=Pt(n.name,n.locale||"en",n.gameMode||"online");i.push(...r.errors),a.push(...r.warnings||[]);const m=He(n.label);i.push(...m.errors),a.push(...m.warnings||[]);const l=Vt(n.intensities);if(i.push(...l.errors),a.push(...l.warnings||[]),r.isValid&&n.name)try{await xt(n.name,n.locale||"en",n.gameMode||"online",u)||i.push(`A group with the name "${n.name}" already exists for this locale and game mode`)}catch{a.push("Could not verify group name uniqueness")}return{isValid:i.length===0,errors:i,warnings:a}},Pe=async(n,u="en",i="online")=>{const a=[],r=[];if(!n.group||n.group.trim().length===0)return a.push("Tile must belong to a group"),{isValid:!1,errors:a,warnings:r};try{const m=await ce(n.group,u,i);if(!m)return a.push(`Group "${n.group}" does not exist for ${u}/${i}`),{isValid:!1,errors:a,warnings:r};const l=m.intensities.map(t=>t.value);l.includes(n.intensity)||a.push(`Intensity ${n.intensity} is not valid for group "${n.group}". Valid intensities: ${l.join(", ")}`),(!n.action||n.action.trim().length===0)&&a.push("Tile action is required")}catch(m){a.push(`Error validating tile: ${m}`)}return{isValid:a.length===0,errors:a,warnings:r}},Ot=()=>({MAX_GROUP_NAME_LENGTH:Ce,MAX_GROUP_LABEL_LENGTH:Ie,MAX_INTENSITY_LABEL_LENGTH:Ge,MIN_INTENSITY_VALUE:we,MAX_INTENSITY_VALUE:Ee,MIN_INTENSITIES_COUNT:Le,MAX_INTENSITIES_COUNT:Ae,RESERVED_GROUP_NAMES:Ke,VALID_GROUP_TYPES:kt}),Se="2.0.0";async function Ft(n="en",u="online"){try{const i=await ft({locale:n,gameMode:u}),a=await re(()=>import("../assets/index-iNPYMOsW.js").then(m=>m.a6),__vite__mapDeps([0,1,2,3,4])).then(m=>m.getTiles({isCustom:1})),r={version:Se,exportedAt:new Date().toISOString(),locale:n,gameMode:u,customGroups:i,customTiles:a};return JSON.stringify(r,null,2)}catch(i){throw console.error("Error exporting enhanced data:",i),new Error(`Export failed: ${i}`)}}async function Rt(n,u={}){const i={success:!1,importedGroups:0,importedTiles:0,errors:[],warnings:[]};try{let a;try{a=JSON.parse(n)}catch{return i.errors.push("Invalid JSON format"),i}if(!a.version||!a.customGroups||!a.customTiles)return i.errors.push("Invalid export format"),i;a.version!==Se&&i.warnings.push(`Format version mismatch: expected ${Se}, got ${a.version}`);const r=u.locale||a.locale||"en",m=u.gameMode||a.gameMode||"online",l=u.mergeStrategy||"skip";for(const p of a.customGroups)try{let s=p;const o=await ce(s.name,r,m);if(o)switch(l){case"skip":i.warnings.push(`Skipped existing group: ${s.name}`);continue;case"overwrite":await re(()=>import("../assets/index-iNPYMOsW.js").then(E=>E.a7),__vite__mapDeps([0,1,2,3,4])).then(E=>E.updateCustomGroup(o.id,{...s,locale:r,gameMode:m})),i.warnings.push(`Updated existing group: ${s.name}`);break;case"rename":{let E=`${s.name}_imported`,S=1;for(;await ce(E,r,m);)E=`${s.name}_imported_${S}`,S++;const _=s.name;s={...s,name:E},i.warnings.push(`Renamed group from ${_} to ${E}`);break}}const G=await Xe({...s,locale:r,gameMode:m});if(!G.isValid){i.errors.push(`Invalid group ${s.name}: ${G.errors.join(", ")}`);continue}await qe({...s,locale:r,gameMode:m})&&i.importedGroups++}catch(s){i.errors.push(`Error importing group ${p.name}: ${s}`)}const{addCustomTile:t,getTiles:h}=await re(async()=>{const{addCustomTile:p,getTiles:s}=await import("../assets/index-iNPYMOsW.js").then(o=>o.a6);return{addCustomTile:p,getTiles:s}},__vite__mapDeps([0,1,2,3,4])),x=await h();for(const p of a.customTiles)try{if(x.find(w=>w.group===p.group&&w.intensity===p.intensity&&w.action===p.action&&w.gameMode===p.gameMode)&&l==="skip"){i.warnings.push(`Skipped existing tile: ${p.action}`);continue}const o=await ce(p.group,r,m);if(!o){i.errors.push(`Tile references non-existent group: ${p.group}`);continue}if(!o.intensities.map(w=>w.value).includes(p.intensity)){i.errors.push(`Tile intensity ${p.intensity} not valid for group ${p.group}`);continue}await t({...p,gameMode:m}),i.importedTiles++}catch(s){i.errors.push(`Error importing tile: ${s}`)}return i.success=i.errors.length===0,i}catch(a){return i.errors.push(`Import failed: ${a}`),i}}async function Ut(n,u,i="en",a="online"){const r={success:!1,importedGroups:0,importedTiles:0,errors:[],warnings:[]};try{const{default:m}=await re(async()=>{const{default:s}=await import("./getUniqueImportRecords.ts-BnrZI-dg.js");return{default:s}},__vite__mapDeps([5,1,2,3,6,7,8,0,4,9,10,11,12,13,14])),{getTiles:l,addCustomTile:t}=await re(async()=>{const{getTiles:s,addCustomTile:o}=await import("../assets/index-iNPYMOsW.js").then(G=>G.a6);return{getTiles:s,addCustomTile:o}},__vite__mapDeps([0,1,2,3,4])),h=await l(),{newUniqueRecords:x,changedTagRecords:p}=m(n,h,u);for(const s of x)try{await t(s),r.importedTiles++}catch(o){r.errors.push(`Error importing tile: ${o}`)}for(const s of p)try{if(s.id){const{updateCustomTile:o}=await re(async()=>{const{updateCustomTile:G}=await import("../assets/index-iNPYMOsW.js").then(w=>w.a6);return{updateCustomTile:G}},__vite__mapDeps([0,1,2,3,4]));await o(s.id,s)}}catch(o){r.errors.push(`Error updating tile: ${o}`)}return r.success=r.errors.length===0,r.warnings.push("Imported using legacy format. Consider exporting in new format for better compatibility."),r}catch(m){return r.errors.push(`Legacy import failed: ${m}`),r}}async function Wt(n,u,i={}){const a=n.trim();try{const r=JSON.parse(a);if(r.version&&r.customGroups!==void 0)return Rt(a,i)}catch{}return Ut(a,u,i.locale||"en",i.gameMode||"online")}function qt({expanded:n,handleChange:u,customTiles:i,mappedGroups:a,setSubmitMessage:r,bulkImport:m}){const l=c.useRef(null),{t}=ee(),{settings:h}=De(),[x,p]=c.useState(""),[s,o]=c.useState(null),[G,w]=c.useState("enhanced"),[E,S]=c.useState("skip"),_=c.useCallback(async()=>{try{if(G==="enhanced"){const y=await Ft(h.locale||"en",h.gameMode||"online");p(y)}else{const N=i.filter(d=>d.isCustom).map(({group:d,intensity:T,action:L,tags:P,gameMode:I="online"})=>{const g=Be(a[I]||{}).find(M=>M?.intensity===Number(T)&&M?.value===d);let b="";return b+=`[${g?.group||d} - ${g?.translatedIntensity||T}]
`,b+=L,b+=P?.length?`
Tags: `+P?.join(", "):"",b+=`
GameMode: ${I}`,b});p(N.join(`
---
`))}}catch(y){console.error("Error exporting data:",y),r({message:`Export failed: ${y}`,type:"error"})}},[i,a,p,G,h.locale,h.gameMode,r]);async function V(y){if(!y.current)return;const d=y.current.importData.value;if(!d.trim())return r({type:"error",message:t("Please enter data to import")});try{r({type:"info",message:"Importing data..."});const T=await Wt(d,a,{locale:h.locale||"en",gameMode:h.gameMode||"online",mergeStrategy:E});if(o(T),T.success){T.importedTiles>0&&(await re(()=>import("../assets/index-iNPYMOsW.js").then(I=>I.a6),__vite__mapDeps([0,1,2,3,4])).then(I=>I.getTiles({isCustom:1}))).slice(-T.importedTiles).forEach(async I=>{ze(`${I.group} - ${I.intensity}`,I.action)});let L="Import completed successfully!";T.importedGroups>0&&(L+=` Imported ${T.importedGroups} custom groups.`),T.importedTiles>0&&(L+=` Imported ${T.importedTiles} custom tiles.`),r({type:"success",message:L}),await _()}else r({type:"error",message:`Import failed: ${T.errors.join(", ")}`})}catch(T){console.error("Import error:",T),r({type:"error",message:`Import failed: ${T.message||T}`}),o(null)}}return c.useEffect(()=>{n==="ctImport"&&_()},[n,i,_]),e.jsxs(ue,{expanded:n==="ctImport",onChange:u("ctImport"),children:[e.jsx(de,{"aria-controls":"ctImport-content",id:"ctImport-header",children:e.jsx(j,{children:e.jsx(R,{i18nKey:"importExport"})})}),e.jsxs(me,{children:[e.jsx(j,{variant:"body1",sx:{mb:2},children:e.jsx(R,{i18nKey:"ctImportDescription"})}),e.jsxs(A,{sx:{mb:2},children:[e.jsx(j,{variant:"subtitle2",sx:{mb:1},children:"Export Format"}),e.jsxs(B,{size:"small",sx:{minWidth:150},children:[e.jsx(K,{children:"Format"}),e.jsxs(H,{value:G,onChange:y=>w(y.target.value),label:"Format",children:[e.jsx(k,{value:"enhanced",children:"Enhanced (v2.0)"}),e.jsx(k,{value:"legacy",children:"Legacy"})]})]}),e.jsx(j,{variant:"caption",display:"block",sx:{mt:.5,color:"text.secondary"},children:"Enhanced format includes custom groups. Legacy format is for backward compatibility."})]}),e.jsxs(A,{sx:{mb:2},children:[e.jsx(j,{variant:"subtitle2",sx:{mb:1},children:"Import Strategy"}),e.jsxs(B,{size:"small",sx:{minWidth:150},children:[e.jsx(K,{children:"Strategy"}),e.jsxs(H,{value:E,onChange:y=>S(y.target.value),label:"Strategy",children:[e.jsx(k,{value:"skip",children:"Skip Existing"}),e.jsx(k,{value:"overwrite",children:"Overwrite"}),e.jsx(k,{value:"rename",children:"Rename Conflicts"})]})]}),e.jsx(j,{variant:"caption",display:"block",sx:{mt:.5,color:"text.secondary"},children:"How to handle items that already exist during import."})]}),e.jsxs(A,{component:"form",method:"post",ref:l,children:[e.jsx(se,{id:"importData",name:"importData",multiline:!0,required:!0,fullWidth:!0,rows:6,sx:{pb:2},value:x,onChange:y=>p(y.target.value),placeholder:G==="enhanced"?"Paste enhanced format JSON data here...":"Paste legacy format data here...",InputProps:{endAdornment:e.jsx(ht,{text:x}),sx:{alignItems:"flex-start"}}}),s&&e.jsxs(Fe,{severity:s.success?"success":"error",sx:{mb:2},onClose:()=>o(null),children:[e.jsx(j,{variant:"body2",children:e.jsx("strong",{children:"Import Results:"})}),s.importedGroups>0&&e.jsxs(j,{variant:"body2",children:["• ",s.importedGroups," custom groups imported"]}),s.importedTiles>0&&e.jsxs(j,{variant:"body2",children:["• ",s.importedTiles," custom tiles imported"]}),s.warnings.length>0&&e.jsxs(A,{sx:{mt:1},children:[e.jsx(j,{variant:"body2",color:"warning.main",children:e.jsx("strong",{children:"Warnings:"})}),s.warnings.map((y,N)=>e.jsxs(j,{variant:"body2",color:"warning.main",children:["• ",y]},N))]}),s.errors.length>0&&e.jsxs(A,{sx:{mt:1},children:[e.jsx(j,{variant:"body2",color:"error.main",children:e.jsx("strong",{children:"Errors:"})}),s.errors.map((y,N)=>e.jsxs(j,{variant:"body2",color:"error.main",children:["• ",y]},N))]})]}),e.jsx(Z,{fullWidth:!0,variant:"contained",type:"button",onClick:()=>V(l),children:e.jsx(R,{i18nKey:"import"})})]})]})]})}function zt({value:n,onChange:u,locale:i,gameMode:a,includeDefault:r=!0,disabled:m=!1,refreshTrigger:l=0}){const{t}=ee(),[h,x]=c.useState([]),[p,s]=c.useState(!0);return c.useEffect(()=>{(async()=>{s(!0);try{const G=await pe(i,a),w=r?G:G.filter(E=>!E.isDefault);x(w)}catch(G){console.error("Error loading custom groups:",G),x([])}finally{s(!1)}})()},[i,a,r,l]),p?e.jsxs(B,{fullWidth:!0,disabled:!0,children:[e.jsx(K,{children:t("customGroups.loadingGroups")}),e.jsx(H,{value:"",children:e.jsx(k,{value:"",children:e.jsxs(A,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(_e,{size:16}),e.jsx("span",{children:t("customGroups.loadingGroups")})]})})})]}):e.jsx(A,{children:e.jsxs(B,{fullWidth:!0,disabled:m,children:[e.jsx(K,{children:t("Group")}),e.jsx(H,{value:n,onChange:o=>u(o.target.value),label:t("Group"),children:h.length===0?e.jsx(k,{value:"",disabled:!0,children:e.jsx(j,{color:"text.secondary",children:t("customGroups.noGroupsAvailable",{locale:i,gameMode:a})})}):h.map(o=>e.jsx(k,{value:o.name,children:e.jsxs(A,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx("span",{children:o.label}),o.isDefault&&e.jsx(ye,{label:t("default"),size:"small",variant:"outlined"})]})},o.id))})]})})}function Bt({groupName:n,value:u,onChange:i,locale:a,gameMode:r,disabled:m=!1}){const{t:l}=ee(),[t,h]=c.useState([]),[x,p]=c.useState(!1);c.useEffect(()=>{(async()=>{if(!n){h([]);return}p(!0);try{const G=await yt(n,a,r);h(G)}catch(G){console.error("Error loading group intensities:",G),h([])}finally{p(!1)}})()},[n,a,r]);const s=c.useMemo(()=>t.sort((o,G)=>o.value-G.value),[t]);return c.useEffect(()=>{if(t.length>0&&u&&!t.some(o=>o.value===u)){const o=s[0];o&&i(o.value)}},[t,u,i,s]),n?x?e.jsxs(B,{fullWidth:!0,disabled:!0,children:[e.jsx(K,{children:l("customGroups.loadingIntensities")}),e.jsx(H,{value:"",children:e.jsx(k,{value:"",children:e.jsxs(A,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(_e,{size:16}),e.jsx("span",{children:l("customGroups.loadingIntensities")})]})})})]}):t.length===0?e.jsxs(B,{fullWidth:!0,disabled:!0,children:[e.jsx(K,{children:l("intensity")}),e.jsx(H,{value:"",children:e.jsx(k,{value:"",disabled:!0,children:e.jsx(j,{color:"text.secondary",children:l("customGroups.noIntensitiesAvailable",{groupName:n})})})})]}):e.jsx(A,{children:e.jsxs(B,{fullWidth:!0,disabled:m,children:[e.jsx(K,{children:l("intensity")}),e.jsx(H,{value:u||"",onChange:o=>i(Number(o.target.value)),label:l("intensity"),children:s.map(o=>e.jsx(k,{value:o.value,children:o.label},o.id))})]})}):e.jsxs(B,{fullWidth:!0,disabled:!0,children:[e.jsx(K,{children:l("intensity")}),e.jsx(H,{value:"",children:e.jsx(k,{value:"",disabled:!0,children:e.jsx(j,{color:"text.secondary",children:l("customGroups.selectGroupFirst")})})})]})}const Ve=[{name:"Basic (1-4)",intensities:[{label:"intensityLabels.light",value:1,isDefault:!0},{label:"intensityLabels.medium",value:2,isDefault:!0},{label:"intensityLabels.intense",value:3,isDefault:!0},{label:"intensityLabels.extreme",value:4,isDefault:!0}]},{name:"Simple (1-3)",intensities:[{label:"intensityLabels.beginner",value:1,isDefault:!0},{label:"intensityLabels.intermediate",value:2,isDefault:!0},{label:"intensityLabels.advanced",value:3,isDefault:!0}]},{name:"Extended (1-5)",intensities:[{label:"intensityLabels.veryLight",value:1,isDefault:!0},{label:"intensityLabels.light",value:2,isDefault:!0},{label:"intensityLabels.medium",value:3,isDefault:!0},{label:"intensityLabels.intense",value:4,isDefault:!0},{label:"intensityLabels.veryIntense",value:5,isDefault:!0}]}];function Kt({open:n,onClose:u,onGroupCreated:i,onGroupUpdated:a,editingGroup:r,locale:m,gameMode:l}){const{t}=ee(),[h,x]=c.useState(0),[p,s]=c.useState([]),[o,G]=c.useState(!0),[w,E]=c.useState({}),S=Ot(),[_,V]=c.useState(""),[y,N]=c.useState(""),[d,T]=c.useState([t("intensityLabels.beginner"),t("intensityLabels.intermediate"),t("intensityLabels.advanced")]),[L,P]=c.useState(null),[I,O]=c.useState(!1),[g,b]=c.useState({isValid:!0,errors:[]}),[M,z]=c.useState(!1),[U,Y]=c.useState(null),J=c.useCallback(async()=>{try{const C=(await pe(m,l)).filter(q=>!q.isDefault);s(C);const $={};await Promise.all(C.map(async q=>{$[q.id]=await bt(q.name,m,l)})),E($)}catch(f){console.error("Error reloading groups:",f)}},[m,l]);c.useEffect(()=>{(async()=>{if(n){G(!0);try{await J()}catch(C){console.error("Error loading groups:",C)}finally{G(!1)}}})()},[n,m,l,J]);const v=f=>f.toLowerCase().replace(/[^a-z0-9\s]/g,"").replace(/\s+/g,"_").substring(0,20)||`group_${xe(6).toLowerCase()}`;c.useEffect(()=>{r?(P(r),V(r.label),N(r.type||""),T(r.intensities.map(f=>f.label))):L?(V(L.label),N(L.type||""),T(L.intensities.map(f=>f.label))):(P(null),V(""),N(""),T([t("intensityLabels.beginner"),t("intensityLabels.intermediate"),t("intensityLabels.advanced")])),b({isValid:!0,errors:[]})},[r,L,n,t]);const D=f=>{const C=Ve[f];T(C.intensities.map($=>t($.label)))},F=(f,C)=>{const $=[...d];$[f]=C,T($)},X=()=>{d.length>=S.MAX_INTENSITIES_COUNT||T([...d,t("customGroups.levelLabel",{level:d.length+1})])},ne=f=>{if(d.length<=S.MIN_INTENSITIES_COUNT)return;const C=d.filter(($,q)=>q!==f);T(C)};c.useEffect(()=>{(async()=>{if(!_.trim()&&!y&&d.length===0){b({isValid:!0,errors:[]});return}const C=[];if(y&&!S.VALID_GROUP_TYPES.includes(y)&&C.push(`Type must be one of: ${S.VALID_GROUP_TYPES.join(", ")}`),_.trim()&&!y&&C.push("Type is required when creating a group"),C.length>0){b({isValid:!1,errors:C});return}const $=d.map((Je,Qe)=>({id:xe(),label:Je,value:Qe+1,isDefault:!1})),q={name:L?L.name:v(_),label:_.trim(),intensities:$,type:y||void 0,locale:m,gameMode:l,isDefault:!1},Ye=await Xe(q,L?.id);b(Ye)})()},[_,y,d,m,l,L,t,S.VALID_GROUP_TYPES]);const Q=f=>{P(f),V(f.label),T(f.intensities.map(C=>C.label)),x(1)},te=async f=>{const C=p.find(q=>q.id===f);if(!C)return;const $=w[f]||0;Y({id:f,name:C.label,tileCount:$}),z(!0)},W=async()=>{if(!U)return;const{id:f,tileCount:C}=U,$=p.find(q=>q.id===f);if($)try{C>0&&await jt($.name,m,l),await vt(f),await J(),a?.(null)}catch(q){console.error("Error deleting group:",q)}finally{z(!1),Y(null)}},ie=async()=>{if(!(!g.isValid||I)){O(!0);try{const f=d.map(($,q)=>({id:xe(),label:$,value:q+1,isDefault:!1})),C={name:L?L.name:v(_),label:_.trim(),intensities:f,type:y||void 0,locale:m,gameMode:l,isDefault:!1};if(L)await Tt(L.id,C),a?.(L);else{const $=await qe(C);$&&i?.({...C,id:$,createdAt:new Date,updatedAt:new Date,isDefault:!1,locale:m,gameMode:l})}le(),u()}catch(f){console.error("Error saving custom group:",f),b({isValid:!1,errors:[`Failed to save group: ${f}`]})}finally{O(!1)}}},le=()=>{P(null),V(""),N(""),T([t("intensityLabels.beginner"),t("intensityLabels.intermediate"),t("intensityLabels.advanced")]),b({isValid:!0,errors:[]})};return e.jsxs(e.Fragment,{children:[e.jsxs(be,{open:n,onClose:u,maxWidth:"md",fullWidth:!0,PaperProps:{sx:{minHeight:"600px"}},children:[e.jsxs(je,{children:[t("Manage Custom Groups"),e.jsx(j,{variant:"body2",color:"text.secondary",sx:{mt:1},children:t("Create new groups or manage existing custom groups")}),e.jsxs(Ze,{value:h,onChange:(f,C)=>{x(C),C===1&&!L&&le()},sx:{mt:2,borderBottom:1,borderColor:"divider"},children:[e.jsx(Ne,{label:t("Existing Groups")}),e.jsx(Ne,{label:t(L?"Edit Group":"Create New")})]})]}),e.jsxs(ve,{dividers:!0,children:[h===0&&e.jsx(A,{children:o?e.jsx(j,{children:t("Loading groups...")}):p.length===0?e.jsx(j,{color:"text.secondary",sx:{textAlign:"center",py:4},children:t('No custom groups found. Create your first group using the "Create New" tab.')}):e.jsx(et,{children:p.map((f,C)=>e.jsxs(pt.Fragment,{children:[e.jsxs(tt,{children:[e.jsx(st,{primary:f.label,secondary:e.jsxs(A,{component:"span",sx:{display:"block"},children:[e.jsxs(j,{variant:"body2",color:"text.secondary",component:"span",sx:{display:"block"},children:[t("customGroups.intensityLevelsCount",{count:f.intensities.length}),": ",f.intensities.map($=>$.label).join(", ")]}),e.jsx(j,{variant:"body2",color:"text.secondary",component:"span",sx:{display:"block",mt:.5},children:t("customGroups.customTilesCount",{count:w[f.id]||0})})]})}),e.jsxs(nt,{children:[e.jsx(ae,{edge:"end","aria-label":"edit",onClick:()=>Q(f),sx:{mr:1},children:e.jsx(Re,{})}),e.jsx(ae,{edge:"end","aria-label":"delete",onClick:()=>te(f.id),color:"error",children:e.jsx(Te,{})})]})]}),C<p.length-1&&e.jsx(Ue,{})]},f.id))})}),h===1&&e.jsxs(A,{sx:{display:"flex",flexDirection:"column",gap:3},children:[!g.isValid&&e.jsx(Fe,{severity:"error",children:g.errors.map((f,C)=>e.jsx("div",{children:f},C))}),e.jsxs(A,{sx:{p:2,bgcolor:"background.paper",borderRadius:1,border:"1px solid",borderColor:"divider"},children:[e.jsx(j,{variant:"h6",sx:{mb:2},children:t("customGroups.groupInformation")}),e.jsx(se,{label:t("customGroups.groupLabel"),value:_,onChange:f=>V(f.target.value),placeholder:"e.g., My Custom Group",helperText:t("customGroups.groupLabelHelp",{maxLength:S.MAX_GROUP_LABEL_LENGTH}),fullWidth:!0,required:!0,error:_.trim().length>0&&!He(_).isValid,sx:{mb:2}}),e.jsxs(se,{select:!0,label:t("customGroups.groupType"),value:y,onChange:f=>N(f.target.value),helperText:t("customGroups.groupTypeHelp"),fullWidth:!0,required:!0,error:_.trim().length>0&&!y,sx:{mb:2},children:[e.jsx(k,{value:"",children:e.jsx("em",{children:t("groupTypes.selectType")})}),e.jsx(k,{value:"solo",children:t("groupTypes.solo")}),e.jsx(k,{value:"foreplay",children:t("groupTypes.foreplay")}),e.jsx(k,{value:"sex",children:t("groupTypes.sex")}),e.jsx(k,{value:"consumption",children:t("groupTypes.consumption")})]}),e.jsxs(A,{sx:{display:"flex",flexDirection:"column",gap:.5},children:[e.jsxs(j,{variant:"body2",color:"text.secondary",children:[e.jsx("strong",{children:t("customGroups.locale")})," ",m," |"," ",e.jsx("strong",{children:t("customGroups.gameMode")})," ",l]}),L?e.jsxs(j,{variant:"body2",color:"text.secondary",children:[e.jsx("strong",{children:t("customGroups.internalId")})," ",L.name," ","(locked)"]}):e.jsxs(j,{variant:"body2",color:"text.secondary",children:[e.jsx("strong",{children:t("customGroups.internalId")})," ",_?v(_):t("customGroups.autoGenerated")]})]})]}),e.jsxs(A,{sx:{display:"flex",alignItems:"center",gap:2,p:2,bgcolor:"action.hover",borderRadius:1},children:[e.jsx(j,{variant:"body2",sx:{fontWeight:"medium",minWidth:"auto"},children:t("customGroups.quickStart")}),e.jsx(se,{select:!0,value:0,onChange:f=>D(Number(f.target.value)),size:"small",sx:{minWidth:200},label:t("customGroups.chooseTemplate"),children:Ve.map((f,C)=>e.jsx(k,{value:C,children:f.name},C))}),e.jsx(j,{variant:"body2",color:"text.secondary",sx:{fontSize:"0.75rem"},children:t("customGroups.selectTemplateDescription")})]}),e.jsxs(A,{children:[e.jsxs(j,{variant:"h6",sx:{mb:2},children:[t("customGroups.intensityLabels")," (",d.length,"/",S.MAX_INTENSITIES_COUNT,")"]}),e.jsx(j,{variant:"body2",color:"text.secondary",sx:{mb:2},children:t("customGroups.customizeIntensityDescription")}),e.jsxs(A,{sx:{display:"flex",flexDirection:"column",gap:1.5},children:[d.map((f,C)=>e.jsxs(A,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(j,{variant:"body2",sx:{minWidth:"30px",fontWeight:"bold",color:"primary.main"},children:C+1}),e.jsx(se,{label:t("customGroups.levelInputLabel",{level:C+1}),value:f,onChange:$=>F(C,$.target.value),size:"small",sx:{flex:1},inputProps:{maxLength:S.MAX_INTENSITY_LABEL_LENGTH}}),e.jsx(ae,{onClick:()=>ne(C),disabled:d.length<=S.MIN_INTENSITIES_COUNT,color:"error",size:"small",children:e.jsx(Te,{})})]},C)),e.jsx(Z,{startIcon:e.jsx(it,{}),onClick:X,disabled:d.length>=S.MAX_INTENSITIES_COUNT,variant:"outlined",size:"small",sx:{alignSelf:"flex-start",mt:1},children:t("customGroups.addIntensityLevel")})]})]})]})]}),e.jsxs($e,{children:[e.jsx(Z,{onClick:u,disabled:I,children:t("Cancel")}),e.jsx(Z,{onClick:ie,variant:"contained",disabled:!g.isValid||I,children:t(I?"customGroups.saving":L?"customGroups.updateGroup":"customGroups.createGroup")})]})]}),e.jsxs(be,{open:M,onClose:()=>z(!1),children:[e.jsx(je,{children:t("customGroups.confirmDelete")}),e.jsx(ve,{children:e.jsx(j,{children:(U?.tileCount??0)>0?t("customGroups.deleteGroupWithTiles",{name:U?.name,count:U?.tileCount}):t("customGroups.deleteGroupConfirm",{name:U?.name})})}),e.jsxs($e,{children:[e.jsx(Z,{onClick:()=>z(!1),children:t("Cancel")}),e.jsx(Z,{onClick:W,color:"error",variant:"contained",children:t("Delete")})]})]})]})}function Ht({setSubmitMessage:n,boardUpdated:u,customTiles:i,mappedGroups:a,expanded:r,handleChange:m,tagList:l,updateTileId:t,setUpdateTileId:h}){const{t:x}=ee(),{settings:p}=De(),[s,o]=c.useState({gameMode:p.gameMode||"online",group:"",intensity:"",action:"",tags:[x("custom")]}),[G,w]=c.useState(!1),[E,S]=c.useState(""),[_,V]=c.useState(0);c.useEffect(()=>{const b=setTimeout(async()=>{if(!s.group||!s.intensity||!s.action){S("");return}try{const M=await Pe({group:s.group,intensity:Number(s.intensity),action:s.action,tags:s.tags,gameMode:s.gameMode,isCustom:1},p.locale||"en",s.gameMode);M.isValid?S(""):S(M.errors.join(", "))}catch(M){console.error("Error validating tile:",M),S("")}},300);return()=>clearTimeout(b)},[s.group,s.intensity,s.action,s.gameMode,s.tags,p.locale]),c.useEffect(()=>{const b=(Array.isArray(i)?i:[]).find(({id:M})=>M===t);if(b){const M=b.gameMode||p.gameMode;o({gameMode:M,group:b.group||"",intensity:b.intensity||"",action:b.action||"",tags:b.tags||[x("custom")]})}else o(M=>({...M,gameMode:p.gameMode}))},[t,p.gameMode,i,x]);function y(g,b,M){return(Array.isArray(i)?i:[]).find(U=>U.group===g&&U.intensity===b&&U.action===M)}function N(){h(null),o({gameMode:p.gameMode,group:"",intensity:"",action:"",tags:[x("custom")]}),S("")}const d=g=>{o(b=>({...b,group:g.name,intensity:""})),w(!1),V(b=>b+1)},T=()=>{V(g=>g+1)},L=c.useCallback(g=>{o(b=>({...b,intensity:g.toString()}))},[]);async function P(){const g=document.querySelector('input[name="tags"]'),b=[...s.tags];g&&g.value.trim()&&(b.push(g.value.trim()),g.value="");const{gameMode:M,group:z,intensity:U,action:Y}=s;if(!M||!z||!U||!Y)return n({message:x("allFieldsRequired","All fields are required"),type:"error"});if(E)return n({message:E,type:"error"});if(t==null&&y(z,U,Y))return n({message:x("actionExists"),type:"error"});const J={group:z,intensity:Number(U),action:Y,tags:b,gameMode:M,isCustom:1};try{const v=await Pe(J,p.locale||"en",M);if(!v.isValid)return n({message:v.errors.join(", "),type:"error"});if(t===null){const D=`${z} - Level ${U}`;ze(D,Y),await Ct(J)}else await It(t,J);return u(),o(D=>({...D,action:"",tags:[x("custom")]})),n({message:x(t?"customUpdated":"customAdded"),type:"success"})}catch(v){return console.error("Error saving custom tile:",v),n({message:x("Error saving tile"),type:"error"})}}const I=g=>{switch(g.key){case",":case"Enter":{g.preventDefault(),g.stopPropagation(),g.currentTarget.value.length>0&&(o(b=>({...b,tags:[...b.tags,g.currentTarget.value]})),g.currentTarget.value="");break}}},O=g=>{g.target.value.length>0&&(o(b=>({...b,tags:[...b.tags,g.target.value]})),g.target.value=""),setTimeout(()=>{const b=document.querySelector(".MuiAutocomplete-popper");b&&(b.style.display="none")},150)};return e.jsxs(e.Fragment,{children:[e.jsxs(ue,{expanded:r==="ctAdd",onChange:m("ctAdd"),children:[e.jsx(de,{"aria-controls":"ctAdd-content",id:"ctAdd-header",children:e.jsx(j,{children:e.jsx(R,{i18nKey:t?"ctUpdate":"ctAdd"})})}),e.jsx(me,{children:e.jsxs(A,{component:"form",method:"post",className:"settings-box",children:[e.jsxs(se,{select:!0,label:x("Game Mode"),value:s.gameMode,onChange:g=>{o(b=>({...b,gameMode:g.target.value,group:"",intensity:""}))},fullWidth:!0,sx:{mb:2},children:[e.jsx("option",{value:"online",children:"Online"}),e.jsx("option",{value:"local",children:"Local"}),e.jsx("option",{value:"solo",children:"Solo"})]}),e.jsx(zt,{value:s.group,onChange:g=>{o(b=>({...b,group:g,intensity:""}))},locale:p.locale||"en",gameMode:s.gameMode,refreshTrigger:_}),e.jsx(A,{sx:{mt:2},children:e.jsx(Bt,{groupName:s.group,value:Number(s.intensity)||0,onChange:L,locale:p.locale||"en",gameMode:s.gameMode})}),E&&e.jsx(A,{sx:{mt:1,mb:2},children:e.jsx(j,{color:"error",variant:"body2",children:E})}),e.jsx(se,{id:"action",name:"action",required:!0,fullWidth:!0,label:x("action"),sx:{mt:2,pb:2},value:s.action,onChange:g=>{o({...s,action:g.target.value})}}),e.jsx(rt,{id:"tags",disableCloseOnSelect:!0,multiple:!0,freeSolo:!0,options:l,value:s.tags,onChange:(g,b)=>{o({...s,tags:b})},renderInput:g=>(g.inputProps.onKeyDown=I,g.inputProps.onBlur=O,e.jsx(se,{...g,label:x("tags")})),sx:{pb:2},clearOnBlur:!0,blurOnSelect:!0,openOnFocus:!0,disablePortal:!1,componentsProps:{popper:{modifiers:[{name:"preventOverflow",options:{altAxis:!0,altBoundary:!0,padding:8}}]}}}),e.jsxs(A,{display:"flex",justifyContent:"space-evenly",gap:1,children:[e.jsx(Z,{variant:"outlined",type:"button",onClick:()=>w(!0),children:x("Manage Groups")}),e.jsx(Z,{variant:"contained",type:"button",onClick:()=>N(),children:e.jsx(R,{i18nKey:"clear"})}),e.jsx(Z,{variant:"contained",type:"button",onClick:P,children:e.jsx(R,{i18nKey:t?"ctUpdate":"ctAdd"})})]})]})})]}),e.jsx(Kt,{open:G,onClose:()=>w(!1),onGroupCreated:d,onGroupUpdated:T,locale:p.locale||"en",gameMode:s.gameMode})]})}function Xt({expanded:n,handleChange:u}){return e.jsxs(e.Fragment,{children:[e.jsxs(ue,{expanded:n==="help1",onChange:u("help1"),children:[e.jsx(de,{"aria-controls":"help1-content",id:"help1-header",children:e.jsx(j,{children:e.jsx(R,{i18nKey:"ctExplained"})})}),e.jsx(me,{children:e.jsxs(R,{i18nKey:"ctExplainedDescription",children:[e.jsx(j,{sx:{mb:2},children:"Custom tiles let you add your own variations to the game board. Utilize this dialog to add and remove tiles as you see fit."}),e.jsx(j,{sx:{mb:2},children:"Custom tiles are added based on the kink and intensity you pick from the drop down. As such, you need to have that kink and intensity (or a higher intensity) selected for your custom tiles to show on the board."}),e.jsx(j,{children:"Miscellaneous tiles are the only exception to the above. Regardless of what other options you pick, Miscellaneous tiles will show as their own group. If you use this option, ensure that you add multiple tiles to minimize repeats."})]})})]}),e.jsxs(ue,{expanded:n==="help2",onChange:u("help2"),children:[e.jsx(de,{"aria-controls":"help2-content",id:"help2-header",children:e.jsx(j,{children:e.jsx(R,{i18nKey:"ctIdeas"})})}),e.jsx(me,{children:e.jsxs(R,{i18nKey:"ctIdeasDescription",children:[e.jsx(j,{variant:"h6",children:"Add new Activities"}),e.jsx(j,{variant:"subtitle2",sx:{mb:2},children:"Come up with new activities that are not part of the existing list"}),e.jsx(j,{variant:"h6",children:"Add harder tiles to easier intensities"}),e.jsx(j,{variant:"subtitle2",sx:{mb:1},children:"When you pick higher intensity levels, the game will use the earlier intensity level and gradual move to whatyou picked. If you want harder tiles early on, add several to lower intensities."}),e.jsx(j,{variant:"subtitle2",sx:{mb:2},children:"Example: You play Poppers - Advanced. Add advanced tiles to Poppers - Beginner"}),e.jsx(j,{variant:"h6",children:"Combine activities into a single tile"}),e.jsx(j,{variant:"subtitle2",sx:{mb:1},children:"Combine multiple activites together in a single tile that normally would not go together."}),e.jsx(j,{variant:"subtitle2",sx:{mb:2},children:"Example: Spit roast. Use a toy in your throat and ass at the same time."}),e.jsx(j,{variant:"h6",children:"Miscellaneous custom tiles"}),e.jsx(j,{variant:"subtitle2",sx:{mb:1},children:"Miscellaneous tiles allow you to add your own tiles without including other groups. Be aware, you will want to add several options to this group to minimize repeats."})]})})]})]})}function Yt({gameMode:n,groupFilter:u,intensityFilter:i,groups:a,mappedGroups:r,dexieGroups:m,onGameModeChange:l,onGroupChange:t,onIntensityChange:h,hideAll:x=!1,sx:p={}}){const{t:s}=ee(),[o,G]=c.useState([]),w=x?1:"all",E=c.useMemo(()=>{if(!r?.[n])return[];const d=Be(r[n]);return Array.isArray(d)?d:[]},[r,n]),S=c.useCallback(d=>{if(m?.[d])return m[d].label||d;const T=E.find(L=>L.value===d);return T?.groupLabel?T.groupLabel:d},[m,E]),_=c.useCallback((d,T)=>{if(m?.[d]){const P=m[d].intensities.find(I=>I.value===Number(T));if(P?.label)return P.label}const L=E.find(P=>P.value===d&&P.intensity===Number(T));return L?.translatedIntensity?L.translatedIntensity:`Level ${Number(T)+1}`},[m,E]);c.useEffect(()=>{if(a){const d=Object.keys(a);G(d)}},[a,n]);function V(d){const T=d.target.value;t(T),h(w)}if(!o?.length)return null;const y=o.length===0||o.includes(u)?u:"",N=i==="all"?"all":i;return e.jsxs(A,{sx:{display:"flex",flexWrap:"wrap",gap:2,...p},children:[e.jsxs(B,{sx:{width:125,flexShrink:0},children:[e.jsx(K,{id:"game-mode-filter-label",children:e.jsx(R,{i18nKey:"customTiles.gameMode"})}),e.jsxs(H,{labelId:"game-mode-filter-label",id:"game-mode-filter",value:n,label:s("customTiles.gameMode","Game Mode"),onChange:d=>{l(d.target.value)},slotProps:{input:{"aria-label":s("customTiles.gameMode","Game Mode")}},children:[e.jsx(k,{value:"online",children:e.jsx(R,{i18nKey:"online"})}),e.jsx(k,{value:"local",children:e.jsx(R,{i18nKey:"local"})})]})]}),e.jsxs(B,{sx:{minWidth:150,flex:1},children:[e.jsx(K,{id:"group-filter-label",children:e.jsx(R,{i18nKey:"group"})}),e.jsx(H,{labelId:"group-filter-label",id:"group-filter",value:y,label:s("group"),onChange:V,slotProps:{input:{"aria-label":s("group")}},children:o.map(d=>e.jsxs(k,{value:d,children:[S(d),!x&&a[d]&&` (${a[d].count})`]},d))})]}),e.jsxs(B,{sx:{minWidth:200,flex:1},disabled:!y,children:[e.jsx(K,{id:"intensity-filter-label",children:e.jsx(R,{i18nKey:"customTiles.intensityLevel",children:"Intensity Level"})}),e.jsxs(H,{labelId:"intensity-filter-label",id:"intensity-filter",value:N,label:s("customTiles.intensityLevel","Intensity Level"),onChange:d=>h(d.target.value),slotProps:{input:{"aria-label":s("customTiles.intensityLevel","Intensity Level")}},children:[!x&&e.jsx(k,{value:"all",children:e.jsx(R,{i18nKey:"all",children:"All"})},"all"),y&&a&&a[y]&&Object.entries(a[y].intensities||{}).sort(([d],[T])=>Number(d)-Number(T)).map(([d,T])=>e.jsxs(k,{value:Number(d),children:[_(y,d),!x&&T!==void 0?` (${T})`:""]},d))]})]})]})}function Jt({tagList:n,boardUpdated:u,mappedGroups:i,updateTile:a,refreshTrigger:r}){const{t:m,i18n:l}=ee(),{settings:t}=De(),[h,x]=c.useState(null),[p,s]=c.useState(t.gameMode||"online"),[o,G]=c.useState(""),[w,E]=c.useState(""),[S,_]=c.useState(1),[V,y]=c.useState(!0),[N,d]=c.useState({items:[],total:0,totalPages:1}),[T,L]=c.useState({}),[P,I]=c.useState({}),O=10;c.useEffect(()=>{async function v(){try{y(!0);const[D,F]=await Promise.all([pe(l.resolvedLanguage,p),Gt(l.resolvedLanguage,p,h)]),X={};D.forEach(W=>{X[W.name]=W}),I(X);const ne={};D.forEach(W=>{const ie=F[W.name]||{count:0,intensities:{}};ne[W.name]={label:W.label||W.name,count:ie.count,intensities:ie.intensities}}),L(ne);const Q=D.map(W=>W.name),te=Q.includes(o);if((!o||!te)&&Q.length>0)G(Q[0]),E("all");else if(te&&w!=="all"){const W=D.find(ie=>ie.name===o);W&&(W.intensities.map(le=>le.value).includes(Number(w))||E("all"))}}catch(D){console.error("Error loading groups and counts:",D)}finally{y(!1)}}v()},[p,l.resolvedLanguage,h,o,w]),c.useEffect(()=>{let v=!0;async function D(){try{y(!0);const F={group:o,intensity:w==="all"?null:Number(w),tag:h,gameMode:p,locale:t.locale,page:S,limit:O,paginated:!0},X=await Me(F);v&&(d(X),setTimeout(()=>{v&&y(!1)},300))}catch(F){console.error("Error loading tiles:",F),v&&y(!1)}}return o?D():y(!1),()=>{v=!1}},[o,w,h,p,S,O,r,t.locale]);function g(v){y(!0),x(h===v?null:v)}function b(v,D){y(!0),_(D)}async function M(v){await wt(v),u();const D={group:o,intensity:w==="all"?null:w,tag:h,gameMode:p,locale:t.locale,page:S,limit:O,paginated:!0},F=await Me(D);d(F)}async function z(v){await Et(v),u(),d(D=>({...D,items:D.items.map(F=>F.id===v?{...F,isEnabled:!F.isEnabled}:F)}))}function U(v){a(v);const D=document.querySelector(".MuiDialogContent-root");D&&(D.scrollTop=0)}function Y(v,D){const F=P[v];if(F){const X=F.label||v,Q=F.intensities.find(te=>te.value===Number(D))?.label||`Level ${Number(D)+1}`;return`${X} - ${Q}`}return`${v} - Level ${Number(D)+1}`}const J=N.items?.map(({id:v,group:D,intensity:F,action:X,tags:ne,isEnabled:Q=!0,isCustom:te=!0})=>e.jsxs(at,{sx:{my:2},children:[e.jsx(ot,{title:X,slotProps:{title:{variant:"body1"},subheader:{variant:"body2"},action:{"aria-label":m("customTiles.actions")}},subheader:Y(D,F),action:e.jsxs(e.Fragment,{children:[e.jsx(lt,{checked:!!Q,onChange:()=>v!==void 0&&z(v),slotProps:{input:{"aria-label":m("customTiles.toggleTile")}}}),!!te&&e.jsxs(e.Fragment,{children:[e.jsx(ae,{onClick:()=>v!==void 0&&U(v),"aria-label":m("customTiles.update"),children:e.jsx(Re,{})}),e.jsx(ae,{onClick:()=>v!==void 0&&M(v),"aria-label":m("customTiles.delete"),children:e.jsx(Te,{})})]})]}),sx:{pb:0}}),e.jsx(ct,{children:ne?.map(W=>e.jsx(ye,{label:W,sx:{m:.5}},W))})]},v));return e.jsxs(A,{children:[e.jsx(A,{children:n?.map(v=>e.jsx(ye,{label:v,sx:{m:.5},color:h===v?"primary":"default",onClick:()=>g(v)},v))}),e.jsx(A,{sx:{display:"flex",flexDirection:"column",gap:2,my:2,transition:"all 0.3s ease-in-out"},children:e.jsx(Yt,{gameMode:p,groupFilter:o,intensityFilter:w,groups:T,mappedGroups:i,dexieGroups:P,onGameModeChange:v=>{s(v),G(""),E(""),_(1)},onGroupChange:v=>{G(v),_(1)},onIntensityChange:v=>{E(v),_(1)}})}),e.jsxs(A,{sx:{position:"relative",minHeight:"200px"},children:[e.jsx(ut,{in:V,timeout:300,children:e.jsx(A,{sx:{position:"absolute",top:0,left:0,right:0,bottom:0,display:"flex",justifyContent:"center",alignItems:"center",backgroundColor:"rgba(255, 255, 255, 0)",zIndex:1,borderRadius:1},children:e.jsx(_e,{})})}),e.jsx(A,{sx:{opacity:V?.3:1,transition:"opacity 0.3s ease-in-out",pointerEvents:V?"none":"auto"},children:N.items.length===0?e.jsx(j,{variant:"body1",sx:{textAlign:"center",my:4},children:e.jsx(R,{i18nKey:"customTiles.noTilesFound",children:"No tiles found with the selected filters."})}):e.jsxs(e.Fragment,{children:[J,N.totalPages>1&&e.jsx(A,{sx:{display:"flex",justifyContent:"center",mt:3,mb:2},children:e.jsx(dt,{count:N.totalPages,page:S,onChange:b,color:"primary"})}),e.jsx(j,{variant:"body2",sx:{textAlign:"center",mt:2,color:"text.secondary"},children:e.jsxs(R,{i18nKey:"customTiles.showingTiles",values:{shown:N.items.length,total:N.total},children:["Showing ",{shown:N.items.length}," of ",{total:N.total}," tiles"]})})]})})]})]})}function ds({boardUpdated:n,setOpen:u,open:i=!1}){const{t:a,i18n:r}=ee(),m=ke(),l=ke("md"),[t,h]=c.useState({message:"",type:"info"}),[x,p]=c.useState("ctAdd"),[s,o]=c.useState(null),[G,w]=c.useState(0),[E,S]=c.useState({online:{},local:{},solo:{}}),[_,V]=c.useState(!0),y=c.useCallback(()=>{w(I=>I+1)},[]),N=I=>(O,g)=>{p(g?I:"")};c.useEffect(()=>{async function I(){V(!0);try{const[O,g,b]=await Promise.all([ge(r.resolvedLanguage,"online"),ge(r.resolvedLanguage,"local"),ge(r.resolvedLanguage,"solo")]);S({online:O,local:g,solo:b})}catch(O){console.error("Error loading game mode actions:",O)}finally{V(!1)}}I()},[r.resolvedLanguage]);const d=gt(()=>At({locale:r.resolvedLanguage})),T=c.useMemo(()=>d?Array.isArray(d)?d.map(({tags:I})=>I).flat().filter((I,O,g)=>I&&g.indexOf(I)===O).sort():[]:[],[d]),L=c.useCallback(async I=>{await Lt(I),n(),y()},[n,y]);if(!d||_)return null;const P=()=>{const I=e.jsxs(e.Fragment,{children:[e.jsx(Xt,{expanded:x,handleChange:N}),e.jsx(Ht,{setSubmitMessage:h,boardUpdated:()=>{n(),y()},customTiles:d,mappedGroups:E,expanded:x,handleChange:N,tagList:T,updateTileId:s,setUpdateTileId:o}),e.jsx(qt,{expanded:x,handleChange:N,customTiles:d,mappedGroups:E,setSubmitMessage:h,bulkImport:L})]}),O=Array.isArray(d)&&d.length>0&&e.jsx(A,{children:e.jsx(Jt,{tagList:T,boardUpdated:()=>{n(),y()},mappedGroups:E,updateTile:g=>{o(g),p("ctAdd")},refreshTrigger:G})});return l?e.jsxs(e.Fragment,{children:[I,O&&e.jsxs(e.Fragment,{children:[e.jsx(Ue,{sx:{my:2}}),O]})]}):e.jsxs(he,{container:!0,spacing:2,children:[e.jsx(he,{size:{xs:12,md:6},children:I}),e.jsx(he,{size:{xs:12,md:6},children:O})]})};return e.jsxs(e.Fragment,{children:[e.jsxs(be,{fullScreen:m,open:i,onClose:()=>u(!1),maxWidth:l?"sm":"lg",fullWidth:!0,children:[e.jsxs(je,{children:[e.jsx(R,{i18nKey:"manageTiles"}),e.jsx(ae,{"aria-label":a("close"),onClick:()=>u(!1),sx:{position:"absolute",right:8,top:8,color:I=>I.palette.grey[500]},children:e.jsx(mt,{})})]}),e.jsx(ve,{children:P()})]}),e.jsx(Dt,{open:!!t.message,close:()=>h({message:"",type:"info"}),type:t.type,children:t.message})]})}function ms(n={},u={}){const[i]=$t(),a={...n,...i,selectedActions:i?.selectedActions||{},...u},[r,m]=c.useState(a),{messages:l}=Mt(),[t,h]=c.useState(!1);return c.useEffect(()=>{const x=St(l,"room");if(x?.settings)try{const p=JSON.parse(x.settings);m(s=>t?s.selectedActions&&Object.keys(s.selectedActions).length>0?{...s,...p,selectedActions:s.selectedActions}:{...s,...p}:(h(!0),{...s,...p}))}catch(p){console.error("Error parsing message settings:",p)}else t||h(!0)},[l,t]),[r,m]}const fe=new Map,Oe=_t;function ps(n){const{i18n:u}=ee(),[i,a]=c.useState({}),[r,m]=c.useState(!0),l=c.useMemo(()=>!n||!u.resolvedLanguage?"":`${u.resolvedLanguage}-${n}`,[u.resolvedLanguage,n]);c.useEffect(()=>{if(l){const h=fe.get(l);h&&Date.now()-h.timestamp<Oe&&(a(h.data),m(!1))}},[l]);const t=c.useCallback(async()=>{if(!n||!l)return;const h=fe.get(l);if(h&&Date.now()-h.timestamp<Oe){a(h.data),m(!1);return}m(!0);try{const x=await pe(u.resolvedLanguage,n),p={};for(const s of x){const o={[We]:[]};s.intensities&&Array.isArray(s.intensities)&&s.intensities.sort((w,E)=>w.value-E.value).forEach(w=>{o[w.label]=[]});const G=s.type||"action";p[s.name]={label:s.label||s.name,type:G,actions:o}}fe.set(l,{data:p,timestamp:Date.now()}),a(p)}catch(x){console.error("Error loading unified actions:",x),a({})}finally{m(!1)}},[n,u.resolvedLanguage,l]);return c.useEffect(()=>{l&&t()},[t,l]),{actionsList:i,isLoading:r}}export{ds as C,ps as a,Be as b,Ot as g,ms as u};
