const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["js/getUniqueImportRecords.ts-DbevqHRY.js","js/chunk-DCqCmTw7.js","js/chunk-rJHcTq4h.js","js/chunk-YpQmZHCE.js","js/chunk-5SGEHjMG.js","js/chunk-BxyRzOKK.js","js/chunk-DyYP0jr7.js","assets/index-CRbdjLFF.js","js/chunk-Ddv6gvN9.js","js/chunk-BqV4rolb.js","js/chunk-DEqwrMjb.js","js/chunk-BKkrGAF_.js","js/chunk-Cpw0r6bE.js","js/chunk-DsesnlQY.js","js/chunk-CY6JpaOE.js","js/chunk-Chz5q09A.js","js/chunk-Bmx5YEUT.js","js/chunk-B47UJojq.js"])))=>i.map(i=>d[i]);
import{b as a,u as ie,j as e,t as T,aw as N,ar as I,Q as X,O as H,ax as J,M as F,S as ne,aP as Be,a3 as te,ay as De,a6 as fe,a8 as ye,aA as be,ac as it,ab as Me,aa as je,a7 as ve,R as ot,a5 as Te,aV as Ce,b4 as at,I as re,ae as pe,a4 as Fe,b5 as lt,aU as $e,b6 as Oe,au as ct,aX as ut,aF as dt,b7 as pt,X as mt,b8 as gt,at as ge}from"./chunk-DCqCmTw7.js";import{n as xe,u as xt}from"./chunk-rJHcTq4h.js";import{D as ht,b as ue,c as Ae,d as Ue,e as ft,f as yt,h as bt,j as Pe,k as jt,t as vt,i as Tt}from"./chunk-YpQmZHCE.js";import{A as ae,a as le,b as ce,u as Ge}from"./chunk-Ddv6gvN9.js";import{T as Ct}from"./chunk-Cpw0r6bE.js";import{q as de,g as Ie,I as qe,s as Xe,_ as He,J as Ne,K as Je,H as ke,L as Gt,M as It,B as he,x as St}from"./chunk-5SGEHjMG.js";import{C as wt}from"./chunk-DsesnlQY.js";import{g as Et,b as Lt}from"./chunk-BqV4rolb.js";import{v as Ye,g as Dt,d as At,e as Re}from"./chunk-CY6JpaOE.js";import{E as Qe,o as Se,p as Nt,x as We,y as Ke,r as ze,z as kt,t as _t,B as Mt,F as Ft,I as $t,J as Ot,K as Pt,g as Rt}from"./chunk-DyYP0jr7.js";import{l as Wt}from"./chunk-DEqwrMjb.js";(function(){var u=typeof window!="undefined"?window:typeof global!="undefined"?global:typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:{};u.SENTRY_RELEASE={id:"b82d01bea29447e452b49ba3e85b9fac2f7942a4"}})();try{(function(){var u=typeof window!="undefined"?window:typeof global!="undefined"?global:typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:{},x=new u.Error().stack;x&&(u._sentryDebugIds=u._sentryDebugIds||{},u._sentryDebugIds[x]="8fa5f841-75f0-4258-9f39-6fe0d79f76de",u._sentryDebugIdIdentifier="sentry-dbid-8fa5f841-75f0-4258-9f39-6fe0d79f76de")})()}catch(u){}function Ze(u){return Object.entries(u).flatMap(([x,{label:r,actions:h}])=>h?Object.keys(h).filter(y=>y!==ht).map((y,d)=>({group:Et(x),groupLabel:r,value:x,intensity:Number(d+1),translatedIntensity:y,label:`${r} - ${y}`})):[])}const we="2.0.0",Kt=2,et=0;async function Ee(u="en",x={}){try{let r;if(x.exportScope==="single"&&x.singleGroup){const n=await de(x.singleGroup,u);r=n&&!n.isDefault?[n]:[]}else x.exportScope==="default"?r=[]:r=(await Ie({locale:u})).filter(o=>!o.isDefault);const h=await Ie({locale:u}),l=new Set(h.filter(n=>n.isDefault).map(n=>n.name)),d=(await ue({isCustom:1})).filter(n=>{const o=!n.locale||n.locale===u;return x.exportScope==="single"&&x.singleGroup?o&&n.group===x.singleGroup:x.exportScope==="default"?o&&l.has(n.group):o}),i={};for(const n of r){const o=n.intensities.sort((D,E)=>D.value-E.value).map(D=>D.label),G=n.intensities.find(D=>D.value===et),S=o.filter(D=>D!==(G==null?void 0:G.label)),K=G?[G.label,...S]:o;i[n.name]={label:n.label,type:n.type||"sex",intensities:K}}const t={};for(const n of d)t[n.group]||(t[n.group]={}),t[n.group][n.intensity]||(t[n.group][n.intensity]=[]),n.tags&&n.tags.length>0?t[n.group][n.intensity].push({action:n.action,tags:n.tags}):t[n.group][n.intensity].push(n.action);const c={};Object.keys(i).sort().forEach(n=>{c[n]=i[n]});const b={};return Object.keys(t).sort().forEach(n=>{b[n]={},Object.keys(t[n]).sort((o,G)=>Number.parseInt(o,10)-Number.parseInt(G,10)).forEach(o=>{b[n][Number.parseInt(o,10)]=t[n][Number.parseInt(o,10)]})}),JSON.stringify({version:we,locale:u,groups:c,customTiles:b},(n,o)=>(Array.isArray(o)&&o.length>0&&typeof o[0]=="string",o),Kt)}catch(r){throw console.error("Error exporting clean data:",r),new Error(`Export failed: ${r}`)}}async function zt(u,x={}){const r={success:!1,importedGroups:0,importedTiles:0,errors:[],warnings:[]};try{let h;try{h=JSON.parse(u)}catch(d){return r.errors.push("Invalid JSON format"),console.warn("Failed to parse import data JSON:",d),r}if(!h.version||!h.groups||!h.customTiles)return r.errors.push("Invalid export format - missing version, groups, or customTiles"),r;h.version!==we&&r.warnings.push(`Format version mismatch: expected ${we}, got ${h.version}`);const l=x.locale||h.locale||"en",y=x.mergeStrategy||"skip";for(const[d,i]of Object.entries(h.groups))try{const t=await de(d,l);let c=d;if(t)switch(y){case"skip":r.warnings.push(`Skipped existing group: ${d}`);continue;case"overwrite":r.warnings.push(`Will update existing group: ${d}`);break;case"rename":{let o=1;for(c=`${d}_imported`;await de(c,l);)c=`${d}_imported_${o}`,o++;r.warnings.push(`Renamed group from ${d} to ${c}`);break}}const b=i.intensities.map((o,G)=>({id:`intensity-${G}`,label:o,value:G,isDefault:G===et})),s={name:c,label:i.label,intensities:b,type:i.type,locale:l,isDefault:!1},n=await Ye(s);if(!n.isValid){r.errors.push(`Invalid group ${c}: ${n.errors.join(", ")}`);continue}t&&y==="overwrite"?await qe(t.id,s):await Xe(s),r.importedGroups++}catch(t){r.errors.push(`Error importing group ${d}: ${t}`)}for(const[d,i]of Object.entries(h.customTiles))try{const t=await de(d,l);if(!t){r.warnings.push(`Group ${d} not found for custom tiles, skipping tiles`);continue}for(const[c,b]of Object.entries(i)){const s=Number.parseInt(c,10);if(!t.intensities.find(o=>o.value===s)){r.warnings.push(`Intensity ${s} not valid for group ${d}, skipping tiles`);continue}for(const o of b)try{let G,S=[];if(typeof o=="string")G=o;else if(o&&typeof o=="object"&&"action"in o)G=o.action,S=o.tags||[];else{r.warnings.push(`Invalid tile data format in group ${d}, skipping`);continue}if((await ue()).find(E=>E.group===d&&E.intensity===s&&E.action===G&&(!E.locale||E.locale===l))&&y==="skip"){r.warnings.push(`Skipped existing tile: ${G.substring(0,50)}...`);continue}await Ae({group:d,intensity:s,action:G,tags:S,isCustom:1,locale:l}),r.importedTiles++}catch(G){r.errors.push(`Error importing tile "${typeof o=="string"?o.substring(0,30):"object"}...": ${G}`)}}}catch(t){r.errors.push(`Error importing tiles for group ${d}: ${t}`)}return r.success=r.errors.length===0,r}catch(h){return r.errors.push(`Import failed: ${h}`),r}}async function Vt(u,x,r="en",h="online"){const l={success:!1,importedGroups:0,importedTiles:0,errors:[],warnings:[]};try{const{default:y}=await He(async()=>{const{default:c}=await import("./getUniqueImportRecords.ts-DbevqHRY.js");return{default:c}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17])),d=await ue(),{newUniqueRecords:i,changedTagRecords:t}=y(u,d,x);for(const c of i)try{await Ae(c),l.importedTiles++}catch(b){l.errors.push(`Error importing tile: ${b}`)}for(const c of t)try{c.id&&await Ue(c.id,c)}catch(b){l.errors.push(`Error updating tile: ${b}`)}return l.success=l.errors.length===0,l.warnings.push("Imported using legacy format. Consider exporting in clean v2.0 format for better compatibility."),l}catch(y){return l.errors.push(`Legacy import failed: ${y}`),l}}async function Bt(u,x="en"){return Ee(x,{singleGroup:u,exportScope:"single"})}async function Ut(u,x,r={}){const h=u.trim();try{const l=JSON.parse(h);if(l.version&&l.groups)return zt(h,r);if(l.version&&l.customGroups!==void 0)return{success:!1,importedGroups:0,importedTiles:0,errors:["Old enhanced format no longer supported. Please use clean v2.0 format."],warnings:[]}}catch(l){}return Vt(h,x,r.locale||"en",r.gameMode||"online")}async function qt(u="en"){try{const r=(await Ie({locale:u})).filter(l=>!l.isDefault),h=await ue({isCustom:1});return r.map(l=>{const y=h.filter(d=>d.group===l.name&&(!d.locale||d.locale===u));return{name:l.name,label:l.label,tileCount:y.length}})}catch(x){return console.error("Error getting available groups for export:",x),[]}}function Xt({expanded:u,handleChange:x,customTiles:r,mappedGroups:h,setSubmitMessage:l,bulkImport:y}){const d=a.useRef(null),{t:i}=ie(),{settings:t}=Ne(),[c,b]=a.useState(""),[s,n]=a.useState(null),[o,G]=a.useState("clean"),[S,K]=a.useState("all"),[D,E]=a.useState(""),[$,_]=a.useState([]),[m,M]=a.useState("skip"),z=a.useCallback(async()=>{try{if(o==="clean"){let p;switch(S){case"single":if(!D){l({message:i("errors.selectGroupToExport"),type:"error"});return}p=await Bt(D,t.locale||"en");break;case"default":p=await Ee(t.locale||"en",{exportScope:"default"});break;default:p=await Ee(t.locale||"en",{exportScope:"all"});break}b(p)}else{const g=r.filter(v=>v.isCustom).map(({group:v,intensity:w,action:B,tags:P,gameMode:V="online"})=>{const R=Ze(h[V]||{}).find(A=>(A==null?void 0:A.intensity)===Number(w)&&(A==null?void 0:A.value)===v);let j="";return j+=`[${(R==null?void 0:R.group)||v} - ${(R==null?void 0:R.translatedIntensity)||w}]
`,j+=B,j+=P!=null&&P.length?`
Tags: `+(P==null?void 0:P.join(", ")):"",j+=`
GameMode: ${V}`,j});b(g.join(`
---
`))}}catch(p){console.error("Error exporting data:",p),l({message:i("errors.exportFailed",{error:p}),type:"error"})}},[r,h,b,o,S,D,t.locale,l,i]);async function k(p){if(!p.current)return;const v=p.current.importData.value;if(!v.trim())return l({type:"error",message:i("enterDataToImport")});try{l({type:"info",message:i("importMessages.importing")});const w=await Ut(v,h,{locale:t.locale||"en",mergeStrategy:m});if(n(w),w.success){w.importedTiles>0&&(await He(()=>import("./chunk-YpQmZHCE.js").then(function(V){return V.p}),__vite__mapDeps([3,4,1,2,5,6,7])).then(V=>V.getTiles({isCustom:1}))).slice(-w.importedTiles).forEach(async V=>{Je(`${V.group} - ${V.intensity}`,V.action)});let B=i("importMessages.importSuccess");w.importedGroups>0&&(B+=` ${i("importMessages.importedGroups",{count:w.importedGroups})}`),w.importedTiles>0&&(B+=` ${i("importMessages.importedTiles",{count:w.importedTiles})}`),l({type:"success",message:B}),await z()}else l({type:"error",message:i("errors.importFailed",{errors:w.errors.join(", ")})})}catch(w){console.error("Import error:",w),l({type:"error",message:i("errors.importFailed",{errors:w.message||w})}),n(null)}}const L=a.useCallback(async()=>{try{const p=await qt(t.locale||"en");_(p)}catch(p){console.error("Error loading available groups:",p)}},[t.locale]);return a.useEffect(()=>{u==="ctImport"&&(L(),z())},[u,r,z,L]),e.jsxs(ae,{expanded:u==="ctImport",onChange:x("ctImport"),className:"about-accordion",children:[e.jsx(le,{"aria-controls":"ctImport-content",id:"ctImport-header",children:e.jsx(T,{className:"accordion-title",children:e.jsx(N,{i18nKey:"importExport"})})}),e.jsxs(ce,{children:[e.jsx(T,{variant:"body1",sx:{mb:2},children:e.jsx(N,{i18nKey:"ctImportDescription"})}),e.jsxs(I,{sx:{display:"flex",flexWrap:"wrap",gap:2,mb:2,"& .MuiFormControl-root":{minWidth:150,flex:"1 1 auto"}},children:[e.jsxs(X,{size:"small",children:[e.jsx(H,{children:i("labels.exportFormat")}),e.jsxs(J,{value:o,onChange:p=>G(p.target.value),label:i("labels.exportFormat"),children:[e.jsx(F,{value:"clean",children:i("exportFormat.clean")}),e.jsx(F,{value:"legacy",children:i("exportFormat.legacy")})]})]}),o==="clean"&&e.jsxs(X,{size:"small",children:[e.jsx(H,{children:i("labels.exportScope")}),e.jsxs(J,{value:S,onChange:p=>{K(p.target.value),E("")},label:i("labels.exportScope"),children:[e.jsx(F,{value:"all",children:i("exportScope.all")}),e.jsx(F,{value:"default",children:i("exportScope.default")}),e.jsx(F,{value:"single",children:i("exportScope.single")})]})]}),e.jsxs(X,{size:"small",children:[e.jsx(H,{children:i("labels.importStrategy")}),e.jsxs(J,{value:m,onChange:p=>M(p.target.value),label:i("labels.importStrategy"),children:[e.jsx(F,{value:"skip",children:i("importStrategy.skip")}),e.jsx(F,{value:"overwrite",children:i("importStrategy.overwrite")}),e.jsx(F,{value:"rename",children:i("importStrategy.rename")})]})]})]}),o==="clean"&&S==="single"&&e.jsx(I,{sx:{mb:2},children:e.jsxs(X,{size:"small",fullWidth:!0,children:[e.jsx(H,{children:i("labels.selectGroup")}),e.jsx(J,{value:D,onChange:p=>E(p.target.value),label:i("labels.selectGroup"),children:$.map(p=>e.jsxs(F,{value:p.name,children:[p.label," (",p.tileCount," tiles)"]},p.name))})]})}),e.jsxs(I,{component:"form",method:"post",ref:d,children:[e.jsx(ne,{id:"importData",name:"importData",multiline:!0,required:!0,fullWidth:!0,rows:6,sx:{pb:2},value:c,onChange:p=>b(p.target.value),placeholder:i(o==="clean"?"placeholder.cleanFormat":"placeholder.legacyFormat"),InputProps:{endAdornment:e.jsx(wt,{text:c}),sx:{alignItems:"flex-start"}}}),s&&e.jsxs(Be,{severity:s.success?"success":"error",sx:{mb:2},onClose:()=>n(null),children:[e.jsx(T,{variant:"body2",children:e.jsx("strong",{children:e.jsx(N,{i18nKey:"importResults.title"})})}),s.importedGroups>0&&e.jsxs(T,{variant:"body2",children:["•"," ",e.jsx(N,{i18nKey:"importResults.groupsImported",values:{count:s.importedGroups}})]}),s.importedTiles>0&&e.jsxs(T,{variant:"body2",children:["•"," ",e.jsx(N,{i18nKey:"importResults.tilesImported",values:{count:s.importedTiles}})]}),s.warnings.length>0&&e.jsxs(I,{sx:{mt:1},children:[e.jsx(T,{variant:"body2",color:"warning.main",children:e.jsx("strong",{children:e.jsx(N,{i18nKey:"importResults.warnings"})})}),s.warnings.map((p,g)=>e.jsxs(T,{variant:"body2",color:"warning.main",children:["• ",p]},g))]}),s.errors.length>0&&e.jsxs(I,{sx:{mt:1},children:[e.jsx(T,{variant:"body2",color:"error.main",children:e.jsx("strong",{children:e.jsx(N,{i18nKey:"importResults.errors"})})}),s.errors.map((p,g)=>e.jsxs(T,{variant:"body2",color:"error.main",children:["• ",p]},g))]})]}),e.jsx(te,{fullWidth:!0,variant:"contained",type:"button",onClick:()=>k(d),children:e.jsx(N,{i18nKey:"import"})})]}),o==="clean"&&e.jsxs(ae,{sx:{mt:2},className:"about-accordion",children:[e.jsx(le,{children:e.jsx(T,{variant:"subtitle2",className:"accordion-title",children:e.jsx(N,{i18nKey:"formatGuide.title"})})}),e.jsxs(ce,{children:[e.jsx(T,{variant:"body2",sx:{mb:2},children:e.jsx(N,{i18nKey:"formatGuide.description"})}),e.jsx(T,{variant:"body2",sx:{mb:1,fontWeight:"bold"},children:e.jsx(N,{i18nKey:"formatGuide.keySections"})}),e.jsx(T,{variant:"body2",component:"div",sx:{mb:2,ml:2},children:e.jsx(N,{i18nKey:"formatGuide.keySectionsContent",components:{strong1:e.jsx("strong",{}),strong2:e.jsx("strong",{}),br:e.jsx("br",{})}})}),e.jsx(T,{variant:"body2",sx:{mb:1,fontWeight:"bold"},children:e.jsx(N,{i18nKey:"formatGuide.manualEditing"})}),e.jsx(T,{variant:"body2",component:"div",sx:{mb:2,ml:2},children:e.jsx(N,{i18nKey:"formatGuide.manualEditingContent",components:{br:e.jsx("br",{})}})}),e.jsx(T,{variant:"body2",sx:{mb:1,fontWeight:"bold"},children:e.jsx(N,{i18nKey:"formatGuide.customTilesFormat"})}),e.jsx(T,{variant:"body2",component:"div",sx:{ml:2},children:e.jsx(N,{i18nKey:"formatGuide.customTilesFormatContent",components:{br:e.jsx("br",{}),code1:e.jsx("code",{}),code2:e.jsx("code",{})}})})]})]})]})]})}function Ht({value:u,onChange:x,locale:r,gameMode:h,includeDefault:l=!0,disabled:y=!1,refreshTrigger:d=0}){const{t:i}=ie(),[t,c]=a.useState([]),[b,s]=a.useState(!0);return a.useEffect(()=>{(async()=>{s(!0);try{const o=await ke(r,h),G=l?o:o.filter(S=>!S.isDefault);c(G)}catch(o){console.error("Error loading custom groups:",o),c([])}finally{s(!1)}})()},[r,h,l,d]),b?e.jsxs(X,{fullWidth:!0,disabled:!0,children:[e.jsx(H,{children:i("customGroups.loadingGroups")}),e.jsx(J,{value:"",children:e.jsx(F,{value:"",children:e.jsxs(I,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(De,{size:16}),e.jsx("span",{children:i("customGroups.loadingGroups")})]})})})]}):e.jsx(I,{children:e.jsxs(X,{fullWidth:!0,disabled:y,children:[e.jsx(H,{id:"group-label",children:i("group")}),e.jsx(J,{labelId:"group-label",value:u,onChange:n=>x(n.target.value),label:i("group"),children:t.length===0?e.jsx(F,{value:"",disabled:!0,children:e.jsx(T,{color:"text.secondary",children:i("customGroups.noGroupsAvailable",{locale:r,gameMode:h})})}):t.map(n=>e.jsx(F,{value:n.name,children:e.jsxs(I,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx("span",{children:n.label}),n.isDefault&&e.jsx(fe,{label:i("default"),size:"small",variant:"outlined"})]})},n.id))})]})})}function Jt({groupName:u,value:x,onChange:r,locale:h,gameMode:l,disabled:y=!1}){const{t:d}=ie(),[i,t]=a.useState([]),[c,b]=a.useState(!1);a.useEffect(()=>{(async()=>{if(!u){t([]);return}b(!0);try{const o=await Gt(u,h,l);t(o)}catch(o){console.error("Error loading group intensities:",o),t([])}finally{b(!1)}})()},[u,h,l]);const s=a.useMemo(()=>i.sort((n,o)=>n.value-o.value),[i]);return a.useEffect(()=>{if(i.length>0&&x&&!i.some(n=>n.value===x)){const n=s[0];n&&r(n.value)}},[i,x,r,s]),u?c?e.jsxs(X,{fullWidth:!0,disabled:!0,children:[e.jsx(H,{children:d("customGroups.loadingIntensities")}),e.jsx(J,{value:"",children:e.jsx(F,{value:"",children:e.jsxs(I,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(De,{size:16}),e.jsx("span",{children:d("customGroups.loadingIntensities")})]})})})]}):i.length===0?e.jsxs(X,{fullWidth:!0,disabled:!0,children:[e.jsx(H,{children:d("intensity")}),e.jsx(J,{value:"",children:e.jsx(F,{value:"",disabled:!0,children:e.jsx(T,{color:"text.secondary",children:d("customGroups.noIntensitiesAvailable",{groupName:u})})})})]}):e.jsx(I,{children:e.jsxs(X,{fullWidth:!0,disabled:y,children:[e.jsx(H,{children:d("intensity")}),e.jsx(J,{value:x||"",onChange:n=>r(Number(n.target.value)),label:d("intensity"),children:s.map(n=>e.jsx(F,{value:n.value,children:n.label},n.id))})]})}):e.jsxs(X,{fullWidth:!0,disabled:!0,children:[e.jsx(H,{children:d("intensity")}),e.jsx(J,{value:"",children:e.jsx(F,{value:"",disabled:!0,children:e.jsx(T,{color:"text.secondary",children:d("customGroups.selectGroupFirst")})})})]})}const Le=[{name:"Basic (1-4)",intensities:[{label:"intensityLabels.light",value:1,isDefault:!0},{label:"intensityLabels.medium",value:2,isDefault:!0},{label:"intensityLabels.intense",value:3,isDefault:!0},{label:"intensityLabels.extreme",value:4,isDefault:!0}]},{name:"Simple (1-3)",intensities:[{label:"intensityLabels.beginner",value:1,isDefault:!0},{label:"intensityLabels.intermediate",value:2,isDefault:!0},{label:"intensityLabels.advanced",value:3,isDefault:!0}]},{name:"Extended (1-5)",intensities:[{label:"intensityLabels.veryLight",value:1,isDefault:!0},{label:"intensityLabels.light",value:2,isDefault:!0},{label:"intensityLabels.medium",value:3,isDefault:!0},{label:"intensityLabels.intense",value:4,isDefault:!0},{label:"intensityLabels.veryIntense",value:5,isDefault:!0}]}],Ve=u=>{const x=Le.findIndex(r=>r.intensities.length===u.length);return x>=0?x:1};function Yt({open:u,onClose:x,onGroupCreated:r,onGroupUpdated:h,editingGroup:l,locale:y,gameMode:d}){var i;const{t}=ie(),[c,b]=a.useState(0),[s,n]=a.useState([]),[o,G]=a.useState(!0),[S,K]=a.useState({}),D=Dt(),[E,$]=a.useState(""),[_,m]=a.useState(""),[M,z]=a.useState(1),[k,L]=a.useState([t("intensityLabels.beginner"),t("intensityLabels.intermediate"),t("intensityLabels.advanced")]),[p,g]=a.useState(null),[v,w]=a.useState(!1),[B,P]=a.useState({isValid:!0,errors:[]}),[V,Y]=a.useState(!1),[R,j]=a.useState(null),A=a.useCallback(async()=>{try{const C=(await ke(y,d)).filter(q=>!q.isDefault);n(C);const O={};await Promise.all(C.map(async q=>{O[q.id]=await ft(q.name,y,d)})),K(O)}catch(f){console.error("Error reloading groups:",f)}},[y,d]);a.useEffect(()=>{(async()=>{if(u){G(!0);try{await A()}catch(C){console.error("Error loading groups:",C)}finally{G(!1)}}})()},[u,y,d,A]);const W=f=>f.toLowerCase().replace(/[^a-z0-9\s]/g,"").replace(/\s+/g,"_").substring(0,20)||`group_${xe(6).toLowerCase()}`;a.useEffect(()=>{l?(g(l),$(l.label),m(l.type||""),L(l.intensities.map(f=>f.label)),z(Ve(l.intensities))):p?($(p.label),m(p.type||""),L(p.intensities.map(f=>f.label)),z(Ve(p.intensities))):(g(null),$(""),m(""),z(1),L([t("intensityLabels.beginner"),t("intensityLabels.intermediate"),t("intensityLabels.advanced")])),P({isValid:!0,errors:[]})},[l,p,u,t]);const Q=f=>{const C=Le[f];z(f),L(C.intensities.map(O=>t(O.label)))},Z=(f,C)=>{const O=[...k];O[f]=C,L(O)},ee=()=>{k.length>=D.MAX_INTENSITIES_COUNT||L([...k,t("customGroups.levelLabel",{level:k.length+1})])},se=f=>{if(k.length<=D.MIN_INTENSITIES_COUNT)return;const C=k.filter((O,q)=>q!==f);L(C)};a.useEffect(()=>{(async()=>{if(!E.trim()&&!_&&k.length===0){P({isValid:!0,errors:[]});return}const C=[];if(_&&!D.VALID_GROUP_TYPES.includes(_)&&C.push(t("typeValidationError",{types:D.VALID_GROUP_TYPES.join(", ")})),E.trim()&&!_&&C.push(t("typeRequiredError")),C.length>0){P({isValid:!1,errors:C});return}const O=k.map((nt,rt)=>({id:xe(),label:nt,value:rt+1,isDefault:!1})),q={name:p?p.name:W(E),label:E.trim(),intensities:O,type:_||void 0,locale:y,gameMode:d,isDefault:!1},st=await Ye(q,p==null?void 0:p.id);P(st)})()},[E,_,k,y,d,p,t,D.VALID_GROUP_TYPES]);const U=f=>{g(f),$(f.label),L(f.intensities.map(C=>C.label)),b(1)},oe=async f=>{const C=s.find(q=>q.id===f);if(!C)return;const O=S[f]||0;j({id:f,name:C.label,tileCount:O}),Y(!0)},me=async()=>{if(!R)return;const{id:f,tileCount:C}=R,O=s.find(q=>q.id===f);if(O)try{C>0&&await yt(O.name,y,d),await It(f),await A(),h==null||h(null)}catch(q){console.error("Error deleting group:",q)}finally{Y(!1),j(null)}},tt=async()=>{if(!(!B.isValid||v)){w(!0);try{const f=k.map((O,q)=>({id:xe(),label:O,value:q+1,isDefault:!1})),C={name:p?p.name:W(E),label:E.trim(),intensities:f,type:_||void 0,locale:y,gameMode:d,isDefault:!1};if(p)await qe(p.id,C),h==null||h(p);else{const O=await Xe(C);O&&(r==null||r({...C,id:O,createdAt:new Date,updatedAt:new Date,isDefault:!1,locale:y,gameMode:d}))}_e(),x()}catch(f){console.error("Error saving custom group:",f),P({isValid:!1,errors:[t("failedToSaveGroup",{error:f})]})}finally{w(!1)}}},_e=()=>{g(null),$(""),m(""),z(1),L([t("intensityLabels.beginner"),t("intensityLabels.intermediate"),t("intensityLabels.advanced")]),P({isValid:!0,errors:[]})};return e.jsxs(e.Fragment,{children:[e.jsxs(ye,{open:u,onClose:x,maxWidth:"md",fullWidth:!0,PaperProps:{sx:{minHeight:"600px"}},children:[e.jsxs(be,{children:[t("customGroups.manageCustomGroups"),e.jsx(T,{variant:"body2",color:"text.secondary",sx:{mt:1},children:t("customGroups.createNewGroupsDescription")}),e.jsxs(it,{value:c,onChange:(f,C)=>{b(C),C===1&&!p&&_e()},sx:{mt:2,borderBottom:1,borderColor:"divider"},children:[e.jsx(Me,{label:t("customGroups.existingGroups")}),e.jsx(Me,{label:t(p?"customGroups.editGroup":"customGroups.createNew")})]})]}),e.jsxs(je,{dividers:!0,children:[c===0&&e.jsx(I,{children:o?e.jsx(T,{children:t("Loading groups...")}):s.length===0?e.jsx(T,{color:"text.secondary",sx:{textAlign:"center",py:4},children:t("customGroups.noCustomGroupsFound")}):e.jsx(ve,{children:s.map((f,C)=>e.jsxs(ot.Fragment,{children:[e.jsxs(Te,{children:[e.jsx(Ce,{primary:f.label,secondary:e.jsxs(I,{component:"span",sx:{display:"block"},children:[e.jsxs(T,{variant:"body2",color:"text.secondary",component:"span",sx:{display:"block"},children:[t("customGroups.intensityLevelsCount",{count:f.intensities.length}),": ",f.intensities.map(O=>O.label).join(", ")]}),e.jsx(T,{variant:"body2",color:"text.secondary",component:"span",sx:{display:"block",mt:.5},children:t("customGroups.customTilesCount",{count:S[f.id]||0})})]})}),e.jsxs(at,{children:[e.jsx(re,{edge:"end","aria-label":"edit",onClick:()=>U(f),sx:{mr:1},children:e.jsx(Qe,{})}),e.jsx(re,{edge:"end","aria-label":"delete",onClick:()=>oe(f.id),color:"error",children:e.jsx(Se,{})})]})]}),C<s.length-1&&e.jsx(pe,{})]},f.id))})}),c===1&&e.jsxs(I,{sx:{display:"flex",flexDirection:"column",gap:3},children:[!B.isValid&&e.jsx(Be,{severity:"error",children:B.errors.map((f,C)=>e.jsx("div",{children:f},C))}),e.jsxs(I,{sx:{p:2,bgcolor:"background.paper",borderRadius:1,border:"1px solid",borderColor:"divider"},children:[e.jsx(T,{variant:"h6",sx:{mb:2},children:t("customGroups.groupInformation")}),e.jsx(ne,{label:t("customGroups.groupLabel"),value:E,onChange:f=>$(f.target.value),placeholder:"e.g., My Custom Group",helperText:t("customGroups.groupLabelHelp",{maxLength:D.MAX_GROUP_LABEL_LENGTH}),fullWidth:!0,required:!0,error:E.trim().length>0&&!At(E).isValid,sx:{mb:2}}),e.jsxs(ne,{select:!0,label:t("customGroups.groupType"),value:_,onChange:f=>m(f.target.value),helperText:t("customGroups.groupTypeHelp"),fullWidth:!0,required:!0,error:E.trim().length>0&&!_,sx:{mb:2},children:[e.jsx(F,{value:"",children:e.jsx("em",{children:t("groupTypes.selectType")})}),e.jsx(F,{value:"solo",children:t("groupTypes.solo")}),e.jsx(F,{value:"foreplay",children:t("groupTypes.foreplay")}),e.jsx(F,{value:"sex",children:t("groupTypes.sex")}),e.jsx(F,{value:"consumption",children:t("groupTypes.consumption")})]}),e.jsxs(I,{sx:{display:"flex",flexDirection:"column",gap:.5},children:[e.jsxs(T,{variant:"body2",color:"text.secondary",children:[e.jsx("strong",{children:t("customGroups.locale")})," ",y," |"," ",e.jsx("strong",{children:t("customGroups.gameMode")})," ",d]}),p?e.jsxs(T,{variant:"body2",color:"text.secondary",children:[e.jsx("strong",{children:t("customGroups.internalId")})," ",p.name," ","(locked)"]}):e.jsxs(T,{variant:"body2",color:"text.secondary",children:[e.jsx("strong",{children:t("customGroups.internalId")})," ",E?W(E):t("customGroups.autoGenerated")]})]})]}),e.jsxs(I,{sx:{display:"flex",alignItems:"center",gap:2,p:2,bgcolor:"action.hover",borderRadius:1},children:[e.jsx(T,{variant:"body2",sx:{fontWeight:"medium",minWidth:"auto"},children:t("customGroups.quickStart")}),e.jsx(ne,{select:!0,value:M,onChange:f=>Q(Number(f.target.value)),size:"small",sx:{minWidth:200},label:t("customGroups.chooseTemplate"),children:Le.map((f,C)=>e.jsx(F,{value:C,children:f.name==="Basic (1-4)"?t("templateBasic"):f.name==="Simple (1-3)"?t("templateSimple"):f.name==="Extended (1-5)"?t("templateExtended"):f.name},C))}),e.jsx(T,{variant:"body2",color:"text.secondary",sx:{fontSize:"0.75rem"},children:t("customGroups.selectTemplateDescription")})]}),e.jsxs(I,{children:[e.jsxs(T,{variant:"h6",sx:{mb:2},children:[t("customGroups.intensityLabels")," (",k.length,"/",D.MAX_INTENSITIES_COUNT,")"]}),e.jsx(T,{variant:"body2",color:"text.secondary",sx:{mb:2},children:t("customGroups.customizeIntensityDescription")}),e.jsxs(I,{sx:{display:"flex",flexDirection:"column",gap:1.5},children:[k.map((f,C)=>e.jsxs(I,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(T,{variant:"body2",sx:{minWidth:"30px",fontWeight:"bold",color:"primary.main"},children:C+1}),e.jsx(ne,{label:t("customGroups.levelInputLabel",{level:C+1}),value:f,onChange:O=>Z(C,O.target.value),size:"small",sx:{flex:1},inputProps:{maxLength:D.MAX_INTENSITY_LABEL_LENGTH}}),e.jsx(re,{onClick:()=>se(C),disabled:k.length<=D.MIN_INTENSITIES_COUNT,color:"error",size:"small",children:e.jsx(Se,{})})]},C)),e.jsx(te,{startIcon:e.jsx(Nt,{}),onClick:ee,disabled:k.length>=D.MAX_INTENSITIES_COUNT,variant:"outlined",size:"small",sx:{alignSelf:"flex-start",mt:1},children:t("customGroups.addIntensityLevel")})]})]})]})]}),e.jsxs(Fe,{children:[e.jsx(te,{onClick:x,disabled:v,children:t("cancel")}),e.jsx(te,{onClick:tt,variant:"contained",disabled:!B.isValid||v,children:t(v?"customGroups.saving":p?"customGroups.updateGroup":"customGroups.createGroup")})]})]}),e.jsxs(ye,{open:V,onClose:()=>Y(!1),children:[e.jsx(be,{children:t("customGroups.confirmDelete")}),e.jsx(je,{children:e.jsx(T,{children:((i=R==null?void 0:R.tileCount)!=null?i:0)>0?t("customGroups.deleteGroupWithTiles",{name:R==null?void 0:R.name,count:R==null?void 0:R.tileCount}):t("customGroups.deleteGroupConfirm",{name:R==null?void 0:R.name})})}),e.jsxs(Fe,{children:[e.jsx(te,{onClick:()=>Y(!1),children:t("cancel")}),e.jsx(te,{onClick:me,color:"error",variant:"contained",children:t("delete")})]})]})]})}function Qt({setSubmitMessage:u,boardUpdated:x,customTiles:r,mappedGroups:h,expanded:l,handleChange:y,tagList:d,updateTileId:i,setUpdateTileId:t}){const{t:c}=ie(),{settings:b}=Ne(),[s,n]=a.useState({gameMode:b.gameMode||"online",group:"",intensity:"",action:"",tags:[c("custom")]}),[o,G]=a.useState(!1),[S,K]=a.useState(""),[D,E]=a.useState(0);a.useEffect(()=>{const v=setTimeout(async()=>{if(!s.group||!s.intensity||!s.action){K("");return}try{const w=await Re({group:s.group,intensity:Number(s.intensity),action:s.action,tags:s.tags,gameMode:s.gameMode,isCustom:1},b.locale||"en",s.gameMode);w.isValid?K(""):K(w.errors.join(", "))}catch(w){console.error("Error validating tile:",w),K("")}},300);return()=>clearTimeout(v)},[s.group,s.intensity,s.action,s.gameMode,s.tags,b.locale]),a.useEffect(()=>{const v=(Array.isArray(r)?r:[]).find(({id:w})=>w===i);if(v){const w=v.gameMode||b.gameMode;n({gameMode:w,group:v.group||"",intensity:v.intensity||"",action:v.action||"",tags:v.tags||[c("custom")]})}else n(w=>({...w,gameMode:b.gameMode}))},[i,b.gameMode,r,c]);function $(g,v,w){return(Array.isArray(r)?r:[]).find(P=>P.group===g&&P.intensity===v&&P.action===w)}function _(){t(null),n({gameMode:b.gameMode,group:"",intensity:"",action:"",tags:[c("custom")]}),K("")}const m=g=>{n(v=>({...v,group:g.name,intensity:""})),G(!1),E(v=>v+1)},M=()=>{E(g=>g+1)},z=a.useCallback(g=>{n(v=>({...v,intensity:g.toString()}))},[]);async function k(){const g=document.querySelector('input[name="tags"]'),v=[...s.tags];g&&g.value.trim()&&(v.push(g.value.trim()),g.value="");const{gameMode:w,group:B,intensity:P,action:V}=s;if(!w||!B||!P||!V)return u({message:c("allFieldsRequired","All fields are required"),type:"error"});if(S)return u({message:S,type:"error"});if(i==null&&$(B,P,V))return u({message:c("actionExists"),type:"error"});const Y={group:B,intensity:Number(P),action:V,tags:v,gameMode:w,isCustom:1};try{const R=await Re(Y,b.locale||"en",w);if(!R.isValid)return u({message:R.errors.join(", "),type:"error"});if(i===null){const j=`${B} - Level ${P}`;Je(j,V),await Ae(Y)}else await Ue(i,Y);return x(),n(j=>({...j,action:"",tags:[c("custom")]})),u({message:c(i?"customUpdated":"customAdded"),type:"success"})}catch(R){return console.error("Error saving custom tile:",R),u({message:c("errorSavingTile"),type:"error"})}}const L=g=>{switch(g.key){case",":case"Enter":{g.preventDefault(),g.stopPropagation(),g.currentTarget.value.length>0&&(n(v=>({...v,tags:[...v.tags,g.currentTarget.value]})),g.currentTarget.value="");break}}},p=g=>{g.target.value.length>0&&(n(v=>({...v,tags:[...v.tags,g.target.value]})),g.target.value=""),setTimeout(()=>{const v=document.querySelector(".MuiAutocomplete-popper");v&&(v.style.display="none")},150)};return e.jsxs(e.Fragment,{children:[e.jsxs(ae,{expanded:l==="ctAdd",onChange:y("ctAdd"),className:"about-accordion",children:[e.jsx(le,{"aria-controls":"ctAdd-content",id:"ctAdd-header",children:e.jsx(T,{className:"accordion-title",children:e.jsx(N,{i18nKey:i?"ctUpdate":"ctAdd"})})}),e.jsx(ce,{children:e.jsxs(I,{component:"form",method:"post",className:"settings-box",children:[e.jsxs(ne,{select:!0,label:c("customTiles.gameMode"),value:s.gameMode,onChange:g=>{n(v=>({...v,gameMode:g.target.value,group:"",intensity:""}))},fullWidth:!0,sx:{mb:2},children:[e.jsx("option",{value:"online",children:c("online")}),e.jsx("option",{value:"local",children:c("local")}),e.jsx("option",{value:"solo",children:c("solo")})]}),e.jsx(Ht,{value:s.group,onChange:g=>{n(v=>({...v,group:g,intensity:""}))},locale:b.locale||"en",gameMode:s.gameMode,refreshTrigger:D}),e.jsx(I,{sx:{mt:2},children:e.jsx(Jt,{groupName:s.group,value:Number(s.intensity)||0,onChange:z,locale:b.locale||"en",gameMode:s.gameMode})}),S&&e.jsx(I,{sx:{mt:1,mb:2},children:e.jsx(T,{color:"error",variant:"body2",children:S})}),e.jsx(ne,{id:"action",name:"action",required:!0,fullWidth:!0,label:c("action"),sx:{mt:2,pb:2},value:s.action,onChange:g=>{n({...s,action:g.target.value})}}),e.jsx(lt,{id:"tags",disableCloseOnSelect:!0,multiple:!0,freeSolo:!0,options:d,value:s.tags,onChange:(g,v)=>{n({...s,tags:v})},renderInput:g=>(g.inputProps.onKeyDown=L,g.inputProps.onBlur=p,e.jsx(ne,{...g,label:c("tags")})),sx:{pb:2},clearOnBlur:!0,blurOnSelect:!0,openOnFocus:!0,disablePortal:!1,componentsProps:{popper:{modifiers:[{name:"preventOverflow",options:{altAxis:!0,altBoundary:!0,padding:8}}]}}}),e.jsxs(I,{display:"flex",flexDirection:{xs:"column",sm:"row"},justifyContent:{xs:"stretch",sm:"space-evenly"},gap:1,children:[e.jsx(te,{variant:"outlined",type:"button",onClick:()=>G(!0),children:c("manageGroups")}),e.jsx(te,{variant:"contained",type:"button",onClick:()=>_(),children:e.jsx(N,{i18nKey:"clear"})}),e.jsx(te,{variant:"contained",type:"button",onClick:k,children:e.jsx(N,{i18nKey:i?"ctUpdate":"ctAdd"})})]})]})})]}),e.jsx(Yt,{open:o,onClose:()=>G(!1),onGroupCreated:m,onGroupUpdated:M,locale:b.locale||"en",gameMode:s.gameMode})]})}function Zt({expanded:u,handleChange:x}){const r=Ge(),[h,l]=a.useState({}),[y,d]=a.useState({}),i=s=>{l(n=>({...n,[s]:!n[s]}))},t=s=>{d(n=>({...n,[s]:!n[s]}))},c=[{id:"custom-actions",icon:e.jsx(We,{}),title:"Custom Actions",description:"Add your own personalized activities to the game",tip:"Think of custom tiles as your personal touch - add activities that match your style and preferences perfectly.",color:"primary"},{id:"category-intensity",icon:e.jsx(_t,{}),title:"Category & Intensity Rules",description:"Tiles appear based on your game settings",tip:"Your tiles only show up when you select their category and intensity level (or higher) in game settings.",color:"secondary"}],b=[{id:"new-activities",icon:e.jsx(Mt,{}),title:"New Activities",description:"Create unique actions not in the default list",tips:["Think outside the box - what creative activities would make your game more exciting?",'Add themed tiles like "Movie Night Actions" or "Kitchen Adventures"',"Create seasonal tiles for holidays or special occasions","Design role-play scenarios with specific character actions"],color:"primary"},{id:"intensity-boost",icon:e.jsx(Ft,{}),title:"Early Intensity Boost",description:"Add advanced tiles to beginner levels",tips:["Pro tip: Add exciting advanced tiles to lower intensities to start games with more energy.","Copy your favorite advanced tiles and add them to beginner categories",'Create "gateway" tiles that introduce advanced concepts gradually',"Mix easy and challenging elements in the same tile for variety"],color:"secondary"},{id:"mix-match",icon:e.jsx($t,{}),title:"Mix & Match",description:"Combine different activities into one tile",tips:["Mix activities that don't usually go together for unexpected combinations.","Combine physical actions with mental challenges or games","Create multi-step tiles that build on each other","Blend different intensity levels within a single creative tile"],color:"success"},{id:"custom-groups",icon:e.jsx(Ot,{}),title:"Custom Groups",description:"Create your own tile categories with unique intensities",tips:['Design completely custom groups like "Couples Yoga" or "Adventure Challenges"',"Set your own intensity progression from gentle to wild","Create themed collections that tell a story or follow a theme","Build niche categories that perfectly match your interests"],color:"warning"},{id:"share-creations",icon:e.jsx(Pt,{}),title:"Share & Discover",description:"Import/export tiles to share with others",tips:["Export your best tile collections to share with friends or partners","Import creative tiles from others to expand your game options","Create themed tile packs and share them in communities","Backup your custom tiles by exporting them regularly"],color:"info"}];return e.jsxs(e.Fragment,{children:[e.jsxs(ae,{expanded:u==="help1",onChange:x("help1"),className:"about-accordion",children:[e.jsx(le,{"aria-controls":"help1-content",id:"help1-header",children:e.jsxs(I,{sx:{display:"flex",alignItems:"center",gap:1,width:"100%"},children:[e.jsx(We,{color:"primary"}),e.jsx(T,{className:"accordion-title",children:e.jsx(N,{i18nKey:"ctExplained"})})]})}),e.jsx(ce,{sx:{p:0},children:e.jsx(ve,{dense:!0,children:c.map((s,n)=>e.jsxs(I,{children:[e.jsxs(Te,{sx:{cursor:"pointer",borderRadius:1,"&:hover":{bgcolor:"action.hover",transform:"translateX(4px)",transition:"all 0.2s ease-in-out"},transition:"all 0.2s ease-in-out"},onClick:()=>t(s.id),children:[e.jsx($e,{sx:{minWidth:r?36:40},children:e.jsx(I,{sx:{color:`${s.color}.main`,display:"flex",alignItems:"center"},children:s.icon})}),e.jsx(Ce,{primary:e.jsx(T,{variant:"subtitle2",sx:{fontWeight:500,fontSize:r?"0.9rem":"1rem"},children:s.title}),secondary:e.jsx(T,{variant:"body2",sx:{fontSize:r?"0.8rem":"0.85rem",color:"text.secondary"},children:s.description})}),e.jsx(re,{size:"small",sx:{ml:1},children:y[s.id]?e.jsx(Ke,{}):e.jsx(ze,{})})]}),e.jsx(Oe,{in:y[s.id],timeout:"auto",unmountOnExit:!0,children:e.jsx(I,{sx:{ml:r?4:6,mr:2,mb:1,p:1.5,bgcolor:"action.selected",borderRadius:1,borderLeft:3,borderLeftColor:`${s.color}.main`},children:e.jsxs(T,{variant:"body2",sx:{fontSize:r?"0.8rem":"0.85rem",fontStyle:"italic",color:"text.secondary"},children:["💡 ",s.tip]})})}),n<c.length-1&&e.jsx(pe,{variant:"inset",sx:{ml:r?4:6}})]},s.id))})})]}),e.jsxs(ae,{expanded:u==="help2",onChange:x("help2"),className:"about-accordion",children:[e.jsx(le,{"aria-controls":"help2-content",id:"help2-header",children:e.jsxs(I,{sx:{display:"flex",alignItems:"center",gap:1,width:"100%"},children:[e.jsx(kt,{color:"primary"}),e.jsx(T,{className:"accordion-title",children:e.jsx(N,{i18nKey:"ctIdeas"})})]})}),e.jsx(ce,{sx:{p:0},children:e.jsx(ve,{dense:!0,children:b.map((s,n)=>e.jsxs(I,{children:[e.jsxs(Te,{sx:{cursor:"pointer",borderRadius:1,"&:hover":{bgcolor:"action.hover",transform:"translateX(4px)",transition:"all 0.2s ease-in-out"},transition:"all 0.2s ease-in-out"},onClick:()=>i(s.id),children:[e.jsx($e,{sx:{minWidth:r?36:40},children:e.jsx(I,{sx:{color:`${s.color}.main`,display:"flex",alignItems:"center"},children:s.icon})}),e.jsx(Ce,{primary:e.jsx(T,{variant:"subtitle2",sx:{fontWeight:500,fontSize:r?"0.9rem":"1rem"},children:s.title}),secondary:e.jsx(T,{variant:"body2",sx:{fontSize:r?"0.8rem":"0.85rem",color:"text.secondary"},children:s.description})}),e.jsx(re,{size:"small",sx:{ml:1},children:h[s.id]?e.jsx(Ke,{}):e.jsx(ze,{})})]}),e.jsx(Oe,{in:h[s.id],timeout:"auto",unmountOnExit:!0,children:e.jsx(I,{sx:{ml:r?4:6,mr:2,mb:1,p:1.5,bgcolor:"action.selected",borderRadius:1,borderLeft:3,borderLeftColor:`${s.color}.main`},children:s.tips.map((o,G)=>e.jsx(T,{variant:"body2",sx:{fontSize:r?"0.8rem":"0.85rem",fontStyle:G===0?"italic":"normal",color:"text.secondary",mb:G<s.tips.length-1?1:0,"&:before":G===0?{content:'"💡 "'}:{content:'"• "'}},children:o},G))})}),n<b.length-1&&e.jsx(pe,{variant:"inset",sx:{ml:r?4:6}})]},s.id))})})]})]})}function es({gameMode:u,groupFilter:x,intensityFilter:r,groups:h,mappedGroups:l,dexieGroups:y,onGameModeChange:d,onGroupChange:i,onIntensityChange:t,hideAll:c=!1,sx:b={}}){const{t:s}=ie(),[n,o]=a.useState([]),G=c?1:"all",S=a.useMemo(()=>{if(!(l!=null&&l[u]))return[];const m=Ze(l[u]);return Array.isArray(m)?m:[]},[l,u]),K=a.useCallback(m=>{if(y!=null&&y[m])return y[m].label||m;const M=S.find(z=>z.value===m);return M!=null&&M.groupLabel?M.groupLabel:m},[y,S]),D=a.useCallback((m,M)=>{if(y!=null&&y[m]){const k=y[m].intensities.find(L=>L.value===Number(M));if(k!=null&&k.label)return k.label}const z=S.find(k=>k.value===m&&k.intensity===Number(M));return z!=null&&z.translatedIntensity?z.translatedIntensity:`Level ${Number(M)+1}`},[y,S]);a.useEffect(()=>{if(h){const m=Object.keys(h);o(m)}},[h,u]);function E(m){const M=m.target.value;i(M),t(G)}if(!(n!=null&&n.length))return null;const $=n.length===0||n.includes(x)?x:"",_=r==="all"?"all":r;return e.jsxs(I,{sx:{display:"flex",flexWrap:"wrap",gap:2,...b},children:[e.jsxs(X,{sx:{width:125,flexShrink:0},children:[e.jsx(H,{id:"game-mode-filter-label",children:e.jsx(N,{i18nKey:"customTiles.gameMode"})}),e.jsxs(J,{labelId:"game-mode-filter-label",id:"game-mode-filter",value:u,label:s("customTiles.gameMode","Game Mode"),onChange:m=>{d(m.target.value)},slotProps:{input:{"aria-label":s("customTiles.gameMode","Game Mode")}},children:[e.jsx(F,{value:"online",children:e.jsx(N,{i18nKey:"online"})}),e.jsx(F,{value:"local",children:e.jsx(N,{i18nKey:"local"})})]})]}),e.jsxs(X,{sx:{minWidth:150,flex:1},children:[e.jsx(H,{id:"group-filter-label",children:e.jsx(N,{i18nKey:"group"})}),e.jsx(J,{labelId:"group-filter-label",id:"group-filter",value:$,label:s("group"),onChange:E,slotProps:{input:{"aria-label":s("group")}},children:n.map(m=>e.jsxs(F,{value:m,children:[K(m),!c&&h[m]&&` (${h[m].count})`]},m))})]}),e.jsxs(X,{sx:{minWidth:200,flex:1},disabled:!$,children:[e.jsx(H,{id:"intensity-filter-label",children:e.jsx(N,{i18nKey:"customTiles.intensityLevel",children:"Intensity Level"})}),e.jsxs(J,{labelId:"intensity-filter-label",id:"intensity-filter",value:_,label:s("customTiles.intensityLevel","Intensity Level"),onChange:m=>t(m.target.value),slotProps:{input:{"aria-label":s("customTiles.intensityLevel","Intensity Level")}},children:[!c&&e.jsx(F,{value:"all",children:e.jsx(N,{i18nKey:"all",children:"All"})},"all"),$&&h&&h[$]&&Object.entries(h[$].intensities||{}).sort(([m],[M])=>Number(m)-Number(M)).map(([m,M])=>e.jsxs(F,{value:Number(m),children:[D($,m),!c&&M!==void 0?` (${M})`:""]},m))]})]})]})}function ts({tagList:u,boardUpdated:x,mappedGroups:r,updateTile:h,refreshTrigger:l}){var y;const{t:d,i18n:i}=ie(),{settings:t}=Ne(),[c,b]=a.useState(null),[s,n]=a.useState(t.gameMode||"online"),[o,G]=a.useState(""),[S,K]=a.useState(""),[D,E]=a.useState(1),[$,_]=a.useState(!0),[m,M]=a.useState({items:[],total:0,totalPages:1}),[z,k]=a.useState({}),[L,p]=a.useState({}),g=10;a.useEffect(()=>{async function j(){try{_(!0);const[A,W]=await Promise.all([ke(i.resolvedLanguage,s),bt(i.resolvedLanguage,s,c)]),Q={};A.forEach(U=>{Q[U.name]=U}),p(Q);const Z={};A.forEach(U=>{const oe=W[U.name]||{count:0,intensities:{}};Z[U.name]={label:U.label||U.name,count:oe.count,intensities:oe.intensities}}),k(Z);const ee=A.map(U=>U.name),se=ee.includes(o);if((!o||!se)&&ee.length>0)G(ee[0]),K("all");else if(se&&S!=="all"){const U=A.find(oe=>oe.name===o);U&&(U.intensities.map(me=>me.value).includes(Number(S))||K("all"))}}catch(A){console.error("Error loading groups and counts:",A)}finally{_(!1)}}j()},[s,i.resolvedLanguage,c,o,S]),a.useEffect(()=>{let j=!0;async function A(){try{_(!0);const W={group:o,intensity:S==="all"?null:Number(S),tag:c,gameMode:s,locale:t.locale,page:D,limit:g,paginated:!0},Q=await Pe(W);j&&(M(Q),setTimeout(()=>{j&&_(!1)},300))}catch(W){console.error("Error loading tiles:",W),j&&_(!1)}}return o?A():_(!1),()=>{j=!1}},[o,S,c,s,D,g,l,t.locale]);function v(j){_(!0),b(c===j?null:j)}function w(j,A){_(!0),E(A)}async function B(j){await jt(j),x();const A={group:o,intensity:S==="all"?null:S,tag:c,gameMode:s,locale:t.locale,page:D,limit:g,paginated:!0},W=await Pe(A);M(W)}async function P(j){await vt(j),x(),M(A=>({...A,items:A.items.map(W=>W.id===j?{...W,isEnabled:!W.isEnabled}:W)}))}function V(j){h(j);const A=document.querySelector(".MuiDialogContent-root");A&&(A.scrollTop=0)}function Y(j,A){const W=L[j];if(W){const Q=W.label||j,Z=W.intensities.find(se=>se.value===Number(A)),ee=(Z==null?void 0:Z.label)||`Level ${Number(A)+1}`;return`${Q} - ${ee}`}return`${j} - Level ${Number(A)+1}`}const R=(y=m.items)==null?void 0:y.map(({id:j,group:A,intensity:W,action:Q,tags:Z,isEnabled:ee=!0,isCustom:se=!0})=>e.jsxs(ct,{sx:{my:2},children:[e.jsx(ut,{title:Q,slotProps:{title:{variant:"body1"},subheader:{variant:"body2"},action:{"aria-label":d("customTiles.actions")}},subheader:Y(A,W),action:e.jsxs(e.Fragment,{children:[e.jsx(dt,{checked:!!ee,onChange:()=>j!==void 0&&P(j),slotProps:{input:{"aria-label":d("customTiles.toggleTile")}}}),!!se&&e.jsxs(e.Fragment,{children:[e.jsx(re,{onClick:()=>j!==void 0&&V(j),"aria-label":d("customTiles.update"),children:e.jsx(Qe,{})}),e.jsx(re,{onClick:()=>j!==void 0&&B(j),"aria-label":d("customTiles.delete"),children:e.jsx(Se,{})})]})]}),sx:{pb:0}}),e.jsx(pt,{children:Z==null?void 0:Z.map(U=>e.jsx(fe,{label:U==="default"?d("default"):U,sx:{m:.5}},U))})]},j));return e.jsxs(I,{children:[e.jsx(I,{children:u==null?void 0:u.map(j=>e.jsx(fe,{label:j,sx:{m:.5},color:c===j?"primary":"default",onClick:()=>v(j)},j))}),e.jsx(I,{sx:{display:"flex",flexDirection:"column",gap:2,my:2,transition:"all 0.3s ease-in-out"},children:e.jsx(es,{gameMode:s,groupFilter:o,intensityFilter:S,groups:z,mappedGroups:r,dexieGroups:L,onGameModeChange:j=>{n(j),G(""),K(""),E(1)},onGroupChange:j=>{G(j),E(1)},onIntensityChange:j=>{K(j),E(1)}})}),e.jsxs(I,{sx:{position:"relative",minHeight:"200px"},children:[e.jsx(mt,{in:$,timeout:300,children:e.jsx(I,{sx:{position:"absolute",top:0,left:0,right:0,bottom:0,display:"flex",justifyContent:"center",alignItems:"center",backgroundColor:"rgba(255, 255, 255, 0)",zIndex:1,borderRadius:1},children:e.jsx(De,{})})}),e.jsx(I,{sx:{opacity:$?.3:1,transition:"opacity 0.3s ease-in-out",pointerEvents:$?"none":"auto"},children:m.items.length===0?e.jsx(T,{variant:"body1",sx:{textAlign:"center",my:4},children:e.jsx(N,{i18nKey:"customTiles.noTilesFound",children:"No tiles found with the selected filters."})}):e.jsxs(e.Fragment,{children:[R,m.totalPages>1&&e.jsx(I,{sx:{display:"flex",justifyContent:"center",mt:3,mb:2},children:e.jsx(gt,{count:m.totalPages,page:D,onChange:w,color:"primary"})}),e.jsx(T,{variant:"body2",sx:{textAlign:"center",mt:2,color:"text.secondary"},children:e.jsxs(N,{i18nKey:"customTiles.showingTiles",values:{shown:m.items.length,total:m.total},children:["Showing ",{shown:m.items.length}," of ",{total:m.total}," tiles"]})})]})})]})]})}function ms({boardUpdated:u,setOpen:x,open:r=!1}){const{t:h,i18n:l}=ie(),y=Ge(),d=Ge("md"),[i,t]=a.useState({message:"",type:"info"}),[c,b]=a.useState("ctAdd"),[s,n]=a.useState(null),[o,G]=a.useState(0),[S,K]=a.useState({online:{},local:{},solo:{}}),[D,E]=a.useState(!0),$=a.useCallback(()=>{G(L=>L+1)},[]),_=L=>(p,g)=>{b(g?L:"")};a.useEffect(()=>{async function L(){E(!0);try{const[p,g,v]=await Promise.all([he(l.resolvedLanguage,"online"),he(l.resolvedLanguage,"local"),he(l.resolvedLanguage,"solo")]);K({online:p,local:g,solo:v})}catch(p){console.error("Error loading game mode actions:",p)}finally{E(!1)}}L()},[l.resolvedLanguage]);const m=xt(()=>ue({locale:l.resolvedLanguage})),M=a.useMemo(()=>m?Array.isArray(m)?m.map(({tags:L})=>L).flat().filter((L,p,g)=>L&&g.indexOf(L)===p).sort():[]:[],[m]),z=a.useCallback(async L=>{await Tt(L),u(),$()},[u,$]);if(!m||D)return null;const k=()=>{const L=e.jsxs(e.Fragment,{children:[e.jsx(Zt,{expanded:c,handleChange:_}),e.jsx(Qt,{setSubmitMessage:t,boardUpdated:()=>{u(),$()},customTiles:m,mappedGroups:S,expanded:c,handleChange:_,tagList:M,updateTileId:s,setUpdateTileId:n}),e.jsx(Xt,{expanded:c,handleChange:_,customTiles:m,mappedGroups:S,setSubmitMessage:t,bulkImport:z})]}),p=Array.isArray(m)&&m.length>0&&e.jsx(I,{children:e.jsx(ts,{tagList:M,boardUpdated:()=>{u(),$()},mappedGroups:S,updateTile:g=>{n(g),b("ctAdd")},refreshTrigger:o})});return d?e.jsxs(e.Fragment,{children:[L,p&&e.jsxs(e.Fragment,{children:[e.jsx(pe,{sx:{my:2}}),p]})]}):e.jsxs(ge,{container:!0,spacing:2,children:[e.jsx(ge,{size:{xs:12,md:6},children:L}),e.jsx(ge,{size:{xs:12,md:6},children:p})]})};return e.jsxs(e.Fragment,{children:[e.jsxs(ye,{fullScreen:y,open:r,onClose:()=>x(!1),maxWidth:d?"sm":"lg",fullWidth:!0,children:[e.jsxs(be,{children:[e.jsx(N,{i18nKey:"manageTiles"}),e.jsx(re,{"aria-label":h("close"),onClick:()=>x(!1),sx:{position:"absolute",right:8,top:8,color:L=>L.palette.grey[500]},children:e.jsx(Rt,{})})]}),e.jsx(je,{children:k()})]}),e.jsx(Ct,{open:!!i.message,close:()=>t({message:"",type:"info"}),type:i.type,children:i.message})]})}function gs(u={},x={}){const[r]=St(),h={...u,...r,selectedActions:(r==null?void 0:r.selectedActions)||{},finishRange:(r==null?void 0:r.finishRange)||[30,70],...x},[l,y]=a.useState(h),{messages:d}=Lt(),[i,t]=a.useState(!1);return a.useEffect(()=>{const c=Wt(d,"room");if(c!=null&&c.settings)try{const b=JSON.parse(c.settings);y(s=>i?s.selectedActions&&Object.keys(s.selectedActions).length>0?{...s,...b,selectedActions:s.selectedActions}:{...s,...b}:(t(!0),{...s,...b}))}catch(b){console.error("Error parsing message settings:",b)}else i||t(!0)},[d,i]),[l,y]}export{ms as C,Ze as g,gs as u};
//# sourceMappingURL=chunk-CJ-p-rHL.js.map
