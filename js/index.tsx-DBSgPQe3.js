import{r as n,ad as P,au as T,j as e,am as g,ao as j,T as d,Q as U,ar as q,a1 as z}from"./chunk-D6lSgkQl.js";import{p as O,u as K,R as L}from"./chunk-CjhpqWsN.js";import{T as D}from"./chunk-f7_oMwUp.js";import{g as G}from"./chunk-B37hsyTU.js";import{l as R}from"./chunk-Bh2joNiQ.js";import{l as J}from"./chunk-CI62jVUQ.js";import{b as Q}from"./chunk-CIkUqbcq.js";import"./chunk-CygiBK7d.js";import"./chunk-wjnghUwR.js";import"./chunk-EL58PX5i.js";import"./chunk-CrKijlJ5.js";import"./chunk-DCWjhdE4.js";import"./chunk-CM1AJoxz.js";import"../assets/index-Be5uBEzU.js";import"./chunk-D4N6bcQy.js";function Y(){const[a,m]=n.useState(document.fullscreenElement!=null);n.useEffect(()=>{const t=()=>{m(document.fullscreenElement!=null)};return document.addEventListener("fullscreenchange",t),()=>{document.removeEventListener("fullscreenchange",t)}},[]);const i=n.useCallback(()=>{document.fullscreenElement==null?document.documentElement.requestFullscreen().catch(t=>{console.error("Error attempting to enable fullscreen:",t)}):document.exitFullscreen().catch(t=>{console.error("Error attempting to exit fullscreen:",t)})},[]);return{isFullscreen:a,toggleFullscreen:i}}function _(a){const m=R(a,"room");let i=!1,t="";if(m){const{roomBackground:s,roomBackgroundURL:f}=JSON.parse(m.settings||"{}");let p=null;s==="custom"&&f?p=f:s&&s!=="useAppBackground"?p=s:f&&(p=f);const r=O(p);r?.isVideo&&(i=r.isVideo),r?.url&&(t=r.url)}return["color","gray"].some(s=>t.includes(s))&&(t=""),{isVideo:i,url:t}}const H="actions",W=a=>{const{text:m,displayName:i}=a;if(!i)return{};const t=m?.split(`
`),[s,f]=t?.slice(1)||[],p=s?.split(":")[1]?.trim(),r=f?.split(":")[1]?.trim();return{displayName:i,type:p,activity:r}};function fe(){const{id:a}=P(),[m,i]=n.useState(""),[t,s]=n.useState(!1),[f,p]=n.useState(!1),[r,I]=n.useState(!1),{messages:h,isLoading:C}=Q(),{isVideo:y,url:c}=_(h),E=R(h,H),A=K(E),{isFullscreen:F,toggleFullscreen:$}=Y();n.useEffect(()=>{G().currentUser||J("Cast Viewer").catch(u=>{console.error("Anonymous login failed:",u)})},[a]),n.useEffect(()=>{if(!y||!c)return;const l=()=>{const N=document.querySelectorAll("video"),b=document.querySelectorAll("iframe");N.forEach(o=>{o.paused&&(o.muted=!0,o.play().catch(x=>{console.log("Video autoplay attempt failed:",x),I(!0)}))}),b.forEach(o=>{if(o.src)try{const x=new URL(o.src,window.location.origin),v=x.searchParams;let S=!1;v.get("autoplay")!=="1"&&(v.set("autoplay","1"),S=!0),v.get("mute")!=="1"&&(v.set("mute","1"),S=!0),S&&(x.search=v.toString(),o.src=x.toString())}catch{if(!o.src.includes("autoplay=1")){const x=o.src.includes("?")?"&":"?";o.src+=`${x}autoplay=1&mute=1`}}})},u=setTimeout(l,500),w=setTimeout(l,2e3);return()=>{clearTimeout(u),clearTimeout(w)}},[y,c,h.length]),n.useEffect(()=>{const l=window.cast?.framework?.CastReceiverContext,u=navigator.userAgent,w=u.includes("CrKey")||u.includes("TV"),N=window.self!==window.top,b=l||w||window.location.search.includes("chromecast")||window.location.search.includes("receiver");return b&&(document.body.classList.add("cast-receiver-mode"),document.body.classList.remove("theme-light"),p(!0)),N&&document.body.classList.add("in-iframe"),()=>{b&&document.body.classList.remove("cast-receiver-mode"),N&&document.body.classList.remove("in-iframe")}},[]),n.useEffect(()=>{if(C)return;const l=h[h.length-1];l?.type==="settings"&&(s(!0),i(`${l.displayName} ${T("changedSettings")}`))},[h,C]);const B=()=>{document.querySelectorAll("video").forEach(u=>{u.paused&&u.play().catch(console.error)}),I(!1)};if(!E)return e.jsxs(g,{className:"flex-column cast-main-container",style:{backgroundImage:!y&&c?`url(${c})`:"none"},children:[!!c&&e.jsx(L,{url:c,isVideo:y}),r&&e.jsx(g,{onClick:B,className:"user-interaction-overlay",children:"Click to enable autoplay"}),e.jsx(j,{container:!0,spacing:0,direction:"column",alignItems:"center",justifyContent:"center",className:"cast-container cast-grid-container",children:e.jsx(j,{container:!0,justifyContent:"center",children:e.jsxs("div",{className:"action-box-large responsive-cast-box",children:[e.jsxs(d,{variant:"h2",className:"cast-title",children:["blitzedout.com/",a]}),C?e.jsx(d,{variant:"h4",className:"cast-loading-text",children:"Connecting to game..."}):e.jsx(d,{variant:"h4",className:"cast-ready-text",children:"Ready for game to start"})]})})})]});const{displayName:V,type:M,activity:k}=W(E);return e.jsxs(g,{className:"flex-column cast-main-container",onClick:r?B:void 0,style:{backgroundImage:!y&&c?`url(${c})`:"none",cursor:r?"pointer":"default"},children:[!!c&&e.jsx(L,{url:c,isVideo:y}),e.jsxs(g,{display:"flex",justifyContent:"space-between",className:"cast-header-bar",children:[e.jsx(g,{flex:"1",children:!f&&!F&&e.jsx(U,{variant:"text",onClick:$,className:"cast-fullscreen-button",children:T("fullscreen")})}),e.jsx(g,{textAlign:"center",flex:"1",children:!!A?.displayName&&e.jsx(d,{variant:"h4",className:"cast-next-player",children:e.jsx(q,{i18nKey:"nextPlayersTurn",values:{player:A.displayName}})})},A?.displayName),e.jsx(g,{flex:"1",textAlign:"right",className:"text-stroke",children:k&&e.jsxs(d,{variant:"h4",className:"cast-room-url",children:["blitzedout.com/",a]})})]}),e.jsx(j,{container:!0,spacing:0,direction:"column",alignItems:"center",justifyContent:"center",className:"cast-container cast-grid-container-adjusted",children:e.jsx(j,{container:!0,justifyContent:"center",children:k?e.jsxs(j,{size:12,className:"action-box-responsive responsive-cast-box",children:[e.jsx(d,{variant:"h3",className:"cast-type-text",children:`${M} ${T("for")} ${V}`}),e.jsx(g,{className:"cast-divider",children:e.jsx(z,{})}),e.jsx(d,{variant:"h1",className:"cast-activity-text",children:k})]}):e.jsx("div",{className:"action-box-responsive responsive-cast-box",children:e.jsxs(d,{variant:"h1",className:"cast-room-main",children:["blitzedout.com/",a]})})})},h.length),e.jsx(D,{open:!!t,close:()=>s(!1),hideCloseButton:!0,children:e.jsx(d,{variant:"h5",className:"cast-alert-text",children:m})})]})}export{fe as default};
