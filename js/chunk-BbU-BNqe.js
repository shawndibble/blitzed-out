import{j as e,B as C,l as $,I,S as K,h as se,M as S,T as y,J as P,K as ye,av as ve,k as le,v as Se,w as F,D as U,G as k,am as M,ae as Ce,af as we,aw as Te,ah as ke,ax as Ae,ay as Be,az as Le,aA as ie,ab as $e,U as Ue,V as H,i as ce}from"./chunk-Vuzv59E5.js";import{T as Me}from"./chunk-DeLUqf3X.js";import{i as A,a as G,b as Y}from"./chunk-Bp62TkGl.js";import{u as ge}from"./chunk-Dvs4MHig.js";import{u as _,l as Re}from"./chunk-Cc6zmSQo.js";import{r as b,u as oe,k as Oe}from"./chunk-CfN-ANIX.js";import{g as Ie,u as Ke,a as Pe,C as Ee}from"./chunk-DUQ3SkQ2.js";import{u as w,T as j}from"./chunk-lCeNjzcy.js";import{B as Ve,C as Ge,i as z,u as pe,d as me,t as re,D as Ne,s as xe,E as We,g as ze}from"../assets/index-BIf5SR2l.js";import{b as Fe}from"./chunk-CuMUTfgR.js";import{u as ne}from"./chunk-DNaj1Uyg.js";import{a as _e,i as qe}from"./chunk-B4PEA_xj.js";import{u as Je}from"./chunk-BDQkcwfz.js";function de(n){n.length>1&&n.push(n.shift())}function Jn(n,t){return n?.length!==t?.length?!1:n.every((i,s)=>i===t[s])}const{t:V}=z;function He(n,t){return n.filter(i=>{const s=i.action;return t==="vers"?s.includes("{sub}")&&s.includes("{dom}")||s.includes("{player}"):!s.match(/{(dom|sub)}/)||s.includes(`{${t}}`)})}function Ye(n,t,i,s){if([void 0,"normal"].includes(s)){const r=n/t;return Math.floor(i/r)+1}return t>=3&&Math.random()>=.6?t-1:t}function Q(n,t,i){return n.filter(s=>s.group===t&&s.intensity===i&&s.isEnabled)}function je(n,t,i,s,r,o){if(!n.length)return{title:"",description:""};de(n);const a=n[0],l=i[a.name];if(!l||l.level<=0)return{title:"",description:""};if(l.variation){const x=l.variation==="appendSome"?.4:l.variation==="appendMost"?.9:1;if(l.variation!=="standalone"&&Math.random()>x)return{title:"",description:""}}const d=Math.max(...a.intensities.map(x=>x.value)),c=Ye(r,d,s,o.difficulty),u=Math.min(c,l.level),p=[...new Set(t.filter(x=>x.group===a.name&&x.isEnabled).map(x=>x.intensity))].sort((x,f)=>x-f)[0]||1;let h=Q(t,a.name,u);if(!h.length){for(let x=u-1;x>=1;x--){const f=Q(t,a.name,x);if(f.length>0){h=f;break}}if(!h.length&&p>u){const x=Q(t,a.name,p);x.length>0&&(h=x)}if(!h.length)return{title:"",description:""}}return de(h),{title:a.label,description:h[0].action,standalone:l.variation==="standalone",role:o.role||"sub"}}function Qe(n,t,i,s,r,o,a){if(n.standalone||!t.length||!n.description)return n.description||"";const l=je(t,i,s,r,o,a);return l.description?`${l.description.trim().replace(/([^.,!?])$/,"$1.")} ${n.description}`:n.description}async function Xe(n,t,i,s){const r=i.selectedActions||{},o=n.filter(d=>{const c=r[d.name];return c&&c.level>0&&(!c.variation||c.variation==="standalone")}),a=n.filter(d=>{const c=r[d.name];return c&&c.level>0&&(c.variation==="appendSome"||c.variation==="appendMost")}),l=[];for(let d=1;d<=s;d++){const c=je(o,t,r,d,s,i),u=Qe(c,a,t,r,d,s,i);l.push({title:c.title,description:u.trim(),role:c.role})}return l}function X(n,t){const i={title:V("start"),description:V("start")},{finishRange:s=[33,66]}=t,r=`${V("noCum")} ${s[0]}%\r
${V("ruined")} ${s[1]-s[0]}%\r
${V("cum")} ${100-s[1]}%`,o={title:V("finish"),description:r};return[i,...n.map(a=>({title:a.title,description:a.description})),o]}async function Ze(n,t,i,s=40){try{const[r,o]=await Promise.all([Ve({locale:t,gameMode:i}),Ge({locale:t,gameMode:i})]),a=n.selectedActions||{},l=Object.keys(a).filter(v=>a[v]?.level>0),d=r.filter(v=>l.includes(v.name)),c=r.map(v=>v.name),u=l.filter(v=>!c.includes(v)),m=n.role||"sub",h=He(o,m).filter(v=>l.includes(v.group));if(!d.length||!h.length)return{board:X([],n),metadata:{totalTiles:s+2,tilesWithContent:2,selectedGroups:l,missingGroups:u,availableTileCount:h.length}};const x=await Xe(d,h,n,s),f=x.filter(v=>v.description.trim().length>0).length,g=X(x,n);return{board:g,metadata:{totalTiles:g.length,tilesWithContent:f+2,selectedGroups:l,missingGroups:u,availableTileCount:h.length}}}catch(r){return console.error("Error building game board:",r),{board:X([],n),metadata:{totalTiles:2,tilesWithContent:2,selectedGroups:[],missingGroups:[],availableTileCount:0}}}}function De(){const n=ne(me),[t,i]=_(),{i18n:s}=w(),r=b.useCallback(async o=>{const a=o?.roomUpdate||o?.boardUpdated?o:{...t,...o,selectedActions:{...t.selectedActions,...o.selectedActions}};let{gameMode:l,boardUpdated:d}=a;const{roomTileCount:c=40,finishRange:u,room:m}=a,p=A(m||"");if(!o||!u)return{gameMode:l};p&&!G(l||"")&&(l="online",d=!0);const h=l||"online",x=s.resolvedLanguage||"en",f=p?40:c||40,g=await Ze(a,x,h,f);return g.metadata.missingGroups.length>0&&console.warn("Missing groups for board building:",g.metadata.missingGroups),g.metadata.tilesWithContent<f/2&&console.warn("Low tile content ratio:",{tilesWithContent:g.metadata.tilesWithContent,totalTiles:g.metadata.totalTiles,availableTileCount:g.metadata.availableTileCount}),(o?.boardUpdated||d||(n?.tiles?.length??0)!==g.board.length)&&(await i(a),await pe({title:n?.title||"",tiles:g.board})),{settingsBoardUpdated:d,gameMode:l,newBoard:g.board,metadata:g.metadata}},[n,s.resolvedLanguage,t,i]);return b.useCallback(o=>r(o),[r])}function Z({children:n,value:t,index:i,style:s,...r}){return e.jsx("div",{role:"tabpanel",hidden:t!==i,id:`simple-tabpanel-${i}`,"aria-labelledby":`simple-tab-${i}`,...r,children:t===i&&e.jsx(C,{sx:{p:3,...s},children:n})})}function fe({formData:n,setFormData:t,backgrounds:i,isRoom:s=!1}){const{t:r}=w(),o=s?"roomBackground":"background",a=s?"roomBackgroundURL":"backgroundURL",[l,d]=b.useState(n?.[o]||Object.keys(i)[0]),c=()=>Object.entries(i).map(([p,h])=>e.jsx(S,{value:p,children:h},p)),u=p=>{t({...n,[o]:p.target.value}),d(p.target.value)};b.useEffect(()=>{l!==n?.[o]&&d(n?.[o]||"")},[n,l,o]);const m=p=>{const h={...n,[o]:"custom",[a]:p.target.value};s&&(h.roomUpdated=!0),t(h)};return e.jsxs(e.Fragment,{children:[e.jsxs($,{fullWidth:!0,margin:"normal",children:[e.jsx(I,{id:"background-label",children:r("background")}),e.jsx(K,{labelId:"background-label",id:"background",label:r("background"),value:l||"",onChange:u,children:c()})]}),l==="custom"&&e.jsx(se,{sx:{mt:2},label:r("url"),value:n?.[a]||"",fullWidth:!0,onChange:m,helperText:e.jsxs(e.Fragment,{children:[r("supportedSites"),e.jsx("br",{}),r("requiresEmbeddedUrl")]})})]})}const ue={en:["alex","samantha","google uk english male","google uk english female","google us english male","google us english female","victoria","allison","ava","susan","daniel","karen","moira","fiona"],es:["google español","google español de estados unidos","monica","jorge","diego","paulina","juan","esperanza","carlos","rosa"],fr:["google français","amelie","thomas","aurelie","marie","pierre","brigitte","bernard","claire","sylvie"],zh:["google 中文","google 中文（中国大陆）","ting-ting","sin-ji","mei-jia","yu-shu","li-mu","ya-ling","xiao-bao","xiao-rong"],hi:["google हिन्दी","lekha","sangeeta","veena","rishi","kalpana","hemant","kavita","arun","shilpa"]},he={en:"Take a drink and enjoy the game.",es:"Toma un trago y disfruta del juego.",fr:"Prenez une boisson et profitez du jeu.",zh:"喝一杯，享受游戏。",hi:"एक पेय लें और खेल का आनंद लें।"};class en{getAvailableVoices(t){const i=window.speechSynthesis.getVoices(),s=t?.split("-")[0]||"en",r=ue[s]||ue.en;return i.filter(o=>{const a=o.name.toLowerCase();return r.some(l=>a.includes(l.toLowerCase()))}).map(o=>({name:o.name,displayName:o.name}))}getPreferredVoice(t){const i=this.getAvailableVoices(t);return i.length>0?i[0].name:null}getSampleText(t){const i=t.split("-")[0];return he[i]||he.en}async speak(t,i,s=0){return new Promise((r,o)=>{if(!("speechSynthesis"in window)){o(new Error("Speech synthesis not supported"));return}const a=new SpeechSynthesisUtterance(t);if(a.pitch=s,i){const d=window.speechSynthesis.getVoices().find(c=>c.name===i);d&&(a.voice=d)}a.onend=()=>r(),a.onerror=l=>o(new Error(`Speech failed: ${l.error}`)),window.speechSynthesis.speak(a)})}stop(){window.speechSynthesis?.speaking&&window.speechSynthesis.cancel()}isAvailable(){return"speechSynthesis"in window}}const W=new en,nn=()=>{const[n,t]=b.useState(!1),[i,s]=b.useState(!1),[r,o]=b.useState(null),a=b.useCallback(()=>{W.stop(),t(!1),s(!1)},[]),l=b.useCallback(async(d,c={})=>{try{s(!0),o(null),a(),t(!0),await W.speak(d,c.voice,c.pitch),s(!1),t(!1)}catch(u){const m=u instanceof Error?u.message:"TTS failed";o(m),t(!1),s(!1),console.error("TTS Error:",u)}},[a]);return b.useEffect(()=>()=>{a()},[a]),{speak:l,stop:a,isPlaying:n,error:r,isLoading:i}};function tn({formData:n,setFormData:t,onVoiceChange:i}){const{t:s,i18n:r}=w(),[o,a]=b.useState([]),[l,d]=b.useState(!0),{speak:c}=nn(),u=n.locale||r.language||"en",m=n.voicePreference||"",p=b.useCallback(g=>{const v={...n,voicePreference:g};t(v),i?.(g)},[n,t,i]);b.useEffect(()=>{let g=!0;return(async()=>{try{if(g){const T=W.getAvailableVoices(u);if(a(T),!m&&T.length>0){const B=W.getPreferredVoice(u);B&&p(B)}d(!1)}}catch(T){console.error("Failed to load voices:",T),g&&d(!1)}})(),()=>{g=!1}},[u,m,p]);const h=g=>{p(g.target.value)},x=async()=>{const g=m||(o.length>0?o[0].name:"");if(!g)return;const v=W.getSampleText(u);try{await c(v,{voice:g,pitch:-2})}catch(T){console.error("Failed to play sample:",T)}},f=g=>g.displayName;return l?e.jsx(C,{sx:{py:1},children:e.jsx(y,{variant:"body2",color:"text.secondary",children:s("loadingVoices","Loading voices...")})}):o.length===0?e.jsx(C,{sx:{py:1},children:e.jsx(y,{variant:"body2",color:"text.secondary",children:s("noVoicesAvailable","No voices available for this language")})}):e.jsxs(C,{sx:{display:"flex",alignItems:"center",gap:1,py:1},children:[e.jsxs($,{fullWidth:!0,size:"small",children:[e.jsx(I,{id:"voice-select-label",children:s("voiceSelection","Voice")}),e.jsx(K,{labelId:"voice-select-label",value:m,label:s("voiceSelection","Voice"),onChange:h,children:o.map(g=>e.jsx(S,{value:g.name,children:f(g)},g.name))})]}),e.jsx(P,{title:s("playSample","Play sample"),children:e.jsx(ye,{onClick:x,color:"primary",disabled:!m,size:"small",children:e.jsx(ve,{})})})]})}function sn({boardUpdated:n}){const{i18n:t}=w(),[i,s]=b.useState(t.resolvedLanguage||"en");function r(a){s(a),t.changeLanguage(a),n()}const o=Object.entries(Re).map(([a,l])=>e.jsx(S,{value:a,children:l.label},a));return e.jsx(C,{sx:{minWidth:120,mt:1,mb:2},children:e.jsxs($,{fullWidth:!0,children:[e.jsxs(I,{id:"language-label",sx:{display:"flex",alignItems:"center"},children:[e.jsx(le,{sx:{mr:1}}),e.jsx(j,{i18nKey:"language"})]}),e.jsx(K,{labelId:"language-label",id:"language-select",value:i,label:e.jsxs(e.Fragment,{children:[e.jsx(le,{}),e.jsx(j,{i18nKey:"language"})]}),onChange:a=>r(a.target.value),children:o})]})})}function on({trueCondition:n,onChange:t,yesLabel:i,noLabel:s=null,sx:r={}}){const o=s??i;return e.jsx(C,{sx:{display:"flex",justifyContent:"center",my:1,...r},children:e.jsx(Se,{control:e.jsx(F,{checked:n||!1,onChange:t}),label:re(n?i:o)})})}function O({field:n,formData:t,handleSwitch:i}){return e.jsx(on,{trueCondition:t[n],onChange:s=>i(s,n),yesLabel:`${n}Enable`,sx:{justifyContent:"left"}})}function rn({formData:n,setFormData:t,boardUpdated:i}){const[s,r]=_(),{t:o}=w(),a={color:o("color"),gray:o("gray"),"metronome.gif":o("hypnoDick"),"pink-spiral.gif":o("pinkSpiral"),custom:o("customURL")};function l(c,u){t({...n,[u]:c.target.checked}),r({...s,[u]:c.target.checked})}function d(c){r({...s,voicePreference:c})}return e.jsxs(e.Fragment,{children:[e.jsx(sn,{boardUpdated:i}),e.jsx(y,{variant:"h5",children:e.jsx(j,{i18nKey:"dialog"})}),e.jsx(O,{field:"playerDialog",formData:n,handleSwitch:l}),e.jsx(O,{field:"othersDialog",formData:n,handleSwitch:l}),e.jsx(U,{}),e.jsx(y,{variant:"h5",sx:{mt:2},children:e.jsx(j,{i18nKey:"sounds"})}),e.jsx(O,{field:"mySound",formData:n,handleSwitch:l}),e.jsx(O,{field:"otherSound",formData:n,handleSwitch:l}),e.jsx(O,{field:"chatSound",formData:n,handleSwitch:l}),e.jsx(O,{field:"readRoll",formData:n,handleSwitch:l}),n.readRoll&&e.jsx(tn,{formData:n,setFormData:t,onVoiceChange:d}),e.jsx(U,{}),e.jsx(y,{variant:"h5",sx:{mt:2,textTransform:"capitalize"},children:e.jsx(j,{i18nKey:"misc"})}),e.jsx(O,{field:"hideBoardActions",formData:n,handleSwitch:l}),e.jsx(O,{field:"advancedSettings",formData:n,handleSwitch:l}),e.jsx(fe,{formData:n,setFormData:t,backgrounds:a}),e.jsx(U,{})]})}function D({children:n}){return e.jsx(k,{size:{xs:12,md:5},children:n})}const te=b.forwardRef(({value:n,onChange:t,label:i,options:s,defaultValue:r=null,sx:o,helpIcon:a=!1,fullWidth:l=!0,...d},c)=>{const u=b.useMemo(()=>s.map(m=>typeof m=="string"?e.jsx(S,{value:m,children:re(m)},m):e.jsx(S,{value:m.value,children:m.label},m.value)),[s]);return e.jsxs($,{fullWidth:l,margin:"normal",sx:o,...d,ref:c,children:[e.jsxs(I,{id:`${i}Label`,children:[e.jsx(j,{i18nKey:i}),!!a&&e.jsx(M,{sx:{ml:1,fontSize:16}})]}),e.jsx(K,{labelId:`${i}Label`,id:i,label:e.jsxs(e.Fragment,{children:[e.jsx(j,{i18nKey:i}),!!a&&e.jsx(M,{sx:{ml:1,fontSize:16}})]}),value:n||r||"",onChange:t,children:u})]})});function ee({children:n,title:t,subtitle:i,defaultExpanded:s=!1,...r}){return e.jsxs(Ce,{defaultExpanded:s,...r,sx:{backgroundColor:"inherit",backgroundImage:"none",boxShadow:"none"},children:[e.jsxs(we,{expandIcon:e.jsx(Te,{}),sx:{px:0},children:[e.jsxs(y,{variant:"h6",sx:{width:"33%"},children:[t,":"]}),e.jsx(y,{sx:{pt:.5},children:i})]}),e.jsx(ke,{sx:{px:0},children:e.jsx(k,{container:!0,columnSpacing:2,justifyContent:"space-evenly",className:"columned-grid",children:n})})]})}function an({formData:n,setFormData:t}){const i=(r,o)=>{t({...n,finishRange:o,boardUpdated:!0})},s=n?.finishRange||[30,70];return e.jsxs(C,{children:[e.jsx(U,{}),e.jsx(y,{id:"finish-slider",sx:{my:1},children:e.jsx(j,{i18nKey:"finishSlider"})}),e.jsx(Ae,{"aria-labelledby":"finish-slider",value:s,onChange:i,valueLabelDisplay:"off"}),e.jsxs(C,{display:"flex",flexDirection:"column",justifyContent:"space-between",textAlign:"center",children:[e.jsxs(y,{whiteSpace:"nowrap",children:[e.jsx(j,{i18nKey:"noCum"})," ",s[0],"%"]}),e.jsxs(y,{whiteSpace:"nowrap",children:[e.jsx(j,{i18nKey:"ruined"})," ",s[1]-s[0],"%"]}),e.jsxs(y,{whiteSpace:"nowrap",children:[e.jsx(j,{i18nKey:"cum"})," ",100-s[1],"%"]})]}),e.jsx(U,{sx:{my:1}})]})}function ln(){const[n,t]=b.useState(!1);return b.useEffect(()=>{const i=window.matchMedia("(pointer: fine)");t(i.matches);const s=r=>{t(r.matches)};return i.addEventListener("change",s),()=>{i.removeEventListener("change",s)}},[]),n}function cn({actionsFolder:n,settings:t,option:i,onChange:s,initValue:r=0}){const o=`${i}label`,a=n[i]?.label,l=()=>t.selectedActions?.[i]?.level||r,d=ln(),[c,u]=b.useState(l()),m=f=>{s(f)},p=f=>{u(f)},h=f=>c>0&&f===0?!1:t.difficulty==="accelerated"?c<=2?c===f:c===f||c-1===f:c>=f;function x(f){return Object.keys(n[f]?.actions||{}).map((g,v)=>e.jsxs(S,{value:v,onMouseOver:()=>p(v),children:[!!d&&e.jsx("span",{className:"menu-item-icon",children:h(v)?e.jsx(Be,{}):e.jsx(Le,{})}),g]},`${f}-${g}`))}return e.jsxs($,{margin:"normal",fullWidth:!0,children:[e.jsx(I,{id:o,children:a}),e.jsx(K,{labelId:o,id:i,label:a,value:l(),onChange:m,onOpen:()=>u(l()),onClose:()=>u(l()),children:x(i)})]})}function dn({option:n,settings:t,setSettings:i,actionsFolder:s,type:r,showVariation:o=!1,showRole:a=!1}){const{t:l}=w(),d=`${n}label`,c=s[n]?.label;function u(h,x,f){const g=t.selectedActions?.[x];i({...t,selectedActions:{...t.selectedActions,[x]:{...g,type:r,level:g?.level??0,[f]:h?.target?.value}},boardUpdated:!0})}let m=12;(o||a)&&(m=6);let p=["dom","vers","sub"];return s[n]?.dom&&(p=[{label:s[n].dom,value:"dom"},{label:l("vers"),value:"vers"},{label:s[n].sub,value:"sub"}]),e.jsxs(k,{container:!0,justifyContent:"center",children:[e.jsx(k,{size:m,children:e.jsx(cn,{actionsFolder:s,settings:t,option:n,onChange:h=>u(h,n,"level")})}),!!a&&e.jsx(k,{size:6,children:e.jsx(te,{sx:{ml:1},value:t.selectedActions?.[n]?.role,onChange:h=>u(h,n,"role"),label:`${l("role")}: ${c}`,options:p,defaultValue:t.role||"sub"})}),!!o&&e.jsx(k,{size:6,children:e.jsx(P,{placement:"top",title:e.jsxs(j,{i18nKey:"variationTooltip",children:[e.jsx(y,{variant:"subtitle2",children:"Standalone = Its own tile. "}),e.jsx(y,{variant:"subtitle2",children:"Append Some = 50% chance."}),e.jsx(y,{variant:"subtitle2",children:"Append Most = 90% chance."})]}),arrow:!0,children:e.jsxs($,{fullWidth:!0,margin:"normal",sx:{ml:1},children:[e.jsxs(I,{id:`${d}Variation`,children:[`${c} ${l("variation")}`,e.jsx(M,{sx:{ml:1,fontSize:16}})]}),e.jsxs(K,{labelId:`${d}Variation`,id:`${n}Variation`,label:e.jsxs(e.Fragment,{children:[c," ",l("variation"),e.jsx(M,{sx:{ml:1,fontSize:16}})]}),value:t.selectedActions?.[n]?.variation||"standalone",onChange:h=>u(h,n,"variation"),children:[e.jsx(S,{value:"standalone",children:e.jsx(j,{i18nKey:"standalone"})}),e.jsx(S,{value:"appendSome",children:e.jsx(j,{i18nKey:"appendSome"})}),e.jsx(S,{value:"appendMost",children:e.jsx(j,{i18nKey:"appendMost"})})]})]})})})]},n)}function un({formData:n,setFormData:t}){return e.jsxs(ie,{direction:"row",spacing:1,alignItems:"center",justifyContent:"center",sx:{mt:1},children:[e.jsx(y,{children:e.jsx(j,{i18nKey:"solo"})}),e.jsx(P,{title:e.jsx(y,{variant:"subtitle2",children:e.jsx(j,{i18nKey:"soloTooltip"})}),arrow:!0,children:e.jsx(M,{sx:{fontSize:15}})}),e.jsx(F,{id:"gameMode",checked:!G(n.gameMode),onChange:i=>t({...n,gameMode:i.target.checked?"local":"online",boardUpdated:!0}),inputProps:{"aria-label":"Game Type"}}),e.jsx(y,{children:e.jsx(j,{i18nKey:"local"})}),e.jsx(P,{title:e.jsx(y,{variant:"subtitle2",children:e.jsx(j,{i18nKey:"localTooltip"})}),arrow:!0,children:e.jsx(M,{sx:{fontSize:15}})})]})}function hn({formData:n}){const[t,i]=b.useState(!1);return b.useEffect(()=>{const s=Object.values(n).filter(o=>typeof o=="object"&&o?.type==="consumption"&&o?.level>0).length,r=Object.values(n).filter(o=>typeof o=="object"&&o?.level>0).length;i(s>1&&s>=r-s)},[n]),t?e.jsx($e,{severity:"warning",children:e.jsx(j,{i18nKey:"consumptionWarning"})}):null}function gn({formData:n,setFormData:t,actionsList:i}){const{t:s}=w(),r=!A(n?.room)&&!G(n.gameMode);function o(l,d={}){return Object.keys(i).filter(c=>i[c]?.type===l).map(c=>e.jsx(D,{children:e.jsx(dn,{option:c,settings:n,setSettings:t,actionsFolder:i,type:l,...d})},c))}const a=l=>{const d=JSON.parse(JSON.stringify(n));return Object.keys(d).forEach(c=>{d.role=l,c.includes("role")&&(d[c]=l)}),d};return e.jsxs(e.Fragment,{children:[e.jsx(un,{formData:n,setFormData:t}),A(n?.room)&&!G(n.gameMode)&&e.jsx(k,{container:!0,alignContent:"center",justifyContent:"space-evenly",children:e.jsx(k,{sx:{py:3},children:e.jsx(y,{variant:"h5",children:e.jsx(j,{i18nKey:"privateRequired"})})})}),e.jsxs(k,{container:!0,columnSpacing:2,justifyContent:"space-evenly",children:[e.jsx(D,{children:e.jsx(P,{placement:"top",title:e.jsx(j,{i18nKey:"difficultyTooltip",children:e.jsxs(y,{variant:"body2",children:["Normal = Slow ramp up. ",e.jsx("br",{}),e.jsx("br",{}),"Accelerated = Straight to max level + the level prior to it."]})}),arrow:!0,children:e.jsx(te,{value:n.difficulty,onChange:l=>t({...n,difficulty:l.target.value,boardUpdated:!0}),label:"difficulty",options:["normal","accelerated"],defaultValue:"normal",helpIcon:!0})})}),r&&e.jsx(D,{children:e.jsx(te,{value:n.role,onChange:l=>t({...a(l.target.value),boardUpdated:!0}),label:"mainRole",options:["dom","vers","sub"],defaultValue:"sub"})})]}),r?e.jsxs(e.Fragment,{children:[e.jsx(ee,{title:s("consumption"),subtitle:s("consumptionSubtitle"),children:o("consumption",{showVariation:!0})}),e.jsx(ee,{title:s("foreplay"),subtitle:s("foreplaySubtitle"),children:o("foreplay",{showRole:r})}),e.jsx(ee,{title:s("sex"),subtitle:s("sexSubtitle"),children:o("sex",{showRole:r})})]}):e.jsxs(e.Fragment,{children:[e.jsx(k,{container:!0,columnSpacing:2,justifyContent:"space-evenly",children:o("consumption",{showVariation:!0})}),e.jsx(U,{}),e.jsx(k,{container:!0,columnSpacing:2,justifyContent:"center",children:o("solo")})]}),e.jsx(an,{setFormData:t,formData:n}),e.jsx(hn,{formData:n})]})}function pn({formData:n,setFormData:t}){const{t:i}=w(),s={"1d4":2.5,"1d6":3.5,"2d4":5},r=n?.roomTileCount?Math.floor(n.roomTileCount/s[n.roomDice||"1d6"]):16,o=Array.from({length:7},(a,l)=>(l+2)*10).map(a=>e.jsx(S,{value:a,children:a},a));return e.jsxs(e.Fragment,{children:[e.jsx(y,{children:e.jsx(j,{i18nKey:"gameSpeed"})}),e.jsxs(C,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[e.jsxs($,{sx:{m:1},fullWidth:!0,children:[e.jsx(I,{id:"diceRole-label",children:e.jsx(j,{i18nKey:"roomDice"})}),e.jsxs(K,{labelId:"diceRole-label",id:"diceRole-select",value:n?.roomDice||"1d4",label:i("roomDice"),onChange:a=>t({...n,roomDice:a.target.value,roomUpdated:!0}),children:[e.jsx(S,{value:"1d4",children:"1d4"}),e.jsx(S,{value:"1d6",children:"1d6"}),e.jsx(S,{value:"2d4",children:"2d4"})]})]}),e.jsxs($,{sx:{m:1},fullWidth:!0,children:[e.jsx(I,{id:"tile-count-label",children:e.jsx(j,{i18nKey:"roomTileCount"})}),e.jsx(K,{labelId:"tile-count-label",id:"tile-count-select",value:String(n?.roomTileCount||40),label:i("roomTileCount"),onChange:a=>t({...n,roomTileCount:Number(a.target.value),roomUpdated:!0}),children:o})]}),e.jsx($,{fullWidth:!0,children:e.jsxs(y,{children:[e.jsx(j,{i18nKey:"averageRolls"}),r]})})]})]})}function mn({formData:n,setFormData:t}){const i=b.useCallback(()=>{t({...n,roomRealtime:!n.roomRealtime,roomUpdated:!0})},[n,t]);return e.jsxs(e.Fragment,{children:[e.jsx(y,{children:e.jsx(j,{i18nKey:"playerListOptions"})}),e.jsxs(ie,{direction:"row",spacing:1,alignItems:"center",justifyContent:"center",sx:{width:"100%"},children:[e.jsx(y,{children:e.jsx(j,{i18nKey:"realtime"})}),e.jsx(P,{title:e.jsx(y,{variant:"subtitle2",children:e.jsx(j,{i18nKey:"realtimeTooltip"})}),arrow:!0,children:e.jsx(M,{sx:{fontSize:15}})}),e.jsx(F,{id:"showPrivate",checked:!!n.roomRealtime,onChange:i,inputProps:{"aria-label":re("playerList")}}),e.jsx(y,{children:e.jsx(j,{i18nKey:"delayed"})}),e.jsx(P,{title:e.jsx(y,{variant:"subtitle2",children:e.jsx(j,{i18nKey:"delayedTooltip"})}),arrow:!0,children:e.jsx(M,{sx:{fontSize:15}})})]})]})}function xn({formData:n,setFormData:t}){const{id:i}=oe(),{t:s}=w(),r=c=>{let u;c.target.checked&&A(i)?u=Fe("123456789ABCDEFGHJKLMNPQRSTUVWXYZ",5)():i&&c.target.checked&&!A(i)?u=i:u="PUBLIC",t({...n,room:u.toUpperCase(),gameMode:A(u)?"online":n.gameMode})},o=b.useCallback(c=>{t({...n,room:c.currentTarget.value,boardUpdated:!0})},[n,t]),a=b.useCallback(c=>{c.key==="Enter"&&t({...n,room:c.currentTarget.value,boardUpdated:!0})},[n,t]),l=b.useCallback(c=>{const u=c.target.value.toUpperCase();c.target.value=u},[]),d=!A(n.room);return e.jsxs(e.Fragment,{children:[e.jsxs(ie,{direction:"row",spacing:1,alignItems:"center",justifyContent:"center",sx:{width:"100%"},children:[e.jsx(y,{children:e.jsx(j,{i18nKey:"public"})}),e.jsx(F,{id:"showPrivate",checked:d,onChange:r,slotProps:{input:{"aria-label":s("room")}}}),e.jsx(y,{children:e.jsx(j,{i18nKey:"private"})}),e.jsx(P,{title:e.jsx(y,{variant:"subtitle2",children:e.jsx(j,{i18nKey:"privateOptions"})}),arrow:!0,children:e.jsx(M,{sx:{fontSize:15}})})]}),d&&e.jsx(se,{fullWidth:!0,id:"privateRoom",label:s("privateRoom"),defaultValue:n.room?.toUpperCase(),margin:"normal",onBlur:o,onKeyDown:a,onChange:l,inputProps:{style:{textTransform:"uppercase"}}})]})}function jn({formData:n,setFormData:t}){const{t:i}=w(),s={app:i("appBackground"),custom:i("customURL")};return e.jsxs(C,{sx:{margin:"0.5rem"},children:[e.jsx(xn,{formData:n,setFormData:t}),!A(n.room)&&e.jsxs(e.Fragment,{children:[e.jsx(U,{sx:{my:1}}),e.jsx(pn,{formData:n,setFormData:t}),e.jsx(U,{sx:{my:1}}),e.jsx(mn,{formData:n,setFormData:t}),e.jsx(U,{sx:{my:1}}),e.jsx(fe,{formData:n,setFormData:t,backgrounds:s,isRoom:!0})]})]})}function fn(n){return Object.values(n).some(({level:t})=>t>0)}function bn(n,t){const i=n.selectedActions||{};return Object.entries(i).reduce((s,[r,o])=>(r in t&&(o?.variation?.startsWith("append")?s.withAppend[r]=o:s.withoutAppend[r]=o),s),{withAppend:{},withoutAppend:{}})}function yn(n){return Object.keys(n).length>0&&Object.values(n).some(({level:t})=>t>0)}function vn(n,t){const{withAppend:i,withoutAppend:s}=bn(n,t);return fn(s)?A(n.room)&&!G(n.gameMode)?"privateRequired":null:yn(i)?"appendWithAction":"pickSomething"}function Sn(n,t,i){const s=n.selectedActions||{},r=Object.entries(i).filter(([a])=>s[a]).reduce((a,[l,d])=>(a[l]=Object.keys(d.actions).slice(1,s[l].level+1),a),{});return(t?.filter(a=>{if(!a.isCustom)return!1;if(a.group==="misc")return!0;const l=r[a.group];return l&&l.length>=Number(a.intensity)})||[]).length}async function Cn(n,t,i,s){const{t:r}=z;let o=`### ${z.t("gameSettings")}\r
`;s&&(o+=`##### ${s}\r
`),o+=`--- \r
`;const a=n.selectedActions||{};if(Object.entries(i).forEach(([u,m])=>{if(!a[u])return;const{role:p,variation:h,level:x}=a[u],f=p||n.role||"sub";if(x>0){const g=Object.keys(m?.actions||{});if(o+=`* ${m?.label}: ${g[x]||""}`,h&&(o+=` (${r(h)})`),!G(n.gameMode)&&!h){const v=m[f]??r(f);o+=` (${v})`}o+=`\r
`}}),n.customGroups&&Array.isArray(n.customGroups)){for(const u of n.customGroups)if(u.groupName&&u.intensity)try{const p=(await We(u.groupName,n.locale||"en",n.gameMode||"online"))?.label||u.groupName;o+=`* ${p}: Level ${u.intensity} (Custom)\r
`}catch(m){console.error(`Error loading custom group ${u.groupName}:`,m),o+=`* ${u.groupName}: Level ${u.intensity} (Custom)\r
`}}if(o.endsWith(`--- \r
`))return"";const{finishRange:l,difficulty:d}=n;o+=`--- \r
`,o+=`* ${r("difficulty")}: ${r(d??"normal")} \r
`,l&&(o+=`* ${r("finishSlider")} ${l[0]}%  | ${l[1]-l[0]}% | ${100-l[1]}% \r
`);const c=Sn(n,t,i);return c&&(o+=`* ${r("customTilesLabel")}: ${c} \r
`),o}function wn(n){const t={};return Object.entries(n).forEach(([i,s])=>{!["displayName","background","boardUpdated","chatSound","mySound","otherSound","othersDialog","playerDialog","readRoll","hideBoardActions","advancedSettings"].includes(i)&&!i.startsWith("room")&&(t[i]=s)}),t}async function Tn({title:n,formData:t,user:i,actionsList:s,tiles:r,customTiles:o=[],reason:a=""}){const l=JSON.stringify(wn(t)),d=await Ne({title:n,gameBoard:JSON.stringify(r),settings:l}),c=await Cn(t,o,s,a);if(!(!d?.id||c===""))return xe({room:t?.room||"PUBLIC",user:i,text:c,type:"settings",gameBoardId:d.id,boardSize:r.length,gameMode:t.gameMode})}function kn(n){const{t}=z;let i=`### ${t("roomSettings")}\r
`;return Object.entries(n).forEach(([s,r])=>{if(s!=="room"){if(s==="roomBackgroundURL"&&r!==""){i+=`* ${t(s)}: [${_e(r)}:link:](${r})\r
`;return}if(s==="roomRealtime"){i+=`* ${t("playerList")}: ${t(r?"delayed":"realtime")}\r
`;return}r!==""&&(i+=`* ${t(s)}: ${r}\r
`)}}),i}function An(n){const t={};return Object.entries(n).forEach(([i,s])=>{i.startsWith("room")&&!["roomUpdated","roomBackground"].some(r=>r===i)&&(t[i]=s)}),t}async function Bn(n,t,i){let s=n;return t!==void 0&&t.length>0&&(s=await i(t)),s}function Ln(n,t){const i=An(n);return xe({room:n.room,user:t,text:kn(i),type:"room",settings:JSON.stringify(i)})}function be(){const{id:n}=oe(),t=Oe();return i=>{if(n!==void 0&&n?.toUpperCase()!==i?.toUpperCase()){const s=i?.replace(/^\/+/,"")||"PUBLIC";t(`/${s}`)}}}function $n(n){(!n.roomBackgroundURL||!qe(n.roomBackgroundURL))&&(n.roomBackground="app")}function Un(n){const t={...n},i={};n.selectedActions&&Object.entries(n.selectedActions).forEach(([r,o])=>{o&&o.level>0&&(i[r]=o)});const s=Ie();return Object.keys(t).forEach(r=>{const o=t[r];o&&typeof o=="object"&&o.type&&s.VALID_GROUP_TYPES.includes(o.type)&&delete t[r]}),t.selectedActions=i,t}function Mn(){const{user:n,updateUser:t}=ge(),{id:i}=oe(),{t:s}=w(),r=De(),[o,a]=_(),l=ne(()=>ze(o?.gameMode)),d=ne(me),c=be(),{messages:u}=Je(),m=b.useCallback(h=>{const x=i?.toUpperCase()!==h.room.toUpperCase(),f=!!(h.room&&!A(h.room)),g=f&&h.roomTileCount!==o?.roomTileCount;return{roomChanged:x,isPrivateRoom:f,privateBoardSizeChanged:g}},[i,o?.roomTileCount]),p=b.useCallback(async(h,x)=>{const{displayName:f}=h,g=await Bn(n,f,t);$n(h);const{settingsBoardUpdated:v,gameMode:T,newBoard:B=[]}=await r(h),{roomChanged:N,isPrivateRoom:q,privateBoardSizeChanged:J}=m(h);if(!g)return;q&&(h.roomUpdated||!u.find(E=>E.type==="room"))&&await Ln(h,g),d?.tiles!==B&&await pe({title:s("settingsGenerated"),tiles:B,isActive:1,gameMode:T}),(v||N||J)&&!u.some(E=>E.type==="settings"&&E.uid===g.uid&&Date.now()-(E.timestamp?.toMillis()||0)<5e3)&&await Tn({formData:h,user:g,customTiles:l,actionsList:x,title:"Settings Generated Board",tiles:B});const R=Un(h);a({...R,boardUpdated:!1,roomUpdated:!1,gameMode:T}),c(h.room)},[n,t,r,m,u,d,s,l,a,c]);return b.useCallback((h,x)=>p(h,x),[p])}function Rn({closeDialog:n,initialTab:t=0}){const{user:i}=ge(),{t:s}=w(),[r,o]=_(),[a,l]=b.useState(t),[d,c]=b.useState(null),[u,m]=b.useState(!1),[p,h]=Ke(),x=be(),f=Mn(),{isLoading:g,actionsList:v}=Pe(p?.gameMode),T=(L,R)=>{l(R),x(p.room)},B=()=>o({...r,boardUpdated:!0}),N=b.useCallback(async L=>{L.preventDefault();const{displayName:R,...E}=p,ae=vn(E,v);return ae?(c(s(ae)),null):(f(p,v),typeof n=="function"&&n(),null)},[p,v,s,c,f,n]),q=b.useCallback(L=>{h(R=>({...R,displayName:L.target.value}))},[h]),J=b.useCallback(L=>{L.key==="Enter"&&(h(R=>({...R,displayName:L.target.value})),N(L))},[N,h]);return!p.room||g?e.jsxs(C,{children:[e.jsxs(y,{variant:"h2",children:[e.jsx(j,{i18nKey:"loading"}),"..."]}),e.jsx(y,{variant:"body1",children:e.jsx(j,{i18nKey:"clearStorage"})})]}):e.jsxs(C,{component:"form",method:"post",onSubmit:N,className:"settings-box",children:[e.jsx(se,{fullWidth:!0,id:"displayName",label:s("displayName"),defaultValue:i?.displayName||p.displayName||"",required:!0,autoFocus:!0,onBlur:q,onKeyDown:J,margin:"normal"}),e.jsx(C,{sx:{borderBottom:1,borderColor:"divider"},children:e.jsxs(Ue,{value:a,onChange:T,"aria-label":s("gameSettings"),centered:!0,children:[e.jsx(H,{label:s("gameboard"),...Y(0)}),e.jsx(H,{label:s("room"),...Y(1)}),e.jsx(H,{label:s("application"),...Y(2)})]})}),e.jsx(Z,{value:a,index:0,style:{p:0},children:e.jsx(gn,{formData:p,setFormData:h,actionsList:v})}),e.jsx(Z,{value:a,index:1,style:{p:0,pt:1},children:e.jsx(jn,{formData:p,setFormData:h})}),e.jsx(Z,{value:a,index:2,style:{p:0,pt:1},children:e.jsx(rn,{formData:p,setFormData:h,boardUpdated:B})}),e.jsxs("div",{className:"flex-buttons",children:[e.jsx(ce,{variant:"outlined",type:"button",onClick:()=>m(!0),children:e.jsx(j,{i18nKey:"customTilesLabel",children:"Game Tiles"})}),e.jsx(ce,{variant:"contained",type:"submit",children:e.jsx(j,{i18nKey:"update"})})]}),u&&e.jsx(Ee,{open:u,setOpen:m,boardUpdated:B,actionsList:v}),e.jsx(Me,{open:!!d,close:()=>c(null),children:d})]})}const Hn=Object.freeze(Object.defineProperty({__proto__:null,default:Rn},Symbol.toStringTag,{value:"Module"}));export{Rn as G,cn as I,xn as R,te as S,Z as T,on as Y,Ln as a,be as b,Jn as c,Mn as d,Hn as i,Tn as s,W as t,De as u};
