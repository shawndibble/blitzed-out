const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["js/index.tsx-Dp6942Zd.js","js/chunk-D6lSgkQl.js","js/chunk-CygiBK7d.js","js/theme.tsx-tS6cOoiF.js","assets/index-Bub04f8o.js","js/chunk-B37hsyTU.js","js/chunk-CM1AJoxz.js","js/chunk-DkgxB0o3.js","js/chunk-Wq5pl8o3.js","js/chunk-D-1O0xjE.js","js/chunk-BbfM-0nx.js","js/chunk-DpBmrOge.js","js/schedule.tsx-CXUGcS16.js"])))=>i.map(i=>d[i]);
var et=Object.defineProperty;var tt=(e,t,r)=>t in e?et(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var F=(e,t,r)=>tt(e,typeof t!="symbol"?t+"":t,r);import{_ as z,A as me}from"../assets/index-Bub04f8o.js";import{aa as re,r as A,j as C,a7 as rt}from"./chunk-D6lSgkQl.js";import{g as S,E as nt,l as st,s as Oe,a as ot,u as ye,c as at,G as it,b as ct,d as ut,e as lt,f as oe,h as B,i as Be,T as dt,j as mt,k as ft,m as N,n as Le,o as gt,q as V,w as K,p as ne,r as se,t as Re,v as ke,x as yt,y as ht,z as pt,A as wt,B as At,C as ae}from"./chunk-B37hsyTU.js";import{r as vt,D as St,n as qe,a as Tt}from"./chunk-CygiBK7d.js";class Y extends Error{constructor(t,r,s){super(t),this.code=r,this.cause=s,this.name="AppError"}}class H extends Y{constructor(t,r,s){super(t,r,s),this.name="AuthError"}}function $e(e){return e instanceof Y}function he(e){return e instanceof Error}function O(e){return he(e)?e.message:typeof e=="string"?e:"An unknown error occurred"}function bt(e){if($e(e)||he(e)&&"code"in e)return e.code}function Q(e,t="An unexpected error occurred"){return $e(e)?e:he(e)?new Y(e.message||t,void 0,e):typeof e=="string"?new Y(e):new Y(t)}const Ee={"auth/user-not-found":"No account found with this email address","auth/wrong-password":"Incorrect password","auth/email-already-in-use":"An account with this email already exists","auth/weak-password":"Password is too weak","auth/invalid-email":"Invalid email address","auth/too-many-requests":"Too many login attempts. Please try again later","auth/network-request-failed":"Network error. Please check your connection","permission-denied":"You do not have permission to perform this action",unavailable:"Service is temporarily unavailable. Please try again"};function W(e){const t=bt(e);return t&&Ee[t]?Ee[t]:O(e)}var Et=vt();const Fe={apiKey:"AIzaSyCKS7tWQRYRWHsawNfN42uAmISdUbJHJJw",authDomain:"blitzout-49b39.firebaseapp.com",projectId:"blitzout-49b39",storageBucket:"blitzout-49b39.appspot.com",messagingSenderId:"852428606926",appId:"1:852428606926:web:17444e6f8dbc2f95f0ef9f",measurementId:"G-93YN1YMTQ7"},Ce=Object.entries(Fe).filter(([e,t])=>!t).map(([e])=>e);Ce.length>0&&(console.error("Missing Firebase environment variables:",Ce),console.error("Please check your .env file and ensure all VITE_FIREBASE_* variables are set"));const Ct=gt(Fe),M=Be(Ct);async function Dt(e=""){try{const t=S();return await lt(t),t.currentUser?(await ye(t.currentUser,{displayName:e}),t.currentUser):null}catch(t){throw console.error("Anonymous login error:",t),new H(W(t),"ANONYMOUS_LOGIN_FAILED",Q(t))}}async function _t(e,t,r=""){try{const s=S(),n=await at(s,e,t);return await ye(n.user,{displayName:r}),n.user}catch(s){throw console.error("Registration error:",s),new H(W(s),"REGISTRATION_FAILED",Q(s))}}async function It(e,t){try{const r=S();return(await ut(r,e,t)).user}catch(r){throw console.error("Email login error:",r),new H(W(r),"EMAIL_LOGIN_FAILED",Q(r))}}async function Mt(){try{const e=S(),t=new it;return(await ct(e,t)).user}catch(e){throw console.error("Google login error:",e),new H(W(e),"GOOGLE_LOGIN_FAILED",Q(e))}}async function Pt(e){try{const t=S();return await ot(t,e),!0}catch(t){throw console.error("Password reset error:",t),new H(W(t),"PASSWORD_RESET_FAILED",Q(t))}}async function xt(e,t){try{const s=S().currentUser;if(s?.isAnonymous){const n=nt.credential(e,t);return(await st(s,n)).user}else throw new Error("User is not anonymous or not logged in")}catch(r){throw console.error("Account conversion error:",r),new H(W(r),"ACCOUNT_CONVERSION_FAILED",Q(r))}}async function Ut(){try{const e=S();return await Oe(e),!0}catch(e){throw console.error(e),e}}async function Gt(){try{const e=S();await Oe(e),["gameSettings","messages-storage","i18nextLng","blitzed-out-action-groups-migration","blitzed-out-background-migration","blitzed-out-migration-in-progress","blitzed-out-current-language-migration","blitzed-out-background-migration-in-progress","blitzed-out-migration-health"].forEach(a=>{try{localStorage.removeItem(a)}catch(u){console.warn(`Failed to remove localStorage key: ${a}`,u)}});const r=["gameSettings","messages-storage","blitzed-out-"];Object.keys(localStorage).forEach(a=>{if(r.some(u=>a.startsWith(u)))try{localStorage.removeItem(a)}catch(u){console.warn(`Failed to remove localStorage key: ${a}`,u)}});try{sessionStorage.clear()}catch(a){console.warn("Failed to clear sessionStorage:",a)}try{const{default:a}=await z(async()=>{const{default:u}=await Promise.resolve().then(()=>zt);return{default:u}},void 0);await a.delete(),console.log("Successfully cleared IndexedDB")}catch(a){console.warn("Failed to clear IndexedDB:",a)}const n=["i18next"],o=window.location.hostname,i=[o];if(o.includes(".")){const a=o.split(".");for(let u=1;u<a.length-1;u++)i.push(`.${a.slice(u).join(".")}`)}const c=["/","/app","/auth","/login"];n.forEach(a=>{i.forEach(u=>{c.forEach(l=>{try{document.cookie=`${a}=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=${l}; domain=${u};`,document.cookie=`${a}=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=${l}; domain=${u}; secure;`,document.cookie=`${a}=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=${l}; domain=${u}; httpOnly;`,document.cookie=`${a}=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=${l}; domain=${u}; SameSite=Strict;`,document.cookie=`${a}=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=${l}; domain=${u}; SameSite=Lax;`,document.cookie=`${a}=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=${l}; domain=${u}; SameSite=None; secure;`}catch{}})}),c.forEach(u=>{try{document.cookie=`${a}=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=${u};`,document.cookie=`${a}=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=${u}; secure;`}catch{}}),console.log(`Attempted comprehensive clearing of cookie: ${a}`)}),console.log("Successfully wiped all app data")}catch(e){throw console.error("Error wiping app data:",e),e}}function Ur(e,t,r={},s={}){if(!e)return;const{enableCache:n=!0,enableDebounce:o=!0}=s,i=e.toUpperCase(),c=we("userList",i),a=Date.now();if(n){const l=D.get(c);if(l&&Ae(l,c)){l.queryCount++,D.set(c,l),_(c,Date.now()-a,!0);const d=Object.keys(l.data).sort().join(","),w=r?Object.keys(r).sort().join(","):"";d!==w&&t(l.data);return}}const u=async()=>{let l=!1;try{await ie();const d=pt(),w=wt(d,"users");At(w,h=>{const T=Date.now(),m=T-a,b=h.val();if(!b){t({});return}const E={};Object.entries(b).forEach(([G,I])=>{I.room===i&&(E[G]={displayName:I.displayName,uid:G,lastSeen:I.lastSeen?new Date(I.lastSeen):new Date,isAnonymous:I.isAnonymous,joinedAt:I.joinedAt?new Date(I.joinedAt):new Date,room:I.room})});const y=E;if(n){pe();const G=X(c);D.set(c,{data:y,timestamp:T,queryCount:1,priority:G})}_(c,m,!1,l);const v=Object.keys(y).sort().join(","),U=r?Object.keys(r).sort().join(","):"";v!==U&&t(y)},h=>{l=!0,console.error("getUserList error:",h),_(c,Date.now()-a,!1,!0)})}catch(d){l=!0,console.error("getUserList connection error:",d),_(c,Date.now()-a,!1,!0)}finally{ce()}};o?ve(c,u):u()}async function Ot(e=""){try{const t=S();return t.currentUser?(await ye(t.currentUser,{displayName:e}),t.currentUser):null}catch(t){return console.error(t),null}}async function Gr(e,t){try{await oe(B(M,"custom-actions"),{grouping:e,customAction:t,ttl:new Date(Date.now()+5760*60*1e3)})}catch(r){console.error(r)}}async function Bt(e){const t=V(B(M,"game-boards"),K("checksum","==",e)),r=await yt(t);return r.size?r.docs[0]:null}async function Or({title:e,gameBoard:t,settings:r}){if(e)try{const s=Et.sha256(t),n=await Bt(s);return n?(ft(n.ref,{ttl:new Date(Date.now()+720*60*60*1e3)}),n):await Lt({title:e,gameBoard:t,settings:r,checksum:s})}catch(s){console.error(s)}}async function Lt({title:e,gameBoard:t,settings:r,checksum:s}){try{return await oe(B(M,"game-boards"),{title:e,gameBoard:t,settings:r,checksum:s,ttl:new Date(Date.now()+720*60*60*1e3)})}catch(n){console.error(n);return}}async function Br(e){try{const t=N(M,"game-boards",e),r=await Le(t);return r.exists()?r.data():void 0}catch(t){console.error(t);return}}let De={};const D=new Map,j=new Map,_e=15e3,Rt=5e3,Ie=150,kt=50,je=50,qt=100,q={activeConnections:0,maxConnections:15,connectionQueue:[]},Me=new Map;function _(e,t,r,s=!1){const n=Me.get(e)||{queryCount:0,totalLatency:0,cacheHits:0,lastQueryTime:0,avgLatency:0,p95Latency:0,connectionPoolHits:0,networkErrors:0,latencyHistory:[]};if(n.queryCount++,n.totalLatency+=t,n.lastQueryTime=Date.now(),n.avgLatency=n.totalLatency/n.queryCount,n.latencyHistory.push(t),n.latencyHistory.length>20&&n.latencyHistory.shift(),n.latencyHistory.length>=5){const o=[...n.latencyHistory].sort((c,a)=>c-a),i=Math.floor(o.length*.95);n.p95Latency=o[i]}r&&n.cacheHits++,s&&n.networkErrors++,Me.set(e,n)}function X(e){return e.includes("messages")?"high":e.includes("userList")?"medium":"low"}function $t(e){switch(e){case"high":return Rt;case"medium":return _e;case"low":return _e*2}}function Ft(e){switch(e){case"high":return kt;case"medium":return Ie;case"low":return Ie*2}}function pe(){if(D.size<=qt)return;const e=Array.from(D.entries());e.sort(([,r],[,s])=>{const n={low:0,medium:1,high:2},o=n[r.priority]-n[s.priority];if(o!==0)return o;const i=r.queryCount-s.queryCount;return i!==0?i:r.timestamp-s.timestamp});const t=Math.ceil(D.size*.2);for(let r=0;r<t;r++)D.delete(e[r][0])}function ie(){return new Promise(e=>{q.activeConnections<q.maxConnections?(q.activeConnections++,e()):q.connectionQueue.push(()=>{q.activeConnections++,e()})})}function ce(){if(q.activeConnections--,q.connectionQueue.length>0){const e=q.connectionQueue.shift();e&&e()}}function we(e,t,r){return`${e}:${t||"global"}:${r||""}`}function Ae(e,t){const r=X(t),s=$t(r);return Date.now()-e.timestamp<s}function ve(e,t,...r){const s=X(e),n=Ft(s),o=j.get(e);o&&clearTimeout(o);const i=setTimeout(async()=>{try{await ie(),t(...r)}catch(c){console.error("Query execution error:",c)}finally{ce(),j.delete(e)}},n);j.set(e,i)}async function Lr({room:e,user:t,text:r="",type:s="chat",...n}){const o=["chat","actions","settings","room","media"];if(!o.includes(s)){let u="Invalid message type. Was expecting ";return u+=o.join(", "),u+=` but got ${s}`,console.error(u)}if(!t?.uid)return;const i={room:e,user:t.uid,text:r,type:s,...n};if(JSON.stringify(i)===JSON.stringify(De))return;De=i;const c=Date.now(),a=e?.toUpperCase()||"PUBLIC";try{return await oe(B(M,"chat-rooms",a,"messages"),{text:r.trim(),ttl:new Date(c+864e5),type:s,...n,uid:t.uid,displayName:t.displayName,timestamp:mt()})}catch(u){console.error("Failed to send message:",u);return}}async function Rr(e,t){return ht(N(M,`/chat-rooms/${e.toUpperCase()}/messages/${t}`))}function kr(e,t,r={}){if(!e)return;const s=S();if(!s.currentUser){let n,o;return n=s.onAuthStateChanged(i=>{i&&(o=Pe(e,t,r),n&&(n(),n=void 0))}),()=>{n&&n(),o&&o()}}return Pe(e,t,r)}function Pe(e,t,r={}){const{limitCount:s=je,startAfterDoc:n,enableCache:o=!0,enableDebounce:i=!0}=r,c=e.toUpperCase(),a=we("messages",c,`limit:${s}`),u=Date.now();if(o){const d=D.get(a);if(d&&Ae(d,a))return d.queryCount++,D.set(a,d),_(a,Date.now()-u,!0),t(d.data),()=>{}}const l=()=>{let d=!1,w;try{ie();const h=new Date;h.setHours(h.getHours()-3);let T=V(B(M,"chat-rooms",c,"messages"),K("timestamp",">",h),ne("timestamp","desc"),se(s));return n&&(T=V(B(M,"chat-rooms",c,"messages"),K("timestamp",">",h),ne("timestamp","desc"),Re(n),se(s))),w=ke(T,m=>{const b=Date.now(),E=b-u,y=m.docs.map(v=>({id:v.id,...v.data()}));if(o&&y.length>0){pe();const v=m.docs[m.docs.length-1],U=X(a);D.set(a,{data:y,timestamp:b,lastVisible:v,queryCount:1,priority:U})}_(a,E,!1,d),t(y)},m=>{d=!0,console.error("getMessages error:",m),_(a,Date.now()-u,!1,!0)}),w}catch(h){return d=!0,console.error("getMessages connection error:",h),_(a,Date.now()-u,!1,!0),()=>{}}finally{ce()}};if(i){let d;return ve(a,()=>{d=l()}),()=>{const w=j.get(a);w&&(clearTimeout(w),j.delete(a)),d&&d()}}return l()}function qr(e,t={}){const{limitCount:r=je,startAfterDoc:s,enableCache:n=!0,enableDebounce:o=!0}=t,i=we("schedule",null,`limit:${r}`),c=Date.now();if(n){const l=D.get(i);if(l&&Ae(l,i))return l.queryCount++,D.set(i,l),_(i,Date.now()-c,!0),e(l.data),()=>{}}const a=async()=>{let l=!1,d;try{await ie();const w=new Date;w.setMinutes(w.getMinutes()-5);let h=V(B(M,"schedule"),K("dateTime",">",w),ne("dateTime","asc"),se(r));return s&&(h=V(B(M,"schedule"),K("dateTime",">",w),ne("dateTime","asc"),Re(s),se(r))),d=ke(h,T=>{const m=Date.now(),b=m-c,E=T.docs.map(y=>({id:y.id,...y.data()}));if(n&&E.length>0){pe();const y=T.docs[T.docs.length-1],v=X(i);D.set(i,{data:E,timestamp:m,lastVisible:y,queryCount:1,priority:v})}_(i,b,!1,l),e(E)},T=>{l=!0,console.error("getSchedule error:",T),_(i,Date.now()-c,!1,!0)}),d||(()=>{})}catch(w){return l=!0,console.error("getSchedule connection error:",w),_(i,Date.now()-c,!1,!0),()=>{}}finally{ce()}};if(o){let l;return ve(i,async()=>{l=await a()}),()=>{const d=j.get(i);d&&(clearTimeout(d),j.delete(i)),l&&l()}}const u=a();return u instanceof Promise?()=>{}:u}async function $r(e,t,r="PUBLIC"){try{return await oe(B(M,"schedule"),{dateTime:dt.fromDate(e),url:t,room:r})}catch(s){return console.error(s)}}function jt(e={tables:["customTiles","gameBoard"]}){const{tables:t}=e,r=new Set(t),s={timeouts:{},queue:new Set,scheduleSync(n){this.timeouts[n]&&clearTimeout(this.timeouts[n]),this.queue.add(n),this.timeouts[n]=setTimeout(()=>{this.processSyncQueue()},2e3)},processSyncQueue(){if(this.queue.size===0)return;const n=window;n.authContext?.user&&!n.authContext.user.isAnonymous&&n.authContext.syncData(),this.queue.clear(),Object.keys(this.timeouts).forEach(o=>{clearTimeout(this.timeouts[o]),delete this.timeouts[o]})}};return{stack:"dbcore",name:"syncMiddleware",create(n){return{...n,table(o){const i=n.table(o);return r.has(o)?{...i,mutate:async c=>{const a=await i.mutate(c);return["put","add","delete","deleteRange","update"].includes(c.type)&&s.scheduleSync(o),a}}:i}}}}}class Nt extends St{constructor(){super("blitzedOut");F(this,"customTiles");F(this,"gameBoard");F(this,"customGroups");F(this,"localPlayerSessions");F(this,"localPlayerMoves");F(this,"localPlayerStats");this.version(2).stores({customTiles:"++id, group, intensity, action, isEnabled, tags, gameMode, isCustom, locale",gameBoard:"++id, title, tiles, tags, gameMode, isActive"}),this.version(3).stores({customTiles:"++id, group, intensity, action, isEnabled, tags, gameMode, isCustom, locale",gameBoard:"++id, title, tiles, tags, gameMode, isActive",customGroups:"++id, name, label, locale, gameMode, isDefault, createdAt"}),this.version(4).stores({customTiles:"++id, group, intensity, action, isEnabled, tags, gameMode, isCustom, locale",gameBoard:"++id, title, tiles, tags, gameMode, isActive",customGroups:"++id, name, label, locale, gameMode, isDefault, createdAt, [name+locale+gameMode]"}).upgrade(async r=>{const s=await r.table("customGroups").toArray(),n=new Set;for(const o of s){const i=`${o.name}-${o.locale}-${o.gameMode}`;n.has(i)?await r.table("customGroups").delete(o.id):n.add(i)}}),this.version(5).stores({customTiles:"++id, group, intensity, action, isEnabled, tags, gameMode, isCustom, locale",gameBoard:"++id, title, tiles, tags, gameMode, isActive",customGroups:"++id, name, label, locale, gameMode, isDefault, createdAt, [name+locale+gameMode]",localPlayerSessions:"++id, sessionId, roomId, isActive, createdAt, updatedAt",localPlayerMoves:"++id, sessionId, playerId, timestamp, sequence",localPlayerStats:"++id, sessionId, playerId, lastActive"})}}const $=new Nt;$.use(jt({tables:["customTiles","gameBoard","customGroups","localPlayerSessions","localPlayerMoves","localPlayerStats"]}));const zt=Object.freeze(Object.defineProperty({__proto__:null,default:$},Symbol.toStringTag,{value:"Module"})),{customTiles:x}=$;x.hook("creating",function(e,t,r){t.locale===void 0&&(t.locale="en"),t.gameMode===void 0&&(t.gameMode="online"),t.isCustom===void 0&&(t.isCustom=1)});const Ht=async e=>{const t=e.map(r=>({...r,isEnabled:1}));return await x.bulkAdd(t)},Ne=e=>{const t=["locale","gameMode","group","intensity","tag","isCustom","action"];let r=x.toCollection();return Object.entries(e).filter(([n])=>t.includes(n)).forEach(([n,o])=>{o==null||o===""||(n==="tag"?r=r.filter(i=>i.tags.includes(o)):r=r.filter(i=>i[n]===o))}),r},Se=async(e={})=>{try{return await Ne(e).toArray()}catch(t){return console.error("Error in getTiles:",t),[]}},Qt=async e=>{const{page:t=1,limit:r=50}=e;try{const s=Ne(e),n=await s.count(),o=(t-1)*r;return{items:await s.offset(o).limit(r).toArray(),total:n,page:t,limit:r,totalPages:Math.ceil(n/r)}}catch(s){return console.error("Error in getPaginatedTiles:",s),{items:[],total:0,page:t,limit:r,totalPages:0}}},ze=(e="en",t="online")=>x.where("locale").equals(e).and(r=>r.gameMode===t),Wt=async(e="en",t="online",r=null)=>{let s=ze(e,t);return r&&(s=s.and(o=>o.tags.some(i=>r.includes(i)))),(await s.toArray()).reduce((o,i)=>{const c=i.group;o[c]||(o[c]={count:0,intensities:{}}),o[c].count++;const a=Number(i.intensity);return o[c].intensities[a]||(o[c].intensities[a]=0),o[c].intensities[a]++,o},{})},Jt=(e=null)=>{const t=re.resolvedLanguage||re.language||"en";let r=x.where("locale").equals(t).and(s=>s.isEnabled===1);return e&&(r=r.and(s=>s.gameMode===e)),r.toArray()},He=async e=>await x.add({...e,isEnabled:1}),Yt=async(e,t)=>await x.update(e,t),Vt=async e=>{const t=await x.get(e);if(!t)throw new Error(`Custom tile with id ${e} not found`);return await x.update(e,{isEnabled:t.isEnabled?0:1})};async function Qe(){try{return await $.customTiles.where("isCustom").equals(1).delete(),!0}catch(e){return console.error("Error deleting custom tiles:",e),!1}}const Kt=async e=>{await x.delete(e)},We=(e,t="en",r="online")=>ze(t,r).and(s=>s.group===e),Xt=async(e,t="en",r="online")=>{try{return await We(e,t,r).count()}catch(s){return console.error("Error counting tiles by group:",s),0}},Zt=async(e,t="en",r="online")=>{try{return await We(e,t,r).delete()}catch(s){return console.error("Error deleting tiles by group:",s),0}},Fr=Object.freeze(Object.defineProperty({__proto__:null,addCustomTile:He,countTilesByGroup:Xt,deleteAllIsCustomTiles:Qe,deleteCustomTile:Kt,deleteCustomTilesByGroup:Zt,getActiveTiles:Jt,getPaginatedTiles:Qt,getTileCountsByGroup:Wt,getTiles:Se,importCustomTiles:Ht,toggleCustomTile:Vt,updateCustomTile:Yt},Symbol.toStringTag,{value:"Module"})),{customGroups:R}=$;R.hook("creating",function(e,t,r){t.id||(t.id=qe()),t.locale===void 0&&(t.locale=re.resolvedLanguage||re.language||"en"),t.gameMode===void 0&&(t.gameMode="online"),t.isDefault===void 0&&(t.isDefault=!1);const s=new Date;t.createdAt||(t.createdAt=s),t.updatedAt=s});R.hook("updating",function(e,t,r,s){e.updatedAt=new Date});const er=e=>{const t=["locale","gameMode","name","isDefault"];let r=R.toCollection();return Object.entries(e).filter(([n])=>t.includes(n)).forEach(([n,o])=>{o==null||o===""||(r=r.filter(i=>i[n]===o))}),r},ue=async(e={})=>{try{return await er(e).toArray()}catch(t){return console.error("Error in getCustomGroups:",t),[]}},Te=async(e,t="en",r="online")=>{try{return await R.where("name").equals(e).and(s=>s.locale===t&&s.gameMode===r).first()}catch(s){console.error("Error in getCustomGroupByName:",s);return}},tr=async e=>{try{const t={...e,createdAt:new Date,updatedAt:new Date};return await R.add(t)}catch(t){console.error("Error in addCustomGroup:",t);return}},rr=async(e,t)=>{try{return await R.update(e,t)}catch(r){return console.error("Error in updateCustomGroup:",r),0}},Je=async e=>{try{await R.delete(e)}catch(t){console.error("Error in deleteCustomGroup:",t)}},Ye=async()=>{try{return await R.clear(),!0}catch(e){return console.error("Error deleting all custom groups:",e),!1}},Ve=async e=>{try{const t=new Date,r=e.map(s=>({name:s.name||"",label:s.label||"",intensities:s.intensities||[],id:s.id||qe(),locale:s.locale||"en",gameMode:s.gameMode||"online",isDefault:s.isDefault||!1,createdAt:s.createdAt||t,updatedAt:s.updatedAt||t}));return await R.bulkAdd(r)}catch(t){console.error("Error in importCustomGroups:",t);return}},nr=async(e,t="en",r="online")=>{try{return(await Te(e,t,r))?.intensities||[]}catch(s){return console.error("Error in getGroupIntensities:",s),[]}},sr=async(e,t="en",r="online",s)=>{try{const n=await Te(e,t,r);return!!(!n||s&&n.id===s)}catch(n){return console.error("Error in isGroupNameUnique:",n),!1}},Ke=async(e="en",t="online")=>{try{const r=await ue({locale:e,gameMode:t}),s=new Map;r.forEach(o=>{const i=s.get(o.name)||[];i.push(o),s.set(o.name,i)});let n=0;for(const[,o]of s)if(o.length>1){o.sort((i,c)=>{try{const a=i.createdAt instanceof Date?i.createdAt.getTime():new Date(i.createdAt).getTime(),u=c.createdAt instanceof Date?c.createdAt.getTime():new Date(c.createdAt).getTime();return a-u}catch(a){return console.warn("Date parsing failed in removeDuplicateGroups, using createdAt fallback:",a),i.createdAt.getTime()-c.createdAt.getTime()}});for(let i=1;i<o.length;i++)await Je(o[i].id),n++}return n}catch(r){return console.error("Error in removeDuplicateGroups:",r),0}},or=async(e="en",t="online")=>{try{return await Ke(e,t),(await ue({locale:e,gameMode:t})).filter((n,o,i)=>i.findIndex(c=>c.name===n.name)===o)}catch(r){return console.error("❌ getAllAvailableGroups: Database error",{locale:e,gameMode:t,error:r}),[]}},jr=Object.freeze(Object.defineProperty({__proto__:null,addCustomGroup:tr,deleteAllCustomGroups:Ye,deleteCustomGroup:Je,getAllAvailableGroups:or,getCustomGroupByName:Te,getCustomGroups:ue,getGroupIntensities:nr,importCustomGroups:Ve,isGroupNameUnique:sr,removeDuplicateGroups:Ke,updateCustomGroup:rr},Symbol.toStringTag,{value:"Module"})),{gameBoard:L}=$,ar=()=>L.orderBy("title").toArray(),Nr=async()=>L.where("isActive").equals(1)?.first(),ir=async e=>L.add(e),cr=async(e,t)=>L.update(e.id,{...e,...t}),ur=async e=>{const t={title:e.title===void 0?"":e.title,tiles:e.tiles||[],isActive:e.isActive===void 0?1:e.isActive,tags:e.tags||[],gameMode:e.gameMode||"online"};if(!t?.title?.length&&t?.tiles?.length)return;const r=await L.where("title").equals(t.title).first();return $.transaction("rw",$.gameBoard,async()=>(t.isActive&&await lr(),r?(await cr(r,e),r.id):await ir(t)))},zr=async e=>{const r=(await L.toArray()).map(s=>({...s,isActive:s.id===e?1:0}));await L.bulkPut(r)},Hr=async e=>{await L.delete(e)},lr=async()=>{await L.where("isActive").equals(1).modify({isActive:0})};function dr(e,t){let r;try{r=e()}catch{return}return{getItem:n=>{var o;const i=a=>a===null?null:JSON.parse(a,void 0),c=(o=r.getItem(n))!=null?o:null;return c instanceof Promise?c.then(i):i(c)},setItem:(n,o)=>r.setItem(n,JSON.stringify(o,void 0)),removeItem:n=>r.removeItem(n)}}const fe=e=>t=>{try{const r=e(t);return r instanceof Promise?r:{then(s){return fe(s)(r)},catch(s){return this}}}catch(r){return{then(s){return this},catch(s){return fe(s)(r)}}}},mr=(e,t)=>(r,s,n)=>{let o={storage:dr(()=>localStorage),partialize:m=>m,version:0,merge:(m,b)=>({...b,...m}),...t},i=!1;const c=new Set,a=new Set;let u=o.storage;if(!u)return e((...m)=>{console.warn(`[zustand persist middleware] Unable to update item '${o.name}', the given storage is currently unavailable.`),r(...m)},s,n);const l=()=>{const m=o.partialize({...s()});return u.setItem(o.name,{state:m,version:o.version})},d=n.setState;n.setState=(m,b)=>{d(m,b),l()};const w=e((...m)=>{r(...m),l()},s,n);n.getInitialState=()=>w;let h;const T=()=>{var m,b;if(!u)return;i=!1,c.forEach(y=>{var v;return y((v=s())!=null?v:w)});const E=((b=o.onRehydrateStorage)==null?void 0:b.call(o,(m=s())!=null?m:w))||void 0;return fe(u.getItem.bind(u))(o.name).then(y=>{if(y)if(typeof y.version=="number"&&y.version!==o.version){if(o.migrate){const v=o.migrate(y.state,y.version);return v instanceof Promise?v.then(U=>[!0,U]):[!0,v]}console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,y.state];return[!1,void 0]}).then(y=>{var v;const[U,G]=y;if(h=o.merge(G,(v=s())!=null?v:w),r(h,!0),U)return l()}).then(()=>{E?.(h,void 0),h=s(),i=!0,a.forEach(y=>y(h))}).catch(y=>{E?.(void 0,y)})};return n.persist={setOptions:m=>{o={...o,...m},m.storage&&(u=m.storage)},clearStorage:()=>{u?.removeItem(o.name)},getOptions:()=>o,rehydrate:()=>T(),hasHydrated:()=>i,onHydrate:m=>(c.add(m),()=>{c.delete(m)}),onFinishHydration:m=>(a.add(m),()=>{a.delete(m)})},o.skipHydration||T(),h||w},fr=mr,xe={locale:"en",gameMode:"online",boardUpdated:!1,room:"PUBLIC",background:"color",roomBackground:"useAppBackground",selectedActions:{},hasSeenRollButton:!1,themeMode:"system",playerDialog:!0},Z=Tt()(fr(e=>({settings:xe,updateSettings:t=>e(r=>({settings:{...r.settings,...t}})),setLocale:t=>e(r=>({settings:{...r.settings,locale:t}})),resetSettings:()=>e({settings:xe}),updateSelectedAction:(t,r)=>e(s=>{const n={...s.settings.selectedActions};return r===null?delete n[t]:n[t]=r,{settings:{...s.settings,selectedActions:n}}}),removeSelectedAction:t=>e(r=>{const s={...r.settings.selectedActions};return delete s[t],{settings:{...r.settings,selectedActions:s}}}),clearSelectedActions:()=>e(t=>({settings:{...t.settings,selectedActions:{}}})),getSelectedActionsByType:t=>{const{selectedActions:r={}}=Z.getState().settings;return Object.entries(r||{}).filter(([,n])=>n.type===t).reduce((n,[o,i])=>(n[o]=i,n),{})}}),{name:"gameSettings",partialize:e=>({settings:e.settings})})),Qr=()=>{const{settings:e,updateSettings:t}=Z();return[e,t]},Wr=()=>{const{settings:e,updateSettings:t}=Z();return{settings:e,updateSettings:t}},Jr="None",Yr=3e4,Ue=500,ee=Be();async function gr(){const t=S().currentUser;if(!t)return console.error("No user logged in"),!1;try{const r=await Se({isCustom:1});return await ae(N(ee,"user-data",t.uid),{customTiles:r,lastUpdated:new Date},{merge:!0}),!0}catch(r){return console.error("Error syncing custom tiles:",r),!1}}async function yr(){const t=S().currentUser;if(!t)return console.error("No user logged in"),!1;try{const r=await ue();return await ae(N(ee,"user-data",t.uid),{customGroups:r,lastUpdated:new Date},{merge:!0}),!0}catch(r){return console.error("Error syncing custom groups:",r),!1}}async function hr(){const t=S().currentUser;if(!t)return console.error("No user logged in"),!1;try{const r=await ar();return r.length&&await ae(N(ee,"user-data",t.uid),{gameBoards:r,lastUpdated:new Date},{merge:!0}),!0}catch(r){return console.error("Error syncing game boards:",r),!1}}async function pr(){const t=S().currentUser;if(!t)return console.error("No user logged in"),!1;try{const{settings:r}=Z.getState(),{localPlayers:s,...n}=r;return await ae(N(ee,"user-data",t.uid),{settings:n,lastUpdated:new Date},{merge:!0}),!0}catch(r){return console.error("Error syncing settings:",r),!1}}async function de(){return await gr(),await yr(),await hr(),await pr(),!0}async function ge(){const t=S().currentUser;if(!t)return console.error("No user logged in"),!1;try{const r=N(ee,"user-data",t.uid),s=await Le(r);if(!s.exists())return!1;const n=s.data();if(n.customTiles!==void 0&&(await Qe(),await new Promise(o=>setTimeout(o,Ue)),n.customTiles&&n.customTiles.length>0))for(const o of n.customTiles)try{(await Se({gameMode:o.gameMode,group:o.group,intensity:o.intensity,action:o.action})).length===0&&await He(o)}catch(i){console.error("Error importing custom tile:",o,i)}if(n.customGroups!==void 0&&(await Ye(),await new Promise(o=>setTimeout(o,Ue)),n.customGroups&&n.customGroups.length>0))try{await Ve(n.customGroups)}catch(o){console.error("Error importing custom groups:",o)}if(n.gameBoards&&n.gameBoards.length>0)for(const o of n.gameBoards)await ur({title:o.title,tiles:o.tiles,tags:o.tags||[],gameMode:o.gameMode||"online",isActive:o.isActive||0});if(n.settings)try{const{updateSettings:o}=Z.getState(),i=n.settings;o(i)}catch(o){console.error("Error importing settings:",o)}return!0}catch(r){return console.error("Error syncing data:",r),!1}}let te=null;function Ge(e=5){J();const t=e*60*1e3;return te=window.setInterval(async()=>{const r=S();r.currentUser&&!r.currentUser.isAnonymous&&await ge()},t),!0}function J(){return te?(window.clearInterval(te),te=null,!0):!1}const Xe=rt.createContext(void 0);function wr(e){const[t,r]=A.useState(null),[s,n]=A.useState(!1),[o,i]=A.useState(!0),[c,a]=A.useState(null),[u,l]=A.useState({syncing:!1,lastSync:null}),d=A.useRef(null),w=A.useRef(!1),h=A.useCallback(async g=>{if(d.current&&(clearTimeout(d.current),d.current=null),!t||t.isAnonymous)return!1;try{return l({syncing:!0,lastSync:u.lastSync}),await g(),l({syncing:!1,lastSync:new Date}),!0}catch(f){return console.error("Sync error:",f),f instanceof Error?a(f.message):a("An unknown error occurred"),l({syncing:!1,lastSync:u.lastSync}),!1}},[t,d,l,u.lastSync,a]);async function T(g=""){try{const f=await Dt(g);return r(f),f}catch(f){const p=O(f);throw a(p),f}}async function m(g,f){try{n(!0);const p=await It(g,f);return r(p),p}catch(p){const P=O(p);throw a(P),p}finally{n(!1)}}async function b(){try{n(!0);const g=await Mt();return r(g),g}catch(g){const f=O(g);throw a(f),g}finally{n(!1)}}async function E(g,f,p){try{n(!0);const P=await _t(g,f,p);return r(P),P}catch(P){const k=O(P);throw a(k),P}finally{n(!1)}}async function y(g){try{return await Pt(g),!0}catch(f){const p=O(f);throw a(p),f}}const v=A.useCallback(async(g,f)=>{try{n(!0);const p=await xt(g,f);return r(p),await h(de),p}catch(p){throw p instanceof Error&&a(p.message),p}finally{n(!1)}},[n,r,h,a]);async function U(g=""){try{const f=await Ot(g);return r(f),f}catch(f){const p=O(f);throw a(p),f}}const G=A.useCallback(async()=>{try{if(t&&!t.isAnonymous){const g=h(de),f=new Promise(p=>setTimeout(p,5e3,!1));await Promise.race([g,f])}await Ut(),r(null)}catch(g){const f=O(g);throw a(f),g}},[t,h,r,a]),I=A.useCallback(async()=>{try{await Gt(),r(null),window.location.reload()}catch(g){const f=O(g);throw a(f),g}},[r,a]),be=A.useCallback(async()=>h(de),[h]);A.useEffect(()=>{const f=S().onAuthStateChanged(p=>{if(r(p||null),w.current||(w.current=!0,i(!1)),p&&!p.isAnonymous){const P=()=>{d.current&&clearTimeout(d.current),d.current=setTimeout(()=>{l({syncing:!0,lastSync:null});let k;try{k=ge?ge():Promise.resolve(!1)}catch(le){console.warn("syncDataFromFirebase is not available:",le),k=Promise.resolve(!1)}(!k||typeof k.then!="function")&&(k=Promise.resolve(!1)),k.then(()=>{l({syncing:!1,lastSync:new Date}),Ge&&Ge()}).catch(le=>{console.error("Error syncing from Firebase:",le),l({syncing:!1,lastSync:null})}).finally(()=>{d.current=null})},1e3)};typeof window<"u"&&"requestIdleCallback"in window?window.requestIdleCallback(P,{timeout:5e3}):setTimeout(P,100)}else J&&J()});return window.authContext={user:null},()=>{typeof f=="function"&&f(),d.current&&clearTimeout(d.current),J&&J(),window.authContext=void 0}},[]),A.useEffect(()=>{const g=window;g.authContext&&(g.authContext.user=t)},[t]);const Ze=A.useMemo(()=>({user:t,loading:s,initializing:o,error:c,syncStatus:u,login:T,loginEmail:m,loginGoogle:b,register:E,updateUser:U,forgotPassword:y,convertToRegistered:v,logout:G,wipeAllData:I,syncData:be,isAnonymous:t?.isAnonymous||!1}),[t,s,o,c,u,v,G,I,be]);return C.jsx(Xe.Provider,{value:Ze,...e})}const Ar=A.lazy(()=>z(()=>import("./index.tsx-Dp6942Zd.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8]))),vr=A.lazy(()=>z(()=>import("./chunk-D-1O0xjE.js").then(e=>e.i),__vite__mapDeps([9,4,1,2]))),Sr=A.lazy(()=>z(()=>import("./theme.tsx-tS6cOoiF.js"),__vite__mapDeps([3,1,2,4,5])).then(e=>({default:e.ThemeProvider}))),Tr=A.lazy(()=>z(()=>import("./chunk-BbfM-0nx.js").then(e=>e.m),__vite__mapDeps([10,4,1,2,11])).then(e=>({default:e.MigrationProvider}))),br=A.lazy(()=>z(()=>import("./schedule.tsx-CXUGcS16.js"),__vite__mapDeps([12,1,2,8,4,5])).then(e=>({default:e.ScheduleProvider})));function Er({children:e}){return C.jsx(A.Suspense,{fallback:C.jsx(me,{}),children:C.jsx(Tr,{children:C.jsx(br,{children:e})})})}function Cr(){const e=A.useContext(Xe);return!e||e.initializing?C.jsx(me,{}):C.jsx(A.Suspense,{fallback:C.jsx(me,{}),children:C.jsx(Sr,{children:C.jsx(Er,{children:C.jsx(Ar,{children:C.jsx(vr,{})})})})})}function Dr(){return C.jsx(wr,{children:C.jsx(Cr,{})})}const Vr=Object.freeze(Object.defineProperty({__proto__:null,default:Dr},Symbol.toStringTag,{value:"Module"}));export{Xe as A,rr as B,He as C,Jr as D,Yt as E,Wr as F,Gr as G,nr as H,Xt as I,Zt as J,Je as K,Wt as L,Qt as M,Kt as N,Vt as O,Rr as P,cr as Q,zr as R,Hr as S,ar as T,Yr as U,zt as V,Fr as W,jr as X,Vr as Y,Ur as a,Z as b,Jt as c,Br as d,ur as e,Nr as f,kr as g,$r as h,qr as i,Te as j,tr as k,Dt as l,Ht as m,It as n,_t as o,fr as p,Mt as q,Ke as r,Lr as s,sr as t,Qr as u,Or as v,ue as w,Se as x,or as y,$ as z};
