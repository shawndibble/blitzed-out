const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["js/syncOrchestrator.ts-DLUfLw_q.js","js/chunk-_xvgzIjF.js","js/chunk-BfQQtxh-.js","js/chunk-SYqHMm_j.js","js/chunk-BtkOrqEl.js","js/chunk-Chlk2IqA.js","assets/index-BuhAcGmB.js","assets/index-C3HF6PXQ.css"])))=>i.map(i=>d[i]);
!function(){try{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{}).SENTRY_RELEASE={id:"47d5037903a280397caffe30f0d6d4e09b38eadd"}}catch(t){}}();try{(e=(new(t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{}).Error).stack)&&(t._sentryDebugIds=t._sentryDebugIds||{},t._sentryDebugIds[e]="0a7eea1d-9e03-43dc-84bb-06e75939dc70",t._sentryDebugIdIdentifier="sentry-dbid-0a7eea1d-9e03-43dc-84bb-06e75939dc70")}catch(t){}var t,e;import{q as s,k as n,_ as a,s as r}from"./chunk-_xvgzIjF.js";import{a as i,b as c,d as o,u,e as d}from"../assets/index-BuhAcGmB.js";import{f as l,d as f,g as w,b as h,Q as y}from"./chunk-BtkOrqEl.js";import"./chunk-BfQQtxh-.js";import"./chunk-SYqHMm_j.js";import"./chunk-Chlk2IqA.js";const g=w(),p=d;async function m(){try{const t=await i({}),e=new Map;t.forEach(t=>{const s=`${t.group_id}|${t.intensity}|${t.action}`;e.has(s)||e.set(s,[]),e.get(s).push(t)});for(const[,s]of e)if(s.length>1){s.sort((t,e)=>(t.id||0)-(e.id||0));const t=s[0],e=s.slice(1),n=e.some(t=>0===t.isEnabled);for(const s of e)s.id&&await o(s.id);n&&1===t.isEnabled&&await u(t.id,{isEnabled:0})}return!0}catch(t){return!1}}async function b(){try{const t=(await s({isDefault:!1})).map(t=>r(t.id));return await Promise.all(t),!0}catch(t){return!1}}async function E(){try{const t=(await i({isCustom:0,isEnabled:0})).filter(t=>t.id).map(t=>u(t.id,{isEnabled:1}));return await Promise.all(t),!0}catch(t){return!1}}async function _(t){try{const e=await i({isCustom:0}),s=new Map;e.forEach(t=>{const e=`${t.group_id}|${t.intensity}|${t.action}`;s.set(e,t.id)});const n=[];return t.forEach(t=>{const e=`${t.group_id}|${t.intensity}|${t.action}`,a=s.get(e);a&&n.push(u(a,{isEnabled:0}))}),await Promise.all(n),!0}catch(e){return!1}}async function D(){const t=l().currentUser;if(!t)return!1;try{const e=await i({isCustom:1}),s=await i({isCustom:0,isEnabled:0}),n=100;return s.length>n&&s.splice(n),await y(f(g,"user-data",t.uid),{customTiles:e,disabledDefaults:s,lastUpdated:new Date},{merge:!0}),!0}catch(e){return!1}}async function $(){const t=l().currentUser;if(!t)return!1;try{const e=await s({isDefault:!1});return await y(f(g,"user-data",t.uid),{customGroups:e,lastUpdated:new Date},{merge:!0}),!0}catch(e){return!1}}async function U(){const t=l().currentUser;if(!t)return!1;try{const e=await c();return!e.length||(await y(f(g,"user-data",t.uid),{gameBoards:e,lastUpdated:new Date},{merge:!0}),!0)}catch(e){return!1}}async function j(){const t=l().currentUser;if(!t)return!1;try{const{settings:e}=n.getState(),{localPlayers:s,...a}=e,r=Object.fromEntries(Object.entries(a).filter(([,t])=>void 0!==t));return await y(f(g,"user-data",t.uid),{settings:r,lastUpdated:new Date},{merge:!0}),!0}catch(e){return!1}}async function T(){return await D(),await $(),await U(),await j(),!0}async function I(){const t=l().currentUser;if(!t)return{success:!1,conflicts:["No user logged in"]};try{const e=f(g,"user-data",t.uid),n=await h(e),a=await i({isCustom:1}),r=await s({isDefault:!1}),c=[];if(!n.exists())return await T(),{success:!0};const o=n.data(),u=o.customTiles||[],d=o.customGroups||[];return a.length>0&&u.length>0&&c.push(`Custom tiles: Local has ${a.length}, Firebase has ${u.length}`),r.length>0&&d.length>0&&c.push(`Custom groups: Local has ${r.length}, Firebase has ${d.length}`),c.length>0?{success:!1,conflicts:c}:{success:await k()}}catch(e){return{success:!1,conflicts:["Sync failed due to error"]}}}async function k(t={}){const{SyncOrchestrator:e}=await a(async()=>{const{SyncOrchestrator:t}=await import("./syncOrchestrator.ts-DLUfLw_q.js");return{SyncOrchestrator:t}},__vite__mapDeps([0,1,2,3,4,5,6,7]));return await e.syncFromFirebase(t)}let C=null;function O(t=5){S();const e=60*t*1e3;return C=window.setInterval(async()=>{const t=l();t.currentUser&&!t.currentUser.isAnonymous&&await k()},e),!0}function S(){return!!C&&(window.clearInterval(C),C=null,!0)}window.cleanupTiles=m;export{_ as applyDisabledDefaults,m as cleanupDuplicateTiles,b as clearUserCustomGroups,p as deleteAllCustomTiles,I as intelligentSync,E as resetDisabledDefaults,O as startPeriodicSync,S as stopPeriodicSync,T as syncAllDataToFirebase,$ as syncCustomGroupsToFirebase,D as syncCustomTilesToFirebase,k as syncDataFromFirebase,U as syncGameBoardsToFirebase,j as syncSettingsToFirebase};
//# sourceMappingURL=syncService.ts-DiSNjV7G.js.map
