const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["js/chunk-DeAq10ee.js","js/chunk-Br5bPOQU.js","js/chunk-DOZZTrKq.js","js/chunk--wdVmNJq.js","js/chunk-lKy0gUf9.js","js/chunk-C7vH9BKy.js","js/chunk-Dk7I1tJi.js","js/chunk-BxlihR_n.js","js/chunk-Tjtm3Awc.js","js/chunk-COViFSNc.js"])))=>i.map(i=>d[i]);
import{r as l,j as e,R as Wt,a as _,T as j,L as Dt,u as ae,c as nt,b as ce,p as Vt}from"./chunk-Br5bPOQU.js";import{u as de,i as G,C as qt,_ as q,A as J,c as H,d as Y,e as ee,f as st,g as it,l as Se,h as Ue,j as Jt,R as at,T as ue,k as ne,m as Oe,q as ot,Y as Ce,B as rt,I as We,S as Te,b as W,G as Le,r as Ee,s as lt,t as ct,v as dt,w as ut,x as xe,y as me,z as Re,M as ht,D as Ht,E as Yt,F as Xt,H as Qt,P as Zt,J as en,K as tn,L as nn,N as Pe,O as sn,Q as an}from"./chunk-DeAq10ee.js";import{A as on,B as rn,C as ln,o as te,D as xt,E as cn,F as mt,G as gt,H as pt,I as dn,J as un,K as Ye,L as hn,M as xn,N as mn,p as Ke,O as gn,n as De,P as jt,v as Ve,y as ft,Q as pn,q as yt,w as bt,R as Xe,S as vt,T as jn,U as fn,V as yn,W as bn,X as Qe,Y as vn,Z as Sn,_ as Cn,$ as Tn}from"./chunk-BxlihR_n.js";import{ak as kn,T as p,a2 as St,al as wn,B as w,b as V,I as se,am as An,a6 as qe,P as Mn,C as Ie,D as F,j as L,an as Rn,v as O,w as le,y as ge,i as D,ao as In,ap as $e,aq as Nn,ar as ze,N as he,as as Ln,_ as Ct,at as En,Y as Ge,F as _n,au as Bn,l as fe,m as ye,k as On,n as be,K as X,E as pe,H as ke,J as we,av as Pn,O as ie,V as Ae,h as Kn,a3 as Tt,a4 as je,aw as $n,L as kt,ax as zn,ay as Gn,az as Fn,aA as Un,aB as Wn,aC as Dn,aD as wt,aE as Vn,aF as qn,aG as Ze,p as Jn,aH as At,aI as Hn,aJ as Yn,aK as Xn,u as Mt,aL as Fe,a5 as Z,aM as Qn,aN as Rt,aO as Zn,aP as es,aQ as ts,aR as ns,aS as ss,aT as is,aU as as,aV as os,a8 as rs,X as ls,aW as cs,aX as ds,aY as us,aZ as hs,a_ as xs,a$ as ms,b0 as gs,b1 as ps,a0 as js,b2 as fs}from"./chunk--wdVmNJq.js";import{t as $,i as ys}from"./chunk-Dk7I1tJi.js";import{d as et}from"./chunk-lKy0gUf9.js";const It=l.createContext(void 0);function na(t){const{schedule:s,loadSchedule:i,flushPendingScheduleUpdates:n}=on(),a=l.useRef(null),o=l.useCallback(d=>{i(d)},[i]),c=l.useCallback(async(d,m,C)=>{try{const h=await rn(d,m,C);return n(),h}catch(h){throw console.error("Error adding to schedule:",h),h}},[n]),r=l.useCallback(()=>{a.current&&(a.current(),a.current=null),n()},[n]);l.useEffect(()=>(r(),a.current=ln(o),r),[o,r]),l.useEffect(()=>r,[r]);const u=l.useMemo(()=>({schedule:s,addToSchedule:c}),[s,c]);return e.jsx(It.Provider,{value:u,...t})}function Nt(){const t=Wt.useContext(It);if(!t)throw new Error("ScheduleContext's value is undefined.");return t}const bs="/img/blitzed-out-DGhYHOgx.png";function vs({playerList:t,innerRef:s,...i}){return e.jsxs("div",{...i,ref:s,children:[e.jsx(kn,{color:"success",sx:{fontSize:8,marginRight:"0.2rem"}}),t.length]})}const Ss=l.lazy(()=>q(()=>Promise.resolve().then(()=>zt),void 0)),Cs=l.lazy(()=>q(()=>Promise.resolve().then(()=>Wi),void 0));function tt(){return e.jsx(Ie,{size:16})}function Me({room:t,playerList:s=[]}){const{t:i}=_(),[n,a]=l.useState(!1),[o,c]=l.useState(!1),{schedule:r}=Nt(),u=de(),d=()=>{a(!0),c(!0)},m=e.jsxs(e.Fragment,{children:[e.jsx(p,{variant:"h6",children:e.jsx(j,{i18nKey:"online"})}),e.jsx("ul",{children:s.map(C=>e.jsx("li",{children:e.jsx(p,{variant:"body1",children:C.displayName})},C.uid))})]});return e.jsx(St,{position:"fixed",children:e.jsxs(wn,{disableGutters:!0,variant:"dense",component:"nav",className:"nav",children:[e.jsxs("div",{className:"site-name",children:[e.jsx(w,{component:"img",sx:{height:32},alt:"Blitzed Out Logo",src:bs}),e.jsx("h1",{children:"Blitzed Out"})]}),e.jsx("div",{children:e.jsxs("div",{className:"nav-room-name",children:[e.jsx("h2",{children:G(t)||t===void 0?i("public"):t}),e.jsx(V,{title:m,children:e.jsx(Lt,{playerList:s})}),e.jsx(se,{onClick:d,"aria-label":"schedule game",sx:{ml:2},children:e.jsx(An,{color:"primary",badgeContent:o?null:r.length,children:e.jsx(qe,{})})}),n&&e.jsx(Mn,{children:e.jsx(l.Suspense,{fallback:e.jsx(tt,{}),children:e.jsx(Ss,{open:n,close:()=>a(!1),isMobile:u})})})]})}),e.jsxs("div",{className:"menu-drawer",children:[e.jsx(qt,{}),e.jsx(l.Suspense,{fallback:e.jsx(tt,{}),children:e.jsx(Cs,{})})]})]})})}const Lt=l.forwardRef(({playerList:t,...s},i)=>e.jsx(vs,{playerList:t,...s,innerRef:i}));Lt.displayName="WrapPlayersOnline";const sa=Object.freeze(Object.defineProperty({__proto__:null,default:Me},Symbol.toStringTag,{value:"Module"}));function Et(){const[t,s]=l.useState("panel1"),i=n=>(a,o)=>{s(o?n:!1)};return e.jsxs(e.Fragment,{children:[e.jsxs(j,{i18nKey:"gameDesc",children:[e.jsx(p,{variant:"h4",sx:{textAlign:"center"},children:"Blitzed Out"}),e.jsx(F,{}),e.jsx(p,{variant:"body1",mt:2,children:"An online adult sex board game for kinky people. Designed for solo play, couples or parties."}),e.jsx(p,{variant:"body1",my:2,children:"Customize your own board or import someone else's, find your own room and play with other people online."})]}),e.jsxs(J,{expanded:t==="panel1",onChange:i("panel1"),children:[e.jsx(H,{"aria-controls":"panel1-content",id:"panel1-header",children:e.jsx(p,{children:e.jsx(j,{i18nKey:"gettingStartedTitle"})})}),e.jsx(Y,{children:e.jsxs(j,{i18nKey:"gettingStartedDescription",children:[e.jsxs("ul",{children:[e.jsx("li",{children:e.jsx(p,{variant:"body1",children:"Pick a display name"})}),e.jsx("li",{children:e.jsx(p,{variant:"body1",children:"Select your options. (append will add that option to other tiles)."})}),e.jsx("li",{children:e.jsx(p,{variant:"body1",children:"Save changes/Access game."})}),e.jsx("li",{children:e.jsx(p,{variant:"body1",children:"When it is your turn, click the roll button and follow the prompts."})})]}),e.jsx(p,{variant:"body1",mt:2,children:"New player suggestion: Limit your selections to less than 4 total options."}),e.jsx(p,{variant:"body1",mt:2,children:"Don't like your current board or some aspect of the game? Go to Menu, then Settings and change it. Utilize custom tiles to make the game even more your own."})]})})]}),e.jsxs(J,{expanded:t==="panel2",onChange:i("panel2"),children:[e.jsx(H,{"aria-controls":"panel2-content",id:"panel2-header",children:e.jsx(p,{children:e.jsx(j,{i18nKey:"couplesTitle"})})}),e.jsx(Y,{children:e.jsxs(j,{i18nKey:"couplesDescription",children:[e.jsx(p,{variant:"body1"}),e.jsx(p,{variant:"body1",sx:{mt:2}}),e.jsx(p,{variant:"body1",sx:{mt:2}})]})})]}),e.jsxs(J,{expanded:t==="panel3",onChange:i("panel3"),children:[e.jsx(H,{"aria-controls":"panel3-content",id:"panel3-header",children:e.jsx(p,{children:e.jsx(j,{i18nKey:"coachTitle"})})}),e.jsx(Y,{children:e.jsxs(j,{i18nKey:"coachDescription",children:[e.jsx(p,{variant:"body1"}),e.jsx(p,{variant:"body1",sx:{mt:2}})]})})]}),e.jsxs(J,{expanded:t==="panel4",onChange:i("panel4"),children:[e.jsx(H,{"aria-controls":"panel4-content",id:"panel4-header",children:e.jsx(p,{children:e.jsx(j,{i18nKey:"bugsTitle"})})}),e.jsx(Y,{children:e.jsx(p,{variant:"body1",children:e.jsx(j,{i18nKey:"bugsDescription",children:e.jsx(Dt,{className:"discord-link",to:"https://discord.gg/5dCH2WVsmX",target:"_blank",children:"Discord server"})})})})]})]})}const Ts=Object.freeze(Object.defineProperty({__proto__:null,default:Et},Symbol.toStringTag,{value:"Module"}));function ks(){const{i18n:t,t:s}=_(),{login:i,user:n}=ee(),[a,o]=l.useState(!1),[c,r]=l.useState("login"),u=()=>{r("login"),o(!0)},d=()=>{r("register"),o(!0)},m=ae(),[C]=nt(),h=!!C.get("importBoard"),x=m.id??"PUBLIC",f=st(),T=de("sm"),[g,y]=l.useState(n?.displayName||""),[M,A]=te(),S=l.useCallback(async k=>{k.preventDefault(),await A({...M,displayName:g,room:x}),await i(g)},[g,i,x,M,A]),b=l.useCallback(async k=>{k.key==="Enter"&&await S(k)},[S]),v=l.useMemo(()=>Object.entries(xt).map(([k,R])=>e.jsx(L,{onClick:()=>t.changeLanguage(k),disabled:t.resolvedLanguage===k,children:R.label},k)),[t]);return e.jsxs(e.Fragment,{children:[e.jsx(Me,{room:x,playerList:f}),e.jsxs(Rn,{maxWidth:"sm",sx:{mt:8},children:[e.jsx(O,{container:!0,flexDirection:"column",children:e.jsx(le,{className:"unauthenticated-card",children:e.jsxs(ge,{children:[e.jsx("h2",{className:"setup",children:e.jsx(j,{i18nKey:"setup"})}),e.jsxs(w,{component:"form",method:"post",onSubmit:S,className:"settings-box",children:[e.jsx(D,{fullWidth:!0,id:"displayName",label:s("displayName"),value:g,onChange:k=>y(k.target.value),required:!0,autoFocus:!0,onKeyDown:k=>b(k),margin:"normal"}),e.jsx(L,{variant:"contained",type:"submit",sx:{mr:1},fullWidth:!0,children:h?e.jsx(j,{i18nKey:"import"}):e.jsx(j,{i18nKey:"anonymousLogin"})}),e.jsx(F,{sx:{my:2},children:e.jsx(p,{variant:"body2",color:"text.secondary",children:e.jsx(j,{i18nKey:"or",children:"OR"})})}),e.jsxs(w,{sx:{display:"flex",justifyContent:"space-evenly"},children:[e.jsx(L,{variant:"outlined",startIcon:e.jsx(In,{}),onClick:u,sx:{mr:1},children:e.jsx(j,{i18nKey:"signIn"})}),e.jsx(L,{variant:"outlined",onClick:d,children:e.jsx(j,{i18nKey:"createAccount"})})]})]})]})})}),e.jsx(O,{container:!0,sx:{mt:1},children:e.jsx(O,{className:"language",children:e.jsx(le,{className:"unauthenticated-card",children:e.jsxs(ge,{className:"translation-card-content",children:[!T&&e.jsx($e,{sx:{mr:1}}),e.jsxs(p,{sx:{mr:1},children:[e.jsx(j,{i18nKey:"language"}),":"]}),v]})})})}),e.jsx(O,{container:!0,sx:{mt:1},children:e.jsx(O,{className:"language",children:e.jsx(le,{className:"unauthenticated-card",children:e.jsx(ge,{children:e.jsx(Et,{})})})})})]}),e.jsx(it,{open:a,close:()=>o(!1),initialView:c})]})}const ia=Object.freeze(Object.defineProperty({__proto__:null,default:ks},Symbol.toStringTag,{value:"Module"}));function ws(t){const s=Se(t,"room");let i=!1,n="";if(s){const{roomBackgroundURL:a}=JSON.parse(s.settings),o=cn(a);o?.isVideo&&(i=o.isVideo),o?.url&&(n=o.url)}return["color","gray"].some(a=>n.includes(a))&&(n=""),{isVideo:i,url:n}}function As(){const[t,s]=l.useState(document.fullscreenElement!=null);l.useEffect(()=>{const n=()=>{s(document.fullscreenElement!=null)};return document.addEventListener("fullscreenchange",n),()=>{document.removeEventListener("fullscreenchange",n)}},[]);const i=l.useCallback(()=>{document.fullscreenElement==null?document.documentElement.requestFullscreen().catch(n=>{console.error("Error attempting to enable fullscreen:",n)}):document.exitFullscreen().catch(n=>{console.error("Error attempting to exit fullscreen:",n)})},[]);return{isFullscreen:t,toggleFullscreen:i}}const Ms="actions",Rs=t=>{const{text:s,displayName:i}=t;if(!i)return{};const n=s?.split(`
`),[a,o]=n?.slice(1)||[],c=a?.split(":")[1]?.trim(),r=o?.split(":")[1]?.trim();return{displayName:i,type:c,activity:r}};function Is(){const{id:t}=ae(),{messages:s,isLoading:i}=Ue(),[n,a]=l.useState(""),[o,c]=l.useState(!1),[r,u]=l.useState(!1),{isVideo:d,url:m}=ws(s),C=Se(s,Ms),h=Jt(C),{isFullscreen:x,toggleFullscreen:f}=As();if(l.useEffect(()=>{const M=window.cast?.framework?.CastReceiverContext;return M&&(document.body.classList.add("cast-receiver-mode"),u(!0)),()=>{M&&document.body.classList.remove("cast-receiver-mode")}},[]),l.useEffect(()=>{if(i)return;const M=s[s.length-1];M?.type==="settings"&&(c(!0),a(`${M.displayName} ${$("changedSettings")}`))},[s,i]),!C)return null;const{displayName:T,type:g,activity:y}=Rs(C);return e.jsxs(w,{className:"flex-column",children:[!!m&&e.jsx(at,{url:m,isVideo:d}),e.jsxs(w,{display:"flex",justifyContent:"space-between",sx:{mx:2,mt:2,mb:-2},children:[e.jsx(w,{flex:"1",children:!r&&!x&&e.jsx(L,{variant:"text",onClick:f,children:"Fullscreen"})}),e.jsx(w,{textAlign:"center",flex:"1",children:!!h?.displayName&&e.jsx(p,{variant:"h4",children:e.jsx(j,{i18nKey:"nextPlayersTurn",values:{player:h.displayName}})})},h?.displayName),e.jsx(w,{flex:"1",textAlign:"right",className:"text-stroke",children:y&&e.jsxs(p,{variant:"h4",children:["blitzedout.com/",t]})})]}),e.jsx(O,{container:!0,spacing:0,direction:"column",alignItems:"center",justifyContent:"center",className:"cast-container",children:e.jsx(O,{container:!0,justifyContent:"center",children:y?e.jsxs(O,{size:12,className:"action-box",children:[e.jsx(p,{variant:"h3",children:`${g} ${$("for")} ${T}`}),e.jsx(w,{className:"divider",children:e.jsx(F,{})}),e.jsx(p,{variant:"h1",children:y})]}):e.jsx("div",{className:"action-box",children:e.jsxs(p,{variant:"h1",children:["blitzedout.com/",t]})})})},s.length),e.jsx(ue,{open:!!o,close:()=>c(!1),hideCloseButton:!0,children:e.jsx(p,{variant:"h5",children:n})})]})}const aa=Object.freeze(Object.defineProperty({__proto__:null,default:Is},Symbol.toStringTag,{value:"Module"}));function Ns(t){if(t.match(/\[|\]/g)?.length!==2)throw new Error("ctSeparatorError")}function Ls(t,s){const i=t?.sort()||[],n=s?.sort()||[];return JSON.stringify(i)===JSON.stringify(n)}function Es(t,s){const i=t.split(`
`).filter(Boolean),n=i[0],a=i[1],c=i.find(f=>f.startsWith("Tags:"))?.replace("Tags:","")?.trim()?.split(", ")?.filter(Boolean)||[],u=i.find(f=>f.startsWith("GameMode:"))?.replace("GameMode:","")?.trim()||"online",d=n.replace(/\[|\]/g,""),[m,C]=d.split(" - "),x=ne(s[u]||{}).find(f=>f.translatedIntensity===C&&f.group===m);if(!x)throw new Error("ctGroupError");if(!a)throw new Error("ctActionError");return{group:x.value,intensity:x.intensity,action:a,tags:c,gameMode:u,isCustom:1}}function _s(t,s,i){const n=t?.split("---")||[];n.forEach(Ns);const a=n.map(r=>Es(r,i)).filter(Boolean),o=[],c=[];return a.forEach(r=>{const u=s.find(d=>d.group===r.group&&d.intensity===r.intensity&&d.action===r.action&&d.gameMode===r.gameMode);u?u&&!Ls(u.tags,r.tags)&&c.push({...u,tags:r.tags}):o.push(r)}),{newUniqueRecords:o,changedTagRecords:c}}function Bs({expanded:t,handleChange:s,customTiles:i,mappedGroups:n,setSubmitMessage:a,bulkImport:o}){const c=l.useRef(null),{t:r}=_(),[u,d]=l.useState(""),m=l.useCallback(()=>{const x=i.filter(f=>f.isCustom).map(({group:f,intensity:T,action:g,tags:y,gameMode:M="online"})=>{const S=ne(n[M]||{}).find(v=>v?.intensity===Number(T)&&v?.value===f);let b="";return b+=`[${S?.group||f} - ${S?.translatedIntensity||T}]
`,b+=g,b+=y?.length?`
Tags: `+y?.join(", "):"",b+=`
GameMode: ${M}`,b});d(x.join(`
---
`))},[i,n,d]);async function C(h){if(!h.current)return;const f=h.current.importData.value;let T=[],g=[];try{const{newUniqueRecords:y,changedTagRecords:M}=_s(f,i,n);T=y,g=M}catch(y){if(y instanceof Error)return a({type:"error",message:r(y.message)})}return!T.length&&!g.length?a({type:"error",message:r("ctNoNewError")}):(T.length&&(T.forEach(async y=>{mt(`${y.group} - ${y.intensity}`,y.action)}),o(T)),g.length&&await Promise.all(g.map(async y=>{y.id!==void 0&&await gt(y.id,y)})),m())}return l.useEffect(()=>{t==="ctImport"&&m()},[t,i,m]),e.jsxs(J,{expanded:t==="ctImport",onChange:s("ctImport"),children:[e.jsx(H,{"aria-controls":"ctImport-content",id:"ctImport-header",children:e.jsx(p,{children:e.jsx(j,{i18nKey:"importExport"})})}),e.jsxs(Y,{children:[e.jsx(p,{variant:"body1",sx:{mb:2},children:e.jsx(j,{i18nKey:"ctImportDescription"})}),e.jsxs(w,{component:"form",method:"post",ref:c,children:[e.jsx(D,{id:"importData",name:"importData",multiline:!0,required:!0,fullWidth:!0,sx:{pb:2},value:u,onChange:h=>d(h.target.value),InputProps:{endAdornment:e.jsx(Oe,{text:u}),sx:{alignItems:"flex-start"}}}),e.jsx(L,{fullWidth:!0,variant:"contained",type:"button",onClick:()=>C(c),children:e.jsx(j,{i18nKey:"import"})})]})]})]})}function Os({setSubmitMessage:t,boardUpdated:s,customTiles:i,mappedGroups:n,expanded:a,handleChange:o,tagList:c,updateTileId:r,setUpdateTileId:u}){const{t:d}=_(),{settings:m}=pt(),[C,h]=l.useState({gameMode:m.gameMode||"online",group:"",intensity:"",action:"",tags:[d("custom")]}),[x,f]=l.useState({});l.useEffect(()=>{try{const S={};n[C.gameMode]&&ne(n[C.gameMode]).forEach(v=>{const{value:k,label:R,intensity:I}=v;S[k]||(S[k]={label:R,intensities:{}}),I!==void 0&&(S[k].intensities[I]=1)}),f(S),setTimeout(()=>{h(b=>{if(!b.group||!S[b.group]){const v=Object.keys(S)[0];let k="";return v&&S[v]&&Object.keys(S[v].intensities).length>0&&(k=Number(Object.keys(S[v].intensities)[0])),{...b,group:b.group||v||"",intensity:C.intensity||k||""}}return b})},0)}catch(S){console.error("Error processing groups:",S),f({})}},[C.gameMode,n]),l.useEffect(()=>{const b=(Array.isArray(i)?i:[]).find(({id:v})=>v===r);if(b){const v=b.gameMode||m.gameMode;h({gameMode:v,group:b.group||"",intensity:b.intensity||"",action:b.action||"",tags:b.tags||[d("custom")]})}else h(v=>({...v,gameMode:m.gameMode}))},[r,m.gameMode,i,d]);function T(S,b,v){return(Array.isArray(i)?i:[]).find(R=>R.group===S&&R.intensity===b&&R.action===v)}function g(){u(null),h({gameMode:m.gameMode,group:C.group||"alcohol",intensity:C.intensity||1,action:"",tags:[d("custom")]})}async function y(){const S=document.querySelector('input[name="tags"]'),b=[...C.tags];S&&S.value.trim()&&(b.push(S.value.trim()),S.value="");const{gameMode:v,group:k,intensity:R,action:I}=C;if(!v||!k||!R||!I)return t({message:d("allFieldsRequired","All fields are required"),type:"error"});if(r==null&&T(k,R,I))return t({message:d("actionExists"),type:"error"});const E={group:k,intensity:Number(R),action:I,tags:b,gameMode:v,isCustom:1};if(r===null){let K=`${k} - Level ${R}`;if(Array.isArray(ne(n?.[v]))){const B=ne(n[v]).find(U=>U.value===k&&U.intensity===Number(R));B?.label&&(K=B.label)}mt(K,I),dn(E)}else gt(r,E);return s(),h(K=>({...K,action:"",tags:[d("custom")]})),t({message:d("customAdded"),type:"success"})}const M=S=>{switch(S.key){case",":case"Enter":{S.preventDefault(),S.stopPropagation(),S.currentTarget.value.length>0&&(h(b=>({...b,tags:[...b.tags,S.currentTarget.value]})),S.currentTarget.value="");break}}},A=S=>{S.target.value.length>0&&(h(b=>({...b,tags:[...b.tags,S.target.value]})),S.target.value=""),setTimeout(()=>{const b=document.querySelector(".MuiAutocomplete-popper");b&&(b.style.display="none")},150)};return e.jsxs(J,{expanded:a==="ctAdd",onChange:o("ctAdd"),children:[e.jsx(H,{"aria-controls":"ctAdd-content",id:"ctAdd-header",children:e.jsx(p,{children:e.jsx(j,{i18nKey:r?"ctUpdate":"ctAdd"})})}),e.jsx(Y,{children:e.jsxs(w,{component:"form",method:"post",className:"settings-box",children:[e.jsx(ot,{gameMode:C.gameMode,groupFilter:C.group,intensityFilter:C.intensity,groups:x,mappedGroups:n,onGameModeChange:S=>{h(b=>({...b,gameMode:S,group:"",intensity:""}))},onGroupChange:S=>{h(b=>({...b,group:S,intensity:""}))},onIntensityChange:S=>{h(b=>({...b,intensity:Number(S)}))},hideAll:!0,sx:{mb:2}}),e.jsx(D,{id:"action",name:"action",required:!0,fullWidth:!0,label:d("action"),sx:{pb:2},value:C.action,onChange:S=>{h({...C,action:S.target.value})}}),e.jsx(Nn,{id:"tags",disableCloseOnSelect:!0,multiple:!0,freeSolo:!0,options:c,value:C.tags,onChange:(S,b)=>{h({...C,tags:b})},renderInput:S=>(S.inputProps.onKeyDown=M,S.inputProps.onBlur=A,e.jsx(D,{...S,label:d("tags")})),sx:{pb:2},clearOnBlur:!0,blurOnSelect:!0,openOnFocus:!0,disablePortal:!1,componentsProps:{popper:{modifiers:[{name:"preventOverflow",options:{altAxis:!0,altBoundary:!0,padding:8}}]}}}),e.jsxs(w,{display:"flex",justifyContent:"space-evenly",children:[e.jsx(L,{variant:"contained",type:"button",onClick:()=>g(),children:e.jsx(j,{i18nKey:"clear"})}),e.jsx(L,{variant:"contained",type:"button",onClick:y,children:e.jsx(j,{i18nKey:r?"ctUpdate":"ctAdd"})})]})]})})]})}function Ps({expanded:t,handleChange:s}){return e.jsxs(e.Fragment,{children:[e.jsxs(J,{expanded:t==="help1",onChange:s("help1"),children:[e.jsx(H,{"aria-controls":"help1-content",id:"help1-header",children:e.jsx(p,{children:e.jsx(j,{i18nKey:"ctExplained"})})}),e.jsx(Y,{children:e.jsxs(j,{i18nKey:"ctExplainedDescription",children:[e.jsx(p,{sx:{mb:2},children:"Custom tiles let you add your own variations to the game board. Utilize this dialog to add and remove tiles as you see fit."}),e.jsx(p,{sx:{mb:2},children:"Custom tiles are added based on the kink and intensity you pick from the drop down. As such, you need to have that kink and intensity (or a higher intensity) selected for your custom tiles to show on the board."}),e.jsx(p,{children:"Miscellaneous tiles are the only exception to the above. Regardless of what other options you pick, Miscellaneous tiles will show as their own group. If you use this option, ensure that you add multiple tiles to minimize repeats."})]})})]}),e.jsxs(J,{expanded:t==="help2",onChange:s("help2"),children:[e.jsx(H,{"aria-controls":"help2-content",id:"help2-header",children:e.jsx(p,{children:e.jsx(j,{i18nKey:"ctIdeas"})})}),e.jsx(Y,{children:e.jsxs(j,{i18nKey:"ctIdeasDescription",children:[e.jsx(p,{variant:"h6",children:"Add new Activities"}),e.jsx(p,{variant:"subtitle2",sx:{mb:2},children:"Come up with new activities that are not part of the existing list"}),e.jsx(p,{variant:"h6",children:"Add harder tiles to easier intensities"}),e.jsx(p,{variant:"subtitle2",sx:{mb:1},children:"When you pick higher intensity levels, the game will use the earlier intensity level and gradual move to whatyou picked. If you want harder tiles early on, add several to lower intensities."}),e.jsx(p,{variant:"subtitle2",sx:{mb:2},children:"Example: You play Poppers - Advanced. Add advanced tiles to Poppers - Beginner"}),e.jsx(p,{variant:"h6",children:"Combine activities into a single tile"}),e.jsx(p,{variant:"subtitle2",sx:{mb:1},children:"Combine multiple activites together in a single tile that normally would not go together."}),e.jsx(p,{variant:"subtitle2",sx:{mb:2},children:"Example: Spit roast. Use a toy in your throat and ass at the same time."}),e.jsx(p,{variant:"h6",children:"Miscellaneous custom tiles"}),e.jsx(p,{variant:"subtitle2",sx:{mb:1},children:"Miscellaneous tiles allow you to add your own tiles without including other groups. Be aware, you will want to add several options to this group to minimize repeats."})]})})]})]})}function Ks({tagList:t,boardUpdated:s,mappedGroups:i,updateTile:n,refreshTrigger:a}){const{t:o,i18n:c}=_(),{settings:r}=pt(),[u,d]=l.useState(null),[m,C]=l.useState(r.gameMode||"online"),[h,x]=l.useState(""),[f,T]=l.useState(""),[g,y]=l.useState(1),[M,A]=l.useState(!0),[S,b]=l.useState({items:[],total:0,totalPages:1}),[v,k]=l.useState({}),R=10;l.useEffect(()=>{async function N(){try{A(!0);const P=await un(c.resolvedLanguage,m,u);k(P);const z=Object.keys(P),oe=z.includes(h);(!h||!oe)&&z.length>0?(x(z[0]),T("all")):oe&&f!=="all"&&(Object.keys(P[h]?.intensities||{}).includes(String(f))||T("all"))}catch(P){console.error("Error loading groups:",P)}finally{A(!1)}}N()},[m,c.resolvedLanguage,u,h,f]),l.useEffect(()=>{let N=!0;async function P(){try{A(!0);const z={group:h,intensity:f==="all"?null:Number(f),tag:u,gameMode:m,locale:r.locale,page:g,limit:R,paginated:!0},oe=await Ye(z);N&&(b(oe),setTimeout(()=>{N&&A(!1)},300))}catch(z){console.error("Error loading tiles:",z),N&&A(!1)}}return h?P():A(!1),()=>{N=!1}},[h,f,u,m,g,R,a,r.locale]);function I(N){A(!0),d(u===N?null:N)}function E(N,P){A(!0),y(P)}async function K(N){await hn(N),s();const P={group:h,intensity:f==="all"?null:f,tag:u,gameMode:m,locale:r.locale,page:g,limit:R,paginated:!0},z=await Ye(P);b(z)}async function B(N){await xn(N),s(),b(P=>({...P,items:P.items.map(z=>z.id===N?{...z,isEnabled:!z.isEnabled}:z)}))}function U(N){n(N);const P=document.querySelector(".MuiDialogContent-root");P&&(P.scrollTop=0)}const Ne=S.items?.map(({id:N,group:P,intensity:z,action:oe,tags:He,isEnabled:Gt=!0,isCustom:Ft=!0})=>e.jsxs(le,{sx:{my:2},children:[e.jsx(ze,{title:oe,slotProps:{title:{variant:"body1"},subheader:{variant:"body2"},action:{"aria-label":o("customTiles.actions")}},subheader:i?.[m]&&Array.isArray(ne(i[m]))?ne(i[m]).find(({value:ve,intensity:Ut})=>ve===P&&Ut===Number(z))?.label:`${P} - Level ${z}`,action:e.jsxs(e.Fragment,{children:[e.jsx(he,{checked:!!Gt,onChange:()=>N!==void 0&&B(N),slotProps:{input:{"aria-label":o("customTiles.toggleTile")}}}),!!Ft&&e.jsxs(e.Fragment,{children:[e.jsx(se,{onClick:()=>N!==void 0&&U(N),"aria-label":o("customTiles.update"),children:e.jsx(Ln,{})}),e.jsx(se,{onClick:()=>N!==void 0&&K(N),"aria-label":o("customTiles.delete"),children:e.jsx(Ct,{})})]})]}),sx:{pb:0}}),e.jsx(En,{children:He?.map(ve=>e.jsx(Ge,{label:ve,sx:{m:.5}},ve))})]},N));return e.jsxs(w,{children:[e.jsx(w,{children:t?.map(N=>e.jsx(Ge,{label:N,sx:{m:.5},color:u===N?"primary":"default",onClick:()=>I(N)},N))}),e.jsx(w,{sx:{display:"flex",flexDirection:"column",gap:2,my:2,transition:"all 0.3s ease-in-out"},children:e.jsx(ot,{gameMode:m,groupFilter:h,intensityFilter:f,groups:v,mappedGroups:i,onGameModeChange:N=>{C(N),x(""),T(""),y(1)},onGroupChange:N=>{x(N),y(1)},onIntensityChange:N=>{T(N),y(1)}})}),e.jsxs(w,{sx:{position:"relative",minHeight:"200px"},children:[e.jsx(_n,{in:M,timeout:300,children:e.jsx(w,{sx:{position:"absolute",top:0,left:0,right:0,bottom:0,display:"flex",justifyContent:"center",alignItems:"center",backgroundColor:"rgba(255, 255, 255, 0)",zIndex:1,borderRadius:1},children:e.jsx(Ie,{})})}),e.jsx(w,{sx:{opacity:M?.3:1,transition:"opacity 0.3s ease-in-out",pointerEvents:M?"none":"auto"},children:S.items.length===0?e.jsx(p,{variant:"body1",sx:{textAlign:"center",my:4},children:e.jsx(j,{i18nKey:"customTiles.noTilesFound",children:"No tiles found with the selected filters."})}):e.jsxs(e.Fragment,{children:[Ne,S.totalPages>1&&e.jsx(w,{sx:{display:"flex",justifyContent:"center",mt:3,mb:2},children:e.jsx(Bn,{count:S.totalPages,page:g,onChange:E,color:"primary"})}),e.jsx(p,{variant:"body2",sx:{textAlign:"center",mt:2,color:"text.secondary"},children:e.jsxs(j,{i18nKey:"customTiles.showingTiles",values:{shown:S.items.length,total:S.total},children:["Showing ",{shown:S.items.length}," of ",{total:S.total}," tiles"]})})]})})]})]})}function $s({boardUpdated:t,setOpen:s,open:i=!1}){const{t:n,i18n:a}=_(),o=de(),c=de("md"),[r,u]=l.useState({message:"",type:"info"}),[d,m]=l.useState("ctAdd"),[C,h]=l.useState(null),[x,f]=l.useState(0),[T,g]=l.useState({online:{},local:{},solo:{}}),[y,M]=l.useState(!0),A=l.useCallback(()=>{f(I=>I+1)},[]),S=I=>(E,K)=>{m(K?I:"")};l.useEffect(()=>{async function I(){M(!0);try{const[E,K]=await Promise.all([Ke(a.resolvedLanguage,"online"),Ke(a.resolvedLanguage,"local")]);g({online:E,local:K,solo:{}})}catch(E){console.error("Error loading game mode actions:",E)}finally{M(!1)}}I()},[a.resolvedLanguage]);const b=ce(()=>gn({locale:a.resolvedLanguage})),v=l.useMemo(()=>b?Array.isArray(b)?b.map(({tags:I})=>I).flat().filter((I,E,K)=>I&&K.indexOf(I)===E).sort():[]:[],[b]),k=l.useCallback(async I=>{await mn(I),t(),A()},[t,A]);if(!b||y)return null;const R=()=>{const I=e.jsxs(e.Fragment,{children:[e.jsx(Ps,{expanded:d,handleChange:S}),e.jsx(Os,{setSubmitMessage:u,boardUpdated:()=>{t(),A()},customTiles:b,mappedGroups:T,expanded:d,handleChange:S,tagList:v,updateTileId:C,setUpdateTileId:h}),e.jsx(Bs,{expanded:d,handleChange:S,customTiles:b,mappedGroups:T,setSubmitMessage:u,bulkImport:k})]}),E=Array.isArray(b)&&b.length>0&&e.jsx(w,{children:e.jsx(Ks,{tagList:v,boardUpdated:()=>{t(),A()},mappedGroups:T,updateTile:K=>{h(K),m("ctAdd")},refreshTrigger:x})});return c?e.jsxs(e.Fragment,{children:[I,E&&e.jsxs(e.Fragment,{children:[e.jsx(F,{sx:{my:2}}),E]})]}):e.jsxs(O,{container:!0,spacing:2,children:[e.jsx(O,{size:{xs:12,md:6},children:I}),e.jsx(O,{size:{xs:12,md:6},children:E})]})};return e.jsxs(e.Fragment,{children:[e.jsxs(fe,{fullScreen:o,open:i,onClose:()=>s(!1),maxWidth:c?"sm":"lg",fullWidth:!0,children:[e.jsxs(ye,{children:[e.jsx(j,{i18nKey:"manageTiles"}),e.jsx(se,{"aria-label":n("close"),onClick:()=>s(!1),sx:{position:"absolute",right:8,top:8,color:I=>I.palette.grey[500]},children:e.jsx(On,{})})]}),e.jsx(be,{children:R()})]}),e.jsx(ue,{open:!!r.message,close:()=>u({message:"",type:"info"}),type:r.type,children:r.message})]})}function zs({boardUpdated:t}){const{i18n:s}=_(),[i,n]=l.useState(s.resolvedLanguage||"en");function a(c){n(c),s.changeLanguage(c),t()}const o=Object.entries(xt).map(([c,r])=>e.jsx(X,{value:c,children:r.label},c));return e.jsx(w,{sx:{minWidth:120,mt:1,mb:2},children:e.jsxs(pe,{fullWidth:!0,children:[e.jsxs(ke,{id:"language-label",sx:{display:"flex",alignItems:"center"},children:[e.jsx($e,{sx:{mr:1}}),e.jsx(j,{i18nKey:"language"})]}),e.jsx(we,{labelId:"language-label",id:"language-select",value:i,label:e.jsxs(e.Fragment,{children:[e.jsx($e,{}),e.jsx(j,{i18nKey:"language"})]}),onChange:c=>a(c.target.value),children:o})]})})}function Q({field:t,formData:s,handleSwitch:i}){return e.jsx(Ce,{trueCondition:s[t],onChange:n=>i(n,t),yesLabel:`${t}Enable`,sx:{justifyContent:"left"}})}function Gs({formData:t,setFormData:s,boardUpdated:i}){const[n,a]=te(),{t:o}=_(),c={color:o("color"),gray:o("gray"),"metronome.gif":o("hypnoDick"),"pink-spiral.gif":o("pinkSpiral"),custom:o("customURL")};function r(u,d){s({...t,[d]:u.target.checked}),a({...n,[d]:u.target.checked})}return e.jsxs(e.Fragment,{children:[e.jsx(zs,{boardUpdated:i}),e.jsx(p,{variant:"h5",children:e.jsx(j,{i18nKey:"dialog"})}),e.jsx(Q,{field:"playerDialog",formData:t,handleSwitch:r}),e.jsx(Q,{field:"othersDialog",formData:t,handleSwitch:r}),e.jsx(F,{}),e.jsx(p,{variant:"h5",sx:{mt:2},children:e.jsx(j,{i18nKey:"sounds"})}),e.jsx(Q,{field:"mySound",formData:t,handleSwitch:r}),e.jsx(Q,{field:"otherSound",formData:t,handleSwitch:r}),e.jsx(Q,{field:"chatSound",formData:t,handleSwitch:r}),e.jsx(Q,{field:"readRoll",formData:t,handleSwitch:r}),e.jsx(F,{}),e.jsx(p,{variant:"h5",sx:{mt:2,textTransform:"capitalize"},children:e.jsx(j,{i18nKey:"misc"})}),e.jsx(Q,{field:"hideBoardActions",formData:t,handleSwitch:r}),e.jsx(Q,{field:"advancedSettings",formData:t,handleSwitch:r}),e.jsx(rt,{formData:t,setFormData:s,backgrounds:c}),e.jsx(F,{})]})}function Fs({formData:t,setFormData:s}){const i=(a,o)=>{s({...t,finishRange:o,boardUpdated:!0})},n=t?.finishRange||[30,70];return e.jsxs(w,{children:[e.jsx(F,{}),e.jsx(p,{id:"finish-slider",sx:{my:1},children:e.jsx(j,{i18nKey:"finishSlider"})}),e.jsx(Pn,{"aria-labelledby":"finish-slider",value:n,onChange:i,valueLabelDisplay:"off"}),e.jsxs(w,{display:"flex",flexDirection:"column",justifyContent:"space-between",textAlign:"center",children:[e.jsxs(p,{whiteSpace:"nowrap",children:[e.jsx(j,{i18nKey:"noCum"})," ",n[0],"%"]}),e.jsxs(p,{whiteSpace:"nowrap",children:[e.jsx(j,{i18nKey:"ruined"})," ",n[1]-n[0],"%"]}),e.jsxs(p,{whiteSpace:"nowrap",children:[e.jsx(j,{i18nKey:"cum"})," ",100-n[1],"%"]})]}),e.jsx(F,{sx:{my:1}})]})}function Us({option:t,settings:s,setSettings:i,actionsFolder:n,type:a,showVariation:o=!1,showRole:c=!1}){const{t:r}=_(),u=`${t}label`,d=n[t]?.label;function m(x,f,T){i({...s,[f]:{...s[f],type:a,[T]:x?.target?.value},boardUpdated:!0})}let C=12;(o||c)&&(C=6);let h=["dom","vers","sub"];return n[t]?.dom&&(h=[{label:n[t].dom,value:"dom"},{label:r("vers"),value:"vers"},{label:n[t].sub,value:"sub"}]),e.jsxs(O,{container:!0,justifyContent:"center",children:[e.jsx(O,{size:C,children:e.jsx(We,{actionsFolder:n,settings:s,option:t,onChange:x=>m(x,t,"level")})}),!!c&&e.jsx(O,{size:6,children:e.jsx(Te,{sx:{ml:1},value:s[t]?.role,onChange:x=>m(x,t,"role"),label:`${r("role")}: ${d}`,options:h,defaultValue:s.role||"sub"})}),!!o&&e.jsx(O,{size:6,children:e.jsx(V,{placement:"top",title:e.jsxs(j,{i18nKey:"variationTooltip",children:[e.jsx(p,{variant:"subtitle2",children:"Standalone = Its own tile. "}),e.jsx(p,{variant:"subtitle2",children:"Append Some = 50% chance."}),e.jsx(p,{variant:"subtitle2",children:"Append Most = 90% chance."})]}),arrow:!0,children:e.jsxs(pe,{fullWidth:!0,margin:"normal",sx:{ml:1},children:[e.jsxs(ke,{id:`${u}Variation`,children:[`${d} ${r("variation")}`,e.jsx(ie,{sx:{ml:1,fontSize:16}})]}),e.jsxs(we,{labelId:`${u}Variation`,id:`${t}Variation`,label:e.jsxs(e.Fragment,{children:[d," ",r("variation"),e.jsx(ie,{sx:{ml:1,fontSize:16}})]}),value:s[t]?.variation||"standalone",onChange:x=>m(x,t,"variation"),children:[e.jsx(X,{value:"standalone",children:e.jsx(j,{i18nKey:"standalone"})}),e.jsx(X,{value:"appendSome",children:e.jsx(j,{i18nKey:"appendSome"})}),e.jsx(X,{value:"appendMost",children:e.jsx(j,{i18nKey:"appendMost"})})]})]})})})]},t)}function Ws({formData:t,setFormData:s}){return e.jsxs(Ae,{direction:"row",spacing:1,alignItems:"center",justifyContent:"center",sx:{mt:1},children:[e.jsx(p,{children:e.jsx(j,{i18nKey:"solo"})}),e.jsx(V,{title:e.jsx(p,{variant:"subtitle2",children:e.jsx(j,{i18nKey:"soloTooltip"})}),arrow:!0,children:e.jsx(ie,{sx:{fontSize:15}})}),e.jsx(he,{id:"gameMode",checked:!W(t.gameMode),onChange:i=>s({...t,gameMode:i.target.checked?"local":"online",boardUpdated:!0}),inputProps:{"aria-label":"Game Type"}}),e.jsx(p,{children:e.jsx(j,{i18nKey:"local"})}),e.jsx(V,{title:e.jsx(p,{variant:"subtitle2",children:e.jsx(j,{i18nKey:"localTooltip"})}),arrow:!0,children:e.jsx(ie,{sx:{fontSize:15}})})]})}function Ds({formData:t}){const[s,i]=l.useState(!1);return l.useEffect(()=>{const n=Object.values(t).filter(o=>typeof o=="object"&&o?.type==="consumption"&&o?.level>0).length,a=Object.values(t).filter(o=>typeof o=="object"&&o?.level>0).length;i(n>1&&n>=a-n)},[t]),s?e.jsx(Kn,{severity:"warning",children:e.jsx(j,{i18nKey:"consumptionWarning"})}):null}function Vs({formData:t,setFormData:s,actionsList:i}){const{t:n}=_(),a=!G(t?.room)&&!W(t.gameMode);function o(r,u={}){return Object.keys(i).filter(d=>i[d]?.type===r).map(d=>e.jsx(Le,{children:e.jsx(Us,{option:d,settings:t,setSettings:s,actionsFolder:i,type:r,...u})},d))}const c=r=>{const u=JSON.parse(JSON.stringify(t));return Object.keys(u).forEach(d=>{u.role=r,d.includes("role")&&(u[d]=r)}),u};return e.jsxs(e.Fragment,{children:[e.jsx(Ws,{formData:t,setFormData:s}),G(t?.room)&&!W(t.gameMode)&&e.jsx(O,{container:!0,alignContent:"center",justifyContent:"space-evenly",children:e.jsx(O,{sx:{py:3},children:e.jsx(p,{variant:"h5",children:e.jsx(j,{i18nKey:"privateRequired"})})})}),e.jsxs(O,{container:!0,columnSpacing:2,justifyContent:"space-evenly",children:[e.jsx(Le,{children:e.jsx(V,{placement:"top",title:e.jsx(j,{i18nKey:"difficultyTooltip",children:e.jsxs(p,{variant:"body2",children:["Normal = Slow ramp up. ",e.jsx("br",{}),e.jsx("br",{}),"Accelerated = Straight to max level + the level prior to it."]})}),arrow:!0,children:e.jsx(Te,{value:t.difficulty,onChange:r=>s({...t,difficulty:r.target.value,boardUpdated:!0}),label:"difficulty",options:["normal","accelerated"],defaultValue:"normal",helpIcon:!0})})}),a&&e.jsx(Le,{children:e.jsx(Te,{value:t.role,onChange:r=>s({...c(r.target.value),boardUpdated:!0}),label:"mainRole",options:["dom","vers","sub"],defaultValue:"sub"})})]}),a?e.jsxs(e.Fragment,{children:[e.jsx(Ee,{title:n("consumption"),subtitle:n("consumptionSubtitle"),children:o("consumption",{showVariation:!0})}),e.jsx(Ee,{title:n("foreplay"),subtitle:n("foreplaySubtitle"),children:o("foreplay",{showRole:a})}),e.jsx(Ee,{title:n("sex"),subtitle:n("sexSubtitle"),children:o("sex",{showRole:a})})]}):e.jsxs(e.Fragment,{children:[e.jsx(O,{container:!0,columnSpacing:2,justifyContent:"space-evenly",children:o("consumption",{showVariation:!0})}),e.jsx(F,{}),e.jsx(O,{container:!0,columnSpacing:2,justifyContent:"center",children:o("solo")})]}),e.jsx(Fs,{setFormData:s,formData:t}),e.jsx(Ds,{formData:t})]})}function qs({formData:t,setFormData:s}){const{t:i}=_(),n={"1d4":2.5,"1d6":3.5,"2d4":5},a=t?.roomTileCount?Math.floor(t.roomTileCount/n[t.roomDice||"1d6"]):16,o=Array.from({length:7},(c,r)=>(r+2)*10).map(c=>e.jsx(X,{value:c,children:c},c));return e.jsxs(e.Fragment,{children:[e.jsx(p,{children:e.jsx(j,{i18nKey:"gameSpeed"})}),e.jsxs(w,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[e.jsxs(pe,{sx:{m:1},fullWidth:!0,children:[e.jsx(ke,{id:"diceRole-label",children:e.jsx(j,{i18nKey:"roomDice"})}),e.jsxs(we,{labelId:"diceRole-label",id:"diceRole-select",value:t?.roomDice||"1d4",label:i("roomDice"),onChange:c=>s({...t,roomDice:c.target.value,roomUpdated:!0}),children:[e.jsx(X,{value:"1d4",children:"1d4"}),e.jsx(X,{value:"1d6",children:"1d6"}),e.jsx(X,{value:"2d4",children:"2d4"})]})]}),e.jsxs(pe,{sx:{m:1},fullWidth:!0,children:[e.jsx(ke,{id:"tile-count-label",children:e.jsx(j,{i18nKey:"roomTileCount"})}),e.jsx(we,{labelId:"tile-count-label",id:"tile-count-select",value:String(t?.roomTileCount||40),label:i("roomTileCount"),onChange:c=>s({...t,roomTileCount:Number(c.target.value),roomUpdated:!0}),children:o})]}),e.jsx(pe,{fullWidth:!0,children:e.jsxs(p,{children:[e.jsx(j,{i18nKey:"averageRolls"}),a]})})]})]})}function Js({formData:t,setFormData:s}){const i=l.useCallback(()=>{s({...t,roomRealtime:!t.roomRealtime,roomUpdated:!0})},[t,s]);return e.jsxs(e.Fragment,{children:[e.jsx(p,{children:e.jsx(j,{i18nKey:"playerListOptions"})}),e.jsxs(Ae,{direction:"row",spacing:1,alignItems:"center",justifyContent:"center",sx:{width:"100%"},children:[e.jsx(p,{children:e.jsx(j,{i18nKey:"realtime"})}),e.jsx(V,{title:e.jsx(p,{variant:"subtitle2",children:e.jsx(j,{i18nKey:"realtimeTooltip"})}),arrow:!0,children:e.jsx(ie,{sx:{fontSize:15}})}),e.jsx(he,{id:"showPrivate",checked:!!t.roomRealtime,onChange:i,inputProps:{"aria-label":$("playerList")}}),e.jsx(p,{children:e.jsx(j,{i18nKey:"delayed"})}),e.jsx(V,{title:e.jsx(p,{variant:"subtitle2",children:e.jsx(j,{i18nKey:"delayedTooltip"})}),arrow:!0,children:e.jsx(ie,{sx:{fontSize:15}})})]})]})}function Hs({formData:t,setFormData:s}){const{t:i}=_(),n={app:i("appBackground"),custom:i("customURL")};return e.jsxs(w,{sx:{margin:"0.5rem"},children:[e.jsx(lt,{formData:t,setFormData:s}),!G(t.room)&&e.jsxs(e.Fragment,{children:[e.jsx(F,{sx:{my:1}}),e.jsx(qs,{formData:t,setFormData:s}),e.jsx(F,{sx:{my:1}}),e.jsx(Js,{formData:t,setFormData:s}),e.jsx(F,{sx:{my:1}}),e.jsx(rt,{formData:t,setFormData:s,backgrounds:n,isRoom:!0})]})]})}function Ys(t){return Object.values(t).some(({level:s})=>s>0)}function Xs(t,s){return Object.entries(t).reduce((i,[n,a])=>(n in s&&(a?.variation?.startsWith("append")?i.withAppend[n]=a:i.withoutAppend[n]=a),i),{withAppend:{},withoutAppend:{}})}function Qs(t){return Object.keys(t).length>0&&Object.values(t).some(({level:s})=>s>0)}function Zs(t,s){const{withAppend:i,withoutAppend:n}=Xs(t,s);return Ys(n)?G(t.room)&&!W(t.gameMode)?"privateRequired":null:Qs(i)?"appendWithAction":"pickSomething"}function ei(t){const{t:s}=ys;let i=`### ${s("roomSettings")}\r
`;return Object.entries(t).forEach(([n,a])=>{if(n!=="room"){if(n==="roomBackgroundURL"&&a!==""){i+=`* ${s(n)}: [${jt(a)}:link:](${a})\r
`;return}if(n==="roomRealtime"){i+=`* ${s("playerList")}: ${s(a?"delayed":"realtime")}\r
`;return}a!==""&&(i+=`* ${s(n)}: ${a}\r
`)}}),i}function ti(t){const s={};return Object.entries(t).forEach(([i,n])=>{i.startsWith("room")&&!["roomUpdated","roomBackground"].some(a=>a===i)&&(s[i]=n)}),s}async function ni(t,s,i){let n=t;return s!==void 0&&s.length>0&&(n=await i(s)),n}function si(t,s){const i=ti(t);return De({room:t.room,user:s,text:ei(i),type:"room",settings:JSON.stringify(i)})}function Je(){const{id:t}=ae(),s=Vt();return i=>{if(t!==void 0&&t?.toUpperCase()!==i?.toUpperCase()){const n=i?.replace(/^\/+/,"")||"PUBLIC";s(`/${n}`)}}}function ii(t){(!t.roomBackgroundURL||!pn(t.roomBackgroundURL))&&(t.roomBackground="app")}function _t(){const{user:t,updateUser:s}=ee(),{id:i}=ae(),{t:n}=_(),a=ct(),[o,c]=te(),r=ce(()=>yt(o?.gameMode)),u=ce(bt),d=Je(),{messages:m}=Ue(),C=l.useCallback(x=>{const f=i?.toUpperCase()!==x.room.toUpperCase(),T=!!(x.room&&!G(x.room)),g=T&&x.roomTileCount!==o?.roomTileCount;return{roomChanged:f,isPrivateRoom:T,privateBoardSizeChanged:g}},[i,o?.roomTileCount]),h=l.useCallback(async(x,f)=>{const{displayName:T}=x,g=await ni(t,T,s);ii(x);const{settingsBoardUpdated:y,gameMode:M,newBoard:A=[]}=await a(x),{roomChanged:S,isPrivateRoom:b,privateBoardSizeChanged:v}=C(x);if(!g)return;b&&(x.roomUpdated||!m.find(R=>R.type==="room"))&&await si(x,g),u?.tiles!==A&&await Ve({title:n("settingsGenerated"),tiles:A,isActive:1,gameMode:M}),(y||S||v)&&!m.some(R=>R.type==="settings"&&R.uid===g.uid&&Date.now()-(R.timestamp?.toMillis()||0)<5e3)&&await ft({formData:x,user:g,customTiles:r,actionsList:f,title:"Settings Generated Board",tiles:A}),c({...x,boardUpdated:!1,roomUpdated:!1,gameMode:M}),d(x.room)},[t,s,a,C,m,u,n,r,c,d]);return l.useCallback((x,f)=>h(x,f),[h])}function Bt({closeDialog:t,initialTab:s=0}){const{user:i}=ee(),{t:n}=_(),[a,o]=te(),[c,r]=l.useState(s),[u,d]=l.useState(null),[m,C]=l.useState(!1),[h,x]=dt(),f=Je(),T=_t(),{isLoading:g,actionsList:y}=ut(h?.gameMode),M=(k,R)=>{r(R),f(h.room)},A=()=>o({...a,boardUpdated:!0}),S=l.useCallback(async k=>{k.preventDefault();const{displayName:R,...I}=h,E=Zs(I,y);return E?(d(n(E)),null):(T(h,y),typeof t=="function"&&t(),null)},[h,y,n,d,T,t]),b=l.useCallback(k=>{x(R=>({...R,displayName:k.target.value}))},[x]),v=l.useCallback(k=>{k.key==="Enter"&&(x(R=>({...R,displayName:k.target.value})),S(k))},[S,x]);return!h.room||g?e.jsxs(w,{children:[e.jsxs(p,{variant:"h2",children:[e.jsx(j,{i18nKey:"loading"}),"..."]}),e.jsx(p,{variant:"body1",children:e.jsx(j,{i18nKey:"clearStorage"})})]}):e.jsxs(w,{component:"form",method:"post",onSubmit:S,className:"settings-box",children:[e.jsx(D,{fullWidth:!0,id:"displayName",label:n("displayName"),defaultValue:i?.displayName||h.displayName||"",required:!0,autoFocus:!0,onBlur:b,onKeyDown:v,margin:"normal"}),e.jsx(w,{sx:{borderBottom:1,borderColor:"divider"},children:e.jsxs(Tt,{value:c,onChange:M,"aria-label":"Game Settings",centered:!0,children:[e.jsx(je,{label:n("gameboard"),...xe(0)}),e.jsx(je,{label:n("room"),...xe(1)}),e.jsx(je,{label:n("application"),...xe(2)})]})}),e.jsx(me,{value:c,index:0,style:{p:0},children:e.jsx(Vs,{formData:h,setFormData:x,actionsList:y})}),e.jsx(me,{value:c,index:1,style:{p:0,pt:1},children:e.jsx(Hs,{formData:h,setFormData:x})}),e.jsx(me,{value:c,index:2,style:{p:0,pt:1},children:e.jsx(Gs,{formData:h,setFormData:x,boardUpdated:A})}),e.jsxs("div",{className:"flex-buttons",children:[e.jsx(L,{variant:"outlined",type:"button",onClick:()=>C(!0),children:e.jsx(j,{i18nKey:"customTilesLabel",children:"Game Tiles"})}),e.jsx(L,{variant:"contained",type:"submit",children:e.jsx(j,{i18nKey:"update"})})]}),m&&e.jsx($s,{open:m,setOpen:C,boardUpdated:A,actionsList:y}),e.jsx(ue,{open:!!u,close:()=>d(null),children:u})]})}const oa=Object.freeze(Object.defineProperty({__proto__:null,default:Bt},Symbol.toStringTag,{value:"Module"}));function ai({formData:t,setFormData:s,nextStep:i}){const n=Je();function a(){n(t.room),i(G(t.room)?2:1)}return e.jsxs(w,{sx:{m:1},children:[e.jsx(p,{variant:"h6",children:e.jsx(j,{i18nKey:"publicOrPrivate"})}),e.jsx(w,{sx:{margin:"0.5rem"},children:e.jsx(lt,{formData:t,setFormData:s})}),e.jsx(Re,{children:e.jsx(L,{variant:"contained",onClick:a,children:e.jsx(j,{i18nKey:G(t.room)?"nextSkip":"next"})})})]})}function oi({formData:t,setFormData:s,nextStep:i,prevStep:n}){const[a,o]=l.useState(!W(t?.gameMode));return l.useEffect(()=>{o(!W(t?.gameMode))},[t?.gameMode]),e.jsxs(w,{sx:{minHeight:"200px",display:"flex",flexDirection:"column"},children:[e.jsx(p,{variant:"h6",children:e.jsx(j,{i18nKey:"playingWithPeople"})}),e.jsx(Ce,{trueCondition:!W(t?.gameMode),onChange:c=>s({...t,gameMode:c.target.checked?"local":"online",roomRealtime:!c.target.checked}),yesLabel:"yesInteracting"}),e.jsx($n,{in:a,timeout:500,sx:{mt:a?2:0},children:e.jsxs(w,{children:[e.jsx(p,{variant:"h6",children:e.jsx(j,{i18nKey:"yourRole"})}),e.jsx(w,{sx:{display:"flex",justifyContent:"center"},children:e.jsx(Te,{value:t.role,onChange:c=>s({...t,role:c.target.value}),label:"mainRole",options:["dom","vers","sub"],defaultValue:"sub",fullWidth:!1})}),e.jsx(p,{variant:"h6",sx:{mt:1},children:e.jsx(j,{i18nKey:"areYouNaked"})}),e.jsx(p,{variant:"body2",sx:{mt:1},children:e.jsx(j,{i18nKey:"nakedDisclaimer"})}),e.jsx(Ce,{onChange:c=>s({...t,isNaked:c.target.checked}),trueCondition:t.isNaked,yesLabel:"yesNaked"})]})}),e.jsx(w,{sx:{flexGrow:1}}),e.jsxs(Re,{children:[e.jsx(L,{onClick:n,children:e.jsx(j,{i18nKey:"previous"})}),e.jsx(L,{variant:"contained",onClick:i,children:e.jsx(j,{i18nKey:"next"})})]})]})}function Ot(){return e.jsxs(p,{variant:"h6",sx:{mt:2},children:[e.jsx(j,{i18nKey:"setIntensityLevel"}),e.jsx(V,{title:e.jsx(p,{variant:"body1",children:e.jsx(j,{i18nKey:"intensityTooltip"})}),arrow:!0,sx:{ml:1},children:e.jsx(ie,{sx:{ml:.5,fontSize:15}})})]})}const ri=(t,s)=>{const{gameMode:i,isNaked:n}=t,a=W(i);return a&&["foreplay","sex"].includes(s.type)||!a&&n&&["solo","foreplay"].includes(s.type)||!a&&!n&&["solo","sex"].includes(s.type)},li=t=>Object.entries(t).reduce((s,[i,n])=>(ri(t,n)||(s[i]=n),s),{}),Pt=(t,s,i)=>Object.entries(t).map(([n,a])=>{const o=s.find(c=>c.value===n);return a.type!==i||!o?null:n}).filter(n=>!!n),ci=(t,s,i)=>{const n={...t};return Object.keys(n).forEach(a=>{n[a].type===s&&!i.includes(a)&&delete n[a]}),n},Kt=(t,s,i)=>{i(n=>{const a=ci(n,s,t);return t.forEach(o=>{if(a[o])return;let c={type:s,level:1};s==="consumption"&&(c={...c,variation:a.isAppend?"appendMost":"standalone"}),a[o]=c}),a})},$t=(t,s,i,n,a,o=null)=>{const c=t?.target?.value;if(c===0)return a(r=>r.filter(u=>u!==s)),n(r=>{const u={...r};return delete u[s],u});n(r=>({...r,[s]:{...r[s]||{},type:i,level:c,...!!o&&{variation:o}}}))},di=2;function ui({formData:t,setFormData:s,options:i,actionsList:n}){const a="consumption",o=i(a),r=Pt(t,o,a)||[],u=m=>{const{value:C}=m.target,h=typeof C=="string"?C.split(","):C;h.length<=di&&Kt(h,a,s)},d=(m,C)=>{const h=C.reduce((x,f)=>(x[f]={...x[f]||{},type:a,variation:m.target.checked?"appendMost":"standalone"},x),{...t,isAppend:m.target.checked});s(h)};return e.jsxs(e.Fragment,{children:[e.jsx(p,{variant:"h6",sx:{my:2},children:e.jsx(j,{i18nKey:"pickConsumptions"})}),e.jsx(ht,{onChange:u,values:r,options:o,label:$("consumables")}),!!r.length&&e.jsxs(e.Fragment,{children:[e.jsx(Ot,{}),r.map(m=>e.jsx(We,{actionsFolder:n,settings:t,option:m,initValue:1,onChange:C=>$t(C,m,a,s,()=>{},t.isAppend?"appendMost":"standalone")},m)),e.jsx(p,{variant:"h6",sx:{mt:2},children:e.jsx(j,{i18nKey:"standaloneOrCombine"})}),e.jsx(Ce,{trueCondition:t.isAppend,onChange:m=>d(m,r),yesLabel:"combineWithActions"})]})]})}const hi=4,xi=t=>W(t?.gameMode)?"solo":t.isNaked?"sex":"foreplay";function mi({formData:t,setFormData:s,options:i,actionsList:n}){const a=xi(t),o=i(a),r=Pt(t,o,a)||[],u=d=>{const{value:m}=d.target,C=typeof m=="string"?m.split(","):m;C.length<=hi&&Kt(C,a,s)};return e.jsxs(e.Fragment,{children:[e.jsx(p,{variant:"h6",sx:{my:2},children:e.jsx(j,{i18nKey:"pickActions"})}),e.jsx(ht,{onChange:u,values:r,options:o,label:$("actionsLabel")}),!!r.length&&e.jsxs(e.Fragment,{children:[e.jsx(Ot,{}),r.map(d=>e.jsx(We,{actionsFolder:n,settings:t,option:d,initValue:1,onChange:m=>$t(m,d,a,s,()=>{})},d))]})]})}function gi({formData:t,setFormData:s,nextStep:i,prevStep:n,actionsList:a}){function o(u){return Object.keys(a).filter(d=>a[d]?.type===u)}l.useEffect(()=>{const u=li(t);s(u)},[]);const c=u=>o(u).map(d=>({value:d,label:a[d]?.label})),r=!Object.keys(t).some(u=>t[u].level>0&&t[u].variation!=="appendMost");return e.jsxs(w,{children:[e.jsx(p,{variant:"body1",sx:{my:2},children:e.jsx(j,{i18nKey:"actionsDisclaimer"})}),e.jsx(mi,{formData:t,setFormData:s,options:c,actionsList:a}),e.jsx(ui,{formData:t,setFormData:s,options:c,actionsList:a}),e.jsxs(Re,{children:[e.jsx(L,{onClick:()=>n(G(t.room)?2:1),children:e.jsx(j,{i18nKey:"previous"})}),e.jsx(L,{variant:"contained",disabled:r,onClick:i,children:e.jsx(j,{i18nKey:"next"})})]})]})}function pi({formData:t,setFormData:s,prevStep:i,actionsList:n,close:a}){const o=[100,100],c=[0,0],[r,u]=l.useState(Xe(t?.finishRange||[],c)),[d,m]=l.useState(!1),C=_t();function h(f){s({...t,finishRange:f.target.checked?c:o}),u(f.target.checked)}l.useEffect(()=>{let f={...t,boardUpdated:!0};(!r||!Xe(t.finishRange||[],o))&&(f.finishRange=o),s(f)},[]);async function x(){m(!0);try{await C(t,n)}catch(f){console.error("Error submitting settings:",f)}finally{m(!1)}typeof a=="function"&&a()}return e.jsxs(w,{children:[e.jsx(p,{variant:"h6",sx:{my:2},children:e.jsx(j,{i18nKey:"WillYouOrgasm"})}),e.jsx(p,{variant:"body2",children:e.jsx(j,{i18nKey:"orgasmDisclaimer"})}),e.jsx(w,{sx:{display:"flex",justifyContent:"center",my:1},children:e.jsx(kt,{control:e.jsx(he,{checked:r,onChange:h}),label:e.jsx(j,{i18nKey:"yesOrgasm"})})}),e.jsxs(Re,{children:[e.jsx(L,{onClick:i,disabled:d,children:e.jsx(j,{i18nKey:"previous"})}),e.jsx(L,{variant:"contained",onClick:x,disabled:d,startIcon:d?e.jsx(Ie,{size:20,color:"inherit"}):null,children:e.jsx(j,{i18nKey:"buildGame"})})]})]})}function ra({close:t}){const{id:s}=ae(),[i,n]=l.useState(1),a={room:s};G(s)&&(a.gameMode="online",a.roomRealtime=!0);const[o,c]=dt({gameMode:"online",roomRealtime:!0,actions:[],consumption:[],role:"sub",boardUpdated:!1,room:s||"PUBLIC"},a),r=l.useRef(!0),{actionsList:u}=ut(o.gameMode);l.useEffect(()=>{if(r.current){if(r.current=!1,o.advancedSettings){C();return}if(typeof t=="function"){if(G(s)){n(3);return}n(2)}}},[o,t,s]);const d=x=>{if(!Number.isInteger(x))return n(i+1);n(i+(x||1))},m=x=>{if(!Number.isInteger(x))return n(i-1);n(i-(x||1))},C=()=>n(0),h=()=>{switch(i){case 1:return e.jsx(ai,{formData:o,setFormData:c,nextStep:d});case 2:return e.jsx(oi,{formData:o,setFormData:c,nextStep:d,prevStep:m});case 3:return e.jsx(gi,{formData:o,setFormData:c,nextStep:d,prevStep:m,actionsList:u});case 4:return e.jsx(pi,{formData:o,setFormData:c,prevStep:m,actionsList:u,close:t});default:return null}};return i===0?e.jsx(Bt,{closeDialog:t}):e.jsxs(w,{children:[e.jsx(w,{sx:{width:"100%",mt:2,mb:4},children:e.jsx(zn,{activeStep:i-1,alternativeLabel:!0,children:[1,2,3,4].map(x=>e.jsx(Gn,{children:e.jsx(Fn,{})},x))})}),h(),e.jsx(F,{sx:{mt:3}}),e.jsx(L,{onClick:C,children:e.jsx(j,{i18nKey:"advancedSetup"})})]})}function ji(t){const s=t.filter(a=>a).map(a=>a.split(": ")),i=[];s.forEach((a,o)=>{if(Number(a[1])===0)return;const c=Array(Number(a[1])).fill(o);i.push(...c)});const n=i[Math.floor(Math.random()*i.length)];return s.map(([a])=>a)[n]?.replace(/(\r\n|\n|\r)/gm,"")||""}function fi(t,s,i){if(!t)return"";const n=t.split("%");return n.length<=1?vt(t,s||"",i||""):ji(n)}function yi(t,s,i=[]){const{user:n}=ee(),{t:a}=_(),o=st(),c=i.length,[r,u]=l.useState(i[0]||{}),d=c-1,m=l.useRef(0),C=l.useCallback((x,f,T,g)=>{if(!x){console.error("Tile not found at location:",T);return}let y="";const M=fi(x.description||"",x.role||"",n?.displayName||"");f!==-1&&(y+=`${a("roll")}: ${f}
`),y+=`#${T+1}: ${x.title||a("unknownTile")}
`,y+=`${a("action")}: ${M}`,De({room:t,user:n,text:g?g+y:y,type:"actions"})},[t,n,a]),h=l.useCallback(x=>{if(x===-1)return{preMessage:`${a("restartingGame")}
`,newLocation:0};const f=o.find(g=>g.isSelf)?.location||0;if(f===d)return{preMessage:`${a("alreadyFinished")}
`,newLocation:x};const T=x+f;return T>=d?{newLocation:d}:{newLocation:T}},[a,o,d]);return l.useEffect(()=>{const x=Array.isArray(s.value)?s.value[0]:s.value,f=s.time;if(x===0||f<=m.current)return;m.current=f;const{preMessage:T,newLocation:g}=h(x);g>=0&&g<i.length&&i[g]?(u({...i[g],index:g}),C(i[g],x,g,T)):console.error(`Invalid location or missing tile: ${g}, gameBoard length: ${i.length}`)},[s,i,C,h]),{tile:r,playerList:o}}function bi(t,s){const{user:{displayName:i}}=ee(),[n,a]=l.useState(null),[o,c]=l.useState(i||"");l.useEffect(()=>{(n!==t||i!==o)&&(jn({newRoom:t,oldRoom:n,newDisplayName:i||"",oldDisplayName:o,removeOnDisconnect:s||t?.toUpperCase()==="PUBLIC"}),a(t),c(i||""))},[t,i,n,o,s])}function vi(t,s){const{i18n:n,t:a}=_(),{user:o}=ee(),[c,r]=te(),u=ce(()=>yt(c?.gameMode)),{messages:d,isLoading:m}=Ue(),[C,h]=l.useState("1d6"),[x,f]=l.useState(""),T=ct(),g=l.useRef(!1),y=l.useCallback(async(A,S=null)=>{if(!g.current){g.current=!0;try{const{gameMode:b,newBoard:v}=await T(A),k={formData:{...c,...A},user:o,customTiles:u,actionsList:await Ke(n.resolvedLanguage,b||"online"),tiles:v,title:a("settingsGenerated")};S&&(k.reason=a("rebuiltBoard",{messageUser:S})),await ft(k)}finally{setTimeout(()=>{g.current=!1},500)}}},[c,o,u,n.resolvedLanguage,a,T]),M=l.useCallback(async()=>{c?.room!==t&&(await r({...c,room:t}),await y({...c,roomUpdated:!0,room:t}))},[c,t,r,y]);return l.useEffect(()=>{if(!(m||!d.length))try{const A=Se(d,"room");if(A){const S=JSON.parse(A.settings),{roomDice:b,roomBackgroundURL:v,roomTileCount:k}=S;let R="1d6";!G(t)&&b&&(R=b),h(R),f(v||""),A.uid!==o?.uid&&k&&s?.length&&k!==s?.length&&!g.current&&y(S,A.displayName)}}catch(A){console.error("Error processing room message:",A)}},[d,m,t,o,s,y]),l.useEffect(()=>{if(!m)try{const A=Se(d,"room");if(A||!G(t)&&!A||G(t)&&!W(c?.gameMode||""))return;if(t!==c?.room&&s?.length&&!g.current){M();return}c?.roomBackgroundURL?.length&&f(c.roomBackgroundURL)}catch(A){console.error("Error in room change effect:",A)}},[t,c,s,d,m,M]),{roller:C,roomBgUrl:x}}function Si(t,s){const[i,n]=l.useState(null),[a,o]=nt(),c=a.get("importBoard"),{t:r}=_(),u=l.useCallback(()=>{n(null)},[]),d=l.useCallback(h=>{try{const x=JSON.parse(h);return Array.isArray(x)?x:null}catch{return null}},[]),m=l.useCallback(h=>{try{return h?JSON.parse(h):{}}catch{return{}}},[]),C=l.useCallback(async()=>{if(o({}),!c)return;const h=await fn(c);if(!h?.gameBoard)return n(r("failedBoardImport"));const x=d(h.gameBoard);if(!x)return n(r("failedBoardImport"));const f=h?.title!==r("settingsGenerated")?h.title:r("importedBoard");Ve({...h,title:f,tiles:x,isActive:1});const T=m(h?.settings);s({...t,...T}),i!==r("updated")&&n(r("updated"))},[c,d,m,t,s,r,i,o]);return l.useEffect(()=>{c&&C()},[c,C]),[i,u]}const Ci=({selectedRoll:t,handleMenuItemClick:s})=>{const[i,n]=l.useState(!1),a=l.useRef(null),o=()=>{n(u=>!u)},c=u=>{u.target instanceof Node&&a.current?.contains(u.target)||n(!1)},r=new Map;return r.set("restart",$("restart")).set("manual",$("manual")).set("30",$("auto30")).set("60",$("auto60")).set("90",$("auto90")).set("custom",$("setTimer")),e.jsxs(e.Fragment,{children:[e.jsx(L,{size:"small","aria-controls":i?"split-button-menu":void 0,"aria-expanded":i?"true":void 0,"aria-label":"select roll options","aria-haspopup":"menu",onClick:o,ref:a,children:e.jsx(Un,{})}),e.jsx(Wn,{sx:{zIndex:1},open:i,anchorEl:a.current,transition:!0,disablePortal:!0,placement:"top-end",children:({TransitionProps:u})=>e.jsx(Dn,{...u,style:{transformOrigin:"right bottom"},children:e.jsx(wt,{children:e.jsx(Vn,{onClickAway:c,children:e.jsx(qn,{id:"split-button-menu",autoFocusItem:!0,children:Array.from(r).map(([d,m])=>e.jsx(X,{selected:d===t,onClick:()=>s(d),children:m},d))})})})})})]})},re=10,Ti=({isOpen:t,onClose:s,onSubmit:i})=>{const{t:n}=_(),[a,o]=l.useState(30),[c,r]=l.useState(!1),[u,d]=l.useState(!1),[m,C]=l.useState(20),[h,x]=l.useState(60),f=()=>{if(u){let g=Number.parseInt(String(m),10),y=Number.parseInt(String(h),10);Number.isNaN(g)?(g=c?1:re,C(g)):!c&&g<re&&(g=re),Number.isNaN(y)||y<g?(y=g,x(y)):y===0&&(y=180,x(y)),c&&(g*=60,y*=60);const M=Math.floor(Math.random()*(y-g+1))+g;i(M,{isRange:!0,min:g,max:y})}else{let g=Number.parseInt(String(a),10);Number.isNaN(g)?(g=c?1:re,o(g)):c?g*=60:g<re&&(g=re),i(g,{isRange:!1})}s()},T=()=>{o(g=>{const y=Number.parseFloat(String(g));return Number.isNaN(y)||y<=0?g:c?(y*60).toString():(y/60).toString()}),C(g=>{const y=Number.parseFloat(String(g));return Number.isNaN(y)||y<=0?g:c?(y*60).toString():(y/60).toString()}),x(g=>{const y=Number.parseFloat(String(g));return Number.isNaN(y)||y<=0?g:c?(y*60).toString():(y/60).toString()}),r(g=>!g)};return e.jsxs(fe,{open:t,onClose:s,maxWidth:"xs",children:[e.jsx(ye,{children:n("setTimer")}),e.jsxs(be,{children:[e.jsx(w,{sx:{mb:2},children:e.jsx(kt,{control:e.jsx(he,{checked:u,onChange:g=>d(g.target.checked)}),label:n("useRandomRange")})}),u?e.jsxs(w,{children:[e.jsx(p,{variant:"subtitle2",children:n("randomTimerRange")}),e.jsxs(w,{sx:{display:"flex",gap:2,my:2},children:[e.jsx(D,{label:n("minValue"),type:"number",value:m,onChange:g=>{const y=parseInt(g.target.value,10);C(y)},fullWidth:!0}),e.jsx(p,{variant:"body1",sx:{alignSelf:"center"},children:"-"}),e.jsx(D,{label:n("maxValue"),type:"number",value:h,onChange:g=>{const y=parseInt(g.target.value,10);x(Math.max(Number(m),y))},fullWidth:!0})]}),e.jsxs(L,{onClick:T,variant:"outlined",size:"small",children:[n(c?"minutes":"seconds"),e.jsx(Ze,{sx:{ml:1}})]})]}):e.jsx(D,{autoFocus:!0,type:"number",value:a,onChange:g=>o(g.target.value),sx:{width:"15rem"},slotProps:{input:{endAdornment:e.jsx(Jn,{position:"end",children:e.jsxs(L,{onClick:T,variant:"text",children:[n(c?"minutes":"seconds"),e.jsx(Ze,{sx:{ml:1}})]})})}}})]}),e.jsxs(At,{children:[e.jsx(L,{onClick:s,children:n("cancel")}),e.jsx(L,{onClick:f,children:n("set")})]})]})};function ki(t){return/^-?\d+$/.test(String(t))}function _e(t,s,i){let n=0;for(let a=0;a<Number(t);a+=1)n+=Math.floor(Math.random()*Number(s))+1;i(n)}const wi=l.memo(function({setRollValue:s,dice:i,isEndOfBoard:n}){const{t:a}=_(),[o,c]=l.useState(!1),[r,u]=l.useState("manual"),[d,m]=l.useState(0),[C,h]=l.useState(a("roll")),{timeLeft:x,setTimeLeft:f,togglePause:T,isPaused:g}=Ht(d),[y,M]=l.useState(!1),[A,S]=l.useState({isRange:!1,min:30,max:120}),b=l.useCallback(B=>{s(B)},[s]),[v,k]=i.split("d"),R=()=>{if(r==="manual"){_e(v,k,b),c(!0),setTimeout(()=>c(!1),4e3);return}g&&x===d&&_e(v,k,b),T()},I=l.useCallback(B=>{if(B==="restart"){b(-1);return}if(u(String(B)),B==="custom"){M(!0);return}if(ki(B)){g||T();const U=Number(B);m(U),f(U)}},[g,f,T,b]),E=()=>{M(!1)},K=(B,U={isRange:!1})=>{g||T(),m(B),f(B),S({...A,...U}),u("custom"),M(!1)};return l.useEffect(()=>{n&&T()},[n,T]),l.useEffect(()=>{if(o)h(a("wait"));else if(r==="manual")h(a("roll"));else if(g)h(`${a("play")} (${x})`);else if(x>0)h(`${a("pause")} (${x})`);else if(x===0&&!g&&r!=="manual"){_e(v,k,b);let B;if(A.isRange){const{min:U,max:Ne}=A;B=Math.floor(Math.random()*(Ne-U+1))+U}else B=d;m(B),f(B),h(`${a("pause")} (${B})`)}},[o,r,x,g,d,A,a,v,k,b,f]),e.jsxs(e.Fragment,{children:[e.jsxs(Hn,{variant:"contained",className:"dice-roller",children:[e.jsxs(L,{"aria-label":a("roll"),onClick:R,disabled:o,size:"large",children:[e.jsx(Yn,{sx:{mr:1}}),C]}),e.jsx(Ci,{selectedRoll:r,handleMenuItemClick:I})]}),e.jsx(Ti,{isOpen:y,onClose:E,onSubmit:K})]})}),Ai=l.lazy(()=>q(()=>Promise.resolve().then(()=>Vi),void 0)),Mi=l.lazy(()=>q(()=>import("./chunk-DeAq10ee.js").then(t=>t.a2),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9]))),Ri=l.lazy(()=>q(()=>Promise.resolve().then(()=>Ei),void 0));function Be(){return e.jsx(w,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100px",children:e.jsx(Ie,{size:24})})}function Ii(){const t=ae(),s=t.id||"",i=de(),{t:n}=_(),[a,o]=te();bi(s,a?.roomRealtime);const[c,r]=l.useState({value:0,time:0}),u=ce(bt)?.tiles,d=l.useCallback(R=>{r({value:R,time:Date.now()})},[]),{playerList:m,tile:C}=yi(s,c,u),{roller:h,roomBgUrl:x}=vi(s,u),[f,T]=Si(a,o);if(!u||!u.length||!Object.keys(a).length||G(s)&&!W(a.gameMode))return e.jsxs(e.Fragment,{children:[e.jsx(Me,{room:t.id,playerList:m}),e.jsx(Yt,{open:!0})]});const{isVideo:g,url:y}=yn(a,s,x),M=g?"video-adjust":"",{background:A,roomBackground:S}=a,b=!G(s)&&S!=="app"||A!=="color",v=e.jsx(l.Suspense,{fallback:e.jsx(Be,{}),children:e.jsx(Ri,{playerList:m,isTransparent:b,gameBoard:u,settings:a})}),k=e.jsx("div",{className:"messages-container",children:e.jsxs(l.Suspense,{fallback:e.jsx(Be,{}),children:[e.jsx(Mi,{room:s,isTransparent:b,currentGameBoardSize:u.length}),e.jsx(Xt,{room:s,isTransparent:b})]})});return e.jsxs(e.Fragment,{children:[e.jsx(Me,{room:s,playerList:m}),e.jsx(wi,{setRollValue:d,dice:h,isEndOfBoard:C?.index!==void 0&&C.index>=(u?.length??0)-1}),e.jsx(at,{isVideo:g,url:y}),e.jsx(Qt,{}),i?e.jsx(l.Suspense,{fallback:e.jsx(Be,{}),children:e.jsx(Ai,{tab1:v,tab2:k})}):e.jsxs(w,{className:`desktop-container ${M}`,children:[v,k]}),e.jsx(Zt,{}),e.jsx(ue,{type:f===n("updated")?"success":"error",open:!!f,close:T,children:f})]})}const la=Object.freeze(Object.defineProperty({__proto__:null,default:Ii},Symbol.toStringTag,{value:"Module"}));function Ni({title:t,description:s,players:i,current:n,isTransparent:a,className:o}){const c=l.useMemo(()=>i.map(d=>e.jsx(en,{displayName:d.displayName||"",uid:d.uid||""},d.uid)),[i]),r=l.useRef(null);l.useEffect(()=>{r.current&&n&&r.current.scrollIntoView({behavior:"smooth"})},[n]);const u=[n&&"pulse-animation",a&&"gray-tiles",o].join(" ").trim();return e.jsxs("li",{className:u,ref:r,children:[e.jsxs("div",{className:"tile-title-row",children:[e.jsx("div",{className:`tile-title ${a&&"pop-text"}`,children:t}),e.jsx("div",{className:"player-indicator",children:e.jsx(Xn,{max:4,children:c})})]}),e.jsx(F,{sx:{margin:"0.5rem 0"}}),e.jsx("div",{className:`tile-description ${a&&"pop-text"}`,children:s})]})}function Li({playerList:t,isTransparent:s,gameBoard:i,settings:n}){const{user:a}=ee();if(!Array.isArray(i)||!i.length)return null;const o=new Set;i.forEach(({title:r},u)=>{r&&u!==0&&u!==i.length-1&&o.add(r)});const c=i.map((r,u)=>{const d=t.filter(x=>x.location===u),m=t.find(x=>x.isSelf&&x.location===u&&u!==0),C=Array.from(o).indexOf(r.title)%10+1,h=!n.hideBoardActions||u===0||m?vt(r.description,r.role,a.displayName||""):r.description.replace(/[^\w\s]/g,"").replace(/[a-zA-Z0-9]/g,"?");return e.jsx(Ni,{title:`#${u+1}: ${r.title}`,description:h,players:d,current:m,isTransparent:s,className:`hue${C}`},u)});return e.jsx("div",{className:"gameboard",children:e.jsx("ol",{children:c})})}const Ei=Object.freeze(Object.defineProperty({__proto__:null,default:Li},Symbol.toStringTag,{value:"Module"})),_i=t=>{try{const{href:s}=new URL(t),i=jt(t);return e.jsx(L,{href:s,target:"_blank",rel:"noreferrer",variant:"outlined",size:"small",startIcon:t.includes("meet")||t.includes("zoom")?e.jsx(Qn,{}):e.jsx(Rt,{}),children:i})}catch{return null}};function Bi({game:t}){const s=Mt(),{t:i}=_(),n=t.dateTime.toDate(),a=new Date().toDateString()===n.toDateString(),o=n.getTime()-new Date().getTime()<1440*60*1e3&&n>new Date;return e.jsxs(O,{container:!0,spacing:2,alignItems:"center",children:[e.jsx(O,{size:12,children:e.jsxs(w,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Fe,{fontSize:"small",color:a?"secondary":"action",sx:{opacity:a?1:.7}}),e.jsxs(w,{sx:{display:"flex",gap:2},children:[e.jsx(p,{variant:"body2",fontWeight:a?"bold":"normal",children:n.toLocaleString([],{weekday:"short",month:"short",day:"numeric"})}),e.jsx(p,{variant:"body2",color:"text.secondary",children:n.toLocaleString([],{hour:"numeric",minute:"2-digit"})})]}),o&&e.jsx(Ge,{label:i("soon"),size:"small",color:"primary",sx:{height:20,fontSize:"0.7rem",ml:1,borderRadius:1,fontWeight:"bold",backgroundColor:Z(s.palette.success.main,.8)}})]})}),e.jsx(O,{size:12,children:e.jsxs(w,{sx:{display:"flex",alignItems:"center",gap:1},children:[t.url?_i(t.url):e.jsx(p,{variant:"body2",color:"text.secondary",sx:{fontStyle:"italic",fontSize:"0.85rem"},children:i("noLinkProvided")}),e.jsx(tn,{title:i("calendar.gameTitle"),date:n,url:t.url,downloadIcs:nn,buttonSx:{ml:1}})]})})]})}function Oi({open:t,close:s,isMobile:i}){const{t:n}=_(),[a,o]=l.useState(""),{schedule:c,addToSchedule:r}=Nt(),u=et().add(2,"week"),d=Mt(),m=l.useCallback(()=>{o(null)},[]),C=l.useCallback(h=>{h.preventDefault();const x=h.currentTarget,f=x.elements.namedItem("date-time"),T=new Date(f.value),y=x.elements.namedItem("link").value;if(!T||!(T instanceof Date)){o("Please select a date and time");return}if(T<et().toDate()){o("Please select a date and time in the future");return}if(c.find(M=>M.dateTime.toDate().toUTCString()===T.toUTCString())){o("A game is already scheduled for this date and time");return}if(T>u.toDate()){o("Please select a date and time within the next two weeks");return}if(y&&!y.startsWith("http")){o("Please enter a valid URL");return}r(T,y),x.reset()},[c,r,u]);return e.jsxs(e.Fragment,{children:[e.jsx(fe,{fullScreen:i,open:t,onClose:s,maxWidth:"md",children:e.jsxs("form",{onSubmit:C,children:[e.jsxs(ye,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(qe,{color:"primary"}),e.jsx(p,{variant:"h5",component:"span",fontWeight:"bold",children:e.jsx(j,{i18nKey:"schedule"})}),e.jsx(Pe,{close:s})]}),e.jsxs(be,{children:[e.jsxs(le,{elevation:3,sx:{mb:4,background:Z(d.palette.primary.main,.05),border:`1px solid ${Z(d.palette.primary.main,.1)}`,borderRadius:2,overflow:"visible",position:"relative"},children:[e.jsx(ze,{title:e.jsxs(w,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Fe,{color:"primary"}),e.jsx(p,{variant:"h6",fontWeight:"bold",children:"Planned Games"})]}),sx:{pb:1,borderBottom:`1px solid ${Z(d.palette.divider,.1)}`}}),e.jsx(ge,{sx:{p:2},children:c.length?e.jsx(Ae,{spacing:2,children:c?.map(h=>e.jsx(wt,{elevation:1,sx:{p:1.5,borderRadius:1.5},children:e.jsx(Bi,{game:h})},h.id))}):e.jsxs(w,{sx:{p:3,textAlign:"center",color:Z(d.palette.text.primary,.6),borderRadius:1,background:Z(d.palette.background.paper,.5)},children:[e.jsx(p,{variant:"body1",children:"No Planned Games"}),e.jsx(p,{variant:"body2",sx:{mt:1,fontSize:"0.85rem"},children:"Use the form below to schedule your first game"})]})})]}),e.jsxs(le,{elevation:2,sx:{background:Z(d.palette.background.paper,.7),borderRadius:2},children:[e.jsx(ze,{title:e.jsxs(w,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Zn,{color:"secondary"}),e.jsx(p,{variant:"h6",fontWeight:"bold",children:e.jsx(j,{i18nKey:"scheduleGame"})})]}),sx:{pb:1,borderBottom:`1px solid ${Z(d.palette.divider,.1)}`}}),e.jsx(ge,{children:e.jsxs(Ae,{spacing:3,sx:{mt:1},children:[e.jsx(es,{name:"date-time",label:n("dateTime"),closeOnSelect:!1,disablePast:!0,maxDate:u,timeSteps:{minutes:30},sx:{width:"100%"},slotProps:{textField:{variant:"outlined",fullWidth:!0}}}),e.jsx(D,{label:n("camUrl"),variant:"outlined",name:"link",fullWidth:!0,placeholder:"https://...",helperText:"Optional: Link to your stream or meeting"}),e.jsx(L,{variant:"contained",type:"submit",fullWidth:!0,size:"large",startIcon:e.jsx(Fe,{}),sx:{mt:2,py:1.2,borderRadius:1.5,fontWeight:"bold",textTransform:"none",boxShadow:d.shadows[4],"&:hover":{boxShadow:d.shadows[8]}},children:e.jsx(j,{i18nKey:"schedule"})})]})})]})]})]})}),e.jsx(ue,{open:!!a,close:m,children:a})]})}const zt=Object.freeze(Object.defineProperty({__proto__:null,default:Oi},Symbol.toStringTag,{value:"Module"})),Pi=l.lazy(()=>q(()=>import("./chunk-DeAq10ee.js").then(t=>t.a3),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9]))),Ki=l.lazy(()=>q(()=>import("./chunk-DeAq10ee.js").then(t=>t.a1),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9]))),$i=l.lazy(()=>q(()=>Promise.resolve().then(()=>Ts),void 0)),zi=l.lazy(()=>q(()=>Promise.resolve().then(()=>Hi),void 0)),Gi=l.lazy(()=>q(()=>Promise.resolve().then(()=>zt),void 0)),Fi=l.lazy(()=>q(()=>import("./chunk-DeAq10ee.js").then(t=>t.a4),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9])));function Ui(){const{id:t}=ae(),{user:s,logout:i,isAnonymous:n}=sn(),a=de(),{i18n:o}=_(),[c,r]=l.useState(!1),u=l.useCallback(b=>r(b),[]),d=te()[0],[m,C]=l.useState({settings:!1,gameBoard:!1,about:!1,schedule:!1,customTiles:!1,linkAccount:!1,appSettings:!1}),h=l.useCallback((b,v)=>C(k=>({...k,[b]:v})),[]),x=l.useCallback(async()=>{await i(),u(!1)},[i,u]),f=b=>window.open(b,"_blank","noreferrer"),T=l.useMemo(()=>e.jsx(ts,{children:e.jsx("path",{d:"M18.942 5.556a16.299 16.299 0 0 0-4.126-1.297c-.178.321-.385.754-.529 1.097a15.175 15.175 0 0 0-4.573 0 11.583 11.583 0 0 0-.535-1.097 16.274 16.274 0 0 0-4.129 1.3c-2.611 3.946-3.319 7.794-2.965 11.587a16.494 16.494 0 0 0 5.061 2.593 12.65 12.65 0 0 0 1.084-1.785 10.689 10.689 0 0 1-1.707-.831c.143-.106.283-.217.418-.331 3.291 1.539 6.866 1.539 10.118 0 .137.114.277.225.418.331-.541.326-1.114.606-1.71.832a12.52 12.52 0 0 0 1.084 1.785 16.46 16.46 0 0 0 5.064-2.595c.415-4.396-.709-8.209-2.973-11.589zM8.678 14.813c-.988 0-1.798-.922-1.798-2.045s.793-2.047 1.798-2.047 1.815.922 1.798 2.047c.001 1.123-.793 2.045-1.798 2.045zm6.644 0c-.988 0-1.798-.922-1.798-2.045s.793-2.047 1.798-2.047 1.815.922 1.798 2.047c0 1.123-.793 2.045-1.798 2.045z"})}),[]),{setLocale:g}=bn(),y=b=>{o.changeLanguage(b),g(b)},A=l.useMemo(()=>{const b=[{key:"gameBoard",title:e.jsx(j,{i18nKey:"gameBoards"}),icon:e.jsx(hs,{}),onClick:()=>h("gameBoard",!0)},{key:"customTiles",title:e.jsx(j,{i18nKey:"customTilesLabel"}),icon:e.jsx(xs,{}),onClick:()=>h("customTiles",!0)},{key:"cast",title:e.jsx(j,{i18nKey:"tvMode"}),icon:e.jsx(ms,{}),onClick:()=>f(`/${t?.toUpperCase()}/cast`)},{key:"schedule",title:e.jsx(j,{i18nKey:"schedule"}),icon:e.jsx(qe,{}),onClick:()=>h("schedule",!0)},{key:"discord",title:"Discord",icon:T,onClick:()=>f("https://discord.gg/mSPBE2hFef")},{key:"about",title:e.jsx(j,{i18nKey:"about"}),icon:e.jsx(gs,{}),onClick:()=>h("about",!0)}];return s&&(b.unshift({key:"appSettings",title:e.jsx(j,{i18nKey:"appSettings"}),icon:e.jsx(ns,{}),onClick:()=>h("appSettings",!0)}),b.unshift({key:"settings",title:e.jsx(j,{i18nKey:d.advancedSettings?"settings":"setupWizard"}),icon:e.jsx(ss,{}),onClick:()=>h("settings",!0)}),n&&b.push({key:"linkAccount",title:e.jsx(j,{i18nKey:"linkAccount"}),icon:e.jsx(Rt,{}),onClick:()=>h("linkAccount",!0)}),b.push({key:"logout",title:e.jsx(j,{i18nKey:"logout"}),icon:e.jsx(is,{}),onClick:()=>x()})),b},[s,t,n,d.advancedSettings,T,x,h]).map(({key:b,title:v,icon:k,onClick:R})=>e.jsx(as,{disablePadding:!0,onClick:R,children:e.jsxs(os,{children:[e.jsx(rs,{children:k}),e.jsx(ls,{primary:v})]})},b)),S=(b,v,k={})=>e.jsx(l.Suspense,{fallback:e.jsx("div",{children:"Loading..."}),children:e.jsx(b,{open:m[v],close:()=>h(v.toString(),!1),isMobile:a,...k})});return e.jsxs(e.Fragment,{children:[e.jsx(se,{onClick:()=>u(!0),"aria-label":"open menu",children:e.jsx(cs,{})}),e.jsx(ds,{anchor:"right",open:c,onClose:()=>u(!1),children:e.jsxs(w,{role:"presentation",onClick:()=>u(!1),sx:{width:250,display:"flex",flexDirection:"column",height:"100%"},children:[e.jsx(us,{sx:{flexGrow:1},children:A}),e.jsxs(w,{sx:{borderTop:"1px solid rgba(0, 0, 0, 0.12)",p:2,display:"flex",justifyContent:"center",gap:1},children:[e.jsx(w,{component:"span",onClick:()=>y("en"),sx:{cursor:"pointer",fontWeight:o.language==="en"?"bold":"normal",color:o.language==="en"?"primary.main":"inherit"},children:"English"}),e.jsx(w,{component:"span",children:"|"}),e.jsx(w,{component:"span",onClick:()=>y("fr"),sx:{cursor:"pointer",fontWeight:o.language==="fr"?"bold":"normal",color:o.language==="fr"?"primary.main":"inherit"},children:"Français"}),e.jsx(w,{component:"span",children:"|"}),e.jsx(w,{component:"span",onClick:()=>y("es"),sx:{cursor:"pointer",fontWeight:o.language==="es"?"bold":"normal",color:o.language==="es"?"primary.main":"inherit"},children:"Español"})]})]})}),m.settings&&S(Ki,"settings"),m.appSettings&&S(Pi,"appSettings"),m.about&&e.jsx(l.Suspense,{fallback:e.jsx("div",{children:"Loading..."}),children:e.jsx(an,{open:m.about,close:()=>h("about",!1),children:e.jsx($i,{})})}),m.gameBoard&&S(zi,"gameBoard"),m.schedule&&S(Gi,"schedule"),m.customTiles&&S(Fi,"customTiles"),m.linkAccount&&S(it,"linkAccount")]})}const Wi=Object.freeze(Object.defineProperty({__proto__:null,default:Ui},Symbol.toStringTag,{value:"Module"}));function Di({tab1:t,tab2:s}){const[i,n]=l.useState(0),{t:a}=_(),o=(c,r)=>{n(r)};return e.jsxs(e.Fragment,{children:[e.jsx(St,{position:"fixed",sx:{top:"auto",bottom:0},children:e.jsxs(Tt,{value:i,onChange:o,indicatorColor:"secondary",textColor:"inherit",variant:"fullWidth",children:[e.jsx(je,{label:a("game"),...xe(0)}),e.jsx(je,{label:a("messages"),...xe(1)})]})}),e.jsxs(w,{sx:{marginTop:"3rem",height:"calc(100vh - 3rem)",overflowY:"auto"},children:[e.jsx(me,{value:i,index:0,children:t}),e.jsx(me,{value:i,index:1,children:s})]})]})}const Vi=Object.freeze(Object.defineProperty({__proto__:null,default:Di},Symbol.toStringTag,{value:"Module"}));function qi({open:t,close:s,setAlert:i,board:n}){const{t:a}=_(),[o,c]=l.useState(""),[r,u]=l.useState(n.title||"");function d(f){try{return r.length?f.map((T,g)=>{const[y,...M]=T.split(`
`).filter(S=>S);if(y===void 0)throw i({message:a("importNoEmpty")});if(!/^\[.+\]$/.test(y))throw i({message:a("importInvalidTitle",{entry:g+1})});if(!M.length)throw i({message:a("importMissingDescription",{entry:g+1})});return{title:y?.replace(/\[|\]/g,""),description:M.join(`
`)}}):(i({message:a("importTitleRequired")}),null)}catch{return null}}const m=async()=>{const f=o.split(/~+/).filter(g=>g),T=d(f);if(!T)return null;try{if(JSON.stringify(n.tiles)===JSON.stringify(T))return i({message:a("importNoChange")}),null}catch{return i({message:a("error"),type:"error"}),null}return Qe({...n,title:r,tiles:T}),i({message:a("saved"),type:"success"}),s(),null},C=()=>{const f=n?.tiles?.map(T=>{if(!T)return"";const g=T.title||"",y=T.description||"";return`[${g}]
${y}`}).filter(Boolean);c(f?.join(`
~~
`)||"")},h=f=>{u(f.target.value)},x=async f=>{if(!f.target.value.length)return i({message:a("importTitleRequired")}),null;Qe({...n,title:f.target.value})};return l.useEffect(()=>{t&&C()},[t]),l.useEffect(()=>{u(n.title||"")},[n.title]),e.jsxs(e.Fragment,{children:[e.jsx(D,{fullWidth:!0,label:a("title"),value:r,onChange:h,onBlur:x}),e.jsx(D,{sx:{mt:2},multiline:!0,fullWidth:!0,value:o,onChange:f=>c(f.target.value),InputProps:{endAdornment:e.jsxs("div",{style:{display:"flex",flexDirection:"column",position:"sticky",top:0},children:[e.jsx(V,{title:a("save"),children:e.jsx(se,{size:"small",onClick:m,"aria-label":a("save"),children:e.jsx(ps,{color:"success"})})}),e.jsx(Oe,{text:o}),e.jsx(Oe,{text:`${window.location.href}?importBoard=${n.id}`,copiedText:a("copiedLink"),icon:e.jsx(js,{}),tooltip:a("copyShareLink")})]}),sx:{alignItems:"flex-start"}}})]})}function Ji({open:t,close:s,isMobile:i}){const n=ce(Tn),[a,o]=l.useState(null),[c,r]=l.useState(0),[u,d]=l.useState(0),m=te()[0],{user:C}=ee();if(!n)return null;const h=v=>{if(!v||!v.length)return null;const k=v[v.length-1];return k?.description?k.description.match(/\d+%/g):null},x=v=>{o(v)};async function f({title:v,tiles:k}){const R=k.map(({title:B})=>`* ${B} 
`);R.pop(),R.shift();let I=`### ${$("activated")}: ${v}
`;I+=`---
`,I+=[...new Set(R)].join(" "),I+=`---
`;const E=h(k);E&&E.length===3&&(I+=`* ${$("finishSlider")} ${E[0]}  | ${E[1]} | ${E[2]}`);const K=await Cn({title:v,gameBoard:JSON.stringify(k),settings:JSON.stringify(m)});K?.id&&await De({room:m?.room||"PUBLIC",user:C,text:I,type:"settings",gameBoardId:K.id,boardSize:k.length,gameMode:m?.gameMode})}const T=async()=>{const v=await Ve({isActive:0})||0;d(v)},g=v=>{vn(v.id),f(v),o({message:$("boardEnabled"),type:"success"})},y=v=>{v!==0&&r(v)},M=()=>{typeof c=="number"&&Sn(c),r(0)},A=v=>(k,R)=>{d(R?v:0)},S=v=>!v.tiles||v.tiles.length!==(m?.roomTileCount||40),b=v=>S(v)?$("boardWrongSize",{size:m?.roomTileCount||40}):v.isActive?$("boardActive"):$("enableBoard");return e.jsxs(e.Fragment,{children:[e.jsxs(fe,{fullScreen:i,open:t,onClose:s,PaperProps:{sx:{maxHeight:"100%",height:"100%"}},children:[e.jsxs(ye,{children:[e.jsx(j,{i18nKey:"manageGameBoards"}),e.jsx(Pe,{close:s})]}),e.jsxs(be,{style:{overflowY:"scroll"},children:[e.jsxs(w,{sx:{mb:1},children:[e.jsx(L,{variant:"outlined",onClick:T,endIcon:e.jsx(fs,{}),sx:{float:"right"},children:e.jsx(j,{i18nKey:"add"})}),e.jsx(p,{children:e.jsx(j,{i18nKey:"gameBoardDescription"})})]}),n.map(v=>e.jsxs(J,{expanded:u===v.id,onChange:A(v.id||0),children:[e.jsxs(H,{children:[e.jsxs(w,{children:[e.jsx(p,{variant:"body1",children:v.title}),e.jsxs(p,{variant:"body2",children:[v.tiles?.length," tiles"]})]}),e.jsxs(w,{style:{marginLeft:"auto"},justifyContent:"flex-end",children:[e.jsx(V,{title:b(v),children:e.jsx("div",{style:{display:"inline-block"},children:e.jsx(he,{checked:!!v.isActive,disabled:!!v.isActive||S(v),onChange:()=>g(v),size:"small"})})}),e.jsx(V,{title:$("delete"),children:e.jsx("span",{style:{display:"inline-block"},children:e.jsx(se,{onClick:()=>y(v.id||0),size:"small",component:"span",children:e.jsx(Ct,{color:"error"})})})})]})]}),e.jsx(Y,{children:e.jsx(qi,{open:t,close:()=>A(v.id||0)(null,!1),setAlert:x,board:v})})]},v.id))]})]}),e.jsx(ue,{open:!!a?.message,type:a?.type||"error",close:()=>o(null),children:a?.message}),e.jsxs(fe,{open:!!c,onClose:()=>r(0),children:[e.jsxs(ye,{children:["Delete Board",e.jsx(Pe,{close:()=>r(0)})]}),e.jsx(be,{children:e.jsxs(p,{variant:"body1",children:['Are you sure you want to delete "',n.find(v=>v.id===c)?.title,'"?']})}),e.jsxs(At,{children:[e.jsx(L,{onClick:()=>r(0),children:"Cancel"}),e.jsx(L,{onClick:M,children:"Delete"})]})]})]})}const Hi=Object.freeze(Object.defineProperty({__proto__:null,default:Ji},Symbol.toStringTag,{value:"Module"}));export{$s as C,Bt as G,na as S,ra as a,ia as b,aa as c,oa as d,la as e,Ei as f,sa as i,si as s};
