import{r as f,j as h,am as F}from"./chunk-DX6P0x0s.js";import{c as L}from"./chunk-kXcKns83.js";import{g as _}from"./chunk-B4PEA_xj.js";import{i as j}from"./chunk-Dwxd6diy.js";import{l as R}from"./chunk-EL58PX5i.js";import{u as M}from"./chunk-C-ZDfTlo.js";function T({images:e,className:n,zoomDuration:t=3e3,zoomScale:r=1.4}){const[o,u]=f.useState(0),[d,i]=f.useState(0),l=f.useRef(null);if(f.useEffect(()=>{if(e.length===0||e.length===1)return;const c=()=>{l.current=window.setInterval(()=>{u(m=>(m+1)%e.length),i(m=>m+1)},t)},s=window.setTimeout(c,1e3);return()=>{window.clearTimeout(s),l.current&&(window.clearInterval(l.current),l.current=null)}},[e.length,t]),f.useEffect(()=>()=>{l.current&&(window.clearInterval(l.current),l.current=null)},[]),e.length===0)return null;const a=e[o];return h.jsx("div",{className:L("image-slideshow-container",n),"aria-hidden":!0,children:h.jsx("div",{className:"image-slideshow-slide",style:{backgroundImage:`url(${a})`,animationDuration:`${t}ms`,"--zoom-scale":r}},d)})}function k(e){return e.replace(/&amp;/g,"&")}async function z(e,n,t){const r=new Set;let o=null;const u=[a=>`https://api.reddit.com/r/${e}/top.json?limit=100&t=year&raw_json=1${a?`&after=${a}`:""}`,a=>`https://api.reddit.com/r/${e}/hot.json?limit=100&raw_json=1${a?`&after=${a}`:""}`],d=a=>`https://r.jina.ai/http://${a.replace(/^https?:\/\//,"")}`,i=async a=>{try{const c=await fetch(a,{signal:t,credentials:"omit",mode:"cors"});if(c.ok){const s=await c.text();try{return JSON.parse(s)}catch{const m=s.indexOf("{"),g=s.lastIndexOf("}");if(m!==-1&&g!==-1&&g>m)try{return JSON.parse(s.slice(m,g+1))}catch{return null}return null}}}catch{}try{const c=await fetch(d(a),{signal:t,credentials:"omit",mode:"cors"});if(!c.ok)return null;const s=await c.text();try{return JSON.parse(s)}catch{const m=s.indexOf("{"),g=s.lastIndexOf("}");if(m!==-1&&g!==-1&&g>m)try{return JSON.parse(s.slice(m,g+1))}catch{return null}return null}}catch{return null}};let l=0;for(;r.size<n&&l<u.length;){o=null;for(let a=0;a<5&&r.size<n;a+=1){const c=u[l](o),s=await i(c);if(!s)break;const m=s?.data?.children??[];o=s?.data?.after??null;for(const g of m){const y=g?.data;if(!y)continue;const x=y.url_overridden_by_dest,A=y.post_hint;if(y.is_gallery&&y.media_metadata&&y.gallery_data){const I=y.gallery_data.items||[];for(const E of I){const v=y.media_metadata[E.media_id],w=v?.s?.u||v?.s?.gif||v?.s?.mp4;if(typeof w=="string"){const U=w.startsWith("http")?w:`https:${w}`;/\.(jpe?g|png|gif|webp)(\?.*)?$/i.test(U)&&r.add(k(U))}}continue}if(A==="image"&&typeof x=="string"&&/\.(jpe?g|png|gif|webp)(\?.*)?$/i.test(x)){r.add(k(x));continue}const b=y.preview?.images?.[0]?.source?.url;if(b){const I=b.startsWith("http")?b:`https:${b}`;r.add(k(I))}}if(!o)break}l+=1}return Array.from(r).slice(0,n)}async function P(e,n){const t=e.maxImages||150;switch(e.type){case"reddit":{const r=O(e.url);if(!r)throw new Error("Invalid Reddit URL");return{images:await z(r,t,n),source:`r/${r}`}}case"custom":return{images:[e.url],source:"Custom"};default:throw new Error(`Unsupported feed type: ${e.type}`)}}function B(e){return H(e)?"reddit":null}function H(e){try{const n=new URL(e);return/(^|\.)reddit\.com$/i.test(n.hostname)&&/\/r\//i.test(n.pathname)}catch{return!1}}function O(e){try{return new URL(e).pathname.match(/\/r\/([^/]+)/i)?.[1]??null}catch{return null}}const Z=4e5,S=new Map,$=new Map;async function C(e,n){const t=JSON.stringify(e),r=Date.now(),o=S.get(t);if(o&&r-o.fetchedAt<Z)return o.result;const u=$.get(t);if(u)try{return await u}catch{}const d=P(e,n).then(i=>(S.set(t,{fetchedAt:Date.now(),result:i}),i)).finally(()=>{$.delete(t)});return $.set(t,d),d}function D(e){const[n,t]=f.useState([]),[r,o]=f.useState(!1),[u,d]=f.useState(null),[i,l]=f.useState(null),a=f.useRef(null);return f.useEffect(()=>{if(a.current&&a.current.abort(),t([]),d(null),l(null),!e){o(!1);return}o(!0);const c=new AbortController;a.current=c;const s=async()=>{try{const g=await C(e,c.signal);if(c.signal.aborted)return;t(g.images),l(g.source),d(null)}catch(g){if(c.signal.aborted)return;d(g instanceof Error?g.message:"Failed to load images"),t([]),l(null)}finally{c.signal.aborted||o(!1)}},m=window.setTimeout(s,300);return()=>{c.abort(),window.clearTimeout(m)}},[e]),f.useEffect(()=>()=>{a.current&&a.current.abort()},[]),{images:n,isLoading:r,error:u,source:i}}function J({url:e}){const n=f.useMemo(()=>{const u=B(e);return u?{type:u,url:e,maxImages:150}:null},[e]),{images:t,isLoading:r,error:o}=D(n);return r?h.jsx("div",{className:"slideshow-container slideshow-loading","aria-hidden":!0,children:h.jsx("div",{className:"loading-message",children:"Loading images..."})}):o||t.length===0?null:h.jsx(T,{images:t})}function K({url:e}){const[n,t]=f.useState("video"),[r,o]=f.useState(e);if(f.useEffect(()=>{o(e),t("video")},[e]),!e)return null;const u=()=>{let i=!1;try{const c=new URL(e);i=c.host==="imgur.com"||c.host==="i.imgur.com"}catch{i=!1}if(i){const c=e.match(/imgur\.com\/([a-zA-Z0-9]+)/)?.[1];if(c){const s=`https://i.imgur.com/${c}.jpg`;o(s),t("image");return}}const a=`${e.replace(/\.(mp4|webm|ogg|mov)(\?.*)?$/i,"")}.jpg`;o(a),t("image")},d=()=>{let i=!1;try{const l=new URL(e);i=l.host==="imgur.com"||l.host==="i.imgur.com"}catch{i=!1}if(i){const l=e.match(/imgur\.com\/([a-zA-Z0-9]+)/)?.[1];if(l){const a=["png","gif","jpeg","webp"],c=r?.split(".").pop(),s=a.find(m=>m!==c);if(s){const m=`https://i.imgur.com/${l}.${s}`;o(m)}}}else{const l=["png","gif","jpeg","webp"],a=r?.split(".").pop(),c=l.find(s=>s!==a);if(c&&r){const m=`${r.replace(/\.[^.]+(\?.*)?$/,"")}.${c}`;o(m)}}};return n==="video"?h.jsx("video",{autoPlay:!0,loop:!0,muted:!0,playsInline:!0,src:r||void 0,className:"video-background",onError:u,preload:"auto",crossOrigin:"anonymous",controls:!0}):h.jsxs(h.Fragment,{children:[h.jsx("div",{className:"image-background",style:{backgroundImage:`url(${r})`,backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat",width:"100%",height:"100%",position:"absolute",top:0,left:0}}),h.jsx("img",{src:r||void 0,onError:d,style:{display:"none"},alt:""})]})}function he({url:e=null,isVideo:n=null}){const t=e&&/\.(mp4|webm|ogg|mov|gif)(\?.*)?$/i.test(e),o=!!(e?B(e):null),u=e==="color"||e==="gray"||e?.includes("/color")||e?.includes("/gray"),d=e&&!u&&(n||!n&&e);return h.jsxs(F,{className:L("main-container",!d&&"default-background"),role:"presentation",sx:{backgroundImage:!n&&e&&!u&&!o?`url(${e})`:"none"},children:[n&&!o&&(t?h.jsx(K,{url:e}):h.jsx("iframe",{width:"100%",height:"100%",src:e||void 0,title:"video",allow:"autoplay; fullscreen; encrypted-media; picture-in-picture",sandbox:"allow-same-origin allow-scripts allow-presentation",style:{border:0}})),!n&&o&&e?h.jsx(J,{url:e}):null]})}function W(e){const n=/vimeo\.com\/(\d+)/,t=e.match(n);return`https://player.vimeo.com/video/${t?t[1]:""}?autoplay=1&loop=1&autostart=true`}function V(e){const n=/(?:youtube\.com\/(?:[^/]+\/.+\/|(?:v|e(?:mbed)?)\/|[^#]*[?&]v=|youtu\.be\/)([^"&?/ ]{11})|^(?:[^"&?/ ]{11})$)/,t=e.match(n);return`https://www.youtube.com/embed/${t?t[1]:""}?autoplay=1&loop=1&autostart=true&mute=1&playsinline=1&controls=0&disablekb=1&fs=0&modestbranding=1&rel=0&iv_load_policy=3`}function q(e){const n=/drive\.google\.com\/file\/d\/([^/]+)/,t=e.match(n);return`https://drive.google.com/file/d/${t?t[1]:""}/preview?loop=1`}function G(e){const n=/dropbox\.com\/s\/([^/]+)/,t=e.match(n);return`https://www.dropbox.com/s/${t?t[1]:""}?raw=1`}function Q(e){return`https://pornhub.com/embed/${new URL(e).searchParams.get("viewkey")||""}?autoplay=1&loop=1&autostart=true&playsinline=1`}function X(e){const n=e.split("-");return`https://xhamster.com/xembed.php?video=${n[n.length-1]}?autoplay=1&loop=1&autostart=true&playsinline=1`}function Y(e){const n=/media\.tenor\.com\/([a-zA-Z0-9_-]+)\/[^/]*\.(mp4|gif|webp)/;if(e.match(n))return e;const r=/tenor\.com\/view\/[^/]*-(\d+)/,o=e.match(r);return`https://tenor.com/embed/${o?o[1]:""}?autoplay=1`}function ee(e){const n=/giphy\.com\/gifs\/[^/]*-([a-zA-Z0-9]+)/,t=e.match(n);return`https://media.giphy.com/media/${t?t[1]:""}/giphy.gif`}function te(e){const n=/(?:gfycat\.com|redgifs\.com)\/(?:watch\/)?([a-zA-Z0-9]+)/,t=e.match(n),r=t?t[1]:"";return p(e,["redgifs.com"])?`https://files.redgifs.com/${r}.mp4`:`https://giant.gfycat.com/${r}.mp4`}function ne(e){const n=/redtube\.com\/(\d+)/,t=e.match(n);return`https://embed.redtube.com/?id=${t?t[1]:""}&autoplay=true&auto_play=1&playsinline=1&controls=1`}function oe(e){const n=/youporn\.com\/watch\/(\d+)/,t=e.match(n);return`https://www.youporn.com/embed/${t?t[1]:""}?autoplay=1&playsinline=1`}function re(e){const n=/tube8\.com\/[^/]+\/[^/]+\/(\d+)/,t=e.match(n);return`https://www.tube8.com/embed/${t?t[1]:""}?autoplay=1&playsinline=1`}function se(e){return`https://twitframe.com/show?url=${encodeURIComponent(e)}`}function ae(e){try{const o=new URL(e);if((o.host==="discordapp.net"||o.host.endsWith(".discordapp.net"))&&o.pathname.startsWith("/external/")&&(o.pathname.includes("/https/i.imgur.com/")||o.pathname.includes("/https/imgur.com/")))return e}catch(o){R.debug("URL parsing failed for Discord proxy check:",o)}let n="",t=!1;try{const o=new URL(e);t=o.host==="imgur.com"||o.host==="i.imgur.com"}catch(o){return R.debug("URL parsing failed for Imgur processing:",o),""}if(!t)return"";if(e.includes("/gallery/")){const o=e.match(/imgur\.com\/gallery\/[^#]*#([a-zA-Z0-9]+)/);if(o)n=o[1];else{const u=e.match(/#([a-zA-Z0-9]+)/);u&&(n=u[1])}}else{const o=/imgur\.com\/([a-zA-Z0-9]+)(?:\.(mp4|jpg|jpeg|png|gif|webp))?|images-ext-\d+\.discordapp\.net\/external\/[^/]+\/https\/i\.imgur\.com\/([a-zA-Z0-9]+)\.(mp4|jpg|jpeg|png|gif|webp)/,u=e.match(o);n=u?u[1]||u[3]:""}return`https://i.imgur.com/${n}.mp4`}function N(e){return/\.(mp4|webm|ogg|mov)(\?.*)?$/.test(e)}function ie(e){return p(e,["media.discordapp.net","cdn.discordapp.com"])&&!N(e)}function p(e,n){try{const t=new URL(e);return n.some(r=>t.host===r||t.host.endsWith("."+r))}catch(t){return R.debug("URL parsing failed in isValidHost, rejecting for security:",t),!1}}function ce(e){let n=null,t=!0;if(!e)return{url:"",isVideo:!1};switch(!0){case p(e,["vimeo.com"]):n=W(e);break;case p(e,["youtube.com","youtu.be"]):n=V(e);break;case p(e,["drive.google.com"]):n=q(e);break;case p(e,["pornhub.com"]):n=Q(e);break;case p(e,["xhamster.com"]):n=X(e);break;case p(e,["dropbox.com"]):n=G(e);break;case p(e,["imgur.com","i.imgur.com"]):n=ae(e);break;case p(e,["tenor.com","media.tenor.com"]):n=Y(e),t=!0;break;case p(e,["giphy.com"]):n=ee(e),t=!0;break;case p(e,["gfycat.com","redgifs.com"]):n=te(e),t=!0;break;case p(e,["redtube.com"]):n=ne(e);break;case p(e,["youporn.com"]):n=oe(e);break;case p(e,["tube8.com"]):n=re(e);break;case p(e,["twitter.com","x.com"]):n=se(e),t=!1;break;case p(e,["thisvid.com"]):n=e;break;case p(e,["boyfriendtv.com"]):n=e;break;case ie(e):n=e,t=!1;break;case N(e):n=e;break;default:n=_(e),t=!1;break}return{url:n,isVideo:t}}function ye(e,n){const{background:t,backgroundURL:r,roomBackground:o,roomBackgroundURL:u}=e,d=(a,c)=>{if(!a)return null;if(a==="custom")return c?u||null:r||null;if(a==="useAppBackground"){const s=t||"color";return s==="useRoomBackground"?"color":s==="custom"?r||null:s}if(a==="useRoomBackground"){if(j(n))return"color";const s=o||"useAppBackground";return s==="useAppBackground"?"color":s==="custom"?u||null:s}return a};let i=null;return!j(n)&&o&&o!=="useAppBackground"?i=d(o,!0):t?i=d(t,!1):i="color",i?i==="color"||i==="gray"?{url:i,isVideo:!1}:ce(i):{url:null,isVideo:!1}}function ue(e){return{uid:e.uid,displayName:e.displayName,isSelf:e.isSelf,isFinished:e.isFinished}}function be(e){const[n,t]=f.useState(null),r=M(),o=f.useMemo(()=>r.map(d=>`${d.uid}-${d.displayName}-${d.isFinished}-${d.isSelf}`).join("|"),[r]),u=f.useMemo(()=>e?`${e.uid}-${e.displayName||""}`:null,[e]);return f.useEffect(()=>{if(!e){t(null);return}if(r.length<=1){t(null);return}const d=r.filter(s=>!s.isFinished);if(d.length<=1){t(null);return}let i=-1;i=d.findIndex(s=>s.uid===e.uid),i===-1&&(i=d.findIndex(s=>s.displayName===e.displayName)),i===-1&&(i=0);const l=(i+1)%d.length,a=d[l],c=ue(a);t(c)},[u,o]),n}export{he as R,ye as g,ce as p,be as u};
