import{a as b}from"./chunk-CNqt7FHs.js";(function(){var e=typeof window!="undefined"?window:typeof global!="undefined"?global:typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:{};e.SENTRY_RELEASE={id:"874067a760cfa9079dd7f585e4ceff298b0e879f"}})();try{(function(){var e=typeof window!="undefined"?window:typeof global!="undefined"?global:typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:{},r=new e.Error().stack;r&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[r]="2c79fbad-1916-4638-8527-9d569e47350b",e._sentryDebugIdIdentifier="sentry-dbid-2c79fbad-1916-4638-8527-9d569e47350b")})()}catch(e){}var v=Object.defineProperty,l=Object.getOwnPropertySymbols,_=Object.prototype.hasOwnProperty,m=Object.prototype.propertyIsEnumerable,p=(e,r,t)=>r in e?v(e,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[r]=t,w=(e,r)=>{for(var t in r||(r={}))_.call(r,t)&&p(e,t,r[t]);if(l)for(var t of l(r))m.call(r,t)&&p(e,t,r[t]);return e},y=e=>typeof e=="symbol"?e:e+"",h=(e,r)=>{var t={};for(var n in e)_.call(e,n)&&r.indexOf(n)<0&&(t[n]=e[n]);if(e!=null&&l)for(var n of l(e))r.indexOf(n)<0&&m.call(e,n)&&(t[n]=e[n]);return t};const u=50,M=b((e,r)=>({onlineUsers:{},loading:!1,error:null,room:null,_performanceMetrics:{lastUpdateTime:Date.now(),updateCount:0,averageUpdateInterval:0},_pendingUpdates:{},_batchTimeout:null,setUsers:t=>{const n=Date.now();e(a=>{const o=n-a._performanceMetrics.lastUpdateTime,s=a._performanceMetrics.updateCount+1,i=(a._performanceMetrics.averageUpdateInterval*a._performanceMetrics.updateCount+o)/s;return{onlineUsers:t,loading:!1,error:null,_performanceMetrics:{lastUpdateTime:n,updateCount:s,averageUpdateInterval:i}}})},addUser:(t,n)=>{const a=r();a._pendingUpdates[t]=n,a._batchTimeout&&clearTimeout(a._batchTimeout);const o=setTimeout(()=>{a.flushPendingUpdates()},u);e({_batchTimeout:o})},removeUser:t=>{const n=r();n._pendingUpdates[t]=null,n._batchTimeout&&clearTimeout(n._batchTimeout);const a=setTimeout(()=>{n.flushPendingUpdates()},u);e({_batchTimeout:a})},batchUpdateUsers:t=>e(n=>{const a=w({},n.onlineUsers);Object.entries(t).forEach(([d,f])=>{if(f===null){const c=a,{[d]:T}=c,g=h(c,[y(d)]);Object.assign(a,g)}else a[d]=f});const o=Date.now(),s=o-n._performanceMetrics.lastUpdateTime,i=n._performanceMetrics.updateCount+1,U=(n._performanceMetrics.averageUpdateInterval*n._performanceMetrics.updateCount+s)/i;return{onlineUsers:a,_performanceMetrics:{lastUpdateTime:o,updateCount:i,averageUpdateInterval:U}}}),flushPendingUpdates:()=>{const t=r();Object.keys(t._pendingUpdates).length!==0&&(t.batchUpdateUsers(t._pendingUpdates),e(()=>({_pendingUpdates:{}})))},clearUsers:()=>e(()=>({onlineUsers:{},loading:!1,error:null,_pendingUpdates:{}})),setLoading:t=>e(()=>({loading:t})),setError:t=>e(()=>({error:t,loading:!1})),setRoom:t=>e(()=>({room:t})),getUsersByRoom:t=>{const n=r();return n.onlineUsers},getActiveUserCount:()=>{const t=r();return Object.keys(t.onlineUsers).length},getPerformanceMetrics:()=>r()._performanceMetrics}));export{M as u};
//# sourceMappingURL=chunk-AkXvan0D.js.map
