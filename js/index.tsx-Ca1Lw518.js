import{j as e,t as l,r as y,u as N,s as E}from"./chunk-DDoLnHI0.js";import{C as F}from"./chunk-bqvoNmJe.js";import{u as P}from"./chunk-BICGdz9x.js";import{b as T,R as W,Y as k,S as G,I as M,c as K,d as B,G as V}from"./chunk-8ZYOspRI.js";import{B as j,T as m,h as b,an as Y,O as z,ao as U,ap as q,aq as $,ar as H,w as X,as as _,at as J,au as Q,av as Z,E as D,S as ee,C as ne,aw as se,ax as te,ay as ie,D as re,x as oe,y as ae,z as le}from"./chunk-D59Sa5ya.js";import{i as v,a as S}from"./chunk-Bp62TkGl.js";import{t as I}from"./chunk-Dk7I1tJi.js";import{u as ce,a as de}from"./chunk-B0nG6Nel.js";import"./chunk-CtIAsvv6.js";import"./chunk-CoPHbQIg.js";import"./chunk-BDM5WtNj.js";import"./chunk-CXIw3Iqt.js";import"../assets/index-BodytYbc.js";import"./chunk-CbUvEgHM.js";import"./chunk-COViFSNc.js";import"./chunk-BmcVylZL.js";import"./chunk-B4PEA_xj.js";import"./chunk-CrCBoQmf.js";import"./chunk-BFzXl2Wc.js";import"./chunk-Ds_NjC-1.js";function C({children:n,justifyContent:s="space-evenly"}){return e.jsx(j,{sx:{mt:3,display:"flex",flexDirection:"row",justifyContent:s,alignItems:"center"},children:n})}function ue({formData:n,setFormData:s,nextStep:o}){const i=T();function t(){i(n.room),o(v(n.room)?2:1)}return e.jsxs(j,{sx:{m:1},children:[e.jsx(m,{variant:"h6",children:e.jsx(l,{i18nKey:"publicOrPrivate"})}),e.jsx(j,{sx:{margin:"0.5rem"},children:e.jsx(W,{formData:n,setFormData:s})}),e.jsx(C,{children:e.jsx(b,{variant:"contained",onClick:t,children:e.jsx(l,{i18nKey:v(n.room)?"nextSkip":"next"})})})]})}function xe({formData:n,setFormData:s,nextStep:o,prevStep:i}){const[t,a]=y.useState(!S(n?.gameMode));return y.useEffect(()=>{a(!S(n?.gameMode))},[n?.gameMode]),e.jsxs(j,{sx:{minHeight:"200px",display:"flex",flexDirection:"column"},children:[e.jsx(m,{variant:"h6",children:e.jsx(l,{i18nKey:"playingWithPeople"})}),e.jsx(k,{trueCondition:!S(n?.gameMode),onChange:r=>s({...n,gameMode:r.target.checked?"local":"online",roomRealtime:!r.target.checked}),yesLabel:"yesInteracting"}),e.jsx(Y,{in:t,timeout:500,sx:{mt:t?2:0},children:e.jsxs(j,{children:[e.jsx(m,{variant:"h6",children:e.jsx(l,{i18nKey:"yourRole"})}),e.jsx(j,{sx:{display:"flex",justifyContent:"center"},children:e.jsx(G,{value:n.role,onChange:r=>s({...n,role:r.target.value}),label:"mainRole",options:["dom","vers","sub"],defaultValue:"sub",fullWidth:!1})}),e.jsx(m,{variant:"h6",sx:{mt:1},children:e.jsx(l,{i18nKey:"areYouNaked"})}),e.jsx(m,{variant:"body2",sx:{mt:1},children:e.jsx(l,{i18nKey:"nakedDisclaimer"})}),e.jsx(k,{onChange:r=>s({...n,isNaked:r.target.checked}),trueCondition:n.isNaked,yesLabel:"yesNaked"})]})}),e.jsx(j,{sx:{flexGrow:1}}),e.jsxs(C,{children:[e.jsx(b,{onClick:i,children:e.jsx(l,{i18nKey:"previous"})}),e.jsx(b,{variant:"contained",onClick:o,children:e.jsx(l,{i18nKey:"next"})})]})]})}function R(){return e.jsxs(m,{variant:"h6",sx:{mt:2},children:[e.jsx(l,{i18nKey:"setIntensityLevel"}),e.jsx(z,{title:e.jsx(m,{variant:"body1",children:e.jsx(l,{i18nKey:"intensityTooltip"})}),arrow:!0,sx:{ml:1},children:e.jsx(U,{sx:{ml:.5,fontSize:15}})})]})}const pe=(n,s)=>{const{gameMode:o,isNaked:i}=n,t=S(o);return t&&["foreplay","sex"].includes(s.type)||!t&&i&&["solo","foreplay"].includes(s.type)||!t&&!i&&["solo","sex"].includes(s.type)},he=n=>Object.entries(n).reduce((s,[o,i])=>(pe(n,i)||(s[o]=i),s),{}),w=(n,s,o)=>Object.entries(n).map(([i,t])=>{const a=s.find(r=>r.value===i);return t.type!==o||!a?null:i}).filter(i=>!!i),je=(n,s,o)=>{const i={...n};return Object.keys(i).forEach(t=>{i[t].type===s&&!o.includes(t)&&delete i[t]}),i},A=(n,s,o)=>{o(i=>{const t=je(i,s,n);return n.forEach(a=>{if(t[a])return;let r={type:s,level:1};s==="consumption"&&(r={...r,variation:t.isAppend?"appendMost":"standalone"}),t[a]=r}),t})},L=(n,s,o,i,t,a=null)=>{const r=n?.target?.value;if(r===0)return t(c=>c.filter(u=>u!==s)),i(c=>{const u={...c};return delete u[s],u});i(c=>({...c,[s]:{...c[s]||{},type:o,level:r,...!!a&&{variation:a}}}))};function O({onChange:n,values:s,options:o,label:i}){function t(a){return o?.find(r=>r.value===a)?.label}return e.jsxs(q,{fullWidth:!0,children:[e.jsx($,{id:`${i}-label`,children:i}),e.jsx(H,{labelId:`${i}-label`,id:`${i}`,multiple:!0,value:s,onChange:n,fullWidth:!0,input:e.jsx(Z,{label:e.jsx(l,{i18nKey:"actionsLabel"})}),renderValue:a=>e.jsx(j,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:a?.map(r=>e.jsx(Q,{label:t(r)},r))}),children:o?.map(({label:a,value:r})=>e.jsxs(X,{value:r,children:[e.jsx(_,{checked:s.includes(r)}),e.jsx(J,{primary:a})]},r))})]})}const me=2;function ge({formData:n,setFormData:s,options:o,actionsList:i}){const t="consumption",a=o(t),c=w(n,a,t)||[],u=d=>{const{value:p}=d.target,f=typeof p=="string"?p.split(","):p;f.length<=me&&A(f,t,s)},x=(d,p)=>{const f=p.reduce((h,g)=>(h[g]={...h[g]||{},type:t,variation:d.target.checked?"appendMost":"standalone"},h),{...n,isAppend:d.target.checked});s(f)};return e.jsxs(e.Fragment,{children:[e.jsx(m,{variant:"h6",sx:{my:2},children:e.jsx(l,{i18nKey:"pickConsumptions"})}),e.jsx(O,{onChange:u,values:c,options:a,label:I("consumables")}),!!c.length&&e.jsxs(e.Fragment,{children:[e.jsx(R,{}),c.map(d=>e.jsx(M,{actionsFolder:i,settings:n,option:d,initValue:1,onChange:p=>L(p,d,t,s,()=>{},n.isAppend?"appendMost":"standalone")},d)),e.jsx(m,{variant:"h6",sx:{mt:2},children:e.jsx(l,{i18nKey:"standaloneOrCombine"})}),e.jsx(k,{trueCondition:n.isAppend,onChange:d=>x(d,c),yesLabel:"combineWithActions"})]})]})}const ye=4,fe=n=>S(n?.gameMode)?"solo":n.isNaked?"sex":"foreplay";function be({formData:n,setFormData:s,options:o,actionsList:i}){const t=fe(n),a=o(t),c=w(n,a,t)||[],u=x=>{const{value:d}=x.target,p=typeof d=="string"?d.split(","):d;p.length<=ye&&A(p,t,s)};return e.jsxs(e.Fragment,{children:[e.jsx(m,{variant:"h6",sx:{my:2},children:e.jsx(l,{i18nKey:"pickActions"})}),e.jsx(O,{onChange:u,values:c,options:a,label:I("actionsLabel")}),!!c.length&&e.jsxs(e.Fragment,{children:[e.jsx(R,{}),c.map(x=>e.jsx(M,{actionsFolder:i,settings:n,option:x,initValue:1,onChange:d=>L(d,x,t,s,()=>{})},x))]})]})}function Se({formData:n,setFormData:s,nextStep:o,prevStep:i,actionsList:t}){function a(u){return Object.keys(t).filter(x=>t[x]?.type===u)}y.useEffect(()=>{const u=he(n);s(u)},[]);const r=u=>a(u).map(x=>({value:x,label:t[x]?.label})),c=!Object.keys(n).some(u=>n[u].level>0&&n[u].variation!=="appendMost");return e.jsxs(j,{children:[e.jsx(m,{variant:"body1",sx:{my:2},children:e.jsx(l,{i18nKey:"actionsDisclaimer"})}),e.jsx(be,{formData:n,setFormData:s,options:r,actionsList:t}),e.jsx(ge,{formData:n,setFormData:s,options:r,actionsList:t}),e.jsxs(C,{children:[e.jsx(b,{onClick:()=>i(v(n.room)?2:1),children:e.jsx(l,{i18nKey:"previous"})}),e.jsx(b,{variant:"contained",disabled:c,onClick:o,children:e.jsx(l,{i18nKey:"next"})})]})]})}function ve({formData:n,setFormData:s,prevStep:o,actionsList:i,close:t}){const a=[100,100],r=[0,0],[c,u]=y.useState(K(n?.finishRange||[],r)),[x,d]=y.useState(!1),p=B();function f(g){s({...n,finishRange:g.target.checked?r:a}),u(g.target.checked)}y.useEffect(()=>{let g={...n,boardUpdated:!0};(!c||!K(n.finishRange||[],a))&&(g.finishRange=a),s(g)},[]);async function h(){d(!0);try{await p(n,i)}catch(g){console.error("Error submitting settings:",g)}finally{d(!1)}typeof t=="function"&&t()}return e.jsxs(j,{children:[e.jsx(m,{variant:"h6",sx:{my:2},children:e.jsx(l,{i18nKey:"WillYouOrgasm"})}),e.jsx(m,{variant:"body2",children:e.jsx(l,{i18nKey:"orgasmDisclaimer"})}),e.jsx(j,{sx:{display:"flex",justifyContent:"center",my:1},children:e.jsx(D,{control:e.jsx(ee,{checked:c,onChange:f}),label:e.jsx(l,{i18nKey:"yesOrgasm"})})}),e.jsxs(C,{children:[e.jsx(b,{onClick:o,disabled:x,children:e.jsx(l,{i18nKey:"previous"})}),e.jsx(b,{variant:"contained",onClick:h,disabled:x,startIcon:x?e.jsx(ne,{size:20,color:"inherit"}):null,children:e.jsx(l,{i18nKey:"buildGame"})})]})]})}function Ce({close:n}){const{id:s}=N(),[o,i]=y.useState(1),t={room:s};v(s)&&(t.gameMode="online",t.roomRealtime=!0);const[a,r]=ce({gameMode:"online",roomRealtime:!0,actions:[],consumption:[],role:"sub",boardUpdated:!1,room:s||"PUBLIC"},t),c=y.useRef(!0),{actionsList:u}=de(a.gameMode);y.useEffect(()=>{if(c.current){if(c.current=!1,a.advancedSettings){p();return}if(typeof n=="function"){if(v(s)){i(3);return}i(2)}}},[a,n,s]);const x=h=>{if(!Number.isInteger(h))return i(o+1);i(o+(h||1))},d=h=>{if(!Number.isInteger(h))return i(o-1);i(o-(h||1))},p=()=>i(0),f=()=>{switch(o){case 1:return e.jsx(ue,{formData:a,setFormData:r,nextStep:x});case 2:return e.jsx(xe,{formData:a,setFormData:r,nextStep:x,prevStep:d});case 3:return e.jsx(Se,{formData:a,setFormData:r,nextStep:x,prevStep:d,actionsList:u});case 4:return e.jsx(ve,{formData:a,setFormData:r,prevStep:d,actionsList:u,close:n});default:return null}};return o===0?e.jsx(V,{closeDialog:n}):e.jsxs(j,{children:[e.jsx(j,{sx:{width:"100%",mt:2,mb:4},children:e.jsx(se,{activeStep:o-1,alternativeLabel:!0,children:[1,2,3,4].map(h=>e.jsx(te,{children:e.jsx(ie,{})},h))})}),f(),e.jsx(re,{sx:{mt:3}}),e.jsx(b,{onClick:p,children:e.jsx(l,{i18nKey:"advancedSetup"})})]})}function Ue({open:n,close:s}){const o=P(),[i]=E();return i.get("importBoard")?null:e.jsxs(oe,{fullScreen:o,open:n,maxWidth:"md",children:[e.jsxs(ae,{children:[e.jsx(l,{i18nKey:"gameSettings"}),typeof s=="function"&&e.jsx(F,{close:s})]}),e.jsx(le,{children:e.jsx(Ce,{close:typeof s=="function"?s:void 0})})]})}export{Ue as default};
