const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["js/index.tsx-C0X7wFp5.js","js/chunk-DvBFtIbM.js","js/chunk-5s7Iwv9W.js","js/chunk-DOCQ1tws.js","js/chunk-Djc5J5TW.js","assets/index-CIqJBtU-.js","js/chunk-DXz8SlaL.js","js/chunk-CXuMvDAl.js","js/chunk-BmRT4g2-.js","js/schedule.tsx-D5dzm_vW.js","js/chunk-Bn7zZFp_.js","js/chunk-BZnAhivo.js","js/theme.tsx-CZrD7ei-.js","js/index.tsx-Den4aXV7.js","js/chunk-CzqEX3Xi.js","js/index.tsx-CgCKydgM.js","js/chunk-CXCFIhls.js","js/chunk-VAXWS4-A.js","js/chunk-B4PEA_xj.js","js/chunk-yLOK5aTh.js","js/chunk-BpZ0_LH0.js","js/chunk-DUMl-ShE.js","js/chunk-DBiQh3Qq.js","js/chunk-B0z70je4.js","js/chunk-EEYPXscb.js","js/chunk-hBUS0o3Y.js","js/chunk-QIyvx5Ml.js","js/index.tsx-aWCTy3OD.js"])))=>i.map(i=>d[i]);
import{A as d,_ as h}from"../assets/index-CIqJBtU-.js";import{a7 as _,ad as w,r as u,j as n,ae as C,af as v,ag as f,ah as E,ai as R,aj as T}from"./chunk-DvBFtIbM.js";import{p as S,g as A,A as D}from"./chunk-Djc5J5TW.js";import{a as b}from"./chunk-5s7Iwv9W.js";function m(e){if(!e)return null;try{if(typeof e.toDate=="function")return e.toDate();if(typeof e=="string"){const s=new Date(e);if(isNaN(s.getTime()))throw new Error("Invalid serialized timestamp format");return s}else if(typeof e=="number"){const s=e<3250368e4?e*1e3:e,t=new Date(s);if(isNaN(t.getTime()))throw new Error("Invalid numeric timestamp format");return t}else if(typeof e=="object"&&e.seconds!==void 0){const s=e,t=new Date(s.seconds*1e3+(s.nanoseconds||0)/1e6);if(isNaN(t.getTime()))throw new Error("Invalid Firestore timestamp object format");return t}else{if(e instanceof Date)return e;throw console.warn("Unsupported timestamp format:",typeof e,e),new Error(`Unsupported timestamp format: ${typeof e}`)}}catch(s){return console.warn("Failed to parse timestamp:",s),null}}function p(e){return e.sort((s,t)=>{const r=m(s.timestamp),a=m(t.timestamp);return!r||!a?0:r.getTime()-a.getTime()})}function l(e){return JSON.parse(JSON.stringify(e)).reverse()}function L(e,s){return l(e).find(t=>t.type===s)}function P(e,s,t="ASC"){let r=l(e);return t==="DESC"&&(r=r.reverse()),r.filter(a=>a.type===s)}function G(e,s){return l(e).find(s)}function N(e){return l(e)[0]}const O={messages:[],loading:!0,error:null,room:null,paginationCursor:null},B=b()(S((e,s)=>({...O,loadMessages:t=>{const a=p(t);e({messages:a,loading:!1,error:null})},addMessage:t=>{const{messages:r}=s();if(r.find(i=>i.id===t.id))return;const o=[...r,t],c=p(o);e({messages:c})},updateMessage:(t,r)=>{const{messages:a}=s();let o=!1;const c=a.map(i=>{if(i.id===t){const g={...i,...r};if(Object.keys(r).some(x=>i[x]!==r[x]))return o=!0,g}return i});if(o){const i=p(c);e({messages:i})}},clearMessages:()=>{e({messages:[],loading:!1,error:null})},setLoading:t=>{const{loading:r}=s();r!==t&&e({loading:t})},setError:t=>{const{error:r}=s();r!==t&&e({error:t})},setRoom:t=>{const{room:r}=s();r!==t&&e({room:t})},setPaginationCursor:t=>{const{paginationCursor:r}=s();r!==t&&e({paginationCursor:t})},getMessagesByType:t=>{const{messages:r}=s(),a=[];for(let o=0;o<r.length;o++)r[o].type===t&&a.push(r[o]);return a},getLatestMessage:()=>{const{messages:t}=s();return N(t)},getLatestMessageByType:t=>{const{messages:r}=s();return L(r,t)},getFilteredMessages:t=>{const{messages:r}=s(),a=[];for(let o=0;o<r.length;o++)t(r[o])&&a.push(r[o]);return a},getOrderedMessagesByType:(t,r="ASC")=>{const{messages:a}=s();return P(a,t,r)}}),{name:"messages-storage",partialize:e=>({messages:e.messages,room:e.room,paginationCursor:e.paginationCursor}),onRehydrateStorage:()=>e=>{if(e){const s=new Date;s.setHours(s.getHours()-24);const t=e.messages.filter(r=>{try{const a=m(r.timestamp);if(!a)throw console.warn(`Failed to parse timestamp for message ${r.id}:`,typeof r.timestamp,r.timestamp),new Error(`Failed to parse timestamp for message ${r.id}`);return a>s}catch(a){return console.warn(`Failed to parse message timestamp for message ID ${r.id}:`,a.message),!0}});t.length!==e.messages.length&&e.loadMessages(t)}}})),F=_.createContext(void 0);function y(e){const{id:s}=w(),{messages:t,loading:r,loadMessages:a,setLoading:o,setRoom:c,clearMessages:i}=B();u.useEffect(()=>{if(o(!0),c(s||null),!s){i();return}return A(s,M=>{a(M)})},[s,a,o,c,i]);const g={messages:t,isLoading:r};return n.jsx(F.Provider,{value:g,...e})}const I=u.lazy(()=>h(()=>import("./index.tsx-C0X7wFp5.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14]))),z=u.lazy(()=>h(()=>import("./index.tsx-CgCKydgM.js"),__vite__mapDeps([15,1,2,16,11,3,4,5,6,7,17,18,19]))),U=u.lazy(()=>h(()=>import("./chunk-BpZ0_LH0.js").then(e=>e.i),__vite__mapDeps([20,5,1,2,11,3,4,6,7,16,19,8,9,10,12,21,18,22,23,24,25,26,17,27])));function j({children:e}){const{id:s}=w(),t=R(),r=T();return u.useEffect(()=>{if(s&&s!==s.toUpperCase()){const a=r.pathname.replace(s,s.toUpperCase());t(a+r.search+r.hash,{replace:!0})}},[s,t,r]),n.jsx(n.Fragment,{children:e})}function $(){const e=u.useContext(D);if(u.useEffect(()=>(e&&(window.authContext=e),()=>{window.authContext=null}),[e]),!e||e.initializing)return n.jsx(d,{});const s=e.user?n.jsx(U,{}):n.jsx(I,{});return n.jsxs(v,{children:[n.jsx(f,{path:"/",element:n.jsx(E,{replace:!0,to:"/PUBLIC"})}),n.jsx(f,{path:"/:id/cast",element:n.jsx(j,{children:n.jsx(y,{children:n.jsx(u.Suspense,{fallback:n.jsx(d,{}),children:n.jsx(z,{})})})})}),n.jsx(f,{path:"/:id",element:n.jsx(j,{children:n.jsx(y,{children:n.jsx(u.Suspense,{fallback:n.jsx(d,{}),children:s})})})})]})}function k(){return n.jsx(C,{children:n.jsx($,{})})}const K=Object.freeze(Object.defineProperty({__proto__:null,default:k},Symbol.toStringTag,{value:"Module"}));export{F as M,N as a,G as b,K as i,L as l,P as o,m as p};
