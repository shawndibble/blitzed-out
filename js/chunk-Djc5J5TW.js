const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["js/index.tsx-CFMjgz5m.js","js/chunk-DvBFtIbM.js","js/chunk-5s7Iwv9W.js","js/theme.tsx-CZrD7ei-.js","assets/index-CIqJBtU-.js","js/chunk-DXz8SlaL.js","js/chunk-BZnAhivo.js","js/chunk-C03U0xcW.js","js/chunk-Bn7zZFp_.js","js/chunk-D6sbZWTG.js","js/chunk-DBiQh3Qq.js","js/chunk-B0z70je4.js","js/userList.tsx-DiCdAsTV.js","js/chunk-CXuMvDAl.js","js/schedule.tsx-D5dzm_vW.js"])))=>i.map(i=>d[i]);
var Xe=Object.defineProperty;var Ze=(e,t,r)=>t in e?Xe(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var ee=(e,t,r)=>Ze(e,typeof t!="symbol"?t+"":t,r);import{A as me,_ as z}from"../assets/index-CIqJBtU-.js";import{aa as re,r as A,j as S,a7 as et}from"./chunk-DvBFtIbM.js";import{g as C,E as tt,l as rt,s as nt,a as st,u as ye,c as ot,G as at,b as it,d as ct,e as ut,f as oe,h as x,i as Oe,T as lt,j as dt,k as mt,m as j,n as xe,o as ft,r as gt,p as yt,q as ht,t as J,w as V,v as ne,x as se,y as Le,z as Be,A as wt,B as pt,C as ae}from"./chunk-DXz8SlaL.js";import{r as At,D as vt,n as Re,a as Et}from"./chunk-5s7Iwv9W.js";class Y extends Error{constructor(t,r,s){super(t),this.code=r,this.cause=s,this.name="AppError"}}class H extends Y{constructor(t,r,s){super(t,r,s),this.name="AuthError"}}function qe(e){return e instanceof Y}function he(e){return e instanceof Error}function q(e){return he(e)?e.message:typeof e=="string"?e:"An unknown error occurred"}function Tt(e){if(qe(e)||he(e)&&"code"in e)return e.code}function Q(e,t="An unexpected error occurred"){return qe(e)?e:he(e)?new Y(e.message||t,void 0,e):typeof e=="string"?new Y(e):new Y(t)}const Ce={"auth/user-not-found":"No account found with this email address","auth/wrong-password":"Incorrect password","auth/email-already-in-use":"An account with this email already exists","auth/weak-password":"Password is too weak","auth/invalid-email":"Invalid email address","auth/too-many-requests":"Too many login attempts. Please try again later","auth/network-request-failed":"Network error. Please check your connection","permission-denied":"You do not have permission to perform this action",unavailable:"Service is temporarily unavailable. Please try again"};function $(e){const t=Tt(e);return t&&Ce[t]?Ce[t]:q(e)}var Ct=At();const Ne={apiKey:"AIzaSyCKS7tWQRYRWHsawNfN42uAmISdUbJHJJw",authDomain:"blitzout-49b39.firebaseapp.com",projectId:"blitzout-49b39",storageBucket:"blitzout-49b39.appspot.com",messagingSenderId:"852428606926",appId:"1:852428606926:web:17444e6f8dbc2f95f0ef9f",measurementId:"G-93YN1YMTQ7"},be=Object.entries(Ne).filter(([e,t])=>!t).map(([e])=>e);be.length>0&&(console.error("Missing Firebase environment variables:",be),console.error("Please check your .env file and ensure all VITE_FIREBASE_* variables are set"));const bt=ht(Ne),I=Oe(bt);async function St(e=""){try{const t=C();return await ut(t),t.currentUser?(await ye(t.currentUser,{displayName:e}),t.currentUser):null}catch(t){throw console.error("Anonymous login error:",t),new H($(t),"ANONYMOUS_LOGIN_FAILED",Q(t))}}async function Dt(e,t,r=""){try{const s=C(),n=await ot(s,e,t);return await ye(n.user,{displayName:r}),n.user}catch(s){throw console.error("Registration error:",s),new H($(s),"REGISTRATION_FAILED",Q(s))}}async function _t(e,t){try{const r=C();return(await ct(r,e,t)).user}catch(r){throw console.error("Email login error:",r),new H($(r),"EMAIL_LOGIN_FAILED",Q(r))}}async function Mt(){try{const e=C(),t=new at;return(await it(e,t)).user}catch(e){throw console.error("Google login error:",e),new H($(e),"GOOGLE_LOGIN_FAILED",Q(e))}}async function It(e){try{const t=C();return await st(t,e),!0}catch(t){throw console.error("Password reset error:",t),new H($(t),"PASSWORD_RESET_FAILED",Q(t))}}async function Pt(e,t){try{const s=C().currentUser;if(s?.isAnonymous){const n=tt.credential(e,t);return(await rt(s,n)).user}else throw new Error("User is not anonymous or not logged in")}catch(r){throw console.error("Account conversion error:",r),new H($(r),"ACCOUNT_CONVERSION_FAILED",Q(r))}}async function Gt(){try{const e=C();return await nt(e),!0}catch(e){throw console.error(e),e}}function Pr(e,t,r={},s={}){if(!e)return;const{enableCache:n=!0,enableDebounce:o=!0}=s,a=e.toUpperCase(),c=pe("userList",a),i=Date.now();if(n){const u=D.get(c);if(u&&Ae(u,c)){u.queryCount++,D.set(c,u),_(c,Date.now()-i,!0);const l=Object.keys(u.data).sort().join(","),p=r?Object.keys(r).sort().join(","):"";l!==p&&t(u.data);return}}const m=async()=>{let u=!1;try{await ie();const l=ft(),p=gt(l,"users");yt(p,h=>{const E=Date.now(),d=E-i,T=h.val();if(!T){t({});return}const b={};Object.entries(T).forEach(([O,M])=>{M.room===a&&(b[O]={displayName:M.displayName,uid:O,lastSeen:M.lastSeen?new Date(M.lastSeen):new Date,isAnonymous:M.isAnonymous,joinedAt:M.joinedAt?new Date(M.joinedAt):new Date,room:M.room})});const g=b;if(n){we();const O=K(c);D.set(c,{data:g,timestamp:E,queryCount:1,priority:O})}_(c,d,!1,u);const v=Object.keys(g).sort().join(","),U=r?Object.keys(r).sort().join(","):"";v!==U&&t(g)},h=>{u=!0,console.error("getUserList error:",h),_(c,Date.now()-i,!1,!0)})}catch(l){u=!0,console.error("getUserList connection error:",l),_(c,Date.now()-i,!1,!0)}finally{ce()}};o?ve(c,m):m()}async function Ut(e=""){try{const t=C();return t.currentUser?(await ye(t.currentUser,{displayName:e}),t.currentUser):null}catch(t){return console.error(t),null}}async function Gr(e,t){try{await oe(x(I,"custom-actions"),{grouping:e,customAction:t,ttl:new Date(Date.now()+5760*60*1e3)})}catch(r){console.error(r)}}async function Ot(e){const t=J(x(I,"game-boards"),V("checksum","==",e)),r=await wt(t);return r.size?r.docs[0]:null}async function Ur({title:e,gameBoard:t,settings:r}){if(e)try{const s=Ct.sha256(t),n=await Ot(s);return n?(mt(n.ref,{ttl:new Date(Date.now()+720*60*60*1e3)}),n):await xt({title:e,gameBoard:t,settings:r,checksum:s})}catch(s){console.error(s)}}async function xt({title:e,gameBoard:t,settings:r,checksum:s}){try{return await oe(x(I,"game-boards"),{title:e,gameBoard:t,settings:r,checksum:s,ttl:new Date(Date.now()+720*60*60*1e3)})}catch(n){console.error(n);return}}async function Or(e){try{const t=j(I,"game-boards",e),r=await xe(t);return r.exists()?r.data():void 0}catch(t){console.error(t);return}}let Se={};const D=new Map,F=new Map,De=15e3,Lt=5e3,_e=150,Bt=50,ke=50,Rt=100,N={activeConnections:0,maxConnections:15,connectionQueue:[]},Me=new Map;function _(e,t,r,s=!1){const n=Me.get(e)||{queryCount:0,totalLatency:0,cacheHits:0,lastQueryTime:0,avgLatency:0,p95Latency:0,connectionPoolHits:0,networkErrors:0,latencyHistory:[]};if(n.queryCount++,n.totalLatency+=t,n.lastQueryTime=Date.now(),n.avgLatency=n.totalLatency/n.queryCount,n.latencyHistory.push(t),n.latencyHistory.length>20&&n.latencyHistory.shift(),n.latencyHistory.length>=5){const o=[...n.latencyHistory].sort((c,i)=>c-i),a=Math.floor(o.length*.95);n.p95Latency=o[a]}r&&n.cacheHits++,s&&n.networkErrors++,Me.set(e,n)}function K(e){return e.includes("messages")?"high":e.includes("userList")?"medium":"low"}function qt(e){switch(e){case"high":return Lt;case"medium":return De;case"low":return De*2}}function Nt(e){switch(e){case"high":return Bt;case"medium":return _e;case"low":return _e*2}}function we(){if(D.size<=Rt)return;const e=Array.from(D.entries());e.sort(([,r],[,s])=>{const n={low:0,medium:1,high:2},o=n[r.priority]-n[s.priority];if(o!==0)return o;const a=r.queryCount-s.queryCount;return a!==0?a:r.timestamp-s.timestamp});const t=Math.ceil(D.size*.2);for(let r=0;r<t;r++)D.delete(e[r][0])}function ie(){return new Promise(e=>{N.activeConnections<N.maxConnections?(N.activeConnections++,e()):N.connectionQueue.push(()=>{N.activeConnections++,e()})})}function ce(){if(N.activeConnections--,N.connectionQueue.length>0){const e=N.connectionQueue.shift();e&&e()}}function pe(e,t,r){return`${e}:${t||"global"}:${r||""}`}function Ae(e,t){const r=K(t),s=qt(r);return Date.now()-e.timestamp<s}function ve(e,t,...r){const s=K(e),n=Nt(s),o=F.get(e);o&&clearTimeout(o);const a=setTimeout(async()=>{try{await ie(),t(...r)}catch(c){console.error("Query execution error:",c)}finally{ce(),F.delete(e)}},n);F.set(e,a)}async function xr({room:e,user:t,text:r="",type:s="chat",...n}){const o=["chat","actions","settings","room","media"];if(!o.includes(s)){let m="Invalid message type. Was expecting ";return m+=o.join(", "),m+=` but got ${s}`,console.error(m)}if(!t?.uid)return;const a={room:e,user:t.uid,text:r,type:s,...n};if(JSON.stringify(a)===JSON.stringify(Se))return;Se=a;const c=Date.now(),i=e?.toUpperCase()||"PUBLIC";try{return await oe(x(I,"chat-rooms",i,"messages"),{text:r.trim(),ttl:new Date(c+864e5),type:s,...n,uid:t.uid,displayName:t.displayName,timestamp:dt()})}catch(m){console.error("Failed to send message:",m);return}}async function Lr(e,t){return pt(j(I,`/chat-rooms/${e.toUpperCase()}/messages/${t}`))}function Br(e,t,r={}){if(!e)return;const s=C();if(!s.currentUser){let n,o;return n=s.onAuthStateChanged(a=>{a&&(o=Ie(e,t,r),n&&(n(),n=void 0))}),()=>{n&&n(),o&&o()}}return Ie(e,t,r)}function Ie(e,t,r={}){const{limitCount:s=ke,startAfterDoc:n,enableCache:o=!0,enableDebounce:a=!0}=r,c=e.toUpperCase(),i=pe("messages",c,`limit:${s}`),m=Date.now();if(o){const l=D.get(i);if(l&&Ae(l,i))return l.queryCount++,D.set(i,l),_(i,Date.now()-m,!0),t(l.data),()=>{}}const u=()=>{let l=!1,p;try{ie();const h=new Date;h.setHours(h.getHours()-3);let E=J(x(I,"chat-rooms",c,"messages"),V("timestamp",">",h),ne("timestamp","asc"),se(s));return n&&(E=J(x(I,"chat-rooms",c,"messages"),V("timestamp",">",h),ne("timestamp","asc"),Le(n),se(s))),p=Be(E,d=>{const T=Date.now(),b=T-m,g=d.docs.map(v=>({id:v.id,...v.data()}));if(o&&g.length>0){we();const v=d.docs[d.docs.length-1],U=K(i);D.set(i,{data:g,timestamp:T,lastVisible:v,queryCount:1,priority:U})}_(i,b,!1,l),t(g)},d=>{l=!0,console.error("getMessages error:",d),_(i,Date.now()-m,!1,!0)}),p}catch(h){return l=!0,console.error("getMessages connection error:",h),_(i,Date.now()-m,!1,!0),()=>{}}finally{ce()}};if(a){let l;return ve(i,()=>{l=u()}),()=>{const p=F.get(i);p&&(clearTimeout(p),F.delete(i)),l&&l()}}return u()}function Rr(e,t={}){const{limitCount:r=ke,startAfterDoc:s,enableCache:n=!0,enableDebounce:o=!0}=t,a=pe("schedule",null,`limit:${r}`),c=Date.now();if(n){const u=D.get(a);if(u&&Ae(u,a))return u.queryCount++,D.set(a,u),_(a,Date.now()-c,!0),e(u.data),()=>{}}const i=async()=>{let u=!1,l;try{await ie();const p=new Date;p.setMinutes(p.getMinutes()-5);let h=J(x(I,"schedule"),V("dateTime",">",p),ne("dateTime","asc"),se(r));return s&&(h=J(x(I,"schedule"),V("dateTime",">",p),ne("dateTime","asc"),Le(s),se(r))),l=Be(h,E=>{const d=Date.now(),T=d-c,b=E.docs.map(g=>({id:g.id,...g.data()}));if(n&&b.length>0){we();const g=E.docs[E.docs.length-1],v=K(a);D.set(a,{data:b,timestamp:d,lastVisible:g,queryCount:1,priority:v})}_(a,T,!1,u),e(b)},E=>{u=!0,console.error("getSchedule error:",E),_(a,Date.now()-c,!1,!0)}),l||(()=>{})}catch(p){return u=!0,console.error("getSchedule connection error:",p),_(a,Date.now()-c,!1,!0),()=>{}}finally{ce()}};if(o){let u;return ve(a,async()=>{u=await i()}),()=>{const l=F.get(a);l&&(clearTimeout(l),F.delete(a)),u&&u()}}const m=i();return m instanceof Promise?()=>{}:m}async function qr(e,t,r="PUBLIC"){try{return await oe(x(I,"schedule"),{dateTime:lt.fromDate(e),url:t,room:r})}catch(s){return console.error(s)}}function kt(e={tables:["customTiles","gameBoard"]}){const{tables:t}=e,r=new Set(t),s={timeouts:{},queue:new Set,scheduleSync(n){this.timeouts[n]&&clearTimeout(this.timeouts[n]),this.queue.add(n),this.timeouts[n]=setTimeout(()=>{this.processSyncQueue()},2e3)},processSyncQueue(){if(this.queue.size===0)return;const n=window;n.authContext?.user&&!n.authContext.user.isAnonymous&&n.authContext.syncData(),this.queue.clear(),Object.keys(this.timeouts).forEach(o=>{clearTimeout(this.timeouts[o]),delete this.timeouts[o]})}};return{stack:"dbcore",name:"syncMiddleware",create(n){return{...n,table(o){const a=n.table(o);return r.has(o)?{...a,mutate:async c=>{const i=await a.mutate(c);return["put","add","delete","deleteRange","update"].includes(c.type)&&s.scheduleSync(o),i}}:a}}}}}class Ft extends vt{constructor(){super("blitzedOut");ee(this,"customTiles");ee(this,"gameBoard");ee(this,"customGroups");this.version(2).stores({customTiles:"++id, group, intensity, action, isEnabled, tags, gameMode, isCustom, locale",gameBoard:"++id, title, tiles, tags, gameMode, isActive"}),this.version(3).stores({customTiles:"++id, group, intensity, action, isEnabled, tags, gameMode, isCustom, locale",gameBoard:"++id, title, tiles, tags, gameMode, isActive",customGroups:"++id, name, label, locale, gameMode, isDefault, createdAt"}),this.version(4).stores({customTiles:"++id, group, intensity, action, isEnabled, tags, gameMode, isCustom, locale",gameBoard:"++id, title, tiles, tags, gameMode, isActive",customGroups:"++id, name, label, locale, gameMode, isDefault, createdAt, [name+locale+gameMode]"}).upgrade(async r=>{const s=await r.table("customGroups").toArray(),n=new Set;for(const o of s){const a=`${o.name}-${o.locale}-${o.gameMode}`;n.has(a)?await r.table("customGroups").delete(o.id):n.add(a)}})}}const k=new Ft;k.use(kt({tables:["customTiles","gameBoard","customGroups"]}));const Nr=Object.freeze(Object.defineProperty({__proto__:null,default:k},Symbol.toStringTag,{value:"Module"})),{customTiles:G}=k;G.hook("creating",function(e,t,r){t.locale===void 0&&(t.locale="en"),t.gameMode===void 0&&(t.gameMode="online"),t.isCustom===void 0&&(t.isCustom=1)});const jt=async e=>{const t=e.map(r=>({...r,isEnabled:1}));return await G.bulkAdd(t)},Fe=e=>{const t=["locale","gameMode","group","intensity","tag","isCustom","action"];let r=G.toCollection();return Object.entries(e).filter(([n])=>t.includes(n)).forEach(([n,o])=>{o==null||o===""||(n==="tag"?r=r.filter(a=>a.tags.includes(o)):r=r.filter(a=>a[n]===o))}),r},Ee=async(e={})=>{try{return await Fe(e).toArray()}catch(t){return console.error("Error in getTiles:",t),[]}},zt=async e=>{const{page:t=1,limit:r=50}=e;try{const s=Fe(e),n=await s.count(),o=(t-1)*r;return{items:await s.offset(o).limit(r).toArray(),total:n,page:t,limit:r,totalPages:Math.ceil(n/r)}}catch(s){return console.error("Error in getPaginatedTiles:",s),{items:[],total:0,page:t,limit:r,totalPages:0}}},je=(e="en",t="online")=>G.where("locale").equals(e).and(r=>r.gameMode===t),Ht=async(e="en",t="online",r=null)=>{let s=je(e,t);return r&&(s=s.and(o=>o.tags.some(a=>r.includes(a)))),(await s.toArray()).reduce((o,a)=>{const c=a.group;o[c]||(o[c]={count:0,intensities:{}}),o[c].count++;const i=Number(a.intensity);return o[c].intensities[i]||(o[c].intensities[i]=0),o[c].intensities[i]++,o},{})},Qt=(e=null)=>{const t=re.resolvedLanguage||re.language||"en";let r=G.where("locale").equals(t).and(s=>s.isEnabled===1);return e&&(r=r.and(s=>s.gameMode===e)),r.toArray()},ze=async e=>await G.add({...e,isEnabled:1}),$t=async(e,t)=>await G.update(e,t),Wt=async e=>{const t=await G.get(e);if(!t)throw new Error(`Custom tile with id ${e} not found`);return await G.update(e,{isEnabled:t.isEnabled?0:1})};async function He(){try{return await k.customTiles.where("isCustom").equals(1).delete(),!0}catch(e){return console.error("Error deleting custom tiles:",e),!1}}const Yt=async e=>{await G.delete(e)},Qe=(e,t="en",r="online")=>je(t,r).and(s=>s.group===e),Jt=async(e,t="en",r="online")=>{try{return await Qe(e,t,r).count()}catch(s){return console.error("Error counting tiles by group:",s),0}},Vt=async(e,t="en",r="online")=>{try{return await Qe(e,t,r).delete()}catch(s){return console.error("Error deleting tiles by group:",s),0}},kr=Object.freeze(Object.defineProperty({__proto__:null,addCustomTile:ze,countTilesByGroup:Jt,deleteAllIsCustomTiles:He,deleteCustomTile:Yt,deleteCustomTilesByGroup:Vt,getActiveTiles:Qt,getPaginatedTiles:zt,getTileCountsByGroup:Ht,getTiles:Ee,importCustomTiles:jt,toggleCustomTile:Wt,updateCustomTile:$t},Symbol.toStringTag,{value:"Module"})),{customGroups:B}=k;B.hook("creating",function(e,t,r){t.id||(t.id=Re()),t.locale===void 0&&(t.locale=re.resolvedLanguage||re.language||"en"),t.gameMode===void 0&&(t.gameMode="online"),t.isDefault===void 0&&(t.isDefault=!1);const s=new Date;t.createdAt||(t.createdAt=s),t.updatedAt=s});B.hook("updating",function(e,t,r,s){e.updatedAt=new Date});const Kt=e=>{const t=["locale","gameMode","name","isDefault"];let r=B.toCollection();return Object.entries(e).filter(([n])=>t.includes(n)).forEach(([n,o])=>{o==null||o===""||(r=r.filter(a=>a[n]===o))}),r},ue=async(e={})=>{try{return await Kt(e).toArray()}catch(t){return console.error("Error in getCustomGroups:",t),[]}},Te=async(e,t="en",r="online")=>{try{return await B.where("name").equals(e).and(s=>s.locale===t&&s.gameMode===r).first()}catch(s){console.error("Error in getCustomGroupByName:",s);return}},Xt=async e=>{try{const t={...e,createdAt:new Date,updatedAt:new Date};return await B.add(t)}catch(t){console.error("Error in addCustomGroup:",t);return}},Zt=async(e,t)=>{try{return await B.update(e,t)}catch(r){return console.error("Error in updateCustomGroup:",r),0}},$e=async e=>{try{await B.delete(e)}catch(t){console.error("Error in deleteCustomGroup:",t)}},We=async()=>{try{return await B.clear(),!0}catch(e){return console.error("Error deleting all custom groups:",e),!1}},Ye=async e=>{try{const t=new Date,r=e.map(s=>({name:s.name||"",label:s.label||"",intensities:s.intensities||[],id:s.id||Re(),locale:s.locale||"en",gameMode:s.gameMode||"online",isDefault:s.isDefault||!1,createdAt:s.createdAt||t,updatedAt:s.updatedAt||t}));return await B.bulkAdd(r)}catch(t){console.error("Error in importCustomGroups:",t);return}},er=async(e,t="en",r="online")=>{try{return(await Te(e,t,r))?.intensities||[]}catch(s){return console.error("Error in getGroupIntensities:",s),[]}},tr=async(e,t="en",r="online",s)=>{try{const n=await Te(e,t,r);return!!(!n||s&&n.id===s)}catch(n){return console.error("Error in isGroupNameUnique:",n),!1}},Je=async(e="en",t="online")=>{try{const r=await ue({locale:e,gameMode:t}),s=new Map;r.forEach(o=>{const a=s.get(o.name)||[];a.push(o),s.set(o.name,a)});let n=0;for(const[,o]of s)if(o.length>1){o.sort((a,c)=>{try{const i=a.createdAt instanceof Date?a.createdAt.getTime():new Date(a.createdAt).getTime(),m=c.createdAt instanceof Date?c.createdAt.getTime():new Date(c.createdAt).getTime();return i-m}catch(i){return console.warn("Date parsing failed in removeDuplicateGroups, using createdAt fallback:",i),a.createdAt.getTime()-c.createdAt.getTime()}});for(let a=1;a<o.length;a++)await $e(o[a].id),n++}return n}catch(r){return console.error("Error in removeDuplicateGroups:",r),0}},rr=async(e="en",t="online")=>{try{return await Je(e,t),(await ue({locale:e,gameMode:t})).filter((n,o,a)=>a.findIndex(c=>c.name===n.name)===o)}catch(r){return console.error("âŒ getAllAvailableGroups: Database error",{locale:e,gameMode:t,error:r}),[]}},Fr=Object.freeze(Object.defineProperty({__proto__:null,addCustomGroup:Xt,deleteAllCustomGroups:We,deleteCustomGroup:$e,getAllAvailableGroups:rr,getCustomGroupByName:Te,getCustomGroups:ue,getGroupIntensities:er,importCustomGroups:Ye,isGroupNameUnique:tr,removeDuplicateGroups:Je,updateCustomGroup:Zt},Symbol.toStringTag,{value:"Module"})),{gameBoard:L}=k,nr=()=>L.orderBy("title").toArray(),jr=async()=>L.where("isActive").equals(1)?.first(),sr=async e=>L.add(e),or=async(e,t)=>L.update(e.id,{...e,...t}),ar=async e=>{const t={title:e.title===void 0?"":e.title,tiles:e.tiles||[],isActive:e.isActive===void 0?1:e.isActive,tags:e.tags||[],gameMode:e.gameMode||"online"};if(!t?.title?.length&&t?.tiles?.length)return;const r=await L.where("title").equals(t.title).first();return k.transaction("rw",k.gameBoard,async()=>(t.isActive&&await ir(),r?(await or(r,e),r.id):await sr(t)))},zr=async e=>{const r=(await L.toArray()).map(s=>({...s,isActive:s.id===e?1:0}));await L.bulkPut(r)},Hr=async e=>{await L.delete(e)},ir=async()=>{await L.where("isActive").equals(1).modify({isActive:0})};function cr(e,t){let r;try{r=e()}catch{return}return{getItem:n=>{var o;const a=i=>i===null?null:JSON.parse(i,void 0),c=(o=r.getItem(n))!=null?o:null;return c instanceof Promise?c.then(a):a(c)},setItem:(n,o)=>r.setItem(n,JSON.stringify(o,void 0)),removeItem:n=>r.removeItem(n)}}const fe=e=>t=>{try{const r=e(t);return r instanceof Promise?r:{then(s){return fe(s)(r)},catch(s){return this}}}catch(r){return{then(s){return this},catch(s){return fe(s)(r)}}}},ur=(e,t)=>(r,s,n)=>{let o={storage:cr(()=>localStorage),partialize:d=>d,version:0,merge:(d,T)=>({...T,...d}),...t},a=!1;const c=new Set,i=new Set;let m=o.storage;if(!m)return e((...d)=>{console.warn(`[zustand persist middleware] Unable to update item '${o.name}', the given storage is currently unavailable.`),r(...d)},s,n);const u=()=>{const d=o.partialize({...s()});return m.setItem(o.name,{state:d,version:o.version})},l=n.setState;n.setState=(d,T)=>{l(d,T),u()};const p=e((...d)=>{r(...d),u()},s,n);n.getInitialState=()=>p;let h;const E=()=>{var d,T;if(!m)return;a=!1,c.forEach(g=>{var v;return g((v=s())!=null?v:p)});const b=((T=o.onRehydrateStorage)==null?void 0:T.call(o,(d=s())!=null?d:p))||void 0;return fe(m.getItem.bind(m))(o.name).then(g=>{if(g)if(typeof g.version=="number"&&g.version!==o.version){if(o.migrate){const v=o.migrate(g.state,g.version);return v instanceof Promise?v.then(U=>[!0,U]):[!0,v]}console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,g.state];return[!1,void 0]}).then(g=>{var v;const[U,O]=g;if(h=o.merge(O,(v=s())!=null?v:p),r(h,!0),U)return u()}).then(()=>{b?.(h,void 0),h=s(),a=!0,i.forEach(g=>g(h))}).catch(g=>{b?.(void 0,g)})};return n.persist={setOptions:d=>{o={...o,...d},d.storage&&(m=d.storage)},clearStorage:()=>{m?.removeItem(o.name)},getOptions:()=>o,rehydrate:()=>E(),hasHydrated:()=>a,onHydrate:d=>(c.add(d),()=>{c.delete(d)}),onFinishHydration:d=>(i.add(d),()=>{i.delete(d)})},o.skipHydration||E(),h||p},lr=ur,Pe={locale:"en",gameMode:"online",boardUpdated:!1,room:"PUBLIC",background:"color",selectedActions:{},hasSeenRollButton:!1,themeMode:"system"},X=Et()(lr(e=>({settings:Pe,updateSettings:t=>e(r=>({settings:{...r.settings,...t}})),setLocale:t=>e(r=>({settings:{...r.settings,locale:t}})),resetSettings:()=>e({settings:Pe}),updateSelectedAction:(t,r)=>e(s=>{const n={...s.settings.selectedActions};return r===null?delete n[t]:n[t]=r,{settings:{...s.settings,selectedActions:n}}}),removeSelectedAction:t=>e(r=>{const s={...r.settings.selectedActions};return delete s[t],{settings:{...r.settings,selectedActions:s}}}),clearSelectedActions:()=>e(t=>({settings:{...t.settings,selectedActions:{}}})),getSelectedActionsByType:t=>{const{selectedActions:r={}}=X.getState().settings;return Object.entries(r||{}).filter(([,n])=>n.type===t).reduce((n,[o,a])=>(n[o]=a,n),{})}}),{name:"gameSettings",partialize:e=>({settings:e.settings})})),Qr=()=>{const{settings:e,updateSettings:t}=X();return[e,t]},$r=()=>{const{settings:e,updateSettings:t}=X();return{settings:e,updateSettings:t}},Wr="None",Yr=3e4,Ge=500,Z=Oe();async function dr(){const t=C().currentUser;if(!t)return console.error("No user logged in"),!1;try{const r=await Ee({isCustom:1});return await ae(j(Z,"user-data",t.uid),{customTiles:r,lastUpdated:new Date},{merge:!0}),!0}catch(r){return console.error("Error syncing custom tiles:",r),!1}}async function mr(){const t=C().currentUser;if(!t)return console.error("No user logged in"),!1;try{const r=await ue();return await ae(j(Z,"user-data",t.uid),{customGroups:r,lastUpdated:new Date},{merge:!0}),!0}catch(r){return console.error("Error syncing custom groups:",r),!1}}async function fr(){const t=C().currentUser;if(!t)return console.error("No user logged in"),!1;try{const r=await nr();return r.length&&await ae(j(Z,"user-data",t.uid),{gameBoards:r,lastUpdated:new Date},{merge:!0}),!0}catch(r){return console.error("Error syncing game boards:",r),!1}}async function gr(){const t=C().currentUser;if(!t)return console.error("No user logged in"),!1;try{const{settings:r}=X.getState();return await ae(j(Z,"user-data",t.uid),{settings:r,lastUpdated:new Date},{merge:!0}),!0}catch(r){return console.error("Error syncing settings:",r),!1}}async function de(){return await dr(),await mr(),await fr(),await gr(),!0}async function ge(){const t=C().currentUser;if(!t)return console.error("No user logged in"),!1;try{const r=j(Z,"user-data",t.uid),s=await xe(r);if(!s.exists())return!1;const n=s.data();if(n.customTiles!==void 0&&(await He(),await new Promise(o=>setTimeout(o,Ge)),n.customTiles&&n.customTiles.length>0))for(const o of n.customTiles)try{(await Ee({gameMode:o.gameMode,group:o.group,intensity:o.intensity,action:o.action})).length===0&&await ze(o)}catch(a){console.error("Error importing custom tile:",o,a)}if(n.customGroups!==void 0&&(await We(),await new Promise(o=>setTimeout(o,Ge)),n.customGroups&&n.customGroups.length>0))try{await Ye(n.customGroups)}catch(o){console.error("Error importing custom groups:",o)}if(n.gameBoards&&n.gameBoards.length>0)for(const o of n.gameBoards)await ar({title:o.title,tiles:o.tiles,tags:o.tags||[],gameMode:o.gameMode||"online",isActive:o.isActive||0});if(n.settings)try{const{updateSettings:o}=X.getState(),a=n.settings;o(a)}catch(o){console.error("Error importing settings:",o)}return!0}catch(r){return console.error("Error syncing data:",r),!1}}let te=null;function Ue(e=5){W();const t=e*60*1e3;return te=window.setInterval(async()=>{const r=C();r.currentUser&&!r.currentUser.isAnonymous&&await ge()},t),!0}function W(){return te?(window.clearInterval(te),te=null,!0):!1}const Ve=et.createContext(void 0);function yr(e){const[t,r]=A.useState(null),[s,n]=A.useState(!1),[o,a]=A.useState(!0),[c,i]=A.useState(null),[m,u]=A.useState({syncing:!1,lastSync:null}),l=A.useRef(null),p=A.useRef(!1),h=A.useCallback(async y=>{if(l.current&&(clearTimeout(l.current),l.current=null),!t||t.isAnonymous)return!1;try{return u({syncing:!0,lastSync:m.lastSync}),await y(),u({syncing:!1,lastSync:new Date}),!0}catch(f){return console.error("Sync error:",f),f instanceof Error?i(f.message):i("An unknown error occurred"),u({syncing:!1,lastSync:m.lastSync}),!1}},[t,l,u,m.lastSync,i]);async function E(y=""){try{const f=await St(y);return r(f),f}catch(f){const w=q(f);throw i(w),f}}async function d(y,f){try{n(!0);const w=await _t(y,f);return r(w),w}catch(w){const P=q(w);throw i(P),w}finally{n(!1)}}async function T(){try{n(!0);const y=await Mt();return r(y),y}catch(y){const f=q(y);throw i(f),y}finally{n(!1)}}async function b(y,f,w){try{n(!0);const P=await Dt(y,f,w);return r(P),P}catch(P){const R=q(P);throw i(R),P}finally{n(!1)}}async function g(y){try{return await It(y),!0}catch(f){const w=q(f);throw i(w),f}}const v=A.useCallback(async(y,f)=>{try{n(!0);const w=await Pt(y,f);return r(w),await h(de),w}catch(w){throw w instanceof Error&&i(w.message),w}finally{n(!1)}},[n,r,h,i]);async function U(y=""){try{const f=await Ut(y);return r(f),f}catch(f){const w=q(f);throw i(w),f}}const O=A.useCallback(async()=>{try{if(t&&!t.isAnonymous){const y=h(de),f=new Promise(w=>setTimeout(w,5e3,!1));await Promise.race([y,f])}await Gt(),r(null)}catch(y){const f=q(y);throw i(f),y}},[t,h,r,i]),M=A.useCallback(async()=>h(de),[h]);A.useEffect(()=>{const f=C().onAuthStateChanged(w=>{if(r(w||null),p.current||(p.current=!0,a(!1)),w&&!w.isAnonymous){const P=()=>{l.current&&clearTimeout(l.current),l.current=setTimeout(()=>{u({syncing:!0,lastSync:null});let R;try{R=ge?ge():Promise.resolve(!1)}catch(le){console.warn("syncDataFromFirebase is not available:",le),R=Promise.resolve(!1)}(!R||typeof R.then!="function")&&(R=Promise.resolve(!1)),R.then(()=>{u({syncing:!1,lastSync:new Date}),Ue&&Ue()}).catch(le=>{console.error("Error syncing from Firebase:",le),u({syncing:!1,lastSync:null})}).finally(()=>{l.current=null})},1e3)};typeof window<"u"&&"requestIdleCallback"in window?window.requestIdleCallback(P,{timeout:5e3}):setTimeout(P,100)}else W&&W()});return window.authContext={user:null},()=>{f(),l.current&&clearTimeout(l.current),W&&W(),window.authContext=void 0}},[]),A.useEffect(()=>{const y=window;y.authContext&&(y.authContext.user=t)},[t]);const Ke=A.useMemo(()=>({user:t,loading:s,initializing:o,error:c,syncStatus:m,login:E,loginEmail:d,loginGoogle:T,register:b,updateUser:U,forgotPassword:g,convertToRegistered:v,logout:O,syncData:M,isAnonymous:t?.isAnonymous||!1}),[t,s,o,c,m,v,O,M]);return S.jsx(Ve.Provider,{value:Ke,...e})}const hr=A.lazy(()=>z(()=>import("./index.tsx-CFMjgz5m.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8]))),wr=A.lazy(()=>z(()=>import("./chunk-D6sbZWTG.js").then(e=>e.i),__vite__mapDeps([9,4,1,2]))),pr=A.lazy(()=>z(()=>import("./theme.tsx-CZrD7ei-.js"),__vite__mapDeps([3,1,2,4,5])).then(e=>({default:e.ThemeProvider}))),Ar=A.lazy(()=>z(()=>import("./chunk-DBiQh3Qq.js").then(e=>e.m),__vite__mapDeps([10,4,1,2,11])).then(e=>({default:e.MigrationProvider}))),vr=A.lazy(()=>z(()=>import("./userList.tsx-DiCdAsTV.js"),__vite__mapDeps([12,1,2,13,4,5])).then(e=>({default:e.UserListProvider}))),Er=A.lazy(()=>z(()=>import("./schedule.tsx-D5dzm_vW.js"),__vite__mapDeps([14,1,2,8,4,5])).then(e=>({default:e.ScheduleProvider})));function Tr({children:e}){return S.jsx(A.Suspense,{fallback:S.jsx(me,{}),children:S.jsx(Ar,{children:S.jsx(vr,{children:S.jsx(Er,{children:e})})})})}function Cr(){const e=A.useContext(Ve);return!e||e.initializing?S.jsx(me,{}):S.jsx(A.Suspense,{fallback:S.jsx(me,{}),children:S.jsx(pr,{children:S.jsx(Tr,{children:S.jsx(hr,{children:S.jsx(wr,{})})})})})}function br(){return S.jsx(yr,{children:S.jsx(Cr,{})})}const Jr=Object.freeze(Object.defineProperty({__proto__:null,default:br},Symbol.toStringTag,{value:"Module"}));export{Ve as A,$t as B,$r as C,Wr as D,Gr as E,er as F,Jt as G,Vt as H,$e as I,Ht as J,zt as K,Yt as L,Wt as M,Lr as N,or as O,zr as P,Hr as Q,nr as R,Nr as S,kr as T,Yr as U,Fr as V,Jr as W,Pr as a,Qt as b,Or as c,ar as d,X as e,jr as f,Br as g,qr as h,Rr as i,Te as j,Xt as k,jt as l,_t as m,Dt as n,Mt as o,lr as p,ue as q,Je as r,xr as s,Ee as t,Qr as u,tr as v,Ur as w,rr as x,Zt as y,ze as z};
